[{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rMais de 5 anos atr√°s, escrevi um blog post criando um pacote do zero em minutos. Desde ent√£o, o pacote {usethis} emergiu do {devtools}, se tornando uma das ferramentas mais queridas da comunidade R. Por isso, fiz uma vers√£o atualizada do mesmo post, utilizando as melhores pr√°ticas dos dias de hoje.\nAqui, veremos como fazer um pacote em R muito, muito r√°pido. Tirei v√°rias coisas que costumo fazer nos pacotes, com dor no cora√ß√£o, tudo pela velocidade, mantendo s√≥ o essencial.\nDuas restri√ß√µes s√£o\nO pacote precisa ficar dispon√≠vel no GitHub.\rO pacote precisa ter pelo menos uma fun√ß√£o.\r\rEssa √© a solu√ß√£o que eu acho mais segura e r√°pida. Voc√™ tamb√©m pode usar o pr√≥prio RStudio para criar pacotes ou clonar coisas do github, mas isso pode dar mais trabalho.\nPasso 1: Crie um projeto de pacote no R\r\rUse a fun√ß√£o usethis::create_package(\"nomeDoPacote\")\rEscreva o nome do seu pacote. O nome do pacote n√£o pode ter espa√ßos, underline (_) nem h√≠fen (-) nem come√ßar com n√∫meros.\r\rAo fazer isso, o {usethis} abrir√° uma nova tela do RStudio, j√° na estrutura de pacote!\nNa tela em que voc√™ escreveu usethis::create_package(), o console ficar√° assim:\nObs: cuidado para n√£o criar um pacote dentro de um reposit√≥rio Git (por exemplo, dentro de um projeto que voc√™ j√° est√° trabalhando). Isso pode dar problemas de conflito.\n\rPasso 2: Configurar Git\rRode usethis::use_git() e confirme nas duas perguntas que ser√£o feitas a voc√™\nSua sess√£o ser√° reiniciada, e o Git est√° configurado üéâ\n\rPasso 3: configure o GitHub\rRode usethis::use_github() e confirme a pergunta que ser√° feita. Aqui estou assumindo que voc√™ tem o Git/GitHub configurado na sua m√°quina. Se n√£o estiver, siga o fluxo do livro Happy Git With R.\nSe tudo der certo, seu pacote j√° estar√° dispon√≠vel no seu GitHub!\n\rPasso 4: Crie sua fun√ß√£o\rExemplo:\n#\u0026#39; Soma 2\r#\u0026#39;\r#\u0026#39; Recebe um vetor de n√∫meros e retorna um vetor de n√∫meros somando dois\r#\u0026#39;\r#\u0026#39; @param x vetor de n√∫meros.\r#\u0026#39;\r#\u0026#39; @export\rsoma_2 \u0026lt;- function(x) {\rx + 2\r}\rCrie a fun√ß√£o dentro de um arquivo com extens√£o .R na pasta R . Se quiser, voc√™ pode usar a fun√ß√£o usethis::use_r() .\rAs informa√ß√µes que come√ßam com #' acima da fun√ß√£o servem para documentar. Nesse caso,\r\ra primeira linha √© o t√≠tulo\ra segunda linha √© a descri√ß√£o\ra parte que come√ßa com @param descreve o que √© o par√¢metro de entrada\ra parte que come√ßa com @export diz para o pacote que essa fun√ß√£o deve estar dispon√≠vel para o usu√°rio quando ele rodar library(nomeDoPacote).\r\r\r\rPasso 5: document, commit e push!\rRode devtools::document().\rCommite suas altera√ß√µes.\rD√™ um push!\r\rSe n√£o saba o que √© commitar e pushar, veja o artigo do Athos sobre o uso do git e do GitHub.\n\rPasso 6: Instalar o pacote em outra m√°quina\rMande o nome do seu usu√°rio do GitHub e o nome do seu pacote para sua migue.\rPe√ßa para ela rodar:\r\rdevtools::install_github(\u0026#39;usuario/nomeDoPacote\u0026#39;)\rAgora ela poder√° usar sua fun√ß√£o!\r\rlibrary(nomeDoPacote)\rsoma_2(1:10)\r# [1] 3 4 5 6 7 8 9 10 11 12\rVoc√™ tamb√©m pode ver o help da fun√ß√£o com ?soma_2:\nFIM!\n\rConclus√µes\r\rAgora voc√™ n√£o tem desculpa para n√£o empacotar suas solu√ß√µes em R.\rEsse tutorial √© incompleto! Para acessar mais detalhes, veja http://r-pkgs.had.co.nz, elaborado por voc√™ sabe quem.\r\r\rOutras pequenas dicas pr√°ticas\r\rUse sempre devtools::check() para checar se seu pacote est√° 100% bem constru√≠do.\rUse usethis::use_package() para usar fun√ß√µes de outros pacotes.\rSempre use os :: para chamar as fun√ß√µes e nunca rode library() ou require() dentro de um pacote.\rUse usethis::use_mit_license() para adicionar um arquivo LICENSE ao seu pacote.\rUse usethis::use_data() para adicionar dados ao seu pacote.\rUse usethis::use_vignettes() para escrever um tutorial sobre seu pacote, igual a esse do dplyr, por exemplo.\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2022-10-13-pacote-miojo-2022/","tags":["miojo"],"title":"Pacotes miojo - como fazer um pacote no R em 3 minutos [atualizado]"},{"author":["Beatriz Milz"],"categories":["Tutorial"],"contents":"\rIntrodu√ß√£o\rAs vezes precisamos usar alguma senha/Token/Key para rodar um c√≥digo, como por exemplo ao usar uma API que solicita autentica√ß√£o. Mas isso significa que devemos escrever a senha no pr√≥prio script .R, por exemplo?\nN√£o! Inclusive isso √© um pouco perigoso. Imagina armazenar a senha para um servi√ßo pago, esquecer e disponibilizar o script no GitHub? √â receita para receber uma notifica√ß√£o do cart√£o de cr√©dito cobrando algo que nem usamos‚Ä¶ √â, j√° ouvi casos assim!\nEnt√£o neste post trago algumas dicas para evitar salvar as senhas nos scripts quando estiver programando.\n\rVari√°veis de ambiente\rUma forma de fazer isso √© com as vari√°veis de ambiente (environment variables). N√£o vou detalhar o conceito de ambientes mas deixei um link nas refer√™ncias, ao final do post.\nSimplificando, as vari√°veis de ambientes s√£o objetos que s√£o carregados ao iniciar a sess√£o do R. Ent√£o eles ficar√£o dispon√≠veis para uso, apesar de n√£o aparecer no painel Environment do RStudio.\nUma forma de saber quais s√£o as nossas vari√°veis de ambiente √© usando a fun√ß√£o Sys.getenv() sem argumentos. Aten√ß√£o, v√°rias vari√°veis de configura√ß√£o ir√£o aparecer no output e n√£o recomendo alter√°-las.\nA fun√ß√£o Sys.setenv() permite que voc√™ salve a senha/token nas vari√°veis de ambiente. Cuidado, rode essa etapa no console e n√£o salve no script (pois justamente queremos n√£o armazenar as senhas no script, certo?).\nSys.setenv(MINHA_SENHA = 1234)\rPara buscar o valor salvo na vari√°vel, pode usar a fun√ß√£o Sys.getenv(). Essa fun√ß√£o podemos usar no nosso script sem problemas!\nSys.getenv(\u0026quot;MINHA_SENHA\u0026quot;)\r## [1] \u0026quot;1234\u0026quot;\r\rIndo al√©m com a ajuda do usethis\rAs vari√°veis de ambiente podem ser vinculadas ao .Rproj ativo, ou ao usu√°rio do computador. Elas ficam salvas no arquivo .Renviron. Para abrir o arquivo e ver as vari√°veis de ambiente salvas, voc√™ pode usar a fun√ß√£o usethis::edit_r_environ():\n# Abre as vari√°veis de ambiente para o usu√°rio do computador\rusethis::edit_r_environ(scope = \u0026quot;user\u0026quot;)\r#\u0026gt; ‚Ä¢ Modify \u0026#39;/Users/beatrizmilz/.Renviron\u0026#39;\r#\u0026gt; ‚Ä¢ Restart R for changes to take effect\r# Abre as vari√°veis de ambiente para o projeto ativo\rusethis::edit_r_environ(scope = \u0026quot;project\u0026quot;)\r#\u0026gt; ‚úî Setting active project to \u0026#39;/Users/beatrizmilz/Documents/GitHub/blog-en\u0026#39;\r#\u0026gt; ‚Ä¢ Modify \u0026#39;.Renviron\u0026#39;\r#\u0026gt; ‚Ä¢ Restart R for changes to take effect\rO padr√£o para armazenar vari√°veis neste arquivo √©:\nNOME_VAR=\u0026#39;SENHAAQUI12345\u0026#39;\rAten√ß√£o! Depois de alterar o arquivo .Renviron, √© necess√°rio reiniciar o R para que as mudan√ßas sejam consideradas. Isso porque esse arquivo √© carregado ao iniciar o R.\nAten√ß√£o 2: Caso voc√™ use um arquivo .Renviron vinculado ao seu projeto .Rproj, cuidado ao subir esse arquivo para o GitHub, √© perigoso pois pessoas poder√£o ver suas senhas. Se o seu reposit√≥rio for p√∫blico, √© essencial que voc√™ adicione ele no .gitignore, assim ele ser√° ignorado pelo Git. A fun√ß√£o usethis::use_git_ignore() pode nos ajudar nisso:\nusethis::use_git_ignore(\u0026quot;.Renviron\u0026quot;)\r#\u0026gt; ‚úî Adding \u0026#39;.Renviron\u0026#39; to \u0026#39;.gitignore\u0026#39;\r\rSolicitar a senha\rE quando queremos que a pessoa usu√°ria possa sempre escrever a senha? Existe uma fun√ß√£o para isso: rstudioapi::askForPassword(). Podemos inclusive escrever a frase que ser√° mostrada ao perguntar a senha. A senha digitada ser√° retornada como um texto, e podemos salvar em um objeto para utilizar posteriormente no que for necess√°rio.\nsenha_informada \u0026lt;- rstudioapi::askForPassword(\r\u0026quot;Escreva sua senha por favor!\u0026quot;\r)\rPop up feito pela fun√ß√£o askForPassword.\n\r\rGitHub Actions\rE quando precisamos usar senhas em c√≥digos rodados com GitHub Actions (GHA)? Se voc√™ n√£o conhece nada sobre GHA, eu tenho alguns posts sobre isso!\nQuando estamos usando GHA, podemos adicionar senhas na sess√£o SECRETS do GitHub. Assim ningu√©m (exceto voc√™, quando cria um SECRETS), ver√° a senha/credenciais.\nIsso fica nas configura√ß√µes do reposit√≥rio, e o link usa esse padr√£o:\nhttps://github.com/SEU-USUARIO/SEU-REPOSITORIO/settings/secrets/actions\rExemplo de um reposit√≥rio privado meu:\nPrint screen da p√°gina de secrets.\n\rTamb√©m √© preciso adaptar o c√≥digo do action para buscar essa vari√°vel no Secrets. Exemplo de c√≥digo:\n - name: Execute Script\renv:\rGITHUB_PAT: ${{ secrets.GITHUB_PAT }}\rNOME_VAR: ${{ secrets.NOME_VAR }}\rrun: |\rRscript \u0026quot;seu_script.R\u0026quot;\rCom isso √© poss√≠vel acessar essas vari√°veis com senha, no script usando a fun√ß√£o Sys.getenv('NOME_VAR') que mostrei acima.\n\rMais camadas de seguran√ßa\rPara mais camadas de seguran√ßa, recomendo a leitura da documenta√ß√£o do pacote httr2, no trecho sobre Secret management. Nesse trecho, al√©m de apresentar a op√ß√£o utilizando a fun√ß√£o usethis::edit_r_environ(), tamb√©m √© apresentado as fun√ß√µes httr2::secret_encrypt() e htt2::secret_decrypt().\nEu ainda n√£o testei essas fun√ß√µes pois o pacote httr2 √© bem recente. Segundo o autor do pacote (o Hadley Wickham), com essas fun√ß√µes √© poss√≠vel usar criptografia para lidar com as senhas/tokens.\n\rConclus√£o\rEsperamos que este post seja interessante para voc√™, e que as suas senhas estejam sempre protegidas! Bons estudos e at√© a pr√≥xima!\n\rRefer√™ncias\r\rEnvironments/Ambientes - Hands-On Programming with R\n\rSecret management - Documenta√ß√£o do pacote httr2\n\r\r\rAgradecimentos\r\rJulio Trecenti, pela leitura pr√©via e sugest√µes feitas no texto.\n\rTive a ideia de escrever esse post ao responder uma pergunta feita pela aluna Mari Ribeiro, em um curso da Curso-R. Obrigada Mari!\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2022-09-13-senha-no-script/","tags":["Boas pr√°ticas"],"title":"Como usar senhas sem escreve-las nos scripts"},{"author":["Julio","Flavia E. Rius","Beatriz"],"categories":["Divulga√ß√£o"],"contents":"\rA rstudio::conf(2022) acabou, mas n√£o saiu de n√≥s. Ficaram as mem√≥rias, as coisas novas para estudar, e as novas amizades. Nesse post, falamos um pouco de nossas experi√™ncias pessoais na confer√™ncia. O texto conta com a participa√ß√£o especial da Fl√°via E. Rius, que particiou do evento comigo (Julio) e com a Beatriz. Confira!\nFl√°via E. Rius\rTwitter: @flaviaerius\nBlog: https://flaviaerius.netlify.app\nParticipei da rstudio::conf() pela primeira vez neste ano de 2022, e √∫ltima, j√° que ano que vem ser√° posit::conf(), e vou contar sobre a minha experi√™ncia neste post. Pra deixar todos no contexto, vou me apresentar. Eu sou a Fl√°via E. Rius, cientista de dados na Mendelics/meuDNA, empresas de an√°lise gen√¥mica (sim, do DNA!) Uso o R para a maior parte do meu trabalho, principalmente em limpeza, processamento e estrutura√ß√£o de dados, modelos, e cria√ß√£o de reports e relat√≥rios em Rmarkdown (era pr√©-Quarto.) Al√©m disso, dou mentorias online para pessoas do mundo todo em R, bioinform√°tica e estat√≠stica. Como a Bea, apliquei para a bolsa de Diversity Scholar para participar da confer√™ncia, e fui escolhida para receb√™-la (yay!)\nEssa foi a minha primeira confer√™ncia de R, e tamb√©m a primeira relacionada a Data Science fora do mundo da bioinform√°tica. Foi uma experi√™ncia completamente nova.\nEscolhi o workshop de Machine Learning With Tidymodels, que aconteceu nos primeiros dois dias do congresso, das 9 √†s 17h. Os outros dois dias consistiram em palestras acontecendo paralelamente em diferentes salas, e a tarefa de escolher a quais participar n√£o foi f√°cil.\nA primeira impress√£o que tive ao chegar foi do hotel, gigantesco, e com uma estrutura pra congressos que eu nunca tinha visto antes. O hotel fica localizado numa esp√©cie de cidade tur√≠stica artificial, chamada National Harbor, no estado de Maryland.\nWorkshop: Machine Learning With Tidymodels\rConfesso que fui descobrir uma migalha do que eram os tidymodels uma semana antes do workshop. Escolhi ele porque queria aprender mais sobre machine learning (ML), e, apesar de saber que a ferramenta preferida para a aplica√ß√£o de ML √© scikit-learn no python, achei interessant√≠ssimo aprender no R, linguagem que j√° √© confort√°vel pra mim.\nTidymodels s√£o ferramentas dentro de diversos pacotes que, juntas, formam uma maneira nova de criar modelos estat√≠sticos e de ML no R. Dentre os pacotes est√£o: recipes, rsample, parsnip, workflows, vetiver, etc..\nResumi em t√≥picos os pontos altos e n√£o t√£o altos do workshop abaixo.\nPontos altos do workshop:\r\rModularidade: com os tidymodels cada etapa √© um m√≥dulo que fica guardado em uma vari√°vel e pode ser aplicada para novos dados. Por exemplo a receita do pacote recipes e o workflow do pacote workflows. Isso √© feito no intuito de guardar todo o processo aplicado nos dados de treino, para, no final, repetir para os dados de teste, ou mesmo reaplicar um pr√©-processamento e feature engineering para um novo set de dados, por exemplo.\n\rProfessores: Max Kuhn, Julia Silge e Davis Vaughan foram professores excepcionais, com destaque para a Julia, que √© fenomenal na did√°tica. Ela explica de uma forma muito f√°cil e completa, para que todos possam entender. Todos trouxeram sua expertise, um complementando o outro sobre os as d√∫vidas que iam surgindo (ali√°s, o grupo de alunos tamb√©m era muito bom, com d√∫vidas bastante pertinentes e complementares ao workshop.) Os Teaching Assistants (TAs) foram muito bons em ajudar com as d√∫vidas, e mesmo os professores, quando n√£o estavam dando a aula, atuaram como TAs, ajudando com as d√∫vidas dos alunos.\n\rvetiver: em particular, essa ferramenta fez meus olhos brilharem, apesar de ter sido mostrada bem brevemente. √â uma maneira de construir uma API a partir do R para deploy de modelos de machine learning, que j√° resulta na p√°gina da API, e pode at√© gerar a Dockerfile pra deploy da API em plataformas como o Google App Engine ou AWS.\n\r\r\rPontos n√£o t√£o altos do workshop:\r\rConceitos de ML: foram usados exemplos de √°rvores de decis√£o (decision trees) e random forests, mas faltou explicar com mais detalhe o que s√£o, e em quais situa√ß√µes podem ser usados. Eu relevei absolutamente essa parte porque sei que n√£o √© f√°cil passar todo o conte√∫do necess√°rio, ainda mais em um workshop de apenas dois dias com tanto conte√∫do sobre ML e aplica√ß√µes na ferramenta de foco, os tidymodels.\r\rSe voc√™ tiver interesse em saber mais sobre o workshop, todo o conte√∫do est√° dispon√≠vel online:\n\rSlides e pr√©-requisitos: todos os slides foram feitos com Quarto, o que significa que s√£o interativos, ou seja, √© poss√≠vel copiar c√≥digo e clicar nos links dos slides.\n\rMaterial complementar: s√£o informa√ß√µes extras sobre alguns slides, que tamb√©m podem ser acessadas pelo √≠cone i vermelho no canto superior direito.\n\r\r\rLots of stickers (my first ones!) and learning in the first day of #rstudioconf2022 .\nLoving the ML with Tidymodels workshop, and the amazing people around here! pic.twitter.com/JAckV0atWw\r‚Äî Fl√°via E. Rius (@flaviaerius) July 26, 2022\r\r\r\r\r\rPalestras\rOs dias 3 e 4 da confer√™ncia consistiram em palestras, sendo elas quatro keynotes, que s√£o as palestras principais, grandes, sem nenhuma outra acontecendo em paralelo.\nA primeira keynote foi sobre tidymodels, com a Julia Silge e o Max Kuhn, e tamb√©m contou com o super an√∫ncio da mudan√ßa de nome da RStudio para Posit pelo Hadley Wickham e o JJ Allaire, fundador e CEO da RStudio (agora Posit.)\nA segunda foi com o Joe Cheng, CTO da RStudio. Ele contou a hist√≥ria sobre como o Shiny surgiu, e trouxe novidades como o Shiny para python e a vers√£o no code do Shiny para R, usando apenas ferramentas de apontar e clicar.\nA terceira, com a Mine √áetinkaya e a Julia Stewart, falou sobre as maravilhas do Quarto. Uma ferramenta que me chamou muito a aten√ß√£o √© o multiplex, em que o link dos seus slides constru√≠dos em Quarto muda os slides conforme voc√™ muda na sua apresenta√ß√£o! Muito m√°gico! Claro que tem muita coisa interessante no Quarto al√©m disso, recomendo dar uma olhada.\nA √∫ltima, com o Jeff Leek, contou sobre o seu projeto social de trazer jovens da periferia para o aprendizado e aplica√ß√£o de ci√™ncia de dados, o Data Trail. Um projeto muito bonito, em que os alunos s√£o pagos para fazerem o curso, e, ao fim, t√™m acesso a um est√°gio na √°rea.\nEntre as keynotes v√°rias palestras interessantes aconteceram. As que mais me chamaram a aten√ß√£o foram:\n\rDemistifying MLOps, da Isabel Zimmerman, onde ela fez um paralelo entre fazer cookies e os processos de constru√ß√£o, deploy e manuten√ß√£o de modelos de machine learning usando o vetiver;\n\rMaking Data Pipelines With R, da Meghan S Harris, com dicas valiosas de organiza√ß√£o e documenta√ß√£o para pipelines de an√°lise de dados;\n\rGarbage Data, do Jim Kloet, que falou sobre o que fazer com a garbage data (dados lixo) e da import√¢ncia de definir a coleta de dados corretamente;\n\rExploring Query Optimization, da Rebecca Hadi, sobre como lidar com queries de tabelas no SQL com mais de um bilh√£o de colunas;\n\rdm: Analyze, build and deploy relational data models, do Kirill Muller, que mostrou um pacote muito interessante para construir esquemas de bancos de dados relacionais a partir de tibbles no R;\n\rThe Future of missing data, do Nicholas Tierney, sobre como lidar com dados faltantes, inclusive trazendo maneiras de incluir tais dados em sua an√°lise para entender o que pode ter acontecido com eles.\n\rSmall Team Large Organization: Building Impactful Shiny Dashboards at NIH, do Jon Nye, que falou sobre o uso de um modelo de machine learning para classificar solicita√ß√µes de grants (verbas para pesquisa) de acordo com o tema e a relev√¢ncia;\n\rBuilding a ggplot2 rollercoaster, do Tyler Morgan-Wall, em que ele empregou seus pacotes de anima√ß√£o 3D no R rayshader e rayrender para obter um cen√°rio 3D com gr√°ficos do ggplot, e criou o pacote rayrollercoaster especificamente para a apresenta√ß√£o! A montanha-russa percorre os gr√°ficos usando o percurso que voc√™ criar. A meu ponto de vista, a montanha-russa em si √© mais uma divers√£o, mas os outros pacotes do Tyler s√£o bastante √∫teis para visualiza√ß√£o 3D.\n\r\rLembrando que essas foram minhas palestras favoritas de acordo com o que posso aplicar e meus interesses, e dentro das que assisti.\nEm resumo, a confer√™ncia foi bastante enriquecedora. Aprendi muito sobre tidymodels, machine learning em geral, Quarto, e sobre diversos novos pacotes muito √∫teis no R (e alguns com vers√£o em python tamb√©m.)\nSe voc√™ estiver considerando ir √† confer√™ncia no ano que vem, saiba que ser√° um tempo muito bem aproveitado!\nN√£o deixe de aplicar para a bolsa de diversidade!\n\rtl;dr\r\rrstudio:conf(2022) foi fenomenal, com uma pegada tech, muitas novidades aplic√°veis, e muita gente interessante;\rworkshop de ML com tidymodels trouxe uma an√°lise de dados reais aplicando conceitos de ML como split de amostra, feature engineering, reamostragem e tunagem. Valeu muito a pena (confira o conte√∫do aberto em workshops.tidymodels.org);\rJulio, Bea e Dani aqui do curso-R s√£o pessoas excepcionais, foi o maior prazer conhec√™-los!\r\r\r\rBeatriz Milz\rTwitter: @BeaMilz\nBlog: https://beamilz.com\nMuito do que eu achei interessante j√° foi falado pela Fl√°via (neste post) e pelo J√∫lio (em posts anteriores) sobre a confer√™ncia, ent√£o vou abordar aqui o que for diferente! Al√©m disso, adicionei alguns tweets postados durante o evento, pois √© uma forma legal de ver fotos e conversas que aconteceram por l√°!\nAntes da confer√™ncia\rComo a Fl√°via, essa tamb√©m foi a primeira vez que participo da rstudio::conf(). Uma curiosidade √© que, por pouco, eu n√£o participei! Eu havia lido um an√∫ncio anteriormente dizendo que o evento n√£o aconteceria, ent√£o n√£o fiquei acompanhando o site. Por√©m, no √∫ltimo dia dispon√≠vel para submeter para a bolsa de diversidade e palestras, eu vi um tweet sobre a confer√™ncia e descobri que ela iria acontecer! Compartilhei com as minhas redes e logo corri para submeter uma palestra e tamb√©m para a bolsa de diversidade.\nUm tempo depois, recebi um email com o convite para ser Teaching Assistant (TA) no workshop Building Tidy Tools, ministrado pela Emma Rand e pelo Ian Lyttle. Eu aceitei e a√≠ come√ßou o processo de organizar tudo para participar do evento! Tamb√©m recebi depois o email dizendo que a bolsa de diversidade foi aprovada, e que a palestra que eu submeti foi aprovada como uma lightning talk (uma palestra de 5 minutos)! Enfim, fiquei extremamente grata por todas essas oportunidades.\n\rTomorrow starts the @rstudio Conference! I'm very excited to be part of it :)\nThanks @rstudio for the diversity scholarship!ü•≥\nAlso, glad to be part of the group of R Brazilian users at the conference @flaviaerius @jtrecenti @dfalbel üåé#rstudioconf #rstats #rstudioconf2022 pic.twitter.com/WvLpFZIaw5\r‚Äî Beatriz Milz (@BeaMilz) July 24, 2022\r\r\r\r\rParticipando do workshop como TA\rParticipar como Teaching Assistant do workshop Building Tidy Tools foi uma experi√™ncia INCR√çVEL! As pessoas ministrantes do workshop (Emma Rand e Ian Lyttle) s√£o extremamente gentis, e mesmo antes do workshop eles incluiam os TAs nas conversas via email para que a gente j√° tivesse familiaridade com a estrutura do workshop e os materiais que seriam utilizados.\nAli√°s, todos os materiais para este workshop est√£o dispon√≠veis neste site!\nNo primeiro dia do workshop, o foco foi abordar como podemos criar um pacote: no final do primeiro dia, as pessoas participantes j√° tinham um pacote criado, com algumas fun√ß√µes e seus testes, dispon√≠vel online, e com uma p√°gina web feita com pkgdown! Nesse dia, consegui auxiliar bastante pessoas com d√∫vidas que surgiam sobre configura√ß√£o do ambiente para desenvolvimento de pacotes, e os erros que apareciam no caminho durante o workshop. Eu j√° tinha bastante experi√™ncia com v√°rios dos erros que aconteciam, pois eu utilizo pacotes diariamente e tamb√©m sou uma das professoras do curso de pacotes na Curso-R.\nNo segundo dia do workshop, o conte√∫do foi aprofundado e o foco foi a constru√ß√£o de fun√ß√µes de forma que elas funcionem bem de acordo com a filosofia do tidyverse, sendo o destaque (na minha opini√£o) o conte√∫do sobre design de fun√ß√µes e tidy eval.\n\rA couple of ussies at the end of ‚ÄúBuilding Tidy Tools‚Äù workshop at #rstudioconf2022@er13_r is a wonderful collaborator! Thanks to TAs @tladeras @BeaMilz @heyhayhay__ Kailey Mulligan and Elliot Murphy, who kept things moving!\nThanks also to all our students, great energy! pic.twitter.com/oclaAfO9d8\r‚Äî Ian Lyttle (@ijlyttle) July 26, 2022\r\r\r\rEm resumo: foi uma oportunidade maravilhosa, e agrade√ßo muito √† Mine √áetinkaya-Rundel (que estava na organiza√ß√£o dos workshops neste evento), aos instrutores e outros TAs, e tamb√©m aos estudantes que participaram do workshop!\n\rBolsa de diversidade\rComo comentei anteriormente, eu e a Fl√°via fomos selecionadas para receber uma bolsa de diversidade. Algo que gostei muito foi terem criado um canal do Slack, antes mesmo da confer√™ncia, para que pudessemos conversar e conhecer outros bolsistas! Assim, quando chegamos no evento j√° conheciamos v√°rias pessoas e foi mais f√°cil de se conectar :) Essa foto tem o registro das pessoas que participaram como bolsistas:\nFonte: Imagem disponibilizada por Katherine Vu (RStudio).\n\rPalestrando na rstudio::conf()\rA minha palestra rel√¢mpago foi sobre um tema que tenho aprendido nos √∫ltimos 2 anos e acho muito √∫til e interessante: automatiza√ß√µes com GitHub Actions.\nA grava√ß√£o da palestra est√° dispon√≠vel no site da confer√™ncia!\n\n\rUm destaque foi o treinamento recebido pela Articulation. Todas as pessoas que palestraram no evento receberam convites para participar de um treinamento para oferecer palestras mais interessantes, e eu participei em duas atividades. O treinamento recebido me fez reformular completamente a minha proposta, diminuindo o escopo da palestra e focando em um p√∫blico-alvo mais restrito: pessoas que ainda n√£o usam GitHub Actions!\nPalestrar na rstudio::conf() foi uma experi√™ncia muito legal! A energia da plat√©ia foi muito boa, e v√°rias pessoas falaram comigo ap√≥s a palestra dizendo que acharam interessante!\nTodo material (slides e material complementar) est√° dispon√≠vel no meu blog.\n\nO Julio me ajudou bastante durante a cria√ß√£o dessa palestra, dando v√°rios feedbacks, e eu o agrade√ßo muito! Al√©m disso, ele comentou um pouco da minha palestra no post sobre o segundo dia do evento.\n\rThe material for my talk at #rstudioconf2022 about GitHub Actions is available on my blog:https://t.co/07rEJwFCPn\nThanks everyone that watched and supported!!#rstudioconf @rstudio @github @GitHubBrasil pic.twitter.com/SHF3bK09Qr\r‚Äî Beatriz Milz (@BeaMilz) July 28, 2022\r\r\r\r\rQuarto\rO Quarto, para quem n√£o conhece, √© a nova gera√ß√£o do RMarkdown. Eu j√° venho usando o Quarto desde outubro de 2021, enquanto ele estava sendo desenvolvido e aprimorado. Ent√£o poucas coisas foram novidades para mim nas palestras sobre Quarto, mas eu gostei de ver como foi dado √™nfase! A keynote ‚ÄòHello Quarto‚Äô da Mine √áetinkaya-Rundel e da Julia Stewart Lowndes foi maravilhosa, com lindas artes da Allison Horst.\n\n\rArtwork from ‚ÄúHello, Quarto‚Äù keynote by Julia Lowndes and Mine √áetinkaya-Rundel, presented at RStudio Conference 2022. Illustrated by Allison Horst.\n\rTenho usado bastante e sei que ainda tem muita coisa legal para ser lan√ßada relacionado ao Quarto. Eu e o Julio ficamos t√£o empolgados, que reestruturamos o curso de relat√≥rios da Curso-R (pr√≥xima turma come√ßa em 16/08/2022) para abordar bastante conte√∫do sobre essa ferramenta nova!\n\rEncontros\rUma das coisas mais divertidas foi conhecer tanta gente legal da comunidade, e conversar nos per√≠odos das refei√ß√µes e nos eventos no per√≠odo da noite, que d√£o espa√ßo para conversas entre participates. O tweet abaixo foi tirado na primeira noite do evento: eu e o Julio levamos alguns jogos e jogamos com algumas pessoas que conhecemos por l√°!\n\rPart of the fun in R events are playing games with people that we meet from the community! #rstudioconf #rstudioconf2022 #hanabi @rstudio @flaviaerius @Devin_lj @jtrecenti and David Christensen üéâ pic.twitter.com/thndW1Le9C\r‚Äî Beatriz Milz (@BeaMilz) July 26, 2022\r\r\r\r\rStickers\rUma febre durante o evento √© aumentar a cole√ß√£o de stickers. Esse tweet feito pelo Luis resume v√°rios momentos durante a confer√™ncia em que v√°rias pessoas buscavam algum sticker de pacotes queridos em uma mesa cheia deles!\n\r#rstudioconf2022 pic.twitter.com/cCn5me1rjc\r‚Äî Luis D. Verde Arregoitia (@LuisDVerde) July 26, 2022\r\r\r\rEu trouxe de volta v√°rios stickers, e j√° colei no meu computador e estou distribuindo entre os amigos! Esse √© o meu computador ap√≥s a confer√™ncia:\nNotebook com v√°rios stickers!\n\r\rConclus√£o da Bea\rEnfim, essa confer√™ncia foi INCR√çVEL! Espero ter oportunidades de participar nas confer√™ncias da posit no futuro :)\n\r\rJulio Trecenti\rComo eu j√° comentei sobre tudo o que passei nos posts anteriores ‚Äì dia 1: aqui e dia 2: aqui ‚Äì serei bem breve.\nPara mim, a parte mais legal foram os encotros e reencontros presenciais. Al√©m da companhia sempre maravilhosa da Bea e da companhia da Fl√°via que nos acompanhou em toda a viagem, tamb√©m encontramos novas pessoas do Brasil, reencontramos amigos e conhecemos novas pessoas de fora.\nNa parte t√©cnica, para mim o mais legal foi ver como a RStudio, agora Posit, est√° se aproximando de forma amig√°vel de outras linguagens de programa√ß√£o. Ao inv√©s de simplesmente come√ßar a fazer ferramentas para o Python, a empresa decidiu criar ferramentas multi-linguagem, focando na produ√ß√£o cient√≠fica (como o Quarto), que vai muito al√©m das linguagens de programa√ß√£o.\nE claro, meu lado tiete adorou ter refei√ß√µes com o Hadley e conversar com outras pessoas famosas, como o JJ Allaire, o Christophe Dervieux e o Tyler Morgan-Wall.\n\rThankfully Julio asked for a picture, otherwise no one would believe that we had lunch with @hadleywickham and @chrisderv üòÑ @jtrecenti @flaviaerius @rprimi e @anakiki1505 ! #rstudioconf2022 #RStudioConf #posit @rstudio #RStats pic.twitter.com/R8jAOyfUxd\r‚Äî Beatriz Milz (@BeaMilz) July 27, 2022\r\r\r\rAbra√ßos e at√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2022-08-12-rstudio-conf-impressoes/","tags":["evento","rstudio::conf"],"title":"Impress√µes pessoais da rstudio::conf(2022)"},{"author":["Julio"],"categories":["Divulga√ß√£o"],"contents":"\rEste √© o segundo post descrevendo o que aconteceu de mais legal na principal confer√™ncia da RStudio. Se voc√™ quiser acompanhar o que aconteceu no dia anterior, basta entrar aqui.\nKeynote 1: Quarto all the way across the sky\rJulia Lowndes e Mine √áentikaya-Rundel fizeram uma apresenta√ß√£o linda, cheia de ilustra√ß√µes da Allison Horst sobre o Quarto. Mostraram como a ferramenta simplifica a constru√ß√£o de relat√≥rios, apresenta√ß√µes e sites usando a ferramenta.\nA coisa mais legal que aprendi √© que podemos ter documentos .qmd, .Rmd e .ipynb no mesmo site. Dessa forma, √© poss√≠vel que pessoas colaborem usando a ferramenta que mais se sentem confort√°veis, sem precisar aprender nada novo, e o Quarto d√° conta das transforma√ß√µes.\nPara quem n√£o conhece, outra coisa muito legal √© que o Quarto n√£o tem nada a ver com o R nem a RStudio IDE. Por isso, ele pode (e j√° est√° sendo) usado em diversas plataformas diferentes como VS Code e Jupyter. Se quiser ver um exemplo legal de uso do Quarto, d√™ uma olhada no livro sobre Pandas, do Wes Mckinney.\nObs: sobre o t√≠tulo da se√ß√£o, veja esse v√≠deo maravilhoso que acusa minha idade.\n\rLightning talks\rAs confer√™ncias de R costumam ter uma ou mais sess√µes das chamadas lightning talks, que s√£o palestras de apenas 5 minutos para que as pessoas apresentem algum pacote novo ou ideia.\nComo s√£o muitas palestras e muito r√°pidas, vou tentar listar as minhas favoritas abaixo.\n\rPacote {clock}, com Davis Vaughan. O pacote clock j√° existe a algum tempo e serve para complementar algumas funcionalidades do pacote lubridate. Na sua fala, Davis mostrou um exemplo de como o clock pode ser √∫til, como fazer a opera√ß√£o ‚Äú2022-01-30‚Äù + 1 m√™s (ou seja, o que significa 1 m√™s depois do dia 30 de janeiro de 2022).\rWebR, com George Stagg. Com o WebR, podemos utilizar o R diretamente no navegador, com o web assembly. Apesar das limita√ß√µes e apesar de ser mais lento, parece um excelente passo para criar sistemas simples com shiny o shiny. Mas tudo isso ser√° no futuro.\rGitHub Codespaces, com David Smith. David (conhecido como revodavid, por conta da Revolution Analytics, que foi adquirida pela Microsoft) apresentou sobre uma ferramenta muito legal, que permite que seja aberto um Docker diretamente de um reposit√≥rio do GitHub. √â muito √∫til para fazer o setup de ambientes na cloud, usando por exemplo o RStudio server e instalando as depend√™ncias de pacotes.\rGitHub Actions, com Beatriz Milz. Ela falou sobre como essa ferramenta tem ficado popular ultimamente, sendo que o uso de GitHub actions mais que quadruplicou em 2 anos de uso apenas nas organiza√ß√µes da RStudio. Tamb√©m mostrou como podemos utilizar actions para rodar scripts arbitr√°rios de R, n√£o apenas processos relacionados a CI/CD. Mais informa√ß√µes no blog dela.\rPacote ggdist, de Mathew Kay. Esse pacote √© √∫til para plotar distribui√ß√µes de probabilidade em R, de v√°rios jeitos diferentes. Eu sinto que o pacote tem at√© fun√ß√µes demais, o que dificulta para aprender, mas certamente √© muito legal.\rPacote naniar, de Nicholas Tierney. Foi uma apresenta√ß√£o muito engra√ßada, cheia de ironias. Gostei de conhecer um pouco mais sobre o pacote naniar, pois s√≥ havia usado uma dou duas fun√ß√µes do pacote.\r\r\rPalestras sobre shiny\rNa parte da tarde, tivemos mais duas baterias de palestras, antes da √∫ltima Keynote. Muita informa√ß√£o!\nAcabei escolhendo a parte de shiny, por apresentar muitas novidades interessantes.\n\rshinyuibuilder, de Nick Strayer. Agora temos uma ferramenta para fazer o design de shiny apps! Para isso, a equipe da Posit criou uma ferramenta para codar e desenhar a parte da UI de um shinyapp. A ferramenta permite que a pessoa use tanto a interface gr√°fica quanto o c√≥digo ao mesmo tempo.\rDesign de shiny apps, com Greg Swinehart. Trata-se do designer da Posit, que fez uma apresenta√ß√£o muito animada ‚Äì e longa, pois estrapolou o tempo da fala ‚Äì sobre como fazer bons shiny apps. O grande an√∫ncio √© que finalmente, FINALMENTE o bslib suportar√° cards, ent√£o poderemos fazer pacotes com Bootstrap 5 sem sofrer para criar as boxes e cards que gostamos tanto no {bs4Dash}.\rOutro shiny builder, com Peter Gandenberger. Trata-se de uma mistura de shinyuibuilder com esquisse que permite a cria√ß√£o de apps shiny completos (com ui e server) apenas com drag e drop, com pouqu√≠ssimo esfor√ßo. Obviamente a ferramenta apresenta limita√ß√µes, mas pode ser uma boa forma de come√ßar no universo shiny para iniciantes, e pode ser uma ferramenta de produtividade para pessoas experientes.\r\r\rPalestras sobre Quarto\rNa segunda bateria de palestras, decidi participar das palestras sobre Quarto, apesar de ainda estar muito interessado na trilha de shiny. perdi as palestras do Hadley Wickham, sobre o pacote {R7} e tamb√©m a palestra sobre o pacote {shinytest2}.\n\rA primeira palestra foi sobre a utiliza√ß√£o do Quarto da perspectiva de uma pessoa que n√£o programa no dia-a-dia. Apesar de n√£o ter nada de novo na parte t√©cnica, foi interessante para encorajar as pessoas a usar essa nova ferramenta.\rnbdev, de Hamel Husain, da Fast.ai. Ele falou de uma ferramenta muito doida que, a partir de um Jupyter Notebook, gera um biblioteca, uma documenta√ß√£o (com Quarto) e um monte de coisas que n√£o entendi. O que eu acho √© que tem algumas coisas que s√£o meio impressionantes no Python (como documenta√ß√£o de qualidade) que no R s√£o bem comuns (por conta do {roxygen2}), mas n√£o sei.\rMais uma demonstra√ß√£o do Quarto, por Devin Pastoor. Dessa vez foi bem live coding mesmo, e o autor mostrou v√°rios atalhos interessantes do Quarto, como o autocomplete dos arquivos YAML e a possibilidade de criar sites com muita facilidade. Eu fiquei impressionado com a parte de instala√ß√£o de extens√µes, que permitem adicionar novas capacidades a sites do quarto. Magic.\r\r\r√öltima Keynote\rE o evento estava chegando ao fim. E foi em grande estilo. Convidaram o pesquisador Jeff Leek, um dos autores do curso de Data Science do Coursera, criado pela John‚Äôs Hopkins University. Esse curso √© um dos primeiros MOOCs no tema e ficou extremamente popular, com mais de um milh√£o de pessoas inscritas.\nNa palestra, Jeff falou sobre a iniciativa Data Trail, um trabalho maravilhoso que ele iniciou para realizar treinamentos de ci√™ncia de dados em comunidades com menos acesso. Ele mostrou como o trabalho foi pesado, mas que teve bons resultados, com v√°rias pessoas do programa acabando empregadas. Um dos insights mais importantes que foram apresentados √© que o maior desafio para as pessoas n√£o √© aprender ci√™ncia de dados, e sim ter a estrutura e o ambiente adequados para isso. Por isso que √© importante ajudar com transporte e ferramentas para essas pessoas trabalharem.\nNo final, Jeff mostrou como expandir essa iniciativa. Ele mostrou como j√° est√£o sendo criados alguns projetos sat√©lite do Data Trail em outras cidades dos Estados Unidos. Quem sabe no futuro seja poss√≠vel expandir para outros pa√≠ses.\n\rOrlando 2023\rNo final, foi anunciado que a pr√≥xima posit::conf (ou seria from posit import conf?) ser√° em Orlando, Fl√≥rida, em Maio de 2023. Quem tiver interesse de ir, melhor j√° come√ßar a guardar uma graninha ou se preparar para pedir bolsa!\n\rQuer saber mais?\rBom, essas foram minhas anota√ß√µes do dia 01 da rstudio::conf(2022). Todas as palestras ficar√£o online neste link. No futuro, faremos mais posts sobre o tema!\n\r","permalink":"https://blog.curso-r.com/posts/2022-07-29-rstudio-conf-2022-dia2/","tags":["evento","rstudio::conf"],"title":"rstudio::conf 2022, segundo dia de palestras"},{"author":["Julio"],"categories":["Divulga√ß√£o"],"contents":"\rA confer√™ncia\rA rstudio::conf √© um evento anual organizado pela RStudio. O evento re√∫ne as celebridades do R como Hadley Wickham, Jenny Bryan e toda a turma da RStudio, al√©m de pessoas interessadas em conhecer melhor a comunidade e acessar as ferramentas mais quentes no universo da ci√™ncia de dados.\nEste ano, o evento tem foco principal no Quarto. Trata-se de um software desenvolvido para produzir documentos cient√≠ficos (relat√≥rios, artigos, apresenta√ß√µes), funcionando como um complemento ao Pandoc para processar c√≥digos (em R, python, julia, javascript) inseridos nos documentos. Se voc√™ se interessou pela ferramenta, vale a pena dar uma olhada nesse post da Beatriz Milz.\nMas claro que a confer√™ncia n√£o ser√° s√≥ sobre Quarto. Teremos conte√∫dos maravilhosos nos pr√≥ximos dias, como avan√ßos no {shiny}, {tidymodels} e outras ferramentas que amamos.\n\rO hotel\rFicamos no Gaylord National Harbor, que fica perto de Washington D.C., a cidade que abriga Biden, Kamala \u0026amp; amigos.\nPara mim (Julio) a melhor descri√ß√£o foi a que a Emma (professora do workshop Building Tidy Tools) nos deu quando conversamos com ela: ‚Äúit‚Äôs MAD‚Äù. √â um hotel muito doido, por v√°rios motivos. √â muito muito grande, com mais de mil quartos enormes. No meio do hotel tem uma esp√©cie de vila, onde √© poss√≠vel tomar caf√©, jantar, assistir cinema e at√© mesmo jogar boliche! Nada faz muito sentido e √© muito extravagante. Uma experi√™ncia genuinamente americana.\nNa parte destinada a confer√™ncias, o espa√ßo √© realmente magn√≠fico. Com salas enormes e equipadas, √© um lugar bastante aconchegante para assistir palestra, conhecer pessoas e fazer networking.\n\rOs BRs\rParece que existe um √≠m√£ que junta os brasileiros na confer√™ncia. No in√≠cio, ach√°vamos que ser√≠amos s√≥ Julio Trecenti, Beatriz Milz, Fl√°via Rius e Daniel Falbel no rol√™. Depois, conhecemos Cristiana, Gabriela, que trabalham no Nic.br. Depois encontramos Ricardo Primi que √© professor mas foi aluno da Curso-R e sua esposa Tatiana. Depois, encontramos Adriana e Carlos, que trabalha na RStudio e a gente nem sabia. Por √∫ltimo, conhecemos a Ana Carla, que trabalha nos EUA.\n\rRefei√ß√µes com Hadley\rNo segundo dia dos workshops (26/07) sentamos com nossas novas amigas BR, Cristiana e Gabriela, para trocar ideia. Em seguida, sentou o Immanuel, um pesquisador muito legal que mora na California e trabalha com educa√ß√£o em ci√™ncia de dados.\nE de repente, senta na nossa mesa o pr√≥prio Hadley, nosso deuso do R. Foi muito interessante, porque acho que ele queria fugir dos c√≠rculos das pessoas mais famosas, e tamb√©m um pouco de assuntos relacionados a R.\nN√£o vou detalhar muito sobre as conversas para manter a privacidade de todos, mas foi uma experi√™ncia muito legal e muito leve. Falamos de muitos assuntos, sendo que poucos eram de fato relacionados ao R.\nPor algum motivo, o Hadley decidiu sentar com a gente novamente! No dia seguinte, almo√ßamos com ele, logo depois que ele fez o an√∫ncio da mudan√ßa de nome da empresa. Acho que ele gosta dos BR. Almo√ßamos com ele e com o Christoph Dervieux, um dos autores do blogdown e outros pacotes relacionados a RMarkdown.\nDepois de duas refei√ß√µes, nos sentimos no direito de tirar uma foto‚Ä¶ E est√° aqui!!\nThankfully Julio asked for a picture, otherwise no one would believe that we had lunch with @hadleywickham and @chrisderv üòÑ @jtrecenti @flaviaerius @rprimi e @anakiki1505 ! #rstudioconf2022 #RStudioConf #posit @rstudio #RStats pic.twitter.com/R8jAOyfUxd\r‚Äî Beatriz Milz (@BeaMilz) July 27, 2022\r\r\r\rKeynote 0: mudan√ßa de nome\rDepois da musiquinha de entrada (que, por sinal, estava com volume muito alto) entra o querid√≠ssimo Hadley Wickham para abrir o evento. Depois de suas falas iniciais, JJ Allaire, CEO da RStudio come√ßa sua apresenta√ß√£o.\nA apresenta√ß√£o dos dois gira em torno da evolu√ß√£o da RStudio de uma empresa que produzia uma IDE para R para uma empresa que tinha como miss√£o facilitar a vida de pessoas que trabalhavam com ci√™ncia de dados. Com o passar do tempo, a empresa foi criando ferramentas mais interoper√°veis, possibilidade de lidar com v√°rias linguagens e um esquema unificado para cria√ß√£o de documentos cient√≠ficos, o Quarto.\nCom isso, pelo que disseram, a RStudio passou a sentir cada vez mais que o nome da empresa j√° n√£o representava suas a√ß√µes, j√° que todos os produtos (Connect, Package Manager etc) levam consigo a ideia de que s√£o feitos para o R, o que n√£o √© verdade. Por isso, a empresa precisou mudar de nome.\nAgora, RStudio √© Posit. O site ainda n√£o est√° no ar, mas eles fizeram uma p√°gina para falar da mudan√ßa. A empresa mudar√° o nome totalmente em outubro/2022. Ou seja, essa foi a √∫ltima rstudio::conf, e a pr√≥xima ser√°‚Ä¶ from posit import conf?\n\rKeynote 1: tidymodels 1.0.0\rA apresenta√ß√£o de Max Kuhn e Julia Silge foi √∫til para mostrar como que o pacote tidymodels resolve tr√™s problemas importantes na modelagem preditiva (supervisionada): ergonomia, efetividade e seguran√ßa. Foram apresentados os detalhes de design de pacotes do tidymodels como recipes, tune, workflows, parsnip, dials, yardstick etc. A parte mais importante foi que o tidymodels est√° oficialmente na vers√£o 1.0.0, o que significa que pode ser considerado est√°vel e, portanto, utiliz√°vel para ambientes em produ√ß√£o. O pacote vetiver tamb√©m foi anunciado, mas sem muitos detalhes de como funciona.\n\rBloco tidymodels\r\rcensored: Pacote para integrar an√°lise de sobreviv√™ncia e tidymodels. Eu gostei, mas fiquei com um gostinho de ‚Äúquero mais‚Äù, j√° que o pacote ainda n√£o permite utiliza√ß√£o em workflows, ou seja, ainda n√£o d√° para tunar hiperpar√¢metros.\rtidyclust: Pacote para imitar a an√°lise de cluster no framework do tidymodels. O autor teve de basicamente reescrever toda a estrutura do tidymodels ‚Äì focada em modelos supervisionados ‚Äì para o problema do cluster. Por enquanto est√° bem no in√≠cio, e s√≥ funciona com o kmeans. Eu achei conceitualmente interessante, mas na pr√°tica n√£o sei se a ideia vai pegar ou n√£o (tomara que sim!).\rvetiver: trata-se de uma ferramenta com bastante hype criada pela RStudio para fazer deploy de modelos ajustados com tidymodels e scikit-learn. A ferramenta possui solu√ß√µes para tr√™s problemas: versionamento de modelos (usando o pacote pins), cria√ß√£o de APIs (usando o pacote plumber) e monitoramento (usando os dois pacotes anteriores). O legal √© que a ferramenta pretende ser agn√≥stica ao ambiente utilizado para ajuste do modelo. Vamos ver como funciona na pr√°tica!\r\r\rBloco fluxos de an√°lise\r\rData pipelines: em uma palestra muito bem humorada, Meghan Harris comentou como foi sua experi√™ncia trabalhando como √∫nica cientista de dados em uma empresa relacionada √† √°rea m√©dica. As quatro mensagens principais foram: estudo do problema, documenta√ß√£o, testes e sustentabilidade. Nenhuma ferramenta nova aqui.\rGarbage in, garbage out: em uma palestra ainda mais bem humorada, Jim Kloet comentou sobre dados que n√£o s√£o √∫teis para determidados problemas. Apresentou pr√°ticas para identificar essas bases e lidar com elas. Por trabalhar com faxina de dados, achei a palestra bastante familiar e divertida. Tamb√©m, nenhuma ferramenta nova aqui.\rProject Immortality: para mim, foi a palestra mais √∫til do dia. Aprendi que em pacotes de dados que s√£o atualizados periodicamente, pode ser interessante armazenar dados em Releases ao inv√©s de dados na pasta /data do pacote. Isso torna o pacote bem mais leve e f√°cil de manter. Um pacote novo usado para escrever releases que pretendo estudar √© o piggyback.\rLogging: Essa palestra foi √∫til para conhecer o pacote loggit para guardar os logs de execu√ß√£o de tarefas.\r\r\rBloco Banco de dados\r\rQuery optimization: A palestrante apresentou alguns exemplos de como algumas mudan√ßas b√°sicas nas queries poderiam ajudar a reduzir dramaticamente o tempo de execu√ß√£o. Dentre outros detalhes, ela apresentou uma ferramenta bastante √∫til do SQL, chamada EXPLAIN, utilizada para estimar o tempo de execu√ß√£o da query que foi constru√≠da.\rPacote dm: A palestra do Kirill Miller foi bastante dif√≠cil de entender (tanto pela densidade do tema quanto pela minha dificuldade em entender o ingl√™s do palestrante), mas acho que consegui entender alguns conceitos do pacote. √â uma forma de conseguir representar, dentro do R, a estrutura relacional de um banco de dados, contendo as chaves prim√°rias e chaves estrangeiras, al√©m de ferramentas para melhorar a documenta√ß√£o.\rPacote dbcooper: Essa foi a segunda palestra mais √∫til do dia! O pacote dbcooper, do David Robinson, tem apenas uma fun√ß√£o, que transforma uma conex√£o de banco de dados em fun√ß√µes especializadas para ler cada uma das tabelas daquela base. Por exemplo, se voc√™ tem uma base relacional da receita federal, o dbcooper criar√° fun√ß√µes para pegar os dados de todas as tabelas da base, como estabelecimentos, socios, empresas, entre outros.\r\r\rKeynote: shiny para Python\rPara finalizar as palestras do primeiro dia, tivemos a keynote do Joe Cheng, sobre o passado e o futuro do shiny. O shiny est√° completando 10 anos de hist√≥ria, e o Joe Cheng apresentou um pouco de como ele surgiu, em uma fala super pessoal e emocionante.\nUma parte muito comovente foi ver ele contar que estava quase saindo da RStudio (naquele momento, eram somente ele e o JJ na empresa), quando numa bela manh√£ o ambiente do shiny simplesmente apareceu na cabe√ßa dele. √â muito interessante saber que essa ferramenta ‚Äì que √© uma parte important√≠ssima da carreira de muitas pessoas que trabalham com ci√™ncia de dados ‚Äì poderia nunca ter acontecudo.\nEm seguida, Joe argumentou os motivos pelos quais o R era muito adequado para o desenvolvimento do shiny. O primeiro √© que as pessoas de fato passaram usar o pacote e aprender como funcionam ferramentas web. O segundo √© a comunidade R, que foi muito receptiva ao pacote, criando diversas extens√µes. O terceiro √© mais t√©cnico: o R era extremamente adaptado para o ambiente criado pelo shiny.\nPara finalizar, foi apresentado como ser√° o shiny para python. A ideia √© escrever um pacote que pare√ßa natural para pessoas do python, n√£o uma adapta√ß√£o do pacote em R. A biblioteca ainda est√° em formato alpha, ent√£o pode mudar bastante.\n\rQuer saber mais?\rBom, essas foram minhas anota√ß√µes do dia 01 da rstudio::conf(2022). Todas as palestras ficar√£o online neste link. No futuro, eu e a Beatriz faremos mais posts sobre o tema!\n\r","permalink":"https://blog.curso-r.com/posts/2022-07-27-rstudio-conf-2022/","tags":["evento","rstudio::conf"],"title":"rstudio::conf 2022, primeiro dia de palestras"},{"author":["Caio"],"categories":["tutoriais"],"contents":"\rUma das melhores funcionalidades do RStudio √©, sem sombra de d√∫vidas, o\rRStudio Server.\rPara ser mais preciso, ele √© a melhor vers√£o do RStudio; esse produto √©, na\rverdade, uma integra√ß√£o entre a IDE RStudio e um programa de acesso remoto.\nDe forma bem resumida, ao instalar o RStudio Server em um servidor, voc√™ nunca\rmais precisa se preocupar com SSH. Todo o acesso ao servidor passa a ser atrav√©s\rde uma interface web que √© id√™ntica ao RStudio normal, o que significa que voc√™\rpode programar usando os recursos do seu servidor, mas com a mesm√≠ssima IDE que\rvoc√™ j√° usa no dia-a-dia.\nMesmo depois que eu passei a\rusar o VS Code para\rprogramar R no meu computador, eu continuei usando o RStudio Server no servidor\rda empresa. M√™s passado, entretanto, eu descobri uma funcionalidade incr√≠vel do\rVS Code que me permitiu abandonar de uma vez por todas o RStudio: o\rVS Code Remote Development.\nDiferentemente do RStudio Server, o Remote Development n√£o √© instalado no\rservidor, mas sim no seu computador. Essa ferramenta usa SSH por tr√°s dos panos\rpara trazer todos os arquivos do servidor at√© o seu VS Code local e, quando voc√™\rexecuta algum comando, ela faz o caminho reverso para rodar o c√≥digo no\rservidor.\nIsso n√£o √© nada novo! Todo mundo que j√° usou SSH alguma vez na vida e precisou\rabrir um editor de texto remoto (vim ou nano), provavelmente n√£o vai\restranhar o modo como o Remote Development funciona. A √∫nica diferen√ßa √© que o\rRD traz o c√≥digo at√© o VS Code e n√£o at√© o seu terminal.\nH√° vantagens e desvantagens nessa abordagem: por um lado, o servidor n√£o vai\rprecisar gastar recursos renderizando a interface do RStudio Server, mas por\routro, n√£o tem um jeito muito simples de passar o seu acesso para outra pessoa\r(dado que n√£o √© s√≥ um site que voc√™ acessa de qualquer lugar). A melhor solu√ß√£o\r√© sempre a que se encaixa melhor no seu fluxo de trabalho.\nO processo para configurar o RD √© bastante simples e pode ser encontrado\rinteiramente na p√°gina\rdo Remote development via SSH. Em resumo, voc√™ precisa instalar a extens√£o,\rconectar com o seu servidor via SSH e configurar as suas extens√µes para o\rambiente remoto.\nO passo mais complexo √© o √∫ltimo, mas mesmo ele √© at√© que bastante intuitivo. Na\r√©poca eu tive dificuldade de entender que as minhas extens√µes n√£o funcionavam no\rmodo remoto porque eu precisava instal√°-las de novo! Essencialmente, eu\rprecisava configurar a extens√£o do R para funcionar com os programas do servidor\re n√£o mais os da minha m√°quina.\nE isso √© tudo! Espero que este post tenha sido √∫til para apresentar uma\rfuncionalidade muito legal da IDE que eu tenho usado todos os dias pelos √∫ltimos\rmeses. At√© a pr√≥xima :)\nP.S.: Al√©m da solu√ß√£o que eu apresentei, h√° ainda duas outras: o\rRStudio Workbench (um produto\rpago da RStudio) passou a\rpermitir\ro uso da interface do VS Code e, recentemente, a Microsoft anunciou o\rVS Code Server,\rque eu ainda n√£o tive oportunidade de testar.\n","permalink":"https://blog.curso-r.com/posts/2022-07-15-vscode-server/","tags":["rstudio","vscode"],"title":"Acesso Remoto ao VS Code"},{"author":["Tereza"],"categories":["tutoriais"],"contents":"\r\rOl√°! Quem me conhece sabe que sou um pouco viciada em m√∫sica, e no contexto do R n√£o poderia ser diferente! hahaha\nFaz um tempo que venho mexendo com a API do Spotify no R. Primeiro comecei com o pacote Rspotify, e depois conheci o spotifyr (e foi a√≠ que surtei de vez, descobri que d√° pra fazer absolutamente tudo de dentro do R: criar playlists, adicionar m√∫sicas em playlists, ver quais foram as minhas √∫ltimas m√∫sicas escutadas, e tudo mais que voc√™ imaginar)\nComo o acesso a esses pacotes n√£o √© nada trivial, resolvi escrever esse post pra mostrar de uma vez por todas como isso √© feito (eu sofri bastante na √©poca que comecei a mexer com eles). Vou mostrar como obter os tokens de acesso do Spotify, e falar um pouco sobre as fun√ß√µes do Rspotify tamb√©m.\nNesse post vou focar s√≥ nas fun√ß√µes do Rspotify (por serem mais simples), mas pretendo fazer um post dedicado para o spotifyr mais pra frente.\nObtendo os tokens de acesso do Spotify\rPrimeiro, instale o pacote Rspotify atrav√©s do comando\ninstall.packages(\u0026quot;Rspotify\u0026quot;)\rAgora, carregue o pacote\nlibrary(Rspotify)\rNote que todas as fun√ß√µes do Rspotify exigem o argumento token.\nPara obter esse token, siga os seguintes passos:\n(obs: estou assumindo que voc√™ possui uma conta no Spotify. N√£o precisa ser premium, ent√£o caso n√£o possua ainda, √© s√≥ criar uma)\n1 - Entre nesse link\nVoc√™ ser√° redirecionado para essa p√°gina:\n2 - Clique em Log in e fa√ßa o login com a sua conta do Spotify\n3 - Agora, clique em Create an app\n4 - D√™ um nome e uma descri√ß√£o para o seu app, assinale a caixinha de Termos de Uso, e ent√£o, clique em Create\n5 - Depois de criar o app, voc√™ ser√° redirecionado para essa tela. Clique em edit settings\n6 - Preencha o campo Redirect URIs com ‚Äúhttp://localhost:1410/‚Äù (sem as aspas), e clique em Add\nA tela deve ficar assim:\n7 - Agora, role at√© o final da p√°gina e clique em Save\n8 - Clique no bot√£o Show client secret\nVeja que na tela est√£o o Client ID e o Client Secret. S√£o esse dois tokens que usaremos para ter acesso √†s fun√ß√µes do Rspotify.\nAgora, com o R aberto e o pacote Rspotify carregado, rode o seguinte c√≥digo, substituindo o segundo e terceito argumentos pelos tokens Client ID e Client Secret, respectivamente:\nkeys \u0026lt;- spotifyOAuth(\u0026quot;nome_qualquer_aqui\u0026quot;,\r\u0026quot;cole_aqui_seu_client_id\u0026quot;,\r\u0026quot;cole_aqui_seu_client_secret\u0026quot;)\r(obs: os tr√™s argumentos da fun√ß√£o s√£o do tipo character, ent√£o devem estar entre aspas; o primeiro argumento √© livre)\nVoc√™ ser√° redirecionado para uma p√°gina de autoriza√ß√£o do Spotify no seu navegador. Clique em Aceito e volte para o R.\nPronto! Agora √© s√≥ usar as fun√ß√µes do Rspotify, usando token = keys como argumento em todas elas.\n\rConhecendo as fun√ß√µes do Rspotify\rO funcionamento das fun√ß√µes est√° explicado na documenta√ß√£o do pacote, ent√£o vou mostrar s√≥ alguns exemplos, sem me preocupar em explicar cada fun√ß√£o detalhadamente.\nPara os exemplos, vou usar m√∫sicas e bandas brasileiras que gosto, ent√£o j√° fica a√≠ a recomenda√ß√£o pra quem quiser! hahaha\nsearchArtist\rA fun√ß√£o searchArtist pede como argumentos o nome do artista/banda, e o token (aquele que acabamos de obter). Ela retorna um data frame no qual cada linha √© referente a um artista (relacionado com a busca feita). O id do artista √© especialmente importante, pois algumas fun√ß√µes desse pacote exigem o id como argumento, como veremos em seguida.\nsearchArtist(\u0026quot;O Grilo\u0026quot;, token = keys)\r\r\rartist\r\rid\r\rpopularity\r\rfollowers\r\rgenres\r\rtype\r\r\r\r\r\rO Grilo\r\r22KEpOwThQ5q1DGochfayO\r\r49\r\r74930\r\rrock alternativo brasileiro\r\rartist\r\r\r\rBanda Cumade Selvira \u0026amp; Os Cantiga de Grilo\r\r504zftG42qkU6Gzw8Ai3mC\r\r0\r\r15\r\r\rartist\r\r\r\rkamaitachi\r\r1ISc8zhrqxd5WrJMkMMLSm\r\r61\r\r1031552\r\rmusica triste brasileira\r\rartist\r\r\r\rO Grito\r\r0CzL84J7lB5sWycref43lN\r\r1\r\r291\r\r\rartist\r\r\r\rGrilo\r\r2s1cOPGtfbCeYvxibRHtew\r\r1\r\r39\r\r\rartist\r\r\r\rO Gringo Sou Eu\r\r7Da1dXVGp2bjqkVTKQ4W7L\r\r1\r\r52\r\r\rartist\r\r\r\rEl Grilo Ensamble Vocal\r\r2NHB6zVcmBv8034ZNpBkzU\r\r2\r\r295\r\r\rartist\r\r\r\rO. Grimm\r\r59SQwI32qROXuzlHTu7RS8\r\r1\r\r1\r\r\rartist\r\r\r\rO. Grinbergs\r\r2E2MSLcsX2lYOTVMr2DKcq\r\r1\r\r668\r\r\rartist\r\r\r\r\r\rgetRelated\rA fun√ß√£o getRelated pede como argumentos o nome do artista/banda, e o token. Ela retorna algumas informa√ß√µes sobre os artistas relacionados com o artista especificado.\ngetRelated(\u0026quot;O Grilo\u0026quot;, token = keys)\r\r\rname\r\rid\r\rpopularity\r\rtype\r\rfollowers\r\r\r\r\r\rWalfredo em Busca da Simbiose\r\r6PzQC3kTcWcJcH8p4d7yJl\r\r29\r\rartist\r\r8842\r\r\r\rAbacaxepa\r\r37YBTVhchsMr6ekdUHEKRy\r\r40\r\rartist\r\r15088\r\r\r\rDaparte\r\r6D5hUhZncLiNMeE3gq9BhL\r\r41\r\rartist\r\r17384\r\r\r\rLupa\r\r7yct0AdXUgrHi83xwSt902\r\r30\r\rartist\r\r7405\r\r\r\rNanasai\r\r67PBrqP0nECUumF2AQ8G6S\r\r36\r\rartist\r\r25626\r\r\r\rSelvagens √† Procura de Lei\r\r093ybF4c81CndQe6qWtc8S\r\r42\r\rartist\r\r125164\r\r\r\rScatolove\r\r0icMce3ZQU1HdA8gGHo5Rg\r\r37\r\rartist\r\r88050\r\r\r\rCidade Dormit√≥rio\r\r3hnNIsiWatVyHen6mz79sf\r\r32\r\rartist\r\r30869\r\r\r\rTerno Rei\r\r7c8kQb9AUntvapfnuC3IhF\r\r50\r\rartist\r\r89239\r\r\r\rZimbra\r\r11xX6bMCvpstEFOyx8lxYg\r\r43\r\rartist\r\r111790\r\r\r\r\r\rgetArtist\rEssa fun√ß√£o pede como argumentos o id do artista, e o token. Ela retorna algumas informa√ß√µes sobre esse artista. No caso, estou usando o id da banda O Grilo, que foi obtido acima.\ngetArtist(\u0026quot;22KEpOwThQ5q1DGochfayO\u0026quot;, token = keys)\r\r\rname\r\rid\r\rpopularity\r\rfollowers\r\rgenres\r\r\r\r\r\rO Grilo\r\r22KEpOwThQ5q1DGochfayO\r\r49\r\r74930\r\rrock alternativo brasileiro\r\r\r\r\r\rgetTopTracks\rEssa fun√ß√£o pede como argumentos o id do artista, a especifica√ß√£o de um pa√≠s, e o token. Ela retorna as m√∫sicas mais populares daquele artista no pa√≠s em quest√£o (e algumas informa√ß√µes sobre elas)\ngetTopTracks(\u0026quot;22KEpOwThQ5q1DGochfayO\u0026quot;, country = \u0026quot;BR\u0026quot;, token = keys)\r\r\rartist_id\r\rname\r\rpopularity\r\rduration_ms\r\rtrack_number\r\ravailable_markets\r\r\r\r\r\r2DllnWTQNjh5NDN1A2ZtnH\r\rSerenata Existencialista\r\r62\r\r163209\r\r5\r\r\r\r\r61keC2MVAbhqm3RoAVSfI6\r\rSambinha\r\r50\r\r180202\r\r3\r\r\r\r\r43MdgqLdKQJl1Azdq0Shpc\r\rTrela\r\r49\r\r187482\r\r1\r\r\r\r\r6btBKvH1OlMbwW9lU1RGIo\r\rHer√≥i do Futuro\r\r47\r\r232373\r\r1\r\r\r\r\r2JNXbqa8e0aQ7Trert8N8D\r\rMeu Amor\r\r47\r\r193440\r\r8\r\r\r\r\r6zHoaw5RcWAcaWCSDzKdlj\r\rPra Voc√™ Gostar de Mim\r\r46\r\r184799\r\r1\r\r\r\r\r6aEQ365jPX55xfpA8OFfki\r\rOnde Flor\r\r44\r\r192546\r\r12\r\r\r\r\r2682XIBY8wcjL9UJ9voUa8\r\rContram√£o\r\r44\r\r172623\r\r3\r\r\r\r\r4aEDdWboWAKt5UYIFWqRwf\r\rIn√™s\r\r43\r\r173880\r\r4\r\r\r\r\r5ayHgfHVet0M47OC4kTrTK\r\rTira a Roupa\r\r43\r\r191899\r\r1\r\r\r\r\r\r\rgetAlbums\rA fun√ß√£o getAlbums pede como argumentos o id do artista/banda, e o token. Ela retorna um data frame no qual cada linha √© referente a um album do artista/banda. O id de cada √°lbum tamb√©m √© importante caso queira obter mais informa√ß√µes sobre o √°lbum.\ngetAlbums(\u0026quot;22KEpOwThQ5q1DGochfayO\u0026quot;, token = keys)\r\r\rid\r\rname\r\ralbum_type\r\ravailable_markets\r\r\r\r\r\r0I7bofr4iucY3LXUPKv9cz\r\rVoc√™ N√£o Sabe de Nada\r\ralbum\r\r\r\r\r\r\rgetAlbumInfo\rEssa fun√ß√£o pede como argumentos o id do √°lbum, e o token. Ela retorna algumas informa√ß√µes sobre o √°lbum.\ngetAlbumInfo(\u0026quot;0I7bofr4iucY3LXUPKv9cz\u0026quot;, token = keys)\r\r\rid\r\rartist\r\rname\r\rlabel\r\rpopularity\r\rrelease_date\r\ralbum_type\r\rtrack_total\r\r\r\r\r\r0I7bofr4iucY3LXUPKv9cz\r\rO Grilo\r\rVoc√™ N√£o Sabe de Nada\r\rRockambole\r\r43\r\r2021-03-26\r\ralbum\r\r13\r\r\r\r\r\rgetAlbum\rEssa fun√ß√£o pede como argumentos o id do √°lbum, e o token. Ela retorna informa√ß√µes sobre cada m√∫sica do √°lbum.\ngetAlbum(\u0026quot;0I7bofr4iucY3LXUPKv9cz\u0026quot;, token = keys)\r\r\rid\r\rname\r\rduration_ms\r\rtrack_number\r\rdisc_number\r\ravailable_markets\r\rpreview_url\r\r\r\r\r\r43MdgqLdKQJl1Azdq0Shpc\r\rTrela\r\r187482\r\r1\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/7fecbb599cb7f86dfd86f2f145ce9b1979a49d70?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r7fT4wCxnKI1FFb0QnQ4nX3\r\rGuitarrada\r\r154912\r\r2\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/c8ed5a257adac75a8fd7ef00202867baf71968cc?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r2682XIBY8wcjL9UJ9voUa8\r\rContram√£o\r\r172623\r\r3\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/0156d027e420d79acb24faa0775547cd2f779eb8?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r2XXBtwtgdfQ3rGvgweteRF\r\rTudo e Mais um Pouco\r\r166390\r\r4\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/ef9a1f304dc853504e2867fb31c3a0acc114a232?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r5Vjhpp2vftIrYk3Fija7j7\r\rMeu Pior Amigo\r\r217737\r\r5\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/4b6d85f4de13e716ea1f9983aec5e349c777e737?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r6tjsjuI6eZX1XpwrehfRRg\r\rInfinito (-1)\r\r204792\r\r6\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/46ee8ed72fdb8372b8d37ad206f4cf5b34ebd80e?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r6yPZTaETPJ6Juy00huOb55\r\rVoc√™ N√£o Sabe de Nada\r\r99378\r\r7\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/eac1f0862b5aa377cba6831398fba9cdbbf7e517?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r2JNXbqa8e0aQ7Trert8N8D\r\rMeu Amor\r\r193440\r\r8\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/85df60a314644d579019ab11cd1d8574d9996a24?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r4KC49pnwukN8SVse2tzi7L\r\rVou Levar\r\r198197\r\r9\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/699e8e652d0c1bac360eb256940e48b491565f14?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r1BcrtC8bB8D0Dj0waoD6uy\r\re da√≠, eu sei l√° ¬Ø_(\u0026lt;U+30C4\u0026gt;)/¬Ø\r\r46566\r\r10\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/0c9b9c2db58981d27e6afb7c547e76ac64ae7d17?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r6e3BWdeIaXTt0mOkzKKHVA\r\rAdeus\r\r262198\r\r11\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/9d9995ab4e0bdee69a1031f49497db5d6f9b3fce?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r6aEQ365jPX55xfpA8OFfki\r\rOnde Flor\r\r192546\r\r12\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/d80e37677128ab1e0392904a241458e33036951f?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r70Sw1EWhOn9TUkUAAAFWAE\r\rMalabarista de Granadas - Bonus Track\r\r176032\r\r13\r\r1\r\rAD, AE, AG, AL, AM, AO, AR, AT, AU, AZ, BA, BB, BD, BE, BF, BG, BH, BI, BJ, BN, BO, BR, BS, BT, BW, BY, BZ, CA, CD, CG, CH, CI, CL, CM, CO, CR, CV, CW, CY, CZ, DE, DJ, DK, DM, DO, DZ, EC, EE, EG, ES, FI, FJ, FM, FR, GA, GB, GD, GE, GH, GM, GN, GQ, GR, GT, GW, GY, HK, HN, HR, HT, HU, ID, IE, IL, IN, IQ, IS, IT, JM, JO, JP, KE, KG, KH, KI, KM, KN, KR, KW, KZ, LA, LB, LC, LI, LK, LR, LS, LT, LU, LV, LY, MA, MC, MD, ME, MG, MH, MK, ML, MN, MO, MR, MT, MU, MV, MW, MX, MY, MZ, NA, NE, NG, NI, NL, NO, NP, NR, NZ, OM, PA, PE, PG, PH, PK, PL, PS, PT, PW, PY, QA, RO, RS, RW, SA, SB, SC, SE, SG, SI, SK, SL, SM, SN, SR, ST, SV, SZ, TD, TG, TH, TJ, TL, TN, TO, TR, TT, TV, TW, TZ, UA, UG, US, UY, UZ, VC, VE, VN, VU, WS, XK, ZA, ZM, ZW\r\rhttps://p.scdn.co/mp3-preview/a3ba0939a9d55cc315c459cfdf875873a43f50da?cid=d31252a2880546b3ba640d5d64b7e652\r\r\r\r\r\rsearchPlaylist\rA fun√ß√£o searchPlaylist pede como argumentos o nome de uma playlist, e o token. Ela retorna um data frame no qual cada linha √© referente a uma playlist (relacionada com a busca feita). Assim como os outros casos, o id da playlist tamb√©m √© importante caso queira obter mais informa√ß√µes sobre ela.\nNo caso, vamos procurar a playlist ‚ÄúUma M√∫sica Por Dia‚Äù, que √© uma playlist que atualizo diariamente. (obs: meu id de usu√°rio no spotify √© ‚Äútherezzza‚Äù)\nsearchPlaylist(\u0026quot;Uma M√∫sica Por Dia\u0026quot;, token = keys)\r\r\rid\r\rname\r\rtracks\r\rowner\r\r\r\r\r\r3buJd0YAjAM0kuPnrQMFJ7\r\rUma M√∫sica por Dia\r\r731\r\rallanclaudino\r\r\r\r4faz4FVeL328piox0lz7UF\r\rUma M√∫sica Por Dia\r\r179\r\rtherezzza\r\r\r\r575JlxqDooZLZGVQyPO5QV\r\rM√∫sicas para dormir, louvar, orar e devocional \u0026lt;U+0001F64F\u0026gt;\u0026lt;U+0001F3FB\u0026gt;\u0026lt;U+2728\u0026gt;\u0026lt;U+2764\u0026gt;\u0026lt;U+FE0F\u0026gt;#1\r\r147\r\r31slnxm43mhcf6lle5nqucq2inha\r\r\r\r26ZQg5BBS4cSgCQpskRaiO\r\rUma m√∫sica por dia\r\r47\r\roliveiraarnon\r\r\r\r2OCnbwpAiu1j0i2tWUj3w2\r\rUma m√∫sica por dia\r\r288\r\r1193062474\r\r\r\r2sC8NL6bwlecjjtHokZYns\r\rTodo dia uma m√∫sica em 2022\r\r179\r\r2c71zh1ergjwcfdilvypipwlx\r\r\r\r2BX2mKiEzgtAcbcwLR89iD\r\ruma m√∫sica por dia\r\r21\r\rnvymfjifcztrj905o6epne2at\r\r\r\r1sqHtyK0w3zZ5POn6ZayAE\r\rUma Musica Boa por Dia\r\r591\r\rthiagogsimonetti\r\r\r\r0B5jPflKKB2xxpOA9nlGYH\r\rUma m√∫sica por dia\r\r90\r\r31lkfpkfdkhaci2644cbwlokaspe\r\r\r\r0Wlh0n3NR4sDwWu1xqMemG\r\ruma m√∫sica por dia\r\r51\r\r12167607547\r\r\r\r\rVeja que a playlist que eu queria encontrar est√° na segunda linha do data frame, vou us√°-la na pr√≥xima fun√ß√£o!\n\rgetPlaylistSongs\rEssa fun√ß√£o pede como argumentos o id do usu√°rio, o id da playlist e o token, e retorna um data frame com as m√∫sicas da playlist (e algumas informa√ß√µes adicionais sobre elas)\ngetPlaylistSongs(\u0026quot;therezzza\u0026quot;, \u0026quot;4faz4FVeL328piox0lz7UF\u0026quot;, token = keys)\r\r\rtracks\r\rid\r\rpopularity\r\rartist\r\rartist_full\r\rartist_id\r\ralbum\r\ralbum_id\r\r\r\r\r\rPor Supuesto\r\r7xVSNhAUQhUIpwfR6lTOwA\r\r72\r\rMarina Sena\r\rMarina Sena\r\r0nFdWpwl7h6fp3ADRyG14L\r\rDe Primeira\r\r6bN5oG5wKJJqO0j7OhXVNt\r\r\r\rMetamorfose Ambulante\r\r2Yk0HvfTaijA47aM0Fj88u\r\r62\r\rRaul Seixas\r\rRaul Seixas\r\r7jrRQZg4FZq6dwpi3baKcu\r\r‚ÄúKrig-Ha, Bandolo‚Äù\r\r2xRddGxRH0KdDWLNE5b0iu\r\r\r\rPolice Station\r\r6DfWymHzCYOH2ABUuHFaMe\r\r51\r\rRed Hot Chili Peppers\r\rRed Hot Chili Peppers\r\r0L8ExT028jH3ddEcZwqJJ5\r\rI‚Äôm with You\r\r5wZtSIvijWCMc1vlPFqAyB\r\r\r\rTremores\r\r5cCFZeltndzRmZ5cjtQdXs\r\r16\r\rLau e Eu\r\rLau e Eu\r\r2gh3qTCBKZ5LwVj5zQha9e\r\rSelma\r\r0u3OZX362nmVG918dwDUK1\r\r\r\rE.C.T.\r\r4Wt9zi9hvsgiUACRmoN9Ak\r\r40\r\rC√°ssia Eller\r\rC√°ssia Eller\r\r10naVTwNjE50daQVrN0bXh\r\rC√°ssia Eller (1994)\r\r3JGRDTWHXpXNfoAPglI7Tr\r\r\r\rBote\r\r1ZNV4geiDow8Wks8sKDQCc\r\r56\r\rJulio Secchin\r\rJulio Secchin\r\r0B0FipO3fLbLbHQz5RfTUs\r\rBote\r\r5IJwNADxj5Kew8Yjdq7psH\r\r\r\rEnemy - From the series Arcane League of Legends\r\r5UlnuulVAVmmesw4VzqHdG\r\r82\r\rImagine Dragons\r\rImagine Dragons feat. Arcane feat. League of Legends\r\r53XhwfbYqKCa1cC15pYq2q\r\rEnemy (from the series Arcane League of Legends)\r\r2Y9Kal9IDz6JphsCfY6GzG\r\r\r\r6h 34\r\r2gNPwfmBZMo2xzZFFPIt8P\r\r39\r\rVisconde\r\rVisconde\r\r0ScxxqjnVMeXYqPl5AavFd\r\rVisconde\r\r6XiK7cPd6XqlyiPN7NjTJO\r\r\r\rSinusite\r\r1rEOoUHBbnmPnlFS4p5P9t\r\r40\r\rRodrigo Alarcon\r\rRodrigo Alarcon\r\r6D3gtdoxrtRGO9ZDU5wWSQ\r\rParte\r\r1Q8UuqiYlAHTmkLlpVdACL\r\r\r\rNossa Bossa\r\r2YynWd3NpoQC6NId0HPTeq\r\r30\r\rO Cinza\r\rO Cinza\r\r2hhRYX2Zdh4jrvMLghsqGX\r\rO Lugar Onde Envelhecemos\r\r3CBTykgeyVSdjc4zm7Mra6\r\r\r\r\r\rsearchTrack\rA fun√ß√£o searchTrack pede como argumentos o nome de uma m√∫sica (funciona como a busca do Spotify mesmo), e o token. Ela retorna um data frame no qual cada linha √© referente a uma m√∫sica (relacionada com a busca feita).\nNo exemplo, estou procurando a m√∫sica ‚ÄúGeminis‚Äù da Julia Mestre.\nsearchTrack(\u0026quot;Geminis Julia Mestre\u0026quot;, token = keys)\r\r\r\rdisplay_name\r\rid\r\rpopularity\r\rartists\r\rartists_IDs\r\rtype\r\r\r\r\r\r5\r\rAgora S√≥ Falta Voc√™\r\r5fGQXRu7c4gZ2lGO8zlL51\r\r45\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r1\r\rGeminis\r\r7w6IN6ebiY2AOQwZY50NOG\r\r33\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r10\r\rKIMBALA\r\r0tPTI9u5fsapoRRf5dc7xC\r\r28\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r8\r\rCores e Nomes\r\r3OxGALD40vE750AQ7SLGZr\r\r25\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r2\r\rMudar o Mundo\r\r5SDERPI78k0GcVov3vkrRn\r\r21\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r13\r\rel fuego del amor\r\r7w28YPENfQgVuqQxUeltL0\r\r18\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r4\r\rBatom\r\r0lVHrmfGdS2xoAkEKbEcCI\r\r13\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r12\r\rPapai Me Empresta o Carro\r\r3C1iarbfPZ2bhWUVPUilSc\r\r13\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r6\r\rCanto de Saudade\r\r1c39CBruWQ4EkY1npaNKwL\r\r11\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r7\r\rMedo de Mim\r\r1UaDO9pwz7pZsudleZhbHR\r\r11\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rtrack\r\r\r\r\r\rgetTrack\rEssa fun√ß√£o pede como argumentos o id da m√∫sica, e o token. Ela retorna algumas informa√ß√µes sobre a m√∫sica.\ngetTrack(\u0026quot;7w6IN6ebiY2AOQwZY50NOG\u0026quot;, token = keys)\r\r\rtrack_id\r\rname\r\rexplicit\r\rpopularity\r\rartists\r\rartists_id\r\ralbum\r\ralbum_id\r\r\r\r\r\r7w6IN6ebiY2AOQwZY50NOG\r\rGeminis\r\rFALSE\r\r33\r\rJulia Mestre\r\r1FnGKreDca8xq3juSi5hAE\r\rGEMINIS\r\r4y85scLBaZV25lBqLn0DC2\r\r\r\r\r\rgetFeatures\rEssa fun√ß√£o pede como argumentos o id da m√∫sica, e o token. Ela retorna algumas informa√ß√µes mais espec√≠ficas sobre a m√∫sica (e √© a parte que acho mais legal). Essa informa√ß√µes s√£o algumas ‚Äúm√©tricas‚Äù da m√∫sica, e d√° pra fazer muitas coisas legais com elas, como por exemplo, ordenar uma playlist pelas m√∫sicas mais dan√ßantes.\ngetFeatures(\u0026quot;7w6IN6ebiY2AOQwZY50NOG\u0026quot;, token = keys)\r\r\rid\r\rdanceability\r\renergy\r\rkey\r\rloudness\r\rmode\r\rspeechiness\r\racousticness\r\rinstrumentalness\r\rliveness\r\rvalence\r\rtempo\r\rduration_ms\r\rtime_signature\r\ruri\r\ranalysis_url\r\r\r\r\r\r7w6IN6ebiY2AOQwZY50NOG\r\r0.614\r\r0.29\r\r11\r\r-10.721\r\r0\r\r0.0418\r\r0.683\r\r8.5e-06\r\r0.115\r\r0.385\r\r148.273\r\r141867\r\r4\r\rspotify:track:7w6IN6ebiY2AOQwZY50NOG\r\rhttps://api.spotify.com/v1/audio-analysis/7w6IN6ebiY2AOQwZY50NOG\r\r\r\r\r\rgetUser\rEssa fun√ß√£o pede como argumentos o id de um usu√°rio, e o token. Ela retorna algumas informa√ß√µes sobre esse usu√°rio.\nNo caso, estou usando o id de uma conta minha no spotify, chamada ‚Äúguiadosmusiqueiros‚Äù, que tem playlists de recomenda√ß√µes mais bem organizadas :)\ngetUser(\u0026quot;bn5u195uotc5u95tfw24ct6uf\u0026quot;, token = keys)\r\r\rdisplay_name\r\rid\r\rfollowers\r\r\r\r\r\rguiadosmusiqueiros\r\rbn5u195uotc5u95tfw24ct6uf\r\r51\r\r\r\r\r\rgetPlaylists\rE por fim, a fun√ß√£o getPlaylists pede como argumentos o id de um usu√°rio e o token. Ela retorna informa√ß√µes sobre cada playlist desse usu√°rio!\ngetPlaylists(\u0026quot;bn5u195uotc5u95tfw24ct6uf\u0026quot;, token = keys)\r\r\rid\r\rname\r\rownerid\r\rtracks\r\r\r\r\r\r3KGktfVPwVBJGBnoCrUQK9\r\rGuia dos Musiqueiros\r\rbn5u195uotc5u95tfw24ct6uf\r\r42\r\r\r\r3RdNIPmldyUYDJvIyHk6oU\r\rDUDA BEAT\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r191YgBaCVYbTksKDhj2P4c\r\rLau e Eu\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r5ONYYUGvooOe8OoGIqICg2\r\rPLUMA\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r5kSoTjqYeRbYWDxJfGvyRU\r\rMarina Sena\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r54XmEFNjzqXRQULMRWSgEZ\r\rDer Baum\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r5ys3bqipFkmdqppTF8pZk4\r\rMariana Froes\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r0j3ZjUaasSzektT6nShKPz\r\rToco\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r7LUYIRlOPsqD1gJa9jX3do\r\rSeu Pereira e Coletivo 401\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r4I0EHR3LKqmZB9JUzSX0sn\r\rLetrux\r\rbn5u195uotc5u95tfw24ct6uf\r\r7\r\r\r\r\rPor hoje √© s√≥, pessoal! Espero que o tutorial tenha ficado claro :)\n\r\r","permalink":"https://blog.curso-r.com/posts/2022-06-28-rspotify/","tags":["tutoriais","spotify","m√∫sica"],"title":"Tudo sobre o pacote {Rspotify}"},{"author":["Beatriz","Tereza"],"categories":["tutoriais"],"contents":"\r\rIntrodu√ß√£o\rNeste post, listamos alguns lugares onde encontrar bases de dados interessantes para quem est√° aprendendo e quer praticar com novas bases, e tamb√©m para quem quer ensinar R e procura bases de dados para criar exemplos!\nO post ser√° separado em: bases em portugu√™s (sejam elas traduzidas ou originais), e em ingl√™s.\n\rBases de dados em Portugu√™s\rPacote dados\rO pacote est√° dispon√≠vel no CRAN e pode ser instalado utilizando o seguinte c√≥digo:\ninstall.packages(\u0026quot;dados\u0026quot;)\rEscrevemos um post recentemente focado neste pacote, ent√£o recomendamos checar l√°!\rPara acessar as bases de dados, utilize a fun√ß√£o library(dados) ou use com dados::nome_da_base.\rPor exemplo:\nlibrary(dados)\rdplyr::glimpse(dados::pixar_filmes)\r## Rows: 27\r## Columns: 5\r## $ ordem_lancamento \u0026lt;chr\u0026gt; \u0026quot;1\u0026quot;, \u0026quot;2\u0026quot;, \u0026quot;3\u0026quot;, \u0026quot;4\u0026quot;, \u0026quot;5\u0026quot;, \u0026quot;6\u0026quot;, \u0026quot;7\u0026quot;, \u0026quot;8\u0026quot;, \u0026quot;9\u0026quot;, ‚Ä¶\r## $ filme \u0026lt;chr\u0026gt; \u0026quot;Toy Story - Um Mundo de Aventuras\u0026quot;, \u0026quot;Vida de‚Ä¶\r## $ data_lancamento \u0026lt;date\u0026gt; 1995-11-22, 1998-11-25, 1999-11-24, 2001-11-‚Ä¶\r## $ duracao \u0026lt;dbl\u0026gt; 81, 95, 92, 92, 100, 115, 117, 111, 98, 96, 1‚Ä¶\r## $ classificacao_indicativa \u0026lt;chr\u0026gt; \u0026quot;Livre\u0026quot;, \u0026quot;Livre\u0026quot;, \u0026quot;Livre\u0026quot;, \u0026quot;Livre\u0026quot;, \u0026quot;Livre\u0026quot;, ‚Ä¶\r\rBase dos dados\rA Base dos Dados √© um projeto super interessante.\rL√°, s√£o disponibilizadas diversas bases p√∫blicas, e v√°rias delas j√° est√£o tratadas, como: Rela√ß√£o Anual de Informa√ß√µes Sociais (RAIS), √çndice de Desenvolvimento da Educa√ß√£o B√°sica (Ideb), Censo Demogr√°fico, entre outros!\nConsulte as bases tratadas neste link.\nOs dados s√£o disponibilizados em um BigQuery, portanto o acesso tem algumas etapas a mais.\rRecomendamos olhar os seguintes links:\n\rAcessando bases p√∫blicas em R: o pacote basedosdados\rLive da Curso-R - Unboxing do pacote basedosdados\rDocumenta√ß√£o do BD+\r\r\rPacote de bases usadas em cursos da Curso-R\rAlgumas bases de dados foram traduzidas por pessoas da Curso-R, e disponibilizadas nesse pacote para serem usadas nos cursos.\rEsse pacote n√£o est√° dispon√≠vel no CRAN, ent√£o caso queira instalar, utilize os seguintes comandos:\ninstall.packages(\u0026quot;devtools\u0026quot;)\rdevtools::install_github(\u0026quot;curso-r/basesCursoR\u0026quot;)\rPara verificar quais s√£o as bases dispon√≠veis no pacote, utilize a seguinte fun√ß√£o: basesCursoR::bases_disponiveis().\nbasesCursoR::bases_disponiveis()\r## [1] \u0026quot;adult\u0026quot; \u0026quot;airbnb_rj\u0026quot; \u0026quot;ames\u0026quot; \u0026quot;cetesb\u0026quot; ## [5] \u0026quot;covid\u0026quot; \u0026quot;credito\u0026quot; \u0026quot;imdb_avaliacoes\u0026quot; \u0026quot;imdb_completa\u0026quot; ## [9] \u0026quot;imdb_pessoas\u0026quot; \u0026quot;imdb_top_cast\u0026quot; \u0026quot;imdb\u0026quot; \u0026quot;pokemon\u0026quot; ## [13] \u0026quot;ssp\u0026quot;\rPara carregar alguma base do pacote, utilize a fun√ß√£o basesCursoR::pegar_base(\"nome_da_base\"), por exemplo:\npokemon \u0026lt;- basesCursoR::pegar_base(\u0026quot;pokemon\u0026quot;)\rdplyr::glimpse(pokemon)\r## Rows: 949\r## Columns: 20\r## $ id \u0026lt;dbl\u0026gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,‚Ä¶\r## $ id_especie \u0026lt;dbl\u0026gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,‚Ä¶\r## $ id_geracao \u0026lt;dbl\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶\r## $ pokemon \u0026lt;chr\u0026gt; \u0026quot;bulbasaur\u0026quot;, \u0026quot;ivysaur\u0026quot;, \u0026quot;venusaur\u0026quot;, \u0026quot;charmander\u0026quot;, \u0026quot;cha‚Ä¶\r## $ altura \u0026lt;dbl\u0026gt; 0.7, 1.0, 2.0, 0.6, 1.1, 1.7, 0.5, 1.0, 1.6, 0.3, 0.7,‚Ä¶\r## $ peso \u0026lt;dbl\u0026gt; 6.9, 13.0, 100.0, 8.5, 19.0, 90.5, 9.0, 22.5, 85.5, 2.‚Ä¶\r## $ exp_base \u0026lt;dbl\u0026gt; 64, 142, 236, 62, 142, 240, 63, 142, 239, 39, 72, 178,‚Ä¶\r## $ tipo_1 \u0026lt;chr\u0026gt; \u0026quot;grama\u0026quot;, \u0026quot;grama\u0026quot;, \u0026quot;grama\u0026quot;, \u0026quot;fogo\u0026quot;, \u0026quot;fogo\u0026quot;, \u0026quot;fogo\u0026quot;, \u0026quot;√°g‚Ä¶\r## $ tipo_2 \u0026lt;chr\u0026gt; \u0026quot;venenoso\u0026quot;, \u0026quot;venenoso\u0026quot;, \u0026quot;venenoso\u0026quot;, NA, NA, \u0026quot;voador\u0026quot;, ‚Ä¶\r## $ hp \u0026lt;dbl\u0026gt; 45, 60, 80, 39, 58, 78, 44, 59, 79, 45, 50, 60, 40, 45‚Ä¶\r## $ ataque \u0026lt;dbl\u0026gt; 49, 62, 82, 52, 64, 84, 48, 63, 83, 30, 20, 45, 35, 25‚Ä¶\r## $ defesa \u0026lt;dbl\u0026gt; 49, 63, 83, 43, 58, 78, 65, 80, 100, 35, 55, 50, 30, 5‚Ä¶\r## $ ataque_especial \u0026lt;dbl\u0026gt; 65, 80, 100, 60, 80, 109, 50, 65, 85, 20, 25, 90, 20, ‚Ä¶\r## $ defesa_especial \u0026lt;dbl\u0026gt; 65, 80, 100, 50, 65, 85, 64, 80, 105, 20, 25, 80, 20, ‚Ä¶\r## $ velocidade \u0026lt;dbl\u0026gt; 45, 60, 80, 65, 80, 100, 43, 58, 78, 45, 30, 70, 50, 3‚Ä¶\r## $ cor_1 \u0026lt;chr\u0026gt; \u0026quot;#78C850\u0026quot;, \u0026quot;#78C850\u0026quot;, \u0026quot;#78C850\u0026quot;, \u0026quot;#F08030\u0026quot;, \u0026quot;#F08030\u0026quot;,‚Ä¶\r## $ cor_2 \u0026lt;chr\u0026gt; \u0026quot;#A040A0\u0026quot;, \u0026quot;#A040A0\u0026quot;, \u0026quot;#A040A0\u0026quot;, NA, NA, \u0026quot;#A890F0\u0026quot;, NA‚Ä¶\r## $ cor_final \u0026lt;chr\u0026gt; \u0026quot;#81A763\u0026quot;, \u0026quot;#81A763\u0026quot;, \u0026quot;#81A763\u0026quot;, NA, NA, \u0026quot;#DE835E\u0026quot;, NA‚Ä¶\r## $ url_imagem \u0026lt;chr\u0026gt; \u0026quot;https://raw.githubusercontent.com/phalt/pokeapi/maste‚Ä¶\r## $ url_icone \u0026lt;chr\u0026gt; \u0026quot;//cdn.bulbagarden.net/upload/e/ec/001MS.png\u0026quot;, \u0026quot;//cdn.‚Ä¶\r\r\rBases de dados em Ingl√™s\rBases do tidytuesday\rO tidytuesday √© um projeto bem legal da comunidade de R!\rToda semana √© disponibilizada uma base de dados.\rQUALQUER pessoa que queira participar pode participar, fazendo uma visualiza√ß√£o com a base disponibilizada!\nUm lugar legal para ver as visualiza√ß√µes criadas pelas pessoas √© no twitter, pesquisando a hashtag #tidytuesday.\n√â poss√≠vel consultar a lista de bases de dados neste link: tidytuesday datasets. Ao entrar na p√°gina de uma base de dados, o c√≥digo para carregar a mesma √© mostrado. Por exemplo: para usar os dados de Jogos de tabuleiro, podemos usar o seguinte c√≥digo:\njogos_ratings \u0026lt;- readr::read_csv(\u0026#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-25/ratings.csv\u0026#39;)\rdplyr::glimpse(jogos_ratings)\r## Rows: 21,831\r## Columns: 10\r## $ num \u0026lt;dbl\u0026gt; 105, 189, 428, 72, 103, 191, 100, 3, 15, 35, 30, 182, 13‚Ä¶\r## $ id \u0026lt;dbl\u0026gt; 30549, 822, 13, 68448, 36218, 9209, 178900, 167791, 1733‚Ä¶\r## $ name \u0026lt;chr\u0026gt; \u0026quot;Pandemic\u0026quot;, \u0026quot;Carcassonne\u0026quot;, \u0026quot;Catan\u0026quot;, \u0026quot;7 Wonders\u0026quot;, \u0026quot;Domini‚Ä¶\r## $ year \u0026lt;dbl\u0026gt; 2008, 2000, 1995, 2010, 2008, 2004, 2015, 2016, 2015, 20‚Ä¶\r## $ rank \u0026lt;dbl\u0026gt; 106, 190, 429, 73, 104, 192, 101, 4, 16, 36, 31, 183, 14‚Ä¶\r## $ average \u0026lt;dbl\u0026gt; 7.59, 7.42, 7.14, 7.74, 7.61, 7.41, 7.60, 8.42, 8.11, 7.‚Ä¶\r## $ bayes_average \u0026lt;dbl\u0026gt; 7.487, 7.309, 6.970, 7.634, 7.499, 7.305, 7.508, 8.274, ‚Ä¶\r## $ users_rated \u0026lt;dbl\u0026gt; 108975, 108738, 108024, 89982, 81561, 76171, 74419, 7421‚Ä¶\r## $ url \u0026lt;chr\u0026gt; \u0026quot;/boardgame/30549/pandemic\u0026quot;, \u0026quot;/boardgame/822/carcassonne‚Ä¶\r## $ thumbnail \u0026lt;chr\u0026gt; \u0026quot;https://cf.geekdo-images.com/S3ybV1LAp-8SnHIXLLjVqA__mi‚Ä¶\r\rPacote ISLR\rO pacote ISLR acompanha o livro Introduction to Statistical Learning (dispon√≠vel gratuitamente aqui).\rApresenta bases de dados interessantes para treinar modelagem, acompanhando os exemplos do livro.\nVoc√™ pode instalar o pacote atrav√©s do CRAN, usando a fun√ß√£o install.packages():\ninstall.packages(\u0026quot;ISLR\u0026quot;)\rEssas s√£o as bases de dados dispon√≠veis no pacote, que podem ser acessadas utilizando a fun√ß√£o library(ISLR) ou use com ISLR::nome_da_base.\r:\n\r\rNome\r\rDescri√ß√£o\r\r\r\r\r\rAuto\r\rAuto Data Set\r\r\r\rCaravan\r\rThe Insurance Company (TIC) Benchmark\r\r\r\rCarseats\r\rSales of Child Car Seats\r\r\r\rCollege\r\rU.S. News and World Report‚Äôs College Data\r\r\r\rCredit\r\rCredit Card Balance Data\r\r\r\rDefault\r\rCredit Card Default Data\r\r\r\rHitters\r\rBaseball Data\r\r\r\rKhan\r\rKhan Gene Data\r\r\r\rNCI60\r\rNCI 60 Data\r\r\r\rOJ\r\rOrange Juice Data\r\r\r\rPortfolio\r\rPortfolio Data\r\r\r\rSmarket\r\rS\u0026amp;P Stock Market Data\r\r\r\rWage\r\rMid-Atlantic Wage Data\r\r\r\rWeekly\r\rWeekly S\u0026amp;P Stock Market Data\r\r\r\r\r\rKaggle\rO Kaggle √© uma plataforma onde √© poss√≠vel participar de competi√ß√µes de Machine Learning!\nPor l√°, tamb√©m est√£o dispon√≠veis diversas bases de dados, na p√°gina de datasets. Um ponto importante para citar √© que qualquer pessoa consegue fazer upload de uma base l√° no Kaggle, ent√£o pesquise com calma e veja as bases mais bem avaliadas no tema que voc√™ quer explorar! Depois que escolher, √© poss√≠vel baixar a base de dados e importar para o R.\n\r\rConclus√£o\rEsperamos que este post seja interessante para quem est√° aprendendo e quer praticar com novas bases, e tamb√©m para quem quer ensinar R e procura bases de dados para criar exemplos!\rBons estudos e at√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2022-06-11-bases-de-dados/","tags":["ensino","bases de dados","importa√ß√£o"],"title":"Bases de dados: para praticar e ensinar"},{"author":["Tereza"],"categories":["tutoriais"],"contents":"\rVoc√™ j√° conhece o skimr?\nO skimr √© um pacote que nos fornece medidas resumo de vari√°veis de uma base de dados de interesse. Ele pode ser visto como uma alternativa mais completa para a fun√ß√£o summary() do R Base.\nAl√©m de incluir algumas informa√ß√µes a mais sobre cada coluna (como n√∫mero de missings, por exemplo), ele lida com todos os tipos de dados, n√£o s√≥ num√©ricos, fornecendo um conjunto diferente de medidas resumo a depender do tipo da coluna.\nGostou? Vamos dar uma olhada em como ele funciona!\nskimr\rPrimeiramente, vamos instalar e carregar o pacote skimr\ninstall.packages(\u0026quot;skimr\u0026quot;)\rlibrary(skimr)\r## Warning: package \u0026#39;skimr\u0026#39; was built under R version 4.1.3\rAgora, vamos aplicar a fun√ß√£o skim em uma base de dados de interesse. No caso, estamos usando a base dados_starwars do pacote dados\ndados::dados_starwars |\u0026gt; skim()\r\rTabela 1: Data summary\r\rName\rdados::dados_starwars\r\rNumber of rows\r87\r\rNumber of columns\r14\r\r_______________________\r\r\rColumn type frequency:\r\r\rcharacter\r8\r\rlist\r3\r\rnumeric\r3\r\r________________________\r\r\rGroup variables\rNone\r\r\r\rVariable type: character\n\r\rskim_variable\rn_missing\rcomplete_rate\rmin\rmax\rempty\rn_unique\rwhitespace\r\r\r\rnome\r0\r1.00\r3\r21\r0\r87\r0\r\rcor_do_cabelo\r5\r0.94\r5\r20\r0\r11\r0\r\rcor_da_pele\r0\r1.00\r4\r28\r0\r31\r0\r\rcor_dos_olhos\r0\r1.00\r4\r19\r0\r14\r0\r\rsexo_biologico\r4\r0.95\r5\r12\r0\r4\r0\r\rgenero\r4\r0.95\r8\r9\r0\r2\r0\r\rplaneta_natal\r10\r0.89\r4\r14\r0\r48\r0\r\respecie\r4\r0.95\r3\r15\r0\r37\r0\r\r\r\rVariable type: list\n\r\rskim_variable\rn_missing\rcomplete_rate\rn_unique\rmin_length\rmax_length\r\r\r\rfilmes\r0\r1\r24\r1\r7\r\rveiculos\r0\r1\r11\r0\r2\r\rnaves_espaciais\r0\r1\r17\r0\r5\r\r\r\rVariable type: numeric\n\r\rskim_variable\rn_missing\rcomplete_rate\rmean\rsd\rp0\rp25\rp50\rp75\rp100\rhist\r\r\r\raltura\r6\r0.93\r174.36\r34.77\r66\r167.0\r180\r191.0\r264\r‚ñÅ‚ñÅ‚ñá‚ñÖ‚ñÅ\r\rmassa\r28\r0.68\r97.31\r169.46\r15\r55.6\r79\r84.5\r1358\r‚ñá‚ñÅ‚ñÅ‚ñÅ‚ñÅ\r\rano_nascimento\r44\r0.49\r87.57\r154.69\r8\r35.0\r52\r72.0\r896\r‚ñá‚ñÅ‚ñÅ‚ñÅ‚ñÅ\r\r\r\rVeja que a sa√≠da da fun√ß√£o skim mostra uma vis√£o geral da base de dados, nos dando informa√ß√µes como n√∫mero de linhas, n√∫mero de colunas, e os tipos das colunas.\nEla fornece tamb√©m informa√ß√µes individuais sobre cada coluna da base, separando as colunas por tipo: cada tipo nos d√° um conjunto diferente de estat√≠sticas, que fa√ßam sentido para aquele tipo de dado.\nAl√©m disso, se salvarmos a sa√≠da da fun√ß√£o em um objeto, podemos obter um data frame no qual cada linha √© referente a uma coluna da base de dados.\nIsso √© muito √∫til quando estamos lidando com bases que tem muitas colunas.\ninfo_skim \u0026lt;- dados::dados_starwars |\u0026gt; skim() |\u0026gt; tibble::as_tibble()\rPodemos, por exemplo, ordenar pelas vari√°veis que tem maior n√∫mero de NA:\ninfo_skim |\u0026gt; dplyr::arrange(desc(n_missing))\r## # A tibble: 14 x 20\r## skim_type skim_variable n_missing complete_rate character.min character.max\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt;\r## 1 numeric ano_nascimento 44 0.494 NA NA\r## 2 numeric massa 28 0.678 NA NA\r## 3 character planeta_natal 10 0.885 4 14\r## 4 numeric altura 6 0.931 NA NA\r## 5 character cor_do_cabelo 5 0.943 5 20\r## 6 character sexo_biologico 4 0.954 5 12\r## 7 character genero 4 0.954 8 9\r## 8 character especie 4 0.954 3 15\r## 9 character nome 0 1 3 21\r## 10 character cor_da_pele 0 1 4 28\r## 11 character cor_dos_olhos 0 1 4 19\r## 12 list filmes 0 1 NA NA\r## 13 list veiculos 0 1 NA NA\r## 14 list naves_espaciais 0 1 NA NA\r## # ... with 14 more variables: character.empty \u0026lt;int\u0026gt;, character.n_unique \u0026lt;int\u0026gt;,\r## # character.whitespace \u0026lt;int\u0026gt;, list.n_unique \u0026lt;int\u0026gt;, list.min_length \u0026lt;int\u0026gt;,\r## # list.max_length \u0026lt;int\u0026gt;, numeric.mean \u0026lt;dbl\u0026gt;, numeric.sd \u0026lt;dbl\u0026gt;,\r## # numeric.p0 \u0026lt;dbl\u0026gt;, numeric.p25 \u0026lt;dbl\u0026gt;, numeric.p50 \u0026lt;dbl\u0026gt;, numeric.p75 \u0026lt;dbl\u0026gt;,\r## # numeric.p100 \u0026lt;dbl\u0026gt;, numeric.hist \u0026lt;chr\u0026gt;\rVoc√™ pode ler mais sobre as funcionalidades do skimr nesse vignette\n\r","permalink":"https://blog.curso-r.com/posts/2022-05-05-skimr/","tags":["tutoriais"],"title":"Conhe√ßa o pacote {skimr}"},{"author":["Beatriz"],"categories":["pacotes"],"contents":"\r\r\rIntrodu√ß√£o\rO pacote dados disponibiliza a tradu√ß√£o de v√°rias bases de dados que s√£o originalmente dispon√≠veis em outros pacotes de R.\rRecentemente o pacote foi disponibilizado no CRAN!\rEsse post foi escrito para que as pessoas conhe√ßam mais sobre ele!\n\rPacote dados\rO pacote dados disponibiliza a tradu√ß√£o de v√°rias bases de dados que s√£o originalmente dispon√≠veis em outros pacotes de R.\nO pacote come√ßou a ser desenvolvido em Junho de 2020, e √© um irm√£o do pacote datos. O datos foi desenvolvido para ser usado na tradu√ß√£o do livro R para Ci√™ncia de Dados em espanhol, feita volutariamente pela comunidade Latino-Americana de R.\nUm destaque important√≠ssimo √© que as tradu√ß√µes do pacote dados foram feitas voluntariamente por pessoas da comunidade Latino-Americana de R, contando com a colabora√ß√£o de pessoas que fazem parte da Latin-R, R-Ladies e Curso-R, sendo elas: Riva Quiroga, Sara Mortara, Beatriz Milz (professora na Curso-R), Andrea S√°nchez-Tapia, Alejandra Andrea Tapia Silva, Beatriz Maurer Costa, Jean Prado, Renata Hirota, William Amorim (professor na Curso-R), e Emmanuelle Rodrigues Nunes.\nAlguns dos objetivos do pacote dados s√£o:\n\rDisponibilizar bases de dados em portugu√™s utilizadas para praticar e ensinar R (como em tutoriais, cursos, textos em blogs, livros). Por exemplo, est√£o dispon√≠veis l√° todas as bases usadas no livro R for Data Science, entre outras;\n\rIncentivar pessoas a ser tornarem desenvolvedoras em R (v√°rias pessoas que participaram do desenvolvimento do pacote e realizaram tradu√ß√µes n√£o tinham experi√™ncia anterior com colabora√ß√£o via GitHub e desenvolvimento de pacotes em R, por exemplo);\n\rColaborar com a diminui√ß√£o da lacuna lingu√≠stica em materiais usados no ensino e pr√°tica de R.\n\r\rO pacote est√° dispon√≠vel no CRAN e pode ser instalado utilizando o seguinte c√≥digo:\ninstall.packages(\u0026quot;dados\u0026quot;)\rPara que as bases fiquem dispon√≠veis, utilize a fun√ß√£o library(dados) ou use com dados::nome_da_base.\nTodas as bases possuem a documenta√ß√£o traduzida tamb√©m. Voc√™ pode conferir na aba Help, usando ?dados::nome_da_base ou conferindo na documenta√ß√£o online do pacote.\nExistem bases bem legais dispon√≠veis, como:\nStar Wars \r\rA base de dados de personagens da franquia Star Wars, disponibilizada originalmente no pacote dplyr. Por isso, √© esperado que seja bastante √∫til em exemplos de manipula√ß√£o de dados. Por√©m podemos criar visualiza√ß√µes bem legais tamb√©m usando esses dados! Ali√°s, essa √© a base utilizada no desafio 3, focado em visualiza√ß√£o de dados, com o objetivo de replicar esse gr√°fico:\r\rEspie a base por aqui:\ndplyr::glimpse(dados::dados_starwars)\r## Rows: 87\r## Columns: 14\r## $ nome \u0026lt;chr\u0026gt; \u0026quot;Luke Skywalker\u0026quot;, \u0026quot;C-3PO\u0026quot;, \u0026quot;R2-D2\u0026quot;, \u0026quot;Darth Vader\u0026quot;, \u0026quot;Le‚Ä¶\r## $ altura \u0026lt;int\u0026gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, 182, 188, 1‚Ä¶\r## $ massa \u0026lt;dbl\u0026gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0, 32.0, 84.0‚Ä¶\r## $ cor_do_cabelo \u0026lt;chr\u0026gt; \u0026quot;Loiro\u0026quot;, NA, NA, \u0026quot;Nenhum\u0026quot;, \u0026quot;Castanho\u0026quot;, \u0026quot;Castanho, Cinz‚Ä¶\r## $ cor_da_pele \u0026lt;chr\u0026gt; \u0026quot;Branca clara\u0026quot;, \u0026quot;Ouro\u0026quot;, \u0026quot;Branca, Azul\u0026quot;, \u0026quot;Branca\u0026quot;, \u0026quot;Cla‚Ä¶\r## $ cor_dos_olhos \u0026lt;chr\u0026gt; \u0026quot;Azul\u0026quot;, \u0026quot;Amarelo\u0026quot;, \u0026quot;Vermelho\u0026quot;, \u0026quot;Amarelo\u0026quot;, \u0026quot;Castanho\u0026quot;, ‚Ä¶\r## $ ano_nascimento \u0026lt;dbl\u0026gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, NA, 24.0, 5‚Ä¶\r## $ sexo_biologico \u0026lt;chr\u0026gt; \u0026quot;Macho\u0026quot;, \u0026quot;Nenhum\u0026quot;, \u0026quot;Nenhum\u0026quot;, \u0026quot;Macho\u0026quot;, \u0026quot;F√™mea\u0026quot;, \u0026quot;Macho\u0026quot;‚Ä¶\r## $ genero \u0026lt;chr\u0026gt; \u0026quot;Masculino\u0026quot;, \u0026quot;Masculino\u0026quot;, \u0026quot;Masculino\u0026quot;, \u0026quot;Masculino\u0026quot;, \u0026quot;F‚Ä¶\r## $ planeta_natal \u0026lt;chr\u0026gt; \u0026quot;Tatooine\u0026quot;, \u0026quot;Tatooine\u0026quot;, \u0026quot;Naboo\u0026quot;, \u0026quot;Tatooine\u0026quot;, \u0026quot;Alderaan‚Ä¶\r## $ especie \u0026lt;chr\u0026gt; \u0026quot;Humano\u0026quot;, \u0026quot;Droide\u0026quot;, \u0026quot;Droide\u0026quot;, \u0026quot;Humano\u0026quot;, \u0026quot;Humano\u0026quot;, \u0026quot;Hum‚Ä¶\r## $ filmes \u0026lt;list\u0026gt; \u0026lt;\u0026quot;The Empire Strikes Back\u0026quot;, \u0026quot;Revenge of the Sith\u0026quot;, \u0026quot;R‚Ä¶\r## $ veiculos \u0026lt;list\u0026gt; \u0026lt;\u0026quot;Snowspeeder\u0026quot;, \u0026quot;Imperial Speeder Bike\u0026quot;\u0026gt;, \u0026lt;\u0026gt;, \u0026lt;\u0026gt;, \u0026lt;\u0026gt;,‚Ä¶\r## $ naves_espaciais \u0026lt;list\u0026gt; \u0026lt;\u0026quot;X-wing\u0026quot;, \u0026quot;Imperial shuttle\u0026quot;\u0026gt;, \u0026lt;\u0026gt;, \u0026lt;\u0026gt;, \u0026quot;TIE Advanced‚Ä¶\r\rPinguins \rA base dos pinguins foi disponibilizada com o objetivo de ser uma alternativa √† base de dados iris. Podemos utilizar essa base para ensinar e praticar principalmente temas de visualiza√ß√£o e manipula√ß√£o de dados.\nAlgo muito legal s√£o as vignettes do pacote original, que apresentam tutoriais sobre como fazer visualiza√ß√µes interessantes com os dados. Que tal experimentar recri√°-las utilizando os dados em portugu√™s?\nEspie a base por aqui:\ndplyr::glimpse(dados::pinguins)\r## Rows: 344\r## Columns: 8\r## $ especie \u0026lt;fct\u0026gt; Pinguim-de-ad√©lia, Pinguim-de-ad√©lia, Pinguim-de‚Ä¶\r## $ ilha \u0026lt;fct\u0026gt; Torgersen, Torgersen, Torgersen, Torgersen, Torg‚Ä¶\r## $ comprimento_bico \u0026lt;dbl\u0026gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34‚Ä¶\r## $ profundidade_bico \u0026lt;dbl\u0026gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18‚Ä¶\r## $ comprimento_nadadeira \u0026lt;int\u0026gt; 181, 186, 195, NA, 193, 190, 181, 195, 193, 190,‚Ä¶\r## $ massa_corporal \u0026lt;int\u0026gt; 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 34‚Ä¶\r## $ sexo \u0026lt;fct\u0026gt; macho, f√™mea, f√™mea, NA, f√™mea, macho, f√™mea, ma‚Ä¶\r## $ ano \u0026lt;int\u0026gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, ‚Ä¶\r\rFilmes da Pixar \rO pacote pixarfilms apresenta algumas bases de dados com informa√ß√µes sobre filmes da Pixar. Todas as bases foram traduzidas e disponibilizadas no pacote dados! Essas bases podem ser utilizadas para treinar manipula√ß√£o e visualiza√ß√£o de dados. Na minha opini√£o, essas bases s√£o super interessantes para ensinar os concentos dos joins do dplyr!\nO post ‚ÄòPixar: Uma Hist√≥ria de dados‚Äô, foi escrito por Fernando Barbalho, e publicado no Blog da Escola de Dados, utilizando os dados deste pacote. No meu blog h√° uma vers√£o do post com os c√≥digos para gerar todas as visualiza√ß√µes.\nEspie as bases por aqui:\ndplyr::glimpse(dados::pixar_filmes)\r## Rows: 27\r## Columns: 5\r## $ ordem_lancamento \u0026lt;chr\u0026gt; \u0026quot;1\u0026quot;, \u0026quot;2\u0026quot;, \u0026quot;3\u0026quot;, \u0026quot;4\u0026quot;, \u0026quot;5\u0026quot;, \u0026quot;6\u0026quot;, \u0026quot;7\u0026quot;, \u0026quot;8\u0026quot;, \u0026quot;9\u0026quot;, ‚Ä¶\r## $ filme \u0026lt;chr\u0026gt; \u0026quot;Toy Story - Um Mundo de Aventuras\u0026quot;, \u0026quot;Vida de‚Ä¶\r## $ data_lancamento \u0026lt;date\u0026gt; 1995-11-22, 1998-11-25, 1999-11-24, 2001-11-‚Ä¶\r## $ duracao \u0026lt;dbl\u0026gt; 81, 95, 92, 92, 100, 115, 117, 111, 98, 96, 1‚Ä¶\r## $ classificacao_indicativa \u0026lt;chr\u0026gt; \u0026quot;Livre\u0026quot;, \u0026quot;Livre\u0026quot;, \u0026quot;Livre\u0026quot;, \u0026quot;Livre\u0026quot;, \u0026quot;Livre\u0026quot;, ‚Ä¶\rdplyr::glimpse(dados::pixar_avalicao_publico)\r## Rows: 24\r## Columns: 5\r## $ filme \u0026lt;chr\u0026gt; \u0026quot;Toy Story - Um Mundo de Aventuras\u0026quot;, \u0026quot;Vida de Ins‚Ä¶\r## $ nota_rotten_tomatoes \u0026lt;dbl\u0026gt; 100, 92, 100, 96, 99, 97, 74, 96, 95, 98, 98, 40,‚Ä¶\r## $ nota_metacritic \u0026lt;dbl\u0026gt; 95, 77, 88, 79, 90, 90, 73, 96, 95, 88, 92, 57, 6‚Ä¶\r## $ nota_cinema_score \u0026lt;chr\u0026gt; \u0026quot;A\u0026quot;, \u0026quot;A\u0026quot;, \u0026quot;A+\u0026quot;, \u0026quot;A+\u0026quot;, \u0026quot;A+\u0026quot;, \u0026quot;A+\u0026quot;, \u0026quot;A\u0026quot;, \u0026quot;A\u0026quot;, \u0026quot;A\u0026quot;, ‚Ä¶\r## $ nota_critics_choice \u0026lt;dbl\u0026gt; NA, NA, 100, 92, 97, 88, 89, 91, 90, 95, 97, 67, ‚Ä¶\rdplyr::glimpse(dados::pixar_bilheteria)\r## Rows: 24\r## Columns: 5\r## $ filme \u0026lt;chr\u0026gt; \u0026quot;Toy Story - Um Mundo de Aventuras\u0026quot;, \u0026quot;Vida de‚Ä¶\r## $ orcamento \u0026lt;dbl\u0026gt; 3.00e+07, 1.20e+08, 9.00e+07, 1.15e+08, 9.40e‚Ä¶\r## $ bilheteria_eua_canada \u0026lt;dbl\u0026gt; 191796233, 162798565, 245852179, 289916256, 3‚Ä¶\r## $ bilheteria_outros_paises \u0026lt;dbl\u0026gt; 181757800, 200460294, 251522597, 342400393, 5‚Ä¶\r## $ bilheteria_mundial \u0026lt;dbl\u0026gt; 373554033, 363258859, 497374776, 632316649, 8‚Ä¶\rdplyr::glimpse(dados::pixar_equipe)\r## Rows: 220\r## Columns: 3\r## $ filme \u0026lt;chr\u0026gt; \u0026quot;Toy Story - Um Mundo de Aventuras\u0026quot;, \u0026quot;Toy Story - Um Mundo de Av‚Ä¶\r## $ cargo \u0026lt;chr\u0026gt; \u0026quot;Diretor(a)\u0026quot;, \u0026quot;Roteirista\u0026quot;, \u0026quot;Roteirista\u0026quot;, \u0026quot;Roteirista\u0026quot;, \u0026quot;Roteiri‚Ä¶\r## $ nome \u0026lt;chr\u0026gt; \u0026quot;John Lasseter\u0026quot;, \u0026quot;Joel Cohen\u0026quot;, \u0026quot;Alec Sokolow\u0026quot;, \u0026quot;Andrew Stanton\u0026quot;,‚Ä¶\rdplyr::glimpse(dados::pixar_generos)\r## Rows: 128\r## Columns: 2\r## $ filme \u0026lt;chr\u0026gt; \u0026quot;Toy Story - Um Mundo de Aventuras\u0026quot;, \u0026quot;Toy Story - Um Mundo de A‚Ä¶\r## $ genero \u0026lt;chr\u0026gt; \u0026quot;Anima√ß√£o\u0026quot;, \u0026quot;Aventura\u0026quot;, \u0026quot;Com√©dia\u0026quot;, \u0026quot;Fam√≠lia\u0026quot;, \u0026quot;Fantasia\u0026quot;, \u0026quot;Anim‚Ä¶\rdplyr::glimpse(dados::pixar_oscars)\r## Rows: 80\r## Columns: 3\r## $ filme \u0026lt;chr\u0026gt; \u0026quot;Toy Story - Um Mundo de Aventuras\u0026quot;, \u0026quot;Toy Story -‚Ä¶\r## $ tipo_premio_indicado \u0026lt;chr\u0026gt; \u0026quot;Melhor Filme de Anima√ß√£o\u0026quot;, \u0026quot;Melhor Roteiro Origi‚Ä¶\r## $ resultado \u0026lt;chr\u0026gt; \u0026quot;Pr√™mio ainda n√£o introduzido\u0026quot;, \u0026quot;Nomeado\u0026quot;, \u0026quot;Inele‚Ä¶\r\r\rTodas as bases dispon√≠veis\rVeja o nome e a descri√ß√£o de todas as bases dispon√≠veis:\n\r\rNome\r\rDescri√ß√£o\r\r\r\r\r\raeroportos\r\rAeroportos\r\r\r\rarremesadores\r\rTabela de estat√≠sticas de arremesadores\r\r\r\ravioes\r\rDados de avi√µes\r\r\r\rbebes\r\rNomes de beb√™s\r\r\r\rcasas\r\rDados de habita√ß√£o em Ames\r\r\r\rclima\r\rDados de clima\r\r\r\rcompanhias_aereas\r\rNomes de companhias a√©reas\r\r\r\rcomuns\r\rModelos comuns de carros\r\r\r\rdados_atmosfera\r\rDados atmosf√©ricos\r\r\r\rdados_gapminder\r\rDados de Gapminder\r\r\r\rdados_iris\r\rDados de esp√©cies de flor de √çris por Edgar Anderson\r\r\r\rdados_oms\r\rDados de tuberculose da Organiza√ß√£o Mundial da Sa√∫de\r\r\r\rdados_starwars\r\rPersonagens de Starwars\r\r\r\rdiamante\r\rPre√ßo de 50 mil diamantes\r\r\r\rgerentes\r\rTabela de gerentes\r\r\r\rjardineiros\r\rTabela de estat√≠sticas do jardineiro\r\r\r\rmilhas\r\rDados de economia de combust√≠vel de 1999 a 2008 para 38 modelos populares de carros\r\r\r\rmtcarros\r\rTestes de estrada para autom√≥veis\r\r\r\rpessoas\r\rTabela de pessoas\r\r\r\rpinguins\r\rMedidas de pinguins adultos perto da Esta√ß√£o Palmer, Ant√°rtida (Palmer Station)\r\r\r\rpixar_avalicao_publico\r\rFilmes da Pixar e avalia√ß√µes\r\r\r\rpixar_bilheteria\r\rBilheteria dos filmes da Pixar\r\r\r\rpixar_equipe\r\rEquipe dos filmes\r\r\r\rpixar_filmes\r\rFilmes da Pixar\r\r\r\rpixar_generos\r\rG√™neros dos filmes da Pixar\r\r\r\rpixar_oscars\r\rFilmes da Pixar com indica√ß√µes ao Oscar\r\r\r\rpremios_gerentes\r\rTabela de pr√™mios dos gerentes\r\r\r\rpresidentes_eua\r\rPer√≠odo que engloba 11 presidentes, desde Eisenhower at√© Obama\r\r\r\rquestionario\r\rAmostra de vari√°veis categ√≥ricas do questin√°rio ‚ÄòGeneral Social Survey‚Äô (GSS)\r\r\r\rrebatedores\r\rTabela de estat√≠ticas de Beisebol\r\r\r\rsalarios\r\rTabela de sal√°rios\r\r\r\rtabela1\r\rRegistros de tuberculose da Organiza√ß√£o Mundial da Sa√∫de (primeira variante)\r\r\r\rtabela2\r\rRegistros de tuberculose da Organiza√ß√£o Mundial da Sa√∫de (segunda variante)\r\r\r\rtabela3\r\rRegistros de tuberculose da Organiza√ß√£o Mundial da Sa√∫de (terceira variante)\r\r\r\rtabela4a\r\rRegistros de tuberculose da Organiza√ß√£o Mundial da Sa√∫de (variante 4a)\r\r\r\rtabela4b\r\rRegistros de tuberculose da Organiza√ß√£o Mundial da Sa√∫de (variante 4a)\r\r\r\rtabela5\r\rRegistros de tuberculose da Organiza√ß√£o Mundial da Sa√∫de (quinta variante)\r\r\r\rveiculos\r\rDados de economia de combust√≠vel\r\r\r\rvelho_fiel\r\rDados do g√™iser Velho Fiel (Old Faithful)\r\r\r\rvoos\r\rDados de voos\r\r\r\r\r\rConclus√£o\rEspero que o post tenha sido uma boa introdu√ß√£o ao pacote dados, seja voc√™ uma pessoa que deseja ensinar ou praticar R.\nCaso tenha sugest√µes de melhoria nas tradu√ß√µes, escreva uma issue no reposit√≥rio do pacote!\nAt√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2022-04-06-pacote-dados/","tags":["ensino","bases de dados","importa√ß√£o"],"title":"Pacote dados: bases em portugu√™s para praticar e ensinar"},{"author":["Tereza"],"categories":["Desafio"],"contents":"\r\rOs desafios da Curso-R s√£o problemas pr√°ticos de an√°lise de dados e programa√ß√£o envolvendo faxina de dados, constru√ß√£o de gr√°ficos, relat√≥rios em RMarkdown, modelagem, aplicativos Shiny e muito mais.\nO intuito √© praticar as diversas etapas da Ci√™ncia de Dados, interagir com a comunidade compartilhando as suas solu√ß√µes e gerar bastante repert√≥rio.\nVale sempre lembrar que:\n\rN√£o existe uma √∫nica solu√ß√£o para o desafio.\n\rVoc√™ pode usar qualquer linguagem de programa√ß√£o e quaisquer ferramentas/pacotes da linguagem.\n\rN√£o existe a melhor solu√ß√£o. Toda solu√ß√£o √© v√°lida. No dia-a-dia o importante √© resolver o problema.\n\r\rPara compartilhar a sua solu√ß√£o, vamos usar o Discourse da Curso-R. Basta acessar o t√≥pico referente a esse desafio (no final deste post colocamos o link) e enviar o seu c√≥digo. Voc√™ pode aproveitar tamb√©m para pedir ajuda ou ver e comentar as solu√ß√µes j√° enviadas.\nDesafio #3: Gr√°fico Tem√°tico Star Wars\rO objetivo desse desafio √© escrever um c√≥digo que reproduza o seguinte gr√°fico:\nAlgumas informa√ß√µes √∫teis:\n\rA base de dados utilizada √© a dados_starwars do pacote dados (pode ser instalado com o comando install.packages(\"dados\"))\n\rO link da imagem de fundo do gr√°fico √©: https://wallpaperaccess.com/full/11836.jpg\n\rA fonte utilizada pode ser baixada aqui\n\r\rPoste a sua resolu√ß√£o em nosso Discourse, respondendo o t√≥pico criado para esse desafio!\n\r","permalink":"https://blog.curso-r.com/posts/2022-04-05-desafio-3/","tags":["desafio curso-r","visualiza√ß√£o"],"title":"Desafio #3: Gr√°fico Tem√°tico Star Wars"},{"author":["Tereza"],"categories":["tutoriais"],"contents":"\r\rVoc√™ j√° conhece o esquisse?\nO esquisse √© um pacote que permite a cria√ß√£o de gr√°ficos em {ggplot2} de maneira point and click, o que torna a constru√ß√£o de gr√°ficos uma tarefa bem mais simples, pois n√£o h√° necessidade de digitar as linhas de c√≥digo!\nAl√©m disso, √© poss√≠vel recuperar o c√≥digo que gerou os gr√°ficos, o que √© √≥timo para garantir a reprodutibilidade dos resultados!\nLegal, n√©?\nAqui vai um breve tutorial de como usar essa ferramenta:\nInstale o pacote {esquisse}:\r\rinstall.packages(\u0026quot;esquisse\u0026quot;)\rCarregue o pacote\r\rlibrary(esquisse)\r## Warning: package \u0026#39;esquisse\u0026#39; was built under R version 4.1.3\rCarregue os seus dados. No nosso caso, estamos usando a base de dados pinguins, do pacote {dados}\r\r(Para instalar esse pacote, basta rodar o comando install.packages(\"dados\"))\ndados \u0026lt;- dados::pinguins\rExecute o seguinte comando:\r\rdados |\u0026gt; esquisser()\rE ent√£o, uma p√°gina como essa ser√° aberta:\n√â nessa interface/p√°gina que criaremos o nosso gr√°fico!\nCrie e edite o gr√°fico na maneira que desejar!\r\rNa imagem abaixo, podemos ver os bot√µes para escolher o tipo de gr√°fico, e quais vari√°veis estar√£o mapeadas em cada atributo est√©tico.\nNa aba ‚ÄúLabels \u0026amp; Title‚Äù voc√™ pode editar os t√≠tulos e legendas:\nNa aba ‚ÄúAppearance‚Äù voc√™ pode mudar as cores e apar√™ncia do gr√°fico, de maneira geral:\nAl√©m disso, na aba ‚ÄúData‚Äù √© poss√≠vel filtrar algumas vari√°veis da base de dados, e isso √© feito com a fun√ß√£o filter do {dplyr}:\nE enfim, na aba ‚ÄúCode‚Äù voc√™ pode recuperar o c√≥digo que gera o gr√°fico, para coloc√°-lo em sua an√°lise de dados, por exemplo!\nAo copiar o c√≥digo gerado e executar no R, o seguinte gr√°fico √© gerado:\nlibrary(ggplot2)\rggplot(dados) +\raes(x = comprimento_bico, y = comprimento_nadadeira, colour = especie) +\rgeom_point(shape = \u0026quot;circle\u0026quot;, size = 2.1) +\rscale_color_viridis_d(option = \u0026quot;plasma\u0026quot;, direction = 1) +\rlabs(x = \u0026quot;legenda do eixo x\u0026quot;, y = \u0026quot;legenda do eixo y\u0026quot;, title = \u0026quot;T√≠tulo do Gr√°fico!\u0026quot;, subtitle = \u0026quot;Subt√≠tulo do Gr√°fico!\u0026quot;) +\rtheme_minimal()\r## Warning: Removed 2 rows containing missing values (geom_point).\r","permalink":"https://blog.curso-r.com/posts/2022-03-22-esquisse/","tags":["tutoriais"],"title":"Criando gr√°ficos ggplot2 com o pacote {esquisse}"},{"author":["Beatriz"],"categories":["pacotes"],"contents":"\r\rIntrodu√ß√£o\rRecentemente, escrevi um post sobre como √© poss√≠vel acessar dados do Google Sheets com R, al√©m de importar respostas do Google Forms. Algumas pessoas comentaram que utilizam o One Drive, e perguntaram como funcionaria para importar tabelas que est√£o por l√°. Como eu n√£o uso One Drive, dei uma explorada para responder, e neste post falarei um pouco sobre como podemos importar dados que est√£o na conta do One Drive usando o pacote Microsoft365R.\nO pacote Microsoft365R √© uma interface para acessar o Microsoft 365, e segundo a documenta√ß√£o do pacote, possui fun√ß√µes para interagir com o Microsoft Teams, Outlook, SharePoint Online, e o OneDrive (que √© o foco deste post!).\nPrimeiramente, √© necess√°rio instalar o pacote:\ninstall.packages(\u0026quot;Microsoft365R\u0026quot;)\rEnt√£o, podemos carreg√°-lo:\n# Carregar pacote Microsoft365R\rlibrary(Microsoft365R)\rAo carregar o pacote pela primeira vez, a seguinte mensagem aparecer√°, dizendo que √© poss√≠vel armazenar as credenciais em uma pasta chamada AzureR e perguntando se permitimos que o pacote crie esse diret√≥rio. Eu aceitei respondendo com Yes:\nThe AzureR packages can save your authentication credentials in the directory:\r~/Library/Application Support/AzureR\rThis saves you having to re-authenticate with Azure in future sessions.\rCreate this directory? (Yes/no/cancel) \rDepois de responder com Yes, nada aparentemente acontece, por√©m o pacote √© carregado!\n\rAutentica√ß√£o\rAo acessar pela primeira vez, o pacote abrir√° uma aba do navegador para fazer a autentica√ß√£o.\nNeste exemplo, usarei a fun√ß√£o Microsoft365R::get_personal_onedrive() que explicarei posteriormente. No console do R, aparecer√° a seguinte mensagem ao utilizar alguma fun√ß√£o pela primeira vez:\nMicrosoft365R::get_personal_onedrive()\r# Using authorization_code flow\r# Creating Microsoft Graph login for tenant \u0026#39;consumers\u0026#39;\r# Using authorization_code flow\r# Waiting for authentication in browser...\r# Press Esc/Ctrl + C to abort\rO navegador abrir√° uma janela para que a autentica√ß√£o seja feita:\nAp√≥s fazer a autentica√ß√£o, a seguinte mensagem aparecer√° no navegador:\nAuthenticated with Azure Active Directory. Please close this page and return to R.\rIsso significa que podemos fechar a aba do navegador e retornar ao R. No console do R, aparecer√° a seguinte mensagem:\nAuthentication complete.\r\rAcesso de conta pessoal ou de trabalho?\rO primeiro passo ap√≥s autenticar √© acessar o One Drive, e a fun√ß√£o para fazer isso depende do tipo de acesso da conta: pessoal ou de trabalho. Como o meu acesso √© pessoal, vou usar a fun√ß√£o get_personal_onedrive(). Mas caso o seu acesso seja de trabalho, utilize a fun√ß√£o get_business_onedrive(). √â necess√°rio executar a fun√ß√£o e salvar o resultado em um objeto.\nonedrive_da_bea \u0026lt;- Microsoft365R::get_personal_onedrive()\rAgora a forma de interagir com o pacote √© um pouco diferente de como usamos na maior parte das vezes. Isso porque o pacote utiliza objetos que s√£o da classe R6, e que permitem utilizar m√©todos. O foco deste post n√£o √© explicar o que s√£o as classes R6, e escrevi este post pensando em ser √∫til para pessoas que tamb√©m n√£o conhecem as classes R6. Caso voc√™ tenha interesse em saber mais, deixei alguns links de refer√™ncia no final do post.\nPara conferir a classe desse objeto, podemos usar a fun√ß√£o class():\nclass(onedrive_da_bea)\r#\u0026gt; [1] \u0026quot;ms_drive\u0026quot; \u0026quot;ms_object\u0026quot; \u0026quot;R6\u0026quot; \rAo executar apenas o objeto, o console apresenta os m√©todos poss√≠veis:\ndrive_da_bea\r#\u0026gt; \u0026lt;Personal OneDrive of Beatriz Milz\u0026gt;\r#\u0026gt; directory id: df5a76afb6532845 #\u0026gt; ---\r#\u0026gt; Methods:\r#\u0026gt; create_folder, create_share_link, delete,\r#\u0026gt; delete_item, do_operation, download_file,\r#\u0026gt; get_item, get_item_properties, get_list_pager,\r#\u0026gt; list_files, list_items, list_shared_files,\r#\u0026gt; list_shared_items, open_item,\r#\u0026gt; set_item_properties, sync_fields, update,\r#\u0026gt; upload_file\rSabendo o nome dos m√©todos, podemos us√°-los usando o seguinte padr√£o: nome_do_objeto$nome_do_metodo()! Existem v√°rios m√©todos, e vamos explorar os m√©todos relacionados √† importa√ß√£o. Mas caso voc√™ use bastante o One Drive no seu dia-a-dia, recomendo experimentar os outros m√©todos, como os que servem para manipular arquivos (como criar, atualizar, deletar)!\n\rNavegar nos arquivos do Drive\rPara conseguir importar um arquivo, √© necess√°rio primeiramente encontrar o caminho at√© este arquivo. E isso funciona de forma similar aos caminhos que j√° conhecemos nos nossos projetos!\rVamos usar o m√©todo list_files() para listar os arquivos presentes na pasta inicial do meu OneDrive. Como eu raramente uso ele, criei uma pasta de exemplo chamada pasta_de_exemplo, e dentro dela criei um arquivo Excel chamado pinguins. Veja que apareceu apenas a pasta, e n√£o o conte√∫do que ela armazena:\nonedrive_da_bea$list_files() |\u0026gt; dplyr::glimpse()\r#\u0026gt; Rows: 1\r#\u0026gt; Columns: 4\r#\u0026gt; $ name \u0026lt;chr\u0026gt; \u0026quot;pasta_de_exemplo\u0026quot;\r#\u0026gt; $ size \u0026lt;int\u0026gt; 23041\r#\u0026gt; $ isdir \u0026lt;lgl\u0026gt; TRUE\r#\u0026gt; $ id \u0026lt;chr\u0026gt; \u0026quot;DF5A76AFB6532845!4368\u0026quot;\rPara ver os arquivos que est√£o dentro da pasta (e encontrar o excel pinguins), podemos usar o mesmo m√©todo utilizado acima, e informar o nome da pasta que queremos listar os arquivos.\nonedrive_da_bea$list_files(path = \u0026quot;pasta_de_exemplo/\u0026quot;) |\u0026gt; dplyr::glimpse()\r#\u0026gt; Rows: 1\r#\u0026gt; Columns: 4\r#\u0026gt; $ name \u0026lt;chr\u0026gt; \u0026quot;pinguins.xlsx\u0026quot;\r#\u0026gt; $ size \u0026lt;int\u0026gt; 23041\r#\u0026gt; $ isdir \u0026lt;lgl\u0026gt; FALSE\r#\u0026gt; $ id \u0026lt;chr\u0026gt; \u0026quot;DF5A76AFB6532845!4369\u0026quot;\r\rImportar o arquivo\rEu ainda n√£o encontrei um m√©todo que permita ler o conte√∫do de um Excel diretamente do OneDrive para o R (como fazemos com o Google Drive). Olhando nas issues do GitHub, parece que essa funcionalidade ainda n√£o foi implementada at√© o momento, e algumas pessoas inclusive sugeriram melhorias neste sentido.\nA forma que encontrei para importar um Excel do Ondrive foi fazer o download do arquivo Excel que est√° no Ondrive, e depois importar o arquivo salvo localmente. Para fazer o download e abrir um arquivo Excel, podemos usar o m√©todo download_file() para baixar o arquivo, e ent√£o a fun√ß√£o readxl::read_excel() para importar o arquivo:\n# baixar o arquivo\ronedrive_da_bea$download_file(\u0026quot;pasta_de_exemplo/pinguins.xlsx\u0026quot;, dest = \u0026quot;pinguins_onedrive.xlsx\u0026quot;)\r# ler o arquivo baixado\rpinguins_do_onedrive \u0026lt;- readxl::read_excel(\u0026quot;pinguins_onedrive.xlsx\u0026quot;)\rdplyr::glimpse(pinguins_do_onedrive)\r#\u0026gt; Rows: 344\r#\u0026gt; Columns: 8\r#\u0026gt; $ especie \u0026lt;chr\u0026gt; \u0026quot;Pinguim-de-ad√©lia\u0026quot;, \u0026quot;Pinguim-de-ad√©‚Ä¶\r#\u0026gt; $ ilha \u0026lt;chr\u0026gt; \u0026quot;Torgersen\u0026quot;, \u0026quot;Torgersen\u0026quot;, \u0026quot;Torgersen‚Ä¶\r#\u0026gt; $ comprimento_bico \u0026lt;dbl\u0026gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38‚Ä¶\r#\u0026gt; $ profundidade_bico \u0026lt;dbl\u0026gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17‚Ä¶\r#\u0026gt; $ comprimento_nadadeira \u0026lt;dbl\u0026gt; 181, 186, 195, NA, 193, 190, 181, 19‚Ä¶\r#\u0026gt; $ massa_corporal \u0026lt;dbl\u0026gt; 3750, 3800, 3250, NA, 3450, 3650, 36‚Ä¶\r#\u0026gt; $ sexo \u0026lt;chr\u0026gt; \u0026quot;macho\u0026quot;, \u0026quot;f√™mea\u0026quot;, \u0026quot;f√™mea\u0026quot;, NA, \u0026quot;f√™me‚Ä¶\r#\u0026gt; $ ano \u0026lt;dbl\u0026gt; 2007, 2007, 2007, 2007, 2007, 2007, ‚Ä¶\rCaso queira abrir o arquivo no navegador (para ver, compartilhar ou coisas similares), use o m√©todo open_item(), informando o caminho at√© o arquivo:\nonedrive_da_bea$open_item(path = \u0026quot;pasta_de_exemplo/pinguins.xlsx\u0026quot;) \r\rConclus√£o\rEspero que este post seja √∫til para quem usa o One Drive tamb√©m. Tamb√©m espero que o pacote seja aprimorado para conseguir importar os dados sem que seja necess√°rio baix√°-los.\nCaso voc√™ encontre algum m√©todo melhor para importar os dados, conta pra gente!\nAt√© a pr√≥xima!\n\rRefer√™ncias\r\rDocumenta√ß√£o do pacote Microsoft365R - Vignette sobre o OneDrive\n\rGitHub do pacote Microsoft365R\n\rRefer√™ncia da base dos pinguins\n\rAvan√ßado: Refer√™ncias sobre classes R6 em R\n\rDocumenta√ß√£o do pacote R6\rLivro Advanced R\r\r\r\r","permalink":"https://blog.curso-r.com/posts/2022-03-18-onedrive/","tags":["api","one drive","importa√ß√£o","excel","microsoft","azure","Microsoft365R"],"title":"Acessando dados do seu One Drive com R"},{"author":["William"],"categories":["Desafio"],"contents":"\r\rOs desafios da Curso-R s√£o problemas pr√°ticos de an√°lise de dados e programa√ß√£o envolvendo faxina de dados, constru√ß√£o de gr√°ficos, relat√≥rios em RMarkdown, modelagem, aplicativos Shiny e muito mais.\nO intuito √© praticar as diversas etapas da Ci√™ncia de Dados, interagir com a comunidade compartilhando as suas solu√ß√µes e gerar bastante repert√≥rio.\nVale sempre lembrar que:\n\rN√£o existe uma √∫nica solu√ß√£o para o desafio.\n\rVoc√™ pode usar qualquer linguagem de programa√ß√£o e quaisquer ferramentas/pacotes da linguagem.\n\rN√£o existe a melhor solu√ß√£o. Toda solu√ß√£o √© v√°lida. No dia-a-dia o importante √© resolver o problema.\n\r\rPara compartilhar a sua solu√ß√£o, vamos usar o Discourse da Curso-R. Basta acessar o t√≥pico referente a esse desafio (no final deste post colocamos o link) e enviar o seu c√≥digo. Voc√™ pode aproveitar tamb√©m para pedir ajuda ou ver e comentar as solu√ß√µes j√° enviadas.\nDesafio #2: app contador de cliques\rEste √© o nosso primeiro desafio de Shiny! O objetivo √© construir um app que conte o n√∫mero de cliques seguidos em um bot√£o. Veja o funcionamento a seguir:\nVeja que o contador come√ßa no zero e aumenta em uma unidade para cada clique seguido. Cliques seguidos s√£o cliques feitos em um intervalo muito curto de tempo. No exemplo acima, utilizamos 0.5 segundo. Assim, se o intervalo entre dois cliques for maior que 0.5 segundo, o contador deve voltar para 1. Voc√™ pode definir qualquer intervalo de tempo para a sua solu√ß√£o.\nA solu√ß√£o precisa conter apenas o comportamento descrito anteriormente. Voc√™ n√£o precisa reproduzir o layout e a identidade visual do exemplo. Inclusive, incentivamos a cria√ß√£o de novas vers√µes desse app. Explore a sua criatividade!\nPoste a sua resolu√ß√£o em nosso Discourse, respondendo o t√≥pico criado para esse desafio!\n\r","permalink":"https://blog.curso-r.com/posts/2022-03-15-desafio-1/","tags":["desafio curso-r","shiny"],"title":"Desafio #2: contador de cliques [Shiny]"},{"author":["Beatriz"],"categories":["pacotes"],"contents":"\r\rIntrodu√ß√£o\rO Google Sheets √© um editor de planilhas da Google, que funciona vinculado ao Google Drive (ou seja, os arquivos ficam na nuvem). O pacote googlesheets4 permite interagir com o Google Sheets atrav√©s do R. Neste post, vamos mostrar alguns exemplos sobre como podemos importar dados usando o pacote googlesheets4.\nPrimeiramente, √© necess√°rio instalar o pacote:\ninstall.packages(\u0026quot;googlesheets4\u0026quot;)\rEnt√£o, podemos carreg√°-lo:\n# Carregar pacote googlesheets4\rlibrary(googlesheets4)\rNeste exemplo, usaremos a tabela da base de dados Gapminder, que apresenta algumas informa√ß√µes por pa√≠s e ano, como a popula√ß√£o total, expectativa de vida ao nascer e o PIB per capita.\nPara importar uma tabela que est√° no Google Sheets, primeiramente precisamos identific√°-la para que o R saiba qual arquivo queremos abrir. Uma forma de fazer isso √© usando a URL (ou Uniform Resource Locator), que √© tamb√©m conhecido como o link que usamos no navegador.\nUm exemplo de url √© o seguinte, e ele encaminha para essa tabela.\nhttps://docs.google.com/spreadsheets/d/1U6Cf_qEOhiR9AZqTqS3mbMF3zt2db48ZP5v3rkrAEJY/edit#gid=780868077\rSabendo a URL da planilha, podemos salvar em um objeto no R para facilitar o uso!\n# salvar a url/link da planilha que queremos acessar\rurl_planilha \u0026lt;- \u0026quot;https://docs.google.com/spreadsheets/d/1U6Cf_qEOhiR9AZqTqS3mbMF3zt2db48ZP5v3rkrAEJY/edit#gid=780868077\u0026quot;\rAutentica√ß√£o\rPara evitar que algu√©m que n√£o tem acesso a uma Google Sheet consiga ler a mesma sem permiss√£o, o pacote nos direciona para fazer uma autentica√ß√£o com uma conta do Google. Esse direcionamento √© feito quando usamos alguma fun√ß√£o que necessita de autentica√ß√£o pela primeira vez, e a cada sess√£o do R (ou seja, sempre que reiniciar), o R perguntar√° novamente com qual email do Google gostar√≠amos de autenticar.\nExemplo: No meu caso, eu j√° autentiquei anteriormente, ent√£o ele apresenta os emails j√° autenticados.\nrespostas_formulario \u0026lt;- read_sheet(url)\r# ‚Üí The googlesheets4 package is requesting access to your Google account\r# Select a pre-authorised account or enter \u0026#39;0\u0026#39; to obtain a new token\r# Press Esc/Ctrl + C to cancel\r# # 1: bmilz@curso-r.com\r# 2: milz.bea@gmail.com\rPara fazer uma nova autentica√ß√£o, basta escolher a op√ß√£o 0, e uma janela do navegador abrir√° para fazer a autentica√ß√£o:\nPrecisamos ent√£o clicar no email desejado, selecionar todas as op√ß√µes de acesso e clicar em ‚ÄúContinuar‚Äù:\nCaso funcione, a seguinte mensagem aparecer√° no navegador: Authentication complete. Please close this page and return to R. Isso significa que podemos voltar ao R!\n\rDEU ERRO! Caso d√™ erro ao abrir o arquivo, se certifique que voc√™ tem acesso de leitura ou edi√ß√£o do Google Sheets desejado.\n\rAgora podemos experimenta as fun√ß√µes do pacote!\n\rFun√ß√£o sheet_properties()\rA fun√ß√£o sheet_properties() permite ver quais abas (chamaremos muitas vezes de sheets, pois √© a forma usada no pacote) est√£o dispon√≠veis na tabela:\n# ver as propriedades da planilha (conseguimos descobrir quais sheets # est√£o dispon√≠veis)\rsheet_properties(url_planilha)\r## # A tibble: 5 √ó 8\r## name index id type visible grid_rows grid_columns data ## \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;lgl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;list\u0026gt;\r## 1 Africa 0 780868077 GRID TRUE 625 6 \u0026lt;NULL\u0026gt;\r## 2 Americas 1 45759261 GRID TRUE 301 6 \u0026lt;NULL\u0026gt;\r## 3 Asia 2 1984823455 GRID TRUE 397 6 \u0026lt;NULL\u0026gt;\r## 4 Europe 3 1503562052 GRID TRUE 361 6 \u0026lt;NULL\u0026gt;\r## 5 Oceania 4 1796776040 GRID TRUE 25 6 \u0026lt;NULL\u0026gt;\rCom isso, sabemos que a tabela que informamos tem 5 abas, sendo elas: Africa, Americas, Asia, Europe e Oceania.\n\rFun√ß√£o read_sheet()\rA fun√ß√£o mais √∫til (na minha opini√£o) do pacote √© a que usamos para ler os dados: read_sheet()!\nSe usarmos essa fun√ß√£o sem nenhum argumento al√©m do url da planilha, por padr√£o a primeira sheet ser√° importada. Como vimos no resultado da fun√ß√£o sheet_properties(), a primeira aba da base cont√©m os dados dos pa√≠ses que est√£o no continente Africano. Ent√£o os dados que ser√£o importados s√£o referentes √† este continente:\nplanilha \u0026lt;- read_sheet(url_planilha)\rdplyr::glimpse(planilha)\r## Rows: 624\r## Columns: 6\r## $ country \u0026lt;chr\u0026gt; \u0026quot;Algeria\u0026quot;, \u0026quot;Algeria\u0026quot;, \u0026quot;Algeria\u0026quot;, \u0026quot;Algeria\u0026quot;, \u0026quot;Algeria\u0026quot;, \u0026quot;Alge‚Ä¶\r## $ continent \u0026lt;chr\u0026gt; \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, ‚Ä¶\r## $ year \u0026lt;dbl\u0026gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, ‚Ä¶\r## $ lifeExp \u0026lt;dbl\u0026gt; 43.077, 45.685, 48.303, 51.407, 54.518, 58.014, 61.368, 65.7‚Ä¶\r## $ pop \u0026lt;dbl\u0026gt; 9279525, 10270856, 11000948, 12760499, 14760787, 17152804, 2‚Ä¶\r## $ gdpPercap \u0026lt;dbl\u0026gt; 2449.0082, 3013.9760, 2550.8169, 3246.9918, 4182.6638, 4910.‚Ä¶\rPodemos tamb√©m usar o argumento sheet = para especificar qual aba queremos importar. Podemos fazer a busca pela posi√ß√£o (ou seja, informando um n√∫mero), ou pelo nome da aba:\n# abrir uma sheet espec√≠fica: pela posi√ß√£o\rplanilha_sheet_3 \u0026lt;- read_sheet(url_planilha, sheet = 3)\rdplyr::glimpse(planilha_sheet_3)\r## Rows: 396\r## Columns: 6\r## $ country \u0026lt;chr\u0026gt; \u0026quot;Afghanistan\u0026quot;, \u0026quot;Afghanistan\u0026quot;, \u0026quot;Afghanistan\u0026quot;, \u0026quot;Afghanistan\u0026quot;, ‚Ä¶\r## $ continent \u0026lt;chr\u0026gt; \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asi‚Ä¶\r## $ year \u0026lt;dbl\u0026gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, ‚Ä¶\r## $ lifeExp \u0026lt;dbl\u0026gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.8‚Ä¶\r## $ pop \u0026lt;dbl\u0026gt; 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12‚Ä¶\r## $ gdpPercap \u0026lt;dbl\u0026gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, ‚Ä¶\r# abrir uma sheet espec√≠fica: pelo nome\rplanilha_asia \u0026lt;- read_sheet(url_planilha, sheet = \u0026quot;Asia\u0026quot;)\rdplyr::glimpse(planilha_asia)\r## Rows: 396\r## Columns: 6\r## $ country \u0026lt;chr\u0026gt; \u0026quot;Afghanistan\u0026quot;, \u0026quot;Afghanistan\u0026quot;, \u0026quot;Afghanistan\u0026quot;, \u0026quot;Afghanistan\u0026quot;, ‚Ä¶\r## $ continent \u0026lt;chr\u0026gt; \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asia\u0026quot;, \u0026quot;Asi‚Ä¶\r## $ year \u0026lt;dbl\u0026gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, ‚Ä¶\r## $ lifeExp \u0026lt;dbl\u0026gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.8‚Ä¶\r## $ pop \u0026lt;dbl\u0026gt; 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12‚Ä¶\r## $ gdpPercap \u0026lt;dbl\u0026gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, ‚Ä¶\rComo todas as tabelas da base tem a mesma estrutura, podemos usar o pacote purrr para importar todas as abas de uma vez:\n# a fun√ß√£o sheet_names permite buscar apenas o nome das abas\rnome_abas \u0026lt;- sheet_names(url_planilha)\r# com o purrr, podemos abrir todas as abas de uma vez!\rgapminder_completo \u0026lt;- nome_abas |\u0026gt; purrr::map_dfr(~ read_sheet(url_planilha, sheet = .x))\rdplyr::glimpse(gapminder_completo)\r## Rows: 1,704\r## Columns: 6\r## $ country \u0026lt;chr\u0026gt; \u0026quot;Algeria\u0026quot;, \u0026quot;Algeria\u0026quot;, \u0026quot;Algeria\u0026quot;, \u0026quot;Algeria\u0026quot;, \u0026quot;Algeria\u0026quot;, \u0026quot;Alge‚Ä¶\r## $ continent \u0026lt;chr\u0026gt; \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, \u0026quot;Africa\u0026quot;, ‚Ä¶\r## $ year \u0026lt;dbl\u0026gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, ‚Ä¶\r## $ lifeExp \u0026lt;dbl\u0026gt; 43.077, 45.685, 48.303, 51.407, 54.518, 58.014, 61.368, 65.7‚Ä¶\r## $ pop \u0026lt;dbl\u0026gt; 9279525, 10270856, 11000948, 12760499, 14760787, 17152804, 2‚Ä¶\r## $ gdpPercap \u0026lt;dbl\u0026gt; 2449.0082, 3013.9760, 2550.8169, 3246.9918, 4182.6638, 4910.‚Ä¶\r\rOutras fun√ß√µes\rEsse pacote tem muitas outras fun√ß√µes que interagem com o Googles Sheets, mas que n√£o fazem parte do escopo deste post, como criar uma nova aba e escrever dados em uma aba. Essas fun√ß√µes tamb√©m s√£o muito √∫teis!\n\rE o Google Forms?\rEu gosto muito de usar esse pacote para importar respostas de formul√°rios do Google, pois o Google permite vincular respostas dos formul√°rios em uma Google Sheets.\nAqui mostrarei como fazer isso! Primeiro precisamos criar um formul√°rio (caso ele ainda n√£o exista):\nAo criar o formul√°rio, podemos clicar em ‚ÄúRespostas‚Äù e ent√£o clicar no logo do Google Sheets (um quadrado verde com uma linha branca horizontal e outra vertical):\nO Google Forms ir√° perguntar qual o nome da Google Sheet a ser criada (ou tamb√©m podemos selecionar uma Google Sheets que j√° existe):\nDepois de selecionar qual a Google Sheet ficar√° vinculada ao formul√°rio, a Google Sheet ser√° aberta e podemos ver as respostas:\nCada coluna ter√° informa√ß√µes de uma pergunta do formul√°rio. Inicialmente, a base ter√° 0 linhas, pois quando criamos o formul√°rio ele tem 0 respostas. Por√©m, ap√≥s algu√©m responder o formul√°rio, a Google Sheet √© automaticamente atualizada e apresentar√° a resposta. Podemos importar os dados usando a fun√ß√£o read_sheet(), como mostrado anteriormente:\nurl \u0026lt;- \u0026quot;https://docs.google.com/spreadsheets/d/1Ch3aMraacwhNo1sU4Z9b54nWYG8gdl18UfLJMzquL8s/\u0026quot;\rrespostas_formulario \u0026lt;- read_sheet(url)\rrespostas_formulario\r## # A tibble: 1 √ó 2\r## `Carimbo de data/hora` `Pergunta sem t√≠tulo`\r## \u0026lt;dttm\u0026gt; \u0026lt;chr\u0026gt; ## 1 2022-03-08 21:29:01 Op√ß√£o 1\r√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios. Postem tamb√©m quais fun√ß√µes do pacote voc√™s gostariam de saber mais!!\nAt√© a pr√≥xima!\n\r\rRefer√™ncias\r\rDocumenta√ß√£o do pacote googlesheets4\n\rDocumenta√ß√£o do pacote purrr\n\rRefer√™ncia da base Gapminder\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2022-03-08-googlesheets4/","tags":["api","google","importa√ß√£o","google sheets"],"title":"Acessando dados do Google Sheets com R"},{"author":["Tereza"],"categories":["tutoriais"],"contents":"\r\rO prettydoc √© um pacote que oferece alguns templates bem bonitos para serem utilizados em relat√≥rios HTML constru√≠dos com R Markdown. Nesse tutorial, vamos mostrar como usar esses templates em seus relat√≥rios!\nEnt√£o, vamos l√°:\nInstale o pacote {prettydoc}:\r\rinstall.packages(\u0026quot;prettydoc\u0026quot;)\rCrie um arquivo R Markdown.\r\rSelecione a op√ß√£o HTML como formato de sa√≠da, e ent√£o, clique em From Template.\r\rSelecione a op√ß√£o Lightweight and Pretty Document (HTML) e ent√£o, clique em OK.\r\rUm documento R Markdown como esse ser√° criado:\r\rO importante aqui √© o cabe√ßalho YAML (parte destacada na imagem), ele que vai garantir a personaliza√ß√£o do seu relat√≥rio.\nPodemos ver na imagem que existe um campo chamado theme, e √© nele que vamos especificar qual template queremos usar no nosso relat√≥rio!\nO prettydoc possui 5 templates, s√£o eles: cayman, tactile, architect, leonids, hpstr. Para alterar o template, basta modificar o nome no campo ‚Äútheme:‚Äù. Podemos ver que o template default √© o architect.\nPara visualizar cada template, basta colocar o respectivo nome no campo ‚Äútheme:‚Äù, e apertar o bot√£o Knit.\r\rVamos dar uma olhada em cada template:\ncayman:\r\rtactile:\r\rarchitect:\r\rleonids:\r\rhpstr:\rVoc√™ pode ver mais sobre os templates nessa p√°gina\nSe voc√™ j√° tem algum relat√≥rio em R Markdown e quer personaliz√°-lo, basta substituir o cabe√ßalho do seu relat√≥rio pelo cabe√ßalho que foi gerado no passo 4 (pelo prettydoc)\r\rPor exemplo, temos aqui esse relat√≥rio com a sa√≠da HTML:\nQue gera o seguinte HTML ao Knitar:\nAo substituir o cabe√ßalho (e alterar os campos de T√≠tulo, Autor e Data), o nosso documento ficou assim:\nAqui estamos usando o template cayman, mas voc√™ pode escolher o que preferir!\nE voil√†, ao Knitar esse documento, o seguinte HTML √© gerado:\n\r","permalink":"https://blog.curso-r.com/posts/2022-02-24-prettydoc/","tags":["tutoriais"],"title":"Personalizando seus relat√≥rios R Markdown em HTML com o {prettydoc}"},{"author":["Beatriz"],"categories":["pacotes"],"contents":"\r\rIntrodu√ß√£o\rEsse post faz parte de uma s√©rie sobre acesso √† APIs com R! O primeiro post foi uma introdu√ß√£o sobre como acessar APIs com R.\nNeste post mostraremos um exemplo usando a API do GitHub.\nO GitHub √© uma plataforma onde conseguimos hospedar reposit√≥rios (pastas com nossos c√≥digos e arquivos) com controle de vers√£o usando o Git, e podemos fazer muitas coisas utilizando a sua API. E como dissemos no post anterior: ‚Äúo primeiro passo para acessar qualquer API √© procurar uma documenta√ß√£o‚Äù. A boa not√≠cia √© que a documenta√ß√£o da API do GitHub est√° dispon√≠vel em Portugu√™s e √© bem detalhada!\nExistem muitas a√ß√µes poss√≠veis utilizando essa API. O que escolhemos para esse exemplo √© buscar os reposit√≥rios que pertencem √† uma organiza√ß√£o.\nSegundo a documenta√ß√£o, para consultar os reposit√≥rios que pertencem √† organiza√ß√£o octokit, podemos utilizar a seguinte busca:\nGET /orgs/octokit/repos\rO equivalente a isso usando o pacote httr √©:\n# url_base - nunca muda na mesma API\rurl_base \u0026lt;- \u0026quot;https://api.github.com\u0026quot; # endpoint - √© o que muda o resultado\rendpoint \u0026lt;- \u0026quot;/orgs/octokit/repos\u0026quot; # precisamos colar os textos para criar o link\ru_github \u0026lt;- paste0(url_base, endpoint) # ver como o texto ficou colado\r# u_github # \u0026gt; \u0026quot;https://api.github.com/orgs/octokit/repos\u0026quot;\r# fazer a requisi√ß√£o do tipo GET\rr_github \u0026lt;- httr::GET(u_github) r_github\r## Response [https://api.github.com/orgs/octokit/repos]\r## Date: 2022-02-19 16:45\r## Status: 200\r## Content-Type: application/json; charset=utf-8\r## Size: 181 kB\r## [\r## {\r## \u0026quot;id\u0026quot;: 417862,\r## \u0026quot;node_id\u0026quot;: \u0026quot;MDEwOlJlcG9zaXRvcnk0MTc4NjI=\u0026quot;,\r## \u0026quot;name\u0026quot;: \u0026quot;octokit.rb\u0026quot;,\r## \u0026quot;full_name\u0026quot;: \u0026quot;octokit/octokit.rb\u0026quot;,\r## \u0026quot;private\u0026quot;: false,\r## \u0026quot;owner\u0026quot;: {\r## \u0026quot;login\u0026quot;: \u0026quot;octokit\u0026quot;,\r## \u0026quot;id\u0026quot;: 3430433,\r## ...\rPodemos acessar o resultado usando a fun√ß√£o httr::content(), por√©m n√£o vamos colocar o resultado no post pois ficaria muito longo.\n# httr::content(r_github)\r\rO que √© o pacote gh?\rO pacote gh permite acessar a API do GitHub. A l√≥gica mostrada anteriormente se aplica para esse pacote tamb√©m: precisaremos consultar a documenta√ß√£o para verificar como fazer alguma tarefa com a API.\n\rPrimeiro exemplo com o pacote gh\rNeste exemplo, vamos buscar as informa√ß√µes sobre os reposit√≥rios que s√£o organiza√ß√£o Curso-R no GitHub, gerar um dataframe, e ao final fazer uma visualiza√ß√£o simples.\nInforma√ß√µes gerais da organiza√ß√£o Curso-R\rPodemos buscar informa√ß√µes sobre a organiza√ß√£o da Curso-R no GitHub:\ngh_curso_r \u0026lt;- gh::gh(\u0026quot;GET /orgs/{org}\u0026quot;,\rorg = \u0026quot;curso-r\u0026quot;)\rA sintaxe do pacote gh √© similar ao glue. Quando queremos buscar uma informa√ß√£o que est√° em uma vari√°vel (no caso ‚Äúcurso-r‚Äù), colocamos os {variavel} no primeiro argumento e escrevemos variavel= nos argumentos seguintes.\nComo vimos, o resultado √© uma lista. Para consultar o n√∫mero de reposit√≥rios p√∫blicos, podemos usar o $ para acessar essa informa√ß√£o dentro da lista:\ngh_curso_r$public_repos\r## [1] 303\rOlha s√≥, a Curso-R tem atualmente 303 reposit√≥rios p√∫blicos no GitHub! Temos muitos reposit√≥rios pois criamos um diferente para cada curso, para que quem faz aula com a gente tenha sempre um lugar para olhar todos os materiais, de forma organizada e independente.\n\rAcessando informa√ß√µes de reposit√≥rios\rPodemos buscar informa√ß√µes sobre os reposit√≥rios que pertencem √† organiza√ß√£o Curso-R no GitHub:\nrepositorios_cursor \u0026lt;- gh::gh(\u0026quot;GET /orgs/{org}/repos\u0026quot;, org = \u0026quot;curso-r\u0026quot;)\r# A classe que retorna √© uma lista\rclass(repositorios_cursor)\r## [1] \u0026quot;gh_response\u0026quot; \u0026quot;list\u0026quot;\r# √â uma lista grande!\rlength(repositorios_cursor)\r## [1] 30\rEsse c√≥digo retornou informa√ß√µes de apenas 30 reposit√≥rios. Portanto, precisamos repetir o processo para obter informa√ß√µes de todos os reposit√≥rios.\n\rIterando com purrr e o pacote gh\rA documenta√ß√£o do pacote aponta que √© poss√≠vel buscar informa√ß√µes de 100 reposit√≥rios por vez. Se queremos buscar todos os reposit√≥rios, primeiro precisamos calcular quantas vezes vamos repetir o processo todo:\nnumero_repos_publicos \u0026lt;- gh_curso_r$public_repos\r# podemos buscar 100 reposit√≥rios por vez,\r# ent√£o podemos dividir o numero de repositorios\r# por 100, e arredondar \u0026quot;para cima\u0026quot;\r# (√© para isso que a fun√ß√£o ceiling() serve!)\rnumero_paginas \u0026lt;- ceiling(numero_repos_publicos/100)\rnumero_paginas\r## [1] 4\rPrecisaremos repetir 4 vezes! Agora podemos usar a fun√ß√£o purrr::map() para repetir o acesso √† API quantas vezes forem necess√°rias para obter as informa√ß√µes de todos os reposit√≥rios da Curso-R:\nrepos_cursor \u0026lt;- purrr::map(1:numero_paginas, .f = ~gh::gh(\r\u0026quot;GET /orgs/{org}/repos\u0026quot;, org = \u0026quot;curso-r\u0026quot;, # organizacao\rtype = \u0026quot;public\u0026quot;, # tipo de repositorio sort = \u0026quot;updated\u0026quot;, # forma de ordenar a busca\rper_page = 100, # numero de resultados por pagina\rpage = .x # numero da pagina que ser√° substituido\r))\rO resultado ainda √© uma lista‚Ä¶ podemos usar a magia do pacote purrr e transformar essa lista em um dataframe:\nlista_repos \u0026lt;- repos_cursor |\u0026gt; purrr::flatten() |\u0026gt; purrr::map(unlist, recursive = TRUE) |\u0026gt; purrr::map_dfr(tibble::enframe, .id = \u0026quot;id_repo\u0026quot;) |\u0026gt; tidyr::pivot_wider() |\u0026gt; janitor::clean_names()\rlista_repos\r## # A tibble: 303 √ó 108\r## id_repo id node_id name full_name private owner_login owner_id\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 1 311969160 MDEwOlJlcG9za‚Ä¶ chess curso-r/‚Ä¶ FALSE curso-r 10060716\r## 2 2 154844030 MDEwOlJlcG9za‚Ä¶ auth0 curso-r/‚Ä¶ FALSE curso-r 10060716\r## 3 3 316277552 MDEwOlJlcG9za‚Ä¶ main‚Ä¶ curso-r/‚Ä¶ FALSE curso-r 10060716\r## 4 4 431987860 R_kgDOGb-clA 2022‚Ä¶ curso-r/‚Ä¶ FALSE curso-r 10060716\r## 5 5 249453848 MDEwOlJlcG9za‚Ä¶ tree‚Ä¶ curso-r/‚Ä¶ FALSE curso-r 10060716\r## 6 6 272436141 MDEwOlJlcG9za‚Ä¶ base‚Ä¶ curso-r/‚Ä¶ FALSE curso-r 10060716\r## 7 7 445626145 R_kgDOGo-3IQ main‚Ä¶ curso-r/‚Ä¶ FALSE curso-r 10060716\r## 8 8 163780826 MDEwOlJlcG9za‚Ä¶ shin‚Ä¶ curso-r/‚Ä¶ FALSE curso-r 10060716\r## 9 9 436799548 R_kgDOGgkIPA scryr curso-r/‚Ä¶ FALSE curso-r 10060716\r## 10 10 431978304 R_kgDOGb93QA 2022‚Ä¶ curso-r/‚Ä¶ FALSE curso-r 10060716\r## # ‚Ä¶ with 293 more rows, and 100 more variables: owner_node_id \u0026lt;chr\u0026gt;,\r## # owner_avatar_url \u0026lt;chr\u0026gt;, owner_gravatar_id \u0026lt;chr\u0026gt;, owner_url \u0026lt;chr\u0026gt;,\r## # owner_html_url \u0026lt;chr\u0026gt;, owner_followers_url \u0026lt;chr\u0026gt;, owner_following_url \u0026lt;chr\u0026gt;,\r## # owner_gists_url \u0026lt;chr\u0026gt;, owner_starred_url \u0026lt;chr\u0026gt;,\r## # owner_subscriptions_url \u0026lt;chr\u0026gt;, owner_organizations_url \u0026lt;chr\u0026gt;,\r## # owner_repos_url \u0026lt;chr\u0026gt;, owner_events_url \u0026lt;chr\u0026gt;,\r## # owner_received_events_url \u0026lt;chr\u0026gt;, owner_type \u0026lt;chr\u0026gt;, ‚Ä¶\rVamos fazer mais uma etapa de organiza√ß√£o dos dados: s√£o muitas colunas, e n√£o precisaremos de todas para terminar o post. Tamb√©m filtramos a base para remover os forks, j√° que n√£o seriam reposit√≥rios da Curso-R originalmente.\ndf_repos_cursor \u0026lt;- lista_repos |\u0026gt;\rdplyr::filter(fork == FALSE) |\u0026gt;\rdplyr::select(\rname,\rcreated_at,\rdefault_branch\r) |\u0026gt;\rdplyr::mutate(\rdata_criacao = readr::parse_datetime(created_at),\rano_criacao = as.Date(lubridate::floor_date(data_criacao, \u0026quot;year\u0026quot;))\r)\r\r\rExemplo de visualiza√ß√£o com os dados obtidos!\rEm 2020, o Caio escreveu um post sobre o uso do termo ‚Äòmaster‚Äô no GitHub. L√° no post √© explicado sobre a quest√£o da substitui√ß√£o do termo ‚Äòmaster‚Äô. Em 2020 a GitHub anunciou que faria a transi√ß√£o para o termo main (principal), e desde ent√£o muitas pessoas e organiza√ß√µes est√£o renomeando a branch principal de seus reposit√≥rios para ‚Äòmain‚Äô(inclusive existe um post no blog da RStudio sobre isso).\nUsando os dados obtidos nesse post, vamos explorar os reposit√≥rios da Curso-R e averiguar qual √© o nome da branch principal dos reposit√≥rios ao longo do tempo?\nlibrary(ggplot2)\rmain_percent \u0026lt;- mean(df_repos_cursor$default_branch == \u0026quot;main\u0026quot;)\rmain_percent \u0026lt;- scales::percent(main_percent)\rdf_repos_cursor |\u0026gt;\rdplyr::count(ano_criacao, default_branch) |\u0026gt;\rggplot() +\rgeom_col(aes(y = n, x = ano_criacao, fill = default_branch)) +\rtheme_bw() +\rscale_x_date(date_labels = \u0026quot;%Y\u0026quot;, date_breaks = \u0026quot;1 year\u0026quot;) +\rscale_fill_brewer(palette = \u0026quot;Pastel1\u0026quot;) +\rlabs(x = \u0026quot;Ano de cria√ß√£o\u0026quot;, y = \u0026quot;N√∫mero de reposit√≥rios\u0026quot;, fill = \u0026quot;Nome da Branch\u0026quot;)\r√â poss√≠vel ver que em 2021 o uso do termo ‚Äòmain‚Äô para nomear as branches principais foi muito mais usado! Atualmente, o percentual de reposit√≥rios main √© de 25% e esperamos que isso aumente com o tempo. Outra coisa legal do gr√°fico √© ver como a cria√ß√£o de reposit√≥rios na organiza√ß√£o da Curso-R foi crescendo ao longo do tempo!\n√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios. Postem tamb√©m quais exemplos, dentre os que foram listados, voc√™s gostariam de saber mais!!\nSe voc√™ quiser saber mais sobre acessar APIs, o curso de Web Scraping √© uma √≥tima oportunidade!\nAt√© a pr√≥xima!\n\rRefer√™ncias\r\rSlides do curso de Web Scraping sobre APIs\n\rSlides do curso de Deploy\n\rPacote httr\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2022-02-19-api-github-1/","tags":["api","github","git","purrr"],"title":"Acessando APIs com R: GitHub - Parte 1"},{"author":["Tereza"],"categories":["Desafio"],"contents":"\r\rEsse √© o primeiro post de uma s√©rie de desafios de ci√™ncia de dados que postaremos aqui no blog!\nOs desafios ser√£o bem variados, incluindo temas como Shiny, Manipula√ß√£o, Visualiza√ß√£o, etc‚Ä¶\nO intuito desses desafios √© mostrar como um problema pr√°tico na ci√™ncia de dados pode ter as mais diversas solu√ß√µes!\nPara isso, gostar√≠amos que voc√™ postasse a sua resolu√ß√£o em nosso Discourse, assim, voc√™ estaria contribuindo com a variedade de solu√ß√µes do problema, al√©m de poder receber dicas da comunidade de como melhorar o seu c√≥digo :)\nEnt√£o, vamos ao primeiro desafio!\nDesafio #1: Manipulando a base de filmes do IMDB\rVamos come√ßar com um desafio de manipula√ß√£o.\rPara esse desafio, vamos utilizar a base de filmes do IMDB. Voc√™ pode baix√°-la clicando aqui.\nDesafio: Escreva um c√≥digo que transforme a base do IMDB em uma base nomeada IMDB_atores, que deve ser formada pelas seguintes colunas:\n\rator: nome de um(a) ator/atriz\n(cada nome deve aparecer uma vez s√≥)\n\rnota_media_imdb: nota imdb m√©dia dos filmes que o(a) ator/atriz particiou\n\rmedia_lucro: lucro m√©dio dos filmes que o(a) ator/atriz participou\n(obs: lucro = receita - orcamento)\n\rtop1_genero: g√™nero mais frequente entre os filmes que o(a) ator/atriz particiou\n\rtop2_genero: segundo g√™nero mais frequente entre os filmes que o(a) ator/atriz particiou\n\rtop3_genero: terceiro g√™nero mais frequente entre os filmes que o(a) ator/atriz particiou\n\rprimeiro_registro: ano do primeiro filme que o(a) ator/atriz participou\n\rultimo_registro: ano do √∫ltimo filme que o(a) ator/atriz particiou\n\rfilmes: um data frame com informa√ß√µes de todos os filmes que o(a) ator/atriz participou, as colunas desse data frame devem ser as seguintes:\n\rt√≠tulo: nome do filme\rano: ano do filme\rdiretor: diretor(a) do filme\rduracao: dura√ß√£o do filme\rcor: cor do filme (Color ou Black and White)\rgeneros: generos do filme\rpais: pa√≠s do filme\rclassificacao: classifica√ß√£o et√°ria do filme\rnota_imdb: nota imbd do filme\rorcamento: orcamento do filme\rreceita: receita do filme\rlucro: lucro do filme\r\rcontracenou: um vetor com os nomes de todos os(as) atores/atrizes que o(a) ator/atriz j√° contracenou (ou seja, participou do mesmo filme)\n\r\rPoste a sua resolu√ß√£o em nosso Discourse, respondendo o t√≥pico criado para esse desafio!\n\r","permalink":"https://blog.curso-r.com/posts/2022-02-02-desafio-1/","tags":["desafio curso-r","manipula√ß√£o"],"title":"Desafio #1: Manipulando a base de filmes do IMDB"},{"author":["Tereza"],"categories":["tutoriais"],"contents":"\r\rO clipr √© um pacote composto por algumas fun√ß√µes que permitem importar/exportar objetos do R atrav√©s da √°rea de transfer√™ncia!\nEssas fun√ß√µes s√£o muito √∫teis para, por exemplo, copiar objetos do excel, powerpoint ou word para o R, e vice-versa.\nNesse post, vamos mostrar como copiar tabelas do R para o Excel, e como copiar tabelas do Excel para o R atrav√©s desse pacote! Sem mais delongas, vamos aos tutoriais:\nCopiando tabelas do R para o Excel atrav√©s da √°rea de transfer√™ncia\rCarregue o pacote clipr\r\rlibrary(clipr)\rAgora, basta usar a tabela escolhida como argumento da fun√ß√£o write_clip. No nosso caso, queremos copiar a tabela mtcars\r\rwrite_clip(mtcars)\rAbra um novo arquivo excel, use o atalho crtl + v e voil√†!\r\rNote que por default, o separador decimal usado √© o ponto. Para mudar isso, basta usar o argumento dec = \",\"\nwrite_clip(mtcars, dec = \u0026quot;,\u0026quot;)\rUsando o atalho ctrl + v no arquivo excel:\nTamb√©m podemos usar o operador pipe, obtendo o mesmo resultado do passo anterior:\nmtcars %\u0026gt;% write_clip(dec = \u0026quot;,\u0026quot;)\rAl√©m disso, a fun√ß√£o tamb√©m pode receber outros argumentos. Por exemplo, com o argumento col.names = FALSE a tabela ser√° copiada sem os nomes das colunas\nmtcars %\u0026gt;% write_clip(dec = \u0026quot;,\u0026quot;, col.names = FALSE)\rUsando o atalho ctrl + v no arquivo excel:\n\rCopiando tabelas do Excel para o R atrav√©s da √°rea de transfer√™ncia\rCarregue o pacote clipr\r\rlibrary(clipr)\rNo excel, selecione a tabela desejada, e a copie atrav√©s do comando ctrl + c. No nosso caso, estamos copiando a base mtcars (no formato .xlsx)\r\rAgora, v√° at√© o R e use o seguinte comando:\r\rbase_de_dados \u0026lt;- read_clip_tbl()\r(base_de_dados √© apenas um nome gen√©rico que estamos dando para esse data.frame, voc√™ pode nomear como preferir)\nE prontinho! Vamos visualizar o objeto base_de_dados:\nbase_de_dados[1:11, ]\r## mpg cyl disp hp drat wt qsec vs am gear carb\r## 1 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4\r## 2 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4\r## 3 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1\r## 4 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1\r## 5 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2\r## 6 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1\r## 7 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4\r## 8 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2\r## 9 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2\r## 10 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4\r## 11 17.8 6 167.6 123 3.92 3.440 18.90 1 0 4 4\rTamb√©m podemos usar alguns argumentos na fun√ß√£o read_clip_tbl. Por exemplo, considere que temos uma base de dados no formato .csv:\nSe quisermos copiar a tabela mtcars no formato .csv do excel para o R, por exemplo, basta usar o argumento sep para especificar o separador usado, que √© a v√≠rgula:\nbase_de_dados2 \u0026lt;- read_clip_tbl(sep = \u0026quot;,\u0026quot;)\rVamos visualizar o objeto base_de_dados2:\nbase_de_dados2[1:11, ]\r## X mpg cyl disp hp drat wt qsec vs am gear carb\r## 1 Mazda RX4 21.0 6 160.0 110 3.90 2.620 16.46 0 1 4 4\r## 2 Mazda RX4 Wag 21.0 6 160.0 110 3.90 2.875 17.02 0 1 4 4\r## 3 Datsun 710 22.8 4 108.0 93 3.85 2.320 18.61 1 1 4 1\r## 4 Hornet 4 Drive 21.4 6 258.0 110 3.08 3.215 19.44 1 0 3 1\r## 5 Hornet Sportabout 18.7 8 360.0 175 3.15 3.440 17.02 0 0 3 2\r## 6 Valiant 18.1 6 225.0 105 2.76 3.460 20.22 1 0 3 1\r## 7 Duster 360 14.3 8 360.0 245 3.21 3.570 15.84 0 0 3 4\r## 8 Merc 240D 24.4 4 146.7 62 3.69 3.190 20.00 1 0 4 2\r## 9 Merc 230 22.8 4 140.8 95 3.92 3.150 22.90 1 0 4 2\r## 10 Merc 280 19.2 6 167.6 123 3.92 3.440 18.30 1 0 4 4\r## 11 Merc 280C 17.8 6 167.6 123 3.92 3.440 18.90 1 0 4 4\rObs: Para limpar a area de tranferencia, basta usar o comando clear_clip()\n\r","permalink":"https://blog.curso-r.com/posts/2021-12-27-clipr/","tags":["tutoriais"],"title":"Importando e exportando tabelas do R para o Excel atrav√©s da √°rea de transfer√™ncia"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rSabe aquelas imagens que aparecem quando voc√™ est√° preenchendo um formul√°rio ou quer acessar uma p√°gina espec√≠fica, pedindo para voc√™ decifrar o texto? Isso √© o que chamamos de CAPTCHA (Completely Automated Public Turing test to tell Computers and Humans Apart).\n\r\rFigura: Exemplo de captcha do site do Tribunal Regional do Trabalho (TRT).\r\rO Captcha √© um desafio computacional criado para ser dif√≠cil de resolver por m√°quinas mas f√°cil de resolver por pessoas. No in√≠cio, a maioria dos Captchas eram formados por letras aleat√≥rias inseridas em imagens ou √°udios com algum ru√≠do. Com a populariza√ß√£o das t√©cnicas de Deep Learning, esses desafios se tornaram f√°ceis de resolver por m√°quinas, desde que exista uma base suficientemente grande de exemplos classificados.\nEm posts anteriores aqui do blog, eu mostrei como resolvemos Captchas na m√£o ou usando redes neurais convolucionais. Todos esses posts usavam o {keras} como backend, que era a tecnologia de deep learning que eu conhecia na √©poca.\n\rObserva√ß√£o: alguns dos posts anteriores de Captchas n√£o est√£o vis√≠veis. Algum dia vou reviv√™-los!\n\rNeste post, vou mostrar como resolver um Captcha de texto em imagem usando o pacote {luz}. O pacote surgiu para facilitar a vida de quem constr√≥i modelos de Deep Learning usando o {torch}.\nO que √© {torch}? O que √© {luz}?\rO {torch} √© um pacote do R criado pelo nosso s√≥cio Daniel Falbel, que tamb√©m trabalha na RStudio. O pacote √© uma adapta√ß√£o do pytorch, biblioteca de python muito popular para fazer contas de √°lgebra matricial e diferencia√ß√£o autom√°tica utilizando GPUs, que s√£o os principais ingredientes utilizados na constru√ß√£o e ajuste de modelos de Deep Learning. A empresa por tr√°s do projeto Torch √© o Facebook (Meta?).\n\rA dificuldade do pacote {torch} para pessoas que est√£o come√ßando √© a complexidade da sintaxe. A ferramenta √© super flex√≠vel, permitindo o ajuste de modelos customizados, mas a constru√ß√£o desses modelos est√° longe de ser trivial. Por exemplo, √© comum precisar implementar os passos de atualiza√ß√£o dos par√¢metros manualmente a partir de algumas fun√ß√µes b√°sicas do pacote.\nO pacote {luz} ‚Äì sim, o nome √© uma brincadeira com a luz que sai de uma tocha‚Ä¶ ü•Å ‚Äì vem com a ideia de facilitar um pouco esse processo. Para conseguir rodar um modelo de deep learning usando o luz, precisamos de apenas i) um dataset/dataloader constru√≠do para gerar amostras das bases de dados de treino/valida√ß√£o e ii) um modelo, que deve ser um m√≥dulo do torch.\n\rVamos investigar os elementos do luz a seguir. Como exemplo, utilizaremos os nossos queridos Captchas, para n√£o ficar na mesmisse do MNIST üòâ\nO exemplo da vez ser√° o TRT, pois a base √© pequenininha e √© um Captcha relativamente f√°cil de resolver.\n\r\rDados, datasets e dataloaders\rUma caracter√≠stica importante de modelos de deep learning √© que as bases de dados costumam ser bem grandes. Por isso, foram desenvolvidas t√©cnicas que atualizam os par√¢metros do modelo com base apenas em uma amostra dos dados, sem a necessidade de carregar todas as observa√ß√µes na mem√≥ria do computador. Essa estrat√©gia parece um pouco estranha de in√≠cio, mas existem muitos estudos que demonstram que elas n√£o s√≥ funcionam como tamb√©m t√™m chances de trazer propriedades de regulariza√ß√£o ao modelo.\nNesse contexto surgem os dataset()s e dataloader()s do torch. O dataset √© um objeto respons√°vel por informar como uma base de dados deve ser acessada (por exemplo, lendo uma imagem, um arquivo csv ou um √°udio), e de que forma podemos obter um item dessa base. O dataset √© um objeto de classe R6, que √© uma esp√©cie de orienta√ß√£o a objetos do R desenvolvida pela RStudio.\nAbaixo, temos o esqueleto de um dataset do torch:\n# isso cria um dataset generator\rds_generator \u0026lt;- torch::dataset(\rname = \u0026quot;meu nome!\u0026quot;,\robjeto_arbitrario = \u0026quot;voc√™ pode criar objetos arbitr√°rios aqui\u0026quot;,\r# isso √© rodado quando voc√™ cria o dataset(), com par√¢metros\rinitialize = function(parametro1, parametro2, repeticoes) {\r# c√≥digo arbitr√°rio\rdados \u0026lt;- matrix(\rc(parametro1, parametro2),\rncol = 2, nrow = repeticoes, byrow = TRUE\r)\r## registra os dados para ser usado em outro lugar\rself$dados \u0026lt;- dados\r},\r# fun√ß√£o que pega um item da base\r.getitem = function(index) {\rself$dados[index, ]\r},\r# fun√ß√£o que mede o tamanho da base\r.length = function() {\rnrow(self$dados)\r}\r)\r# para criar o dataset mesmo:\rds \u0026lt;- ds_generator(\u0026quot;ola\u0026quot;, \u0026quot;mundo\u0026quot;, 5)\r\u0026lt;meu nome!\u0026gt;\rInherits from: \u0026lt;dataset\u0026gt;\rPublic:\r.getitem: function (ii) .length: function () clone: function (deep = FALSE) dados: ola ola ola ola ola mundo mundo mundo mundo mundo\rinitialize: function (parametro1, parametro2, repeticoes) objeto_arbitrario: voc√™ pode criar objetos arbitr√°rios aqui\rOs objetos registrados podem ser acessados dessa forma:\nds$dados\rLegal! agora temos nosso dataset. Agora precisamos de um m√©todo para gerar amostras desse dataset. Esse √© o dataloader, que pode ser criado assim:\n [,1] [,2] [1,] \u0026quot;ola\u0026quot; \u0026quot;mundo\u0026quot;\r[2,] \u0026quot;ola\u0026quot; \u0026quot;mundo\u0026quot;\r[3,] \u0026quot;ola\u0026quot; \u0026quot;mundo\u0026quot;\r[4,] \u0026quot;ola\u0026quot; \u0026quot;mundo\u0026quot;\r[5,] \u0026quot;ola\u0026quot; \u0026quot;mundo\u0026quot;\rdl \u0026lt;- torch::dataloader(ds, batch_size = 2)\rdl\r\u0026lt;dataloader\u0026gt;\rPublic:\r.auto_collation: active binding\r.dataset_kind: map\r.has_getbatch: FALSE\r.index_sampler: active binding\r.iter: function () .length: function () batch_sampler: utils_sampler_batch, utils_sampler, R6\rbatch_size: 2\rclone: function (deep = FALSE) collate_fn: function (batch) dataset: meu nome!, dataset, R6\rdrop_last: FALSE\rgenerator: NULL\rinitialize: function (dataset, batch_size = 1, shuffle = FALSE, sampler = NULL, multiprocessing_context: NULL\rnum_workers: 0\rpin_memory: FALSE\rsampler: utils_sampler_sequential, utils_sampler, R6\rtimeout: -1\rworker_globals: NULL\rworker_init_fn: NULL\rworker_packages: NULL\rIsso pode ser usado para gerar amostras da base de dados, o que √© importante para a etapa de ajuste de modelos realizadas pelo {torch} e pelo {luz}.\nNo caso dos captchas, eu montei uma fun√ß√£o do pacote {captcha} que cria os dataloaders de treino e valida√ß√£o a partir de uma fun√ß√£o que faz o download dos arquivos brutos.\n\rpath \u0026lt;- \u0026quot;caminho/para/arquivos/brutos\u0026quot;\r# cria o dataset. No caso, estamos usando a base do TRT, # que tem apenas 400 Captchas.\rcaptcha_ds \u0026lt;- captcha::captcha_dataset(\rroot = path,\rcaptcha = \u0026quot;trt2\u0026quot;,\rdownload = TRUE\r)\r# cria os dataloaders de treino e valida√ß√£o\r## amostra de indices\rid_train \u0026lt;- sample(1:length(captcha_ds), .8 * length(captcha_ds))\r## cria o dataloader de treino\rcaptcha_dl_train \u0026lt;- torch::dataloader(\rtorch::dataset_subset(captcha_ds, id_train),\rbatch_size = 32,\rshuffle = TRUE\r)\r## cria o dataloader de valida√ß√£o\rcaptcha_dl_valid \u0026lt;- torch::dataloader(\rtorch::dataset_subset(captcha_ds, -id_train),\rbatch_size = 32\r)\r\rModelo\rUm modelo do torch tamb√©m √© um objeto de classe R6, mas que precisa ter os par√¢metros initialize= e forward= implementados. Aqui um exemplo que soma um n√∫mero ao valor de entrada:\nmodel_generator \u0026lt;- torch::nn_module(\r\u0026quot;meu modelo!\u0026quot;,\r# aqui inicializamos nosso modelo\rinitialize = function(parametro) {\rself$valor \u0026lt;- parametro\r},\r# aqui calculamos o que o modelo deve calcular\rforward = function(x) {\rx + self$valor\r}\r)\rmodel_generator\r\u0026lt;meu modelo!\u0026gt; object generator\rInherits from: \u0026lt;inherit\u0026gt;\rPublic:\r.classes: meu modelo! nn_module\rinitialize: function (parametro) forward: function (x) clone: function (deep = FALSE) Parent env: \u0026lt;environment: 0x5594bc41f3c0\u0026gt;\rLocked objects: FALSE\rLocked class: FALSE\rPortable: TRUE\rPor exemplo, o modelo abaixo somar√° 10 ao valor de entrada\nmodelo \u0026lt;- model_generator(10)\rmodelo(1)\r[1] 11\rNo nosso caso, utilizaremos um modelo j√° implementado no pacote {captcha}, que utiliza redes neurais convolucionais. √â importante mencionar que n√£o √© necess√°rio criar o modelo: utilizaremos apenas o model generator.\ncaptcha::net_captcha\r\u0026lt;CAPTCHA-CNN\u0026gt; object generator\rInherits from: \u0026lt;inherit\u0026gt;\rPublic:\r.classes: CAPTCHA-CNN nn_module\rinitialize: function (input_dim, output_ndigits, output_vocab_size) forward: function (x) clone: function (deep = FALSE) Parent env: \u0026lt;environment: 0x557dc107da60\u0026gt;\rLocked objects: FALSE\rLocked class: FALSE\rPortable: TRUE\r\rTreino\rE agora chegamos na parte mais legal. Com o {luz}, temos uma sintaxe parecida com o {keras}, em que fazemos o setup do modelo e depois ajustamos, com direito a uma barrinha de progresso que j√° vem automaticamente ü§©\nfitted \u0026lt;- captcha::net_captcha |\u0026gt;\r# aqui colocamos a fun√ß√£o de perda e o otimizador\rluz::setup(\rloss = torch::nn_multilabel_soft_margin_loss(),\roptimizer = torch::optim_adam\r) |\u0026gt;\r# aqui n√≥s colocamos os hiperpar√¢metros do modelo\r# no caso, precisamos passar informa√ß√µes sobre a dimens√£o\r# da imagem, o tamanho do vocabul√°rio e a quantidade de letras\r# em um captcha\rluz::set_hparams(\rinput_dim = dim(captcha_ds$data)[-1],\routput_vocab_size = dim(captcha_ds$target)[3],\routput_ndigits = dim(captcha_ds$target)[2]\r) |\u0026gt;\r# aqui n√≥s colocamos os hiperpar√¢metros de otimiza√ß√£o\rluz::set_opt_hparams(\rlr = .1\r) |\u0026gt;\r# ajustar o modelo\rluz::fit(\rcaptcha_dl_train,\rvalid_data = captcha_dl_valid,\repochs = 30\r)\rE pronto! Agora √© s√≥ ver o modelo rodar e mexer nos hiperpar√¢metros para que o modelo alcance a acur√°cia desejada.\n\rExtra: m√©trica customizada\rUma coisa que ficou faltando no c√≥digo anterior √© uma ideia de como fica a acur√°cia do modelo ao longo do ajuste. Como n√£o existe uma m√©trica j√° pronta para calcular o quanto acertamos das 6 letras ao mesmo tempo, precisamos implementar uma m√©trica customizada para o Captcha.\nIsso n√£o √© um grande desafio para o {luz}! Assim como nos datasets e modelos, podemos criar uma m√©trica com uma classe R6, usando a fun√ß√£o luz::luz_metric(). Essa classe deve ter 4 elementos: abbrev=, o nome da m√©trica, initialize= que seta os par√¢metros iniciais, update= que atualiza a m√©trica a partir de um conjunto novo de outputs e predi√ß√µes e compute= que calcula a m√©trica atualizada.\nNo caso dos Captchas, a m√©trica fica assim:\ncaptcha_accuracy \u0026lt;- luz::luz_metric(\rabbrev = \u0026quot;Captcha Acc\u0026quot;,\rinitialize = function() {\r# inicializa os par√¢metros\rself$correct \u0026lt;- 0\rself$total \u0026lt;- 0\r},\rupdate = function(preds, target) {\r# extra√≠mos o token com maior probabilidade associada, para cada letra\rpred \u0026lt;- torch::torch_argmax(preds, dim = 3)\r# fazemos o mesmo para a vari√°vel resposta\rtgt \u0026lt;- torch::torch_argmax(target$squeeze(), dim = 3)\r# comparamos os dois resultados e somamos a quantidade de resultados iguais\rnew_correct \u0026lt;- torch::torch_sum(pred == tgt, 2) == dim(pred)[2]\rnew_correct \u0026lt;- new_correct$to(dtype = torch::torch_float())$sum()$item()\r# atualizamos os valores\rself$correct \u0026lt;- self$correct + new_correct\rself$total \u0026lt;- self$total + dim(pred)[1]\r},\rcompute = function() {\r# calcula a propor√ß√£o de acertos\rself$correct / self$total\r}\r)\r\rResultados\rO c√≥digo completo de ajuste do modelo pode ser encontrado aqui. A sintaxe do pacote {captcha} ainda est√° inst√°vel, ent√£o pode ser que o c√≥digo quebre no futuro.\nCom o c√≥digo, consegui chegar em uma acur√°cia de 90% com apenas 400 exemplos classificados!\nAbaixo, um exemplinho de aplica√ß√£o:\ncaptcha \u0026lt;- captcha_ds$files[1]\rcaptcha |\u0026gt; captcha::read_captcha() |\u0026gt; plot()\r\rfitted \u0026lt;- luz::luz_load(\u0026quot;caminho/para/trt.pt\u0026quot;)\rcaptcha::decrypt(captcha, fitted)\r[1] \u0026quot;2n73k7\u0026quot;\r\rWrap-up\rNeste post, vimos que\n\rO pacote {luz} √© uma alterativa ao {keras} que usa o {torch} como backend.\rPara trabalhar com o {luz}, √© necess√°rio criar datasets, dataloaders e modelos na forma de classes R6.\rCom o {luz}, √© poss√≠vel criar m√©tricas customizadas para acompanhar o desempenho de um modelo.\rOs modelos de redes neurais convolucionais funcionam bem em tarefas de vis√£o computacional, como os Captchas.\r\r√â isso. Happy coding ;)\n\rAgradecimentos\rUm agradecimento especial √† Beatriz Milz pela revis√£o do post!\n\r","permalink":"https://blog.curso-r.com/posts/2021-12-27-captcha-luz/","tags":["torch","luz"],"title":"Resolvendo Captchas com o {luz}"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nPepino-do-mar (A)\rFinalmente chegamos ao √∫ltimo dia do AoC\rdeste ano! O problema de hoje foi um verdadeiro presente de Natal: bem mais\rsimples que todos os dias anteriores. Nossa miss√£o era acompanhar os movimentos\rde dois grupos de pepinos-do-mar e encontrar o momento em que eles n√£o poderiam\rmais se mover.\nOs pepinos estavam dispostos em uma matriz retangular e se moviam na dire√ß√£o\rpara a qual estavam apontando. Se o espa√ßo em frente ao pepino estivesse vago\r(.), ent√£o ele se movia.\n# Estado inicial:\r# ...\u0026gt;...\r# .......\r# ......\u0026gt;\r# v.....\u0026gt;\r# ......\u0026gt;\r# .......\r# ..vvv..\r#\r# Depis de 1 passo:\r# ..vv\u0026gt;..\r# .......\r# \u0026gt;......\r# v.....\u0026gt;\r# \u0026gt;......\r# .......\r# ....v..\r#\r# Depois de 58 passos (todos travados):\r# ..\u0026gt;\u0026gt;v\u0026gt;vv..\r# ..v.\u0026gt;\u0026gt;vv..\r# ..\u0026gt;\u0026gt;v\u0026gt;\u0026gt;vv.\r# ..\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;vv.\r# v......\u0026gt;vv\r# v\u0026gt;v....\u0026gt;\u0026gt;v\r# vvv.....\u0026gt;\u0026gt;\r# \u0026gt;vv......\u0026gt;\r# .\u0026gt;v.vv.v..\rMeu c√≥digo ficou simples. Eu li o mapa do fundo do mar como uma matriz e\rcalculei todos os pepinos que podiam se mover; quando nenhum mais pudesse, eu\rretornava o n√∫mero de passos transcorridos.\n# Ler fundo do mar como matriz\rseafloor \u0026lt;- \u0026quot;data-raw/25a_sea_cucumber.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\rmatrix(nrow = 137, ncol = 139, byrow = TRUE)\r# Iterar enquanto ainda h√° movimentos\ri \u0026lt;- 0\rwhile (TRUE) {\ri \u0026lt;- i + 1\r# Todos os pepinos\re \u0026lt;- which(seafloor == \u0026quot;\u0026gt;\u0026quot;)\rs \u0026lt;- which(seafloor == \u0026quot;v\u0026quot;)\r# As suas pr√≥ximas posi√ß√µes\rnext_e \u0026lt;- ((e + 137) %% 19043) + ((e + 137) %% 19043 == 0) * 19043\rnext_s \u0026lt;- s + 1 - (s %% 137 == 0) * 137\r# Mover todos os pepinos virados para a esquerda\rallowed_e \u0026lt;- seafloor[next_e] == \u0026quot;.\u0026quot;\rseafloor[next_e[allowed_e]] \u0026lt;- seafloor[e[allowed_e]]\rseafloor[e[allowed_e]] \u0026lt;- \u0026quot;.\u0026quot;\r# Mover todos os pepinos virados para baixo\rallowed_s \u0026lt;- seafloor[next_s] == \u0026quot;.\u0026quot;\rseafloor[next_s[allowed_s]] \u0026lt;- seafloor[s[allowed_s]]\rseafloor[s[allowed_s]] \u0026lt;- \u0026quot;.\u0026quot;\r# Verificar condi√ß√£o de parada\rif (all(!allowed_e) \u0026amp;\u0026amp; all(!allowed_s)) break\r}\r# Imprimir\rprint(i)\r#\u0026gt; [1] 518\r\rPepino-do-mar (B)\rO segundo item me pegou de surpresa porque‚Ä¶ N√£o havia segundo item! A\rhistorinha que estava sendo contada ao longo do AoC foi finalmente conclu√≠da e\rganhamos a √∫ltima estrela de gra√ßa.\nE esse foi o fim da aventura. Muito obrigado por me acompanhar nesses √∫ltimos 25\rdias de programa√ß√£o intensa! Espero que tenham gostado e, at√© que enfim, boas\rfestas!\n\r","permalink":"https://blog.curso-r.com/posts/2021-12-25-advent-of-r-25/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 25"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nUnidade l√≥gica e aritm√©tica (A e B)\rO pen√∫ltimo dia do AoC de 2021 chegou e,\rcom ele, mais um problema que era mais f√°cil de resolver na m√£o! Hoje e ontem\rv√£o ficar na hist√≥ria como exerc√≠cios de l√≥gica e n√£o de programa√ß√£o.\nSem mais delongas, deixo voc√™s com outra tirinha do\rXKCD:\n\r","permalink":"https://blog.curso-r.com/posts/2021-12-24-advent-of-r-24/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 24"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nAnf√≠podes (A e B)\rO dia 23 do AoC foi‚Ä¶ Estranho. O\renunciado era f√°cil de entender, mas o c√≥digo foi imposs√≠vel de fazer. E n√£o\restou exagerando: eu literamente n√£o consegui fazer o c√≥digo para resolver o\rexerc√≠cio. √â verdade que eu fiquei doente hoje, ent√£o n√£o sei se meus neur√¥nios\restavam de cama.\nNo meu desespero, fui olhar o\rsubreddit do Advent\rem busca de sugest√µes de outros programadores e, quando cheguei l√°, descobri que\rv√°rias pessoas estavam resolvendo o problema na m√£o! Uma boa alma tinha at√©\rcriado um\rhelper online!\nNo final, a minha li√ß√£o do dia de hoje √© que nem sempre o jeito mais r√°pido de\rresolver um problema √© programando; √†s vezes √© mais f√°cil usar a cabe√ßa mesmo.\rNo caso, a cabe√ßa da Renata Hirota, que\rresolveu o problema na m√£o em 10 minutos depois de eu ter passado o dia inteiro\rna frente do computador tentando achar uma solu√ß√£o.\nSendo assim, deixo voc√™s com uma tirinha do XKCD:\n\r","permalink":"https://blog.curso-r.com/posts/2021-12-23-advent-of-r-23/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 23"},{"author":["Tereza"],"categories":["tutoriais"],"contents":"\r\rEste tutorial √© para voc√™ que quer usar o R Markdown para criar arquivos em Word e quer ter maior controle sobre a formata√ß√£o desses documentos!\n√â uma dica muito √∫til, pois voc√™ n√£o ter√° mais que perder tempo formatando o seu relat√≥rio depois de escrev√™-lo, ele j√° sair√° estilizado e formatado do jeito que voc√™ quiser!\nEnt√£o, vamos ao tutorial:\nAbra o RStudio e crie um arquivo R Markdown.\r\rSelecione a op√ß√£o Word como formato de sa√≠da.\r\rSalve o arquivo.\n\rD√™ um Knit, apertando no bot√£o do canto superior esquerdo (ou Knit to Word).\n\r\rUm arquivo Word aparecer√° na sua tela, como esse:\r\rAgora, edite esse arquivo com a formata√ß√£o que deseja ter em seu relat√≥rio!\n\rClique no bot√£o do canto inferior direito da aba Estilos. Deixe essa aba aberta.\n\r\rClique em cima do t√≠tulo (‚ÄúUntitled‚Äù, na imagem), e note que na aba Estilos a caixa T√≠tulo ser√° automaticamente selecionada.\r\rClique na seta √† direita da caixa T√≠tulo, e ent√£o, em Modificar.\r\rEdite a formata√ß√£o do jeito que preferir. No nosso exemplo, ficou assim:\r\rQuando terminar a edi√ß√£o, clique em Ok no canto inferior direito.\n\rPara editar outro elemento do texto, basta clicar em cima desse elemento, e a caixa do elemento ser√° automaticamente selecionada na aba Estilos. (na imagem exemplo, clicamos no link ‚Äúhttp://rmarkdown.rstudio.com‚Äù e na aba ‚ÄúEstilos‚Äù a caixa de Hiperlink foi automaticamente selecionada)\n\r\rProssiga como anteriormente, clicando na seta √† direita da caixa, e ent√£o, em Modificar.\n\rQuando a formata√ß√£o estiver do jeito que voc√™ quiser, salve o arquivo. Aqui estamos usando o nome Template_1.docx. Feche o arquivo.\n\r\rVoltando ao RStudio, crie outro arquivo R Markdown, com Word como formato de sa√≠da.\n\rEscreva o seu relat√≥rio.\n\rEdite o come√ßo do texto, especificando o seu arquivo de refer√™ncia (sim, o arquivo que voc√™ acabou de editar!), ele deve ficar assim:\n\r\rSalve o arquivo.\n\rD√™ um Knit, apertando no bot√£o do canto superior esquerdo (ou Knit to Word).\n\rProntinho! Aparecer√° na tela o arquivo Word com o seu relat√≥rio personalizado como no arquivo de refer√™ncia!\n\r\rObs: Antes de apertar o bot√£o Knit, certifique-se de que o arquivo Word est√° fechado. Se n√£o, aparecer√° um erro na tela do R.\n","permalink":"https://blog.curso-r.com/posts/2021-12-23-word-rmarkdown/","tags":["tutoriais"],"title":"Criando um relat√≥rio personalizado no Word atrav√©s do R Markdown"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nReinicializa√ß√£o do Reator (A)\rO dia 22 do AoC foi mais um cujo\renunciado n√£o apresentou dificuldades. N√£o que a resolu√ß√£o tenha sido f√°cil, mas\rpelo menos o problema foi f√°cil de entender.\nEssencialmente t√≠nhamos que reiniciar o reator do submarino seguindo uma s√©rie\rde instru√ß√µes (a entrada do problema). O reator era composto por uma grade\rgigantesca feita de cubos 1x1x1 que come√ßavam todos desligados; cada instru√ß√£o\rnos dava uma regi√£o do reator que precisava ser desligada ou ligada:\n# on x=10..12,y=10..12,z=10..12\r# on x=11..13,y=11..13,z=11..13\r# off x=9..11,y=9..11,z=9..11\r# on x=10..10,y=10..10,z=10..10\rO primeiro comando da lista acima, por exemplo, ligava todos os cubos dentro da\rmatrix reator[10:12, 10:12, 10:12]. Nosso objetivo no primeiro item era contar\rtodos os cubos que estariam acessos no final do processo de reinicializa√ß√£o, mas\rlevando em conta apenas os cubos dentro da regi√£o denotada por\rx=-50..50,y=-50..50,z=-50..50.\nO c√≥digo era bastante simples de escrever usando a fun√ß√£o array() do R,\rprestando aten√ß√£o apenas ao fato de que as coordenadas da array dever√≠am ir de\r1 a 101 e n√£o de -50 a 50.\n# Ler todos os passos como uma tabela\rsteps \u0026lt;- \u0026quot;data-raw/22a_reactor_reboot.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;[ ,]|(\\\\.\\\\.)\u0026quot;) |\u0026gt;\rpurrr::transpose() |\u0026gt;\rpurrr::set_names(\u0026quot;state\u0026quot;, \u0026quot;x1\u0026quot;, \u0026quot;x2\u0026quot;, \u0026quot;y1\u0026quot;, \u0026quot;y2\u0026quot;, \u0026quot;z1\u0026quot;, \u0026quot;z2\u0026quot;) |\u0026gt;\rpurrr::map(purrr::flatten_chr) |\u0026gt;\rtibble::as_tibble() |\u0026gt;\rdplyr::mutate(\rdplyr::across(dplyr::ends_with(\u0026quot;1\u0026quot;), stringr::str_remove, \u0026quot;[a-z]=\u0026quot;),\rdplyr::across(c(-state), as.integer),\rx = purrr::map2(x1, x2, `:`),\ry = purrr::map2(y1, y2, `:`),\rz = purrr::map2(z1, z2, `:`)\r) |\u0026gt;\rdplyr::select(state, x, y, z)\r# Criar reator como uma array 3D\rreactor \u0026lt;- array(rep(\u0026quot;off\u0026quot;, 303), dim = c(101, 101, 101))\r# Iterar nos passos\rfor (i in seq_len(nrow(steps))) {\r# Coordenadas do cub√≥ide\rx \u0026lt;- steps$x[[i]] + 51\ry \u0026lt;- steps$y[[i]] + 51\rz \u0026lt;- steps$z[[i]] + 51\r# Eliminar o que estiver fora do cubo -50:50\rx \u0026lt;- x[x \u0026gt;= 1 \u0026amp; x \u0026lt;= 101]\ry \u0026lt;- y[y \u0026gt;= 1 \u0026amp; y \u0026lt;= 101]\rz \u0026lt;- z[z \u0026gt;= 1 \u0026amp; z \u0026lt;= 101]\r# Atribuir estado\rreactor[x, y, z] \u0026lt;- steps$state[i]\r}\r# Contar cubos ligados\rsum(reactor == \u0026quot;on\u0026quot;)\r#\u0026gt; [1] 647076\r\rReinicializa√ß√£o do Reator (B)\rSem muita surpresa, o item 2 pedia para contarmos o n√∫mero de cubos ligados ao\rfinal do processo de reinicializa√ß√£o em todo o reator. Olhando o c√≥digo acima,\rparece que s√≥ seria necess√°rio mudar as dimens√µes da array e tirar os filtros\rdentro do loop, certo? Infelizmente n√£o, pois com esse algoritmo ineficiente\rprecisar√≠amos contar aproximadamente 2 quadrilh√µes de cubos‚Ä¶\nA solu√ß√£o foi, ent√£o, calcular apenas os limites das regi√µes e lidar com as suas\rintersec√ß√µes. Ou seja, se dois cub√≥ides tiverem que ser ligados, ent√£o podemos\rtomar nota das suas coordenadas e adicionar um novo cub√≥ide de ‚Äúsubtra√ß√£o‚Äù na\rnossa lista que servir√° para remover uma c√≥pia da intersec√ß√£o que foi ligada\r‚Äúduas vezes‚Äù. Resumidamente, estaremos contando apenas os volumes de cada\rcub√≥ide ligado e subtra√≠ndo o volume de cada intersec√ß√£o para n√£o contar nada\rduas vezes.\n# Ler todos os passos como uma tabela\rsteps \u0026lt;- \u0026quot;data-raw/22b_reactor_reboot.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;[ ,]|(\\\\.\\\\.)\u0026quot;) |\u0026gt;\rpurrr::transpose() |\u0026gt;\rpurrr::set_names(\u0026quot;state\u0026quot;, \u0026quot;x1\u0026quot;, \u0026quot;x2\u0026quot;, \u0026quot;y1\u0026quot;, \u0026quot;y2\u0026quot;, \u0026quot;z1\u0026quot;, \u0026quot;z2\u0026quot;) |\u0026gt;\rpurrr::map(purrr::flatten_chr) |\u0026gt;\rtibble::as_tibble() |\u0026gt;\rdplyr::mutate(\rdplyr::across(dplyr::ends_with(\u0026quot;1\u0026quot;), stringr::str_remove, \u0026quot;[a-z]=\u0026quot;),\rdplyr::across(c(-state), as.integer),\rstate = ifelse(state == \u0026quot;on\u0026quot;, 1L, -1L),\r)\r# Iterar nos passos Iterate over steps\rcuboids \u0026lt;- dplyr::slice_head(steps, n = 1)\rfor (i in 2:nrow(steps)) {\r# Iterar nos cub√≥ides que j√° vimos\rfor (j in seq_len(nrow(cuboids))) {\r# Calcular intersec√ß√£o\rx1_inter \u0026lt;- max(steps$x1[i], cuboids$x1[j])\rx2_inter \u0026lt;- min(steps$x2[i], cuboids$x2[j])\ry1_inter \u0026lt;- max(steps$y1[i], cuboids$y1[j])\ry2_inter \u0026lt;- min(steps$y2[i], cuboids$y2[j])\rz1_inter \u0026lt;- max(steps$z1[i], cuboids$z1[j])\rz2_inter \u0026lt;- min(steps$z2[i], cuboids$z2[j])\r# Adicionar intersec√ß√£o √† lista (com sinal virado)\rif (x1_inter \u0026lt;= x2_inter \u0026amp;\u0026amp; y1_inter \u0026lt;= y2_inter \u0026amp;\u0026amp; z1_inter \u0026lt;= z2_inter) {\rcuboids \u0026lt;- tibble::add_row(cuboids,\rstate = cuboids$state[j] * -1L,\rx1 = x1_inter, x2 = x2_inter,\ry1 = y1_inter, y2 = y2_inter,\rz1 = z1_inter, z2 = z2_inter,\r)\r}\r}\r# Adicionar cub√≥ide √† lista se ele estiver ligado\rif (steps$state[i] == 1) {\rcuboids \u0026lt;- tibble::add_row(cuboids,\rstate = steps$state[i],\rx1 = steps$x1[i], x2 = steps$x2[i],\ry1 = steps$y1[i], y2 = steps$y2[i],\rz1 = steps$z1[i], z2 = steps$z2[i],\r)\r}\r}\r# Contar cubos ligados\ron \u0026lt;- 0\rfor (i in seq_len(nrow(cuboids))) {\r# Calcular volume\rx \u0026lt;- cuboids$x2[i] - cuboids$x1[i] + 1\ry \u0026lt;- cuboids$y2[i] - cuboids$y1[i] + 1\rz \u0026lt;- cuboids$z2[i] - cuboids$z1[i] + 1\r# Adicionar/remover √†/da conta\ron \u0026lt;- on + (x * y * z * cuboids$state[i])\r}\r# Imprimir\rformat(on, scientific = FALSE)\r#\u0026gt; [1] 1233304599156793\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-22-advent-of-r-22/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 22"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nDados de Dirac (A)\rO dia 21 do AoC come√ßou bem. O primeiro\ritem foi bastante direto e tranquilo‚Ä¶ O que complicou tudo foi o segundo.\nCome√ßamos aprendendo as regras de um jogo chamado Dados de Dirac. Ele √© composto\rum tabuleiro circular que vai de 1 a 10, um dado e dois pe√µes para representar\ros dois jogadores. Cada jogador rola o dado 3 vezes, soma os resultados e anda\raquele n√∫mero de casas no tabuleiro; o n√∫mero da casa em que ele caiu √© ent√£o\radicionado √† pontua√ß√£o do jogador. Cada jogador come√ßa em uma casa escolhida\raleatoriamente e ganha o primeiro a atingir 1000 ou mais pontos.\nO primeiro item pedia para simularmos um jogo de Dados de Dirac com um dado\rdetermin√≠stico antes de partirmos para a vers√£o oficial. N√≥s recebemos como\rentrada a posi√ß√£o de in√≠cio de cada jogador e a mec√¢nica de funcionamento do\rdado: ele ia de 1 a 100 e seu resultado sempre vinha nessa ordem (ou seja, o\rprimeiro jogador rolaria 1, 2, 3, o segundo rolaria 4, 5, 6, etc.). Nosso\robjetivo era simular o jogo at√© que algu√©m ganhasse e retornar a pontua√ß√£o do\rjogador perdedor multiplicada pelo n√∫mero de vezes que o dado foi rolado naquele\rjogo.\n# Ler posi√ß√µes iniciais\rpos \u0026lt;- \u0026quot;data-raw/21a_dirac_dice.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_extract(\u0026quot;[0-9]+$\u0026quot;) |\u0026gt;\ras.numeric()\r# Posi√ß√µes iniciais\rp1_pos \u0026lt;- pos[1]\rp2_pos \u0026lt;- pos[2]\r# Pontua√ß√µes iniciais\rp1_pts \u0026lt;- 0\rp2_pts \u0026lt;- 0\r# Fazer os dados irem do valor m√°ximo para 1\rdie_mod \u0026lt;- function(e1, e2) ((e1 - 1) %% e2) + 1\r# Iterar at√© o jogo acabar\rdie \u0026lt;- 1\rcounter \u0026lt;- 0\rwhile (TRUE) {\r# J1 rola 3 vezes\rp1_rolls \u0026lt;- die:(die + 2)\rp1_rolls \u0026lt;- die_mod(p1_rolls, 100)\r# Atualizar estado do dado e contador de rolagem\rdie \u0026lt;- die_mod(p1_rolls[3] + 1, 100)\rcounter \u0026lt;- counter + 3\r# Atualizar pontua√ß√£o do J1\rp1_pos \u0026lt;- p1_pos + sum(p1_rolls)\rp1_pos \u0026lt;- die_mod(p1_pos, 10)\rp1_pts \u0026lt;- p1_pts + p1_pos\r# Parar se J1 ganhou\rif (p1_pts \u0026gt;= 1000) break\r# J2 rola 3 vezes\rp2_rolls \u0026lt;- die:(die + 2)\rp2_rolls \u0026lt;- die_mod(p2_rolls, 100)\r# Atualizar estado do dado e contador de rolagem\rdie \u0026lt;- die_mod(p2_rolls[3] + 1, 100)\rcounter \u0026lt;- counter + 3\r# Atualizar pontua√ß√£o do J2\rp2_pos \u0026lt;- p2_pos + sum(p2_rolls)\rp2_pos \u0026lt;- die_mod(p2_pos, 10)\rp2_pts \u0026lt;- p2_pts + p2_pos\r# Parar se J2 ganhou\rif (p2_pts \u0026gt;= 1000) break\r}\r# Contador * pontua√ß√£o do perdedor\rmin(p1_pts, p2_pts) * counter\r#\u0026gt; [1] 597600\r\rDados de Dirac (B)\rBem direto, certo? Uma pena que o segundo item n√£o tinha nada a ver‚Ä¶ Agora\rdever√≠amos simular o jogo com o ep√¥nimo Dado de Dirac. Ele tem 3 lados (de 1 a\r3) e, cada vez que ele √© rolado, um universo paralelo √© criado para cada\rposs√≠vel resultado. Em suma, no final do jogo haveria um universo para cada\rcaminho que o jogo poderia hipoteticamente tomar. Felizmente, com o Dado de\rDirac, o jogo ia s√≥ at√© 21 pontos.\nNossa miss√£o era, dadas as posi√ß√µes iniciais, calcular em quantos universos\rganhava o jogador que ganhava mais vezes. N√£o parece t√£o dif√≠cil at√© voc√™\rperceber que teremos algo em torno de 700 trilh√µes de universos para\rconsiderar. Espero que esteja claro que tentar gerar todas as rodadas n√£o vai\rfuncionar.\nA solu√ß√£o ideal para esse problema √©\rprograma√ß√£o din√¢mica\r(PD) que, apesar do nome esot√©rico, n√£o √© t√£o misteriosa assim. De forma bem\rsuperficial, um algoritmo que usa PD come√ßa dividindo o problema principal em\rsub-problemas mais simples e armazenando seus resultados; a parte vital √©,\rent√£o, utilizar esses resultados j√° calculados para evitar contas desnecess√°rias\rmais para frente.\nConcretamente, queremos dividir o jogo em estados distintos definidos pelos\rquartetos (p1_pos, p2_pos, p1_pts, p2_pts). Vejamos como funcionaria um trecho\rdesse algoritmo:\nCome√ßamos por um estado no final do jogo: (3, 8, 19, 21). Neste universo,\rsabemos que o J2 ganhou, ent√£o salvamos a informa√ß√£o (3, 8, 19, 21) = (0, 1).\n\rMais para frente, encontramos o estado (3, 5, 19, 13). O J2 pode rolar uma\rs√©rie de valores aqui que precisamos verificar, mas, se ele rolar 1 + 1 + 1,\rsabemos que cairemos no estado (3, 8, 19, 21)! Sendo assim, podemos pular este\rc√°lculo e verificar apenas as outras rolagens poss√≠veis.\n\rCom PD, calcularemos primeiro estados mais f√°ceis e, conforme formos\revoluindo para o come√ßo do jogo, j√° teremos calculado o n√∫mero de vit√≥rias de\rcada jogador em cada futuro. Assim, basta somar esses futuros e passar para um\restado anterior.\n\r\r# Ler posi√ß√µes iniciais\rpos \u0026lt;- \u0026quot;data-raw/21b_dirac_dice.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_extract(\u0026quot;[0-9]+$\u0026quot;) |\u0026gt;\ras.numeric()\r# Posi√ß√µes iniciais\rp1_pos \u0026lt;- pos[1]\rp2_pos \u0026lt;- pos[2]\r# Fazer os dados irem do valor m√°ximo para 1\rdie_mod \u0026lt;- function(e1, e2) ((e1 - 1) %% e2) + 1\r# Criar um identificar para `states`\rid \u0026lt;- function(a, b, c, d) paste0(a, \u0026quot;,\u0026quot;, b, \u0026quot;,\u0026quot;, c, \u0026quot;,\u0026quot;, d)\r# Contar vit√≥rias de cada jogador a partir de cada estado do jogo\rstates \u0026lt;- list()\rcount_states \u0026lt;- function(p1_pos, p2_pos, p1_pts = 0, p2_pts = 0) {\rthis_id \u0026lt;- id(p1_pos, p2_pos, p1_pts, p2_pts)\r# Condi√ß√µes de parada\rif (p1_pts \u0026gt;= 21) return(c(1, 0))\rif (p2_pts \u0026gt;= 21) return(c(0, 1))\rif (this_id %in% names(states)) return(states[[this_id]])\r# Todas as combina√ß√µes poss√≠veis de rolagens\rrolls \u0026lt;- list(1:3, 1:3, 1:3) |\u0026gt;\rpurrr::cross() |\u0026gt;\rpurrr::map(purrr::flatten_int) |\u0026gt;\rpurrr::map_int(sum)\r# Iterar nas rolagens e fazer a recurs√£o para os pr√≥ximos estados\rwins_total \u0026lt;- c(0, 0)\rfor (roll in rolls) {\rp1_pos_ \u0026lt;- die_mod(p1_pos + roll, 10)\r# Ir para o pr√≥ximo estado e somar vit√≥rias\rwins \u0026lt;- count_states(p2_pos, p1_pos_, p2_pts, p1_pts + p1_pos_)\rwins_total \u0026lt;- wins_total + rev(wins)\r}\r# Atualizar `states` e retornar\rstates[[this_id]] \u0026lt;\u0026lt;- wins_total\rreturn(wins_total)\r}\r# Rodar programa√ß√£o din√¢mica\rcount_states(p1_pos, p2_pos) |\u0026gt;\rmax() |\u0026gt;\rformat(scientific = FALSE)\r#\u0026gt; [1] 634769613696613\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-21-advent-of-r-21/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 21"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nMapa da Fossa (A)\rDepois de um domingo assustadoramente dif√≠cil, o problema do\rdia 20 do AoC foi bastante tranquilo de\rresolver. Tanto o enunciado quanto a solu√ß√£o me pareceram simples (apesar de\ralgumas reclama√ß√µes na internet sobre uma pegadinha que vou explicar em breve).\nHoje n√≥s recebemos uma imagem na forma de uma matriz composta por pontos\rluminosos # e pontos escuros .. O outro componente da entrada era uma lista\rde ‚Äúconvers√µes‚Äù: n√≥s dever√≠amos converter cada quadrado 3x3 da imagem em um\rn√∫mero bin√°rio onde # = 1 e . = 0 e encontrar o elemento de √≠ndice\rcorrespondente da lista de convers√µes; o ponto do centro do quadrado deveria ser\rsubstituido por esse elemento da lista.\n# Um quadrado 3x3\r# # . . # .\r# #[. . .].\r# #[# . .]#\r# .[. # .].\r# . . # # #\r#\r# N√∫mero correspondente\r# ...#...#. = 000100010 = 34\r#\r# 34o elemento da lista de convers√µes\r# 0 10 20 30 [34] 40 50 60 70\r# | | | | | | | | |\r# ..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..##\rEntretanto, essa opera√ß√£o, denominada realce, tinha um detalhe a mais. A nossa\rimagem de entrada era, na verdade, infinita! Em todas as dire√ß√µes, a imagem\rdeveria ser completa por infinitos pontos escuros. Nosso objetivo era contar o\rn√∫mero de pontos luminosos que restavam na nossa imagem ap√≥s 2 aplica√ß√µes do\rrealce.\nComo √© poss√≠vel imaginar, os pontos escuros infinitos n√£o podem fazer diferen√ßa\rnessa contagem (sen√£o a resposta seria incalcul√°vel). Note que um quadrado\rcomposto s√≥ por pontos escuros equivale ao √≠ndice 0 da lista e, no exemplo\racima, isso √© convertido para um novo ponto escuro; ou seja, as bordas infinitas\rcontinuam sendo escuras ap√≥s o realce.\nA pegadinha, por√©m, era que a lista de convers√µes na entrada do problema\rcome√ßava com # e n√£o ., ou seja, os infinitos pontos escuros iam virar\rinfinitos pontos luminosos depois de um realce. Felizmente, na segunda\raplica√ß√£o, todos os quadrados luminosos apontariam para o 511¬∫ elemento da lista\re esse sim era um .. Em conclus√£o, desde que aplic√°ssemos um n√∫mero par de\rrealces, as fronteiras infinitas da imagem seriam escuras e o n√∫mero de pontos\rluminosos poderia ser contado.\nSendo assim, o c√≥digo que resolvia o problema era bem simples, bastava adicionar\ruma borda escura √† imagem para levar em conta a fronteira infinita e seguir em\rfrente.\n# Converter uma regi√£o 3x3 em um n√∫mero\rimg_to_int \u0026lt;- function(image) {\r# Achatar a matriz para uma s√≥ coluna\rbits \u0026lt;- ifelse(image == \u0026quot;.\u0026quot;, 0, 1)\rbinary \u0026lt;- paste0(as.vector(t(bits)), collapse = \u0026quot;\u0026quot;)\r# String para inteiro\rstrtoi(binary, base = 2)\r}\r# Aplicar realce\renhance \u0026lt;- function(image, algo) {\r# Iterar nas linhas e colunas, sem passar pela borda\rnew_image \u0026lt;- image\rfor (i in 2:(nrow(image) - 1)) {\rfor (j in 2:(ncol(image) - 1)) {\r# Trocar [i,j] pelo √≠ndice correspondente em `algo`\rind \u0026lt;- img_to_int(image[(-1:1 + i), (-1:1 + j)])\rnew_image[i, j] \u0026lt;- algo[ind + 1]\r}\r}\r# Remover borda e retornar\rnew_image[2:(nrow(image) - 1), 2:(ncol(image) - 1)]\r}\r# Adicionar borda\radd_padding \u0026lt;- function(image) {\r# Adicionar mais 2 linhas em cima e embaixo\rimage \u0026lt;- rbind(\rimage[1, ], image[1, ],\rimage,\rimage[nrow(image), ], image[nrow(image), ]\r)\r# Adicionar 2 colunas na esquerda e na direita\rimage \u0026lt;- cbind(\rimage[, 1], image[, 1],\rimage,\rimage[, ncol(image)], image[, ncol(image)]\r)\rreturn(image)\r}\r# Ler lista de realce como um vetor de strings\ralgo \u0026lt;- \u0026quot;data-raw/20a_trench_map.txt\u0026quot; |\u0026gt;\rreadr::read_lines(n_max = 1) |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::pluck(1)\r# Ler imagem como uma matriz (e adicionar bordas)\rimage \u0026lt;- \u0026quot;data-raw/20a_trench_map.txt\u0026quot; |\u0026gt;\rreadr::read_lines(skip = 2) |\u0026gt;\rpurrr::prepend(rep(paste0(rep(\u0026quot;.\u0026quot;, 100), collapse = \u0026quot;\u0026quot;), 3)) |\u0026gt;\rappend(rep(paste0(rep(\u0026quot;.\u0026quot;, 100), collapse = \u0026quot;\u0026quot;), 3)) |\u0026gt;\r{\\(s) stringr::str_c(\u0026quot;...\u0026quot;, s, \u0026quot;...\u0026quot;)}() |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\rmatrix(106, 106, byrow = TRUE)\r# Aplicar o realce duas vezes e contar pontos luminosos\rimage |\u0026gt;\renhance(algo) |\u0026gt;\radd_padding() |\u0026gt;\renhance(algo) |\u0026gt;\rmagrittr::equals(\u0026quot;#\u0026quot;) |\u0026gt;\rsum()\r#\u0026gt; [1] 5498\r\rMapa da Fossa (B)\rO segundo item pedia apenas para aplicarmos o algoritmo 50 ao inv√©s de 2 vezes e\rcontar o n√∫mero de pontos luminosos. Como o nosso algoritmo generaliza as\rbordas, podemos simplesmente aplic√°-lo mais vezes.\n# Aplicar o realce 50 vezes\rimage \u0026lt;- enhance(image, algo)\rfor (i in seq_len(49)) {\rimage \u0026lt;- enhance(add_padding(image), algo)\r}\r# Contar pontos luminosos\rimage |\u0026gt;\rmagrittr::equals(\u0026quot;#\u0026quot;) |\u0026gt;\rsum()\r#\u0026gt; [1] 16014\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-20-advent-of-r-20/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 20"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nDetectores de Sinalizadores (A)\rNeville Chamberlain tem uma frase que eu gosto muito: ‚Äúna guerra n√£o h√°\rvencedores, todos s√£o perdedores.‚Äù √â assim que eu me senti com o\rdia 19 do AoC. No total eu demorei mais\rde 6 horas de programa√ß√£o intensa para resolver o problema de hoje. Joguei meu\rc√≥digo fora m√∫ltiplas vezes, quase desisti, mas no final perseverei. N√£o acho\rque eu tenha resolvido o problema; assim como Chamberlain, acredito que o\rproblema s√≥ perdeu antes.\nPor esse motivo, o post de hoje vai ser um pouco diferente. Em primeiro lugar,\r√© imposs√≠vel resumir as mais de 400 linhas do enunciado de forma efetiva e,\rem segundo, explicar o racioc√≠nio por tr√°s da minha solu√ß√£o seria t√£o exaustivo\rquanto. Sendo assim, vou fazer um super resumo do enunciado e deixar a\rexplica√ß√£o do c√≥digo a cargo dos coment√°rios. Quem sabe um dia eu n√£o revisito\resse exerc√≠cio para dar um passo-a-passo melhor.\nO grosso da pergunta √© o seguinte: temos 36 detectores e uma s√©rie de\rsinalizadores espalhados pelo oceano em posi√ß√µes fixas. A entrada s√£o as\rcoordenadas dos sinalizadores que s√£o vistos por cada detector relativas √†\rposi√ß√£o desse detector. Cada detector tamb√©m pode estar em uma de 24 orienta√ß√µes\r(olhando para +x com o topo apontado para +y, olhando para -y com o topo\rapontado para +z, etc.). Se dois detectores tiverem uma intersec√ß√£o entre os\rseus cubos de detec√ß√£o, ent√£o deve haver pelo menos 12 sinalizadores nesse\rvolume. A pergunta pede para calcularmos o n√∫mero de sinalizadores que est√£o\rnessa regi√£o do mar.\n# Converter c(x,y,z) para \u0026quot;x,y,z\u0026quot;\rvec_to_str \u0026lt;- function(vec) {\rstringr::str_c(vec, collapse = \u0026quot;,\u0026quot;)\r}\r# Converter \u0026quot;x,y,z\u0026quot; para c(x,y,z)\rstr_to_vec \u0026lt;- function(str) {\ras.integer(stringr::str_split(str, \u0026quot;,\u0026quot;)[[1]])\r}\r# Atalho para escolhe(n,2) de uma lista\rchoose_pairs \u0026lt;- function(l) {\rseq_along(l) |\u0026gt;\rlist(seq_along(l)) |\u0026gt;\rpurrr::cross(`==`) |\u0026gt;\rpurrr::transpose() |\u0026gt;\rpurrr::map(purrr::flatten_int) |\u0026gt;\rpurrr::set_names(\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;) |\u0026gt;\rdplyr::as_tibble() |\u0026gt;\rdplyr::rowwise() |\u0026gt;\rdplyr::mutate(ordered = paste0(sort(c(a, b)), collapse = \u0026quot;,\u0026quot;)) |\u0026gt;\rdplyr::group_by(ordered) |\u0026gt;\rdplyr::slice_head(n = 1) |\u0026gt;\rdplyr::ungroup() |\u0026gt;\rdplyr::select(-ordered) |\u0026gt;\rdplyr::mutate(\ra = purrr::map(a, ~l[[.x]]),\rb = purrr::map(b, ~l[[.x]])\r)\r}\r# Aplicar todas as rota√ß√µes de um ponto\rapply_rotations \u0026lt;- function(point) {\rrotations \u0026lt;- list(\rlist(c(-1, 0, 0), c(0, -1, 0), c(0, 0, 1)),\rlist(c(-1, 0, 0), c(0, 0, -1), c(0, -1, 0)),\rlist(c(-1, 0, 0), c(0, 0, 1), c(0, 1, 0)),\rlist(c(-1, 0, 0), c(0, 1, 0), c(0, 0, -1)),\rlist(c(0, -1, 0), c(-1, 0, 0), c(0, 0, -1)),\rlist(c(0, -1, 0), c(0, 0, -1), c(1, 0, 0)),\rlist(c(0, -1, 0), c(0, 0, 1), c(-1, 0, 0)),\rlist(c(0, -1, 0), c(1, 0, 0), c(0, 0, 1)),\rlist(c(0, 0, -1), c(-1, 0, 0), c(0, 1, 0)),\rlist(c(0, 0, -1), c(0, -1, 0), c(-1, 0, 0)),\rlist(c(0, 0, -1), c(0, 1, 0), c(1, 0, 0)),\rlist(c(0, 0, -1), c(1, 0, 0), c(0, -1, 0)),\rlist(c(0, 0, 1), c(-1, 0, 0), c(0, -1, 0)),\rlist(c(0, 0, 1), c(0, -1, 0), c(1, 0, 0)),\rlist(c(0, 0, 1), c(0, 1, 0), c(-1, 0, 0)),\rlist(c(0, 0, 1), c(1, 0, 0), c(0, 1, 0)),\rlist(c(0, 1, 0), c(-1, 0, 0), c(0, 0, 1)),\rlist(c(0, 1, 0), c(0, 0, -1), c(-1, 0, 0)),\rlist(c(0, 1, 0), c(0, 0, 1), c(1, 0, 0)),\rlist(c(0, 1, 0), c(1, 0, 0), c(0, 0, -1)),\rlist(c(1, 0, 0), c(0, -1, 0), c(0, 0, -1)),\rlist(c(1, 0, 0), c(0, 0, -1), c(0, 1, 0)),\rlist(c(1, 0, 0), c(0, 0, 1), c(0, -1, 0)),\rlist(c(1, 0, 0), c(0, 1, 0), c(0, 0, 1))\r)\r# Criar uma tabela com (x, y, z) rotacionados e um ID de rota√ß√£o\rrotations |\u0026gt;\rpurrr::map(purrr::map, `*`, point) |\u0026gt;\rpurrr::map(purrr::map, sum) |\u0026gt;\rpurrr::map(purrr::flatten_dbl) |\u0026gt;\rdplyr::tibble() |\u0026gt;\rpurrr::set_names(\u0026quot;point\u0026quot;) |\u0026gt;\rdplyr::mutate(rotation = rotations) |\u0026gt;\rtibble::rowid_to_column() |\u0026gt;\rtidyr::unnest(point) |\u0026gt;\rdplyr::mutate(coord = rep(c(\u0026quot;x\u0026quot;, \u0026quot;y\u0026quot;, \u0026quot;z\u0026quot;), dplyr::n() / 3)) |\u0026gt;\rtidyr::pivot_wider(names_from = coord, values_from = point) |\u0026gt;\rdplyr::mutate(rotation = purrr::map_chr(rotation, paste, collapse = \u0026quot;,\u0026quot;)) |\u0026gt;\rdplyr::select(x, y, z, rotation)\r}\r# F√°brica de fun√ß√£o para transformar um ponto com rota√ß√£o + transla√ß√£o\rfactory_transform \u0026lt;- function(df) {\r# Extrair a opera√ß√£o de rota√ß√£o da df\rrot \u0026lt;- df$rotation |\u0026gt;\rstringr::str_split(\u0026quot;c\\\\(\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\rstringr::str_remove(\u0026quot;\\\\),?\u0026quot;) |\u0026gt;\rstringr::str_subset(\u0026quot;,\u0026quot;) |\u0026gt;\rstringr::str_split(\u0026quot;, \u0026quot;) |\u0026gt;\rpurrr::map(as.numeric)\r# Extrair a opera√ß√£o de transla√ß√£o da df\rtrans \u0026lt;- c(df$dif_x, df$dif_y, df$dif_z)\r# Retornar fun√ß√£o que aplica a transforma√ß√£o\rfunction(vec) {\rrot |\u0026gt;\rpurrr::map(`*`, vec) |\u0026gt;\rpurrr::map(sum) |\u0026gt;\rpurrr::flatten_dbl() |\u0026gt;\rmagrittr::add(trans)\r}\r}\r# Pegar todas as intersec√ß√µes entre detectores\rget_intersections \u0026lt;- function(points) {\r# Parear os detectores e retornar as suas intersec√ß√µes\rpoints |\u0026gt;\rpurrr::map(choose_pairs) |\u0026gt;\rpurrr::map(\rdplyr::mutate, # Intersec√ß√µes s√£o baseadas nas dist√¢ncias entre pontos\rdist = purrr::map2_dbl(a, b, ~sum((.x - .y)**2))\r) |\u0026gt;\rchoose_pairs() |\u0026gt;\rdplyr::rowwise() |\u0026gt;\rdplyr::group_split() |\u0026gt;\rpurrr::map(~dplyr::inner_join(.x[[\u0026quot;a\u0026quot;]][[1]], .x[[\u0026quot;b\u0026quot;]][[1]], \u0026quot;dist\u0026quot;)) |\u0026gt;\rpurrr::keep(~nrow(.x) \u0026gt;= 66) # 66 = C(12, 2) = 12 pontos na intersec.\r}\r# Pegar todas as transforma√ß√µes que podem converter pairs1 em pairs2\rget_transforms \u0026lt;- function(pairs1, pairs2) {\r# Criar uma fun√ß√£o que leva pairs1[2] a pairs2[2a] ou pairs2[2b]\rdplyr::bind_rows(\rdplyr::mutate(\rapply_rotations(pairs1$a.x[[2]]),\rref_x = pairs2$a.y[[2]][1],\rref_y = pairs2$a.y[[2]][2],\rref_z = pairs2$a.y[[2]][3]\r),\rdplyr::mutate(\rapply_rotations(pairs1$a.x[[2]]),\rref_x = pairs2$b.y[[2]][1],\rref_y = pairs2$b.y[[2]][2],\rref_z = pairs2$b.y[[2]][3]\r)\r) |\u0026gt;\rdplyr::mutate(\rdif_x = ref_x - x,\rdif_y = ref_y - y,\rdif_z = ref_z - z\r) |\u0026gt;\rdplyr::rowwise() |\u0026gt;\rdplyr::group_split() |\u0026gt;\rpurrr::map(factory_transform)\r}\r# Encontrar a fun√ß√£o correta de transforma√ß√£o\rfind_transform \u0026lt;- function(df, funs) {\r# Dadas as fun√ß√µes de transforma√ß√£o, encontrar uma que converte os pontos de\r# df (conjunto de intersec√ß√µes) corretamente\rdf |\u0026gt;\rtibble::rowid_to_column(\u0026quot;pair_id\u0026quot;) |\u0026gt;\rdplyr::rowwise() |\u0026gt;\rdplyr::group_split() |\u0026gt;\rpurrr::map(~{\r.x |\u0026gt;\rdplyr::mutate(,\rfun_a.x = list(purrr::map(funs, ~.x(a.x[[1]]))),\rfun_id = list(seq_along(funs))\r) |\u0026gt;\rtidyr::unnest(dplyr::starts_with(\u0026quot;fun\u0026quot;)) |\u0026gt;\rdplyr::select(-dist) |\u0026gt;\rtidyr::unnest(dplyr::everything())\r}) |\u0026gt;\rdplyr::bind_rows() |\u0026gt;\rdplyr::mutate(\ra_works = a.y == fun_a.x,\rb_works = b.y == fun_a.x\r) |\u0026gt;\rdplyr::group_by(pair_id, fun_id) |\u0026gt;\rdplyr::summarise(\rsome_works = all(a_works) || all(b_works), .groups = \u0026quot;drop\u0026quot;\r) |\u0026gt;\rdplyr::ungroup() |\u0026gt;\rdplyr::group_by(fun_id) |\u0026gt;\rdplyr::summarise(works = sum(some_works)) |\u0026gt;\rdplyr::slice_max(works) |\u0026gt;\rdplyr::pull(fun_id)\r}\r# Ler pontos como uma lista de vetores\rpoints \u0026lt;- \u0026quot;data-raw/19a_beacon_scanner.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rtibble::tibble() |\u0026gt;\rpurrr::set_names(\u0026quot;point\u0026quot;) |\u0026gt;\rdplyr::mutate(\rscanner = as.integer(stringr::str_detect(point, \u0026quot;scanner\u0026quot;)),\rscanner = cumsum(scanner) - 1\r) |\u0026gt;\rdplyr::filter(!stringr::str_detect(point, \u0026quot;scanner\u0026quot;)) |\u0026gt;\rdplyr::filter(point != \u0026quot;\u0026quot;) |\u0026gt;\rdplyr::group_split(scanner) |\u0026gt;\rpurrr::map(dplyr::pull, point) |\u0026gt;\rpurrr::map(purrr::map, str_to_vec)\r# Reduzir detectores a uma √∫nica regi√£o\rwhile (length(points) \u0026gt; 1) {\r# Pegar um par de detectores que tem uma intersec√ß√£o\rpairs \u0026lt;- get_intersections(points)[[1]]\r# Pegar todas as fun√ß√µes de transforma√ß√£o\rfuns \u0026lt;- get_transforms(\rdplyr::select(pairs, a.x, b.x),\rdplyr::select(pairs, a.y, b.y)\r)\r# Encontrar a fun√ß√£o correta\rtransformation \u0026lt;- funs[[find_transform(pairs, funs)]]\r# Converter pontos para strings\rpairs \u0026lt;- pairs |\u0026gt;\rdplyr::select(-dist) |\u0026gt;\rdplyr::mutate_all(purrr::map_chr, vec_to_str)\r# Criar uma c√≥pia dos pontos que tamb√©m √© strings\rpoints_ \u0026lt;- purrr::map(points, purrr::map_chr, vec_to_str)\r# Encontrar detector usado como refer√™ncia por transformation()\rfor (i in seq_along(points_)) {\rref \u0026lt;- all(c(pairs$a.y, pairs$b.y) %in% points_[[i]])\rif (ref) reference \u0026lt;- i\r}\r# Encontrar detector que foi transformado por transformation()\rfor (i in seq_along(points_)) {\rtrns \u0026lt;- all(c(pairs$a.x, pairs$b.x) %in% points_[[i]])\rif (trns) transformed \u0026lt;- i\r}\r# Aplicar transformation() em todos os pontos do detector e adicionar pontos\r# transformados ao detector de refer√™ncia\rpoints_[[reference]] \u0026lt;- points[[transformed]] |\u0026gt;\rpurrr::map(transformation) |\u0026gt;\rpurrr::map_chr(vec_to_str) |\u0026gt;\rc(points_[[reference]]) |\u0026gt;\runique()\r# Atualizar lista de pontos\rpoints_[[transformed]] \u0026lt;- NULL\rpoints \u0026lt;- purrr::map(points_, purrr::map, str_to_vec)\r}\r# Calcular o n√∫mero de pontos em uma √∫nica regi√£o cont√≠gua\rsum(lengths(points))\r#\u0026gt; [1] 408\r\rDetectores de Sinalizadores (B)\rO segundo item pedia para que encontr√°ssemos a maior\rdist√¢ncia de Manhattan\rentre detectores distintos.\n# Reduzir detectores a uma √∫nica regi√£o, guardando as fun√ß√µes de tranform.\rsave_funs \u0026lt;- list()\rwhile (length(points) \u0026gt; 1) {\r# Pegar um par de detectores que tem uma intersec√ß√£o\rpairs \u0026lt;- get_intersections(points)[[1]]\r# Pegar todas as fun√ß√µes de transforma√ß√£o\rfuns \u0026lt;- get_transforms(\rdplyr::select(pairs, a.x, b.x),\rdplyr::select(pairs, a.y, b.y)\r)\r# Encontrar a fun√ß√£o correta\rtransformation \u0026lt;- funs[[find_transform(pairs, funs)]]\rsave_funs \u0026lt;- c(save_funs, transformation)\r# Converter pontos para strings\rpairs \u0026lt;- pairs |\u0026gt;\rdplyr::select(-dist) |\u0026gt;\rdplyr::mutate_all(purrr::map_chr, vec_to_str)\r# Criar uma c√≥pia dos pontos que tamb√©m √© strings\rpoints_ \u0026lt;- purrr::map(points, purrr::map_chr, vec_to_str)\r# Encontrar detector usado como refer√™ncia por transformation()\rfor (i in seq_along(points_)) {\rref \u0026lt;- all(c(pairs$a.y, pairs$b.y) %in% points_[[i]])\rif (ref) reference \u0026lt;- i\r}\r# Encontrar detector que foi transformado por transformation()\rfor (i in seq_along(points_)) {\rtrns \u0026lt;- all(c(pairs$a.x, pairs$b.x) %in% points_[[i]])\rif (trns) transformed \u0026lt;- i\r}\r# Aplicar transformation() em todos os pontos do detector e adicionar pontos\r# transformados ao detector de refer√™ncia\rpoints_[[reference]] \u0026lt;- points[[transformed]] |\u0026gt;\rpurrr::map(transformation) |\u0026gt;\rpurrr::map_chr(vec_to_str) |\u0026gt;\rc(points_[[reference]]) |\u0026gt;\runique()\r# Atualizar lista de pontos\rpoints_[[transformed]] \u0026lt;- NULL\rpoints \u0026lt;- purrr::map(points_, purrr::map, str_to_vec)\r}\r# Aplicar transforma√ß√µes aos detectores e tirar dist√¢ncia de Manhattan\rsave_funs |\u0026gt;\rpurrr::map(~.x(c(0, 0, 0))) |\u0026gt;\rchoose_pairs() |\u0026gt;\rdplyr::mutate(dist = purrr::map2_dbl(a, b, ~sum(abs(.x - .y)))) |\u0026gt;\rdplyr::slice_max(dist) |\u0026gt;\rdplyr::pull(dist)\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-19-advent-of-r-19/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 19"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nPeixe-Caracol (A)\rChegou o dia 18 do AoC e mais uma vez\ro problema n√£o foi muito dif√≠cil apesar do enunciado monstruoso. Uma coisa que\rnotei hoje √© que havia v√°rios caminhos para resolver o exerc√≠cio que pareciam\rigualmente razo√°veis. No final eu decidi usar regex, uma das melhores e mais\rtemidas funcionalidades de qualquer linguagem de programa√ß√£o.\nO enunciado pedia para aprendermos a fazer somas usando os n√∫meros dos\rpeixes-caracol‚Ä¶ A primeira caracter√≠stica desse sistema aritm√©tico √© que um\rn√∫mero √© representado por pares de elementos na forma [x,y], que podem ser\rn√∫meros normais ou outros pares; por exemplo [[1,2],3]. Al√©m disso, h√° duas\rlimita√ß√µes para os n√∫meros: nunca pode haver um par dentro de 4 ou mais pares e\rnenhum n√∫mero normal pode ser maior que 9.\nA soma dos peixes-caracol coloca cada um dos dois n√∫meros como elementos de um\rnovo par. Se o primeiro n√∫mero for [a,b] e o segundo [x,y], ent√£o a soma\rdeles √© [[a,b],[x,y]]. Obviamente isso pode criar um n√∫mero que viola a\ras limita√ß√µes acima, ent√£o precisamos aplicar as regras da explos√£o e da\rquebra. Abaixo eu descrevo as regras e as fun√ß√µes que criei para implementar\rcada uma:\nA regra da explos√£o sempre vem primeiro e ela deve ser aplicada o maior n√∫mero\rposs√≠vel de vezes antes de partirmos para a regra da quebra.\n# Exemplo:\r# [[6,[5,[4,[3,2]]]],1]\r#\r# Passos da explos√£o:\r# 1. Encontrar o primeiro par simples que est√° dentro de 4 ou mais pares\r# [3,2]\r#\r# 2. Denominar as partes do par com x e y:\r# [x,y] = [3,2]\r#\r# 3. Somar x ao n√∫mero normal mais pr√≥ximo √† esquerda (se houver)\r# [[6,[5,[4 + 3,[3,2]]]],1]\r# [[6,[5,[7,[3,2]]]],1]\r#\r# 4. Somar y ao n√∫mero normal mais pr√≥ximo √† direita (se houver)\r# [[6,[5,[7,[3,2]]]],1 + 2]\r# [[6,[5,[7,[3,2]]]],3]\r#\r# 5. Substituir o par por 0\r# [[6,[5,[7,0]]],3]\r# Encontrar posi√ß√£o de um par que precisa ser explodido\rfind_explode \u0026lt;- function(num) {\rchrs \u0026lt;- stringr::str_split(num, \u0026quot;\u0026quot;)[[1]]\r# Iterar nos caracteres para encontrar um par profundo demais\rcounter \u0026lt;- 0\rfor (i in seq_along(chrs)) {\rif (chrs[i] == \u0026quot;[\u0026quot;) {\rcounter \u0026lt;- counter + 1\r} else if (chrs[i] == \u0026quot;]\u0026quot;) {\rcounter \u0026lt;- counter - 1\r# Se o par for profundo demais, retornar\rif (counter \u0026gt;= 4) {\r# Encontrar o come√ßo do par\rlen \u0026lt;- num |\u0026gt;\rstringr::str_sub(end = i) |\u0026gt;\rstringr::str_extract(\u0026quot;\\\\[[^\\\\[]*?$\u0026quot;) |\u0026gt;\rstringr::str_length() |\u0026gt;\rmagrittr::subtract(1)\r# Retornar \u0026quot;coordenadas\u0026quot; do par\rreturn(c(i - len, i))\r}\r}\r}\r# Se n√£o ouver par para explodir, returnar NULL\rreturn(NULL)\r}\r# Aplicar o algoritmo da explos√£o\rexplode \u0026lt;- function(num) {\r# Encontrar um par para explodir\rpos \u0026lt;- find_explode(num)\r# Se n√£o houver par, retornar o n√∫mero\rif (is.null(pos)) return(num)\r# Extrair n√∫meros normais do par\rpair \u0026lt;- num |\u0026gt;\rstringr::str_sub(pos[1], pos[2]) |\u0026gt;\rstringr::str_extract_all(\u0026quot;[0-9]+\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\ras.numeric()\r# Pegar a parte esquerda do n√∫mero (at√© o par que vai explodir)\rlhs \u0026lt;- stringr::str_sub(num, end = pos[1] - 1)\r# Encontrar o n√∫mero normal mais pr√≥ximo de pair[1] e somar\rleft_num \u0026lt;- lhs |\u0026gt;\rstringr::str_extract(\u0026quot;[0-9]+(?=[^0-9]+$)\u0026quot;) |\u0026gt;\ras.numeric() |\u0026gt;\rmagrittr::add(pair[1])\r# Pegar a parte direita do n√∫mero (a partir do par que vai explodir)\rrhs \u0026lt;- stringr::str_sub(num, pos[2] + 1)\r# Encontrar o n√∫mero normal mais pr√≥ximo de pair[2] e somar\rright_num \u0026lt;- rhs |\u0026gt;\rstringr::str_extract(\u0026quot;^[^0-9]+[0-9]+\u0026quot;) |\u0026gt;\rstringr::str_remove(\u0026quot;^[^0-9]+\u0026quot;) |\u0026gt;\ras.numeric() |\u0026gt;\rmagrittr::add(pair[2])\r# Substituir os n√∫meros normais que mudamos\rlhs \u0026lt;- stringr::str_replace(lhs, \u0026quot;[0-9]+([^0-9]+)$\u0026quot;, paste0(left_num, \u0026quot;\\\\1\u0026quot;))\rrhs \u0026lt;- stringr::str_replace(rhs, \u0026quot;^([^0-9]+)[0-9]+\u0026quot;, paste0(\u0026quot;\\\\1\u0026quot;, right_num))\r# Colar as partes esquerda e direita de volta\rreturn(paste0(lhs, \u0026quot;0\u0026quot;, rhs))\r}\rSe n√£o houver mais como aplicar a explos√£o, ent√£o podemos fazer uma quebra e\rvoltar para o come√ßo do algoritmo: aplicar quantas explos√µes forem poss√≠veis e\rdepois tentar uma quebra. Quando nenhuma regra puder ser aplicada, ent√£o\rencontramos o resultado da soma.\n# Exemplo:\r# [11,1]\r#\r# Passos da quebra:\r# 1. Encontrar o primeiro n√∫mero normal maior que 9\r# 11\r#\r# 2. Criar um novo par onde o elemento da esquerda √© o n√∫mero dividido por 2\r# arredondado para baixo e o elemento da direita √© o n√∫mero dividido por 2\r# arredondado para cima.\r# [5,6]\r#\r# 3. Substituir o n√∫mero normal pelo par criado\r# [[5,6],1]\r# Aplicar o algoritmo da quebra\rsplit \u0026lt;- function(num) {\r# Verificar se algo precisa ser quebrado e retornar o n√∫mero se n√£o\rif (!stringr::str_detect(num, \u0026quot;[0-9]{2,}\u0026quot;)) return(num)\r# Criar um par a partir das metades do primeiro n√∫mero normal \u0026gt; 9\rpair \u0026lt;- num |\u0026gt;\rstringr::str_extract(\u0026quot;[0-9]{2,}\u0026quot;) |\u0026gt;\ras.numeric() |\u0026gt;\r{\\(n) paste0(\u0026quot;[\u0026quot;, floor(n / 2), \u0026quot;,\u0026quot;, ceiling(n / 2), \u0026quot;]\u0026quot;)}()\r# Substituir o n√∫mero normal pelo par criado\rstringr::str_replace(num, \u0026quot;[0-9]{2,}\u0026quot;, pair)\r}\rAgora que sabemos como explodir e qubrar, podemos implementar o algoritmo\rcompleto da soma dos peixes-caracol. Notem o next no loop; ele √© essencial\rpor causa da exig√™ncia de aplicarmos a explos√£o quantas vezes forem necess√°rias.\n# Soma dos peixes-caracol\rsnailfish_sum \u0026lt;- function(num1, num2) {\r# Juntar n√∫meros como elementos de um novo par\rnum \u0026lt;- paste0(\u0026quot;[\u0026quot;, num1, \u0026quot;,\u0026quot;, num2, \u0026quot;]\u0026quot;)\r# Aplicar explos√£o e quebra at√© o n√∫mero n√£o mudar mais\rnum_ \u0026lt;- \u0026quot;\u0026quot;\rwhile (num_ != num) {\rnum_ \u0026lt;- num\r# Explodir e, se o n√∫mero tiver mudado, voltar\rnum \u0026lt;- explode(num)\rif (num_ != num) next\r# Qubrar\rnum \u0026lt;- split(num)\r}\rreturn(num)\r}\rMas o enunciado n√£o pedia para simplesmente implementarmos a soma dos\rpeixes-caracol‚Ä¶ A resposta final deveria ser a magnitude do n√∫mero obtido a\rpartir de somas sucessivas. Essencialmente, a nossa entrada era uma sequ√™ncia\rde n√∫meros A, B, C, D, etc. e dev√≠amos calcular\r(((A + B) + C) + D) + .... J√° a magnitude de um n√∫mero envolve outro\ralgoritmo; a magnitude de um [x,y] qualquer √© 3*x + 2*y, mas devemos aplicar\risso recursivamente, entrando nas camadas mais profundas do n√∫mero e voltando\rpara a superf√≠cie.\n# Fazer uma rodada do algoritmo da magnitude\rget_one_magnitude \u0026lt;- function(num) {\r# Pegar a magnitude do par mais √† esquerda\rval \u0026lt;- num |\u0026gt;\rstringr::str_extract(\u0026quot;\\\\[[^\\\\[\\\\]]+\\\\]\u0026quot;) |\u0026gt;\rstringr::str_extract_all(\u0026quot;[0-9]+\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\ras.numeric() |\u0026gt;\r{\\(n) 3 * n[1] + 2 * n[2]}() |\u0026gt;\ras.character()\r# Trocar o par pela sua magnitude\rstringr::str_replace(num, \u0026quot;\\\\[[^\\\\[\\\\]]+\\\\]\u0026quot;, val)\r}\r# Aplicar o algoritmo completo da magnitude\rget_magnitude \u0026lt;- function(num) {\r# Enquanto ainda houver pares, fazer uma rodada do c√°lculo\rwhile (stringr::str_detect(num, \u0026quot;\\\\[\u0026quot;)) {\rnum \u0026lt;- get_one_magnitude(num)\r}\r# Retornar magnitude convertida para um valor num√©rico\rreturn(as.numeric(num))\r}\rEnfim, depois de uma parede de texto e uma parede de c√≥digo, podemos finalmente\rjuntar tudo na solu√ß√£o do primeiro item.\n# Reduce list of numbers with snalfish addition and get magnitude\r\u0026quot;data-raw/18a_snailfish.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rpurrr::reduce(snailfish_sum) |\u0026gt;\rget_magnitude()\r#\u0026gt; [1] 4124\r\rPeixes-Caracol (B)\rEm um ato de bondade, o autor do Advent of Code fez um item 2 bem simples. Dados\rtodos os n√∫meros A, B, C, D, etc. que recebemos como entrada,\rprecis√°vamos combinar todos para encontrar a maior magnitude poss√≠vel. Minha\rsolu√ß√£o foi gerar todas as somas poss√≠veis (A + B, B + A, A + C, C + A,\retc., notando que A + B != B + A) e simplesmente calcular a magnitude de\rtodas. A resposta do item devia ser justamente essa maior magnitude poss√≠vel.\n# Cruzar os n√∫meros consigo mesmos e somar toda combina√ß√£o\r\u0026quot;data-raw/18b_snailfish.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\r{\\(ns) list(ns, ns)}() |\u0026gt;\rpurrr::cross(`==`) |\u0026gt;\rpurrr::map_dbl(~get_magnitude(snailfish_sum(.x[[1]], .x[[2]]))) |\u0026gt;\rmax()\r#\u0026gt; [1] 4673\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-18-advent-of-r-18/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 18"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nCesta de Tr√™s (A)\rO 17¬∫ dia do AoC foi uma √≥tima quebra em\rrela√ß√£o aos √∫ltimos. O enunciado era simples de entender e a solu√ß√£o foi f√°cil\rde criar, tudo que eu precisava depois de uma semana cansativa.\nHoje precis√°vamos tentar encontrar a chave do nosso submarino em uma fossa\rmarinha. A sonda que t√≠nhamos a bordo podia ser arremessada a partir do ponto\r(0, 0) com qualquer velocidade inteira tanto no eixo x quanto no y. A entrada\rdo problema era a posi√ß√£o do alvo e a sa√≠da do primeiro item deveria ser a\raltura m√°xima que pod√≠amos arremessar a sonda de modo que ela ainda atingisse\ro alvo.\nAs regras para a acelera√ß√£o da sonda a cada passo eram as seguintes:\n\rA posi√ß√£o x da sonda aumenta um valor igual √† sua velocidade x.\n\rA posi√ß√£o y da sonda aumenta um valor igual √† sua velocidade y.\n\rPor causa do atrito, a velocidade x da sonda muda em 1 um dire√ß√£o a 0 (ou\rseja, ela diminui em 1 se a velocidade for maior que 0 e aumenta em 1 caso\rcontr√°rio).\n\rPor causa da gravidade, a velocidade y da sonda diminui em 1.\n\r\rO grande truque do exerc√≠cio era identificar todas as velocidades poss√≠veis da\rsonda e depois verificar qual o levava √† maior altura. Como o alvo estava sempre\rabaixo e √† direita do (0, 0), pod√≠amos estabelecer os limites inferiores e\rsuperiores para as velocidades x e y:\n\rA velocidade x necessariamente tem que ser maior que 0, j√° que precisamos que\ra sonda se mova para frente. Adicionalmente, velocidade x m√°xima n√£o pode ser\rmaior que a fronteira direita do alvo; se o alvo terminar, por exemplo, em\rx = 10, nunca vamos acert√°-lo jogando o m√≥dulo para frente com velocidade maior\rque 10.\n\rOs limites da velocidade y s√£o mais dif√≠cil de entender. Em primeiro lugar,\rela nunca pode ser menor do que a fronteira inferior do alvo (pensando na mesma\rl√≥gica que usamos antes, se o alvo terminar, por exemplo, em y = -10, nunca\rvamos acert√°-lo jogando a sonda para baixo com velocidade menor que -10). O\rlimite superior vem do fato de que se jogarmos a sonda para cima, n√£o importando\ra velocidade, ela eventualmente vai voltar a y = 0 com velocidade igual √†\rvelocidade inicial menos 1, mas com sinal negativo; sendo assim, a velocidade y\rm√°xima √© igual ao valor absoluto do limite inferior do alvo.\n\r\r# Velocidade inicial: (6,3)\r# ..................................\r# .........(3,0).#..#.(2,-1)........\r# .....(4,1).#........#.(1,-2)......\r# ..................................\r# (5,2).#..............#.(0,-3).....\r# ..................................\r# ..................................\r# S.(6,3)..............#.(0,-4).....\r# ..................................\r# ..................................\r# ..................................\r# .....................#.(0,-5).....\r# ....................TTTTTTTTTTT...\r# ....................TTTTTTTTTTT...\r# ....................TTTTTTTTTTT...\r# ....................TTTTTTTTTTT...\r# ....................T#T(0,-6)TT...\r# ..................................\r# ..................................\rNote no diagrama acima a simetria da trajet√≥ria no eixo y. Assim fica mais f√°cil\rentender porque, por exemplo, se o limite inferior do alvo for y = -10, ent√£o\rnunca podemos jogar a sonda para cima com velocidade maior que 9; ela voltar√°\rpara y = 0 com velocidade -10 e acertar√° exatamente a fronteira de baixo do\ralvo.\n# Ler alvo como uma tabela de coordenadas\rtarget \u0026lt;- \u0026quot;data-raw/17a_trick_shot.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;[=,]\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\rstringr::str_subset(\u0026quot;^[0-9-]\u0026quot;) |\u0026gt;\rstringr::str_replace(\u0026quot;\\\\.\\\\.\u0026quot;, \u0026quot;:\u0026quot;) |\u0026gt;\rpurrr::map(~eval(parse(text = .x))) |\u0026gt;\rpurrr::cross() |\u0026gt;\rpurrr::transpose() |\u0026gt;\rpurrr::set_names(\u0026quot;x\u0026quot;, \u0026quot;y\u0026quot;) |\u0026gt;\rtibble::as_tibble() |\u0026gt;\rtidyr::unnest(c(x, y))\r# Todas as poss√≠veis combina√ß√µes de velocidades x e y v√°lidas\rvels \u0026lt;- purrr::cross(list(\r1:max(target$x),\rmin(target$y):abs(min(target$y))\r))\rPara calcular a altura m√°xima que poder√≠amos arremessar a sonda, eu simulei a\rtrajet√≥ria a partir de cada um dos pares de velocidades v√°lidas e guardei a\raltura m√°xima √† qual a sonda chegava. No final da itera√ß√£o, se a sonda de fato\ratingisse o alvo, ent√£o eu comparava a altura m√°xima dessa combina√ß√£o com a\raltura m√°xima global e mantinha a maior.\n# Verificar quais pares de velocidades funcionam e pegar a altura m√°xima\rmax_height \u0026lt;- 0\rfor (vel in vels) {\r# Posi√ß√£o inicial\rx_pos \u0026lt;- 0\ry_pos \u0026lt;- 0\r# Velocidades iniciais\rx_vel \u0026lt;- vel[[1]]\ry_vel \u0026lt;- vel[[2]]\r# Encontrar a altura m√°xima deste par de velocidades\rmax_height_ \u0026lt;- 0\rwhile (y_pos \u0026gt;= min(target$y) \u0026amp;\u0026amp; x_pos \u0026lt;= max(target$x)) {\r# Atualizar posi√ß√µes\rx_pos \u0026lt;- x_pos + x_vel\ry_pos \u0026lt;- y_pos + y_vel\r# Atualizar altura m√°xima local\rif (y_pos \u0026gt; max_height_) max_height_ \u0026lt;- y_pos\r# Se o par de fato leva ao alvo, atualizar altura m√°xima global\rif (x_pos %in% target$x \u0026amp;\u0026amp; y_pos %in% target$y) {\rif (max_height_ \u0026gt; max_height) max_height \u0026lt;- max_height_\r}\r# Atualizar velocidades\rx_vel \u0026lt;- if (x_vel \u0026gt; 0) x_vel - 1 else 0\ry_vel \u0026lt;- y_vel - 1\r}\r}\r# Retornar a altura m√°xima global\rmax_height\r#\u0026gt; [1] 4753\r\rCesta de Tr√™s (B)\rChegando no item 2, eu percebi que tinha dado muita sorte. O enunciado aqui\rpedia para encontrarmos o n√∫mero de velocidades iniciais da sonda que a faziam\rchegar ao alvo. Meu c√≥digo anterior j√° encontrava todos os pares v√°lidos, mas\rutilizava isso para atualizar a altura m√°xima; s√≥ era necess√°rio trocar a\rvari√°vel sendo atualizada dentro do while.\n# Verificar pares de velocidades que funcionam e cont√°-los\rn_works \u0026lt;- 0\rfor (vel in vels) {\r# Posi√ß√£o inicial\rx_pos \u0026lt;- 0\ry_pos \u0026lt;- 0\r# Velocidades iniciais\rx_vel \u0026lt;- vel[[1]]\ry_vel \u0026lt;- vel[[2]]\r# Encontrar a altura m√°xima deste par de velocidades\rmax_height_ \u0026lt;- 0\rwhile (y_pos \u0026gt;= min(target$y) \u0026amp;\u0026amp; x_pos \u0026lt;= max(target$x)) {\r# Atualizar posi√ß√µes\rx_pos \u0026lt;- x_pos + x_vel\ry_pos \u0026lt;- y_pos + y_vel\r# Se o par de fato leva ao alvo, atualizar contador\rif (x_pos %in% target$x \u0026amp;\u0026amp; y_pos %in% target$y) {\rn_works \u0026lt;- n_works + 1\rbreak\r}\r# Atualizar velocidades\rx_vel \u0026lt;- if (x_vel \u0026gt; 0) x_vel - 1 else 0\ry_vel \u0026lt;- y_vel - 1\r}\r}\r# Retornar n√∫mero de velocidades que funcionam\rn_works\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-17-advent-of-r-17/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 17"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nDecodificador de Pacotes (A)\rO 16¬∫ problema do AoC foi bastante\rdiverido. O enunciado era extremamente longo e cheio de detalhes, mas consegui\rfazer uma implementa√ß√£o direta e eficiente que s√≥ n√£o funcionou de primeira por\rcausa de um detalhe obscuro da fun√ß√£o strtoi().\nHoje nosso objetivos era decodificar pacotes bin√°rios. Eles chegavam ao nosso\rsubmarino em hexadecimal e, depois de convertidos para bin√°rio eles tinham as\rseguintes caracter√≠sticas:\n\rOs 3 primeiros bits representavam a vers√£o do pacote;\n\rOs 3 bits seguintes representavam o tipo do pacote, que podia cair em dois\rcasos:\n\rSe o tipo (na forma decimal) fosse igual a 4, ent√£o o pacote representaria\rum valor. Isso queria dizer que o resto do pacote poderia ser quebrado em\rpeda√ßos de 5 bits com a seguinte configura√ß√£o:\n\rSe o peda√ßo come√ßasse com 1, ent√£o os 4 bits a seguir eram parte do valor\re dever√≠amos continuar lendo o pacote;\n\rSe o peda√ßo come√ßassem em 0, ent√£o os 4 bits a seguir eram o final do\rvalor e poder√≠amos parar de ler o pacote.\n\r\rSe o tipo do pacote fosse diferente de 4, ent√£o o pacote representaria um\roperador. Isso queria dizer que o bit de n√∫mero 7 indicava o modo do pacote:\n\rSe o indicador fosse 1, ent√£o os pr√≥ximos 15 bits seriam iguais √† soma dos\rcomprimentos de todos os sub-pacotes contidos naquele pacote operador;\n\rSe o indicador fosse 0, ent√£o os pr√≥ximos 11 bits seriam iguais ao n√∫mero\rde sub-pacotes contidos naquele pacote operador.\n\r\r\r\rSimples? Longe disso. Vejamos alguns exemplos:\n# Pacote literal (valor)\r# D2FE28\r# 110100101111111000101000\r# VVVTTTAaaaaBbbbbCcccc\r#\r# - VVV s√£o a vers√£o do pacote, 6.\r# - TTT s√£o o tipo, 4. Ent√£o este pacote carrega um valor.\r# - A √© 1 (continuar lendo), ent√£o aaaa s√£o o primeiro peda√ßo do valor.\r# - B √© 1 (continuar lendo), ent√£o bbbb s√£o o segundo peda√ßo do valor.\r# - C √© 0 (parar de ler), ent√£o cccc s√£o o √∫ltimo peda√ßo do valor.\r# - O resto s√£o bits extras.\r# - Portanto, o valor carregado por este pacote √© 011111100101 = 2021.\r#\r# Pacote operador com indicador 0\r# 38006F45291200\r# 00111000000000000110111101000101001010010001001000000000\r# VVVTTTILLLLLLLLLLLLLLLAAAAAAAAAAABBBBBBBBBBBBBBBB\r#\r# - VVV s√£o a vers√£o do pacote, 1.\r# - TTT s√£o o tipo, 6. Ent√£o este pacote carrega um operador.\r# - I √© o indicador, 0. Ent√£o este pacote tem 15 bits com os comprimentos\r# dos sub-pacotes.\r# - LLLLLLLLLLLLLLL cont√™m a soma dos comprimentos dos sub-pacotes, 27.\r# - AAAAAAAAAAA s√£o um sub-pacote carregando um valor, 10.\r# - BBBBBBBBBBBBBBBB s√£o um sub-pacote carregando um valor, 20.\r#\r# Pacote operador com indicador 1\r# EE00D40C823060\r# 11101110000000001101010000001100100000100011000001100000\r# VVVTTTILLLLLLLLLLLAAAAAAAAAAABBBBBBBBBBBCCCCCCCCCCC\r# - VVV s√£o a vers√£o do pacote, 7.\r# - TTT s√£o o tipo, 3. Ent√£o este pacote carrega um operador.\r# - I √© o indicador, 1. Ent√£o este pacote tem 11 bits com os n√∫mero de\r# sub-pacotes.\r# - LLLLLLLLLLL cont√™m o n√∫mero de sub-pacotes, 3.\r# - AAAAAAAAAAA s√£o um sub-pacote carregando um valor, 1.\r# - BBBBBBBBBBB s√£o um sub-pacote carregando um valor, 2.\r# - CCCCCCCCCCC s√£o um sub-pacote carregando um valor, 3.\rO ponto positivo desse enunciado enorme √© que conseguimos implementar os\rrecursos necess√°rios quase em sequ√™ncia.\n# Converter string hexadecimal para string bin√°ria\rhex_to_bits \u0026lt;- function(hex) {\rhex |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\rpurrr::map(~paste(rev(as.integer(intToBits(strtoi(.x, 16)))))) |\u0026gt;\rpurrr::map(magrittr::extract, 29:32) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\rstringr::str_c(collapse = \u0026quot;\u0026quot;)\r}\r# Pegar a vers√£o de um pacote\rget_version \u0026lt;- function(pkt) {\rstrtoi(stringr::str_sub(pkt, 1, 3), 2)\r}\r# Pegar o tipo de um pacote\rget_type \u0026lt;- function(pkt) {\rstrtoi(stringr::str_sub(pkt, 4, 6), 2)\r}\rO objetivo final deste item era parsear a hierarquia de pacotes da nossa entrada\re somar as vers√µes de todos. Minha solu√ß√£o envolveu, desta forma, cirar uma\r‚Äúclasse‚Äù que podia conter a vers√£o e o comprimento de um pacote. O comprimento\rera importante para descartar o n√∫mero certo de bits do pacote quando tiv√©ssemos\rterminado de processar um sub-pacote.\nSe um pacote fosse do tipo operador, ent√£o sua ‚Äúclasse‚Äù tamb√©m conteria todos\ros seus sub-pacotes como elementos sem nome. O c√≥digo abaixo implementa o\rprocessamento dos dois tipos de pacotes; note como foram implementadas as\r‚Äúclasses‚Äù:\n# Pegar o valor de um pacote literal\rget_literal \u0026lt;- function(pkt) {\rinterval \u0026lt;- c(7, 11)\r# Iterar at√© o √∫ltimo peda√ßo ser encontrado\rliteral \u0026lt;- \u0026quot;\u0026quot;\rflag \u0026lt;- FALSE\rwhile (!flag) {\r# Pegar o grupo especificado pelo intervalo\rgroup \u0026lt;- stringr::str_sub(pkt, interval[1], interval[2])\rliteral \u0026lt;- stringr::str_c(literal, stringr::str_sub(group, 2))\r# Parar se este √© o √∫ltimo peda√ßo, caso contr√°rio somar 5 ao intervalo\rif (!as.integer(stringr::str_sub(group, 1, 1))) {\rflag \u0026lt;- TRUE\r} else {\rinterval \u0026lt;- interval + 5\r}\r}\r# Retornar a \u0026quot;classe\u0026quot; que descreve o pacote\rreturn(list(\rversion = get_version(pkt),\rlen = interval[2],\rvalue = strtoi(literal, 2)\r))\r}\r# Processar um pacote operador\rget_operator \u0026lt;- function(pkt) {\rindicator \u0026lt;- stringr::str_sub(pkt, 7, 7)\r# Inicializar \u0026quot;classe\u0026quot;\rout \u0026lt;- list(\rversion = get_version(pkt)\r)\r# Lidar com os 2 indicadores\rif (as.integer(indicator)) {\r# Pegar o n√∫mero de sub-pacotes e separar a cauda do pacote\rnum \u0026lt;- strtoi(stringr::str_sub(pkt, 8, 18), 2)\rrest \u0026lt;- stringr::str_sub(pkt, 19)\rout$len \u0026lt;- 18\r# Iterar no n√∫mero de pacotes\rfor (i in seq_len(num)) {\r# Processar sub-pacote\rsub \u0026lt;- if (get_type(rest) == 4) get_literal(rest) else get_operator(rest)\rout$len \u0026lt;- out$len + sub$len\rout \u0026lt;- c(out, list(sub))\r# Atualizar a cauda dado o compimento do √∫ltimo sub-pacote\rrest \u0026lt;- stringr::str_sub(rest, sub$len + 1)\r}\r} else {\r# Pegar o limite de comprimento dos sub-pacotes e separar a cauda\rlim \u0026lt;- strtoi(stringr::str_sub(pkt, 8, 22), 2)\rrest \u0026lt;- stringr::str_sub(pkt, 23)\rout$len \u0026lt;- 22\r# Iterar enquanto os sub-pacotes n√£o tiverem passado do limite\rwhile (lim \u0026gt; 0) {\r# Processar sub-pacote\rsub \u0026lt;- if (get_type(rest) == 4) get_literal(rest) else get_operator(rest)\rout$len \u0026lt;- out$len + sub$len\rout \u0026lt;- c(out, list(sub))\r# Atualizar a cauda dado o compimento do √∫ltimo sub-pacote\rrest \u0026lt;- stringr::str_sub(rest, sub$len + 1)\rlim \u0026lt;- lim - sub$len\r}\r}\rreturn(out)\r}\rO √∫ltimo passo do meu c√≥digo era achatar toda a estrutura de √°rvore que seria\rdevolvida pelas fun√ß√µes acima e somar todos os comprimentos.\n# Somar todas as vers√µes do pacote representado por um hex\rsum_versions \u0026lt;- function(hex) {\r# Pegar a √°rvore de pacotes representada pelo hex\rpkt \u0026lt;- hex_to_bits(hex)\rpkts \u0026lt;- if (get_type(pkt) == 4) get_literal(pkt) else get_operator(pkt)\r# Achatar √°rvore\rwhile (purrr::vec_depth(pkts) \u0026gt; 2) {\rpkts \u0026lt;- purrr::flatten(pkts)\r}\r# Somar vers√µes\rpkts |\u0026gt;\rmagrittr::extract(names(pkts) == \u0026quot;version\u0026quot;) |\u0026gt;\rpurrr::reduce(sum)\r}\r# Ler pacotes de um hex e somar vers√µes\r\u0026quot;data-raw/16a_packet_decoder.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rsum_versions()\r#\u0026gt; [1] 991\r\rDecodificador de Pacotes (B)\rO segundo item era mais ou menos o que eu j√° esperava. Os tipos dos pacotes\rtinham um significado maior, ou seja, cada sub-tipo de pacote operador indicava\ruma opera√ß√£o matem√°tica que deveria ser aplicada no valor dos seus sub-pacotes.\n\rA opera√ß√£o 0 √© soma (sum()).\n\rA opera√ß√£o 1 √© produto (prod()).\n\rA opera√ß√£o 2 √© m√≠nimo (min()).\n\rA opera√ß√£o 3 √© m√°ximo (max()).\n\rA opera√ß√£o 5 √© maior que (\u0026gt;).\n\rA opera√ß√£o 6 √© menor que (\u0026lt;).\n\rA opera√ß√£o 7 √© igual (==).\n\r\rOu seja, se um pacote tiver a estrutura\r(operador + (operador * (valor 1) (valor 2)) (valor 3)), ent√£o a express√£o\raritm√©tica resultante seria (1 * 2) + 3). Nosso objetivo final era calcular o\rvalor da express√£o que o nosso pacote representava. Felizmente, o meu script\ranterior funcionava muito bem com essa altera√ß√£o!\nEu troquei o elemento version da ‚Äúclasse‚Äù por type (o tipo do operador) e\radicionei o seguinte no final do c√≥digo:\n# Avaliar a √°rvore de pacotes\rget_value \u0026lt;- function(tree) {\r# Fun√ß√µes correspondentes aos tipos\rfun \u0026lt;- switch(as.character(tree$type),\r\u0026quot;0\u0026quot; = sum,\r\u0026quot;1\u0026quot; = prod,\r\u0026quot;2\u0026quot; = min,\r\u0026quot;3\u0026quot; = max,\r\u0026quot;5\u0026quot; = `\u0026gt;`,\r\u0026quot;6\u0026quot; = `\u0026lt;`,\r\u0026quot;7\u0026quot; = `==`,\r)\r# Aplicar fun√ß√£o aos sub-pacotes\rapply_fun \u0026lt;- function(tree) {\rtree |\u0026gt;\rpurrr::keep(names(tree) == \u0026quot;\u0026quot;) |\u0026gt;\rpurrr::map(get_value) |\u0026gt;\rpurrr::reduce(fun)\r}\r# Aplicar recursivamente\rif (tree$type == 4) tree$value else as.numeric(apply_fun(tree))\r}\r# Decodificar a express√£o de um pacote hex\rdecode \u0026lt;- function(hex) {\rpkt \u0026lt;- hex_to_bits(hex)\rtree \u0026lt;- if (get_type(pkt) == 4) get_literal(pkt) else get_operator(pkt)\rget_value(tree)\r}\r# Ler pacotes de um hex e calcular o valor da express√£o\r\u0026quot;data-raw/16b_packet_decoder.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rdecode() |\u0026gt;\rformat(scientific = FALSE)\r#\u0026gt; [1] 1264485568252\rP.S.: Mas isso n√£o funcionou de primeira! Eu recebi um belo NA ao final da\rexecu√ß√£o e demorei para entender a causa‚Ä¶ No final eu descobri que a fun√ß√£o\rstrtoi() retorna NA quando o resultado √© grande demais. A solu√ß√£o foi\rtroc√°-la por uma fun√ß√£o pr√≥pria:\nstrton \u0026lt;- function(x) {\ry \u0026lt;- as.numeric(strsplit(x, \u0026quot;\u0026quot;)[[1]])\rsum(y * 2^rev((seq_along(y) - 1)))\r}\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-16-advent-of-r-16/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 16"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nQu√≠tons (A)\rNo 15¬∫ dia do AoC eu demorei muito mais\rdo que deveria. Apesar de ter entendido bem o enunciado e ter identificado\rrapidamente o caminho para a solu√ß√£o, eu empaquei na implementa√ß√£o do\ralgoritmo. No final achei melhor pegar uma vers√£o pronta do algoritmo para n√£o\rperder mais horas com isso.\nNovamente o enunciado envolvia um submarino, uma caverna, etc. Passar por cada\rponto da caverna vinha com um certo risco que variava entre 1 e 9 e nosso\robjetivo era levar o submarino do ponto esquerdo superior at√© o ponto esquerdo\rinferior passando pelo caminho com menor risco total. A sa√≠da do programa\rdeveria ser a soma do risco de todos os pontos do caminho (sem incluir o ponto\rde entrada, pois j√° come√ß√°vamos nele).\nA esse ponto, qualquer um que tenha aprendido sobre grafos j√° deve estar com o\rsentido aranha ativado. Esse √© um problema cl√°ssico da Computa√ß√£o que pode ser\rfacilmente solucionado pelo algoritmo de\rDijkstra. Algumas\raltera√ß√µes s√£o necess√°rias, mas todas podem ser feitas antes de executar o\ralgoritmo.\nO passo-a-passo do c√≥digo √© mais ou menos o seguinte:\nMarcar todos os pontos como n√£o visitados. Criar um conjunto com todos os\rpontos n√£o visitador chamado conjunto n√£o visitado.\n\rAtribuir a todos os pontos um risco tempor√°rio: ele deve ser 0 para o n√≥\rinicial e infinito para o resto. O risco tempor√°rio de um ponto v √© o risco\rtotal do caminho de menor risco j√° descoberto entre v e o ponto inicial. Como\rno come√ßo n√£o conhecemos nenhum outro ponto al√©m do inicial, todos os riscos\rtempor√°rios come√ßam como infinito. Fixar o ponto inicial como o atual.\n\rPara o ponto atual, considerar todos os seus vizinhos n√£o vizitados e\rcalcular os seus riscos tempor√°rios atrav√©s do ponto atual. Comparar o novo\rrisco tempor√°rio ao risco atual e atribuir o menor dos dois. Por exemplo, se o\rrisco do ponto atual A √© 6 e o seu vizinho B tem risco 2, ent√£o o risco de\rchegar em B por A √© 6 + 2 = 8. Se o risco tempor√°rio de B at√© agora era\rmaior que 8, ent√£o ele deve virar 8. Caso contr√°rio, nada muda.\n\rQuando j√° tivermos considerado todos os vizinhos n√£o visitados do ponto\ratual, marcar o ponto atual como visitado e remov√™-lo do conjunto n√£o visitado.\rUm ponto visitado nunca ser√° checado de novo.\n\rSe o ponto final houver sido marcado como visitado, ent√£o parar. O algoritmo\rterminou e o risco total do melhor caminho at√© o distino √© igual ao risco\rtempor√°rio que foi atribuido ao destino.\n\rCaso contr√°rio, selecionar o ponto n√£o visitado que tem o menor risco\rtempor√°rio e torn√°-lo o ponto atual. Voltar ao passo 3.\n\r\rNormalmente o algoritmo de Dijkstra √© aplicado em grafos nos quais os custos de\rcada passo do caminho s√£o atribu√≠dos √† arestas do grafo e n√£o aos n√≥s, como √©\ro nosso caso. Para resolver esse problema, temos que fazer uma certa gin√°stica\rpara que os custos sejam transferidos para as arestas. Cada par de n√≥s vizinhos\rganham duas arestas direcionadas, cada uma com o risco do n√≥ para o qual ela\raponta:\n# Ponto atual com seus 4 vizinhos\r# 7\r# 9 3 1\r# 6\r#\r# Arestas indo para o ponto atual (todas t√™m risco 3)\r# o\r# 3\r# ‚Üì\r# o 3 ‚Üí x ‚Üê 3 o\r# ‚Üë\r# 3\r# o\r#\r# Arestas saindo do ponto atual (todas t√™m o risco do vizinho)\r# o\r# ‚Üë\r# 7\r# o ‚Üê 9 x 1 ‚Üí o\r# 6\r# ‚Üì\r# o\rEu queria ter de fato implementado o algoritmo de Dijkstra no R por conta\rpr√≥pria, mas eu cometi v√°rios erros pelo caminho (eram 7:30, n√£o me julgue) e,\rpara n√£o passar a manh√£ toda nisso, resolvi usar o pacote cppRouting para\raplicar o algoritmo.\n# Ler os riscos da caverna como uma matriz\rcave \u0026lt;- \u0026quot;data-raw/15a_chiton.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\ras.integer() |\u0026gt;\rmatrix(100, 100, byrow = TRUE)\r# Criar uma tabela com os custos entre vizinhos\rgraph \u0026lt;- tibble::tibble()\rfor (i in 1:prod(dim(cave))) {\rvals \u0026lt;- c()\rif (i %% 100 != 0) vals \u0026lt;- append(vals, i + 1L)\rif (i %% 100 != 1) vals \u0026lt;- append(vals, i - 1L)\rif (i \u0026gt; 100) vals \u0026lt;- append(vals, i - 100L)\rif (i \u0026lt; 9901) vals \u0026lt;- append(vals, i + 100L)\rnode \u0026lt;- tibble::tibble(from_vertex = i, to_vertex = vals, cost = cave[vals])\rgraph \u0026lt;- dplyr::bind_rows(graph, node)\r}\r# Criar grafo e executar o algoritmo de Dijkstra\rpath \u0026lt;- graph |\u0026gt;\rcppRouting::makegraph(directed = TRUE) |\u0026gt;\rcppRouting::get_path_pair(from = 1L, to = 10000L) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\ras.integer()\r# Calcular o risco total do caminho (subtra√≠ndo o custo da entrada)\rgraph |\u0026gt;\rdplyr::filter(to_vertex %in% path) |\u0026gt;\rdplyr::group_by(to_vertex) |\u0026gt;\rdplyr::summarise(cost = cost[1]) |\u0026gt;\rdplyr::summarise(risk = sum(cost)) |\u0026gt;\rdplyr::pull(risk) |\u0026gt;\rmagrittr::subtract(cave[1])\r#\u0026gt; [1] 811\r\rQu√≠tons (B)\rO segundo item seguia a mesma l√≥gica de outros problemas desse ano: igual ao\rprimeiro item, mas maior. Como eu estava usando um algoritmo bastante eficiente,\rn√£o tive problema nenhum nessa parte.\nAqui descobr√≠amos que, na verdade, a caverna era 5 vezes maior em cada dimens√£o\r(ou seja, 25 vezes mais pontos). A caverna completa era, entretanto, composta\rpor c√≥pias da sess√£o original com riscos mais elevados; para obter a vers√£o\rfinal da caverna era necess√°rio juntar 25 c√≥pias da original somando um certo\rfator a cada c√≥pia.\n# +0 +1 +2 +3 +4\r# +1 +2 +3 +4 +5\r# +2 +3 +4 +5 +6\r# +3 +4 +5 +6 +7\r# +4 +5 +6 +7 +8\rSeguindo o guia acima, vemos que o canto superior esquerdo da caverna maior era\rigual √† sess√£o original e, sucessivamente, cheg√°vamos ao canto direito inferior,\rque era igual √† sess√£o original, mas o risco de cada ponto era acrescido de 8.\rO √∫nico detalhe √© que, quando o risco de um ponto passava de 9, ele voltava para\r1 (igual aos polvos-dumbo que vimos anteriormente). O resto da solu√ß√£o era\rigual.\n# Criar clones da caverna, somar fator de risco e juntar\rcave \u0026lt;- cbind(\rrbind(cave + 0L, cave + 1L, cave + 2L, cave + 3L, cave + 4L),\rrbind(cave + 1L, cave + 2L, cave + 3L, cave + 4L, cave + 5L),\rrbind(cave + 2L, cave + 3L, cave + 4L, cave + 5L, cave + 6L),\rrbind(cave + 3L, cave + 4L, cave + 5L, cave + 6L, cave + 7L),\rrbind(cave + 4L, cave + 5L, cave + 6L, cave + 7L, cave + 8L)\r)\r# Reduzir pontos que passaram de 9\rcave[cave \u0026gt; 9] \u0026lt;- cave[cave \u0026gt; 9] - 9\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-15-advent-of-r-15/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 15"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final da\rjornada vamos todos ter afiado nossas habilidades de R e, quem sabe, divulgado\ressa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nPolimeriza√ß√£o Estendida (A)\rO 14¬∫ dia do AoC foi muito demorado de\rresolver para mim. Apesar de ambas as solu√ß√µes abaixo serem ‚Äúsimples‚Äù, levei\rhoras para encontrar um jeito razo√°vel de resolver o segundo item e,\rinfelizmente, s√≥ consegui depois de olhar uma dica na internet que deixou tudo\rmais simples.\nDesta vez nossa miss√£o era estender um molde de pol√≠mero atrav√©s de um conjunto\rde regras de rea√ß√£o. A primeira linha da entrada era o molde e, a partir da√≠,\rt√≠nhamos as regras de inser√ß√£o:\n# NNCB\r#\r# CH -\u0026gt; B\r# HH -\u0026gt; N\r# CB -\u0026gt; H\r# NH -\u0026gt; C\r# HB -\u0026gt; C\r# HC -\u0026gt; B\r# HN -\u0026gt; C\r# NN -\u0026gt; C\r# BH -\u0026gt; H\r# NC -\u0026gt; B\r# NB -\u0026gt; B\r# BN -\u0026gt; B\r# BB -\u0026gt; N\r# BC -\u0026gt; B\r# CC -\u0026gt; N\r# CN -\u0026gt; C\rAs regras eram f√°ceis de entender. Cada uma delas indicava que, quando os dois\relementos da esquerda se encontravam, entre eles apareceria o elemento da\rdireita. Uma rodada de rea√ß√£o envolvia estender todos os pares da cadeia\rpolim√©rica; no caso do exemplo, isso transformaria NNCB em NCNBCHB.\nAp√≥s 10 itera√ß√µes, dever√≠amos contar o n√∫mero de ocorr√™ncias do elemento mais\rcomum da cadeia e subtrair dele o n√∫mero de ocorr√™ncias do elemento menos comum\rda cadeia. Esta seria a resposta do problema.\nMeu c√≥digo para o primeiro item acabou seguindo o que chamamos de estrat√©gia de\rfor√ßa bruta. A cada\ritera√ß√£o, eu quebrava o pol√≠mero nos seus pares de elementos e fazia um join com\ra tabela de regras; depois era s√≥ colar tudo em uma string s√≥ e seguir em\rfrente. No final eu s√≥ precisava encontrar as letras mais e menos comuns da\rstring e subtra√≠-las.\n# Ler modelo como string\rpoly \u0026lt;- readr::read_lines(\u0026quot;data-raw/14a_extended_polymerization.txt\u0026quot;, n_max = 1)\r# Ler regras como tabela\rrules \u0026lt;- \u0026quot;data-raw/14a_extended_polymerization.txt\u0026quot; |\u0026gt;\rreadr::read_table(skip = 1, col_names = FALSE) |\u0026gt;\rpurrr::set_names(\u0026quot;pair\u0026quot;, \u0026quot;rm\u0026quot;, \u0026quot;insertion\u0026quot;) |\u0026gt;\rdplyr::select(-rm) |\u0026gt;\rdplyr::mutate(insertion = stringr::str_replace(\rpair, \u0026quot;(.)(.)\u0026quot;, paste0(\u0026quot;\\\\1\u0026quot;, insertion, \u0026quot;\\\\2\u0026quot;)\r))\r# Executar uma rodada de inser√ß√µes\rdo_insertions \u0026lt;- function(poly) {\rpoly |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\rpurrr::accumulate(~paste0(stringr::str_sub(.x, -1), .y)) |\u0026gt;\rutils::tail(-1) |\u0026gt;\rpurrr::map_chr(~rules[rules$pair == .x, ]$insertion) |\u0026gt;\rpurrr::reduce(~paste0(.x, stringr::str_sub(.y, -2))) |\u0026gt;\rstringr::str_c(collapse = \u0026quot;\u0026quot;)\r}\r# Rodar do_insertions() 10 vezes e fazer el. mais comum - el. menos comum\r10 |\u0026gt;\rseq_len() |\u0026gt;\rpurrr::reduce(~do_insertions(.x), .init = poly) |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rtable() |\u0026gt;\r{\\(t) list(t[which.max(t)], t[which.min(t)])}() |\u0026gt;\rpurrr::reduce(`-`) |\u0026gt;\rabs() |\u0026gt;\runname()\r#\u0026gt; [1] 2584\r\rPolimeriza√ß√£o Estendida (B)\rO segundo item parecia suspeitamente simples, mas eu estava redondamente\renganado. A √∫nica instru√ß√£o era repetir o problema do primeiro item para 40\ritera√ß√µes ao inv√©s de 10. Pode parecer que eu n√£o precisaria nem mudar meu\rc√≥digo, mas note que no primeiro item a minha cadeia polim√©rica s√≥ chegou a ter\r19457 letras. No segundo item a cadeia chegaria a‚Ä¶ mais de 20 trilh√µes.\nSeria necess√°rio mudar de estrat√©gia e foi a√≠ que eu empaquei. Tentei diversas\rformas de manter apenas o n√∫mero de letras na cadeia, sem armazenar a cadeia em\rsi, mas nada funcionava. Eu at√© notei que a primeira e a √∫ltima letras da cadeia\rnunca mudavam, mas isso n√£o me ajudou.\nDepois de procurar por dicas no\rsubreddit do AoC, finalmente achei uma\rboa alma que havia feito uma observa√ß√£o incr√≠vel:\n\rSempre podemos manter apenas a contagem de pares distintos na cadeia. Se\rtivermos, por exemplo, um par AC aparecendo n = 10 vezes na cadeia e uma regra\rAC -\u0026gt; B, ent√£o na pr√≥xima itera√ß√£o podemos adicionar √† nossa contagem AB e BC,\rcada uma aparecendo n = 10 vezes.\n\rAt√© a√≠ eu j√° sabia, era essencialmente o que eu fazia manualmente no item 1. O\rproblema √© que, mantendo apenas as contagens dos pares, isso repetiria a letra B\rduas vezes, totalizando A 10 vezes, C 10 vezes e B 20 vezes. A ideia que veio\ra seguir, entretanto, foi o que realmente resolveu o problema:\n\rSe pensarmos na cadeia como um todo, todos as letras ser√£o contadas 2 vezes,\rexceto pela primeira e pela √∫ltima, pois elas nunca ficam no meio de uma\rrea√ß√£o. O n√∫mero de ocorr√™ncias de cada letra √©, portanto, n / 2, exceto pelas\rletras que aparecem no in√≠cio e no fim, paras quais a f√≥rmula √© (n + 1) / 2.\n\rDepois disso o item 2 podia ser solucionado facilmente.\n# Registrar a primeira e a √∫ltima letras da cadeia original\rorig \u0026lt;- \u0026quot;data-raw/14b_extended_polymerization.txt\u0026quot; |\u0026gt;\rreadr::read_lines(n_max = 1) |\u0026gt;\rstringr::str_replace(\u0026quot;^(.).*?(.)$\u0026quot;, \u0026quot;\\\\1\\\\2\u0026quot;) |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::pluck(1)\r# Ler modelo j√° no formato de contagem de pares\rpoly \u0026lt;- \u0026quot;data-raw/14b_extended_polymerization.txt\u0026quot; |\u0026gt;\rreadr::read_lines(n_max = 1) |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\rpurrr::accumulate(~paste0(stringr::str_sub(.x, -1), .y)) |\u0026gt;\rutils::tail(-1) |\u0026gt;\rtibble::tibble() |\u0026gt;\rpurrr::set_names(\u0026quot;pair\u0026quot;) |\u0026gt;\rdplyr::count(pair)\r# Ler regras como tabela\rrules \u0026lt;- \u0026quot;data-raw/14b_extended_polymerization.txt\u0026quot; |\u0026gt;\rreadr::read_table(skip = 1, col_names = FALSE) |\u0026gt;\rpurrr::set_names(\u0026quot;pair\u0026quot;, \u0026quot;rm\u0026quot;, \u0026quot;insertion\u0026quot;) |\u0026gt;\rdplyr::select(-rm) |\u0026gt;\rdplyr::mutate(insertion = stringr::str_replace(\rpair, \u0026quot;(.)(.)\u0026quot;, paste0(\u0026quot;\\\\1\u0026quot;, insertion, \u0026quot;\\\\2\u0026quot;)\r))\r# Executar uma rodada de inser√ß√µes\rdo_insertions \u0026lt;- function(poly) {\rpoly |\u0026gt;\rdplyr::left_join(rules, \u0026quot;pair\u0026quot;) |\u0026gt;\rdplyr::mutate(\rinsertion = purrr::map(insertion, stringr::str_extract, c(\u0026quot;^..\u0026quot;, \u0026quot;..$\u0026quot;))\r) |\u0026gt;\rtidyr::unnest(insertion) |\u0026gt;\rdplyr::group_by(pair = insertion) |\u0026gt;\rdplyr::summarise(n = sum(n))\r}\r# Rodar do_insertions() 40 vezes e fazer el. mais comum - el. menos comum\r40 |\u0026gt;\rseq_len() |\u0026gt;\rpurrr::reduce(~do_insertions(.x), .init = poly) |\u0026gt;\rdplyr::mutate(elem = stringr::str_split(pair, \u0026quot;\u0026quot;)) |\u0026gt;\rtidyr::unnest(elem) |\u0026gt;\rdplyr::group_by(elem) |\u0026gt;\rdplyr::summarise(n = sum(n)) |\u0026gt;\rdplyr::mutate(\rn = ifelse(elem %in% orig, n + 1, n),\rn = n / 2\r) |\u0026gt;\rdplyr::filter(n == max(n) | n == min(n)) |\u0026gt;\rdplyr::pull(n) |\u0026gt;\rpurrr::reduce(`-`) |\u0026gt;\rabs() |\u0026gt;\rformat(scientific = FALSE)\r#\u0026gt; [1] 3816397135460\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-14-advent-of-r-14/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 14"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nOrigami Transparente (A)\rO dia 13 foi um belo al√≠vio comparado\rcom o dia anterior. Nossa miss√£o hoje era descobrir o c√≥digo de um sensor a\rpartir de um c√≥digo escrito em papel transparente. A entrada era uma s√©rie de\rcoordenadas de pontos no papel e uma sequ√™ncia de instru√ß√µes de como dobrar o\rpapel para obter o c√≥digo final.\nPartindo do princ√≠pio de que a matriz come√ßava no ponto (0, 0) na esqueda\rsuperior, o primeiro item pedia para que l√™ssemos a nossa lista de coordenadas e\rcontasse o n√∫mero de pontos (#) vis√≠veis depois de realizar a primeira\rinstru√ß√£o que nos era dada. Para ilustrar como as dobras ocorriam, veja os\rresultados de uma dobra em y = 7 e, depois, de uma dobra em x = 5:\n# Papel inicial\r# ...#..#..#.\r# ....#......\r# ...........\r# #..........\r# ...#....#.#\r# ...........\r# ...........\r# ...........\r# ...........\r# ...........\r# .#....#.##.\r# ....#......\r# ......#...#\r# #..........\r# #.#........\r# Linha em y = 7\r# ...#..#..#.\r# ....#......\r# ...........\r# #..........\r# ...#....#.#\r# ...........\r# ...........\r# -----------\r# ...........\r# ...........\r# .#....#.##.\r# ....#......\r# ......#...#\r# #..........\r# #.#........\r# Resultado da primeira dobra\r# #.##..#..#.\r# #...#......\r# ......#...#\r# #...#......\r# .#.#..#.###\r# ...........\r# ...........\r# Linha em x = 5\r# #.##.|#..#.\r# #...#|.....\r# .....|#...#\r# #...#|.....\r# .#.#.|#.###\r# .....|.....\r# .....|.....\r# Resultado final\r# #####\r# #...#\r# #...#\r# #...#\r# #####\r# .....\r# .....\rO maior desafio no c√≥digo em R foi arrumar todas as coordenadas e sub-matrizes\rpara um sistema que come√ßa em 1 e n√£o em 0. Eu tamb√©m resolvi fazer uma aposta:\ro primeiro item pedia para fazer apenas a primeira dobra, ent√£o eu imaginei que\ro segundo item pediria para fazer todas. Minha decis√£o, portanto, foi tentar j√°\rgeneralizar meu algortimo para que ele funcionasse com o m√≠nimo de altera√ß√µes\rposs√≠veis para realizar v√°rias dobras.\n# Ler tabela de onde os pontos est√£o\rdots \u0026lt;- \u0026quot;data-raw/13a_transparent_origami.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_subset(\u0026quot;^[0-9]\u0026quot;) |\u0026gt;\rtibble::tibble() |\u0026gt;\rpurrr::set_names(\u0026quot;dot\u0026quot;) |\u0026gt;\rtidyr::separate(dot, c(\u0026quot;x\u0026quot;, \u0026quot;y\u0026quot;), \u0026quot;,\u0026quot;) |\u0026gt;\rdplyr::mutate_all(as.integer) |\u0026gt;\rdplyr::mutate_all(`+`, 1L)\r# Ler instru√ß√µes das dobras\rinstructions \u0026lt;- \u0026quot;data-raw/13a_transparent_origami.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_subset(\u0026quot;^[^0-9]\u0026quot;) |\u0026gt;\rtibble::tibble() |\u0026gt;\rpurrr::set_names(\u0026quot;fold\u0026quot;) |\u0026gt;\rtidyr::separate(fold, c(\u0026quot;axis\u0026quot;, \u0026quot;line\u0026quot;), \u0026quot;=\u0026quot;) |\u0026gt;\rdplyr::mutate(\raxis = stringr::str_sub(axis, -1),\rline = as.integer(line) + 1L\r)\r# Colocar os pontos no papel\rpaper \u0026lt;- matrix(FALSE, nrow = max(dots$y), ncol = max(dots$x))\rfor (i in seq_len(nrow(dots))) {\rpaper[dots$y[i], dots$x[i]] \u0026lt;- TRUE\r}\r# Rodar apenas a primeira instru√ß√£o\rfor (i in 1) {\r# Achar o eixo e o ponto da dobra\raxis \u0026lt;- instructions$axis[i]\rline \u0026lt;- instructions$line[i]\r# Dobras de acordo com o eixo\rif (axis == \u0026quot;x\u0026quot;) {\r# N√∫mero de colunas √† direita da dobra\rsize \u0026lt;- length((line + 1):dim(paper)[2])\r# Pegar colunas √† direita, invert√™-las e fazer um OR com o lado esquerdo\rpaper[, (line - size):(line - 1)] \u0026lt;-\rpaper[, (line + 1):(line + size)][, size:1] |\rpaper[, (line - size):(line - 1)]\r# Descartar colunas representando o papel dobrado\rpaper \u0026lt;- paper[, 1:(line - 1)]\r} else {\r# N√∫mero de linhas abaixo da dobra\rsize \u0026lt;- length((line + 1):dim(paper)[1])\r# Pegar linhas abaixo da dobra, invert√™-las e fazer um AND com as acima\rpaper[(line - size):(line - 1), ] \u0026lt;-\rpaper[(line + 1):(line + size), ][size:1, ] |\rpaper[(line - size):(line - 1), ]\r# Descartar linhas representando o papel dobrado\rpaper \u0026lt;- paper[1:(line - 1), ]\r}\r}\r# Contar pontos no papel\rsum(paper)\r#\u0026gt; [1] 765\r\rOrigami Transparente (B)\rE minha aposta valeu √† pena! De fato o enunciado da parte 2 pedia para que\rrealiz√°ssemos todas as dobras do nosso conjunto de instru√ß√µes. No final, se tudo\restivesse correto, os # e . do papel deveriam formar 8 letras mai√∫sculas.\nA √∫nica altera√ß√£o no c√≥digo foi trocar a condi√ß√£o do for:\n# Iterar por todas as instru√ß√µes\rfor (i in seq_len(nrow(instructions)))\rE, no final, tamb√©m foi necess√°rio fazer um print melhor da matriz:\n# Imprimir os pontos de um jeito mais amig√°vel\rpaper \u0026lt;- ifelse(paper, \u0026quot;#\u0026quot;, \u0026quot;.\u0026quot;)\rfor (i in seq_len(nrow(paper))) {\rcat(paper[i, ])\rcat(\u0026quot;\\n\u0026quot;)\r}\r# # # # . . # # # # . # . . # . # # # # . # . . . . # # # . . . # # . . # . . # .\r# # . . # . . . . # . # . # . . . . . # . # . . . . # . . # . # . . # . # . . # .\r# # . . # . . . # . . # # . . . . . # . . # . . . . # . . # . # . . . . # # # # .\r# # # # . . . # . . . # . # . . . # . . . # . . . . # # # . . # . # # . # . . # .\r# # . # . . # . . . . # . # . . # . . . . # . . . . # . . . . # . . # . # . . # .\r# # . . # . # # # # . # . . # . # # # # . # # # # . # . . . . . # # # . # . . # .\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-13-advent-of-r-13/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 13"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nBusca de Caminho (A)\rO dia 12, juntamente com os anteriores,\rcome√ßou a me deixar preocupado com os pr√≥ximos exerc√≠cios do Advent of Code.\rAparentemente a dificuldade vai aumentando conforme o passar dos dias, mas j√°\restou chegando no limite do meu conhecimento.\nMais uma vez temos um enunciado complicado, ent√£o leia a vers√£o original se\rficar dif√≠cil de entender aqui. Nosso objetivo esta vez era contar o n√∫mero de\rcaminhos que o nosso submarino podia tomar em um sistema de cavernas.\nA entrada era uma lista de arestas nomeadas em um grafo. Os nossos caminhos\rdeveriam sempre come√ßar na caverna chamada ‚Äústart‚Äù e terminar na chamada ‚Äúend‚Äù,\rsendo que todas as outras eram divididas em dois grupos: grandes e pequenas. Uma\rcaverna grande era demarcada por uma letra mai√∫scula e podia ser utilizada pelo\rnosso caminho qualquer n√∫mero de vezes. J√° uma caverna pequena (demarcada por\ruma letra min√∫scula), s√≥ podia ser utilizada uma vez no caminho.\nVeja o exemplo abaixo. A primeira parte seria a entrada do problema, a segunda,\ro diagrama das cavernas e a terceira, os 10 poss√≠veis caminhos para o nosso\rsubmarino.\n# start-A\r# start-b\r# A-c\r# A-b\r# b-d\r# A-end\r# b-end\r# start\r# / \\\r# c--A-----b--d\r# \\ /\r# end\r# start,A,b,A,c,A,end\r# start,A,b,A,end\r# start,A,b,end\r# start,A,c,A,b,A,end\r# start,A,c,A,b,end\r# start,A,c,A,end\r# start,A,end\r# start,b,A,c,A,end\r# start,b,A,end\r# start,b,end\rMinha solu√ß√£o envolvia uma tabela que representava todas as arestas do grafo do\rsistema de cavernas. A cada nova recurs√£o, a √∫ltima caverna poderia ser mantida\rna tabela ou removida (no caso das cavernas pequenas); toda vez que um caminho\rchegasse ao ‚Äúend‚Äù, um contador global era incrementado.\n# Contar caminhos distintos em um grafo\rcount \u0026lt;- 0\rcount_paths \u0026lt;- function(graph, path = \u0026quot;start\u0026quot;) {\r# Verificar se o n√≥ atual √© \u0026quot;pequeno\u0026quot;\rcave \u0026lt;- tail(path, 1)\ris_small \u0026lt;- stringr::str_to_lower(cave) == cave\r# Condi√ß√µes de parada\rif (cave == \u0026quot;end\u0026quot;) {count \u0026lt;\u0026lt;- count + 1; return(1)}\rif (!any(graph$orig == cave)) return(0)\r# Encontrar pr√≥ximo n√≥ do caminho\rsearches \u0026lt;- graph |\u0026gt;\rdplyr::filter(orig == cave) |\u0026gt;\rdplyr::pull(dest) |\u0026gt;\rpurrr::map(purrr::prepend, path)\r# Atualizar n√≥s dispon√≠veis\rgraph \u0026lt;- if (is_small) dplyr::filter(graph, orig != cave) else graph\r# Iterar nos poss√≠veis caminhos\rfor (search in searches) {\rcount_paths(graph, search)\r}\r# Retornar contador global\rreturn(count)\r}\r# Ler arestas do grafo e retornar conta dos caminhos\r\u0026quot;data-raw/12a_passage_pathing.txt\u0026quot; |\u0026gt;\rreadr::read_table(col_names = \u0026quot;path\u0026quot;) |\u0026gt;\rtidyr::separate(path, c(\u0026quot;orig\u0026quot;, \u0026quot;dest\u0026quot;), \u0026quot;-\u0026quot;) |\u0026gt;\r{\\(d) dplyr::bind_rows(d, purrr::set_names(d, rev(names(d))))}() |\u0026gt;\rdplyr::filter(dest != \u0026quot;start\u0026quot;, orig != \u0026quot;end\u0026quot;) |\u0026gt;\rcount_paths()\r#\u0026gt; [1] 4792\r\rBusca de Caminho (B)\rO segundo item do problema mudava muito pouco o enunciado. Agora, ao inv√©s de\rcada caverna pequena poder ser visitada apenas 1 vez, t√≠nhamos um pequeno\racr√©scimo de tempo. Isso queria dizer que, em cada caminho at√© o final do\rsistema de cavernas, pod√≠amos visitar apenas 1 das cavernas pequenas at√© 2\rvezes.\nMinha solu√ß√£o foi criar um argumento chamado boost que indicava se j√° t√≠nhamos\rusado o nosso excedente de tempo naquele caminho expec√≠fico. Se n√£o tiv√©ssemos,\rpoder√≠amos n√£o retirar uma das cavernas pequenas da lista imediatamente. Esta\restrat√©gia funcionou, mas gerou caminhos repetidos (usando e n√£o usando o\rboost), ent√£o, ao inv√©s de contar os caminhos, passei a salvar os caminhos e\rcontar o n√∫mero de caminhos distintos no final.\n# Pegar todos os caminhos distintos em um grafo\rall_paths \u0026lt;- list()\rget_paths \u0026lt;- function(graph, path = \u0026quot;start\u0026quot;, boost = FALSE) {\r# Verificar se o n√≥ atual √© \u0026quot;pequeno\u0026quot;\rcave \u0026lt;- tail(path, 1)\ris_small \u0026lt;- stringr::str_to_lower(cave) == cave\r# Condi√ß√µes de parada\rif (cave == \u0026quot;end\u0026quot;) {all_paths \u0026lt;\u0026lt;- append(all_paths, list(path)); return(1)}\rif (!any(graph$orig == cave)) return(0)\r# Encontrar pr√≥ximo n√≥ do caminho\rsearches \u0026lt;- graph |\u0026gt;\rdplyr::filter(orig == cave) |\u0026gt;\rdplyr::pull(dest) |\u0026gt;\rpurrr::map(purrr::prepend, path)\r# Atualizar n√≥s dispon√≠veis\rgraph_ \u0026lt;- if (is_small) dplyr::filter(graph, orig != cave) else graph\r# Iterar nos poss√≠veis caminhos\rfor (search in searches) {\rget_paths(graph_, search, boost = boost)\r# Uma op√ß√£o √© n√£o remover o n√≥ do grafo e usar o boost\rif (!boost \u0026amp;\u0026amp; is_small \u0026amp;\u0026amp; cave != \u0026quot;start\u0026quot;) {\rget_paths(graph, search, boost = TRUE)\r}\r}\r# Retornar lista global\rreturn(all_paths)\r}\r# Ler arestas do grafo e retornar conta dos caminhos distintos\r\u0026quot;data-raw/12b_passage_pathing.txt\u0026quot; |\u0026gt;\rreadr::read_table(col_names = \u0026quot;path\u0026quot;) |\u0026gt;\rtidyr::separate(path, c(\u0026quot;orig\u0026quot;, \u0026quot;dest\u0026quot;), \u0026quot;-\u0026quot;) |\u0026gt;\r{\\(d) dplyr::bind_rows(d, purrr::set_names(d, rev(names(d))))}() |\u0026gt;\rdplyr::filter(dest != \u0026quot;start\u0026quot;, orig != \u0026quot;end\u0026quot;) |\u0026gt;\rget_paths() |\u0026gt;\rpurrr::map_chr(stringr::str_c, collapse = \u0026quot;|\u0026quot;) |\u0026gt;\runique() |\u0026gt;\rlength()\r#\u0026gt; [1] 133360\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-12-advent-of-r-12/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 12"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final da\rjornada vamos todos ter afiado nossas habilidades de R e, quem sabe, divulgado\ressa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nPolvo-dumbo (A)\rO dia 11 do AoC foi bastante complicado\re o meu c√≥digo talvez tenha ficado pior ainda. As instru√ß√µes eram at√© simples:\rrecebemos uma matriz 10x10 com os n√≠veis de energia de 100\rpolvos-dumbo e precis√°vamos\racompanhar seus n√≠veis de energia ao longo de 100 itera√ß√µes. As regras eram as\rseguintes:\n\rPrimeiro, o n√≠vel de energia de cada polvo sobe em 1.\n\rDepois, qualquer polvo com n√≠vel de energia maior que 9 emite luz (pisca).\rIsso aumenta o n√≠vel de energia de todos os polvos adjacentes em 1, incluindo os\radjacentes diagonalmente. Se isso causar um polvo a atingir um n√≠vel de energia\rmaior que 9, ele tamb√©m pisca. Esse processo continua conforme mais polvos\rpassam do n√≠vel de energia 9. Um polvo s√≥ pode piscar uma vez por passo e n√£o\rpode subir mais nenhum n√≠vel de energia a partir da√≠.\n\rFinalmente, todos os polvos que piscaram durante este passo t√™m seus n√≠veis de\renergia ajustados para 0 (j√° que ele usou toda a sua energia para piscar).\n\r\rMeu c√≥digo seguia esse procedimento √† risca e precisou de 3 loops aninhados para\rfuncionar. O truque mais importante foi criar um clone dos polvos que marcava\rtodos os polvos que j√° tinham piscado para garantir que nenhum deles ganharia\rmais energia durante aquele passo; este mecanismo envolvia marcar um polvo que\rpiscava com 0 e um polvo que tinha piscado em qualquer ponto anterior do loop\rcom -1 (para que ele n√£o fosse contado duas vezes). O resultado final deveria\rser o n√∫mero de piscadas totais depois dos 100 passos.\n# Ler matriz\rdumbo \u0026lt;- \u0026quot;data-raw/11a_dumbo_octopus.txt\u0026quot; |\u0026gt;\rreadr::read_table(col_names = FALSE) |\u0026gt;\rtidyr::separate(X1, paste0(\u0026quot;C\u0026quot;, 0:10), \u0026quot;\u0026quot;) |\u0026gt;\rdplyr::select(-C0) |\u0026gt;\rdplyr::mutate_all(as.numeric) |\u0026gt;\ras.matrix()\r# Iterar nos 100 passos\rflashes \u0026lt;- 0\rfor (k in 1:100) {\r# Aumentar n√≠veis de energia\rdumbo \u0026lt;- (dumbo + 1) %% 10\r# Adicionar energia aos polvos cujos vizinhos piscaram\rflag \u0026lt;- FALSE\rwhile(!flag) {\r# Contar piscadas\rflashes \u0026lt;- flashes + sum(dumbo == 0)\r# Adicionar energia aos polvos adjacentes a piscadas\rdumbo_ \u0026lt;- dumbo\rfor (i in 1:10) {\rfor (j in 1:10) {\r# √çndices dos vizinhos\ri1 \u0026lt;- i - 1\ri2 \u0026lt;- min(i + 1, 10)\rj1 \u0026lt;- j - 1\rj2 \u0026lt;- min(j + 1, 10)\r# Adicionar energia nos √≠ndices (exceto no centro)\rif (dumbo[i, j] == 0) {\rdumbo_[i1:i2, j1:j2] \u0026lt;- dumbo_[i1:i2, j1:j2] + 1\rdumbo_[i, j] \u0026lt;- dumbo_[i, j] - 1\r}\r}\r}\r# Separar piscadas anteriores dos que piscaram na √∫ltima itera√ß√£o\rdumbo \u0026lt;- ifelse(dumbo == -1, 0, dumbo)\r# Sobrescrever as piscadas com 0 (eles n√£o podem receber mais energia)\rdumbo \u0026lt;- ifelse(dumbo == 0, 0, dumbo_)\r# Verificar se o passo atual acabou\rif (!any(dumbo \u0026gt; 9)) {\rflag \u0026lt;- TRUE\r} else {\r# Prevenir piscadas antigas de serem contadas de novo\rdumbo \u0026lt;- ifelse(dumbo == 0, -1, dumbo)\rdumbo \u0026lt;- ifelse(dumbo \u0026gt; 9, 0, dumbo)\r}\r}\r}\r# Imprimir\rflashes\r#\u0026gt; [1] 1681\r\rPolvo-dumbo (B)\rFelizmente o segundo item o exerc√≠cio de hoje foi bem mais simples.\rEventualmente todos os polvos entram em sincronia, ou seja, passam a piscar\rtodos juntos; o nosso objetivo era descobrir em que passo isso acontecia. A\r√∫nica coisa que precisei fazer com o c√≥digo do item anterior foi ignorar o\rlimite de passos e criar uma verifica√ß√£o para quando todos os polvos atingiam 0\rde energia juntos.\n# Ler matriz\rdumbo \u0026lt;- \u0026quot;data-raw/11b_dumbo_octopus.txt\u0026quot; |\u0026gt;\rreadr::read_table(col_names = FALSE) |\u0026gt;\rtidyr::separate(X1, paste0(\u0026quot;C\u0026quot;, 0:10), \u0026quot;\u0026quot;) |\u0026gt;\rdplyr::select(-C0) |\u0026gt;\rdplyr::mutate_all(as.numeric) |\u0026gt;\ras.matrix()\r# Iterar em 1000 passos\rfor (k in 1:1000) {\rprint(k)\r# Aumentar n√≠veis de energia\rdumbo \u0026lt;- (dumbo + 1) %% 10\r# Adicionar energia aos polvos cujos vizinhos piscaram\rflag \u0026lt;- FALSE\rwhile(!flag) {\r# Adicionar energia aos polvos adjacentes a piscadas\rdumbo_ \u0026lt;- dumbo\rfor (i in 1:10) {\rfor (j in 1:10) {\r# √çndices dos vizinhos\ri1 \u0026lt;- i - 1\ri2 \u0026lt;- min(i + 1, 10)\rj1 \u0026lt;- j - 1\rj2 \u0026lt;- min(j + 1, 10)\r# Adicionar energia nos √≠ndices (exceto no centro)\rif (dumbo[i, j] == 0) {\rdumbo_[i1:i2, j1:j2] \u0026lt;- dumbo_[i1:i2, j1:j2] + 1\rdumbo_[i, j] \u0026lt;- dumbo_[i, j] - 1\r}\r}\r}\r# Separar piscadas anteriores dos que piscaram na √∫ltima itera√ß√£o\rdumbo \u0026lt;- ifelse(dumbo == -1, 0, dumbo)\r# Sobrescrever as piscadas com 0 (eles n√£o podem receber mais energia)\rdumbo \u0026lt;- ifelse(dumbo == 0, 0, dumbo_)\r# Verificar se o passo atual acabou\rif (!any(dumbo \u0026gt; 9)) {\rflag \u0026lt;- TRUE\r} else {\r# Prevenir piscadas antigas de serem contadas de novo\rdumbo \u0026lt;- ifelse(dumbo == 0, -1, dumbo)\rdumbo \u0026lt;- ifelse(dumbo \u0026gt; 9, 0, dumbo)\r}\r}\r# Parar se todos os polvos tiverem piscado\rif (all(dumbo %in% c(0, -1))) {\rbreak()\r}\r}\r# Imprimir\rk\r#\u0026gt; [1] 276\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-11-advent-of-r-11/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 11"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nPontua√ß√£o de Sintaxe (A)\rO dia 10 do AoC pedia para que\rresolvessemos um cl√°ssico problema de parentiza√ß√£o com alguns facilitadores. Em\rresumo, receb√≠amos uma string composta por par√™nteses e seus amigos (‚Äú(‚Äù, ‚Äú[‚Äù,\r‚Äù{‚Äù, ‚Äù\u0026lt;‚Äù, ‚Äù\u0026gt;‚Äù, ‚Äù}‚Äù, ‚Äù]‚Äù, ‚Äú)‚Äù) e precis√°vamos identificar se o fechamento de\ralgum deles estava errado, por exemplo, ‚Äú[}‚Äù, ‚Äú{()()()\u0026gt;‚Äù, etc. Para cada string\rque tivesse um fechamento ilegal recebia uma quantidade de pontos de acordo com\ra tabela abaixo e, finalmente, a sa√≠da do exerc√≠cio era a soma de todas as\rpontua√ß√µes.\n# ): 3 pontos.\r# ]: 57 pontos.\r# }: 1197 pontos.\r# \u0026gt;: 25137 pontos.\rPara quem nunca viu um problema desse tipo, a solu√ß√£o pode ser alcan√ßada\rfacilmente usando uma\rpilha. Cada caractere\rque abre um bloco √© colocado na pilha e, para cada caractere que fecha um bloco,\rremovemos o elemento do topo da pilha. Se os caracteres se complementam\rcorretamente o algoritmo segue em frente, caso contr√°rio ele busca a pontua√ß√£o\rna tabela e retorna.\n# Correspond√™ncia de valores\rscores \u0026lt;- list(\r\u0026quot;)\u0026quot; = 3,\r\u0026quot;]\u0026quot; = 57,\r\u0026quot;}\u0026quot; = 1197,\r\u0026quot;\u0026gt;\u0026quot; = 25137\r)\r# Calcular a pontua√ß√£o por caractere ilegal em uma linha\rscore_ilegal \u0026lt;- function(line) {\rstack \u0026lt;- flifo::lifo()\r# Iterar na linha at√© um elemento n√£o corresponder\rsymbols \u0026lt;- stringr::str_split(line, \u0026quot;\u0026quot;)[[1]]\rfor (symbol in symbols) {\r# Empilhar ou desempilhar (e calcular pontua√ß√£o se necess√°rio)\rif (symbol %in% c(\u0026quot;(\u0026quot;, \u0026quot;[\u0026quot;, \u0026quot;{\u0026quot;, \u0026quot;\u0026lt;\u0026quot;)) {\rflifo::push(stack, symbol)\r} else {\rcheck \u0026lt;- flifo::pop(stack)\rif (\r(check == \u0026quot;{\u0026quot; \u0026amp;\u0026amp; symbol != \u0026quot;}\u0026quot;) ||\r(check == \u0026quot;(\u0026quot; \u0026amp;\u0026amp; symbol != \u0026quot;)\u0026quot;) ||\r(check == \u0026quot;[\u0026quot; \u0026amp;\u0026amp; symbol != \u0026quot;]\u0026quot;) ||\r(check == \u0026quot;\u0026lt;\u0026quot; \u0026amp;\u0026amp; symbol != \u0026quot;\u0026gt;\u0026quot;)\r) {\rreturn(scores[names(scores) == symbol][[1]])\r}\r}\r}\rreturn(0)\r}\r# Iterar nas linhas e calcular pontua√ß√µes\r\u0026quot;data-raw/10a_syntax_scoring.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rpurrr::map_dbl(score_ilegal) |\u0026gt;\rsum()\r#\u0026gt; [1] 216297\r\rPontua√ß√£o de Sintaxe (B)\rO segundo item do problema pedia para que come√ß√°ssemos removendo as linhas que\rtinham pontua√ß√£o maior que 0 (ent√£o s√≥ foi necess√°rio filtrar isso no c√≥digo,\rque vou omitir). Depois disso o objetivo era completar as linhas que restavam.\nO fato √© que as linhas restantes estavam todas com um peda√ßo faltando, por\rexemplo, ‚Äú[({(\u0026lt;(())[]\u0026gt;[[{[]{\u0026lt;()\u0026lt;\u0026gt;\u0026gt;‚Äù precisa ainda de ‚Äù}}]])})]‚Äù para ficar\rcorreta. Usando a l√≥gica do item anterior, s√≥ precis√°vamos seguir o mesmo\rroteiro e, ao final da linha, contar os pontos dos caracteres que ainda haviam\rsobrado na pilha.\nDesta vez a regra de pontua√ß√£o era diferente: para cada caractere faltante,\rprecis√°vamos multiplicar a pontua√ß√£o corrente por 5 e ent√£o somar o valor do\rcaractere de acordo com uma nova tabelha. A resposta final era a mediana da\rpontua√ß√£o de todoas as linhas. Enfim, o c√≥digo vai a seguir:\n# Ler linhas e remover corrompidas\rlines \u0026lt;- readr::read_lines(\u0026quot;data-raw/10b_syntax_scoring.txt\u0026quot;)\rlines \u0026lt;- lines[purrr::map_dbl(lines, score_ilegal) == 0]\r# Correspond√™ncia de valores\rscores \u0026lt;- list(\r\u0026quot;(\u0026quot; = 1,\r\u0026quot;[\u0026quot; = 2,\r\u0026quot;{\u0026quot; = 3,\r\u0026quot;\u0026lt;\u0026quot; = 4\r)\r# Calcular a pontua√ß√£o por caractere faltante em uma linha\rscore_complete \u0026lt;- function(line) {\rstack \u0026lt;- flifo::lifo()\r# Iterar na linha e remover parte completa\rsymbols \u0026lt;- stringr::str_split(line, \u0026quot;\u0026quot;)[[1]]\rfor (symbol in symbols) {\r# Empilhar ou desempilhar\rif (symbol %in% c(\u0026quot;(\u0026quot;, \u0026quot;[\u0026quot;, \u0026quot;{\u0026quot;, \u0026quot;\u0026lt;\u0026quot;)) {\rflifo::push(stack, symbol)\r} else {\rflifo::pop(stack)\r}\r}\r# Iterar no resto da pilha e calcular pontos\rscore \u0026lt;- 0\rwhile (flifo::size(stack) \u0026gt; 0) {\rcheck \u0026lt;- flifo::pop(stack)\rscore \u0026lt;- (score * 5) + scores[names(scores) == check][[1]]\r}\rreturn(score)\r}\r# Pegar mediana das pontua√ß√µes\rlines |\u0026gt;\rpurrr::map_dbl(score_complete) |\u0026gt;\rmedian()\r#\u0026gt; [1] 2165057169\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-10-advent-of-r-10/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 10"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nBacia de Fuma√ßa (A)\rO dia 9 do AoC foi desafiador, apesar de\rn√£o tanto quanto o anterior. Como sempre o problema envolvia uma historinha que\rn√£o contribui muito para o entendimento do enunciado, ent√£o vamos direto ao\rponto: recebemos uma matriz 100x100 que representa um mapa de alturas e\rprecis√°vamos encontrar todos os pontos que eram cercados (em cima, embaixo, na\resquerda e na direita) por pontos mais altos. Ademais sab√≠amos que as alturas\riam de 0 a 9 e que as fronteiras fora do mapa podiam ser todas consideradas mais\raltas que o resto do mapa. A resposta do problema seria o risco total de todos\ros pontos baixos, onde o risco de um ponto √© igual √† sua altura + 1.\nO problema n√£o √© t√£o complicado, pois bastaria iterar em todos os pontos da\rmatriz e comparar cada um com seus vizinhos. O maior dezafio era lidar com as\rfronteiras do mapa. Para isso, resolvi cercar toda a matriz por noves e iterar\rno quadrado 2:101x2:101.\n# Ler o mapa de alturas e estofar as fronteiras com 9\rheight \u0026lt;- \u0026quot;data-raw/09a_smoke_basin.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\ras.integer() |\u0026gt;\rmatrix(nrow = 100, ncol = 100, byrow = TRUE) |\u0026gt;\rrbind(rep(9, 100)) |\u0026gt;\r{\\(m) rbind(rep(9, 100), m)}() |\u0026gt;\rcbind(rep(9, 102)) |\u0026gt;\r{\\(m) cbind(rep(9, 102), m)}()\r# Iterar por todos os pontos\rrisk \u0026lt;- 0\rfor (i in 2:101) {\rfor (j in 2:101) {\r# Verificar se √© um ponto baixo e somar o risco ao total\rif (\rheight[i, j] \u0026lt; height[i - 1, j] \u0026amp;\u0026amp;\rheight[i, j] \u0026lt; height[i + 1, j] \u0026amp;\u0026amp;\rheight[i, j] \u0026lt; height[i, j - 1] \u0026amp;\u0026amp;\rheight[i, j] \u0026lt; height[i, j + 1]\r) {\rrisk \u0026lt;- risk + height[i, j] + 1\r}\r}\r}\r# Imprimir\rrisk\r#\u0026gt; [1] 494\r\rBacia de Fuma√ßa (B)\rO segundo item j√° era mais complicado. Considerando que os pontos com altura 9\rn√£o pertencem a nenhuma bacia, precis√°vamos encontrar as 3 maiores bacias no\rnosso mapa. Uma bacia √© definida por toda uma regi√£o cercada por noves e seu\rtamanho √© igual ao n√∫mero de pontos cont√≠guos contidos nessa √°rea.\nO diagrama abaixo n√£o estava no enunciado, mas ele me ajudou muito a entender o\rque era uma bacia. Para cri√°-lo, eu peguei um ret√¢ngulo na ponta do meu mapa e\rsubstitu√≠ todos os n√∫meros menores que 9 por um ., representando assim as\rbacias. Cada regi√£o cercada por noves √© uma bacia diferente.\n# ....999.........9.9....99......9....9..........9\r# ...9.9.9.......9...9..9.......9.9...99.99.9.....\r# ..9.....9.9.....9...99...........999.999.9.9....\r# ..9......9.9...9....999.........9..9..9.....999.\r# 99..........999......9999......9..9..9.....9...9\r# ...........9..9........99...9.9.......9.........\r# 9..............9...9..9..9.99.9......9..........\r# ...........99.9...9.99....9..99.....9...........\r# ............99....9..9.......9.......9..........\r# 9........99999...9....9.9....9.......999........\rMinha solu√ß√£o come√ßou igual √† do item anterior, mas desta vez criei tamb√©m uma\rtabela com todos os pontos do mapa. Meu objetivo era fazer uma\rbusca em largura e remover\rdesta tabela os pontos j√° explorados.\n# Criar uma tabela de pontos a explorar\rpoints \u0026lt;- purrr::cross2(2:101, 2:101) |\u0026gt;\rpurrr::map(purrr::flatten_int) |\u0026gt;\rpurrr::transpose() |\u0026gt;\rpurrr::set_names(\u0026quot;i\u0026quot;, \u0026quot;j\u0026quot;) |\u0026gt;\rtibble::as_tibble() |\u0026gt;\rtidyr::unnest(c(i, j))\rA seguir eu criei uma fun√ß√£o que explorava uma bacia a partir de um ponto\r‚Äúsemente‚Äù. O primeiro passo era verificar se o ponto j√° tinha sido explorado e\rretornar 0 se sim (indicando que aquele ponto n√£o contribuiria mais para o\rtamanho da bacia). Se o ponto n√£o tivesse sido explorado, ent√£o o c√≥digo o\rremovia da tabela de pontos e verificava se ele tinha altura 9, mais uma vez\rretornando 0 se sim. O final da fun√ß√£o aplicava uma recurs√£o nos 4 vizinhos do\rponto, somando os tamanhos das 4 sub-bacias encontradas mais 1 (indicando que o\rponto ‚Äúsemente‚Äù contribuia em 1 para o tamanho total da bacia).\n# Explorar uma bacia\rexplore \u0026lt;- function(a, b) {\r# Pular se o ponto j√° tiver sido explorado\rif (nrow(dplyr::filter(points, i == a, j == b)) == 0) return(0)\r# Marcar o ponto como explorado\rpoints \u0026lt;\u0026lt;- dplyr::filter(points, i != a | j != b)\r# Se a altura for 9, ent√£o ele n√£o faz parte da bacia\rif (height[a, b] == 9) return(0)\r# Adicionar os pontos vizinhos √† bacia\rreturn(\rexplore(a - 1, b) +\rexplore(a + 1, b) +\rexplore(a, b - 1) +\rexplore(a, b + 1) + 1\r)\r}\rA resposta para o item era o produto dos tamanhos das 3 maiores bacias do mapa,\rent√£o o programa terminava iterando na matriz, calculando o tamanho de todas as\rbacias e seguindo para obter o resultado final.\n# Iterar por todos os pontos\rbasins \u0026lt;- matrix(rep(0, 10404), 102, 102)\rfor (i in 2:101) {\rfor (j in 2:101) {\rbasins[i, j] \u0026lt;- explore(i, j)\r}\r}\r# Multiplicar as 3 maiores bacias\rbasins |\u0026gt;\rsort(decreasing = TRUE) |\u0026gt;\rmagrittr::extract(1:3) |\u0026gt;\rprod()\r#\u0026gt; [1] 1048128\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-09-advent-of-r-09/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 09"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nBusca em Sete Segmentos (A)\rO oitavo dia do AoC foi bastante dif√≠cil\rpara mim. O problema come√ßou pelo enunciado, que √© longo e complexo, ent√£o\rrealmente recomendo ler a vers√£o original al√©m do resumo que trago abaixo.\nDito isso, vamos l√°. O problema dizia respeito a\rdisplays de sete segmentos,\ronde cada n√∫mero √© representado por um conjunto de segmentos acessos; de acordo\rcom o diagrama abaixo, vemos que 0 √© representado por abcefg, 1 √© cf e assim\rpor diante.\n# 0: 1: 2: 3: 4:\r# aaaa .... aaaa aaaa ....\r# b c . c . c . c b c\r# b c . c . c . c b c\r# .... .... dddd dddd dddd\r# e f . f e . . f . f\r# e f . f e . . f . f\r# gggg .... gggg gggg ....\r# 5: 6: 7: 8: 9:\r# aaaa aaaa aaaa aaaa aaaa\r# b . b . . c b c b c\r# b . b . . c b c b c\r# dddd dddd .... dddd dddd\r# . f e f . f e f . f\r# . f e f . f e f . f\r# gggg gggg .... gggg gggg\rO desafio √© que, no nosso submarino, todo os displays est√£o com os fios\rtrocados e, para piorar, cada display tem um arranjo diferente. A entrada do\rproblema √© uma s√©rie de linhas como a abaixo: como os 10 d√≠gitos s√£o\rrepresentados em um display espec√≠fico (em qualquer ordem) e, depois da barra,\r4 d√≠gitos que precisamos decodificar.\n# acedgfb cdfbe gcdfa fbcad dab cefabd cdfgeb eafb cagedb ab |\r# cdfeb fcadb cdfeb cdbaf\rAlguns d√≠gitos s√£o f√°ceis de identificar. Os n√∫meros 1, 4, 7 e 8 usam n√∫meros\r√∫nicos de segmentos, ent√£o √© poss√≠vel perceber que, quando ab acenderam, o\rdisplay estava tentando mostrar um 1. Seguindo a mesma l√≥gica, dab √© 7, eafb\r√© 4 e acedgfb √© 8.\nO objetivo do primeiro item do dia 08 era contar quantas vezes os d√≠gitos 1, 4,\r7 e 8 aparecem nas sa√≠das que devemos decodificar (lado direito da barra). A\rsolu√ß√£o foi bem simples, pois bastou pivotar a tabela e filtrar as linhas que\rtinham stringr::str_length() igual a 2, 3, 4, ou 7.\n\u0026quot;data-raw/08a_seven_segment_search.txt\u0026quot; |\u0026gt;\rreadr::read_delim(\u0026quot; \u0026quot;, col_names = NULL) |\u0026gt;\rpurrr::set_names(\rpaste0(\u0026quot;P\u0026quot;, stringr::str_pad(1:10, 2, \u0026quot;left\u0026quot;, \u0026quot;0\u0026quot;)), \u0026quot;remove\u0026quot;,\rpaste0(\u0026quot;V\u0026quot;, stringr::str_pad(1:4, 2, \u0026quot;left\u0026quot;, \u0026quot;0\u0026quot;))\r) |\u0026gt;\rdplyr::select(-remove) |\u0026gt;\rdplyr::select(V01:V04) |\u0026gt;\rtidyr::pivot_longer(V01:V04, names_to = \u0026quot;col\u0026quot;, values_to = \u0026quot;value\u0026quot;) |\u0026gt;\rdplyr::filter(stringr::str_length(value) %in% c(2, 4, 3, 7)) |\u0026gt;\rnrow()\r#\u0026gt; [1] 365\r\rBusca em Sete Segmentos (B)\rO verdadeiro problema veio no item 2. Aqui o exerc√≠cio abandona qualquer\rpretexto de bondade e pede de uma vez para decodificarmos os d√≠gitos depois da\rbarra baseados nos 10 padr√µes antes da barra. A sa√≠da deveria ser a soma de\rtodos os n√∫meros de 4 d√≠gitos decodificados.\nMinha primeira tentativa de resolver o problema testava cada segmento em cada\rposi√ß√£o (essencialmente verificando todos os poss√≠veis jeitos de embaralhar os\rfios) para ver em qual das configura√ß√µes os padr√µes faziam sentido; depois seria\rs√≥ bater os padr√µes com os 4 d√≠gitos da direita para ver quem √© quem. N√£o\rpreciso nem dizer que isso seria demorado demais para funcionar.\nDepois de um tempo olhando para o arquivo de entrada, entretanto, me veio uma\rluz: talvez eu pudesse analisar a frequ√™ncia com a qual cada segmento aparece\rnos padr√µes. Perceba, por exemplo, que no diagrama acima o segmento e est√°\rligado em 4 d√≠gitos (0, 2, 6 e 8). O fato importante √© que ele √© o √∫nico\rsegmento com essa propriedade!\nPartindo deste princ√≠pio, criei as seguinte regras para o c√≥digo:\nO √∫nico segmento que aparecer 4 vezes nos padr√µes corresponder√° ao e;\n\rO √∫nico segmento que aparecer 6 vezes nos padr√µes corresponder√° ao b;\n\rO √∫nico segmento que aparecer 9 vezes nos padr√µes corresponder√° ao f;\n\rNo padr√£o com 2 segmentos acessos, aquele que n√£o representar o e\rcorresponder√° ao c (n√∫mero 1).\n\rNo padr√£o com 3 segmentos acessos, aquele que n√£o representar c ou f\rcorresponder√° ao a (n√∫mero 7).\n\rNo padr√£o com 4 segmentos acessos, aquele que n√£o representar b, c ou f\rcorresponder√° ao d (n√∫mero 4).\n\rO segmento que ainda n√£o tiver correspondente corresponder√° ao g.\n\r\rO resto do c√≥digo cuidava de organizar as letras de cada d√≠gito de modo que\rfosse f√°cil transpor as correspond√™ncias dos 10 padr√µes para os 4 valores das\rsa√≠das.\n# Decodificar uma linha da entrada\rdecode \u0026lt;- function(entry) {\r# Encontra e quebra o padr√£o que tenha certa str_length()\rfind_by_len \u0026lt;- function(patterns, len) {\rpatterns |\u0026gt;\rmagrittr::extract(stringr::str_length(patterns) == len) |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::pluck(1)\r}\r# Frequ√™ncias de refer√™ncia\rref_freq \u0026lt;- list(\r\u0026quot;a\u0026quot; = 8,\r\u0026quot;b\u0026quot; = 6,\r\u0026quot;c\u0026quot; = 8,\r\u0026quot;d\u0026quot; = 7,\r\u0026quot;e\u0026quot; = 4,\r\u0026quot;f\u0026quot; = 9,\r\u0026quot;g\u0026quot; = 7\r)\r# Valores de refer√™ncia\rref_val \u0026lt;- list(\r\u0026quot;abdefg\u0026quot; = 6,\r\u0026quot;abcefg\u0026quot; = 0,\r\u0026quot;cf\u0026quot; = 1,\r\u0026quot;acdfg\u0026quot; = 3,\r\u0026quot;abcdfg\u0026quot; = 9,\r\u0026quot;abcdefg\u0026quot; = 8,\r\u0026quot;bcdf\u0026quot; = 4,\r\u0026quot;acf\u0026quot; = 7,\r\u0026quot;abdfg\u0026quot; = 5,\r\u0026quot;acdeg\u0026quot; = 2\r)\r# Calcular frequ√™ncias desta entrada\rcur_freq \u0026lt;- entry |\u0026gt;\rdplyr::select(P01:P10) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\rtable()\r# Criar um dicion√°rio para traduzir os segmentos\rdict \u0026lt;- list()\r# Traduzir segmentos com frequ√™ncias √∫nicas\rdict[[\u0026quot;e\u0026quot;]] \u0026lt;- names(cur_freq[cur_freq == 4])\rdict[[\u0026quot;b\u0026quot;]] \u0026lt;- names(cur_freq[cur_freq == 6])\rdict[[\u0026quot;f\u0026quot;]] \u0026lt;- names(cur_freq[cur_freq == 9])\r# Extrair padr√µes da entrada\rpatterns \u0026lt;- entry |\u0026gt;\rdplyr::select(P01:P10) |\u0026gt;\rpurrr::flatten_chr()\r# Determinar segmento que falta do 1\rone \u0026lt;- find_by_len(patterns, 2)\rdict[[\u0026quot;c\u0026quot;]] \u0026lt;- one[!one %in% purrr::flatten_chr(dict)]\r# Determinar segmento que falta do 7\rseven \u0026lt;- find_by_len(patterns, 3)\rdict[[\u0026quot;a\u0026quot;]] \u0026lt;- seven[!seven %in% purrr::flatten_chr(dict)]\r# Determinar segmento que falta do 4\rfour \u0026lt;- find_by_len(patterns, 4)\rdict[[\u0026quot;d\u0026quot;]] \u0026lt;- four[!four %in% purrr::flatten_chr(dict)]\r# Determinar √∫ltimo segmento que falta\rdict[[\u0026quot;g\u0026quot;]] \u0026lt;- names(cur_freq)[!names(cur_freq) %in% purrr::flatten_chr(dict)]\r# Traduzir segmentos dos valores de sa√≠da\rentry |\u0026gt;\rdplyr::select(V01:V04) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\rstringr::str_split(\u0026quot;\u0026quot;) |\u0026gt;\rpurrr::map(~names(dict)[match(.x, dict)]) |\u0026gt;\rpurrr::map(sort) |\u0026gt;\rpurrr::map(stringr::str_c, collapse = \u0026quot;\u0026quot;) |\u0026gt;\rpurrr::map(~purrr::flatten_chr(ref_val)[match(.x, names(ref_val))]) |\u0026gt;\rpurrr::flatten_chr() |\u0026gt;\ras.integer() |\u0026gt;\rstringr::str_c(collapse = \u0026quot;\u0026quot;) |\u0026gt;\ras.numeric()\r}\r# Ler entrada, mapear decode() e somar todas os valores de sa√≠da\r\u0026quot;data-raw/08b_seven_segment_search.txt\u0026quot; |\u0026gt;\rreadr::read_delim(\u0026quot; \u0026quot;, col_names = NULL) |\u0026gt;\rpurrr::set_names(\rpaste0(\u0026quot;P\u0026quot;, stringr::str_pad(1:10, 2, \u0026quot;left\u0026quot;, \u0026quot;0\u0026quot;)), \u0026quot;remove\u0026quot;,\rpaste0(\u0026quot;V\u0026quot;, stringr::str_pad(1:4, 2, \u0026quot;left\u0026quot;, \u0026quot;0\u0026quot;))\r) |\u0026gt;\rdplyr::select(-remove) |\u0026gt;\rtibble::rowid_to_column(\u0026quot;id\u0026quot;) |\u0026gt;\rtidyr::nest(entry = c(P01:V04)) |\u0026gt;\rdplyr::mutate(output = purrr::map_dbl(entry, decode)) |\u0026gt;\rdplyr::summarise(output = sum(output)) |\u0026gt;\rdplyr::pull(output)\r#\u0026gt; [1] 975706\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-08-advent-of-r-08/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 08"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nA Trai√ß√£o das Baleias (A)\rO dia 7 do AoC foi o mais r√°pido at√©\ragora. A nossa tarefa era determinar a posi√ß√£o horizontal na qual um ex√©rcito de\rcaranguejos deveria se alinhar, com a restri√ß√£o de que dever√≠amos encontrar a\rposi√ß√£o que exigisse menos combust√≠vel.\nCada caranguejo estava equipado de um mini-submarino que gastava 1 unidade de\rcombust√≠vel por unidade de deslocamento, logo o total de combust√≠vel gasto pela\rtropa para ir at√© a posi√ß√£o x seria simplesmente sum(abs(positions - x)). A\rsa√≠da era o combust√≠vel gasto para levar todos os caranguejos at√© a posi√ß√£o\rmais econ√¥mica.\n# Ler vetor de posi√ß√µes iniciais\rpositions \u0026lt;- \u0026quot;data-raw/07a_the_treachery_of_whales.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;,\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\ras.integer()\r# Iterar nas posi√ß√µes para encontrar a mais barata\rcheapest \u0026lt;- Inf\rfor (pos in max(positions):min(positions)) {\r# Calcular o combust√≠vel gasto para a posi√ß√£o\rfuel \u0026lt;- sum(abs(positions - pos))\r# Trocar a resposta se essa posi√ß√£o for mais econ√¥mica\rif (fuel \u0026lt; cheapest) cheapest \u0026lt;- fuel\r}\r# Imprimir\rcheapest\r#\u0026gt; [1] 328318\rNote que n√£o era necess√°rio testar nenhuma posi√ß√£o fora do intervalo\rmax(positions):min(positions)! Qualquer posi√ß√£o fora disso seria menos\recon√¥mica do que a ponta mais pr√≥xima a ela dentro do intervalo.\n\rA Trai√ß√£o das Baleias (B)\rO segundo item mantinha o mesmo problema, mas mudava o c√°lculo do gasto de\rcombust√≠vel dos mini-submarinos: o primeiro movimento consumiria 1 unidade de\rcombust√≠vel, o segundo consumiria 2 unidades, o terceiro consumiria 3 e assim\rpor diante.\nA √∫nica linha que muda dessa solu√ß√£o para a anterior √© a que calcula o gasto\rde combust√≠vel para cada posi√ß√£o. Se um caranguejo estiver na posi√ß√£o a e\rquiser ir at√© a x, o seu consumo total ser√° \\(\\sum_{k = 0}^{|a - x|} k\\). Abaixo\ra opera√ß√£o sum(purrr::map_int(positions, ~sum(0:abs(.x - pos)))) faz isso para\rtodos os caranguejos.\n# Iterar nas posi√ß√µes para encontrar a mais barata\rcheapest \u0026lt;- Inf\rfor (pos in max(positions):min(positions)) {\r# Calcular o combust√≠vel gasto para a posi√ß√£o\rfuel \u0026lt;- sum(purrr::map_int(positions, ~sum(0:abs(.x - pos))))\r# Trocar a resposta se essa posi√ß√£o for mais econ√¥mica\rif (fuel \u0026lt; cheapest) cheapest \u0026lt;- fuel\r}\r# Imprimir\rcheapest\r#\u0026gt; [1] 328318\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-07-advent-of-r-07/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 07"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nPeixes-lanterna (A)\rO dia 6 do AoC me pegou um pouco de\rsurpresa. O primeiro item foi tranquilo de fazer: a entrada era uma lista de\rn√∫meros que representavam os ‚Äúcontadores biol√≥gicos‚Äù de um cardume de\rpeixes-lanterna e precis√°vamos retornar o n√∫mero de peixes depois de 80 dias.\nOs peixes adultos demoram 7 dias (contador vai de 6 at√© 0) para gerar um novo\rpeixe beb√™ e um peixe beb√™ demora 9 dias (contador vai de 8 at√© 0) para gerar\rseu primeiro filhote.\nEstado inicial : 3,4,3,1,2\rDepois de 1 dia : 2,3,2,0,1\rDepois de 2 dias: 1,2,1,6,0,8\rDepois de 3 dias: 0,1,0,5,6,7,8\rDepois de 4 dias: 6,0,6,4,5,6,7,8,8\rDepois de 5 dias: 5,6,5,3,4,5,6,7,7,8\rDepois de 6 dias: 4,5,4,2,3,4,5,6,6,7\rDepois de 7 dias: 3,4,3,1,2,3,4,5,5,6\rDepois de 8 dias: 2,3,2,0,1,2,3,4,4,5\rDepois de 9 dias: 1,2,1,6,0,1,2,3,3,4,8\rDepois de 10 dias: 0,1,0,5,6,0,1,2,2,3,7,8\rDepois de 11 dias: 6,0,6,4,5,6,0,1,1,2,6,7,8,8,8\rDepois de 12 dias: 5,6,5,3,4,5,6,0,0,1,5,6,7,7,7,8,8\rDepois de 13 dias: 4,5,4,2,3,4,5,6,6,0,4,5,6,6,6,7,7,8,8\rDepois de 14 dias: 3,4,3,1,2,3,4,5,5,6,3,4,5,5,5,6,6,7,7,8\rDepois de 15 dias: 2,3,2,0,1,2,3,4,4,5,2,3,4,4,4,5,5,6,6,7\rDepois de 16 dias: 1,2,1,6,0,1,2,3,3,4,1,2,3,3,3,4,4,5,5,6,8\rDepois de 17 dias: 0,1,0,5,6,0,1,2,2,3,0,1,2,2,2,3,3,4,4,5,7,8\rDepois de 18 dias: 6,0,6,4,5,6,0,1,1,2,6,0,1,1,1,2,2,3,3,4,6,7,8,8,8,8\rO meu c√≥digo at√© que ficou bem simples. Precisei apenas de uma fun√ß√£o que, todo\rdia, subtraia 1 de todos os contadores, criava 1 peixe com contador 8 para\rcada peixe com contador -1 e, por fim, subia todos os peixes com contador -1\rpara 6.\n# Rodar n c√≠clos de reprodu√ß√£o do peixe-lanterna\rreproduce \u0026lt;- function(fish, n = 80) {\r# Condi√ß√£o de parada\rif (n == 0) return(length(fish))\r# Reduzir contadores biol√≥gicos\rfish \u0026lt;- fish - 1L\r# Criar novos peixes e reiniciar contadores\rfish \u0026lt;- append(fish, rep_len(8L, length(fish[fish == -1L])))\rfish[fish == -1L] \u0026lt;- 6L\r# Recurs√£o\rreproduce(fish, n = n - 1)\r}\r# Ler uma lista de peixes e reproduzir por 80 dias\r\u0026quot;data-raw/06a_lanternfish.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;,\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\ras.integer() |\u0026gt;\rreproduce()\r#\u0026gt; [1] 362666\r\rPeixes-lanterna (B)\rO segundo item do exerc√≠cio n√£o mudava essencialmente nada em rela√ß√£o ao\rprimeiro. Assumindo espa√ßo e recursos infinitos, quantos peixes ter√≠amos depois\rde 256 dias?\nPara resolver esse item, em teoria, seria necess√°rio trocar apenas o valor do\rn por 256. Mas n√£o foi o que aconteceu‚Ä¶ Por causa da inefici√™ncia do\ralgoritmo, obter uma resposta demoraria horas e acabaria com a mem√≥ria do meu\rcomputador. Foi necess√°rio pensar em um novo m√©todo de resolver o problema.\nA solu√ß√£o abaixo foi inspirada pela fun√ß√£o table(). Para reduzir a exig√™ncia\rde espa√ßo e n√£o precisar iterar ao longo de um vetor com todos os peixes, eu\ragrupei os peixes com o mesmo contador biol√≥gico em apenas uma linha de uma\rtabela! Assim o programa nunca precisava lidar com mais de 9 linhas por dia,\rresolvendo as complica√ß√µes com espa√ßo e tempo.\n# Rodar n c√≠clos de reprodu√ß√£o do peixe-lanterna\rreproduce \u0026lt;- function(fish, n = 80) {\r# Condi√ß√£o de parada\rif (n == 0) return(sum(fish$n))\r# Reduzir contadores biol√≥gicos\rfish \u0026lt;- dplyr::mutate(fish, timer = timer - 1L)\r# Criar novos peixes\rbabies \u0026lt;- fish |\u0026gt;\rdplyr::filter(timer == -1L) |\u0026gt;\rdplyr::mutate(timer = 8L)\r# Reiniciar contadores e recurs√£o\rfish |\u0026gt;\rdplyr::bind_rows(babies) |\u0026gt;\rdplyr::mutate(timer = ifelse(timer == -1L, 6L, timer)) |\u0026gt;\rdplyr::group_by(timer) |\u0026gt;\rdplyr::summarise(n = sum(n)) |\u0026gt;\rreproduce(n = n - 1)\r}\r# Ler uma lista de peixes e reproduzir por 256 dias\r\u0026quot;data-raw/06b_lanternfish.txt\u0026quot; |\u0026gt;\rreadr::read_lines() |\u0026gt;\rstringr::str_split(\u0026quot;,\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\ras.integer() |\u0026gt;\rtibble::as_tibble() |\u0026gt;\rpurrr::set_names(\u0026quot;timer\u0026quot;) |\u0026gt;\rdplyr::count(timer) |\u0026gt;\rreproduce(n = 256) |\u0026gt;\rformat(scientific = FALSE)\r#\u0026gt; [1] 1640526601595\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-06-advent-of-r-06/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 06"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nAventura Hidrotermal (A)\rO quinto dia do AoC foi um pouco mais\rtranquilo do que o anterior porque eu tive ajuda da incr√≠vel\rRenata Hirota. Hoje t√≠nhamos as coordenadas\rcartesianas do in√≠cio e do fim de tubula√ß√µes submarinas e o objetivo era\rdescobrir quantos pontos do plano tinham mais de uma tubula√ß√£o passando por\reles. No primeiro item dever√≠amos considerar apenas as tubula√ß√µes verticais e\rhorizontais.\n\rUma entrada do tipo 1,1 -\u0026gt; 1,3 cobria os pontos 1,1, 1,2 e 1,3.\n\rUma entrada do tipo 9,7 -\u0026gt; 7,7 cobria os pontos 9,7, 8,7 e 7,7.\n\r\rA minha ideia come√ßava filtrando os pontos em que x1 == x2 ou y1 == y2 e\rexpandindo as coordenadas para criar uma lista que contivesse todos os pontos\rpelos quais as tubula√ß√µes passavam. Eu resolvi isso com o paste(x1:x2, y1:y2),\rpois a paste() repetiria a coordenada que n√£o muda ao longo da coordenada que\rmuda: paste(9:7, 7:7) := \"9 7\" \"8 7\" \"7 7\".\nDepois disso bastava contar o n√∫meros de ocorr√™ncias de cada ponto do plano,\rfiltrar aqueles que ocorriam mais de 1 vez e contar quantos pontos restavam.\rEsta era a sa√≠da do problema.\n\u0026quot;data-raw/05a_hydrothermal_venture.txt\u0026quot; |\u0026gt;\rreadr::read_csv(col_names = c(\u0026quot;x1\u0026quot;, \u0026quot;y1x2\u0026quot;, \u0026quot;y2\u0026quot;)) |\u0026gt;\rtidyr::separate(sep = \u0026quot; -\u0026gt; \u0026quot;, col = \u0026quot;y1x2\u0026quot;, into = c(\u0026quot;y1\u0026quot;, \u0026quot;x2\u0026quot;)) |\u0026gt;\rdplyr::filter(x1 == x2 | y1 == y2) |\u0026gt;\rdplyr::mutate(\rdif_x = purrr::map2(x1, x2, seq),\rdif_y = purrr::map2(y1, y2, seq),\rcoord = purrr::map2(dif_x, dif_y, paste)\r) |\u0026gt;\rtidyr::unnest(coord) |\u0026gt;\rdplyr::count(coord) |\u0026gt;\rdplyr::filter(n \u0026gt; 1) |\u0026gt;\rnrow()\r#\u0026gt; [1] 7142\r\rAventura Hidrotermal (B)\rO segundo item parecia bastante mais complexo, pois agora dever√≠amos considerar\rtodas as tubula√ß√µes da entrada, removendo o dplyr::filter() do item anterior.\rMas uma especifica√ß√£o do enunciado facilitou tudo: todas as linhas diagonais\rtinham inclina√ß√£o de 45 graus.\n\rUma entrada do tipo 1,1 -\u0026gt; 3,3 cobria os pontos 1,1, 2,2 e 3,3.\n\rUma entrada do tipo 9,7 -\u0026gt; 7,9 cobria os pontos 9,7, 8,8 e 7,9.\n\r\rIsso significa que a estrat√©gia do paste() continuava funcionando! Note que\rpaste(1:3, 1:3) := \"1 1\" \"2 2\" \"3 3\", ent√£o bastou tirar o dplyr::filter()\rque a solu√ß√£o estava pronta.\n\u0026quot;data-raw/05b_hydrothermal_venture.txt\u0026quot; |\u0026gt;\rreadr::read_csv(col_names = c(\u0026quot;x1\u0026quot;, \u0026quot;y1x2\u0026quot;, \u0026quot;y2\u0026quot;)) |\u0026gt;\rtidyr::separate(sep = \u0026quot; -\u0026gt; \u0026quot;, col = \u0026quot;y1x2\u0026quot;, into = c(\u0026quot;y1\u0026quot;, \u0026quot;x2\u0026quot;)) |\u0026gt;\rdplyr::mutate(\rdif_x = purrr::map2(x1, x2, seq),\rdif_y = purrr::map2(y1, y2, seq),\rcoord = purrr::map2(dif_x, dif_y, paste)\r) |\u0026gt;\rtidyr::unnest(coord) |\u0026gt;\rdplyr::count(coord) |\u0026gt;\rdplyr::filter(n \u0026gt; 1) |\u0026gt;\rnrow()\r#\u0026gt; [1] 20012\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-05-advent-of-r-05/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 05"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nLula Gigante (A)\rO quarto dia do AoC foi talvez o mais\rinteressante at√© agora. Na primeira parte, precis√°vamos calcular a pontua√ß√£o da\rcartela vencedora de um\rbingo americano: cada\rcartela √© composta por 5 linhas e 5 colunas de n√∫meros que devem ser riscados\rconforme eles s√£o anunciados pelo sistema do submarino. A primeira cartela a\rriscar todos os n√∫meros de uma linha ou coluna √© a vencedora e sua pontua√ß√£o √©\ra soma de todos os n√∫meros n√£o riscados multiplicada pelo √∫ltimo n√∫mero\ranunciado.\nA entrada era composta por uma linha com os n√∫meros anunciados em sequ√™ncia e,\rposteriormente, todas as cartelas da plat√©ia:\n# 7,4,9,5,11,17,23,2,0,14,21,24,10,16,13,6,15,25,12,22,18,20,8,19,3,26,1\r#\r# 22 13 17 11 0\r# 8 2 23 4 24\r# 21 9 14 16 7\r# 6 10 3 18 5\r# 1 12 20 15 19\r#\r# 3 15 0 2 22\r# 9 18 13 17 5\r# 19 8 7 25 23\r# 20 11 10 24 4\r# 14 21 16 12 6\r#\r# 14 21 17 24 4\r# 10 16 15 9 19\r# 18 8 23 26 20\r# 22 11 13 6 5\r# 2 0 12 3 7\rEu escolhi um caminho simples para resolver o problema, apesar de o c√≥digo n√£o\rter ficado t√£o bom assim. Primeiro eu li a sequ√™ncia de n√∫meros e criei uma\rfun√ß√£o que transpunha uma matrix num√©rica e a empilhava com a original.\n# Processar os n√∫meros sorteados\rdraws \u0026lt;- \u0026quot;data-raw/04a_giant_squid.txt\u0026quot; |\u0026gt;\rreadr::read_lines(n_max = 1) |\u0026gt;\rstringr::str_split(\u0026quot;,\u0026quot;) |\u0026gt;\rpurrr::pluck(1) |\u0026gt;\ras.numeric()\r# Converter as colunas de uma matrix para linhas e empilhar\rcols_to_rows \u0026lt;- function(df) {\rdf |\u0026gt;\rdplyr::select(-board, -id) |\u0026gt;\ras.matrix() |\u0026gt;\rt() |\u0026gt;\rtibble::as_tibble(rownames = \u0026quot;id\u0026quot;) |\u0026gt;\rpurrr::set_names(\u0026quot;id\u0026quot;, paste0(\u0026quot;C\u0026quot;, 1:5)) |\u0026gt;\rdplyr::mutate(board = df$board) |\u0026gt;\rdplyr::bind_rows(df) |\u0026gt;\rdplyr::relocate(board, id) |\u0026gt;\rpurrr::set_names(\u0026quot;id\u0026quot;, \u0026quot;board\u0026quot;, paste0(\u0026quot;N\u0026quot;, 1:5))\r}\rO objetivo de cols_to_rows() era criar uma tabela final com todas as linhas\rdas cartelas e tamb√©m todas as suas colunas; isso permitiu que eu riscasse os\rn√∫meros sorteados aplicando dplyr::na_if() indiscriminadamente. Quando alguma\rlinha da tabela fosse formada somente por NAs (indicando que uma linha ou\rcoluna de alguma cartela estava completa), bastava extrair a cartela original,\rsomar os seus valores n√£o-NA e multiplicar o resultado pelo n√∫mero sorteado\rmais recente. A fun√ß√£o utilizada para isso se chamava winning_score() e\roperava recursivamente para poupar tempo.\n# Calcular a pontua√ß√£o da cartela vencedora\rwinning_score \u0026lt;- function(df, draws) {\r# Marcar o n√∫mero sorteado com NA (nas linhas e colunas)\rdf \u0026lt;- dplyr::mutate(df, dplyr::across(c(N1:N5), dplyr::na_if, draws[1]))\r# Filtrar poss√≠veis linhas/colunas completas\rwin \u0026lt;- dplyr::filter(df, dplyr::if_all(c(N1:N5), is.na))\r# Se houver pelo menos uma linha/coluna completa...\rif (nrow(win) \u0026gt; 0) {\r# Extrair a cartela vencedora, somar os n√£o-NA e multiplicar por draws[1]\routput \u0026lt;- df |\u0026gt;\rdplyr::filter(id == win$id, stringr::str_starts(board, \u0026quot;R\u0026quot;)) |\u0026gt;\rdplyr::select(-id, -board) |\u0026gt;\rpurrr::flatten_dbl() |\u0026gt;\rsum(na.rm = TRUE) |\u0026gt;\rmagrittr::multiply_by(draws[1])\r# Retornar a pontua√ß√£o\rreturn(output)\r}\r# Recurs√£o para o pr√≥ximo sorteio\rwinning_score(df, draws[-1])\r}\r# Ler cartelas, empilhas linhas com colunas e riscar usando NAs\r\u0026quot;data-raw/04a_giant_squid.txt\u0026quot; |\u0026gt;\rreadr::read_table(skip = 1, col_names = paste0(\u0026quot;C\u0026quot;, 1:5)) |\u0026gt;\rdplyr::mutate(board = (dplyr::row_number() - 1) %/% 5) |\u0026gt;\rdplyr::group_by(board) |\u0026gt;\rdplyr::mutate(id = paste0(\u0026quot;R\u0026quot;, 1:5)) |\u0026gt;\rdplyr::group_split() |\u0026gt;\rpurrr::map_dfr(cols_to_rows) |\u0026gt;\rwinning_score(draws)\r#\u0026gt; [1] 33348\r\rLula Gigante (B)\rO segundo item do problema pedia o contr√°rio: calcular a pontua√ß√£o da √∫ltima\rcartela a ter uma linha ou coluna completa, ou seja, da cartela perdedora. Na\rminha solu√ß√£o todo o c√≥digo permaneceu igual, salvo pela fun√ß√£o\rwinning_score(), que virou loosing_score(). A grande novidade √© que, quando\ro programa encontrava uma cartela vencedora, ele verificava se aquela era a\r√∫ltima. Se n√£o fosse, ele removia aquela cartela da tabela e, se fosse, ele\rretornava a pontua√ß√£o.\n# Calcular a pontua√ß√£o da cartela perdedora\rloosing_score \u0026lt;- function(df, draws) {\r# Marcar o n√∫mero sorteado com NA (nas linhas e colunas)\rdf \u0026lt;- dplyr::mutate(df, dplyr::across(c(N1:N5), dplyr::na_if, draws[1]))\r# Filter possible complete rows or cols\rwin \u0026lt;- dplyr::filter(df, dplyr::if_all(c(N1:N5), is.na))\r# Se houver pelo menos uma linha/coluna completa...\rif (nrow(win) \u0026gt; 0) {\r# Se restasse apenas uma cartela, calcular a sua pontua√ß√£o\rif (length(unique(df$id)) == 1) {\r# Extrair a cartela perdedora, somar os n√£o-NA e multiplicar por draws[1]\routput \u0026lt;- df |\u0026gt;\rdplyr::filter(stringr::str_starts(board, \u0026quot;R\u0026quot;)) |\u0026gt;\rdplyr::select(-id, -board) |\u0026gt;\rpurrr::flatten_dbl() |\u0026gt;\rsum(na.rm = TRUE) |\u0026gt;\rmagrittr::multiply_by(draws[1])\r# Retornar a pontua√ß√£o\rreturn(output)\r}\r# Jogar fora cartelas que j√° venceram\rdf \u0026lt;- dplyr::filter(df, !id %in% win$id)\r}\r# Recurs√£o para o pr√≥ximo sorteio\rloosing_score(df, draws[-1])\r}\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-04-advent-of-r-04/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 04"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nDiagn√≥stico Bin√°rio (A)\rNa primeira parte do terceiro dia do AoC\rsomos apresentados aos diagn√≥sticos do submarino. Cada linha √© composta por um\rn√∫mero bin√°rio e precisamos carclular, a partir deles, os √≠ndices gama e\r√©psilon.\n# 00100\r# 11110\r# 10110\r# 10111\r# 10101\r# 01111\r# 00111\r# 11100\r# 10000\r# 11001\r# 00010\r# 01010\rCada bit do fator gama √© igual ao valor mais comum do bit correspondente na\rentrada, enquanto o √©psilon funciona ao contr√°rio. No exemplo acima, o primeiro\rbit mais comum √© 1 e o segundo √© 0, ent√£o o √≠ndice gama come√ßar√° com 10‚Ä¶ e o\r√≠ndice √©psilon come√ßar√° com 01‚Ä¶\nO meu c√≥digo quebra os bits da entrada com tidyr::separate() e calcula o valor\rmais frequente com names(sort(-table(.x)))[1] (a moda estat√≠stica). √â\rimportante lembrar que √©psilon √© o oposto, ent√£o eu troquei todos os bits de\rgama com stringr::str_replace_all(). A resposta final √© a multiplica√ß√£o\rde gama por √©psilon na base decimal.\n\u0026quot;data-raw/03a_binary_diagnostic.txt\u0026quot; |\u0026gt;\rreadr::read_table(col_names = \u0026quot;reading\u0026quot;) |\u0026gt;\rtidyr::separate(reading, paste0(\u0026quot;B\u0026quot;, 0:12), \u0026quot;\u0026quot;) |\u0026gt;\rdplyr::select(-B0) |\u0026gt;\rdplyr::summarise_all(~names(sort(-table(.x)))[1]) |\u0026gt;\rtidyr::unite(\u0026quot;gamma\u0026quot;, dplyr::everything(), sep = \u0026quot;\u0026quot;) |\u0026gt;\rdplyr::mutate(\repsilon = gamma |\u0026gt;\rstringr::str_replace_all(\u0026quot;0\u0026quot;, \u0026quot;!\u0026quot;) |\u0026gt;\rstringr::str_replace_all(\u0026quot;1\u0026quot;, \u0026quot;0\u0026quot;) |\u0026gt;\rstringr::str_replace_all(\u0026quot;!\u0026quot;, \u0026quot;1\u0026quot;) |\u0026gt;\rstrtoi(base = 2),\rgamma = strtoi(gamma, base = 2),\routput = gamma * epsilon\r) |\u0026gt;\rdplyr::pull(output)\r\rDiagn√≥stico Bin√°rio (B)\rO segundo item desse dia foi o mais dif√≠cil de todos, ainda mais considerando\rque eu tento resolver tudo em apenas uma pipeline. Usando os mesmos dados,\rprecisamos obter a taxa de O\\(_2\\) e de CO\\(_2\\) do submarino, sendo que as regras\rs√£o as seguintes:\nJogue fora os n√∫mero que n√£o atendem ao crit√©rio daquele g√°s.\n\rSe restar apenas 1 n√∫mero, essa √© a taxa daquele g√°s.\n\rCaso contr√°rio, repita o processo com o pr√≥ximo bit.\n\r\rE quais s√£o os crit√©rios?\n\rPara o oxig√™nio, determinamos o valor mais comum para o bit atual e jogamos\rfora todos os n√∫meros que diferem, nessa posi√ß√£o, desse valor. Se 0 e 1 forem\rigualmente comuns, manter apenas os n√∫meros com 1 no bit considerado.\n\rPara g√°s carb√¥nico, determinamos o valor menos comum para o bit atual e\rjogamos fora todos os n√∫meros que diferem, nessa posi√ß√£o, desse valor. Se 0 e 1\rforem igualmente comuns, manter apenas os n√∫meros com 0 no bit considerado.\n\r\rO primeiro passo da minha solu√ß√£o foi criar uma fun√ß√£o que calcula a anti-moda\rde um vetor. Ela difere da fun√ß√£o usada no item anterior somente pelo sinal de\rsubtra√ß√£o, mas isso garante a ela uma propriedade importante: se 0 e 1 empatarem\rna contagem, ela retorna o valor que vem antes na ordem alfab√©tica, ou seja, 0.\rDessa forma a fun√ß√£o antimode() realiza exatamente a opera√ß√£o que precisamos\rpara determinar a taxa de g√°s carb√¥nico.\nantimode \u0026lt;- function(x) names(sort(table(x)))[1]\rA fun√ß√£o abaixo √© uma vers√£o recursiva do c√°lculo das taxas dos gases. A coluna\rcurrent √© s√≥ um atalho para deixar o filtro mais enxuto, pois ela n√£o passa da\rdo bit atual. O op(), por√©m, √© a chave que nos permite usar a mesma fun√ß√£o\rpara calcular O\\(_2\\) e CO\\(_2\\); por padr√£o a fun√ß√£o filtra os valores iguais √†\ranti-moda, mas, com co2 = FALSE, ela filtra os valores diferentes da\ranti-moda, atendendo ao crit√©rio do oxig√™nio (incluindo o desempate)!\nA √∫ltima linha chama a fun√ß√£o de novo para o pr√≥ximo bit, resolvendo o c√°lculo.\ngas \u0026lt;- function(df, co2 = TRUE, bit = 1) {\r# Condi√ß√£o de parada\rif (bit \u0026gt; 12 || nrow(df) == 1) return(df)\r# Escolher o operador apropriado\rif (co2) op \u0026lt;- `==` else op \u0026lt;- `!=`\r# Filtrar usando antimode() e fazer a recurs√£o\rdf |\u0026gt;\rdplyr::mutate(current = .data[[names(df)[bit]]]) |\u0026gt;\rdplyr::filter(op(current, antimode(current))) |\u0026gt;\rdplyr::select(-current) |\u0026gt;\rfind_rating(co2 = co2, bit = bit + 1)\r}\rS√≥ nos resta aplicar essa fun√ß√£o na lista de n√∫meros. Para tentar manter o fim\rdo c√≥digo em uma pipeline s√≥ (j√° que n√£o foi poss√≠vel com o resto), eu usei\rrep_len(list(df), 2) para duplicar a base e poder aplicar gas() e\rgas(co2 = FALSE) em uma linha s√≥ com purrr::map2_dfr(). O final do c√≥digo\rdeixa cada taxa em uma linha, junta os seu bits, as converte para decimal e\rmultiplica seus valores. Essa √© a sa√≠da.\n\u0026quot;data-raw/03b_binary_diagnostic.txt\u0026quot; |\u0026gt;\rreadr::read_table(col_names = \u0026quot;reading\u0026quot;) |\u0026gt;\rtidyr::separate(reading, paste0(\u0026quot;B\u0026quot;, 0:12), \u0026quot;\u0026quot;) |\u0026gt;\rdplyr::select(-B0) |\u0026gt;\rlist() |\u0026gt;\rrep_len(2) |\u0026gt;\rpurrr::map2_dfr(list(gas, \\(df) gas(df, FALSE)), ~.y(.x)) |\u0026gt;\rtidyr::unite(\u0026quot;reading\u0026quot;, dplyr::everything(), sep = \u0026quot;\u0026quot;) |\u0026gt;\rdplyr::mutate(reading = strtoi(reading, base = 2)) |\u0026gt;\rdplyr::summarise(output = prod(reading)) |\u0026gt;\rdplyr::pull(output)\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-03-advent-of-r-03/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 03"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rChamdos de ‚Äútr√™s pontinhos‚Äù, ‚Äúretic√™ncias‚Äù, ‚Äúdots‚Äù ou ‚Äúellipsis‚Äù, os ...\rs√£o uma das funcionalidades mais comuns do R, mas ao mesmo tempo uma das menos\rconhecidas. Explic√°-los em linguagem t√©cnica √© muito simples: eles s√£o os\rargumentos vari√°dicos do R!\rO dif√≠cil √© entender de verdade o que eles s√£o e como us√°-los. Vamos abandonar o\rjarg√£o e sigamos em frente, agora em bom portugu√™s‚Ä¶\nObs.: O nome correto no R para os ... √© dots, ent√£o vou usar esse termo a\rpartir de agora. A prova disso √© que, para consultar a sua documenta√ß√£o,\rexecutamos ?dots.\nOnde est√£o\rComo eu disse anteriormente, eles s√£o bastante comuns, mas qu√£o comuns\rexatamente? Talvez mais do que voc√™ imagine. Veja abaixo os\rprot√≥tipos de algumas poucas\rfun√ß√µes que talvez voc√™ conhe√ßa (ignore o NULL, ele √© parte da sa√≠da da\rfun√ß√£o args()):\nargs(sum)\r## function (..., na.rm = FALSE) ## NULL\rargs(c)\r## function (...) ## NULL\rargs(dplyr::mutate)\r## function (.data, ...) ## NULL\rTe convenci? Entender os dots √©, portanto, uma excelente arma no arsenal do\rprogramador de R, tanto que eles s√£o usados pelas fun√ß√µes mais importantes da\rlinguagem toda.\n\rO que s√£o\rDe forma bem geral, os dots s√£o um argumento que, quando colocado na sua fun√ß√£o,\rpode ser substitu√≠do por qualquer coisa pelo usu√°rio. Na fun√ß√£o sum(), por\rexemplo, os dots podem virar uma s√©rie de n√∫meros (quantos o usu√°rio quiser).\nsum(1, 2, 3, 4, 5)\r## [1] 15\rQuando falamos de argumentos normais, n√£o precisamos declarar seus argumentos\rcaso estejamos utilizando-os na ordem correta. Os dots, entretanto, podem ser\rsubstitu√≠dos por qualquer n√∫mero de objetos, ent√£o eles quebram essa regra;\rqualquer argumento que vier depois dos dots precisa ser nomeado.\n# N√£o funciona do jeito esperado (TRUE mais um elemento dos dots)\rsum(1, 2, NA, 4, 5, TRUE)\r## [1] NA\r# Agora sim\rsum(1, 2, NA, 4, 5, na.rm = TRUE)\r## [1] 12\rSem os dots a fun√ß√£o sum() estaria limitada a receber um vetor de n√∫meros,\rmas com essa ferramenta ela passa a poder receber n√∫meros separados como se\rfossem cada um um argumento. A fun√ß√£o c(), entretanto, n√£o poderia ser\rimplementada sem os dots.\nO seu poder completo, por√©m, fica mais claro na fun√ß√£o dplyr::select(). Aqui\rvemos que podemos at√© dar nomes arbitr√°rios para os ‚Äúargumentos‚Äù de dentro dos\rdots e a fun√ß√£o pode us√°-los sem o menor problema:\nmtcars |\u0026gt;\rdplyr::select(mpg, cil = cyl, marcha = gear) |\u0026gt;\rhead()\r## mpg cil marcha\r## Mazda RX4 21.0 6 4\r## Mazda RX4 Wag 21.0 6 4\r## Datsun 710 22.8 4 4\r## Hornet 4 Drive 21.4 6 3\r## Hornet Sportabout 18.7 8 3\r## Valiant 18.1 6 3\rPerceba que a fun√ß√£o dplyr::select() n√£o tem como saber quantas colunas n√≥s\rvamos selecionar e quais nomes eu vou dar para cada uma, tornando imposs√≠vel o\ruso de argumentos convencionais. O uso do dots √© inevit√°vel nesses casos.\n\rComo us√°-los\rAgora que j√° vimos universalidade e import√¢ncia dos dots, chegou a hora de\rentender como eles funcionam e como us√°-los. Vamos come√ßar com um exemplo\rsimples: criar uma fun√ß√£o que captura quaisquer argumentos que o usu√°rio\rresolver passar e imprime seus valores.\n# Captura dots e os imprime como uma lista\rcaptura \u0026lt;- function(...) {\rlist(...)\r}\rcaptura(arg1 = 1, arg2 = \u0026quot;b\u0026quot;, arg3 = FALSE)\r## $arg1\r## [1] 1\r## ## $arg2\r## [1] \u0026quot;b\u0026quot;\r## ## $arg3\r## [1] FALSE\rSimples, n√©? 90% das vezes podemos simplesmente transformar os dots em uma lista\rcomum com list(...) e utiliz√°-la normalmente. Em breve ficar√° mais claro\rpor que isso funciona.\nSe quisermos capturar argumentos espec√≠ficos dentro dos dots, a√≠ podemos usar\ruma fun√ß√£o especial chamada ...elt() (sim, as retic√™ncias fazem parte de seu\rnome):\n# Captura dots e os imprime como uma lista\rcaptura_segundo \u0026lt;- function(...) {\r...elt(2)\r}\rcaptura_segundo(arg1 = 1, arg2 = \u0026quot;b\u0026quot;, arg3 = FALSE)\r## [1] \u0026quot;b\u0026quot;\rA terceira forma de usar os dots √© os transportando para uma fun√ß√£o que recebe\rdots. Como j√° deve ter ficado evidente, os dots podem ser substitu√≠dos por\rqualquer n√∫mero de argumentos por parte do usu√°rio, mas eles tamb√©m podem ser\rpassados como argumento no lugar dos dots de outra fun√ß√£o!\nfiltra_seleciona \u0026lt;- function(marchas, ...) {\rmtcars |\u0026gt;\rdplyr::filter(gear == marchas) |\u0026gt;\rdplyr::select(...) |\u0026gt;\rhead()\r}\rfiltra_seleciona(4, mpg, cil = cyl)\r## mpg cil\r## Mazda RX4 21.0 6\r## Mazda RX4 Wag 21.0 6\r## Datsun 710 22.8 4\r## Merc 240D 24.4 4\r## Merc 230 22.8 4\r## Merc 280 19.2 6\rNo caso acima, os dots eram mpg, cil = cyl e isso foi transportado\rperfeitamente para dentro de dplyr::select().\nPara fechar este tutorial com chave de ouro, vamos criar uma fun√ß√£o arbitr√°ria\rque precisa de um argumento depois dos dots: nossa fun√ß√£o deve receber qualquer\rquantidade de valores num√©ricos, ignorar o primeiro e somar o resto com n.\nignora_um_soma_n \u0026lt;- function(..., n = 0) {\rvalores \u0026lt;- list(...)\rvalores \u0026lt;- valores[-1]\runlist(valores) + n\r}\rignora_um_soma_n(1, 2, 3, 4, 5, n = 10)\r## [1] 12 13 14 15\rEspero que agora esteja pelo menos um pouco mais claro o funcionamento dos dots!\rSe n√£o, pode entrar em contato comigo via Twitter\rou postar uma d√∫vida no nosso f√≥rum.\n\r","permalink":"https://blog.curso-r.com/posts/2021-12-03-tutorial-dots/","tags":["conceitos","dots"],"title":"Tr√™s Pontinhos: Como Funcionam os Dots"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nMergulhe (A)\rA parte 1 do segundo dia do AoC pede para\rlermos uma lista de comandos para um submarino e calcular a sua posi√ß√£o final.\rOs comandos poss√≠veis s√£o forward X (soma X √† posi√ß√£o horizontal), up X\r(subtrai X da profundidade) e down X (soma X √† profundidade), ent√£o precisamos\rfazer um dplyr::group_by(command == \"forward\") para que um grupo represente\ra posi√ß√£o horizontal e um represente a profundidade.\nPara concluir o c√≥digo, como a resposta final √© a posi√ß√£o horizontal\rmultiplicada pela profundidade, temos que fazer um prod() ao final:\n\u0026quot;data-raw/02a_dive.txt\u0026quot; |\u0026gt;\rreadr::read_delim(\u0026quot; \u0026quot;, col_names = c(\u0026quot;command\u0026quot;, \u0026quot;x\u0026quot;)) |\u0026gt;\rdplyr::mutate(x = ifelse(command == \u0026quot;up\u0026quot;, -x, x)) |\u0026gt;\rdplyr::group_by(command == \u0026quot;forward\u0026quot;) |\u0026gt;\rdplyr::summarise(x = sum(x)) |\u0026gt;\rdplyr::summarise(x = prod(x)) |\u0026gt;\rdplyr::pull(x)\r#\u0026gt; [1] 1727835\r\rMergulhe (B)\rA parte 2 complica um pouco a nossa vida. Os mesmos comandos agora possuem outro\rsignificado:\n\rdown X aumenta a mira em X unidades\rup X diminui a mira em X unidades.\rforward X faz duas coisas:\r\rAumenta a posi√ß√£o horizontal em X unidades.\rAumenta a profundidade em X vezes a mira atual.\r\r\rO meu c√≥digo da primeira parte n√£o permitiria resolver isso de forma eficiente.\rMinha solu√ß√£o foi fazer uma cumsum() da posi√ß√£o horizontal e uma da mira, que\rs√£o as partes mais simples. Depois eu calculei a profundidade com\rcumsum(aim * x) (dado que a mira tinha sido calculada no passo anterior).\nA sa√≠da, mais uma vez √© o produto entre a posi√ß√£o horizontal e a profundidade.\rDessa vez a resposta vai estar na √∫ltima linha da tabela, ent√£o o c√≥digo precisa\rde um tail(1).\n\u0026quot;data-raw/02a_dive.txt\u0026quot; |\u0026gt;\rreadr::read_delim(\u0026quot; \u0026quot;, col_names = c(\u0026quot;command\u0026quot;, \u0026quot;x\u0026quot;)) |\u0026gt;\rdplyr::mutate(\rhorizontal = ifelse(command == \u0026quot;forward\u0026quot;, x, 0),\rhorizontal = cumsum(horizontal),\raim = ifelse(command == \u0026quot;down\u0026quot;, x, 0),\raim = ifelse(command == \u0026quot;up\u0026quot;, -x, aim),\raim = cumsum(aim),\rdepth = ifelse(command == \u0026quot;forward\u0026quot;, aim * x, 0),\rdepth = cumsum(depth),\routput = horizontal * depth\r) |\u0026gt;\rutils::tail(1) |\u0026gt;\rdplyr::pull(output)\r#\u0026gt; [1] 1544000595\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-02-advent-of-r-02/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 02"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO Advent of Code √© um\rCalend√°rio do Advento\rdesenvolvido por Eric Wastl composto por 25\rpequenos exerc√≠cios de programa√ß√£o que v√£o sendo disponibilizados, um a um,\rentre 1¬∫ de dezembro e o Natal de cada ano.\nMeu objetivo com o Advent of R √© resolver todos os problemas do\rAdvent of Code 2021 em R e documentar o\rprocesso atrav√©s desta\rs√©rie de posts. Todo dia entre\r01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a\rminha solu√ß√£o aqui no blog e subir os meus scripts completos para um\rreposit√≥rio p√∫blico no GitHub.\nA minha esperan√ßa √© que, com essa s√©rie, mais pessoas pratiquem seus\rconhecimentos de R resolvendo exerc√≠cios divertidos e desafiadores! Ao final\rda jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,\rdivulgado essa linguagem incr√≠vel para mais pessoas. Boas festas e bom c√≥digo!\nVarredura de Sonar (A)\rA parte 1 do primeiro exerc√≠cio do AoC\renvolve ler uma lista de n√∫meros e ver quantas vezes os valores aumentam em\rrela√ß√£o ao anterior. Em linguagem matem√°tica, precisamos avaliar quantas vezes\r\\(x_i \u0026gt; x_{i - 1}\\).\nPor exemplo, suponha a seguinte lista:\n# 199\r# 200\r# 208\r# 210\r# 200\r# 207\r# 240\r# 269\r# 260\r# 263\rNesse caso, precisamos comparar cada n√∫mero com o da linha anterior e verificar\rse ele representa que a s√©rie aumentou, diminuiu ou manteve-se constante.\n# 199 (NA)\r# 200 (aumentou)\r# 208 (aumentou)\r# 210 (aumentou)\r# 200 (diminuiu)\r# 207 (aumentou)\r# 240 (aumentou)\r# 269 (aumentou)\r# 260 (diminuiu)\r# 263 (aumentou)\rTendo isso, podemos concluir que houveram 7 aumentos na s√©rie exemplo e essa\rseria a resposta do problema.\nO meu c√≥digo para resolver o exerc√≠cio ficou bem enxuto. Bastou ler a lista de\rn√∫mero do arquivo disponibilizado como uma tabela e comparar seus valores com\ro seu dplyr::lag(); depois disso um dplyr::summarise() contou o n√∫mero de\rTRUEs ignorando NAs.\n\u0026quot;data-raw/01a_sonar_sweep.txt\u0026quot; |\u0026gt;\rreadr::read_table(col_names = \u0026quot;depth\u0026quot;) |\u0026gt;\rdplyr::mutate(\rprev_depth = dplyr::lag(depth),\ris_deeper = depth \u0026gt; prev_depth\r) |\u0026gt;\rdplyr::summarise(n_deeper = sum(is_deeper, na.rm = TRUE)) |\u0026gt;\rdplyr::pull(n_deeper)\r#\u0026gt; [1] 1228\r\rVarredura de Sonar (B)\rA segunda parte, entretanto, aumenta (com o perd√£o do trocadilho) a dificuldade.\rDessa vez precisamos somar uma janela de 3 valores e comparar com a pr√≥xima\rjanela, ou seja, verificar quantas vezes\r\\(\\sum_{k = i}^{i+2} x_k \u0026gt; \\sum_{k = i-1}^{i+1} x_k\\).\nObserve como as janelas funcionam:\n# 199 A\r# 200 A B\r# 208 A B C\r# 210 B C D\r# 200 E C D\r# 207 E F D\r# 240 E F G\r# 269 F G H\r# 260 G H\r# 263 H\rNesse exemplo precisar√≠amos somar os n√∫meros da janela A (199, 200, 208) e\rtestar se isso √© maior que a soma dos n√∫meros da janela B (200, 208, 210). Ent√£o\rcomparar√≠amos B com C, C com D e assim por diante.\n# A: 607 (NA)\r# B: 618 (aumentou)\r# C: 618 (n√£o mudou)\r# D: 617 (diminuiu)\r# E: 647 (aumentou)\r# F: 716 (aumentou)\r# G: 769 (aumentou)\r# H: 792 (aumentou)\rAlterando o c√≥digo da primeira parte, eu criei as janelas usando dplyr::lead()\re depois comparei as somas utilizando o mesmo dplyr::lag(). Mais uma vez o\rdplyr::summarise() contou o n√∫mero de TRUEs ignorando NAs.\n\u0026quot;data-raw/01b_sonar_sweep.txt\u0026quot; |\u0026gt;\rreadr::read_table(col_names = \u0026quot;depth\u0026quot;) |\u0026gt;\rdplyr::mutate(\rdepth1 = dplyr::lead(depth, n = 1),\rdepth2 = dplyr::lead(depth, n = 2),\rsum_depth = depth + depth1 + depth2,\rprev_sum_depth = dplyr::lag(sum_depth),\ris_deeper = sum_depth \u0026gt; prev_sum_depth\r) |\u0026gt;\rdplyr::summarise(n_deeper = sum(is_deeper, na.rm = TRUE)) |\u0026gt;\rdplyr::pull(n_deeper)\r#\u0026gt; [1] 1257\r\r","permalink":"https://blog.curso-r.com/posts/2021-12-01-advent-of-r-01/","tags":["advent-of-r","tidyverse"],"title":"Advent of R: Dia 01"},{"author":["Beatriz","Julio"],"categories":["conceitos"],"contents":"\r\rIntrodu√ß√£o\rOl√°!\nRecentemente eu (Bea) andei explorando algumas APIs, com ajuda do Julio, que ficou respondendo as d√∫vidas! No processo aprendemos muitas coisas legais e resolvemos compartilhar com voc√™s atrav√©s de alguns posts.\nO tema d√° muito pano pra manga, pois usamos c√≥digo em R para automatizar quase tudo! Nas √∫ltimas semanas, aprendemos a trabalhar com o GitHub (Ex: criar e configurar reposit√≥rios), Zoom (criar chamadas), Google Drive e Sheets (estruturar e editar arquivos), e Google Classroom (criar e configurar salas de aula).\nTudo isso usando muito tidyverse!\nMas calma!! Vamos come√ßar do come√ßo. Neste primeiro post, vamos falar sobre o que √© uma API e mostrar um exemplo b√°sico.\n\rO que √© uma API?\rAPI √© uma sigla para Application Programming Interface, ou seja, uma interface de computa√ß√£o. Sem usar palavras complicadas, uma explica√ß√£o que est√° nos slides do curso de Deploy! √©:\n\rUma API n√£o deixa de ser um ‚Äúlink‚Äù que aceita par√¢metros e retorna dados.\n\rAs APIs tamb√©m s√£o abordadas no curso de Web Scraping!\n\rPok√©API\rUm exemplo de acesso √† API √© buscando na Pok√©API, uma API para buscar Pok√©mons! E com tantas possibilidades interessantes, porque buscar justamente Pok√©mons? Essa API tem fins educacionais, portanto √© um √≥timo lugar para come√ßar a praticar o tema.\nO primeiro passo para acessar qualquer API √© procurar uma documenta√ß√£o.\nNa documenta√ß√£o do Pok√©API, √© mostrado que devemos usar o seguinte padr√£o:\nGET https://pokeapi.co/api/v2/{endpoint}/\rIsso significa que devemos fazer uma requisi√ß√£o GET (apenas para consultar dados), come√ßar com a url base (√© a parte que n√£o muda: https://pokeapi.co/api/v2/) e complementar com os par√¢metros da busca (que chamamos de endpoint).\nO pacote httr √© muito usado para acessar APIs atrav√©s do R, e disponibiliza uma fun√ß√£o chamada httr::GET() para fazer esse tipo de acesso!\nPor exemplo:\n# url_base - nunca muda na mesma API\rurl_base \u0026lt;- \u0026quot;https://pokeapi.co/api/v2\u0026quot; # endpoint - √© o que muda o resultado\rendpoint \u0026lt;- \u0026quot;/pokemon/ditto\u0026quot; # precisamos colar os textos para criar o link\ru_pokemon \u0026lt;- paste0(url_base, endpoint) # ver como o texto ficou colado\r# u_pokemon # \u0026gt; \u0026quot;https://pokeapi.co/api/v2/pokemon/ditto\u0026quot;\r# fazer a requisi√ß√£o do tipo GET\rr_pokemon \u0026lt;- httr::GET(u_pokemon) r_pokemon\r## Response [https://pokeapi.co/api/v2/pokemon/ditto]\r## Date: 2021-11-29 11:44\r## Status: 200\r## Content-Type: application/json; charset=utf-8\r## Size: 22.3 kB\rEsse resultado √© um pouco diferente do que estamos acostumados! O que √© mais importante de reparar √© o status, pois indica se a requisi√ß√£o foi bem sucedida. Status: 200 significa que deu certo! :)\nAs APIs costumam retornar arquivos JSON, e para acessar o conte√∫do que foi obtido podemos usar a fun√ß√£o httr::content():\nc_pokemon \u0026lt;- httr::content(r_pokemon)\rAo salvar o resultado da fun√ß√£o em um objeto, podemos ver que agora a classe dele √© uma lista:\nclass(c_pokemon)\r## [1] \u0026quot;list\u0026quot;\rPodemos manipular essa lista com fun√ß√µes do tidyverse para obter uma tabela, assim fica mais f√°cil de trabalhar. Mas aten√ß√£o, da seguinte forma ela ainda n√£o est√° no formato tidy! Saiba mais o que s√£o dados tidy no material do curso de Faxina de Dados.\nlibrary(magrittr)\rdados_ditto \u0026lt;- c_pokemon %\u0026gt;%\rpurrr::map(unlist, recursive = TRUE) %\u0026gt;%\rpurrr::map(tibble::enframe) %\u0026gt;%\rpurrr::map_dfr(\r~dplyr::mutate(.x, dplyr::across(.fns = as.character)), .id = \u0026quot;id\u0026quot;\r)\rdplyr::glimpse(dados_ditto)\r## Rows: 396\r## Columns: 3\r## $ id \u0026lt;chr\u0026gt; \u0026quot;abilities\u0026quot;, \u0026quot;abilities\u0026quot;, \u0026quot;abilities\u0026quot;, \u0026quot;abilities\u0026quot;, \u0026quot;abilities\u0026quot;,‚Ä¶\r## $ name \u0026lt;chr\u0026gt; \u0026quot;ability.name\u0026quot;, \u0026quot;ability.url\u0026quot;, \u0026quot;is_hidden\u0026quot;, \u0026quot;slot\u0026quot;, \u0026quot;ability.nam‚Ä¶\r## $ value \u0026lt;chr\u0026gt; \u0026quot;limber\u0026quot;, \u0026quot;https://pokeapi.co/api/v2/ability/7/\u0026quot;, \u0026quot;FALSE\u0026quot;, \u0026quot;1\u0026quot;, ‚Ä¶\rAgora voc√™ pode usar o que aprendemos para pesquisar outros Pok√©mons! Quem sabe explorar a teoria de que o Ditto √© um clone falho do Mew?\ndados_mew \u0026lt;- \u0026quot;https://pokeapi.co/api/v2/pokemon/mew\u0026quot; %\u0026gt;% httr::GET() %\u0026gt;% httr::content() %\u0026gt;%\rpurrr::map(unlist, recursive = TRUE) %\u0026gt;%\rpurrr::map(tibble::enframe) %\u0026gt;%\rpurrr::map_dfr(\r~dplyr::mutate(.x, dplyr::across(.fns = as.character)), .id = \u0026quot;id\u0026quot;\r)\rdplyr::glimpse(dados_mew)\r## Rows: 10,083\r## Columns: 3\r## $ id \u0026lt;chr\u0026gt; \u0026quot;abilities\u0026quot;, \u0026quot;abilities\u0026quot;, \u0026quot;abilities\u0026quot;, \u0026quot;abilities\u0026quot;, \u0026quot;base_experi‚Ä¶\r## $ name \u0026lt;chr\u0026gt; \u0026quot;ability.name\u0026quot;, \u0026quot;ability.url\u0026quot;, \u0026quot;is_hidden\u0026quot;, \u0026quot;slot\u0026quot;, \u0026quot;1\u0026quot;, \u0026quot;name\u0026quot;,‚Ä¶\r## $ value \u0026lt;chr\u0026gt; \u0026quot;synchronize\u0026quot;, \u0026quot;https://pokeapi.co/api/v2/ability/28/\u0026quot;, \u0026quot;FALSE\u0026quot;,‚Ä¶\rSaiba mais sobre a teoria aqui:\n\r\r\r√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios. Comentem tamb√©m quais exemplos, dentre os que foram listados, voc√™s gostariam de saber mais!!\nAt√© a pr√≥xima!\n\rVoc√™ pode se interessar tamb√©m por‚Ä¶\r\rSlides do curso de Deploy\n\rSlides do curso de Web Scraping sobre APIs\n\rSlides do curso de Faxina sobre tidy data\n\rPacote httr\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-11-29-api-pokemon/","tags":["api","purrr","httr","web-scraping"],"title":"Acessando APIs com R: Exemplos com a Pok√©API!"},{"author":["William"],"categories":["pacotes"],"contents":"\r\r\r\r\r\r\rNo √∫ltimo post, vimos como usar o pacote plotly para gerar gr√°ficos din√¢micos do zero ou aproveitando um gr√°fico feito em ggplot. Neste post, falaremos de outra biblioteca gr√°fica em JavaScript que possui pacote em R: o echarts.\nO pacote em quest√£o se chama echarts4r, portanto, se voc√™ ainda n√£o o estiver instalado, rode o c√≥digo abaixo:\ninstall.packages(\u0026quot;echarts4r\u0026quot;)\rLeia mais:\n\rGr√°ficos no Shiny: ggplot2\n\rGr√°ficos no Shiny: echarts\n\r\rO pacote echarts4r\rO pacote echarts4r n√£o possui uma fun√ß√£o ggecharts, equivalente √† ggplotly do pacote plotly, que possibilitaria transformar gr√°ficos feitos em ggplot em gr√°ficos echarts. Assim, precisamos sempre construir nossos gr√°ficos do zero, usando a sintaxe do echarts/echarts4r.\nO echarts4r possui semelhan√ßas e diferen√ßas com rela√ß√£o ao ggplot2. A semelhan√ßa mais importante √© que constru√≠mos gr√°ficos em camadas. A primeira diferen√ßa relevante √© que essas camadas s√£o unidas pelo %\u0026gt;%/|\u0026gt;, n√£o pelo +. Outra diferen√ßa √© que n√£o temos uma fun√ß√£o aes(), ent√£o o mapeamento das vari√°veis √© feito diretamente nos argumentos das fun√ß√µes.\nVamos come√ßar com um exemplo simples: um gr√°fico de dispers√£o.\nlibrary(echarts4r)\rmtcars |\u0026gt; e_charts(x = wt) |\u0026gt; e_scatter(serie = mpg)\r\r{\"x\":{\"theme\":\"\",\"tl\":false,\"draw\":true,\"renderer\":\"canvas\",\"events\":[],\"buttons\":[],\"opts\":{\"yAxis\":[{\"show\":true}],\"xAxis\":[{\"type\":\"value\"}],\"legend\":{\"data\":[\"mpg\"]},\"series\":[{\"data\":[{\"value\":[1.513,30.4]},{\"value\":[1.615,30.4]},{\"value\":[1.835,33.9]},{\"value\":[1.935,27.3]},{\"value\":[2.14,26]},{\"value\":[2.2,32.4]},{\"value\":[2.32,22.8]},{\"value\":[2.465,21.5]},{\"value\":[2.62,21]},{\"value\":[2.77,19.7]},{\"value\":[2.78,21.4]},{\"value\":[2.875,21]},{\"value\":[3.15,22.8]},{\"value\":[3.17,15.8]},{\"value\":[3.19,24.4]},{\"value\":[3.215,21.4]},{\"value\":[3.435,15.2]},{\"value\":[3.44,18.7]},{\"value\":[3.44,19.2]},{\"value\":[3.44,17.8]},{\"value\":[3.46,18.1]},{\"value\":[3.52,15.5]},{\"value\":[3.57,14.3]},{\"value\":[3.57,15]},{\"value\":[3.73,17.3]},{\"value\":[3.78,15.2]},{\"value\":[3.84,13.3]},{\"value\":[3.845,19.2]},{\"value\":[4.07,16.4]},{\"value\":[5.25,10.4]},{\"value\":[5.345,14.7]},{\"value\":[5.424,10.4]}],\"name\":\"mpg\",\"type\":\"scatter\",\"symbol\":null,\"coordinateSystem\":\"cartesian2d\",\"yAxisIndex\":0,\"xAxisIndex\":0,\"symbolSize\":3}]},\"dispose\":true},\"evals\":[],\"jsHooks\":[]}\rVeja que o gr√°fico n√£o possui tooltip por padr√£o. Precisamos inclu√≠-la na pipeline:\nmtcars |\u0026gt; e_charts(x = wt) |\u0026gt; e_scatter(serie = mpg) |\u0026gt; e_tooltip()\r\r{\"x\":{\"theme\":\"\",\"tl\":false,\"draw\":true,\"renderer\":\"canvas\",\"events\":[],\"buttons\":[],\"opts\":{\"yAxis\":[{\"show\":true}],\"xAxis\":[{\"type\":\"value\"}],\"legend\":{\"data\":[\"mpg\"]},\"series\":[{\"data\":[{\"value\":[1.513,30.4]},{\"value\":[1.615,30.4]},{\"value\":[1.835,33.9]},{\"value\":[1.935,27.3]},{\"value\":[2.14,26]},{\"value\":[2.2,32.4]},{\"value\":[2.32,22.8]},{\"value\":[2.465,21.5]},{\"value\":[2.62,21]},{\"value\":[2.77,19.7]},{\"value\":[2.78,21.4]},{\"value\":[2.875,21]},{\"value\":[3.15,22.8]},{\"value\":[3.17,15.8]},{\"value\":[3.19,24.4]},{\"value\":[3.215,21.4]},{\"value\":[3.435,15.2]},{\"value\":[3.44,18.7]},{\"value\":[3.44,19.2]},{\"value\":[3.44,17.8]},{\"value\":[3.46,18.1]},{\"value\":[3.52,15.5]},{\"value\":[3.57,14.3]},{\"value\":[3.57,15]},{\"value\":[3.73,17.3]},{\"value\":[3.78,15.2]},{\"value\":[3.84,13.3]},{\"value\":[3.845,19.2]},{\"value\":[4.07,16.4]},{\"value\":[5.25,10.4]},{\"value\":[5.345,14.7]},{\"value\":[5.424,10.4]}],\"name\":\"mpg\",\"type\":\"scatter\",\"symbol\":null,\"coordinateSystem\":\"cartesian2d\",\"yAxisIndex\":0,\"xAxisIndex\":0,\"symbolSize\":3}],\"tooltip\":{\"trigger\":\"item\"}},\"dispose\":true},\"evals\":[],\"jsHooks\":[]}\rPara fazermos um gr√°fico de linhas, usamos a fun√ß√£o e_line(). Cada tipo de gr√°fico ser√° produzido a partir de uma fun√ß√£o do tipo e_*(), equivalente √†s fun√ß√µes geom_*() no ggplot2.\nggplot2::txhousing |\u0026gt; dplyr::mutate(year = as.character(year)) |\u0026gt; dplyr::group_by(year) |\u0026gt; dplyr::summarise(sales = mean(sales, na.rm = TRUE)) |\u0026gt; e_charts(x = year) |\u0026gt; e_line(serie = sales) |\u0026gt; e_tooltip()\r\r{\"x\":{\"theme\":\"\",\"tl\":false,\"draw\":true,\"renderer\":\"canvas\",\"events\":[],\"buttons\":[],\"opts\":{\"yAxis\":[{\"show\":true}],\"xAxis\":[{\"data\":[\"2000\",\"2001\",\"2002\",\"2003\",\"2004\",\"2005\",\"2006\",\"2007\",\"2008\",\"2009\",\"2010\",\"2011\",\"2012\",\"2013\",\"2014\",\"2015\"],\"type\":\"category\",\"boundaryGap\":true}],\"legend\":{\"data\":[\"sales\"]},\"series\":[{\"data\":[{\"value\":[\"2000\",\"478.4581\"]},{\"value\":[\"2001\",\"495.6167\"]},{\"value\":[\"2002\",\"531.9728\"]},{\"value\":[\"2003\",\"539.0849\"]},{\"value\":[\"2004\",\"577.2337\"]},{\"value\":[\"2005\",\"635.9074\"]},{\"value\":[\"2006\",\"664.8815\"]},{\"value\":[\"2007\",\"620.6458\"]},{\"value\":[\"2008\",\"520.0451\"]},{\"value\":[\"2009\",\"469.2169\"]},{\"value\":[\"2010\",\"440.2428\"]},{\"value\":[\"2011\",\"447.1071\"]},{\"value\":[\"2012\",\"520.0217\"]},{\"value\":[\"2013\",\"608.1561\"]},{\"value\":[\"2014\",\"626.3043\"]},{\"value\":[\"2015\",\"658.6203\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"sales\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"}],\"tooltip\":{\"trigger\":\"item\"}},\"dispose\":true},\"evals\":[],\"jsHooks\":[]}\rAo contr√°rio do ggplot2, dados agrupados com dplyr::group_by() influenciam a constru√ß√£o do gr√°fico. No c√≥digo abaixo, a base sai do summarise agrupada por city, fazendo com que o echarts construa uma linha para cada cidade.\nggplot2::txhousing |\u0026gt; dplyr::filter(city %in% c(\u0026quot;Austin\u0026quot;, \u0026quot;Dallas\u0026quot;, \u0026quot;Houston\u0026quot;)) |\u0026gt; dplyr::mutate(year = as.character(year)) |\u0026gt; dplyr::group_by(city, year) |\u0026gt; dplyr::summarise(sales = mean(sales, na.rm = TRUE)) |\u0026gt; e_charts(x = year) |\u0026gt; e_line(serie = sales) |\u0026gt; e_tooltip()\r\r{\"x\":{\"theme\":\"\",\"tl\":false,\"draw\":true,\"renderer\":\"canvas\",\"events\":[],\"buttons\":[],\"opts\":{\"yAxis\":[{\"show\":true}],\"xAxis\":[{\"data\":[\"2000\",\"2001\",\"2002\",\"2003\",\"2004\",\"2005\",\"2006\",\"2007\",\"2008\",\"2009\",\"2010\",\"2011\",\"2012\",\"2013\",\"2014\",\"2015\"],\"type\":\"category\",\"boundaryGap\":true}],\"legend\":{\"data\":[\"Austin\",\"Dallas\",\"Houston\"]},\"series\":[{\"data\":[{\"value\":[\"2000\",\"1551.750\"]},{\"value\":[\"2001\",\"1532.667\"]},{\"value\":[\"2002\",\"1559.667\"]},{\"value\":[\"2003\",\"1649.417\"]},{\"value\":[\"2004\",\"1880.583\"]},{\"value\":[\"2005\",\"2242.083\"]},{\"value\":[\"2006\",\"2523.667\"]},{\"value\":[\"2007\",\"2337.333\"]},{\"value\":[\"2008\",\"1870.000\"]},{\"value\":[\"2009\",\"1728.917\"]},{\"value\":[\"2010\",\"1656.000\"]},{\"value\":[\"2011\",\"1767.333\"]},{\"value\":[\"2012\",\"2126.750\"]},{\"value\":[\"2013\",\"2536.333\"]},{\"value\":[\"2014\",\"2579.417\"]},{\"value\":[\"2015\",\"2696.857\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"Austin\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2000\",\"3787.167\"]},{\"value\":[\"2001\",\"3916.000\"]},{\"value\":[\"2002\",\"3933.250\"]},{\"value\":[\"2003\",\"4106.500\"]},{\"value\":[\"2004\",\"4542.833\"]},{\"value\":[\"2005\",\"4998.333\"]},{\"value\":[\"2006\",\"5352.167\"]},{\"value\":[\"2007\",\"4974.583\"]},{\"value\":[\"2008\",\"4237.333\"]},{\"value\":[\"2009\",\"3824.250\"]},{\"value\":[\"2010\",\"3531.917\"]},{\"value\":[\"2011\",\"3554.667\"]},{\"value\":[\"2012\",\"4200.917\"]},{\"value\":[\"2013\",\"4976.167\"]},{\"value\":[\"2014\",\"5012.833\"]},{\"value\":[\"2015\",\"5247.857\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"Dallas\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"},{\"data\":[{\"value\":[\"2000\",\"4371.583\"]},{\"value\":[\"2001\",\"4488.000\"]},{\"value\":[\"2002\",\"4713.583\"]},{\"value\":[\"2003\",\"5061.000\"]},{\"value\":[\"2004\",\"5581.583\"]},{\"value\":[\"2005\",\"6066.667\"]},{\"value\":[\"2006\",\"6749.500\"]},{\"value\":[\"2007\",\"6472.333\"]},{\"value\":[\"2008\",\"5430.750\"]},{\"value\":[\"2009\",\"5008.833\"]},{\"value\":[\"2010\",\"4733.917\"]},{\"value\":[\"2011\",\"4904.500\"]},{\"value\":[\"2012\",\"5720.250\"]},{\"value\":[\"2013\",\"6737.333\"]},{\"value\":[\"2014\",\"6951.000\"]},{\"value\":[\"2015\",\"6872.714\"]}],\"yAxisIndex\":0,\"xAxisIndex\":0,\"name\":\"Houston\",\"type\":\"line\",\"coordinateSystem\":\"cartesian2d\"}],\"tooltip\":{\"trigger\":\"item\"}},\"dispose\":true},\"evals\":[],\"jsHooks\":[]}\rA biblioteca echarts possui uma extensa variedade de gr√°ficos dispon√≠veis. Voc√™ pode visitar a galeria de exemplos para ter uma boa ideia do que √© poss√≠vel fazer. Al√©m disso, clicando nos exemplos, voc√™ tem acesso aos c√≥digos JavaScript utilizados para construir os gr√°ficos.\nCom as fun√ß√µes do pacote echarts4r, podemos fazer bastante do que a biblioteca echarts tem para oferecer. O que mostramos neste post foi t√£o pouco que nem poder√≠amos chamar de uma introdu√ß√£o. Para aprender mais sobre o echarts4r vale bastante a pena olhar os tutoriais na p√°gina do pacote.\nEm alguns casos, vamos encontrar gr√°ficos ou elementos dentro de um gr√°fico que n√£o podem ser constru√≠dos a partir dos par√¢metros das fun√ß√µes do echarts4r. Nesses casos, vamos precisar nos socorrer da documenta√ß√£o do echarts e usar par√¢metros que n√£o est√£o definidos nas fun√ß√µes do echarts4r (o que √© poss√≠vel j√° que a maioria das fun√ß√µes possuem ...).\nA documenta√ß√£o do echarts pode assustar √† primeira vista, mas segue um modelo padr√£o de documenta√ß√£o de bibliotecas JavaScript. Conforme vamos usando mais essas bibliotecas, seja para fazer gr√°ficos, tabelas, mapas ou o que for, vamos nos acostumando a consumir essas documenta√ß√µes.\nNesse sentido, uma forma de seguir a maneira JavaScript de construir um echarts √© usar a fun√ß√£o e_list(). Com ela, definimos os par√¢metros do gr√°fico a partir de listas e conseguimos reproduzir linha a linha um exemplo feito em JS. A seguir, reproduzimos exatamente este exemplo. Veja que a sintaxe dos dois c√≥digos √© muito parecida.\ne_chart() |\u0026gt; e_list(list(\rtooltip = list(trigger = \u0026quot;item\u0026quot;),\rlegend = list(top = \u0026quot;5%\u0026quot;, left = \u0026quot;center\u0026quot;),\rseries = list(\rlist(\rname = \u0026quot;Access From\u0026quot;,\rtype = \u0026quot;pie\u0026quot;,\rradius = c(\u0026quot;40%\u0026quot;, \u0026quot;70%\u0026quot;),\ravoidLabelOverlap = FALSE,\ritemStyle = list(\rborderRadius = 10,\rborderColor = \u0026quot;#fff\u0026quot;,\rborderWidth = 2\r),\rlabel = list(show = FALSE, position = \u0026quot;center\u0026quot;),\remphasis = list(\rlabel = list(\rshow = TRUE, fontSize = 40,\rfontWeight = \u0026quot;bold\u0026quot;\r)\r),\rlabelLine = list(show = FALSE),\rdata = list(\rlist(value = 1048, name = \u0026quot;Search Engine\u0026quot;),\rlist(value = 735, name = \u0026quot;Direct\u0026quot;),\rlist(value = 580, name = \u0026quot;Email\u0026quot;),\rlist(value = 484, name = \u0026quot;Union Ads\u0026quot;),\rlist(value = 300, name = \u0026quot;Video Ads\u0026quot;)\r)\r)\r)\r))\r\r{\"x\":{\"theme\":\"\",\"tl\":false,\"draw\":true,\"renderer\":\"canvas\",\"events\":[],\"buttons\":[],\"opts\":{\"tooltip\":{\"trigger\":\"item\"},\"legend\":{\"top\":\"5%\",\"left\":\"center\"},\"series\":[{\"name\":\"Access From\",\"type\":\"pie\",\"radius\":[\"40%\",\"70%\"],\"avoidLabelOverlap\":false,\"itemStyle\":{\"borderRadius\":10,\"borderColor\":\"#fff\",\"borderWidth\":2},\"label\":{\"show\":false,\"position\":\"center\"},\"emphasis\":{\"label\":{\"show\":true,\"fontSize\":40,\"fontWeight\":\"bold\"}},\"labelLine\":{\"show\":false},\"data\":[{\"value\":1048,\"name\":\"Search Engine\"},{\"value\":735,\"name\":\"Direct\"},{\"value\":580,\"name\":\"Email\"},{\"value\":484,\"name\":\"Union Ads\"},{\"value\":300,\"name\":\"Video Ads\"}]}]},\"dispose\":true},\"evals\":[],\"jsHooks\":[]}\r\rNo Shiny\rPara adicionar um echarts no Shiny, utilizamos o par de fun√ß√µes echarts4r::echarts4rOutput() e echarts4r::renderEcharts4r(). Na fun√ß√£o renderEcharts4r(), basta passarmos um c√≥digo que retorne um gr√°fico echarts.\nRode o app abaixo para ver um exemplo.\nlibrary(shiny)\rlibrary(echarts4r)\rvars \u0026lt;- ggplot2::txhousing |\u0026gt;\rdplyr::select(where(is.numeric), -year, -month, -date) |\u0026gt;\rnames()\rcidades \u0026lt;- unique(ggplot2::txhousing$city)\rui \u0026lt;- fluidPage(\rtitlePanel(\u0026quot;echarts\u0026quot;),\rsidebarLayout(\rsidebarPanel(\rselectInput(\r\u0026quot;cidades\u0026quot;,\r\u0026quot;Selecione as cidades\u0026quot;,\rmultiple = TRUE,\rchoices = cidades,\rselected = cidades[1]\r),\rselectInput(\r\u0026quot;serie\u0026quot;,\r\u0026quot;Selecione a s√©rie\u0026quot;,\rchoices = vars,\rselected = vars[1]\r)\r),\rmainPanel(\recharts4r::echarts4rOutput(\u0026quot;plot\u0026quot;)\r)\r)\r)\rserver \u0026lt;- function(input, output, session) {\routput$plot \u0026lt;- echarts4r::renderEcharts4r({\rggplot2::txhousing |\u0026gt;\rdplyr::filter(city %in% input$cidades) |\u0026gt;\rdplyr::mutate(year = as.character(year)) |\u0026gt;\rdplyr::group_by(city, year) |\u0026gt;\rdplyr::summarise(avg_serie = mean(.data[[input$serie]], na.rm = TRUE)) |\u0026gt;\re_charts(x = year) |\u0026gt;\re_line(serie = avg_serie) |\u0026gt;\re_tooltip()\r})\r}\rshinyApp(ui, server)\r√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2021-11-11-shiny-echarts/","tags":["shiny","gr√°ficos","echarts"],"title":"Gr√°ficos no Shiny: echarts"},{"author":["Tereza"],"categories":["tutoriais"],"contents":"\r\rDatas no R s√£o tratadas como um tipo especial de objeto, com classe Date.\nExistem algumas fun√ß√µes para converter diversos tipos de padr√µes de data para a classe Date, veja como funcionam algumas delas!\nLubridate\rPrimeiramente, vamos carregar o pacote lubridate:\nlibrary(lubridate)\rSuponha que queremos criar um objeto da classe Date com a seguinte data: 20/11/2021\nA primeira coisa a ser feita, √© identificar a ordem da entrada, nesse caso, √©: dia, m√™s, ano (padr√£o brasileiro)\nEnt√£o, basta usar a fun√ß√£o dmy (day, month, year):\ndmy(\u0026quot;20/11/2021\u0026quot;)\r## [1] \u0026quot;2021-11-20\u0026quot;\rObs: note que o padr√£o do R para um objeto da classe Date √© y/m/d (year, month, day)\nTrocando dia e m√™s de lugar na data anterior, obtemos: 11/20/2021.\nPara converter para a classe Date, identificamos que a ordem de entrada √©: m√™s, dia, ano (padr√£o americano)\nE ent√£o, usamos a fun√ß√£o mdy (month, day, year):\nmdy(\u0026quot;11/20/2021\u0026quot;)\r## [1] \u0026quot;2021-11-20\u0026quot;\rSeguindo essa intui√ß√£o:\nydm(\u0026quot;2021/20/11\u0026quot;)\r## [1] \u0026quot;2021-11-20\u0026quot;\rAl√©m disso, a fun√ß√£o aceita diversos padr√µes de entrada, vejamos:\ndmy(20112021)\r## [1] \u0026quot;2021-11-20\u0026quot;\rdmy(\u0026quot;20112021\u0026quot;)\r## [1] \u0026quot;2021-11-20\u0026quot;\rdmy(\u0026quot;20-11-2021\u0026quot;)\r## [1] \u0026quot;2021-11-20\u0026quot;\rdmy(\u0026quot;20.11.2021\u0026quot;)\r## [1] \u0026quot;2021-11-20\u0026quot;\rIncluindo horas, minutos e segundos\rSuponha que queremos criar um objeto com a seguinte informa√ß√£o: 20/11/2021 16:34:29. Basta usar a fun√ß√£o dmy_hms:\ndmy_hms(\u0026quot;20/11/2021 16:34:29\u0026quot;)\r## [1] \u0026quot;2021-11-20 16:34:29 UTC\u0026quot;\rdmy_hms(\u0026quot;20112021163429\u0026quot;)\r## [1] \u0026quot;2021-11-20 16:34:29 UTC\u0026quot;\r\rOs operadores %m+% e %m-%\rPodemos usar os operadores %m+% e %m-% para somar e subtrair datas.\nCriando um objeto date:\ndata \u0026lt;- dmy(\u0026quot;31-01-2022\u0026quot;)\rPor exemplo, para somar um m√™s em alguma data, fazemos:\ndata %m+% months(1)\r## [1] \u0026quot;2022-02-28\u0026quot;\rNote que a fun√ß√£o n√£o excedeu o √∫ltimo dia do m√™s, ela retornou o √∫ltimo dia do m√™s seguinte.\nPodemos somar mais de um m√™s por vez, obtendo:\ndata %m+% months(1:12)\r## [1] \u0026quot;2022-02-28\u0026quot; \u0026quot;2022-03-31\u0026quot; \u0026quot;2022-04-30\u0026quot; \u0026quot;2022-05-31\u0026quot; \u0026quot;2022-06-30\u0026quot;\r## [6] \u0026quot;2022-07-31\u0026quot; \u0026quot;2022-08-31\u0026quot; \u0026quot;2022-09-30\u0026quot; \u0026quot;2022-10-31\u0026quot; \u0026quot;2022-11-30\u0026quot;\r## [11] \u0026quot;2022-12-31\u0026quot; \u0026quot;2023-01-31\u0026quot;\rA express√£o Date %m+% months(n) sempre retorna uma data do n-√©simo m√™s seguinte √† data do objeto Date\nSubtraindo um dia:\ndata %m+% months(1:12) %m-% days(1)\r## [1] \u0026quot;2022-02-27\u0026quot; \u0026quot;2022-03-30\u0026quot; \u0026quot;2022-04-29\u0026quot; \u0026quot;2022-05-30\u0026quot; \u0026quot;2022-06-29\u0026quot;\r## [6] \u0026quot;2022-07-30\u0026quot; \u0026quot;2022-08-30\u0026quot; \u0026quot;2022-09-29\u0026quot; \u0026quot;2022-10-30\u0026quot; \u0026quot;2022-11-29\u0026quot;\r## [11] \u0026quot;2022-12-30\u0026quot; \u0026quot;2023-01-30\u0026quot;\rOutro exemplo:\ndata_2 \u0026lt;- dmy(\u0026quot;29/02/2020\u0026quot;)\rdata_2 %m+% years(1)\r## [1] \u0026quot;2021-02-28\u0026quot;\rdata_2 %m-% years(1)\r## [1] \u0026quot;2019-02-28\u0026quot;\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-11-16.lubridate/","tags":["tutoriais"],"title":"Manipulando datas com o lubridate"},{"author":["William"],"categories":["pacotes"],"contents":"\r\r\r\r\r\r\r\rMuitas vezes, o destino dos nossos gr√°ficos √© um Word ou PDF. Nesses casos, independentemente se vamos ler o documento no computador ou na vers√£o impressa, os gr√°ficos precisam ser uma imagem est√°tica. E ent√£o o pacote ggplot2 brilha.\n‚Äî Leia mais: Gr√°ficos no Shiny: ggplot2\nQuando estamos construindo p√°ginas ou aplica√ß√µes Web (ou apresenta√ß√µes de slides em HTML), al√©m de gr√°ficos em formato de imagem, podemos construir visualiza√ß√µes utilizando bibliotecas JavaScript, que permitem anima√ß√µes e possuem diversas funcionalidades interativas, como tooltips, filtros, zoom e drilldrown.\nNeste post, vamos falar da biblioteca plotly, que permite transformarmos rapidamente nossos gr√°ficos feitos com ggplot2 em gr√°ficos animados e interativos.\nO pacote plotly\rAntes de mais nada, precisamos instalar o pacote plotly.\ninstall.packages(\u0026quot;plotly\u0026quot;)\rA fun√ß√£o mais legal desse pacote √© a plotly::ggplotly(). Com ela transformamos facilmente um ggplot em um gr√°fico plotly.\nlibrary(ggplot2)\rlibrary(plotly)\rp \u0026lt;- mtcars |\u0026gt; ggplot(aes(x = wt, y = mpg)) +\rgeom_point()\rggplotly(p)\r\r{\"x\":{\"data\":[{\"x\":[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],\"y\":[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],\"text\":[\"wt: 2.620\nmpg: 21.0\",\"wt: 2.875\nmpg: 21.0\",\"wt: 2.320\nmpg: 22.8\",\"wt: 3.215\nmpg: 21.4\",\"wt: 3.440\nmpg: 18.7\",\"wt: 3.460\nmpg: 18.1\",\"wt: 3.570\nmpg: 14.3\",\"wt: 3.190\nmpg: 24.4\",\"wt: 3.150\nmpg: 22.8\",\"wt: 3.440\nmpg: 19.2\",\"wt: 3.440\nmpg: 17.8\",\"wt: 4.070\nmpg: 16.4\",\"wt: 3.730\nmpg: 17.3\",\"wt: 3.780\nmpg: 15.2\",\"wt: 5.250\nmpg: 10.4\",\"wt: 5.424\nmpg: 10.4\",\"wt: 5.345\nmpg: 14.7\",\"wt: 2.200\nmpg: 32.4\",\"wt: 1.615\nmpg: 30.4\",\"wt: 1.835\nmpg: 33.9\",\"wt: 2.465\nmpg: 21.5\",\"wt: 3.520\nmpg: 15.5\",\"wt: 3.435\nmpg: 15.2\",\"wt: 3.840\nmpg: 13.3\",\"wt: 3.845\nmpg: 19.2\",\"wt: 1.935\nmpg: 27.3\",\"wt: 2.140\nmpg: 26.0\",\"wt: 1.513\nmpg: 30.4\",\"wt: 3.170\nmpg: 15.8\",\"wt: 2.770\nmpg: 19.7\",\"wt: 3.570\nmpg: 15.0\",\"wt: 2.780\nmpg: 21.4\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(0,0,0,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,0,0,1)\"}},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.2283105022831,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":37.2602739726027},\"plot_bgcolor\":\"rgba(235,235,235,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[1.31745,5.61955],\"tickmode\":\"array\",\"ticktext\":[\"2\",\"3\",\"4\",\"5\"],\"tickvals\":[2,3,4,5],\"categoryorder\":\"array\",\"categoryarray\":[\"2\",\"3\",\"4\",\"5\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(255,255,255,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"wt\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[9.225,35.075],\"tickmode\":\"array\",\"ticktext\":[\"10\",\"15\",\"20\",\"25\",\"30\",\"35\"],\"tickvals\":[10,15,20,25,30,35],\"categoryorder\":\"array\",\"categoryarray\":[\"10\",\"15\",\"20\",\"25\",\"30\",\"35\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(255,255,255,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"mpg\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.88976377952756,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"2fdf5d19e1f9\":{\"x\":{},\"y\":{},\"type\":\"scatter\"}},\"cur_data\":\"2fdf5d19e1f9\",\"visdat\":{\"2fdf5d19e1f9\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\rVeja que esse gr√°fico possui um visual muito parecido com o do ggplot e, al√©m disso,\n\rmostra uma tooltip quando passamos o cursor em cima de um ponto\n\rpermite selecionar uma √°rea do gr√°fico para dar zoom;\n\re possui uma barra de ferramentas que nos permite aumentar e diminuir o zoom, focar em regi√µes do gr√°fico e baixar o gr√°fico como uma imagem est√°tica.\n\r\rNo exemplo a seguir, al√©m das funcionalidades acima, tamb√©m podemos clicar na legenda para adicionar ou remover grupos de pontos do gr√°fico.\nlibrary(ggplot2)\rlibrary(plotly)\rp \u0026lt;- mtcars |\u0026gt; ggplot(aes(x = wt, y = mpg, color = as.character(cyl))) +\rgeom_point()\rggplotly(p)\r\r{\"x\":{\"data\":[{\"x\":[2.32,3.19,3.15,2.2,1.615,1.835,2.465,1.935,2.14,1.513,2.78],\"y\":[22.8,24.4,22.8,32.4,30.4,33.9,21.5,27.3,26,30.4,21.4],\"text\":[\"wt: 2.320\nmpg: 22.8\nas.character(cyl): 4\",\"wt: 3.190\nmpg: 24.4\nas.character(cyl): 4\",\"wt: 3.150\nmpg: 22.8\nas.character(cyl): 4\",\"wt: 2.200\nmpg: 32.4\nas.character(cyl): 4\",\"wt: 1.615\nmpg: 30.4\nas.character(cyl): 4\",\"wt: 1.835\nmpg: 33.9\nas.character(cyl): 4\",\"wt: 2.465\nmpg: 21.5\nas.character(cyl): 4\",\"wt: 1.935\nmpg: 27.3\nas.character(cyl): 4\",\"wt: 2.140\nmpg: 26.0\nas.character(cyl): 4\",\"wt: 1.513\nmpg: 30.4\nas.character(cyl): 4\",\"wt: 2.780\nmpg: 21.4\nas.character(cyl): 4\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(248,118,109,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(248,118,109,1)\"}},\"hoveron\":\"points\",\"name\":\"4\",\"legendgroup\":\"4\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"x\":[2.62,2.875,3.215,3.46,3.44,3.44,2.77],\"y\":[21,21,21.4,18.1,19.2,17.8,19.7],\"text\":[\"wt: 2.620\nmpg: 21.0\nas.character(cyl): 6\",\"wt: 2.875\nmpg: 21.0\nas.character(cyl): 6\",\"wt: 3.215\nmpg: 21.4\nas.character(cyl): 6\",\"wt: 3.460\nmpg: 18.1\nas.character(cyl): 6\",\"wt: 3.440\nmpg: 19.2\nas.character(cyl): 6\",\"wt: 3.440\nmpg: 17.8\nas.character(cyl): 6\",\"wt: 2.770\nmpg: 19.7\nas.character(cyl): 6\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(0,186,56,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,186,56,1)\"}},\"hoveron\":\"points\",\"name\":\"6\",\"legendgroup\":\"6\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"x\":[3.44,3.57,4.07,3.73,3.78,5.25,5.424,5.345,3.52,3.435,3.84,3.845,3.17,3.57],\"y\":[18.7,14.3,16.4,17.3,15.2,10.4,10.4,14.7,15.5,15.2,13.3,19.2,15.8,15],\"text\":[\"wt: 3.440\nmpg: 18.7\nas.character(cyl): 8\",\"wt: 3.570\nmpg: 14.3\nas.character(cyl): 8\",\"wt: 4.070\nmpg: 16.4\nas.character(cyl): 8\",\"wt: 3.730\nmpg: 17.3\nas.character(cyl): 8\",\"wt: 3.780\nmpg: 15.2\nas.character(cyl): 8\",\"wt: 5.250\nmpg: 10.4\nas.character(cyl): 8\",\"wt: 5.424\nmpg: 10.4\nas.character(cyl): 8\",\"wt: 5.345\nmpg: 14.7\nas.character(cyl): 8\",\"wt: 3.520\nmpg: 15.5\nas.character(cyl): 8\",\"wt: 3.435\nmpg: 15.2\nas.character(cyl): 8\",\"wt: 3.840\nmpg: 13.3\nas.character(cyl): 8\",\"wt: 3.845\nmpg: 19.2\nas.character(cyl): 8\",\"wt: 3.170\nmpg: 15.8\nas.character(cyl): 8\",\"wt: 3.570\nmpg: 15.0\nas.character(cyl): 8\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(97,156,255,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(97,156,255,1)\"}},\"hoveron\":\"points\",\"name\":\"8\",\"legendgroup\":\"8\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.2283105022831,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":37.2602739726027},\"plot_bgcolor\":\"rgba(235,235,235,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[1.31745,5.61955],\"tickmode\":\"array\",\"ticktext\":[\"2\",\"3\",\"4\",\"5\"],\"tickvals\":[2,3,4,5],\"categoryorder\":\"array\",\"categoryarray\":[\"2\",\"3\",\"4\",\"5\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(255,255,255,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"wt\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[9.225,35.075],\"tickmode\":\"array\",\"ticktext\":[\"10\",\"15\",\"20\",\"25\",\"30\",\"35\"],\"tickvals\":[10,15,20,25,30,35],\"categoryorder\":\"array\",\"categoryarray\":[\"10\",\"15\",\"20\",\"25\",\"30\",\"35\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(255,255,255,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"mpg\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":true,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.88976377952756,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895},\"y\":0.913385826771654},\"annotations\":[{\"text\":\"as.character(cyl)\",\"x\":1.02,\"y\":1,\"showarrow\":false,\"ax\":0,\"ay\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"xref\":\"paper\",\"yref\":\"paper\",\"textangle\":-0,\"xanchor\":\"left\",\"yanchor\":\"bottom\",\"legendTitle\":true}],\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"2fdf569728b1\":{\"x\":{},\"y\":{},\"colour\":{},\"type\":\"scatter\"}},\"cur_data\":\"2fdf569728b1\",\"visdat\":{\"2fdf569728b1\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\rPara controlar o que aparece na tooltip, podemos usar o par√¢metro tooltip. Veja que adicionamos o modelo do carro e passamos por meio do aes text. O tema escolhido para o ggplot √© respeitado pelo plotly.\nlibrary(ggplot2)\rlibrary(plotly)\rp \u0026lt;- mtcars |\u0026gt; tibble::rownames_to_column() |\u0026gt; ggplot(aes(x = wt, y = mpg, color = as.character(cyl), text = rowname)) +\rgeom_point() +\rtheme_minimal()\rggplotly(p, tooltip = c(\u0026quot;x\u0026quot;, \u0026quot;y\u0026quot;, \u0026quot;text\u0026quot;))\r\r{\"x\":{\"data\":[{\"x\":[2.32,3.19,3.15,2.2,1.615,1.835,2.465,1.935,2.14,1.513,2.78],\"y\":[22.8,24.4,22.8,32.4,30.4,33.9,21.5,27.3,26,30.4,21.4],\"text\":[\"wt: 2.320\nmpg: 22.8\nDatsun 710\",\"wt: 3.190\nmpg: 24.4\nMerc 240D\",\"wt: 3.150\nmpg: 22.8\nMerc 230\",\"wt: 2.200\nmpg: 32.4\nFiat 128\",\"wt: 1.615\nmpg: 30.4\nHonda Civic\",\"wt: 1.835\nmpg: 33.9\nToyota Corolla\",\"wt: 2.465\nmpg: 21.5\nToyota Corona\",\"wt: 1.935\nmpg: 27.3\nFiat X1-9\",\"wt: 2.140\nmpg: 26.0\nPorsche 914-2\",\"wt: 1.513\nmpg: 30.4\nLotus Europa\",\"wt: 2.780\nmpg: 21.4\nVolvo 142E\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(248,118,109,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(248,118,109,1)\"}},\"hoveron\":\"points\",\"name\":\"4\",\"legendgroup\":\"4\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"x\":[2.62,2.875,3.215,3.46,3.44,3.44,2.77],\"y\":[21,21,21.4,18.1,19.2,17.8,19.7],\"text\":[\"wt: 2.620\nmpg: 21.0\nMazda RX4\",\"wt: 2.875\nmpg: 21.0\nMazda RX4 Wag\",\"wt: 3.215\nmpg: 21.4\nHornet 4 Drive\",\"wt: 3.460\nmpg: 18.1\nValiant\",\"wt: 3.440\nmpg: 19.2\nMerc 280\",\"wt: 3.440\nmpg: 17.8\nMerc 280C\",\"wt: 2.770\nmpg: 19.7\nFerrari Dino\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(0,186,56,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,186,56,1)\"}},\"hoveron\":\"points\",\"name\":\"6\",\"legendgroup\":\"6\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"x\":[3.44,3.57,4.07,3.73,3.78,5.25,5.424,5.345,3.52,3.435,3.84,3.845,3.17,3.57],\"y\":[18.7,14.3,16.4,17.3,15.2,10.4,10.4,14.7,15.5,15.2,13.3,19.2,15.8,15],\"text\":[\"wt: 3.440\nmpg: 18.7\nHornet Sportabout\",\"wt: 3.570\nmpg: 14.3\nDuster 360\",\"wt: 4.070\nmpg: 16.4\nMerc 450SE\",\"wt: 3.730\nmpg: 17.3\nMerc 450SL\",\"wt: 3.780\nmpg: 15.2\nMerc 450SLC\",\"wt: 5.250\nmpg: 10.4\nCadillac Fleetwood\",\"wt: 5.424\nmpg: 10.4\nLincoln Continental\",\"wt: 5.345\nmpg: 14.7\nChrysler Imperial\",\"wt: 3.520\nmpg: 15.5\nDodge Challenger\",\"wt: 3.435\nmpg: 15.2\nAMC Javelin\",\"wt: 3.840\nmpg: 13.3\nCamaro Z28\",\"wt: 3.845\nmpg: 19.2\nPontiac Firebird\",\"wt: 3.170\nmpg: 15.8\nFord Pantera L\",\"wt: 3.570\nmpg: 15.0\nMaserati Bora\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(97,156,255,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(97,156,255,1)\"}},\"hoveron\":\"points\",\"name\":\"8\",\"legendgroup\":\"8\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.2283105022831,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":37.2602739726027},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[1.31745,5.61955],\"tickmode\":\"array\",\"ticktext\":[\"2\",\"3\",\"4\",\"5\"],\"tickvals\":[2,3,4,5],\"categoryorder\":\"array\",\"categoryarray\":[\"2\",\"3\",\"4\",\"5\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"wt\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[9.225,35.075],\"tickmode\":\"array\",\"ticktext\":[\"10\",\"15\",\"20\",\"25\",\"30\",\"35\"],\"tickvals\":[10,15,20,25,30,35],\"categoryorder\":\"array\",\"categoryarray\":[\"10\",\"15\",\"20\",\"25\",\"30\",\"35\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"mpg\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":true,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895},\"y\":0.913385826771654},\"annotations\":[{\"text\":\"as.character(cyl)\",\"x\":1.02,\"y\":1,\"showarrow\":false,\"ax\":0,\"ay\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"xref\":\"paper\",\"yref\":\"paper\",\"textangle\":-0,\"xanchor\":\"left\",\"yanchor\":\"bottom\",\"legendTitle\":true}],\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"2fdf5190f174\":{\"x\":{},\"y\":{},\"colour\":{},\"text\":{},\"type\":\"scatter\"}},\"cur_data\":\"2fdf5190f174\",\"visdat\":{\"2fdf5190f174\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\rTamb√©m podemos construir um gr√°fico diretamente pelo plotly, mas isso exige aprendermos a sintaxe do pacote plotly e as op√ß√µes dispon√≠veis da biblioteca Plotly.\nplot_ly(mtcars, x = ~wt, y = ~mpg, type = \u0026quot;scatter\u0026quot;, mode = \u0026quot;markers\u0026quot;)\r\r{\"x\":{\"visdat\":{\"2fdf41da3845\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"2fdf41da3845\",\"attrs\":{\"2fdf41da3845\":{\"x\":{},\"y\":{},\"mode\":\"markers\",\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":\"wt\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"title\":\"mpg\"},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"showSendToCloud\":false},\"data\":[{\"x\":[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],\"y\":[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],\"mode\":\"markers\",\"type\":\"scatter\",\"marker\":{\"color\":\"rgba(31,119,180,1)\",\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"line\":{\"color\":\"rgba(31,119,180,1)\"},\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\rPara aprender mais sobre como fazer gr√°ficos diretamente no plotly, confira o tutorial oficial da biblioteca.\n\rNo Shiny\rPara adicionar um plotly no Shiny, criado a partir da fun√ß√£o ggplotly() ou da fun√ß√£o plot_ly(), utilizamos o par de fun√ß√µes plotly::plotlyOutput() e plotly::renderPlotly(). Na fun√ß√£o renderPlotly(), basta passarmos um c√≥digo que retorne um gr√°fico plotly, utilizando os inputs para especificar as vari√°veis.\nRode o app abaixo para ver um exemplo.\nlibrary(shiny)\rlibrary(ggplot2)\rvars \u0026lt;- names(mtcars)\rui \u0026lt;- fluidPage(\rtitlePanel(\u0026quot;Plotly\u0026quot;),\rsidebarLayout(\rsidebarPanel(\rselectInput(\r\u0026quot;x\u0026quot;,\r\u0026quot;Eixo x\u0026quot;,\rchoices = vars\r),\rselectInput(\r\u0026quot;y\u0026quot;,\r\u0026quot;Eixo y\u0026quot;,\rchoices = vars,\rselected = vars[2]\r)\r),\rmainPanel(\rplotly::plotlyOutput(\u0026quot;plot\u0026quot;)\r)\r)\r)\rserver \u0026lt;- function(input, output, session) {\routput$plot \u0026lt;- plotly::renderPlotly({\rp \u0026lt;- mtcars |\u0026gt;\rtibble::rownames_to_column() |\u0026gt;\rggplot(aes(\rx = .data[[input$x]],\ry = .data[[input$y]],\rtext = rowname\r)) +\rgeom_point() +\rtheme_minimal()\rplotly::ggplotly(p)\r})\r}\rshinyApp(ui, server)\r√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2021-11-10-shiny-plotly/","tags":["shiny","gr√°ficos","plotly"],"title":"Gr√°ficos no Shiny: plotly"},{"author":["Caio"],"categories":["tutoriais"],"contents":"\r\rO RStudio √© uma IDE (Integrated development environment) incr√≠vel. Em sua\rvers√£o mais recente\ra ferramenta tem suporte para visualiza√ß√µes interativas, traz controle de vers√£o\rembutido, consegue executar jobs em paralelo e permite programar n√£o s√≥ em R,\rmas tamb√©m em Python!\nEle n√£o √©, contudo, perfeito. Pessoalmente eu tenho algumas cr√≠ticas a algumas\rde suas idiossincrasias, principalmente no tocante √† camada interpretativa que\rembrulha o R‚Ä¶ Depois de muitos anos programando R e usando somente o RStudio,\ra lista de coisas que come√ßaram a me incomodar foi crescendo:\n\r√Äs vezes, imprimir um objeto de texto muito grande trava a interface. Cancelar\ressa opera√ß√£o depois que ela foi iniciada tamb√©m nem sempre funciona.\n\rO navegador de arquivos, com suas caixinhas clic√°veis, deixa muito a desejar.\rN√£o deveria ser t√£o chato copiar e deletar arquivos.\n\r\r\rAt√© hoje n√£o existe um jeito de substituir um termo (find-replace) em\rm√∫ltiplos arquivos. √â poss√≠vel procurar um termo na pasta toda\r(Ctrl + Shift + F), mas nada de substitu√≠-lo.\n\rAt√© onde eu sei, √© imposs√≠vel abrir uma pasta com o RStudio sem que seja\rcriado um arquivo .Rproj. Por que √© necess√°rio criar um arquivo para abrir uma\rmera pasta?\n\rPor padr√£o, as\rmensagens de diagn√≥stico\rcontinuam sujando as sess√µes locais. Novos usu√°rios podem estranhar esse tipo\rde alerta inesperado.\n\r\r#\u0026gt; Registered S3 method overwritten by \u0026#39;quantmod\u0026#39;:\r#\u0026gt; method from\r#\u0026gt; as.zoo.data.frame zoo\r\rHonestamente, a interface est√° visualmente cada vez mais atrasada. √çcones\rcoloridos e dif√≠ceis de diferenciar somados a um sistema de design limitado √©\rmais que um inc√¥modo em 2021.\n\rAinda √© imposs√≠vel executar fun√ß√µes do furrr no modo multicore dentro do\rconsole do RStudio.\n\r\rplan(\u0026quot;multicore\u0026quot;)\r#\u0026gt; Warning message:\r#\u0026gt; In supportsMulticoreAndRStudio(...) :\r#\u0026gt; [ONE-TIME WARNING] Forked processing (\u0026#39;multicore\u0026#39;) is not supported when\r#\u0026gt; running R from RStudio because it is considered unstable. For more details,\r#\u0026gt; how to control forked processing or not, and how to silence this warning in\r#\u0026gt; future R sessions, see ?parallelly::supportsMulticore\r\rA interrup√ß√£o da execu√ß√£o continua tendo problemas com tarefas em C e\rparalelas. Quem nunca segurou Esc na esperan√ßa de interromper um comando\rs√≥ para ter que esperar ele terminar de rodar de qualquer jeito?\n\rA bombinha. Por que a IDE inteira cai se o problema est√° no c√≥digo executado?\n\r\rUma Poss√≠vel Alternativa\rApesar de nenhum desses problemas ser fatal, eu ainda acho interessante procurar\ruma alternativa. Depender de apenas um software para programar tamb√©m acaba\rvirando um problema caso ele deixe de ser mantido; note que, no momento em que\rescrevo, aproximadamente 20% das\rissues j√° cadastradas no GitHub\rdo RStudio ainda est√£o abertas.\n√â assim que chegamos √†s alternativas. Eu j√° testei o\rNvim-R (extens√£o para Vim programada por\rum brasileiro!) e o ESS (extens√£o para o Emacs),\rmas a curva de aprendizado das duas ferramentas acabou se tornando um obst√°culo.\rNo final eu cheguei ao\rvscode-R, a\rextens√£o de R para o VS Code.\nPara quem n√£o sabe, o VS Code √© atualmente o editor de c√≥digo mais popular do\rmundo. De acordo com uma\rpesquisa\rfeita pelo Stack Overflow em 2021, 71% dos programadores usam o VS Code para\rprogramar, ent√£o ele deve ter algo de bom.\nNa minha opini√£o, os benef√≠cios do VS Code, em geral, giram em torno da\rflexibilidade da ferramenta. √â muito f√°cil instalar plugins, modificar o seu\rvisual e customizar o seu funcionamento, permitindo que a IDE se torne\rverdadeiramente sua. J√°, no tocante ao R, o maior benef√≠cio √© que a sua\rintegra√ß√£o com a linguagem se d√° atrav√©s de um terminal, ou seja, n√£o √©\rembrulhada como no RStudio.\n\rGuia de Instala√ß√£o\rInstalar o VS Code em si √© f√°cil. Basta ir no\rsite e baixar a vers√£o para o seu sistema\roperacional. Depois de abrir o programa, voc√™ ver√° uma lista de extens√µes\rsugeridas e √© a√≠ que precisamos configurar o R.\nA extens√£o que procuramos √© identificada pelo c√≥digo ikuyadeu.r. Basta\rinstal√°-la e seguir as instru√ß√µes para o seu sistema operacional:\rWindows,\rMacOS ou\rLinux.\nAssumindo que voc√™ esteja no Windows, os pr√≥ximos passos s√£o os seguintes:\nInstalar, no R, o pacote languageserver:\r\rinstall.packages(\u0026quot;languageserver\u0026quot;)\rInstalar a vers√£o mais recente do\rPython. Se voc√™ tiver qualquer vers√£o a partir da 3, j√° √© o suficiente:\r\rInstalar o Radian, um console moderno\rpara o R, e descobir onde ele foi instalado. Executar o seguinte no prompt de\rcomando!\r\rpip install -U radian\rwhere.exe radian\rAbrir o arquivo de configura√ß√µes avan√ßadas do VS Code: aperte\rCtrl + Shift + P, digite ‚Äúopen settings‚Äù e clique em ‚ÄúOpen Settings (JSON)‚Äù.\rColar o texto a seguir no arquivo e salvar (substitua o caminho do rterm\rpela localiza√ß√£o do Radian):\r\r{\r\u0026quot;r.bracketedPaste\u0026quot;: true,\r\u0026quot;r.rterm.windows\u0026quot;: \u0026quot;C:\\\\Users\\\\user\\\\...\\\\radian.exe\u0026quot;\r}\rCaso voc√™ use o debugger, instalar a extens√£o\rR Debugger\re o pacote vscDebugger:\r\rremotes::install_github(\u0026quot;ManuelHentschel/vscDebugger\u0026quot;)\rHabilitar a renderiza√ß√£o de visualiza√ß√µes com o pacote httpgd:\r\rinstall.packages(\u0026quot;httpgd\u0026quot;)\rFinalmente, indicar o uso do httpgd para o VS Code:\r\rusethis::edit_r_profile()\r# Colar a linha abaixo no .Rprofile\roptions(vsc.use_httpgd = TRUE)\r\rUsando o VS Code\rSe voc√™ tiver configurado tudo corretamente, o VS Code estar√° pronto para uso.\rPara programar em R, basta abrir a pasta de um projeto e come√ßar! Assim que voc√™\rexecutar o primeiro comando R com Ctrl + Enter, um console R ir√° aparecer e\rvoc√™ pode seguir a vida normalmente.\nMinha principal sugest√£o para o seu futuro no VS Code √©: explore! Se algo te\rincomoda, a change de isso ser modific√°vel √© de praticamente 100%. Veja v√≠deos\rno YouTube de outras pessoas trabalhando com R no VS Code e procure extens√µes\rlegais na loja. Se algo parecer que est√° errado, se informe.\nA minha primeira semana com o VS Code foi de adapta√ß√£o, configurando tudo do\rjeito que eu mais gosto. A partir da√≠, eu nunca mais precisei mexer em nada,\rent√£o consigo atestar de que a plataforma √© robusta.\n\rB√¥nus: Configura√ß√£o Extra\rPara que voc√™ n√£o precise ter o mesmo trabalho que eu, aqui est√£o as minhas\rprincipais configura√ß√µes do VS Code. Veja se elas funcionam para o seu estilo\rde trabalho. Note apenas que a minha configura√ß√£o √© do Mac! Troque a tecla cmd\rpor ctrl de acordo.\nsettings.json:\n{\r\u0026quot;r.rterm.mac\u0026quot;: \u0026quot;/opt/homebrew/bin/radian\u0026quot;,\r\u0026quot;r.bracketedPaste\u0026quot;: true,\r\u0026quot;editor.minimap.enabled\u0026quot;: false,\r\u0026quot;workbench.startupEditor\u0026quot;: \u0026quot;none\u0026quot;,\r\u0026quot;redhat.telemetry.enabled\u0026quot;: false,\r\u0026quot;editor.tabSize\u0026quot;: 2,\r\u0026quot;security.workspace.trust.untrustedFiles\u0026quot;: \u0026quot;open\u0026quot;,\r\u0026quot;explorer.confirmDelete\u0026quot;: false,\r\u0026quot;files.defaultLanguage\u0026quot;: \u0026quot;r\u0026quot;,\r\u0026quot;terminal.integrated.defaultLocation\u0026quot;: \u0026quot;editor\u0026quot;,\r\u0026quot;diffEditor.ignoreTrimWhitespace\u0026quot;: false,\r\u0026quot;files.trimTrailingWhitespace\u0026quot;: true,\r\u0026quot;editor.rulers\u0026quot;: [\r80,\r120\r]\r}\rkeybindings.json:\n// Place your key bindings in this file to override the defaults\r[\r// RStudio key bindings\r{\r\u0026quot;key\u0026quot;: \u0026quot;cmd+shift+m\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;type\u0026quot;,\r\u0026quot;args\u0026quot;: { \u0026quot;text\u0026quot;: \u0026quot; %\u0026gt;%\u0026quot; },\r\u0026quot;when\u0026quot;: \u0026quot;editorTextFocus \u0026amp;\u0026amp; editorLangId == \u0026#39;r\u0026#39;\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;alt+-\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;type\u0026quot;,\r\u0026quot;args\u0026quot;: { \u0026quot;text\u0026quot;: \u0026quot; \u0026lt;- \u0026quot; },\r\u0026quot;when\u0026quot;: \u0026quot;editorTextFocus \u0026amp;\u0026amp; editorLangId == \u0026#39;r\u0026#39;\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+l\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;r.loadAll\u0026quot;\r},\r// Custom shortcuts\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+alt+cmd+left\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;workbench.action.moveEditorToPreviousGroup\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+alt+cmd+right\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;workbench.action.moveEditorToNextGroup\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+g\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;workbench.view.scm\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;workbench.scm.active\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+g\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;workbench.view.scm\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;workbench.scm.active \u0026amp;\u0026amp; !gitlens:disabled \u0026amp;\u0026amp; config.gitlens.keymap == \u0026#39;chorded\u0026#39;\u0026quot;\r},\r// Conflicts\r{\r\u0026quot;key\u0026quot;: \u0026quot;alt+cmd+left\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.action.terminal.focusPreviousPane\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;terminalFocus \u0026amp;\u0026amp; terminalProcessSupported\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;alt+cmd+right\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.action.terminal.focusNextPane\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;terminalFocus \u0026amp;\u0026amp; terminalProcessSupported\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+m\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.actions.view.problems\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;workbench.panel.markers.view.active\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+alt+cmd+left\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-cursorColumnSelectLeft\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;textInputFocus\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;ctrl+cmd+left\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.action.moveEditorToPreviousGroup\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;ctrl+cmd+right\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.action.moveEditorToNextGroup\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+alt+cmd+right\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-cursorColumnSelectRight\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;textInputFocus\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+g\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-editor.action.previousMatchFindAction\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;editorFocus\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+g\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.action.terminal.findPrevious\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;terminalFindFocused \u0026amp;\u0026amp; terminalProcessSupported || terminalFocus \u0026amp;\u0026amp; terminalProcessSupported\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;cmd+g\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-editor.action.nextMatchFindAction\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;editorFocus\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;cmd+g\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.action.terminal.findNext\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;terminalFindFocused \u0026amp;\u0026amp; terminalProcessSupported || terminalFocus \u0026amp;\u0026amp; terminalProcessSupported\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;ctrl+shift+g\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.view.scm\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;workbench.scm.active\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;ctrl+shift+g\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.view.scm\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;workbench.scm.active \u0026amp;\u0026amp; !gitlens:disabled \u0026amp;\u0026amp; config.gitlens.keymap == \u0026#39;chorded\u0026#39;\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+l\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-selectAllSearchEditorMatches\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;inSearchEditor\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+l\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-editor.action.selectHighlights\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;editorFocus\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;shift+cmd+l\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-addCursorsAtSearchResults\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;fileMatchOrMatchFocus \u0026amp;\u0026amp; searchViewletVisible\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;alt+cmd+right\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.action.terminal.focusNextPane\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;terminalFocus \u0026amp;\u0026amp; terminalHasBeenCreated || terminalFocus \u0026amp;\u0026amp; terminalProcessSupported\u0026quot;\r},\r{\r\u0026quot;key\u0026quot;: \u0026quot;alt+cmd+left\u0026quot;,\r\u0026quot;command\u0026quot;: \u0026quot;-workbench.action.terminal.focusPreviousPane\u0026quot;,\r\u0026quot;when\u0026quot;: \u0026quot;terminalFocus \u0026amp;\u0026amp; terminalHasBeenCreated || terminalFocus \u0026amp;\u0026amp; terminalProcessSupported\u0026quot;\r},\r]\rCaso voc√™ tenha problemas com o VS Code, mande uma mensagem no nosso\rf√≥rum para que eu possa ajudar.\n\r","permalink":"https://blog.curso-r.com/posts/2021-11-06-r-no-vscode/","tags":["rstudio","vscode"],"title":"Programando R no VS Code"},{"author":["William"],"categories":["conceitos"],"contents":"\r\rNo √∫ltimo post, falamos sobre as tr√™s pe√ßas fundamentais do fluxo de reatividade de um app: os valores reativos, as express√µes reativas e os observers, o foco deste post.\nOs observers s√£o o ponto final de um diagrama de reatividade de um aplicativo Shiny e, sem eles, o fluxo reativo n√£o acontece. As fun√ß√µes render*(), que geram os nossos outputs, s√£o o tipo mais comum de observer. Mas eles n√£o s√£o os √∫nicos.\nMuitas vezes queremos usar a reatividade para disparar a√ß√µes que n√£o est√£o ligadas a gera√ß√£o de outputs, como o registro de informa√ß√µes em bases de dados ou a atualiza√ß√£o de elementos da UI.\nNesses casos, podemos utilizar as fun√ß√µes observe() e oberveEvent(). Elas funcionam de maneira similar √†s fun√ß√µes reactive() e eventReactive(), mas em vez de criar express√µes reativas, elas s√£o observers.\nA fun√ß√£o observe()\rA fun√ß√£o observe({codigo}) monitora os valores e express√µes reativas que est√£o dentro dela e roda seu c√≥digo quando algum desses valores s√£o modificados.\nA diferen√ßa do observe() para a fun√ß√£o reactive() √© que a primeira n√£o gera express√µes reativas, servindo apenas para c√≥digos que t√™m efeitos colaterais.\nEssa fun√ß√£o √© muito utilizada com as fun√ß√µes da fam√≠lia update*(), que servem para atualizar valores de um input na UI.\nNa segunda caixa de sele√ß√£o do exemplo a seguir, queremos selecionar apenas os filmes do(a) diretor(a) que selecionamos na primeira. Veja que usamos o texto Carregando... como um placeholder para o segundo selectInput().\nui \u0026lt;- fluidPage(\rselectInput(\r\u0026quot;dir\u0026quot;,\r\u0026quot;Selecione um(a) diretor(a)\u0026quot;,\rchoices = sort(unique(imdb$diretor))\r),\rselectInput(\r\u0026quot;filme\u0026quot;,\r\u0026quot;Selecione um filme\u0026quot;,\rchoices = \u0026quot;Carregando...\u0026quot;\r)\r)\rNo server, atualizamos as escolhas da segunda caixa de sele√ß√£o com a fun√ß√£o updateSelectInput(). Veja que, como essa fun√ß√£o est√° dentro de um observe, esse c√≥digo ser√° rodado novamente sempre que o valor de input$dir mudar.\nserver \u0026lt;- function(input, output, session) {\robserve({\ropcoes \u0026lt;- imdb |\u0026gt; dplyr::filter(diretor == input$dir) |\u0026gt; dplyr::pull(titulo)\rupdateSelectInput(\rsession,\rinputId = \u0026quot;filme\u0026quot;,\rchoices = opcoes\r)\r})\r}\r\rA fun√ß√£o observeEvent()\rA fun√ß√£o observeEvent() funciona assim como a observe(), mas ela escuta apenas um valor ou express√£o reativa, que √© definido em seu primeiro argumento, assim como na fun√ß√£o eventReactive().\nEla √© muito utiliza para disparar a√ß√µes, como gravar informa√ß√µes em uma base de dados, a partir de bot√µes.\nNo exemplo a seguir, queremos salvar o e-mail de uma pessoa quando ela clicar no bot√£o ‚ÄúEnviar dados‚Äù. A fun√ß√£o observeEvent() roda o c√≥digo definido dentro dela quando o bot√£o √© clicado, salvando o e-mail em um arquivo de texto.\nui \u0026lt;- fluidPage(\rtextInput(\u0026quot;email\u0026quot;, \u0026quot;Informe seu e-mail\u0026quot;),\ractionButton(\u0026quot;enviar\u0026quot;, \u0026quot;Enviar dados\u0026quot;)\r)\rserver \u0026lt;- function(input, output, session) {\robserveEvent(input$enviar, {\rwrite(input$email, \u0026quot;emails.txt\u0026quot;, append = TRUE)\r})\r}\rAs fun√ß√µes observe() e oberveEvent() aumentam bastante o leque de op√ß√µes dos nossos aplicativos. Agora conseguimos criar fluxos reativos que n√£o est√£o associados necessariamente a um output. Nessa linha, no nosso pr√≥ximo post sobre reatividade, falaremos sobre como criar valores reativos que n√£o est√£o associados a inputs.\n√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2021-11-06-reatividade-pt2/","tags":["shiny","reatividade"],"title":"Entendendo a reatividade: observers"},{"author":["William"],"categories":["pacotes"],"contents":"\r\rGr√°ficos s√£o a alegria da festa em um aplicativo Shiny (ou dashboards em geral). Embora possamos usar tabelas, textos ou caixinhas coloridas com valores para comunicar nossos resultados, s√£o eles que geralmente chamam e prendem a aten√ß√£o de quem est√° utilizando o app.\nPara dar a aten√ß√£o que eles merecem, farei aqui uma s√©rie de posts para apresentar as principais alternativas para constru√ß√£o de gr√°ficos dentro do Shiny. Falaremos do plotly, do echarts4r, do highcharter, come√ßando neste post pelo nosso fiel companheiro: o ggplot2.\nO pacote ggplot2 √© uma ferramenta maravilhosa para produzirmos gr√°ficos no R. Quando entendemos a sua sintaxe, nos tornamos capazes de fazer uma variedade enorme de gr√°ficos e dar a eles a cara que quisermos.\nNada do que o pacote ggplot2 tem para oferecer se perde quando estamos construindo gr√°ficos dentro de um Shiny app. Pelo contr√°rio, ainda ganhamos um novo recurso!\nPara inserir um ggplot em um aplicativo Shiny, utilizamos a dupla de fun√ß√µes plotOutput()/renderPlot(). Essas fun√ß√µes est√£o preparadas para receber um objeto gerado pelas fun√ß√µes do ggplot e renderiz√°-lo em uma imagem, que ser√° inserida no HTML do app por meio da tag \u0026lt;img\u0026gt;. Veja um exemplo abaixo.\nlibrary(shiny)\rlibrary(ggplot2)\rcolunas \u0026lt;- names(mtcars)\rui \u0026lt;- fluidPage(\rtitlePanel(\u0026quot;Shiny app com um ggplot\u0026quot;),\rsidebarLayout(\rsidebarPanel(\rselectInput(\r\u0026quot;varX\u0026quot;,\rlabel = \u0026quot;Vari√°vel eixo X\u0026quot;,\rchoices = colunas\r),\rselectInput(\r\u0026quot;varY\u0026quot;,\rlabel = \u0026quot;Vari√°vel eixo Y\u0026quot;,\rchoices = colunas,\rselected = colunas[6]\r)\r),\rmainPanel(\rplotOutput(\u0026quot;grafico\u0026quot;)\r)\r)\r)\rserver \u0026lt;- function(input, output, session) {\routput$grafico \u0026lt;- renderPlot({\rggplot(mtcars, aes(x = .data[[input$varX]], y = .data[[input$varY]])) +\rgeom_point()\r})\r}\rshinyApp(ui, server)\r\rFigura 1: App com dois inputs especificando as vari√°veis do eixo x e y de um ggplot .\r\rO objeto gerado pelo ggplot √© uma lista com classe gg e ggplot, que cont√©m todas as informa√ß√µes necess√°rias para o R desenhar o gr√°fico.\np \u0026lt;- ggplot(mtcars, aes(x = wt, y = mpg)) +\rgeom_point()\rclass(p)\r## [1] \u0026quot;gg\u0026quot; \u0026quot;ggplot\u0026quot;\rnames(p)\r## [1] \u0026quot;data\u0026quot; \u0026quot;layers\u0026quot; \u0026quot;scales\u0026quot; \u0026quot;mapping\u0026quot; \u0026quot;theme\u0026quot; ## [6] \u0026quot;coordinates\u0026quot; \u0026quot;facet\u0026quot; \u0026quot;plot_env\u0026quot; \u0026quot;labels\u0026quot;\rRepare que, se salv√°ssemos o ggplot em um arquivo (.png por exemplo), poder√≠amos simplesmente usar a dupla imageOutput()/renderImage() para inserir um gr√°fico no nosso app, j√° que essas fun√ß√µes tamb√©m criam uma tag \u0026lt;img\u0026gt;, mas a partir de um arquivo de imagem local.\nMas n√£o precisar salvar o ggplot em um arquivo n√£o √© a √∫nica vantagem de utilizarmos as fun√ß√µes plotOutput()/renderPlot(). Essas fun√ß√µes inserem um objeto intermedi√°rio no diagrama de reatividade do app: um plotObj. Esse objeto √© justamente a lista gerada pelas fun√ß√µes que utilizamos na constru√ß√£o do gr√°fico e que s√≥ √© recalculado quando um dos inputs existentes no c√≥digo da fun√ß√£o renderPlot() muda.\nLeia mais: Diagramas de reatividade no shiny (reactlog)\nJ√° o gr√°fico renderizado depende n√£o apenas desse plotObj, mas tamb√©m do comprimento e altura da janela do navegador de quem estiver utilizando o app. Dessa maneira, o gr√°fico √© renderizado n√£o apenas quando o plotObj muda, mas tamb√©m quando o espa√ßo dispon√≠vel para a tag \u0026lt;img\u0026gt; na tela tamb√©m muda. Nesse segundo caso, o R gera o gr√°fico novamente, redesenhando seus elementos para a nova propor√ß√£o de comprimento e altura. E o melhor √© que ele faz isso sem precisar rodar o c√≥digo da fun√ß√£o renderPlot() novamente, pois tudo o que ele precisa j√° est√° salvo no plotObj.\n\rFigura 2: Gr√°fico sendo redimensionado conforme diminu√≠mos o comprimento da tela.\r\rSem esse recurso, nossos gr√°ficos seriam apenas imagens sendo esticadas e achatadas, o que provavelmente os deixaria pixelados. Ao contr√°rio do que acontece no R Markdown, em um relat√≥rio HTML ou em um flexdashboard por exemplo, no Shiny n√£o precisamos nos preocupar muito com as dimens√µes de um ggplot. Ele ser√° sempre automaticamente otimizado para o espa√ßo dispon√≠vel na tela.\nMas nem tudo s√£o flores‚Ä¶ Por melhor que consigamos mexer no visual do nosso ggplot utilizando a fun√ß√£o theme(), no fim do dia ele continuar√° sendo apenas uma imagem no nosso app. Isso significa que n√£o ser√° poss√≠vel atribuir a ele qualquer comportamento interativo, como tooltips, drildown ou a√ß√µes geradas por cliques no gr√°fico. Para isso, precisaremos utilizar bibliotecas gr√°ficas pr√≥prias para a Web, que geralmente utilizam JavaScript para construir os gr√°ficos e gerar interatividade.\nNo pr√≥ximo post, falaremos da biblioteca e pacote plotly, que permite transformamos nossos ggplots em gr√°ficos interativos.\n√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\rAt√© a pr√≥xima!\n","permalink":"https://blog.curso-r.com/posts/2021-10-21-shiny-ggplot2/","tags":["shiny","gr√°ficos","echarts"],"title":"Gr√°ficos no Shiny: ggplot2"},{"author":["William"],"categories":["conceitos"],"contents":"\r\rQuando escrevemos c√≥digo R, dois paradigmas est√£o sempre presentes:\r- podemos avaliar uma linha de c√≥digo assim que a escrevermos; e\n\rse decidirmos rodar todo o script de uma vez, as linhas de c√≥digo ser√£o avaliadas sequencialmente.\r\rIsso faz com que as nossas tarefas de an√°lise de dados geralmente virem scripts sequenciais, cujo c√≥digo n√£o pode ser executado fora de ordem.\nO c√≥digo abaixo, que executa a corriqueira tarefa de importar, manipular e visualizar uma base, mostra um exemplo disso. Constru√≠mos o c√≥digo rodando linha a linha, para testar se estamos seguindo pelo caminho certo. Ao final, podemos rodar tudo de uma vez para obter o resultado desejado (o gr√°fico). Se o c√≥digo for rodado fora de ordem, nada vai funcionar.\ntab_starwars \u0026lt;- dplyr::starwars\rtab_grafico \u0026lt;- tab_starwars |\u0026gt;\rtidyr::unnest(films) |\u0026gt; tidyr::drop_na(species) |\u0026gt; dplyr::group_by(films) |\u0026gt;\rdplyr::summarise(total_especies = dplyr::n_distinct(species)) |\u0026gt; dplyr::mutate(\rfilms = forcats::fct_reorder(films, total_especies)\r)\rtab_grafico |\u0026gt; ggplot2::ggplot(ggplot2::aes(y = films, x = total_especies)) +\rggplot2::geom_col() +\rggplot2::theme_minimal() +\rggplot2::labs(x = \u0026quot;Total de esp√©cies\u0026quot;, y = \u0026quot;Filme\u0026quot;)\rA reatividade √© um outro paradigma de programa√ß√£o. Com ela, n√£o constru√≠mos c√≥digos que ser√£o rodados interativamente ou sequencialmente. A ideia da programa√ß√£o reativa √© especificar um fluxo de reatividade, isto √©, um diagrama de depend√™ncias que ser√° utilizado para definir o que deve ser executado e quando. No contexto do Shiny, o fluxo de reatividade √© quem decide quais outputs devem ser recalculados quando um input muda e pode ser composto por 3 tipos de estruturas: os valores reativos, as express√µes reativas e os observers.\nOs valores reativos s√£o a origem do fluxo reativo. Eles guardam as informa√ß√µes que v√™m da UI (a partir dos inputs) e disparam o sinal de alerta sempre que essas informa√ß√µes mudam. Os valores reativos mais comuns s√£o aqueles dentro da lista input.\nEsse sinal de alerta √© um aviso dizendo que todos os outputs que dependem desse valor reativo precisam ser recalculados. Quem recebe esse sinal s√£o os observers, isto √©, as estruturas dentro do Shiny que guardam o c√≥digo de cada output. Eles s√£o o ponto final do fluxo de reatividade. Os observers mais comuns s√£o as fun√ß√µes render*().\nMuitas vezes, um aplicativo shiny precisa de passos intermedi√°rios, entre o input de origem e o output final. Isto √©, precisamos de uma estrutura que receba um valor reativo, fa√ßa alguma conta e devolva como resultado um valor tamb√©m reativo, que ser√° utilizado posteriormente em um observer. Essas estruturas s√£o as express√µes reativas.\nImagine um app que gere uma amostra de n√∫meros aleat√≥rios entre 1 e 10 e que o tamanho dessa amostra √© definido por um input. Al√©m disso, imagine que esse app tamb√©m indique em texto qual foi o n√∫mero mais sorteado. A figura a seguir mostra uma implementa√ß√£o desse app.\nRepare no c√≥digo do app, apresentado a seguir, que a cria√ß√£o da amostra n√£o poderia ter sido feita diretamente dentro das fun√ß√µes renderPlot() e renderText(), pois gerariam amostras diferentes1. Por outro lado, a gera√ß√£o da amostra precisa estar dentro de um contexto reativo, pois ela utiliza um valor reativo (input$num), o que tira da mesa a proposta de fazer isso diretamente dentro da fun√ß√£o server.\nlibrary(shiny)\rui \u0026lt;- fluidPage(\r\u0026quot;Histograma da distribui√ß√£o normal\u0026quot;,\rsliderInput(\rinputId = \u0026quot;num\u0026quot;,\rlabel = \u0026quot;Selecione o tamanho da amostra\u0026quot;,\rmin = 1,\rmax = 1000,\rvalue = 100\r),\rplotOutput(outputId = \u0026quot;hist\u0026quot;),\rtextOutput(outputId = \u0026quot;media\u0026quot;)\r)\rserver \u0026lt;- function(input, output, session) {\ramostra \u0026lt;- reactive({\rsample(1:10, input$num, replace = TRUE)\r})\routput$hist \u0026lt;- renderPlot({\rbarplot(table(amostra()))\r})\routput$media \u0026lt;- renderText({\rcontagem \u0026lt;- sort(table(amostra()), decreasing = TRUE)\rmais_frequente \u0026lt;- names(contagem[1])\rglue::glue(\u0026quot;O n√∫mero mais sorteado foi {mais_frequente}.\u0026quot;)\r})\r}\rshinyApp(ui, server)\rA solu√ß√£o nesse caso foi utilizar a fun√ß√£o reactive(). Essa fun√ß√£o cria a express√£o reativa amostra, que √© utilizada dentro das fun√ß√µes renderPlot() e renderText() para obtermos a amostra sorteada. Note que, para retornar o valor de uma express√£o reativa, devemos cham√°-la como se fosse uma fun√ß√£o, abrindo e fechando par√™nteses ap√≥s o nome: amostra().\nNesse exemplo, o input$num √© um valor reativo, a amostra() √© uma express√£o reativa e as fun√ß√µes renderPlot() e renderText() s√£o observers. O fluxo reativo se inicia com um mudan√ßa no valor do input$num e termina com a recria√ß√£o do gr√°fico e do texto. O valor reativo, quando alterado, avisa √† express√£o reativa amostra que seu valor est√° desatualizado e, por sua vez, a amostra avisa aos observers renderPlot() e renderText() que seu valor est√° desatualizado. Assim, tanto a express√£o reativa quanto os observers s√£o recalculados e seus resultados enviado de volta para a UI.\nSe esses conceitos apresentados at√© agora est√£o muito abstratos, pense em uma f√°brica de brinquedos. A f√°brica utiliza algumas mat√©rias-primas, como madeira, pl√°stico e tecido, para fabricar os brinquetos. Nela, existem algumas m√°quinas que recebem a mat√©ria-prima e a transformam em partes dos brinquedos, assim como m√°quinas que recebem tanto mat√©rias-prima quanto essas partes pr√©-fabricadas e montam o brinquedo.\nNessa met√°fora, a mat√©ria-prima representa os valores reativos (cada material pode ser visto como um input), as m√°quinas que produzem as partes s√£o as express√µes reativas e a m√°quina que monta o brinquedo s√£o os observers.\nNos pr√≥ximos posts, falaremos com mais detalhes sobre essas estruturas. Daremos exemplos de valores reativos que n√£o s√£o inputs, observers que n√£o s√£o outputs e express√µes reativas que n√£o geram um fluxo de reatividade.\n√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\rClaro que poder√≠amos usar a fun√ß√£o set.seed() para garantir que as amostras fossem as mesmas, mas imagine que n√£o queremos escolher uma semente para a gera√ß√£o dos dados ou que, em algum outro contexto, o processo de amostragem fosse demorado e n√£o queremos faz√™-lo duas vezes.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-09-12-reatividade-pt1/","tags":["shiny","reatividade"],"title":"Entendendo a reatividade: fundamentos"},{"author":["Fernando"],"categories":["an√°lises","conceitos"],"contents":"\r\rNo nosso trabalho como Cientistas de Dados √© muito comum procurar semelhan√ßas e diferen√ßas entre vari√°veis de bancos de dados. Existem muitos m√©todos para procurar por esse tipo de coisa e normalmente eles trabalham com a no√ß√£o de depend√™ncia estat√≠stica e suas m√©tricas ou com a no√ß√£o de redu√ß√£o de dimensionalidade (a capacidade de representar muitas vari√°veis por um conjunto reduzido). Nessa primeira estrat√©gia, as matrizes de correla√ß√£o s√£o as t√©cnicas mais comuns e difundidas. No post de hoje, vamos explorar a fun√ß√£o ggcorr do pacote GGally que nos ajuda a visualizar a matriz de correla√ß√£o.\nQuando estamos trabalhando com dados cont√≠nuos, isso √©: quando as nossas vari√°veis s√£o todas num√©ricas (ou no m√≠nimo ordenadas), √© poss√≠vel utilizar os m√©todos que est√£o na fun√ß√£o ggcorr do pacote GGally. Essa fun√ß√£o constr√≥i um mapa de calor que nos mostra quais pares de vari√°veis da nossa tabela possuem maior correla√ß√£o. Essa correla√ß√£o por sua vez pode ser medida utilizando tr√™s m√©tricas: o coeficiente de kendall e as correla√ß√µes de pearson e spearman. Veja uma aplica√ß√£o desse m√©todo √† base de dados socioecon√¥micos do Gapminder. A√≠ √© poss√≠vel ver que a expectativa de vida e o pib s√£o bastante correlacionados, mas o mesmo n√£o acontece com o PIB e a popula√ß√£o, por exemplo.\nlibrary(tidyverse)\rdados::dados_gapminder |\u0026gt; #select(-pais, -continente) |\u0026gt; GGally::ggcorr(method = c(\u0026#39;all.obs\u0026#39;, \u0026#39;spearman\u0026#39;))\rPodemos tamb√©m construir matrizes um pouco maiores e obter resultados parecidos:\nlibrary(tidyverse)\rdados::mtcarros |\u0026gt; #select(-pais, -continente) |\u0026gt; GGally::ggcorr(method = c(\u0026#39;all.obs\u0026#39;, \u0026#39;spearman\u0026#39;))\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre esse assunto, temos alguns cursos que tocam os temas deste post. D√™ uma olhada nos nossos cursos de Regress√£o Linear ou Machine Learning e aproveite!\nSe voc√™ quiser aprender um pouco mais sobre manipula√ß√£o de dados com R, d√™ uma olhada no nosso curso R para Ci√™ncia de Dados I e aproveite!\nCaso voc√™ tenha d√∫vidas entre em contato com a gente pelos coment√°rios aqui embaixo, pelo nosso Discourse ou pelo e-mail contato@curso-r.com.\n\r","permalink":"https://blog.curso-r.com/posts/2021-09-03-matrizes-correlacao/","tags":["base de dados"],"title":"Matrizes de correla√ß√£o com o R usando o pacote GGally"},{"author":["William"],"categories":["divulga√ß√£o"],"contents":"\r\rA useR √© atualmente o maior evento de R do mundo. A edi√ß√£o 2021 aconteceu entre os dias 5 e 9 de julho, no modelo online, e contou com diversas apresenta√ß√µes, tutoriais, short talks e integra√ß√£o da comunidade.\nNeste post, vou listar o que rolou sobre Shiny na edi√ß√£o desse ano. Todas as palestras est√£o dispon√≠veis no YouTube.\nEm resumo, o tema subjacente das palestras √© ‚ÄúOlha como o Shiny √© incr√≠vel!‚Äù, o que √© muito legal para aumentar o nosso repert√≥rio de argumentos na hora de levar o Shiny para dentro das empresas e universidades.\nA minha preferida foi a ‚ÄúUnit Testing Shiny App Reactivity‚Äù, porque testes no Shiny s√£o uma coisa que ainda n√£o fa√ßo e queria bastante aprender. A palestra me motivou a continuar estudando o assunto.\nAll-in-one smartphone-based system for quantitative analysis of point-of-care diagnostics\rTema: showcase\nN√≠vel: iniciante\nQuem: Weronika Schary e Filip Paskali\nDescri√ß√£o: apresenta√ß√£o de um aplicativo Shiny que auxilia na detec√ß√£o de doen√ßas a partir de an√°lises de imagens.\nLink: https://youtu.be/olmKEqBpWpE?t=130\n\rUnit Testing Shiny App Reactivity\rTema: testes para aplicativos Shiny\nN√≠vel: intermedi√°rio\nQuem: Jonathan Sidi\nDescri√ß√£o: apresenta√ß√£o do pacote {reactor}, que tem como objetivo diagnosticar problemas de reatividade em um Shiny app.\nLink: https://youtu.be/olmKEqBpWpE?t=1349\n\rShinyQuickStarter: Build Shiny apps interactively with Drag \u0026amp; Drop\rTema: desenvolvimento de Shiny apps\nN√≠vel: iniciante\nQuem: Leon Binder\nDescri√ß√£o: apresenta√ß√£o de um addin para o RStudio que permite a constru√ß√£o de aplicativos Shiny (e m√≥dulos) a partir de uma interface arraste e solte.\nLink: https://youtu.be/olmKEqBpWpE?t=2407\n\rThe ShinyProxy Good News Show\rTema: deploy\nN√≠vel: intermedi√°rio\nQuem: Tobia De Koninck\nDescri√ß√£o: apresenta√ß√£o do ShinyProxy, solu√ß√£o de c√≥digo aberto para empresas gerenciarem o deploy de aplicativos Shiny.\nLink: https://youtu.be/olmKEqBpWpE?t=3676\n\rShiny PoC to Production Application in 8 steps\rTema: desenvolvimento de Shiny apps\nN√≠vel: intermedi√°rio\nQuem: Marcin Dubel\nDescri√ß√£o: apresenta√ß√£o de um workflow para desenvolvimento de aplicativos Shiny no contexto empresarial.\nLink: https://youtu.be/GMMGBlyl_ok?t=52\n\rStructure your app: introduction to Shiny modules\rTema: desenvolvimento de Shiny apps\nN√≠vel: iniciante\nQuem: Jonas Hagenberg\nDescri√ß√£o: motiva√ß√£o e introdu√ß√£o ao uso de m√≥dulos no Shiny.\nLink: https://youtu.be/oOYaHsPXLvs\n\rshiny.fluent and shiny.react: Build Beautiful Shiny Apps Using Microsoft‚Äôs Fluent UI\rTema: desenvolvimento de Shiny apps\nN√≠vel: intermedi√°rio\nQuem: Marek Rogala\nDescri√ß√£o: ensina a utilizar os pacotes {shiny.fluent} e {shiny.react} para construir UIs utilizando o framework Microsoft Fluent UI e a biblioteca JavaScript React.\nLink: https://youtu.be/LXpPNfHKyrU\n√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2021-07-01-shiny-user2021/","tags":["shiny","useR"],"title":"Shiny na useR 2021"},{"author":["Caio"],"categories":["tutoriais"],"contents":"\r\rUma das funcionalidades mais interessantes do R √© a possibilidade de estender a\rlinguagem para dom√≠nios espec√≠ficos. A\rnon-standard evaluation\rgarante que at√© modifica√ß√µes √† estrutura fundamental do R podem ser realizadas\rsem problema. Hoje vamos falar de um assunto que muita gente quer aprender,\rmas que pouca gente entende de verdade: fun√ß√µes an√¥nimas.\nSe voc√™ n√£o souber o que √© uma fun√ß√£o an√¥nima, pode ser que voc√™ conhe√ßa esse\rconceito por outro nome. Tamb√©m chamada de ‚Äúfun√ß√£o lambda‚Äù, ‚Äúnota√ß√£o de f√≥rmula‚Äù\rou ‚Äúnota√ß√£o de til‚Äù, ela aparece principalmente em programas que usam o {purrr}\rapesar de n√£o serem exclusividade desse pacote. Resumindo, se voc√™ j√° viu algo\rdo tipo ~.x e n√£o entendeu do que se tratava, este post √© para voc√™.\nIntrodu√ß√£o\rFun√ß√µes an√¥nimas s√£o, essencialmente, um jeito de simplificar a cria√ß√£o de\rfun√ß√µes pequenas. Em poucas palavras, o nosso objetivo √© n√£o ter que declarar\ruma fun√ß√£o nova inteira com function() { ... } para poder us√°-la dentro de\rum programa.\nO exemplo que ser√° utilizado na explica√ß√£o a seguir ser√° a fun√ß√£o conta_na()\rque (n√£o surpreendentemente) conta o n√∫mero de NAs em um vetor. Vamos us√°-la\rdentro de um map() para que ela seja aplicada a todas as colunas de um data\rframe. Sendo assim, partiremos da forma mais verborr√°gica poss√≠vel desse c√≥digo\re tentaremos chegar, intuitivamente, nas fun√ß√µes an√¥nimas.\nUma ressalva importante √© que a nota√ß√£o explicada aqui s√≥ funciona dentro do\r{tidyverse}! No final do texto ser√° apresentada uma alternativa que funciona\rfora desse contexto, mas, por enquanto, a nota√ß√£o abaixo s√≥ pode aparecer nos\rargumentos .f, .fn e .fns utilizados dentro do {tidyverse}.\n\rConceito\rVamos imaginar uma fun√ß√£o conta_na() que conta o n√∫mero de NAs em uma coluna\rde um data frame. Para aplic√°-la a todas as colunas do data frame, podemos, por\rexemplo, utilizar a fun√ß√£o map() do pacote {purrr} como no exemplo abaixo:\nconta_na \u0026lt;- function(vetor) {\rsum(is.na(vetor))\r}\rmap_dbl(starwars, conta_na)\r#\u0026gt; name height mass hair_color skin_color eye_color birth_year #\u0026gt; 0 6 28 5 0 0 44 #\u0026gt; sex gender homeworld species films vehicles starships #\u0026gt; 4 4 10 4 0 0 0\rNo R, quando temos uma fun√ß√£o simples de uma linha, √© perfeitamente poss√≠vel\rn√£o colocar o seu corpo em uma linha separada. Veja como o c√≥digo j√° fica um\rpouco mais compacto (sa√≠da omitida daqui em diante):\nconta_na \u0026lt;- function(vetor) { sum(is.na(vetor)) }\rmap_dbl(starwars, conta_na)\rAgora, se temos uma fun√ß√£o que cabe inteira em uma linha, o R nos permite tamb√©m\romitir as chaves: por exemplo, m if-else pode ser escrito\rif (cond) resp1 else resp2 se as respostas n√£o tiverem mais de uma linha. No\rnosso caso, vamos reduzir ainda mais a conta_na():\nconta_na \u0026lt;- function(vetor) sum(is.na(vetor))\rmap_dbl(starwars, conta_na)\rO pr√≥ximo passo seria encurtar o nome do argumento da fun√ß√£o, utilizando algo\rmais gen√©rico. Poucas pessoas sabem, mas o R permite nomes come√ßando com .!\rPor motivos que ficar√£o claros a seguir, vamos escolher .x para ser o nome do\rnosso argumento:\nconta_na \u0026lt;- function(.x) sum(is.na(.x))\rmap_dbl(starwars, conta_na)\rAgora vem a grande sacada. Tudo que fizemos at√© agora funciona no R como um\rtodo, mas, se atendermos algumas condi√ß√µes extras, podemos reduzir ainda mais\ressa fun√ß√£o.\nVamos l√°: se a fun√ß√£o i) tiver apenas uma linha, ii) tiver apenas 1 argumento,\riii) tiver .x como seu √∫nico argumento .x e iv) estiver sendo utilizada como\rargumento de uma fun√ß√£o do {tidyverse}, ent√£o podemos omitir o function(.x)\r(j√° que isso √© informa√ß√£o redundante dadas as condi√ß√µes) e troc√°-lo por um\rsingelo ~:\nconta_na \u0026lt;- ~ sum(is.na(.x))\rmap_dbl(starwars, conta_na)\rO √∫ltimo passo √© o motivo de chamarmos essa nota√ß√£o de ‚Äúfun√ß√£o an√¥nima‚Äù. Dado\rque nossa fun√ß√£o j√° √© t√£o pequena e utilizamos ela em apenas um lugar, por que\rprecisamos dar um nome para ela? √â mais f√°cil declar√°-la diretamente dentro do\rmap() sem um nome, ou seja, ‚Äúanonimamente‚Äù:\nmap_dbl(starwars, ~ sum(is.na(.x)))\r#\u0026gt; name height mass hair_color skin_color eye_color birth_year #\u0026gt; 0 6 28 5 0 0 44 #\u0026gt; sex gender homeworld species films vehicles starships #\u0026gt; 4 4 10 4 0 0 0\rPronto, agora voc√™ sabe o que significa uma fun√ß√£o do tipo ~.x. Para treinar,\rtente fazer o processo reverso como no caso abaixo:\n# Fra√ß√£o de valores distintos dentre todos\rmap_dbl(starwars, ~ length(unique(.x)) / length(.x))\r# Desanonimizar\rfrac_distintos \u0026lt;- ~ length(unique(.x)) / length(.x)\rmap_dbl(starwars, frac_distintos)\r# Remover a nota√ß√£o de til (n√£o √© mais necess√°rio mexer no map())\rfrac_distintos \u0026lt;- function(.x) length(unique(.x)) / length(.x)\r# Utilizar um nome melhor para o argumento\rfrac_distintos \u0026lt;- function(vec) length(unique(vec)) / length(vec)\r# Recolocar as chaves\rfrac_distintos \u0026lt;- function(vec) { length(unique(vec)) / length(vec) }\r# Identar o corpo da fun√ß√£o\rfrac_distintos \u0026lt;- function(vec) {\rlength(unique(vec)) / length(vec)\r}\rAgora fica bem mais f√°cil de entender o que faz o map() l√° do come√ßo.\n\rFuturo\rA pergunta √≥bvia agora √©: existe um jeito de fazer algo assim fora do\r{tidyverse}? A resposta √© sim e n√£o.\nDesde o\rR 4.1,\ro R introduziu a sua pr√≥pria nota√ß√£o an√¥nima. Ela funciona de maneira muito\rsimilar ao ~, com a diferen√ßa de que voc√™ precisa dizer o nome do seu\rargumento. Abaixo deixo voc√™s com o processo de simplifica√ß√£o da fun√ß√£o\rconta_na() para a sua vers√£o an√¥nima que pode ser utilizada em qualquer\rlugar e n√£o s√≥ no {tidyverse}:\n# Conta o n√∫mero de NAs em um vetor\rconta_na \u0026lt;- function(vetor) {\rsum(is.na(vetor))\r}\r# Usar uma linha s√≥\rconta_na \u0026lt;- function(vetor) { sum(is.na(vetor)) }\r# Sem necessidade de usar chaves\rconta_na \u0026lt;- function(vetor) sum(is.na(vetor))\r# Se a fun√ß√£o tem uma linha, podemos usar a nova nota√ß√£o\rconta_na \u0026lt;- \\(vetor) sum(is.na(vetor))\r# O nome do argumento pode ser qualquer coisa, n√£o importa\rconta_na \u0026lt;- \\(v) sum(is.na(v))\r# Anonimizar\rmap_dbl(starwars, \\(v) sum(is.na(v)))\r#\u0026gt; name height mass hair_color skin_color eye_color birth_year #\u0026gt; 0 6 28 5 0 0 44 #\u0026gt; sex gender homeworld species films vehicles starships #\u0026gt; 4 4 10 4 0 0 0\rQuase t√£o bom quanto a nota√ß√£o de til!\n\r","permalink":"https://blog.curso-r.com/posts/2021-08-16-entendendo-anonimas/","tags":["tidyverse","purrr"],"title":"Entendendo Fun√ß√µes An√¥nimas de Uma Vez por Todas"},{"author":["Athos"],"categories":["tutoriais"],"contents":"\r\rRequerimento\rO seguinte passo a passo sup√µe conhecimento pr√©vio de git e github com RStudio.\rA se√ß√£o de Git/Github do livro Zen do R √© uma √≥tima refer√™ncia para aprender a usar o git e github no R.\n\rCriar o blog: passo-a-Passo\rEsse passo-a-passo √© baseado no doc do distill da RStudio.\nRode install.packages(c(\"usethis\", \"distill\")) para instalar os pacotes {usethis} e {distill}.\rRode usethis::create_package(\"blogDoAthos\") para criar novo projeto do RStudio.\rRode usethis::use_git() para iniciar o git no seu projeto.\rRode usethis::use_github(protocol = \"ssh\" para criar um reposit√≥rio no seu github.\rV√° ao reposit√≥rio do seu github, clique em settings e des√ßa at√© achar a configura√ß√£o do Github Pages. Escolha\r\r\rFigura 1: ghpages\r\rRode file.create(\".nojekyll\") s√≥ pra evitar uns problemas com o ghpages.\rRode distill::create_blog(\".\", \"Blog do Athos\") para criar seu blog.\rCommitar e pushar para o github.\rIr para o link que o Github Pages mostrou na hora da configura√ß√£o.\r\r\rFigura 2: ghpages\r\r\rCriar um post: passo-a-passo\rRode distill::create_post(\"T√≠tulo do Meu Primeiro Post\") para criar um Rmd novo.\rCom o Rmd do seu post aberto na sua frente, pressione CTRL+SHIF+K para renderizar (e gerar o HTML).\rCommitar e pushar para o github para publicar o seu post no ar.\rEditar o seu Rmd e depois repetir os itens 2 e 3 para subir a vers√£o editada/atualizada do seu post.\r\r\rExemplos de distill de R para se inspirar e explorar o github\r\rTrabalhos de Regress√£o Linear com R da Curso-R\rBlog da ABJ\rSite do pr√≥prio Distill para R Markdown\rRStudio AI Blog\rCi√™ncia de Dados com R e PostgreSQL do JJ - Jos√© Jesus do R\rBlog da Beatriz Milz\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-08-16-distill_ghpages/","tags":["blog","github pages","distill"],"title":"Github Pages e Distill: Blog no Ar em 13 Passos"},{"author":["Caio"],"categories":["pacotes"],"contents":"\r\rdroll [Ààdr≈çl] (adj.). 1. (Ing.) Divertido, especialmente de forma\rincomum.\ndroll √© um pacote R para parsear a nota√ß√£o usada para descrever dados, analisar\rrolagens, calcular probabilidades de sucesso e gerar gr√°ficos das distribui√ß√µes\rdos resultados. Ele pode ajudar DMs detalhistas a preparar encontros (in)justos\rcom anteced√™ncia ou decidir a DC apropriada para um teste na hora. Jogadores\rtamb√©m podem usar o droll para determinar a melhor estrat√©gia quando em uma\rsitua√ß√£o dif√≠cil.\nEle foi feito para ser uma alternativa muito leve (s√≥ uma depend√™ncia\robrigat√≥ria), muito r√°pida (menos de 0,4s para calcular a distribui√ß√£o completa\rde 40d6) e muito precisa (representa√ß√£o interna simb√≥lica cortesia do Ryacas)\rpara o anydice no R.\nInstala√ß√£o\rInstale a vers√£o est√°vel do CRAN com:\ninstall.packages(\u0026quot;droll\u0026quot;)\rOu instale a vers√£o em desenvolvimento do\rGitHub com:\n# install.packages(\u0026quot;remotes\u0026quot;)\rremotes::install_github(\u0026quot;curso-r/droll\u0026quot;)\r\rUso\rO que voc√™ procura no droll? Voc√™ √© um usu√°rio n√≠vel 1, um programador\rexperiente n√≠vel 10, ou um estat√≠stico divino n√≠vel 20? Escolha sua classe:\nüñçÔ∏è Usu√°rio\rO uso mais b√°sico do droll envolve simplesmente rolar dados. Voc√™ pode criar\rqualquer dado que quiser com a fun√ß√£o d() e escrever qualquer express√£o que\renvolva aquele dado. Note que, se voc√™ quiser rolar NdX, voc√™ deveria escrever\rN * dX.\n# Criar alguns dados\rd20 \u0026lt;- d(20)\rd6 \u0026lt;- d(6)\rd4 \u0026lt;- d(4)\r# Rolar um teste enquanto aben√ßoado\r(d20 + 8) + d4\r#\u0026gt; [1] 19\r# Rolar o dano!!\r8 * d6\r#\u0026gt; [1] 33\r# Rolar um teste de resist√™ncia de destreza com desvantagem\rif (min(d20, d20) + 4 \u0026lt; 18) {\rprint(\u0026quot;Dano completo!\u0026quot;)\r} else {\rprint(\u0026quot;Metade do dano.\u0026quot;)\r}\r#\u0026gt; [1] \u0026quot;Dano completo!\u0026quot;\rSimples e f√°cil, certo? Se voc√™ √© um DM, voc√™ tamb√©m pode querer usar duas\rfun√ß√µes: check_prob() e check_dc(). Elas permitem que voc√™,\rrespectivamente, calcule a probabilidade de passar (ou falhar) em um teste e\rencontrar a DC necess√°ria para que um teste tenha uma certa probabilidade de\rsucesso (ou erro). Voc√™ n√£o precisa nem criar os dados que voc√™ vai usar dentro\rdelas!\n# Qual √© a probabilidade que esse jogador passe em um teste de DC 15?\rcheck_prob(d20 + 8, 15)\r#\u0026gt; [1] 0.7\r# Qual deveria ser a DC para que esse jogador tenha 50% de chance de sucesso?\rcheck_dc(d20 + 8, 0.5)\r#\u0026gt; [1] 19\r# Qual √© a probabilidade desse jogador falhar em um teste de DC 10?\rcheck_prob(d20 + 8, 10, success = FALSE)\r#\u0026gt; [1] 0.05\r# Qual deveria ser a DC para que esse jogador tenha 90% de chance de falha?\rcheck_dc(d20 + 8, 0.9, success = FALSE)\r#\u0026gt; [1] 27\rN√£o h√° fun√ß√µes do tipo attack_*() porque as mec√¢nicas de ataques e testes s√£o\ras mesmas, ou seja, sucesso equivale a rolar um valor maior ou igual a um certo\rpatamar. Essas fun√ß√µes podem, portanto, ser usadas para ataques tamb√©m!\n\rüó°Ô∏è Programador\rSe voc√™ j√° est√° acostumado com a nota√ß√£o d/p/q/r do R, pode ser que voc√™ queira\rmais detalhes sobre a distribui√ß√£o de uma rolagem. √â para isso que as fun√ß√µes\rdroll(), proll(), qroll(), e rroll() existem! Elas s√£o, respectivamente,\ra densidade, a fun√ß√£o de distribui√ß√£o, a fun√ß√£o de quantil, e a gera√ß√£o\raleat√≥ria da distribui√ß√£o definida por uma express√£o de rolagem.\n# P[d20 + 8 = 12]\rdroll(12, d20 + 8)\r#\u0026gt; [1] 0.05\r# P[d20 + 8 \u0026lt;= 12]\rproll(12, d20 + 8)\r#\u0026gt; [1] 0.2\r# inf{x: P[d20 + 8 \u0026lt;= x] \u0026gt;= 0.5}\rqroll(0.5, d20 + 8)\r#\u0026gt; [1] 18\r# Amostrar 3 vezes de d20 + 8 rroll(3, d20 + 8)\r#\u0026gt; [1] 27 12 24\rQuando voc√™ aprender a usar essas quatro fun√ß√µes, voc√™ pode olhar as suas\rvaria√ß√µes plot_*() delas. Elas geram gr√°ficos (usando o ggplot2 se ele estiver\rdispon√≠vel) correspondendo √†s distribui√ß√µes completas de d/p/q e um histograma\rsimples no caso da plot_rroll().\n# Densidade de 8d6\rdroll_plot(8 * d6)\r# Fun√ß√£o de distribui√ß√£o de 8d6\rproll_plot(8 * d6)\r# Fun√ß√£o de quantil de 8d6\rqroll_plot(8 * d6)\r# Histograma de 1000 rolagens de 8d6\rrroll_plot(1000, 8 * d6)\rToda fun√ß√£o p/q tamb√©m tem um conveniente argumento lower.tail que pode ser\rigual a FALSE para que os c√°lculos sejam feitos a partir da cauda superior\rda distribui√ß√£o.\n\rü™Ñ Estat√≠stico\rJ√° que voc√™ √© um veterano do R, voc√™ precisa ser capaz de dobrar o droll √† sua\rvontade. Se voc√™ gostaria de ver o tecido da realidade do droll, voc√™ pode usar\ra fun√ß√£o r() para obter uma distribui√ß√£o de rolagem completa. Se voc√™ quiser\rprecis√£o m√°xima, voc√™ tamb√©m pode impedir o droll de converter a sua\rrepresenta√ß√£o interna (operada pelo Ryacas) para doubles com precise = TRUE.\n# Obter a distribui√ß√£o completa de 8d6\rr(8 * d6)\r#\u0026gt; # A tibble: 41 √ó 4\r#\u0026gt; outcome n d p\r#\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 8 1 0.000000595 0.000000595\r#\u0026gt; 2 9 8 0.00000476 0.00000536 #\u0026gt; 3 10 36 0.0000214 0.0000268 #\u0026gt; 4 11 120 0.0000714 0.0000982 #\u0026gt; 5 12 330 0.000196 0.000295 #\u0026gt; 6 13 792 0.000472 0.000766 #\u0026gt; 7 14 1708 0.00102 0.00178 #\u0026gt; 8 15 3368 0.00201 0.00379 #\u0026gt; 9 16 6147 0.00366 0.00745 #\u0026gt; 10 17 10480 0.00624 0.0137 #\u0026gt; # ‚Ä¶ with 31 more rows\r# Poder ilimitado\rr(8 * d6, precise = TRUE)\r#\u0026gt; # A tibble: 41 √ó 4\r#\u0026gt; outcome n d p #\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; #\u0026gt; 1 8 1 1/1679616 1/1679616 #\u0026gt; 2 9 8 1/209952 1/186624 #\u0026gt; 3 10 36 1/46656 5/186624 #\u0026gt; 4 11 120 5/69984 55/559872 #\u0026gt; 5 12 330 55/279936 55/186624 #\u0026gt; 6 13 792 11/23328 143/186624 #\u0026gt; 7 14 1708 427/419904 2995/1679616\r#\u0026gt; 8 15 3368 421/209952 707/186624 #\u0026gt; 9 16 6147 683/186624 695/93312 #\u0026gt; 10 17 10480 655/104976 11495/839808\r#\u0026gt; # ‚Ä¶ with 31 more rows\rA tabela retornada por r() pode ser usada no lugar do argumento roll de\rtodas as fun√ß√µes discutidas acima. Isso pula os c√°lculos internos, um atalho\rvalioso se voc√™ quiser rodar m√∫ltiplos diagn√≥sticos para a mesma express√£o de\rrolagem.\nComo um estat√≠stico n√≠vel 20, voc√™ tamb√©m n√£o est√° limitado pelos dados internos\rdo droll. Voc√™ pode criar dados personalizados usando a mesma fun√ß√£o d()\rdescrita anteriormente.\n# Criar um dado \u0026quot;fudge\u0026quot;\rdF \u0026lt;- d(-1:1)\rrroll(5, dF)\r#\u0026gt; [1] 0 1 0 0 -1\r# Criar um 2d20kh, um \u0026quot;dado de vantagem\u0026quot;\rdf \u0026lt;- r(max(d20, d20))\rkh \u0026lt;- d(rep(df$outcome, df$n))\rrroll(5, kh)\r#\u0026gt; [1] 17 12 13 14 16\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-08-12-droll/","tags":["dnd","probabilidade","dados"],"title":"Rolando Dados com {droll}"},{"author":["Fernando"],"categories":["discuss√µes"],"contents":"\rPrograma√ß√£o √© uma das habilidades mais importantes da atualidade, principalmente para quem mexe com an√°lise de dados. Hoje n√≥s vamos explorar 5 motivos para te lembrar ou relembrar de porque R √© uma das maiores linguagens para Ci√™ncia de Dados. Alguns dos motivos se aplicam a todas as linguagens de programa√ß√£o, mas sempre vamos destacar porque o R √© especial, e alguns outros s√£o espec√≠ficos da nossa querida linguagem. Vamos a eles!\nMotivo 1: R √© completamente gratuito!\rdplyr, ggplot2, Rmarkdown e tidymodels s√£o apenas alguns exemplos de bibliotecas para R que, assim como a pr√≥pria linguagem, s√£o 100% gratuitas e mantidas pela comunidade. Quem usa R pode aproveitar uma ampla gama de funcionalidades sem gastar um centavo sequer com licen√ßas, softwares, planos etc.\n\rMotivo 2: Grandes pessoas da comunidade disponibilizam seu trabalho em R\rV√°rias pesssoas importantes da comunidade de estat√≠stica e machine learning participam ativamente da comunidade R e impulsionam seus trabalhos te√≥ricos atrav√©s de bibliotecas feitas especificamente para R. Para citar um exemplo, Trevor Hastie, Jerome Friedman, Rob Tibshirani e quem colabora com eles lan√ßaram uma primeira vers√£o do pacote (glmnet)[https://glmnet.stanford.edu/articles/glmnet.html] em 2010 antes de faz√™-lo em qualquer outra linguagem. Esse pacote foi fruto de uma s√©rie de pesquisas desses autores e quem usa R pode aproveitar as primeiras implementa√ß√µes logo ap√≥s a publica√ß√£o dos resultados.\n\rMotivo 3: R possui um ecossistema que incentiva a reprodutibilidade\rUma das maiores virtudes de se usar uma linguagem de programa√ß√£o para an√°lise de dados √© garantir que qualquer resultado, da conta mais simples ao gr√°fico mais complexo, pode ser reproduzida de maneira completamente fiel por um programa de computador. Isso √© importante por v√°rios motivos, mas principalmente porque (1) te ajuda a economizar tempo, j√° que voc√™ pode simplesmente usar o mesmo programa para v√°rios problemas parecidos, e (2) em muitos contextos, como na pesquisa cient√≠fica por exemplo, √© importante que se saiba com muita precis√£o como cada resultado foi produzido, inclusive para que ele possa ser verificado por pares posteriormente.\nEnt√£o, se j√° nos convencemos de que reprodutibilidade √© importante, podemos ver claramente porque R √© t√£o especial: existe todo um ecossistema que suporta e incentiva a reprodutibilidade. Desde a exist√™ncia do pacote reprex (que te ajuda a compartilhar pequenos peda√ßos de c√≥digo em texto simples) at√© ferramentas como Rmarkdown e as boas pr√°ticas incentivadas pelo RStudio, por exemplo. Al√©m disso, como grande parte da comunidade R √© formada por pessoas que trabalham na academia, muito do que se produz e discute nos blogs e f√≥runs √© como garantir que nossas an√°lises sejam reprodut√≠veis.\n\rMotivo 4: R tem uma comunidade vibrante e crescente\rTer algu√©m para conversar e tirar d√∫vidas √© uma parte importante do aprendizado de praticamente qualquer t√≥pico. Em R no Brasil e no mundo temos uma grande e crescente comunidade disposta a ajudar e discutir, inclusive divulgando materiais gratuitos introdut√≥rios e avan√ßados para que muitas pessoas possam aproveitar. Nesse sentido, um esfor√ßo particularmente relevante da comunidade foca-se tamb√©m em promover a inclus√£o de grupos sub representados no mundo tech, como √© o caso de iniciativas como a R-Ladies.\n\rMotivo 5: Os focos da linguagem s√£o modelagem, visualiza√ß√£o e an√°lise de dados\rDesde os seus prim√≥rdios em meados de 1976, R e suas encarna√ß√µes anteriores foram focadas em fornecer ferramentas para quem faz an√°lise de dados, seja isso modelagem, visualiza√ß√£o ou elabora√ß√£o de relat√≥rios. Por isso, nesses 45 anos de desenvolvimento da linguagem, a comunidade se focou principalmente em simplificar a vida de quem manipula bases de dados e, consequentemente, hoje temos ferramentas que produzem resultados sofisticados a partir de uma sintaxe simples e consistente. N√£o que outras linguagens n√£o tenham grandes contribui√ß√µes, mas a heran√ßa das gera√ß√µes anteriores faz com que R seja ainda hoje uma das mais ricas no quesito ‚Äúdados‚Äù.\n\rGostou? Quer saber mais?\rSe voc√™ quiser dar os seus primeiros passos para aprender a manipular dados com R, d√™ uma olhada no nosso curso R para Ci√™ncia de Dados I e aproveite!\nCaso voc√™ tenha d√∫vidas, entre em contato com a gente pelos coment√°rios aqui embaixo, pelo nosso Discourse ou pelo e-mail contato@curso-r.com.\n\r","permalink":"https://blog.curso-r.com/posts/2021-07-23-por-que-usar-r/","tags":["tutoriais"],"title":"5 motivos para usar R"},{"author":["Caio"],"categories":["tutoriais"],"contents":"\r\rEste √© um tutorial sobre o pacote {rlang}, um dos mais poderosos e menos\rconhecidos do R. Ele √© vital para a nota√ß√£o compacta do {tidyverse}, conhecida\rcomo tidy eval, mas mesmo assim poucas pessoas sabem como ele funciona e\rcomo utiliz√°-lo para criar fun√ß√µes no estilo tidy.\nO tutorial n√£o √© curto, mas fizemos o nosso melhor para come√ßar com calma e\rterminar com colinhas para facilitar o uso deste material no dia a dia. Se for\rnecess√°rio, leia e releia uma mesma se√ß√£o para ter certeza de que o conceito\rapresentado foi completamente absorvido. No caso de d√∫vidas, entre em contato\rconosco e com o resto da comunidade R no nosso\rDiscourse.\nSe estiver com pregui√ßa, deixei uma colinha no final do post. Mas, para os\rcorajosos, preparem-se para alguns novos conceitos de programa√ß√£o, v√°rios\rfilhotes de cachorro e muito {rlang}!\nO melhor amigo do R\rA analogia que vamos usar para explicar o {rlang} gira em torno de um parque\rrepleto de filhotes fofinhos. N√≥s temos uma √∫nica miss√£o nesse parque: fazer\rcarinho nos cachorros. Para isso, temos uma fun√ß√£o carinho() que recebe o nome\rde um filhote e imprime uma frase explicando em quem estamos fazendo carinho. O\robjeto que descreve o filhote se resume a uma string com a sua cor.\nrex \u0026lt;- \u0026quot;laranja\u0026quot;\rcarinho(rex)\r#\u0026gt; Fazendo carinho no filhote laranja\rPara facilitar a compreens√£o do c√≥digo, vamos tamb√©m ilustrar esse cen√°rio. Na\rfigura abaixo, note que √© criado um objeto rex que recebe a figura de um\rfilhote laranja. A fun√ß√£o carinho() √© retratada como uma m√£o parada que,\rquando executada, retorna uma m√£o fazendo carinho no filhote de cor apropriada\r(essencialmente a string retornada pelo c√≥digo acima).\nExpress√µes\rAgora que temos uma base s√≥lida para a analogia, podemos introduzir o primeiro\rconceito importante do {rlang}: express√µes. Uma express√£o no R n√£o passa\rdo c√≥digo antes antes que ele seja avaliado, ou seja, aquilo que voc√™ escreve e\rque, depois de executado no console do RStudio, se torna um resultado. Em quase\r100% dos casos, o R n√£o faz nenhuma distin√ß√£o entre a express√£o e o valor que\rela retorna, de modo que executar carinho(rex) fica equivalente a executar\rcarinho(\"laranja\"). Esse comportamento √© chamado de avalia√ß√£o ansiosa,\rjustamente porque o R avalia cada parte da express√£o t√£o cedo quanto for\rposs√≠vel.\nEssa, entretanto, n√£o √© √∫nica forma de avalia√ß√£o. Tamb√©m √© poss√≠vel capturar uma\rexpress√£o, ‚Äúimpedindo‚Äù o R de avali√°-la, em um processo denominado avalia√ß√£o\rpregui√ßosa. A fun√ß√£o do {rlang} que faz isso se chama expr() e ela retorna\ra express√£o passada, vulgo o c√≥digo escrito.\ne \u0026lt;- expr(carinho(max))\re\r#\u0026gt; carinho(max)\rVeja que n√£o importa que n√£o existe ainda um filhote chamado max! Como estamos\rlidando apenas com uma express√£o sem contexto, isso √© perfeitamente poss√≠vel.\nVoltando para o nosso parque de cachorros, a avalia√ß√£o pregui√ßosa se torna quase\ruma promessa de fazer carinho em um filhote. Temos toda a informa√ß√£o necess√°ria\r(no caso, o nome do filhote), mas n√£o transformamos isso na a√ß√£o de fazer\rcarinho: n√£o ‚Äúchamamos o filhote para perto‚Äù para acarici√°-lo. Perceba que na\rfigura abaixo n√£o h√° as marcas de movimento da m√£o, pois estamos congelando a\rcena antes de o filhote vir at√© n√≥s.\n\rAmbientes\rNa nossa analogia, o pr√≥ximo conceito representa o parque em si, um lugar onde\rh√° uma correspond√™ncia entre nomes de cachorros. No R, um ambiente funciona\rcomo um dicion√°rio que cont√©m defini√ß√µes de objetos acompanhados pelos valores\rque eles carregam.\nAbaixo, vamos ‚Äútrazer‚Äù dois novos cachorros para o parque, ou seja, criar dois\rnovos objetos. A fun√ß√£o env_print() mostra todas as correspond√™ncias presentes\rno ambiente (incluindo a da fun√ß√£o carinho()), al√©m de algumas informa√ß√µes\rextras que n√£o nos interessam agora.\nmax \u0026lt;- \u0026quot;marrom\u0026quot;\rdex \u0026lt;- \u0026quot;bege\u0026quot;\renv_print()\r#\u0026gt; \u0026lt;environment: global\u0026gt;\r#\u0026gt; parent: \u0026lt;environment: package:rlang\u0026gt;\r#\u0026gt; bindings:\r#\u0026gt; * rex: \u0026lt;chr\u0026gt;\r#\u0026gt; * e: \u0026lt;language\u0026gt;\r#\u0026gt; * mtcars: \u0026lt;tibble[,11]\u0026gt;\r#\u0026gt; * carinho: \u0026lt;fn\u0026gt;\r#\u0026gt; * dex: \u0026lt;chr\u0026gt;\r#\u0026gt; * max: \u0026lt;chr\u0026gt;\rNa analogia, estamos colocando os cachorros max e dex no parque, permitindo\rque possamos eventualmente fazer carinho neles. Vamos apenas ignorar a defini√ß√£o\rda fun√ß√£o carinho() para que isso n√£o atrapalhe o resto da explica√ß√£o.\nPerceba que o resultado da avalia√ß√£o de uma express√£o depende completamente do\rambiente. Na hora de executar um c√≥digo, o R procura as defini√ß√µes de todos os\robjetos no ambiente e os substitui dentro da express√£o. Agora vamos ver o que\raconteceria se tent√°ssemos fazer carinho no filhote chamado max em outro\rparque‚Ä¶\n\rAvaliando express√µes\rAvalia√ß√£o nua (bare evaluation no original) √© o processo pelo qual o\r{rlang} permite que forne√ßamos explicitamente um ambiente no qual avaliar uma\rexpress√£o. √â como se pud√©ssemos escolher o parque no qual vamos chamar um\rfilhote para acarici√°-lo.\nNo c√≥digo abaixo vamos visitar um outro parque, isto √©, criar uma fun√ß√£o. O\rambiente dentro de uma fun√ß√£o herda as defini√ß√µes do ambiente global, mas\rpodemos fazer altera√ß√µes l√° dentro que n√£o s√£o propagadas para fora. Vide a\rfun√ß√£o abaixo: p() define um objeto max com a cor verde e avalia (ou seja,\rexecuta) uma express√£o l√° dentro.\np \u0026lt;- function(x) {\rmax \u0026lt;- \u0026quot;verde\u0026quot;\reval_tidy(x)\r}\rSeguindo a analogia dos filhotes, √© como se visit√°ssemos um outro parque onde h√°\rum cachorro chamado max cuja cor √© verde (al√©m dos outros dois cachorros que\rj√° hav√≠amos visto no parque antigo).\nComo a fun√ß√£o eval_tidy(), por padr√£o, utiliza o ambiente corrente para\ravaliar express√µes, ent√£o p(e) deve indicar carinho em um filhote verde e\rn√£o mais em um filhote marrom. Note que, apesar de n√£o estarmos passando um\rambiente explicitamente para a eval_tidy(), ela est√° obtendo esse ambiente\ratrav√©s de caller_env(), o valor padr√£o para seu argumento env.\np(e)\r#\u0026gt; Fazendo carinho no filhote verde\rNa ilustra√ß√£o a seguir vemos o que aconteceria no nosso parque. Apesar de\restarmos chamando o nome do cachorro marrom, como estamos em outro parque (uma\rnova fun√ß√£o), o cachorro que responder√° ao chamado aqui √© verde!\n\rQuosures\rAgora que voc√™ entende o que √© uma express√£o, o que √© um ambiente e como podemos\ravaliar uma express√£o dentro de um ambiente, chegou a hora de entender a\restrutura mais importante do {rlang}: as quosures. Esse nome estranho vem\rde quote e closure, dois conceitos extremamente importantes da Ci√™ncia da\rComputa√ß√£o, mas explicar o que eles significam foge do escopo deste tutorial.\nUma quosure, apesar de parecer um conceito complexo, n√£o passa de uma express√£o\rque carrega um apontador para seu ambiente consigo. Isso n√£o parece ser muito\r√∫til, mas √© a quosure que permite que as fun√ß√µes do {tidyverse} sejam capazes\rde acessar as colunas de uma tabela e vari√°veis declaradas no ambiente global.\nq \u0026lt;- quo(carinho(max))\rq\r#\u0026gt; \u0026lt;quosure\u0026gt;\r#\u0026gt; expr: ^carinho(max)\r#\u0026gt; env: global\rPensando nos filhotes, uma quosure √© a promessa de fazer carinho em um cachorro\rsabendo exatamente o endere√ßo do parque em que ele estava Note que, na sa√≠da\racima, o env se chama ‚Äúglobal‚Äù, justamente porque estamos trabalhando\rdiretamente na sess√£o base do R.\nNa figura abaixo, juntamente da cena retratada na ilustra√ß√£o sobre express√µes,\rvemos um qualificador de max, especificando onde devemos encontrar ele. Isso\r√© significativamente diferente de simplesmente gritar pelo max mais pr√≥ximo.\n\rAvaliando quosures\rAssim como utilizamos a avalia√ß√£o nua para obter o resultado de uma express√£o em\rum certo ambiente, podemos usar a avalia√ß√£o tidy (de tidy evaluation) para\robter o resultado de uma quosure no ambiente que ela carrega.\nAqui, depois de capturar a quosure, podemos fazer o que quisermos com o ambiente\rna qual avaliaremos ela, pois o √∫nico ambiente que importar√° na avalia√ß√£o tidy\r√© o de seu ambiente de origem. Sendo assim, perceba que o argumento env de\reval_tidy() n√£o foi levado em conta!\np(q)\r#\u0026gt; Fazendo carinho no filhote marrom\r√â dif√≠cil traduzir esse processo para a analogia dos filhotes, mas seria algo\rcomo voltar para o endere√ßo do parque original antes de fazer carinho no filhote\rcujo nome √© max.\n\rBang-bang\rA pe√ßa final do quebra-cabe√ßa do {rlang} √© o bang-bang, tamb√©m conhecido\rcomo quasiquotation e expresso na forma de duas exclama√ß√µes: !!. Essa\rfuncionalidade, exclusiva ao {rlang}, permite que fa√ßamos uma ‚Äúavalia√ß√£o\ransiosa seletiva‚Äù em uma express√£o ou quosure. Em breve ficar√° mais claro onde\risso pode ser √∫til, mas antes √© necess√°rio ver como usar o bang-bang na pr√°tica.\nO bang-bang ‚Äúfor√ßa‚Äù a avalia√ß√£o de uma parte da express√£o, liberando o R para\rfazer parte do seu trabalho de avalia√ß√£o ansiosa. Veja, no c√≥digo abaixo, como\rfunciona a captura de uma express√£o que usa o bang-bang. Atente-se para o fato\rde que, na se√ß√£o anterior, alteramos o valor de max.\nexpr(carinho(!!max))\r#\u0026gt; carinho(\u0026quot;marrom\u0026quot;)\rNa analogia dos filhotes, o bang-bang est√° essencialmente chamando um cachorro\rpelo nome antes que fa√ßamos carinho nele. Ao inv√©s do contorno branco que vimos\rnas ilustra√ß√µes sobre express√µes e quosures, agora vemos a m√£o parada ao lado de\rum filhote espec√≠fico.\n\r\rDe volta para casa\rApesar de termos visto um pouco de c√≥digo R na sess√£o anterior, agora √©\rnecess√°rio aprofundar um pouco os exemplos. Prometo que n√£o ser√° nada muito\rdif√≠cil, mas √© imposs√≠vel entender como aplicar o {rlang} no mundo real sem\rver alguns casos de uso.\nNa maior parte das ocasi√µes, n√£o usaremos nenhuma das fun√ß√µes vistas at√© agora,\rsalvo pelo bang-bang (que na verdade n√£o √© uma fun√ß√£o, mas sim uma sintaxe). O\rprincipal uso do {rlang}, na verdade, √© capturar c√≥digo que o usu√°rio\rescreve, ent√£o √© necess√°rio conhecer novas vers√µes de expr() e quo() que s√£o\rcapazes de capturar express√µes e quosures vindas de fora de uma fun√ß√£o.\nEnriquecimento\rO conceito de enriquecimento vem de uma analogia meio ruim criada pelo autor\rdo {rlang}; para simplificar, pense que as vers√µes enriquecidas de expr() e\rquo() s√£o mais ‚Äúfortes‚Äù que as vers√µes normais, sendo capazes de sair de\rdentro de uma fun√ß√£o para capturar express√µes do lado de fora.\nAbaixo √© poss√≠vel ver uma fun√ß√£o que tenta capturar o nome de um filhote, mas √©\rincapaz de faz√™-lo por causa da avalia√ß√£o ansiosa do R. O correto seria capturar\ra express√£o escrita pelo usu√°rio e imprim√≠-la como uma string.\nnome1 \u0026lt;- function(filhote) {\rcat(\u0026quot;O nome do filhote √©\u0026quot;, filhote)\r}\rnome1(dex)\r#\u0026gt; O nome do filhote √© bege\rPodemos ver a vers√£o correta da fun√ß√£o desejada em nome2(). Ela captura a\rexpress√£o do usu√°rio com enexpr() (a vers√£o enriquecida de expr()) e\rconverte esse objeto em uma string com expr_text(), permitindo que a fun√ß√£o\rimprima o nome do filhote.\nnome2 \u0026lt;- function(filhote) {\rnome \u0026lt;- enexpr(filhote)\rcat(\u0026quot;O nome do filhote √©\u0026quot;, expr_text(nome))\r}\rnome2(dex)\r#\u0026gt; O nome do filhote √© dex\rComo n√£o havia necessidade nenhuma de capturar o ambiente do usu√°rio nesse\rexemplo, usamos apenas enexpr(). Na maioria das situa√ß√µes, entretanto, √©\rpreciso usar enquo() para obter o comportamento correto. J√° que quosures\rincluem express√µes, expr() e enexpr() quase nunca s√£o estritamente\rnecess√°rias, ent√£o vamos simplificar tudo e seguir apenas com as quosures.\nNo c√≥digo abaixo a fun√ß√£o explica() precisa tanto da express√£o quanto do\rambiente da mesma, ou seja, da quosure escrita pelo usu√°rio.\nexplica \u0026lt;- function(acao) {\rquosure \u0026lt;- enquo(acao)\rcat(\u0026quot;`\u0026quot;, quo_text(quosure), \u0026quot;` retorna:\\n\u0026quot;, sep = \u0026quot;\u0026quot;)\reval_tidy(quosure)\r}\rexplica(carinho(dex))\r#\u0026gt; `carinho(dex)` retorna:\r#\u0026gt; Fazendo carinho no filhote bege\rPreste bastante aten√ß√£o em explica(), pois pode ser que n√£o seja f√°cil\rentender como ela funciona. A primeira fun√ß√£o utilizada √© a enquo() (quo()\renriquecida), que captura a express√£o do usu√°rio juntamente com o seu ambiente.\rA seguir, temos apenas que converter a quosure em string com quo_text() para\rpoder imprim√≠-la. O √∫ltimo passo √© avaliar a quosure para obter um resultado\rexatamente igual ao que o usu√°rio obteria se decidisse executar a express√£o\rpassada como argumento.\n\rCurly-curly\rA combina√ß√£o da enquo() com o bang-bang √© justamente a forma correta de\rimplementar fun√ß√µes que trabalham com o {tidyverse}. A fun√ß√£o summarise(),\rpor exemplo, n√£o passa de um enquo() disfar√ßado, o que quer dizer que podemos\rusar o bang-bang para ‚Äúinjetar‚Äù o nome de uma vari√°vel dentro de um c√°lculo.\nmedia1 \u0026lt;- function(df, var) {\rsummarise(df, resultado = mean(var))\r}\rmedia1(mtcars, cyl)\r#\u0026gt; Error: Problem with `summarise()` column `resultado`.\r#\u0026gt; ‚Ñπ `resultado = mean(var)`.\r#\u0026gt; x object \u0026#39;cyl\u0026#39; not found\rO c√≥digo acima, que n√£o usa bang-bang, retorna um erro. O problema √© que a\rsummarise() est√° tentando tirar a m√©dia de um objeto chamado var, que\rcarrega um objeto chamado cyl, que simplesmente n√£o existe no ambiente global.\rAbaixo, usando bang-bang e enquo(), o c√≥digo funciona como esperado porque\rmean(!!var) se torna mean(cyl) dentro da summarise().\nmedia2 \u0026lt;- function(df, var) {\rvar \u0026lt;- enquo(var)\rsummarise(df, resultado = mean(!!var))\r}\rmedia2(mtcars, cyl)\r#\u0026gt; # A tibble: 1 √ó 1\r#\u0026gt; resultado\r#\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 6.19\rO {tidyverse} nos fornece um atalho para essa combina√ß√£o poderosa de enquo()\rcom !!: o {{ }}, mais conhecido como curly-curly. Agora que voc√™ j√°\rentende exatamente o que est√° acontecendo por tr√°s dos panos, saber onde usar o\rcurly-curly √© mais f√°cil.\nmedia3 \u0026lt;- function(df, var) {\rsummarise(df, resultado = mean({{var}}))\r}\rmedia3(mtcars, cyl)\r#\u0026gt; # A tibble: 1 √ó 1\r#\u0026gt; resultado\r#\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 6.19\r\rSplice\rA pen√∫ltima funcionalidade do {rlang} a compreender √© o conceito de splice\r(‚Äúemendar‚Äù em portugu√™s), que se manifesta nas vers√µes pluralizadas das fun√ß√µes\rapresentadas at√© agora. Essencialmente, expr()/enexpr e quo()/enquo() s√≥\rconseguem lidar com uma √∫nica express√£o ou quosure, ent√£o temos outras vers√µes\rpara trabalhar com m√∫ltiplas express√µes ou quosures.\nNa pr√°tica, a principal fun√ß√£o que utilizaremos √© enquos(). Ela captura todo o\rconte√∫do de uma elipse e o transforma em uma lista de quosures como no\rexemplo abaixo. As vers√µes plurais tamb√©m acompanham o bang-bang-bang, o\rirm√£o com splice do bang-bang.\nmedia4 \u0026lt;- function(df, ...) {\rvars \u0026lt;- enquos(...)\rsummarise(df, across(c(!!!vars), mean))\r}\rmedia4(mtcars, cyl, disp, hp)\r#\u0026gt; # A tibble: 1 √ó 3\r#\u0026gt; cyl disp hp\r#\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 6.19 231. 147.\rSe voc√™ n√£o estiver familiarizado com a across(), basta saber apenas que o\rprimeiro argumento √© um vetor de colunas (similar ao que passar√≠amos para\rselect()) e o segundo √© uma fun√ß√£o para utilizar no resumo das colunas\respecificadas. Aqui o !!! est√° apenas transformando a chamada em\racross(c(cyl, disp, hp), mean).\n\rS√≠mbolos\rExiste ainda um conceito que n√£o abordamos at√© agora: s√≠mbolos. Um s√≠mbolo\rn√£o passa do nome de um objeto, ou seja, rex, max e dex na analogia dos\rfilhotes; mais especificamente, um s√≠mbolo √© uma express√£o com algumas\rrestri√ß√µes sobre o seu conte√∫do. A fun√ß√£o sym(), especificamente, transforma\ruma string em um s√≠mbolo, permitindo que ela seja usada junto com outras\rexpress√µes.\nmedia6 \u0026lt;- function(df, var) {\rvar \u0026lt;- ensym(var)\rsummarise(df, resultado = mean(!!var))\r}\rmedia6(mtcars, \u0026quot;cyl\u0026quot;)\r#\u0026gt; # A tibble: 1 √ó 1\r#\u0026gt; resultado\r#\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 6.19\r\rMiscel√¢nea\rFora os v√°rios conceitos j√° apresentados, restam apenas duas breves\rconsidera√ß√µes para praticamente zerar o {rlang}:\nO curly-curly funciona com strings, mas n√£o com splice, ent√£o a fam√≠lia\rsym() torna-se quase desnecess√°ria juntamente com o !! ao mesmo tempo em\rque o !!! permanece essencial.\n\rH√° um operador espec√≠fico (:=, chamado de morsa) para quando\rprecisamos for√ßar a execu√ß√£o de algo no lado esquerdo de um c√°lculo, mesmo\rquando usando o curly-curly.\n\r\rmedia7 \u0026lt;- function(df, col, ...) {\rargs \u0026lt;- enquos(...)\rsummarise(df, {{col}} := mean(!!!args))\r}\rmedia7(mtcars, \u0026quot;nova_coluna\u0026quot;, drat, na.rm = TRUE)\r#\u0026gt; # A tibble: 1 √ó 1\r#\u0026gt; nova_coluna\r#\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 3.60\r\r\rDe volta para o trabalho\rDepois de tanto conte√∫do, agora voc√™ consegue entender as colinhas que\rapresentamos abaixo para facilitar o seu uso do {rlang} no dia-a-dia. Ao final\rtamb√©m deixamos as refer√™ncias deste tutorial para que voc√™ possa aprofundar\rainda mais os seus conhecimentos de tidy eval.\nVocabul√°rio\r\r\r\rVoc√°bulo\r\rTradu√ß√£o\r\rSignificado\r\rC√≥digo\r\r\r\r\r\rAmbiente\r\rEnvironment\r\rDicion√°rio de nomes e valores\r\renv()\r\r\r\rAvalia√ß√£o ansiosa\r\rEager evaluation\r\rAvalia√ß√£o de todo objeto o mais r√°pido poss√≠vel\r\r\r\r\r\rAvalia√ß√£o nua\r\rBare evaluation\r\rAvalia√ß√£o que necessita de um ambiente passado explicitamente\r\reval_tidy(e)\r\r\r\rAvalia√ß√£o pregui√ßosa\r\rLazy evaluation\r\rAvalia√ß√£o de cada objeto conforme a necessidade\r\rquo(), etc.\r\r\r\rAvalia√ß√£o tidy\r\rTidy evaluation\r\rAvalia√ß√£o que utiliza o ambiente da quosure\r\reval_tidy(q)\r\r\r\rBang-bang\r\rBang-bang\r\rOperador utilizado para for√ßar a avalia√ß√£o de um objeto\r\r!!\r\r\r\rBang-bang-bang\r\rBang-bang-bang\r\rOperador utilizado para for√ßar a avalia√ß√£o de v√°rios objetos\r\r!!!\r\r\r\rCurly-curly\r\rCurly-curly\r\rAtalho para enquo() + !!\r\r{{ }}\r\r\r\rElipse\r\rEllipsis\r\rArgumento de uma func√£o que pode receber m√∫ltiplas entradas\r\r...\r\r\r\rEnriquecimento\r\rEnriching\r\rProcesso que permite a captura de c√≥digo do usu√°rio\r\renquo(), etc.\r\r\r\rExpress√£o\r\rExpression\r\rC√≥digo R antes de avaliado\r\rexpr()\r\r\r\rMorsa\r\rWalrus\r\rOperador utilizado para permitir express√µes do lado esquerdo de uma igualdade\r\r:=\r\r\r\rQuosure\r\rQuosure\r\rExpress√£o que carrega seu ambiente consigo\r\rquo()\r\r\r\rS√≠mbolo\r\rSymbol\r\rExpress√£o que pode representar apenas o nome de um objeto\r\rsym()\r\r\r\rSplice\r\rSplice\r\rProcesso que permite a captura de m√∫ltiplas express√µes, etc.\r\rquos(), etc.\r\r\r\r\r\r\rPrincipais fun√ß√µes\r\r\r\rObjeto\r\rSimples\r\rEnriquecido\r\r\r\r\r\rS√≠mbolo\r\rsym()/syms()\r\rensym()/ensyms()\r\r\r\rExpress√£o\r\rexpr()/exprs()\r\renexpr()/enexprs()\r\r\r\rQuosure\r\rquo()/quos()\r\renquo()/enquos()\r\r\r\r\r\rPrincipais padr√µes\rOs padr√µes incluem dois exemplos que n√£o foram explicados durante o tutorial.\rPara saber mais, consulte as refer√™ncias no final do texto.\n\r\r\rDescri√ß√£o\r\rUsu√°rio\r\rProgramador\r\r\r\r\r\rExpress√£o do lado esquerdo\r\rmedia(df, col)\r\r{{col}} := mean(var)\r\r\r\rExpress√£o do lado direito\r\rmedia(df, var)\r\rcol = mean({{var}})\r\r\r\rExpress√µes do lado direito\r\rmedia(df, var, arg1 = 0)\r\rcol = mean(!!!var)\r\r\r\rExpress√µes no meio\r\ragrupar(df, var1, var2)\r\rgroup_by(df, ...)\r\r\r\rS√≠mbolo do lado esquerdo\r\rmedia(df, \u0026amp;quot;col\u0026amp;quot;)\r\r{{col}} := mean(var)\r\r\r\rS√≠mbolo do lado direito\r\rmedia(df, \u0026amp;quot;var\u0026amp;quot;)\r\rcol = mean(.data$var)\r\r\r\r\r\rRefer√™ncias\r\rAdvanced R: Metaprogramming\n\rDocumenta√ß√£o do {rlang}\n\rProgramando com o tidyverse: introdu√ß√£o ao pacote rlang\n\rProgramming with dplyr\n\rTidy evaluation with rlang: Cheat Sheet\n\rUsing ggplot2 in packages\n\r\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-07-27-rlang-para-filhotes/","tags":["rlang","tidy","tidyverse"],"title":"Tutorial: {rlang} para Filhotes"},{"author":["William"],"categories":["tutorial"],"contents":"\r\r√â comum precisarmos colocar em nossos aplicativos p√°ginas com orienta√ß√µes, informa√ß√µes adicionais ou refer√™ncias.\nEssas p√°ginas geralmente s√£o compostas por textos, links e imagens, facilmente produzidos em um arquivo Markdown. Em contrapartida, construir esses elementos dentro da UI d√° bem mais trabalho, pois tudo precisa ser encapsulado por uma fun√ß√£o da lista shiny::tags$.\nPor exemplo, vamos supor que eu queira colocar a minha mini bio (a seguir) em um app que estou fazendo.\n\n\rWilliam Amorim\nDoutor em Estat√≠stica pelo IME-USP. Trabalhando diariamente com an√°lise de dados, programa√ß√£o em R e cria√ß√£o de dashboards. Falo sobre Shiny no Twitter.\n\r\nO arquivo Markdown para construir essa mini bio seria bem simples:\n\u0026lt;center\u0026gt;\r---\r\u0026lt;img src=\u0026quot;img/foto_william.jpg\u0026quot; width=\u0026quot;130px\u0026quot; style=\u0026quot;border-radius: 65px;\u0026quot;/\u0026gt;\r**William Amorim**\rDoutor em Estat√≠stica pelo IME-USP. Trabalhando diaramente com an√°lise de dados, programa√ß√£o em R e cria√ß√£o de dashboards. Falo sobre Shiny no [Twitter](https://twitter.com/wamorim_).\r---\r\u0026lt;/center\u0026gt;\rVeja que s√≥ precisamos usar a tag img para deixar a imagem redonda e usamos a tag center pois realmente compensa o crime. Caso contr√°rio, o c√≥digo seria totalmente Markdown. A mesma mini bio j√° √© bem mais chato de construir e manter na UI de um shiny app.\nui \u0026lt;- fluidPage(\rfluidRow(\rcolumn(\rwidth = 12,\rshiny::tags$hr(),\rshiny::tags$img(\rsrc = \u0026quot;img/foto_william.jpg\u0026quot;,\rwidth = \u0026quot;130px\u0026quot;,\rstyle = \u0026quot;border-radius: 65px; display: block; margin: auto;\u0026quot;\r),\rshiny::tags$p(\rshiny::tags$strong(\u0026quot;William Amorim\u0026quot;),\rstyle = \u0026quot;text-align: center;\u0026quot;\r),\rshiny::tags$p(\rstyle = \u0026quot;text-align: center;\u0026quot;,\r\u0026quot;Doutor em Estat√≠stica pelo IME-USP. Trabalhando diaramente com an√°lise de dados, programa√ß√£o em R e cria√ß√£o de dashboards.\rFalo sobre Shiny no\u0026quot;,\rshiny::tags$a(\rhref = \u0026quot;https://twitter.com/wamorim_\u0026quot;,\r\u0026quot;Twitter.\u0026quot;\r)\r),\rshiny::tags$hr()\r)\r)\r)\rMesmo um exemplo simples j√° come√ßa a deixar claro o problema: produzir muitos elementos HTML na UI rapidamente transforma seu c√≥digo em um emaranhado de fun√ß√µes aninhadas e cheias de texto. O mesmo vale para textos muito grandes. Embora nesse caso nem sempre tenhamos muitas tags HTML para criar, scripts R n√£o foram feitos para atender aos cuidados que textos carecem.\nA melhor pr√°tica nessas situa√ß√µes √© justamente transferir esses elementos para um arquivo Markdown e pedir que o Shiny transforme em HTML e inclua no lugar adequado apenas na hora do runApp(). Para isso usamos a fun√ß√£o shiny::includeMarkdown().\nSupondo que salvamos o markdown da mini bio em um arquivo minibio_william.md, a nossa UI ent√£o ficaria:\nui \u0026lt;- fluidPage(\rfluidRow(\rcolumn(\rwidth = 12,\rincludeMarkdown(\u0026quot;minibio_william.md\u0026quot;)\r)\r)\r)\rVale ressaltar que essa fun√ß√£o compila arquivos Markdown (.md) e n√£o R Markdown (.Rmd). Se voc√™ gostaria de rodar c√≥digos R para gerar sa√≠das HTML, voc√™ deve fazer isso dentro do pr√≥prio Shiny.\n√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n","permalink":"https://blog.curso-r.com/posts/2021-07-22-shiny-markdown/","tags":["shiny","markdown"],"title":"Fuja das tags! Incluindo Markdown no Shiny"},{"author":["Fernando"],"categories":["pacotes"],"contents":"\r\rEm muitas situa√ß√µes, principalmente quando o assunto √© finan√ßas, precisamos contar os dias √∫teis entre duas datas. Como essa √© uma quest√£o que depende de calend√°rios regionais, isso pode ser um pouco chato de fazer diretamente no R, pois voc√™ precisar√° importar uma lista de feriados. Felizmente o pacote bizdays que est√° dispon√≠vel no CRAN ajuda nessa tarefa e hoje vamos explorar algumas de suas funcionalidades.\nUsando o pacote bizdays\rA fun√ß√£o principal do pacote √© a fun√ß√£o bizdays, que recebe duas datas e um calend√°rio e retorna a quantidade de dias √∫teis entre essas datas.\nAtualmente o pacote bizdays suporta a lista de feriados do calend√°rio da ANBIMA, que considera os feriados banc√°rios e √© a refer√™ncia mais comum quando o precisamos contar dias √∫teis. Isso pode acabar atrapalhando algumas aplica√ß√µes, pois o calend√°rio da ANBIMA considera, por exemplo, que a quinta-feira da Semana Santa √© um dia √∫til. Ele n√£o considera tamb√©m feriados municipais ou estaduais. Por outro lado, o calend√°rio da ANBIMA √© usado como refer√™ncia em muitos c√°lculos de institui√ß√µes financeiras e √© o padr√£o brasileiro em muitos contextos.\nPara contar os dias √∫teis tomando como refer√™ncia esse calend√°rio, basta utilizarmos os comandos abaixo\nlibrary(bizdays)\rprimeiro_de_janeiro_2021 \u0026lt;- as.Date(\u0026quot;2020-01-01\u0026quot;)\rprimeiro_de_julho_2021 \u0026lt;- as.Date(\u0026quot;2021-07-01\u0026quot;)\r# A ordem dos par√¢metros ser√°\r# data de origem\r# data final\r# nome do calend√°rio que ser√° utilizados.\r# podemos acessar a lista usando o comando calendars()\rbizdays(primeiro_de_janeiro_2021, primeiro_de_julho_2021, \u0026quot;Brazil/ANBIMA\u0026quot;)\r## [1] 374\r\rCriando seu pr√≥prio calend√°rio\rCaso voc√™ queira usar um calend√°rio pr√≥prio ou incluir novos feriados, voc√™ pode criar um novo calend√°rio que ficar√° dispon√≠vel para ser usado como refer√™ncia no terceiro par√¢metro da fun√ß√£o bizdays. Para criar um calend√°rio, precisamos chamar a fun√ß√£o create.calendar como vemos abaixo:\nlibrary(bizdays)\rdata(holidaysANBIMA, package = \u0026#39;bizdays\u0026#39;)\r# carrega a lista de feriados at√© 2079\rcreate.calendar(\rname = \u0026quot;novo_calendario\u0026quot;,\rholidays = c(holidaysANBIMA,\r# holidays √© um vetor de calendarios. o vetor holidaysANBIMA\r# cont√©m os feriados do calend√°rio da ANBIMA.\ras.Date(paste0(2003:2079, \u0026quot;-11-20\u0026quot;))),\r# aqui inclu√≠mos os feriados do\r# Dia da Conci√™ncia Negra no dia 20 de Novembro de todos os anos # de 2003 a 2079\rweekdays = c(\u0026quot;saturday\u0026quot;, \u0026quot;sunday\u0026quot;)\r# aqui definimos quais dias da semana N√ÉO s√£o considerados dias √∫teis\r)\rbizdays(primeiro_de_janeiro_2021, primeiro_de_julho_2021, \u0026quot;novo_calendario\u0026quot;)\r## [1] 373\r\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre manipula√ß√£o de dados com R, d√™ uma olhada no nosso curso R para Ci√™ncia de Dados I e aproveite!\nCaso voc√™ tenha d√∫vidas, entre em contato com a gente pelos coment√°rios aqui embaixo, pelo nosso Discourse ou pelo e-mail contato@curso-r.com.\n\r","permalink":"https://blog.curso-r.com/posts/2021-07-16-bizdays/","tags":["tutoriais"],"title":"Como contar dias √∫teis no R"},{"author":["William"],"categories":["tutoriais"],"contents":"\r\rNeste post, vamos mostrar como usar o widget radioGroupButtons do pacote shinyWidgets para construir um app com seletor de visualiza√ß√µes, isto √©, bot√µes que mudam o tipo de visualiza√ß√£o apresentada na tela.\nComo exemplo, vamos construir um shiny app que mostra um gr√°fico de barras, um gr√°fico de linhas ou uma tabela (a depender da escolha da pessoa que estiver usando) do n√∫mero de gols do Brasileir√£o1 por temporada.\nO primeiro passo √© configurar o widget corretamente. Veja abaixo que o segredo √© utilizar os argumentos choiceValues e choiceNames. Para o primeiro, passamos os valores que ser√£o acessados dentro do server a depender da escolha na UI (equivalente ao argumento choices). Ao segundo, podemos passar tanto textos (que seriam escritos dentro do bot√£o) quanto √≠cones. Nesse caso, utilizamos √≠cones da biblioteca Font Awesome, com ajuda da fun√ß√£o shiny::icon(). Repare tamb√©m que deixamos o tamanho dos bot√µes um pouco maiores setando o argumento size = \"lg.\nshinyWidgets::radioGroupButtons(\rinputId = \u0026quot;vis_escolhida\u0026quot;,\rlabel = \u0026quot;\u0026quot;,\rchoiceValues = c(\u0026quot;barras\u0026quot;, \u0026quot;linhas\u0026quot;, \u0026quot;tabela\u0026quot;),\rchoiceNames = list(\ricon(\u0026quot;bar-chart\u0026quot;),\ricon(\u0026quot;line-chart\u0026quot;),\ricon(\u0026quot;table\u0026quot;)\r),\rsize = \u0026quot;lg\u0026quot;,\rselected = \u0026quot;barras\u0026quot;\r)\rAgora, precisamos construir a l√≥gica do Output, tanto na UI como no server. Como a nossa visualiza√ß√£o pode gerar gr√°ficos ou uma tabela, precisaremos de fun√ß√µes *Output() e render*() diferentes. Dessa forma, vamos utilizar na nossa UI um OutputUI().\n# A nossa UI ficar√° assim\rui \u0026lt;- fluidPage(\rfluidRow(\rcolumn(\rwidth = 12,\rh1(\u0026quot;App com seletor de visualiza√ß√µes\u0026quot;)\r)\r),\rbr(),\rfluidRow(\rcolumn(\roffset = 1,\rwidth = 11,\rshinyWidgets::radioGroupButtons(\rinputId = \u0026quot;vis_escolhida\u0026quot;,\rlabel = \u0026quot;\u0026quot;,\rchoiceValues = c(\u0026quot;barras\u0026quot;, \u0026quot;linhas\u0026quot;, \u0026quot;tabela\u0026quot;),\rchoiceNames = list(\ricon(\u0026quot;bar-chart\u0026quot;),\ricon(\u0026quot;line-chart\u0026quot;),\ricon(\u0026quot;table\u0026quot;)\r),\rsize = \u0026quot;lg\u0026quot;,\rselected = \u0026quot;barras\u0026quot;\r)\r)\r),\rbr(),\rfluidRow(\rcolumn(\rwidth = 12,\ruiOutput(\u0026quot;vis\u0026quot;)\r)\r)\r)\rAgora, no server, podemos criar fun√ß√µes *Output() diferentes a depender da visualiza√ß√£o escolhida. Usamos plotOutput() para os gr√°ficos e reactable::reactableOutput() para a tabela.\noutput$vis \u0026lt;- renderUI({\rif (input$vis_escolhida %in% c(\u0026quot;barras\u0026quot;, \u0026quot;linhas\u0026quot;)) {\rplotOutput(\u0026quot;grafico\u0026quot;)\r} else if (input$vis_escolhida == \u0026quot;tabela\u0026quot;) {\rreactable::reactableOutput(\u0026quot;tabela\u0026quot;)\r}\r})\rAgora vamos construir nossas visualiza√ß√µes. Primeiro, vamos montar a base que precisamos para gerar tanto os gr√°ficos quanto a tabela.\nOs dados v√™m do pacote brasileirao. Se voc√™ n√£o possui esse pacote instalado, basta rodar o c√≥digo abaixo:\nremotes::install_github(\u0026quot;williamorim/brasileirao\u0026quot;)\rComo a tabela que gera os gr√°ficos n√£o depende de nenhum valor ou express√£o reativa, podemos colocar o c√≥digo que a gera diretamente no server.\ntab \u0026lt;- brasileirao::matches |\u0026gt;\rdplyr::filter(\rscore != \u0026quot;x\u0026quot;,\rseason %in% 2006:2020\r) |\u0026gt;\rtidyr::separate(\rscore,\rc(\u0026quot;gols_casa\u0026quot;, \u0026quot;gols_visitante\u0026quot;),\rsep = \u0026quot;x\u0026quot;,\rconvert = TRUE\r) |\u0026gt;\rdplyr::mutate(\rgols = gols_casa + gols_visitante\r) |\u0026gt;\rdplyr::group_by(season) |\u0026gt;\rdplyr::summarise(gols = sum(gols))\rPara gerar os gr√°ficos, s√≥ precisamos de um renderPlot() e um if/else para devolver o gr√°fico certo.\noutput$grafico \u0026lt;- renderPlot({\rgrafico_base \u0026lt;- tab |\u0026gt;\rggplot(aes(x = season, y = gols)) +\rlabs(x = \u0026quot;Temporada\u0026quot;, y = \u0026quot;N√∫mero de gols\u0026quot;) +\rtheme_minimal() +\rggtitle(\u0026quot;N√∫mero de gols do Brasileir√£o por temporada\u0026quot;)\rif (input$vis_escolhida == \u0026quot;linhas\u0026quot;) {\rgrafico_base +\rgeom_line(color = \u0026quot;dark green\u0026quot;)\r} else if (input$vis_escolhida == \u0026quot;barras\u0026quot;) {\rgrafico_base +\rgeom_col(width = 0.5, fill = \u0026quot;dark green\u0026quot;)\r}\r})\rPara gerar a tabela, precisamos apenas de um renderReactable().\noutput$tabela \u0026lt;- reactable::renderReactable({\rtab |\u0026gt;\rreactable::reactable(\rfullWidth = FALSE,\rcolumns = list(\rseason = reactable::colDef(\rname = \u0026quot;Temporada\u0026quot;\r),\rgols = reactable::colDef(\rname = \u0026quot;N√∫mero de gols\u0026quot;\r)\r)\r)\r})\rJuntando tudo, temos o app a seguir:\nlibrary(shiny)\rlibrary(ggplot2)\rui \u0026lt;- fluidPage(\rfluidRow(\rcolumn(\rwidth = 12,\rh1(\u0026quot;App com seletor de visualiza√ß√µes\u0026quot;)\r)\r),\rbr(),\rfluidRow(\rcolumn(\roffset = 1,\rwidth = 11,\rshinyWidgets::radioGroupButtons(\rinputId = \u0026quot;vis_escolhida\u0026quot;,\rlabel = \u0026quot;\u0026quot;,\rchoiceValues = c(\u0026quot;barras\u0026quot;, \u0026quot;linhas\u0026quot;, \u0026quot;tabela\u0026quot;),\rchoiceNames = list(\ricon(\u0026quot;bar-chart\u0026quot;),\ricon(\u0026quot;line-chart\u0026quot;),\ricon(\u0026quot;table\u0026quot;)\r),\rsize = \u0026quot;lg\u0026quot;,\rselected = \u0026quot;barras\u0026quot;\r)\r)\r),\rbr(),\rfluidRow(\rcolumn(\rwidth = 12,\ruiOutput(\u0026quot;vis\u0026quot;)\r)\r)\r)\rserver \u0026lt;- function(input, output, session) {\routput$vis \u0026lt;- renderUI({\rif (input$vis_escolhida %in% c(\u0026quot;barras\u0026quot;, \u0026quot;linhas\u0026quot;)) {\rplotOutput(\u0026quot;grafico\u0026quot;)\r} else if (input$vis_escolhida == \u0026quot;tabela\u0026quot;) {\rreactable::reactableOutput(\u0026quot;tabela\u0026quot;)\r}\r})\rtab \u0026lt;- brasileirao::matches |\u0026gt;\rdplyr::filter(\rscore != \u0026quot;x\u0026quot;,\rseason %in% 2006:2020\r) |\u0026gt;\rtidyr::separate(\rscore,\rc(\u0026quot;gols_casa\u0026quot;, \u0026quot;gols_visitante\u0026quot;),\rsep = \u0026quot;x\u0026quot;,\rconvert = TRUE\r) |\u0026gt;\rdplyr::mutate(\rgols = gols_casa + gols_visitante\r) |\u0026gt;\rdplyr::group_by(season) |\u0026gt;\rdplyr::summarise(gols = sum(gols))\routput$grafico \u0026lt;- renderPlot({\rgrafico_base \u0026lt;- tab |\u0026gt;\rggplot(aes(x = season, y = gols)) +\rlabs(x = \u0026quot;Temporada\u0026quot;, y = \u0026quot;N√∫mero de gols\u0026quot;) +\rtheme_minimal() +\rggtitle(\u0026quot;N√∫mero de gols do Brasileir√£o por temporada\u0026quot;)\rif (input$vis_escolhida == \u0026quot;linhas\u0026quot;) {\rgrafico_base +\rgeom_line(color = \u0026quot;dark green\u0026quot;)\r} else if (input$vis_escolhida == \u0026quot;barras\u0026quot;) {\rgrafico_base +\rgeom_col(width = 0.5, fill = \u0026quot;dark green\u0026quot;)\r}\r})\routput$tabela \u0026lt;- reactable::renderReactable({\rtab |\u0026gt;\rreactable::reactable(\rfullWidth = FALSE,\rcolumns = list(\rseason = reactable::colDef(\rname = \u0026quot;Temporada\u0026quot;\r),\rgols = reactable::colDef(\rname = \u0026quot;N√∫mero de gols\u0026quot;\r)\r)\r)\r})\r}\rshinyApp(ui, server)\r√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\rCampeonato Brasileiro de futebol da S√©rie A.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-07-01-shiny-seletor-vis/","tags":["shiny","widgets"],"title":"Crie seletores de visualiza√ß√£o no Shiny"},{"author":["William","Fernando"],"categories":["pacotes"],"contents":"\r\rSe voc√™ n√£o sabe o que √© DnD, j√° vamos tirar isso do caminho: DnD n√£o √© um novo modelo de Deep Learning. DnD √© a abrevia√ß√£o de Dungeons \u0026amp; Dragons, um dos jogos de RPG1 mais famosos da hist√≥ria, considerado a origem dos RPGs modernos.\nPor falta de oportunidade, eu (William) nunca joguei RPG, mas sempre fui muito f√£ da ideia e dos conceitos. Uma das paradas que acho mais divertidas √© a din√¢mica de alinhamentos do DnD. Mestre de muitas aventuras, o Fernando explica a seguir em bom portugu√™s como esse alinhamento funciona.\nO alinhamento DnD\rEm resumo, essa din√¢mica diz que qualquer personagem pode ser posicionado em uma matriz de 9 posi√ß√µes, formadas pela combina√ß√£o de dois eixos: o √©tico e o moral.\nO lado √©tico possui 3 categorias: lawful, neutral e chaotic. Uma personagem lawful ou ordeira √© aquela que segue as leis da sociedade em que vive mesmo que isso possa contrariar suas convic√ß√µes ou valores pessoais, enquanto um personagem chaotic ou ca√≥tico se sente confort√°vel em quebrar qualquer tipo de lei, pois faz as suas pr√≥prias regras, com pouco ou nenhum apre√ßo pelas normas estabelecidas socialmente. Uma personagem neutral ou neutra seria aquela que se insere dentro do conjunto de normas, mas n√£o tem nenhuma convic√ß√£o forte sobre segui-las ou n√£o. Diferente de uma personagem ordeira, que segue √† risca o que est√° estabelecido, ou ca√≥tica, que nega por princ√≠pio parte das regras estabelecidas, uma personagem neutra simplesmente n√£o pensa sobre o assunto.\nO lado moral tamb√©m possui 3 categorias: good, neutral e evil. Essa escala √© mais f√°cil de explicar. S√£o as personagens boas (good), m√°s (evil) e aquelas que v√£o na onda (neutral). Ao contr√°rio do nosso mundo real, a fantasia simulada em um jogo de DnD n√£o tem espa√ßo para relativismo moral e nuances. Uma personagem altru√≠sta, generosa, piedosa e/ou qualquer outra caracter√≠stica que n√£o causa sofrimento nenhum √© enquadrada no espectro positivo da escala: ela √© boa ou good. J√° uma personagem ego√≠sta, cruel por esporte, insens√≠vel etc √© m√° ou evil. A dificuldade aqui est√° nos personagens neutros, mas a ideia √© parecida com o que falamos no lado √©tico: esse posicionamento se define pela dist√¢ncia das outras possibilidades. A neutralidade se define pela ambiguidade: todas as atitudes podem ser leg√≠timas independentemente de leis, sofrimento de outras pessoas etc, tudo depende do contexto, n√£o de convic√ß√µes fortes ou desejo pessoal.\nVamos a alguns exemplos: o her√≥i m√≠tico ingl√™s Robin Hood √© um bom exemplo de um personagem chaotic good, pois ele efetivamente quebra as regras vigentes porque acredita que isso √© justo (roubar dos ricos), mas o faz para ajudar as pessoas que mais precisam (dar aos pobres), um motivo altru√≠sta. Indo para o mundo de Star Wars Han Solo pode ser considerado um personagem chaotic neutral, pelo menos no come√ßo da hist√≥ria. Ele √© um contrabandista, vive sua vida quebrando sistematicamente as regras e n√£o v√™ problema nisso, de onde conclu√≠mos que ele pelo menos pensou no assunto. Al√©m disso, ele n√£o ajuda o Luke e a L√©ia, personagens neutral good, por nenhum motivo espec√≠fico. Sua √∫nica preocupa√ß√£o inicial √© o dinheiro. Para mais exemplos, confira este v√≠deo em ingl√™s dispon√≠vel no Youtube.\nComo esse sistema de alinhamentos √© flex√≠vel o suficiente para enquadrar v√°rias obras diferentes, uma moda que j√° surgiu e resurgiu na internet algumas vezes √© fazer o alinhamento DnD de personagens de alguma s√©rie ou filme qualquer.\nVeja alguns exemplos de que voc√™ pode achar por a√≠:\n\rO pacote DnDalignment\rMesmo n√£o sabendo o que √© DnD e nunca tendo jogado RPG, o exerc√≠cio de alinhar personagens nesse grid geralmemnte √© bem divertido, principalmente quando voc√™ est√° discutindo o seu posicionamento com outras pessoas. √â uma maneira bem divertida de revisitar e discutir obras que voc√™ gosta. :)\nE fica ainda mais divertido se voc√™ puder fazer isso no R! :D\nFoi por isso que o Fernando e eu criamos o pacote DnDalignment. Com ele, voc√™ pode facilmente gerar uma imagem de alinhamento DnD com arquivos que est√£o na sua m√°quina ou links para imagens na interet.\nAntes de mais nada, instale o pacote. Ele s√≥ est√° dispon√≠vel no GitHub.\nremotes::install_github(\u0026quot;williamorim/DnDalignment\u0026quot;)\rPara criar o alinhamento, basta usar a fun√ß√£o DnDalignment::create_alignment(). Cada argumento da fun√ß√£o se refere a um alinhamento e voc√™ pode passar o caminho para uma imagem local ou o link para uma imagem na internet.\nPara exemplificar, a gente criou o alinhamento dos personagens da s√©rie The Office:\nlibrary(DnDalignment)\rcreate_alignment(\rchaotic_good = \u0026quot;https://www.cheatsheet.com/wp-content/uploads/2021/04/The-Office.jpg\u0026quot;,\rneutral_good = \u0026quot;https://uploads.jovemnerd.com.br/wp-content/uploads/2021/02/the-office-jim-canta-musica-abertura.jpg\u0026quot;,\rchaotic_neutral = \u0026quot;https://img.ibxk.com.br/2021/01/20/20133848690155.png\u0026quot;,\rchaotic_evil = \u0026quot;https://www.looper.com/img/gallery/the-todd-packer-scene-in-the-office-that-went-too-far/l-intro-1620750071.jpg\u0026quot;,\rlawful_good = \u0026quot;https://static3.srcdn.com/wordpress/wp-content/uploads/2019/11/Phyllis-The-Office.jpg?q=50\u0026amp;fit=crop\u0026amp;w=740\u0026amp;h=370\u0026amp;dpr=1.5\u0026quot;,\rlawful_evil = \u0026quot;https://i.ytimg.com/vi/BWNhTOd9uXI/maxresdefault.jpg\u0026quot;,\rneutral_evil = \u0026quot;https://cdn.jwplayer.com/v2/media/46qsexlL/poster.jpg?width=720\u0026quot;,\rlawful_neutral = \u0026quot;https://uploads.jovemnerd.com.br/wp-content/uploads/2021/01/the-office-dwight-gerenta.jpg\u0026quot;,\rtrue_neutral = \u0026quot;https://pbs.twimg.com/media/EXlUzHzXQAEgIZt.png\u0026quot;\r)\rE a√≠? O que achou das nossas escolhas? Se voc√™ discorda, tweet o seu alinhamento e marque a gente no Twitter: Curso-R, William e Fernando.\nAt√© a pr√≥xima!\n\r\rSigla em ingl√™s para Role Playing Game que em portugu√™s significa Jogo de intepreta√ß√£o de pap√©is. RPGs s√£o jogos parecidos com a encena√ß√£o de uma pe√ßa de teatro, mas com regras como as de Banco Imobili√°rio para estruturar a interpreta√ß√£o de pap√©is.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-06-23-dnd/","tags":["shiny","Dnd","theoffice"],"title":"Fa√ßa alinhamentos DnD no R"},{"author":["William"],"categories":["tutoriais"],"contents":"\r\r\r\r\rTooltips s√£o uma √≥tima maneira de se comunicar com a pessoa utilizando o seu app, pois permitem passar todo tipo de informa√ß√£o extra e n√£o ocupam espa√ßo da UI.\nEssencialmente, elas s√£o textos que s√≥ aparecem quando passamos o mouse em cima de algum elemento da tela. Por exemplo, passe o mouse em cima da frase a seguir:\n\r{\"x\":{\"opts\":{\"content\":\"Ol√°! Eu sou uma tooltip :)\"},\"text\":\"Passe o mouse aqui!\"},\"evals\":[],\"jsHooks\":[]}\r\nExistem v√°rias solu√ß√µes dispon√≠veis para incluirmos tooltips em um aplicativo Shiny, mas a minha preferida atualmente √© o pacote tippy.\nAntes de mais nada, instale o pacote:\ninstall.packages(\u0026quot;tippy\u0026quot;)\rPara colocar uma tooltip em um elemento do seu app, basta usar a fun√ß√£o with_tippy().\ntippy::with_tippy(\rnumericInput(\r\u0026quot;tamanho\u0026quot;,\rlabel = \u0026quot;Selecione o tamanho da amostra\u0026quot;,\rvalue = 1000,\rstep = 1000\r),\rtooltip = \u0026quot;Amostra de uma distribui√ß√£o Normal com m√©dia 0 e vari√¢ncia 100.\u0026quot;\r)\rVoc√™ tamb√©m pode aplicar a mesma tooltip a v√°rios elementos utilizando a fun√ß√£o tippy_class().\nfluidRow(\rcolumn(\rwidth = 4,\rdiv(\rclass = \u0026quot;valuebox-tip\u0026quot;,\rshinydashboard::valueBoxOutput(\u0026quot;valor_1\u0026quot;, width = 12)\r)\r),\rcolumn(\rwidth = 4,\rdiv(\rclass = \u0026quot;valuebox-tip\u0026quot;,\rshinydashboard::valueBoxOutput(\u0026quot;valor_2\u0026quot;, width = 12)\r)\r),\rcolumn(\rwidth = 4,\rdiv(\rclass = \u0026quot;valuebox-tip\u0026quot;,\rshinydashboard::valueBoxOutput(\u0026quot;valor_3\u0026quot;, width = 12)\r)\r),\rcolumn(\rwidth = 12,\rplotOutput(\u0026quot;grafico\u0026quot;)\r),\rtippy::tippy_class(\r\u0026quot;valuebox-tip\u0026quot;,\rcontent = \u0026quot;Voc√™ precisa importar o css do pacote shinydashboard se quiser usar valueBoxes fora do shinydashboard.\u0026quot;\r)\r)\rVoc√™ pode customizar a tooltip seguindo os par√¢metros da documenta√ß√£o oficial da biblioteca tippy.js.\ntippy::tippy_class(\r\u0026quot;valuebox-tip\u0026quot;,\rcontent = \u0026quot;Voc√™ precisa importar o css do pacote shinydashboard se quiser usar valueBoxes fora do shinydashboard.\u0026quot;,\rarrow = TRUE,\rplacement = \u0026quot;left\u0026quot;\r)\rOs fragmentos de c√≥digo acima pertencem ao app a seguir. Rode o app para ver as tooltips em funcionamento.\nlibrary(shiny)\rui \u0026lt;- fluidPage(\rshinyWidgets::useShinydashboard(),\rtitlePanel(\u0026quot;Usando tooltips\u0026quot;),\rsidebarLayout(\rsidebarPanel(\rtippy::with_tippy(\rnumericInput(\r\u0026quot;tamanho\u0026quot;,\rlabel = \u0026quot;Selecione o tamanho da amostra\u0026quot;,\rvalue = 1000,\rstep = 1000\r),\rtooltip = \u0026quot;Amostra de uma distribui√ß√£o Normal com m√©dia 0 e vari√¢ncia 100.\u0026quot;\r)\r),\rmainPanel(\rfluidRow(\rcolumn(\rwidth = 4,\rdiv(\rclass = \u0026quot;valuebox-tip\u0026quot;,\rshinydashboard::valueBoxOutput(\u0026quot;valor_1\u0026quot;, width = 12)\r)\r),\rcolumn(\rwidth = 4,\rdiv(\rclass = \u0026quot;valuebox-tip\u0026quot;,\rshinydashboard::valueBoxOutput(\u0026quot;valor_2\u0026quot;, width = 12)\r)\r),\rcolumn(\rwidth = 4,\rdiv(\rclass = \u0026quot;valuebox-tip\u0026quot;,\rshinydashboard::valueBoxOutput(\u0026quot;valor_3\u0026quot;, width = 12)\r)\r),\rcolumn(\rwidth = 12,\rplotOutput(\u0026quot;grafico\u0026quot;)\r),\rtippy::tippy_class(\r\u0026quot;valuebox-tip\u0026quot;,\rcontent = \u0026quot;Voc√™ precisa importar o css do pacote shinydashboard se quiser usar valueBoxes fora do shinydashboard.\u0026quot;,\rarrow = TRUE,\rplacement = \u0026quot;left\u0026quot;\r)\r)\r)\r)\r)\rserver \u0026lt;- function(input, output, session) {\ramostra \u0026lt;- reactive(rnorm(input$tamanho, sd = 10))\routput$valor_1 \u0026lt;- shinydashboard::renderValueBox({\rshinydashboard::valueBox(\rvalue = round(mean(amostra()), 1),\rsubtitle = \u0026quot;M√©dia dos valores\u0026quot;,\ricon = icon(\u0026quot;info-circle\u0026quot;)\r) \\\r})\routput$valor_2 \u0026lt;- shinydashboard::renderValueBox({\rshinydashboard::valueBox(\rvalue = round(var(amostra()), 1),\rsubtitle = \u0026quot;Vari√¢ncia dos valores\u0026quot;,\ricon = icon(\u0026quot;info-circle\u0026quot;)\r)\r})\routput$valor_3 \u0026lt;- shinydashboard::renderValueBox({\rshinydashboard::valueBox(\rvalue = round(sd(amostra()), 1),\rsubtitle = \u0026quot;Desvio-padr√£o dos valores\u0026quot;,\ricon = icon(\u0026quot;info-circle\u0026quot;)\r)\r})\routput$grafico \u0026lt;- renderPlot(hist(amostra()))\r}\rshinyApp(ui, server)\r\rComo mostramos no exemplo no come√ßo do post, o voc√™ tamb√©m pode colocar tooltips em documentos HTML gerados a partir do R Markdown. Para isso, utilize a fun√ß√£o tippy.\ntippy::tippy(\u0026quot;Passe o mouse aqui!\u0026quot;, tooltip = \u0026quot;Ol√°! Eu sou uma tooltip :)\u0026quot;)\r\r{\"x\":{\"opts\":{\"content\":\"Ol√°! Eu sou uma tooltip :)\"},\"text\":\"Passe o mouse aqui!\"},\"evals\":[],\"jsHooks\":[]}\r√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n","permalink":"https://blog.curso-r.com/posts/2021-06-22-tippy/","tags":["shiny","tooltips"],"title":"Colocando tooltips no Shiny (e no Rmarkdown)"},{"author":["William"],"categories":["tutoriais"],"contents":"\r\r√â muito comum termos visualiza√ß√µes no nosso app que demoram para serem geradas. Quando estamos carregando o app, isso pode fazer com que parte da UI fique em branco, parecendo que a p√°gina est√° quebrada ou fazendo com que algu√©m passe em branco pelo output que tivemos tanto trabalho para fazer. Quando a visualiza√ß√£o est√° sendo recalculada, o padr√£o do Shiny √© deixar a vers√£o anterior acizentada at√© que a nova apare√ßa, o que pode gerar estranheza e tamb√©m passar a ideia de que o aplicativo quebrou.\n√â uma boa pr√°tica sempre avisarmos a quem estiver usando o app que alguma coisa est√° acontecendo por tr√°s das cortinas. Quando a espera √© muito longa, devemos sempre que poss√≠vel explicar o porqu√™ a pessoa est√° esperando e dar uma estimativa do tempo. Nesses casos, barras de carregamento s√£o a melhor alternativa. Falaremos delas em um outro post.\nQuando a espera n√£o √© t√£o grande (entre 2 e 10 segundos, por exemplo), anima√ß√µes girat√≥rias ou de looping infinito podem ser utilizadas para indicar que algo vai aparecer ali e reduzir um pouco a percep√ß√£o do tempo de espera.\nNeste post, falaremos de dois pacotes que deixam muito simples a tarefa de incluir essas anima√ß√µes em nossos outputs: o shinycssloaders e o shinyWidgets.\nSe voc√™ ainda n√£o tem esses pacotes instalados, ambos est√£o no CRAN:\ninstall.packages(\u0026quot;shinycssloaders\u0026quot;)\rinstall.packages(\u0026quot;shinyWidgets\u0026quot;)\rO shinycssloaders √© um pacote mantido pelo Dean Attali que possui uma √∫nica fun√ß√£o: withSpinner(). Para colocar a anima√ß√£o de carregamento em uma visualiza√ß√£o, basta colocar a fun√ß√£o *Output() dentro da fun√ß√£o withSpinner()! Sempre que ela estiver sendo calculada, um spinner ser√° mostrado no lugar.\nRode o Shiny app abaixo para ver um exemplo:\nlibrary(shiny)\rui \u0026lt;- fluidPage(\rtitlePanel(\u0026quot;Exemplo shinyWidgets::addSpinner\u0026quot;),\rsidebarLayout(\rsidebarPanel(\rselectInput(\rinputId = \u0026quot;variavel\u0026quot;,\rlabel = \u0026quot;Escolha uma vari√°vel\u0026quot;,\rchoices = names(mtcars)\r)\r),\rmainPanel(\rshinycssloaders::withSpinner(\rplotOutput(outputId = \u0026quot;histograma\u0026quot;),\rtype = 4,\rcolor = \u0026quot;orange\u0026quot;,\rsize = 2\r)\r)\r)\r)\rserver \u0026lt;- function(input, output, session) {\routput$histograma \u0026lt;- renderPlot({\rSys.sleep(5)\rhist(mtcars[[input$variavel]])\r})\r}\rshinyApp(ui, server)\r\rAl√©m de 8 op√ß√µes de anima√ß√µes diferentes, que voc√™ pode trocar com o argumento type, tamb√©m √© poss√≠vel ajustar o tamanho, a cor, a cor de fundo e at√© usar uma imagem pr√≥pria como anima√ß√£o1.\nVeja aqui um Shiny app que apresenta todas as op√ß√µes de customiza√ß√£o do shinycssloaders.\nO pacote shinyWidgets √© mantido pelo pessoal da dreamRs e possui diversos widgets muito √∫teis (falaremos bastante desse pacote em pr√≥ximos posts). Adicionamos anima√ß√µes de carregamento utilizando a fun√ß√£o addSpinner() e, assim como a fun√ß√£o shinycssloards::withSpinner(), basta embrulhar suas fun√ß√µes *Output() com a fun√ß√£o addSpinner().\nS√£o 9 op√ß√µes de anima√ß√£o, escolhidas por meio do argumento spin. Aqui podemos customizar apenas a cor delas. Rode o app a seguir para ver um exemplo.\nlibrary(shiny)\rui \u0026lt;- fluidPage(\rtitlePanel(\u0026quot;Exemplo shinyWidgets::addSpinner\u0026quot;),\rsidebarLayout(\rsidebarPanel(\rselectInput(\rinputId = \u0026quot;variavel\u0026quot;,\rlabel = \u0026quot;Escolha uma vari√°vel\u0026quot;,\rchoices = names(mtcars)\r)\r),\rmainPanel(\rshinyWidgets::addSpinner(\rplotOutput(outputId = \u0026quot;histograma\u0026quot;),\rspin = \u0026quot;cube\u0026quot;,\rcolor = \u0026quot;purple\u0026quot;\r)\r)\r)\r)\rserver \u0026lt;- function(input, output, session) {\routput$histograma \u0026lt;- renderPlot({\rSys.sleep(5)\rhist(mtcars[[input$variavel]])\r})\r}\rshinyApp(ui, server)\r\r√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\rPode ser uma imagem est√°tica ou GIF.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-06-14-loaders/","tags":["shiny","widgets"],"title":"Adicionando loaders ao seu Shiny app"},{"author":["William"],"categories":["tutoriais"],"contents":"\r\rO meu maior desafio durante o desenvolvimento de um Shiny app complexo √© a constru√ß√£o do fluxo de reatividade. N√£o foram raras as vezes que gastei horas pensando em uma l√≥gica de programa√ß√£o que gerasse o comportamento que eu gostaria ou que simplesmente fizesse o app funcionar.\nAl√©m de a reatividade ser um conceito abstrato e invis√≠vel no c√≥digo, precisamos n√£o apenas garantir que o app funcione, mas tamb√©m que funcione adequadamente. Se ao mudar o valor de um slider, por exemplo, a gente espera que um gr√°fico seja atualizado, dois problemas podem surgir: (1) o gr√°fico n√£o ser recalculado e (2) o gr√°fico ser recalculado mais de uma vez.\nOs dois problemas indicam um fluxo de reatividade mal constru√≠do. A diferen√ßa √© que no primeiro caso o app n√£o funciona e no segundo ele funciona de maneira inadequada.\nPara evitar esses problemas, podemos imaginar ou desenhar o fluxo de reatividade para investigar onde est√° a falha. Essa √© uma tarefa simples em apps com poucos inputs e outputs, mas extremamente dif√≠cil ou invi√°vel em apps complexos.\nNesses casos, ou mesmo nos casos simples, podemos utilizar o pacote reactlog. Com ele, al√©m de criarmos facilmente o diagrama do fluxo de reatividade de qualquer Shiny app, podemos olhar o que acontece por tr√°s das curtinas da reatividade quando executamos o aplicativo.\nAntes de mais nada, instale o pacote reactlog.\ninstall.packages(\u0026quot;reactlog\u0026quot;)\rEm seguida, no Console, rode o c√≥digo abaixo. Isso vai habilitar o reactlog para qualquer app que voc√™ rodar na sess√£o de R atual.\noptions(shiny.reactlog = TRUE) \rPor fim, rode o seu app e utilize o comando CTRL + F3 (no Mac, command + F3). O seu navegador abrir√° uma nova aba com o diagrama de reatividade. Veja o exemplo a seguir. Primeiro temos a UI de um aplicativo que gera o histograma de uma amostra com distribui√ß√£o normal. O tamanho da amostra √© determinado pelo sliderInput. Sempre que o tamanho da amostra muda, o gr√°fico √© recalculado.\n\rFigura 1: Shiny app que mostra o histograma de uma amostra com distribui√ß√£o normal. O tamanho da amostra √© determinado por um sliderInput.\r\rVeja agora o diagrama de reatividade associado a esse app. A forma dos 4 elementos mais a esquerda representa inputs ou valores reativos, a forma do elemento plotObj representa express√µes reativas e a forma do elemento output$hist representa os outputs (ou observadores).\n\rFigura 2: Diagrama de reatividade do app anterior.\r\rParece muito mais complicado do que deveria, n√©? Acontece que al√©m do input e output, o diagrama tamb√©m apresenta elementos referentes ao tamanho da janela da pessoa que est√° utilizando o app. Esses elementos influenciam na imagem produzida para o gr√°fico dentro do HTML, que √© redimensionada a depender do tamanho da tela. Por isso a exist√™ncia do elemento intermedi√°rio plotObj, que guarda as instru√ß√µes para gerar o gr√°fico criadas pelo c√≥digo R. Assim, o c√≥digo R no servidor n√£o precisa ser rodado novamente para que a imagem do gr√°fico seja redimensionada.\nPodemos filtrar o diagrama para mostrar apenas o fluxo relacionado aos inputs do aplicativo escrevendo input no campo de busca. Repare tamb√©m que os comandos no canto superior esquerdo permitem visualizar o fluxo de reatividade das a√ß√µes realizadas entre a inicializa√ß√£o do app e o momento em que criamos o diagrama (quando pressionamos CTRL + F3).\n\rFigura 3: Diagrama de reatividade do app anterior.\r\rEm resumo, com um diagrama de reatividade em m√£os, podemos:\n\rver os inputs dos quais cada output depende e n√£o depende;\n\rinvestigar porque o c√≥digo de um output n√£o √© rodado ou roda duas vezes quando acionamos um input do qual ele deveria depender;\n\rter uma vis√£o menos abstrada do fluxo de reatividade e entender melhor o que acontece quando executamos cada parte do nosso app.\n\r\rUm ponto importante: por raz√µes de seguran√ßa e performance, nunca habilite o reaclog em ambientes de produ√ß√£o. Quando ele est√° habilitado, qualquer pessoal utilizando o seu app pode ver pelo menos parte do seu c√≥digo fonte (que eventualmente pode conter informa√ß√µes sens√≠veis).\nVoc√™ pode aprender mais sobre o funcionamento do reaclog clicando aqui.\n√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\rAt√© a pr√≥xima!\n","permalink":"https://blog.curso-r.com/posts/2021-06-10-reactlog/","tags":["shiny","reatividade","reactlog"],"title":"Diagramas de reatividade no shiny (reactlog)"},{"author":["Fernando"],"categories":["pacotes"],"contents":"\r\rVoc√™ provavelmente conhece o pacote ggplot2, mas voc√™ sabia que tamb√©m √© poss√≠vel criar gr√°ficos animados sem nenhuma dificuldade? Essa √© exatamente a fun√ß√£o do pacote gganimate e hoje n√≥s vamos conversar um pouco sobre as anima√ß√µes.\nIdeia geral\rO pacote gganimate parte de um objeto ggplot2 que pode ser decomposto em v√°rios plots repetidos. A anima√ß√£o que vemos na tela √© uma composi√ß√£o a partir de todas essas imagens. As possibilidades de composi√ß√£o s√£o definidas pelas chamadas √† fun√ß√µes transition_*, que definem de que modo a sua anima√ß√£o deve ser se comportar entre um gr√°fico e outro. Voc√™ pode conferir a nossa live ou o cheatsheet para ver alguns exemplos.\nO exemplo abaixo usa transition_reveal(data_aplicacao) do pacote gganimate para transformar um ggplot2 comum em v√°rias imagens que representam a curva de pessoas vacinadas ao longo do tempo:\nlibrary(tidyverse)\rlibrary(bigrquery)\rconexao_covid \u0026lt;- dbConnect(\rbigrquery::bigquery(),\rproject = \u0026quot;basedosdados\u0026quot;,\rdataset = \u0026quot;br_ms_vacinacao_covid19\u0026quot;,\rbilling = \u0026quot;live-curso-r-bd-2\u0026quot;\r)\rconexao_populacao \u0026lt;- dbConnect(\rbigrquery::bigquery(),\rproject = \u0026quot;basedosdados\u0026quot;,\rdataset = \u0026quot;br_ibge_populacao\u0026quot;,\rbilling = \u0026quot;live-curso-r-bd-2\u0026quot;\r)\rvacinacao_base \u0026lt;- tbl(conexao_covid, \u0026quot;microdados_vacinacao\u0026quot;) %\u0026gt;%\rcount(sigla_uf, data_aplicacao, dose) %\u0026gt;%\rcollect() %\u0026gt;%\rmutate(\rdata_aplicacao = as.Date(data_aplicacao)\r)\rpopulacao_estados \u0026lt;- tbl(conexao_populacao, \u0026quot;municipio\u0026quot;) %\u0026gt;%\rfilter(ano == 2020) %\u0026gt;%\rcollect() %\u0026gt;%\rmutate(\rid_estado = str_sub(id_municipio, 1, 2),\rsigla_uf = case_when(\rid_estado == \u0026quot;12\u0026quot; ~ \u0026quot;AC\u0026quot;,\rid_estado == \u0026quot;27\u0026quot; ~ \u0026quot;AL\u0026quot;,\rid_estado == \u0026quot;16\u0026quot; ~ \u0026quot;AP\u0026quot;,\rid_estado == \u0026quot;13\u0026quot; ~ \u0026quot;AM\u0026quot;,\rid_estado == \u0026quot;29\u0026quot; ~ \u0026quot;BA\u0026quot;,\rid_estado == \u0026quot;53\u0026quot; ~ \u0026quot;DF\u0026quot;,\rid_estado == \u0026quot;23\u0026quot; ~ \u0026quot;CE\u0026quot;,\rid_estado == \u0026quot;32\u0026quot; ~ \u0026quot;ES\u0026quot;,\rid_estado == \u0026quot;52\u0026quot; ~ \u0026quot;GO\u0026quot;,\rid_estado == \u0026quot;21\u0026quot; ~ \u0026quot;MA\u0026quot;,\rid_estado == \u0026quot;51\u0026quot; ~ \u0026quot;MT\u0026quot;,\rid_estado == \u0026quot;50\u0026quot; ~ \u0026quot;MS\u0026quot;,\rid_estado == \u0026quot;31\u0026quot; ~ \u0026quot;MG\u0026quot;,\rid_estado == \u0026quot;15\u0026quot; ~ \u0026quot;PA\u0026quot;,\rid_estado == \u0026quot;25\u0026quot; ~ \u0026quot;PB\u0026quot;,\rid_estado == \u0026quot;41\u0026quot; ~ \u0026quot;PR\u0026quot;,\rid_estado == \u0026quot;26\u0026quot; ~ \u0026quot;PE\u0026quot;,\rid_estado == \u0026quot;22\u0026quot; ~ \u0026quot;PI\u0026quot;,\rid_estado == \u0026quot;33\u0026quot; ~ \u0026quot;RJ\u0026quot;,\rid_estado == \u0026quot;24\u0026quot; ~ \u0026quot;RN\u0026quot;,\rid_estado == \u0026quot;43\u0026quot; ~ \u0026quot;RS\u0026quot;,\rid_estado == \u0026quot;11\u0026quot; ~ \u0026quot;RO\u0026quot;,\rid_estado == \u0026quot;14\u0026quot; ~ \u0026quot;RR\u0026quot;,\rid_estado == \u0026quot;42\u0026quot; ~ \u0026quot;SC\u0026quot;,\rid_estado == \u0026quot;35\u0026quot; ~ \u0026quot;SP\u0026quot;,\rid_estado == \u0026quot;28\u0026quot; ~ \u0026quot;SE\u0026quot;,\rid_estado == \u0026quot;17\u0026quot; ~ \u0026quot;TO\u0026quot;\r)\r) %\u0026gt;%\rgroup_by(sigla_uf) %\u0026gt;%\rsummarise(\rpopulacao = sum(populacao)\r)\rvacinacao_base_por_estado \u0026lt;- vacinacao_base %\u0026gt;%\rungroup() %\u0026gt;%\rmutate(\rregiao = case_when(\rsigla_uf %in% c(\u0026quot;SP\u0026quot;, \u0026quot;RJ\u0026quot;, \u0026quot;MG\u0026quot;, \u0026quot;ES\u0026quot;) ~ \u0026quot;Sudeste\u0026quot;,\rsigla_uf %in% c(\u0026quot;SC\u0026quot;, \u0026quot;PR\u0026quot;, \u0026quot;RS\u0026quot;) ~ \u0026quot;Sul\u0026quot;,\rsigla_uf %in% c(\u0026quot;MT\u0026quot;, \u0026quot;DF\u0026quot;, \u0026quot;GO\u0026quot;, \u0026quot;MS\u0026quot;) ~ \u0026quot;Centro-Oeste\u0026quot;,\rsigla_uf %in% c(\u0026quot;AC\u0026quot;, \u0026quot;AM\u0026quot;, \u0026quot;RO\u0026quot;, \u0026quot;RR\u0026quot;, \u0026quot;PA\u0026quot;, \u0026quot;AP\u0026quot;, \u0026quot;TO\u0026quot;) ~ \u0026quot;Norte\u0026quot;,\rTRUE ~ \u0026quot;Nordeste\u0026quot;\r)\r) %\u0026gt;%\rfilter(dose == \u0026quot;2\u0026quot;) %\u0026gt;%\rgroup_by(regiao, sigla_uf) %\u0026gt;%\rarrange(regiao, sigla_uf, data_aplicacao) %\u0026gt;%\rmutate(\rn_acum = cumsum(n),\r) %\u0026gt;%\rfilter(data_aplicacao \u0026gt;= as.Date(\u0026quot;2021-01-01\u0026quot;)) %\u0026gt;%\rleft_join(\rpopulacao_estados\r) %\u0026gt;%\rmutate(\rpercentual_vacinado = n_acum/populacao\r)\rpopulacao_regiao \u0026lt;- vacinacao_base_por_estado %\u0026gt;%\rgroup_by(regiao) %\u0026gt;%\rsummarise(\rpopulacao = sum(unique(populacao))\r)\rvacinacao_base_por_regiao \u0026lt;- vacinacao_base %\u0026gt;%\rungroup() %\u0026gt;%\rmutate(\rregiao = case_when(\rsigla_uf %in% c(\u0026quot;SP\u0026quot;, \u0026quot;RJ\u0026quot;, \u0026quot;MG\u0026quot;, \u0026quot;ES\u0026quot;) ~ \u0026quot;Sudeste\u0026quot;,\rsigla_uf %in% c(\u0026quot;SC\u0026quot;, \u0026quot;PR\u0026quot;, \u0026quot;RS\u0026quot;) ~ \u0026quot;Sul\u0026quot;,\rsigla_uf %in% c(\u0026quot;MT\u0026quot;, \u0026quot;DF\u0026quot;, \u0026quot;GO\u0026quot;, \u0026quot;MS\u0026quot;) ~ \u0026quot;Centro-Oeste\u0026quot;,\rsigla_uf %in% c(\u0026quot;AC\u0026quot;, \u0026quot;AM\u0026quot;, \u0026quot;RO\u0026quot;, \u0026quot;RR\u0026quot;, \u0026quot;PA\u0026quot;, \u0026quot;AP\u0026quot;, \u0026quot;TO\u0026quot;) ~ \u0026quot;Norte\u0026quot;,\rTRUE ~ \u0026quot;Nordeste\u0026quot;\r)\r) %\u0026gt;%\rfilter(dose == \u0026quot;2\u0026quot;) %\u0026gt;%\rgroup_by(regiao, data_aplicacao) %\u0026gt;%\rsummarise(\rn = sum(n)\r) %\u0026gt;%\rgroup_by(regiao) %\u0026gt;%\rarrange(regiao, data_aplicacao) %\u0026gt;%\rmutate(\rn_acum = cumsum(n),\r) %\u0026gt;%\rfilter(data_aplicacao \u0026gt;= as.Date(\u0026quot;2021-02-01\u0026quot;)) %\u0026gt;%\rleft_join(\rpopulacao_regiao\r) %\u0026gt;%\rmutate(\rpercentual_vacinado = n_acum/populacao\r)\rlibrary(gganimate)\rgrafico_por_regiao \u0026lt;- vacinacao_base_por_regiao %\u0026gt;%\r#filter(regiao == \u0026quot;Sudeste\u0026quot;) %\u0026gt;%\r#filter(data_aplicacao \u0026lt;= as.Date(\u0026quot;2021-04-15\u0026quot;)) %\u0026gt;%\rungroup() %\u0026gt;%\rarrange(data_aplicacao) %\u0026gt;%\r#mutate(data_aplicacao = as.numeric(data_aplicacao)) %\u0026gt;%\rggplot(aes(x = data_aplicacao, y = percentual_vacinado, color = regiao)) +\r#geom_col() +\r#geom_line(size = 1.2) +\rgeom_point(size = 6) +\rtransition_reveal(data_aplicacao) +\rscale_color_viridis_d() +\rtheme_bw(20) +\rshadow_wake(wake_length = 0.5, size = 3) +\rease_aes(\u0026quot;cubic-in\u0026quot;) +\rlabs(x = \u0026quot;Data de refer√™ncia\u0026quot;, y= \u0026quot;% da popula√ß√£o vacinado com a 2a dose\u0026quot;,\rtitulo = \u0026quot;Evolu√ß√£o da vacina√ß√£o contra COVID-19 no Brasil por regi√£o\u0026quot;,\rcaption = \u0026quot;Fonte: openDataSus/Base dos dados\u0026quot;)\ranimate(grafico_por_regiao, height = 600, width =800)\r\rGostou? Quer saber mais?\rConfira a nossa live!\nSe voc√™ quiser aprender um pouco mais sobre RMarkdown e Visualiza√ß√£o de Dados em geral, d√™ uma olhada no nosso curso Relat√≥rios e visualiza√ß√£o de dados e aproveite!\n\r","permalink":"https://blog.curso-r.com/posts/2021-06-09-gganimate/","tags":["ggplot2"],"title":"Animando gr√°ficos feitos em ggplot2: o pacote gganimate"},{"author":["Fernando"],"categories":["tutoriais"],"contents":"\r\rA manipula√ß√£o de dados, ou data wrangling, consome a maior parte do tempo de quem trabalha com Ci√™ncia de Dados. Provavelmente por isso existem v√°rios frameworks diferentes para executar comandos dessa categoria. Em R, as duas principais bibliotecas para isso s√£o o dplyr e o data.table. Existem muitas diferen√ßas entre esses dois pacotes e hoje vamos explorar o pacote data.table e tamb√©m a ponte entre os dois, chamado dtplyr.\nPor que existem dois pacotes?\rA diferen√ßa entre os dois pacotes pode ser resumida em dois t√≥picos:\n\rVelocidade e uso de mem√≥ria do c√≥digo: o data.table em geral √© mais veloz. De tempos em tempos s√£o feitas compara√ß√µes de performance entre dplyr e data.table e o pacote data.table roda em menos tempo em v√°rios cen√°rios, como pode ser visto aqui e aqui.\n\rSintaxe: o dplyr √© um dos pacotes principais do tidyverse, data.table √© mais fiel √† sintaxe do R puro. dplyr foi feito para ser usado com pipes, imita a sintaxe dos verbos de SQL, j√° o data.table traz novas features √† sintaxe comum do R.\n\r\rAntes de explorar o data.table e o dtplyr, nenhum dos dois pacotes √© absolutamente melhor do que o outro. Embora o data.table seja mais veloz e consuma menos mem√≥ria que o dplyr, os c√≥digos escritos nesse framework exigem uma sintaxe espec√≠fica. Pelo tempo, o data.table tem uma vantagem, mas uma sintaxe dplyr pode ser compreendida por interpretadores de SQL ou at√© mesmo spark. Al√©m disso, c√≥digos dplyr s√£o compat√≠veis com outros frameworks tidy, tal como o pacote tidyr, o pacote purrr etc. Essas diferen√ßas podem diminuir o valor da efici√™ncia do data.table: se o computador gasta menos tempo executando um comando, mas voc√™ gasta mais o seu tempo (ou o de outras pessoas), a efici√™ncia valeu a pena? √â importante considerar o contexto.\n\rO pacote data.table e o pacote dtplyr\rA ideia b√°sica do data.table √© incluir muitas funcionalidades ao operador [. Um data.frame transformado em um data.table passa a funcionar da seguinte maneira:\nlibrary(data.table)\rDTvoos \u0026lt;- data.table(dados::voos)\rDTvoos[\rmes == \u0026quot;9\u0026quot;,\r# antes da primeira v√≠rgula podemos fazer filtros\r.(valor = mean(atraso_saida, na.rm = TRUE)),\r# depois da segunda v√≠rgula podemos manipular colunas:\r# aqui podemos fazer sele√ß√µes e tamb√©m podemos criar\r# novas colunas. a sele√ß√£o funciona que nem o \u0026quot;[\u0026quot;\r# normal. para criar colunas nomeadas, precisamos\r# usar a nota√ß√£o \u0026quot;.()\u0026quot;\r#\r# na verdade, no segundo elemento podemos colocar tamb√©m uma fun√ß√£o que retorne uma tibble\r# inclusive existem v√°rios helpers para usar aqui, como o .N, que conta o numero de linhas\r# da tibble agrupada, .SD, que permite fazermos manipula√ß√µes mais complexas\r# nos pedacos da base etc\rby = .(origem)\r# na terceira v√≠rgula, podemos fazer contas agrupadas usando o par√¢metro \u0026quot;by\u0026quot;\r# que fica dispon√≠vel uma vez que fazemos \u0026quot;library(data.table)\u0026quot;. Para escolher\r# as fun√ß√µes que ser√£o usadas no agrupamento sem aspas, precisamos usar a\r# nota√ß√£o ]\r## origem valor\r## 1: JFK 6.635776\r## 2: EWR 7.290954\r## 3: LGA 6.207439\rEmbora a nota√ß√£o do .() seja bem diferente do que normalmente fazemos em dplyr, a l√≥gica do pacote √© similar:\ras operacoes s√£o separadas em filtros, manipula√ß√µes e agrupamentos. As manipula√ß√µes nas colunas podem ser bastante variadas e isso √© um ponto de diverg√™ncia importante entre o dplyr e o data.table, mas tamb√©m √© verdade que existem v√°rias similaridades. Por isso existe o pacote dtplyr:\n\rTraduzindo dplyr para data.table: o pacote dtplyr\rA l√≥gica aqui √© simples: como o data.table e o dplyr s√£o minimamente parecidos, muitos c√≥digos dplyr podem ser traduzidor para data.table e as computa√ß√µes podem ser feitas s√≥ apos a tradu√ß√£o. D√™ uma olhada no c√≥digo abaixo,\rque os dados que vieram de base e a chamada que foi feita usando o data.table:\nlibrary(dtplyr)\rlibrary(magrittr)\rlibrary(dplyr)\rlibrary(tidyr)\rvoos2 \u0026lt;- lazy_dt(dados::voos)\r# esse aqui √© o pulo do gato. um `lazy_dt` vai sempre traduzir # os verbos do dplyr para comandos `DT`\rvoos2 %\u0026gt;% group_by(origem) %\u0026gt;%\rsummarise(\rvalor = mean(atraso_saida, na.rm = TRUE)\r)\r## Source: local data table [3 x 2]\r## Call: `_DT1`[, .(valor = mean(atraso_saida, na.rm = TRUE)), keyby = .(origem)]\r## ## origem valor\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 EWR 15.1\r## 2 JFK 12.1\r## 3 LGA 10.3\r## ## # Use as.data.table()/as.data.frame()/as_tibble() to access results\rClaro que existem situa√ß√µes em que a tradu√ß√£o n√£o ser√° poss√≠vel, principalmente quando tentarmos usar fun√ß√µes do pacote\rtidyr que n√£o tem suporte no dtplyr. Por outro lado, para grande parte das manipula√ß√µes simples que fazemos com dplyr, o pacote dtplyr vai dar conta.\n\rCompara√ß√µes e considera√ß√µes finais\rEnt√£o, o que a gente deve usar corriqueiramente? Essa pergunta evidentemente n√£o tem uma resposta √∫nica, pois como j√° observamos aqui a ferramenta melhor para resolver um problema depende do contexto em que voc√™ est√°. Entretanto, temos algumas vantagens em usar o dtplyr quando √© poss√≠vel, pois ele √© agn√≥stico. Al√©m disso, ele tem vantagens como deixar expl√≠cito na sintaxe a ordem em que os comandos de um data.table s√£o executados, o que n√£o acontece no pr√≥prio data.table, que depende de conhecimento sobre o funcionamento interno do c√≥digo.\nDe toda forma, existe espa√ßo pra todo mundo e certamente quem programa em R se beneficia de conhecer os dois pacotes!\n\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre manipula√ß√£o de dados com R, d√™ uma olhada no nosso curso R para Ci√™ncia de Dados I e aproveite!\nCaso voc√™ tenha d√∫vidas, entre em contato com a gente pelos coment√°rios aqui embaixo, pelo nosso Discourse ou pelo e-mail contato@curso-r.com.\n\r","permalink":"https://blog.curso-r.com/posts/2021-06-01-data-table/","tags":["faxina","manipula√ß√£o","pacotes"],"title":"Manipula√ß√£o de dados usando o pacote data.table"},{"author":["Fernando"],"categories":["tutoriais"],"contents":"\rTodo mundo que trabalha com Ci√™ncia de Dados uma hora ou outra vai se ver mexendo com informa√ß√µes p√∫blicas, direta ou indiretamente. O governo √© um grande reposit√≥rio de dados, por isso √© muito prov√°vel que uma hora ou outra algum dado disponibilizado publicamente seja relevante para voc√™.\nMesmo sendo t√£o importante, tamb√©m √© muito comum que as bases de dados p√∫blicas demandem grandes trabalhos de limpeza e organiza√ß√£o, assim como todas as bases de dados, p√∫blicas ou n√£o. As dificuldades quando se mexe com bases de dados p√∫blicas muitas vezes acontecem pois elas agregam informa√ß√µes de toda a popula√ß√£o e, por isso, ficam muito grandes. Soma-se a isso o fato de existirem bases para os mais variados fins, o que n√£o necessariamente otimiza o uso para quem analisar√° esses dados.\nPara simplificar a nossa vida, o pessoal do Base dos Dados ou BD+, para quem tem intimidade, faz o herc√∫leo trabalho de organizar, limpar e disponibilizar mais de 900 (!!!!) bases de dados gratuitamente para toda a comunidade! Como se n√£o bastasse, a galera do BD+ ainda construiu um pacote de R para facilitar o acesso da nossa comunidade ao seu reposit√≥rio de dados.\nNo post de hoje, vamos explorar o pacote basedosdados e tamb√©m vamos ver como aproveitar tudo que est√° dispon√≠vel no BigQuery do BD+ usando a sintaxe usual do dplyr.\nO pacote basedosdados\rOs dados do BD+ s√£o dispobinibilizados em uma inst√¢ncia do BigQuery, um servi√ßo da Google Cloud Platform que possibilita a constru√ß√£o de um data warehouse sem servidor, escal√°vel e de alto desempenho. As consultas √† plataforma podem ser realizados em ANSI SQL (uma linguagem de consultas segundo o padr√£o americano). O pacote basedosdados oferece algumas fun√ß√µes auxiliares para simplificar o processo de submiss√£o de uma query.\nAntes de explorar as fun√ß√µes do pacote, √© necess√°rio que voc√™ crie um projeto na GCP, pois o BigQuery do BD+ √© apenas o reposit√≥rio dos dados: a execu√ß√£o das queries propriamente ditas √© realizada e cobrada na ponta que submeteu as queries. Ou seja, tipicamente voc√™ criaria uma query para ser executada tomando como refer√™ncia o BigQuery do BD+, mas os custos de execu√ß√£o ficam atrelados √† sua pr√≥pria conta GCP. Entretanto, isso n√£o √© motivo para preocupa√ß√£o: a GCP atualmente disponibiliza gratuitamente a manipula√ß√£o de 1 TB de dados/m√™s e o armazenamento de 100 GB para qualquer pessoa.\nPara seguir os pr√≥ximos passos e aprender mais sobre a GCP acesse https://console.cloud.google.com/.\nAcessando o BD+ com o pacote basedosdados\rO pacote basedosdados tem quatro fun√ß√µes: read_sql, download, set_billing_id e get_billing_id. Os ingredientes principais para usar essas fun√ß√µes s√£o o billing_id, que √© o nome da sua conta criada na GCP e query, uma consulta escrita na linguagem SQL pr√≥pria do BigQuery.\nNo exemplo abaixo vamos baixar os PIBs de alguns anos l√° da BD+:\nlibrary(basedosdados)\r# aqui voc√™ define o seu projeto billing_id\rbasedosdados::set_billing_id(\u0026quot;seu_billing_id\u0026quot;)\r# aqui definimos a nossa query\rquery \u0026lt;- \u0026quot;SELECT\rpib.id_municipio,\rpop.ano,\rpib.PIB / pop.populacao * 1000 as pib_per_capita\rFROM `basedosdados.br_ibge_pib.municipios` as pib\rJOIN `basedosdados.br_ibge_populacao.municipios` as pop\rON pib.id_municipio = pop.id_municipio\rLIMIT 20 \u0026quot;\r# aqui carregamos o arquivo para o R\rpib_per_capita \u0026lt;- read_sql(query)\r# tamb√©m seria poss√≠vel baixar o resultado e salv√°-lo em um arquivo .csv\r# download(query, \u0026quot;pib_per_capita.csv\u0026quot;)\rNote que, uma vez que o c√≥digo foi executado, aparece uma mensagem informando uma quantidade de dados que foi consumida na sua conta. At√© que o montante de dados consumido pela sua conta ultrapasse os 100TB, voc√™ n√£o vai precisar fazer nenhum pagamento.\n\rAcessando o BD+ com o pacote bigrquery e dplyr\rCom o pacote bigrquery, que faz parte da iniciativa R-DBI de integra√ß√£o de R e Bancos de Dados, √© poss√≠vel acessar uma inst√¢ncia BigQuery como se acessa qualquer outra base dados e inclusive aproveitar a conveni√™ncia do pacote dbplyr para escrever c√≥digo dplyr que ser√° traduzido diretamente para BigQuery.\nD√™ uma olhada no c√≥digo abaixo, que calcula o IDEB m√©dio por munic√≠pio:\nlibrary(bigrquery)\rlibrary(tidyverse)\rconexao_ideb \u0026lt;- dbConnect(\rbigrquery::bigquery(),\rproject = \u0026quot;basedosdados\u0026quot;,\rdataset = \u0026quot;br_inep_ideb\u0026quot;,\rbilling = \u0026quot;seu_billing_id\u0026quot;\r)\rescola \u0026lt;- tbl(conexao_ideb, \u0026quot;escola\u0026quot;) %\u0026gt;%\rgroup_by(ano, estado_abrev, municipio) %\u0026gt;%\rsummarise(ideb = mean(ideb, na.rm = TRUE)) %\u0026gt;%\r# at√© aqui foi s√≥ dplyr b√°sico\rungroup() %\u0026gt;%\r# a m√°gica acontece nesse collect!\rcollect()\rShow de bola, n√©? Ent√£o vai agora apoiar a galera do BD+ pra garantir que a gente continue contando com uma iniciativa t√£o legal na nossa comunidade!\n\r\rGostou? Quer saber mais?\rAcesse o site do BD+ e todas as suas redes sociais. Veja tamb√©m a nossa live se quiser ver outros c√≥digos parecidos com esses que montamos aqui.\nSe voc√™ quiser aprender um pouco mais sobre manipula√ß√£o de dados com R, d√™ uma olhada no nosso curso R para Ci√™ncia de Dados I e aproveite!\nCaso voc√™ tenha d√∫vidas, entre em contato com a gente pelos coment√°rios aqui embaixo, pelo nosso Discourse ou pelo e-mail contato@curso-r.com.\n\r","permalink":"https://blog.curso-r.com/posts/2021-05-28-basedosdados/","tags":["web scraping","faxina","purrr","rvest"],"title":"Acessando bases p√∫blicas em R: o pacote basedosdados"},{"author":["Beatriz Milz"],"categories":["tutoriais"],"contents":"\rAlguns animes tem muitos fillers, que s√£o epis√≥dios que n√£o se baseiam na hist√≥ria original, e n√£o agregam na hist√≥ria principal. Muitas vezes parece uma enche√ß√£o de lingui√ßa mesmo, contendo diversos epis√≥dios em sequ√™ncia que n√£o contribuem com a hist√≥ria que estamos acompanhando.\nNaruto √© um caso onde existem muuuitos fillers! Ent√£o eu pulo esses epis√≥dios sem d√≥, usando a Lista de epis√≥dios de Naruto Shippuden dispon√≠vel no Wikip√©dia.\nO objetivo deste post √© apresentar uma forma de importar estes dados para o R, para que a gente n√£o precise acessar toda hora a p√°gina do wikipedia consiga fazer uma visualiza√ß√£o da distribui√ß√£o de epis√≥dios fillers ao longo dos 500 epis√≥dios do anime! Vamos l√°, dattebayo!\nColeta de dados com Web Scraping\rVamos usar uma t√©cnica chamada web scraping, que √© baseada em raspar informa√ß√µes de p√°ginas de internet. Primeiro, precisamos buscar o c√≥digo HTML referente √† p√°gina do Wikip√©dia que queremos raspar as informa√ß√µes sobre os epis√≥dios de Naruto Shippuden:\n# Criando um objeto chamado \u0026quot;url_wiki\u0026quot;, que cont√©m a url da p√°gina do wikipedia\rurl_wiki \u0026lt;-\r\u0026quot;https://pt.wikipedia.org/wiki/Lista_de_epis%C3%B3dios_de_Naruto_Shippuden\u0026quot;\r# Lendo o c√≥digo html referente √† p√°gina do wikipedia\r# E salvando em um objeto chamado wikipedia_html\rwikipedia_html \u0026lt;- rvest::read_html(url_wiki)\rO que o objeto wikipedia_html cont√©m?\nwikipedia_html\r## {html_document}\r## \u0026lt;html class=\u0026quot;client-nojs\u0026quot; lang=\u0026quot;pt\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\r## [1] \u0026lt;head\u0026gt;\\n\u0026lt;meta http-equiv=\u0026quot;Content-Type\u0026quot; content=\u0026quot;text/html; charset=UTF-8 ...\r## [2] \u0026lt;body class=\u0026quot;skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr ...\rEsse objeto apresenta o c√≥digo HTML referente √† p√°gina que queremos raspar!\nBuscando informa√ß√µes sobre a primeira temporada\rAgora precisamos descobrir como acessar as informa√ß√µes que queremos. Olhando a p√°gina, podemos ver que os dados de cada temporada est√£o apresentados em uma tabela diferente. Vamos tentar primeiramente buscar as informa√ß√µes para a tabela referente √† primeira temporada, e quando este c√≥digo estiver funcionando bem, podemos adaptar o c√≥digo para buscar os dados das outras temporadas!\nEstou utilizando o navegador Google Chrome, e esse navegador tem uma op√ß√£o que ajuda muito a explorar o c√≥digo: o inspetor de elementos! Para acessar essa ferramenta, voc√™ pode usar o atalho Ctrl + Shift + C, ou clicando no menu superior: ‚ÄúVisualizar‚Äù \u0026gt; ‚ÄúDesenvolvedor‚Äù \u0026gt; ‚ÄúInspecionar elementos‚Äù. Caso voc√™ utilize outro navegador, recomendo que procure o equivalente ao inspetor de elementos deste navegador.\nAo acessar o inspetor de elementos, podemos navegar com o cursor e conseguir visualizar o c√≥digo equivalente a essa parte da p√°gina. Uma forma de localizar conte√∫dos dentro do HTMl √© utilizando o XPath. Na imagem a seguir, √© poss√≠vel ver que selecionei a tabela referente √† primeira temporada, e ao apertar o c√≥digo na √°rea Elements com o bot√£o direito do mouse, √© poss√≠vel copiar o XPath navegando em ‚ÄúCopy‚Äù \u0026gt; ‚ÄúCopy XPath‚Äù:\nO XPath copiado √©: //*[@id=\"mw-content-text\"]/div[1]/table[4]. Com isso, podemos acessar os conte√∫dos da tabela:\n# Carregando o pipe do pacote magrittr\rlibrary(magrittr, include.only = \u0026quot;%\u0026gt;%\u0026quot;)\r# Podemos buscar o conte√∫do com o xpath,\r# e as tabelas que est√£o presentescom a fun√ß√£o html_table()\rtabela \u0026lt;- \u0026quot;https://pt.wikipedia.org/wiki/Lista_de_epis%C3%B3dios_de_Naruto_Shippuden\u0026quot; %\u0026gt;%\r# ler o html\rrvest::read_html() %\u0026gt;%\r# buscar o xpath\rrvest::html_node(xpath = \u0026#39;//*[@id=\u0026quot;mw-content-text\u0026quot;]/div[1]/table[4]\u0026#39;) %\u0026gt;%\r# ler a tabela\rrvest::html_table()\rVamos observar essa tabela referente √† primeira temporada: ela cont√©m algumas colunas repetidas, e existe mais de uma linha com informa√ß√µes para o mesmo epis√≥dio. Ser√° necess√°rio fazer uma leve faxina de dados antes de analisar os dados!\ndplyr::glimpse(tabela)\r## Rows: 90\r## Columns: 5\r## $ N¬∫ \u0026lt;int\u0026gt; 1, 1, NA, 2, 2, NA, 3, 3, NA, 4, 4, NA, 5, 5,‚Ä¶\r## $ `T√≠tulo original` \u0026lt;chr\u0026gt; \u0026quot;Volta para Casa\u0026quot;, \u0026quot;Â∏∞ÈÉ∑\u0026quot;, \u0026quot;\u0026quot;, \u0026quot;A Akatsuki se‚Ä¶\r## $ `T√≠tulo original` \u0026lt;chr\u0026gt; \u0026quot;Volta para Casa\u0026quot;, \u0026quot;Kiky≈ç\u0026quot;, \u0026quot;\u0026quot;, \u0026quot;A Akatsuki s‚Ä¶\r## $ `T√≠tulo(s) em portugu√™s` \u0026lt;chr\u0026gt; \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;‚Ä¶\r## $ `Data de estreia` \u0026lt;chr\u0026gt; \u0026quot;15 de Fevereiro de 2007\u0026quot;, \u0026quot;15 de Fevereiro d‚Ä¶\rAntes de avan√ßarmos, vamos fazer uma pr√©-faxina leve: adicionar o n√∫mero da temporada na base, e transformar o n√∫mero do epis√≥dio em texto (j√° que a informa√ß√£o se √© filler ou n√£o aparece nessa coluna, mas nem todas as temporadas tem fillers - assim padronizamos e evitamos erros posteriormente).\ntabela %\u0026gt;%\r# limpar os nomes das vari√°veis\rjanitor::clean_names() %\u0026gt;%\r# adicionando o n√∫mero da temporada\rdplyr::mutate(numero_temporada = 1,\r# transforma a vari√°vel `no` em texto\rno = as.character(no)) %\u0026gt;%\rdplyr::glimpse()\r## Rows: 90\r## Columns: 6\r## $ no \u0026lt;chr\u0026gt; \u0026quot;1\u0026quot;, \u0026quot;1\u0026quot;, NA, \u0026quot;2\u0026quot;, \u0026quot;2\u0026quot;, NA, \u0026quot;3\u0026quot;, \u0026quot;3\u0026quot;, NA, \u0026quot;4\u0026quot;, \u0026quot;‚Ä¶\r## $ titulo_original \u0026lt;chr\u0026gt; \u0026quot;Volta para Casa\u0026quot;, \u0026quot;Â∏∞ÈÉ∑\u0026quot;, \u0026quot;\u0026quot;, \u0026quot;A Akatsuki se Mo‚Ä¶\r## $ titulo_original_2 \u0026lt;chr\u0026gt; \u0026quot;Volta para Casa\u0026quot;, \u0026quot;Kiky≈ç\u0026quot;, \u0026quot;\u0026quot;, \u0026quot;A Akatsuki se M‚Ä¶\r## $ titulo_s_em_portugues \u0026lt;chr\u0026gt; \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;\u0026quot;, ‚Ä¶\r## $ data_de_estreia \u0026lt;chr\u0026gt; \u0026quot;15 de Fevereiro de 2007\u0026quot;, \u0026quot;15 de Fevereiro de 2‚Ä¶\r## $ numero_temporada \u0026lt;dbl\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶\rJ√° est√° um pouco mais claro o que a base cont√©m, n√©?\n\rBuscando informa√ß√µes de todas as temporadas!\rNa etapa anterior, conseguimos obter a tabela da primeira temporada. Podemos criar uma fun√ß√£o para buscar as informa√ß√µes de outras temporadas tamb√©m!\nOlhando as tabelas das outras temporadas, √© poss√≠vel observar que o XPath segue o mesmo padr√£o, alterando apenas o n√∫mero ao final. Isso ser√° um argumento na fun√ß√£o, chamado n_tabela. O outro argumento que √© interessante adicionar na fun√ß√£o √© o n√∫mero da temporada: numero_temporada.\nbuscar_tabela \u0026lt;- function(n_tabela, numero_temporada) {\r# link da p√°gina\r\u0026quot;https://pt.wikipedia.org/wiki/Lista_de_epis%C3%B3dios_de_Naruto_Shippuden\u0026quot; %\u0026gt;%\r# l√™ o htmo\rrvest::read_html() %\u0026gt;%\r# procura pelo xpath\rrvest::html_node(xpath = glue::glue(\u0026#39;//*[@id=\u0026quot;mw-content-text\u0026quot;]/div[1]/table[{n_tabela}]\u0026#39;)) %\u0026gt;%\r# l√™ a tabela\rrvest::html_table() %\u0026gt;%\r# limpar os nomes das vari√°veis\rjanitor::clean_names() %\u0026gt;%\r# adicionando o numero da temporada como uma variavel\r# e padronizando o numero do episodio para texto\rdplyr::mutate(numero_temporada, no = as.character(no))\r}\rOs n√∫meros ao final do XPath se iniciam no n√∫mero 4, e s√£o incrementados de 2 em 2. Portanto, neste caso, os XPath est√£o organizados dessa forma:\n\rTemporada 1: //*[@id=\"mw-content-text\"]/div[1]/table[4]\rTemporada 2: //*[@id=\"mw-content-text\"]/div[1]/table[6]\rTemporada 3: //*[@id=\"mw-content-text\"]/div[1]/table[8]\r‚Ä¶‚Ä¶\rTemporada 20: //*[@id=\"mw-content-text\"]/div[1]/table[42]\r\rPodemos criar uma sequ√™ncia com a fun√ß√£o seq(), para para buscar todas as tabelas de uma vez, sendo que a sequ√™ncia deve come√ßar no n√∫mero 4, e incrementar de 2 em 2, at√© o n√∫mero 42, formando um vetor de 20 n√∫meros (referente √†s 20 temporadas).\nPodemos usar a fun√ß√£o purrr::map2_dfr() para aplicar a fun√ß√£o buscar_tabela() para buscar as informa√ß√µes das tabelas de todas as temporadas, e unir em uma √∫nica base.\ntabela_bruta \u0026lt;-\rpurrr::map2_dfr(.x = seq(from = 4, to = 42, by = 2),\r# A sequencia come√ßa em 4 e vai at√© 42, contando de 2 em 2.\r# assim teremos um vetor com 20 n√∫meros, referente √†s\r# 20 temporadas! Isso ser√° usado no primeiro argumento\r# da fun√ß√£o buscar_tabela, ou seja,\r# no argumento `n_tabela`.\r.y = 1:20, # isso ser√° usado no segundo argumento\r# da funcao buscar_tabela, ou seja,\r# no argumento `numero_temporada`.\r.f = buscar_tabela # fun√ß√£o que queremos utilizar\r)\r\r\rFaxina\rConseguimos baixar tudo e salvar em uma √∫nica base: tabela_bruta, por√©m essa base precisa ser limpa. Vamos tentar descobrir os problemas? A fun√ß√£o dplyr::glimpse() √© √∫til para dar uma olhada na base:\ndplyr::glimpse(tabela_bruta)\r## Rows: 1,500\r## Columns: 6\r## $ no \u0026lt;chr\u0026gt; \u0026quot;1\u0026quot;, \u0026quot;1\u0026quot;, NA, \u0026quot;2\u0026quot;, \u0026quot;2\u0026quot;, NA, \u0026quot;3\u0026quot;, \u0026quot;3\u0026quot;, NA, \u0026quot;4\u0026quot;, \u0026quot;‚Ä¶\r## $ titulo_original \u0026lt;chr\u0026gt; \u0026quot;Volta para Casa\u0026quot;, \u0026quot;Â∏∞ÈÉ∑\u0026quot;, \u0026quot;\u0026quot;, \u0026quot;A Akatsuki se Mo‚Ä¶\r## $ titulo_original_2 \u0026lt;chr\u0026gt; \u0026quot;Volta para Casa\u0026quot;, \u0026quot;Kiky≈ç\u0026quot;, \u0026quot;\u0026quot;, \u0026quot;A Akatsuki se M‚Ä¶\r## $ titulo_s_em_portugues \u0026lt;chr\u0026gt; \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;\u0026quot;, ‚Ä¶\r## $ data_de_estreia \u0026lt;chr\u0026gt; \u0026quot;15 de Fevereiro de 2007\u0026quot;, \u0026quot;15 de Fevereiro de 2‚Ä¶\r## $ numero_temporada \u0026lt;int\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶\rVamos ent√£o listar os problemas para arrumar e deixar a base tidy:\nTem vari√°veis que est√£o duplicadas, como o t√≠tulo do epis√≥dio;\n\rA data de estreia do epis√≥dio est√° como tipo texto;\n\rA informa√ß√£o se o epis√≥dio √© filler est√° contido na vari√°vel do n√∫mero do epis√≥dio;\n\rQueremos apenas uma linha por epis√≥dio;\n\r\rVamos ent√£o fazer uma faxina nessa base, e deixar ela tidy! Vamos come√ßar tentando resolver os itens 1 √† 3:\ntabela_faxinando \u0026lt;- tabela_bruta %\u0026gt;%\r# separar a coluna `no` em: `numero_episodio` e `tipo_episodio`\rtidyr::separate(no, into = c(\u0026quot;numero_episodio\u0026quot;, \u0026quot;tipo_episodio\u0026quot;), \u0026quot;\\\\(\u0026quot;, extra = \u0026quot;merge\u0026quot;) %\u0026gt;%\rdplyr::mutate(\r# transformar a variavel `numero_episodio` em tipo num√©rico\rnumero_episodio = readr::parse_number(numero_episodio),\r# remover o parenteses desnecess√°rio na vari√°vel tipo_episodio\rtipo_episodio = stringr::str_replace_all(tipo_episodio, \u0026quot;\\\\)\u0026quot;, \u0026quot;\u0026quot;),\r# Na variavel `tipo_episodio`, quando est√° vazio √© porque faz\r# parte da hist√≥ria principal (√© chamado de Can√¥nico).\r# Ent√£o vamos usar dplyr::case_when() para arrumar essa vari√°vel.\rtipo_episodio = dplyr::case_when(\ris.na(tipo_episodio) ~ \u0026quot;Canon\u0026quot;,\rtipo_episodio == \u0026quot;¬Ωfiller\u0026quot; ~ \u0026quot;Semi-filler\u0026quot;,\rTRUE ~ tipo_episodio\r),\r# transformar a variavel `data_de_estreia` em tipo data\rdata_de_estreia = readr::parse_date(\rdata_de_estreia,\rformat = \u0026quot;%d de %B de %Y\u0026quot;,\rlocale = readr::locale(\u0026quot;pt\u0026quot;)\r)\r) %\u0026gt;%\r# remover colunas repetidas do titulo do episodio\rdplyr::select(-titulo_original, -titulo_original_2) %\u0026gt;%\r# renomeia para deixar o nome da vari√°vel mais claro\rdplyr::rename(\u0026quot;titulo_episodio\u0026quot; = titulo_s_em_portugues) %\u0026gt;%\r# move a coluna numero_temporada para o inicio\rdplyr::relocate(numero_temporada, .before = numero_episodio)\rArrumamos algumas coisas j√°, e a tabela est√° bem melhor: n√£o tem mais vari√°veis duplicadas, os nomes das vari√°veis est√£o padronizados, as classes das vari√°veis tamb√©m est√£o adequadas:\ndplyr::glimpse(tabela_faxinando)\r## Rows: 1,500\r## Columns: 5\r## $ numero_temporada \u0026lt;int\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,‚Ä¶\r## $ numero_episodio \u0026lt;dbl\u0026gt; 1, 1, NA, 2, 2, NA, 3, 3, NA, 4, 4, NA, 5, 5, NA, 6, ‚Ä¶\r## $ tipo_episodio \u0026lt;chr\u0026gt; \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;,‚Ä¶\r## $ titulo_episodio \u0026lt;chr\u0026gt; \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;\u0026quot;, \u0026quot;Os A‚Ä¶\r## $ data_de_estreia \u0026lt;date\u0026gt; 2007-02-15, 2007-02-15, NA, 2007-02-15, 2007-02-15, ‚Ä¶\rAgora vamos arrumar algo muito importante: queremos que cada linha represente um epis√≥dio √∫nico.\nepisodios_naruto_shippuden \u0026lt;- tabela_faxinando %\u0026gt;%\r# remover os NA`s presentes na coluna `numero_episodio`\rtidyr::drop_na(numero_episodio) %\u0026gt;%\r# aqui teremos duas linhas por epis√≥dio, sendo que elas est√£o repetidas.\r# a fun√ß√£o dplyr::distinct() permitir√° descartar as linhas repetidas\rdplyr::distinct()\rPronto! Agora temos na tabela apenas uma linha por epis√≥dio. Podemos verificar isso com o dplyr::glimpse() novamente: a s√©rie tem 500 epis√≥dios, e a base gerada cont√©m 500 linhas.\ndplyr::glimpse(episodios_naruto_shippuden)\r## Rows: 500\r## Columns: 5\r## $ numero_temporada \u0026lt;int\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,‚Ä¶\r## $ numero_episodio \u0026lt;dbl\u0026gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16‚Ä¶\r## $ tipo_episodio \u0026lt;chr\u0026gt; \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;, \u0026quot;Canon\u0026quot;,‚Ä¶\r## $ titulo_episodio \u0026lt;chr\u0026gt; \u0026quot;Voltando Para Casa\u0026quot;, \u0026quot;Os Akatsuki Entram em A√ß√£o\u0026quot;, \u0026quot;‚Ä¶\r## $ data_de_estreia \u0026lt;date\u0026gt; 2007-02-15, 2007-02-15, 2007-02-22, 2007-03-01, 2007‚Ä¶\rAl√©m disso, conseguimos conferir a quantidade de epis√≥dios filler:\nepisodios_naruto_shippuden %\u0026gt;%\rdplyr::count(tipo_episodio, sort = TRUE) %\u0026gt;%\rknitr::kable(col.names = c(\u0026quot;Tipo de epis√≥dio\u0026quot;, \u0026quot;N√∫mero de epis√≥dios\u0026quot;))\r\r\rTipo de epis√≥dio\rN√∫mero de epis√≥dios\r\r\r\rCanon\r259\r\rFiller\r188\r\rNovel\r25\r\rSemi-filler\r23\r\rGaiden\r4\r\rOmake\r1\r\r\r\r\rVisualiza√ß√£o\rAgora que j√° temos a base arrumada, podemos fazer uma visualiza√ß√£o para descobrir a distribui√ß√£o de epis√≥dios fillers no anime. A visualiza√ß√£o abaixo est√° separada por temporada, sendo que a ordem dos epis√≥dios no gr√°fico √©: inicia no canto inferior esquerdo, e sobe em dire√ß√£o ao canto superior esquerdo.\n# Criando a paleta de cores para usar\rpaleta \u0026lt;- c(\u0026quot;#fe7934\u0026quot;,\r\u0026quot;#5b8cb9\u0026quot;,\r\u0026quot;#083b7c\u0026quot;,\r\u0026quot;#e1e020\u0026quot;,\r\u0026quot;#ba1820\u0026quot;,\r\u0026quot;#403e4b\u0026quot;)\r# O pacote que disponibiliza a fun√ß√£o ggwaffle √©:\r# devtools::install_github(\u0026quot;hrbrmstr/waffle\u0026quot;)\r# Criando a visualiza√ß√£o:\rgrafico \u0026lt;- episodios_naruto_shippuden %\u0026gt;%\rdplyr::count(numero_temporada, numero_episodio, tipo_episodio) %\u0026gt;%\rdplyr::mutate(tipo_episodio = forcats::fct_relevel(\rtipo_episodio,\rc(\u0026quot;Canon\u0026quot;, \u0026quot;Omake\u0026quot;, \u0026quot;Novel\u0026quot;, \u0026quot;Gaiden\u0026quot;, \u0026quot;Semi-filler\u0026quot;, \u0026quot;Filler\u0026quot;)\r)) %\u0026gt;%\rggplot2::ggplot(ggplot2::aes(fill = tipo_episodio, values = n)) +\rwaffle::geom_waffle(\rn_rows = 5,\rcolor = \u0026quot;white\u0026quot;,\rshow.legend = TRUE,\ralpha = 0.9\r) +\rggplot2::facet_wrap( ~ numero_temporada) +\rggplot2::theme_void() +\rggplot2::scale_fill_manual(values = paleta) +\rggplot2::labs(fill = \u0026quot;Tipo de epis√≥dio\u0026quot;,\rtitle = \u0026quot;Temporadas de Naruto Shippuden \\n\u0026quot;) +\rggplot2::theme(\rtext = ggplot2::element_text(family = \u0026quot;Ninja Naruto\u0026quot;, color = \u0026quot;white\u0026quot;),\rplot.margin = ggplot2::margin(.5, .5, .5, .5, \u0026quot;cm\u0026quot;),\rplot.title = ggplot2::element_text(\rhjust = 0.5,\rsize = 20,\rcolor = paleta[3]\r),\rlegend.position = \u0026quot;bottom\u0026quot;\r)\r# Imagem que usaremos de fundo\rimagem \u0026lt;-\r\u0026quot;https://uploaddeimagens.com.br/images/003/256/849/full/Monumento_dos_Hokage.jpg?1621801239\u0026quot;\r# Colocando uma imagem de fundo\rggimage::ggbackground(gg = grafico,\rbackground = imagem)\rEdit: Comentaram que a paleta de cores n√£o facilitou a visualiza√ß√£o para pessoas dalt√¥nicas, ent√£o fiz uma vers√£o com a paleta viridis (obrigada Luiz Paulo Carvalho!):\ngrafico_viridis \u0026lt;- grafico +\rggplot2::scale_fill_viridis_d()\rggimage::ggbackground(gg = grafico_viridis,\rbackground = imagem)\rAs √∫nicas temporadas livres de fillers s√£o a primeira e a segunda! Depois de concluir essas temporadas √© importante ficar de olho na lista para n√£o acabar assistindo os epis√≥dios de enrola√ß√£o.\n\rConclus√£o\rEspero que esse post tenha sido interessante, e seja √∫til para quem n√£o quer perder tempo com fillers quem deseja obter algum conte√∫do do Wikip√©dia de forma mais f√°cil!\nTchau! At√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2021-05-24-naruto/","tags":["web scraping","faxina","purrr","rvest"],"title":"Buscando informa√ß√µes na Wikip√©dia: Lista de epis√≥dios de Naruto Shippuden"},{"author":["Fernando"],"categories":["pacotes"],"contents":"\rVoc√™ provavelmente j√° sabe que o pacote ggplot2 √© uma super ferramenta para constru√ß√£o de gr√°ficos, mas voc√™ sabia que tamb√©m √© poss√≠vel construir composi√ß√µes com v√°rios gr√°ficos sem nenhuma dificuldade? Essa √© exatamente a fun√ß√£o do pacote patchwork e hoje n√≥s vamos conversar um pouco sobre essa que √© uma das express√µes mais importantes do pacote ggplot2.\nIdeia geral\rO pacote patchwork parte de v√°rios objetos ggplot2, nomeados por exemplo como g1, g2, g3, e nos fornece ferramentas para declarar de que forma esses gr√°ficos ser√£o posicionados em uma figura maior. Veja o exemplo abaixo em que colocamos tr√™s figuras lado a lado:\nlibrary(patchwork)\rlibrary(ggplot2)\rlibrary(magrittr)\r# primeiro grafico\rg1 \u0026lt;- dados::pinguins %\u0026gt;%\rggplot(aes(x = comprimento_bico, y = profundidade_bico)) +\rgeom_point()\r# segundo grafico\rg2 \u0026lt;- dados::pinguins %\u0026gt;%\rggplot(aes(x = profundidade_bico)) +\rgeom_density()\r# terceiro grafico\rg3 \u0026lt;- dados::pinguins %\u0026gt;%\rggplot(aes(x = comprimento_bico)) +\rgeom_density()\r# codigo usando o pacote patchwork\r# aqui usamos esse operador \u0026#39;+\u0026#39; (que tamb√©m poderia ser `|`), que fica dispon√≠vel\r# quando carregamos o pacote\rg1 + g2 + g3\rNesse nosso exemplo, utilizamos o operador + para colocar os gr√°ficos lado a lado, ou seja, para criar colunas novas. Se o nosso objetivo fosse criar linhas, precisar√≠amos usar o operador /, que normalmente representa divis√µes no contexto aritm√©tico. Essa escolha por parte de quem desenvolveu o pacote se d√° pelo fato dos divisores (o que vem √† esquerda do operador de divis√£o) serem posicionados na parte inferior das fra√ß√µes. Veja o exemplo abaixo:\n# codigo usando o pacote patchwork\r# aqui usamos esse operador \u0026#39;/\u0026#39;, que fica dispon√≠vel\r# quando carregamos o pacote\rg1 / g2 / g3\rO verdadeiro poder do pacote patchwork se revela quando misturamos essas duas opera√ß√µes e (s )s para organizar nosso c√≥digo:\n# codigo usando o pacote patchwork\r# aqui usamos esse operador \u0026#39;/\u0026#39;, que fica dispon√≠vel\r# quando carregamos o pacote\r(g1 + g2) / g3\r# exemplo mais maluco, podemos misturar quantos gr√°ficos a gente quiser e do jeito que a gente quiser:\r(g1+((g1 + g2) / g3))/g3\r\rIncluindo elementos que n√£o s√£o gr√°ficos: o pacote gridExtra\rA l√≥gica geral do pacote patchwork tamb√©m funciona com outros tipos de objetos, como textos e tabelas. Entretanto, as opera√ß√µes que vimos at√© agora s√≥ funcionam se estivermos misturando gr√°ficos do ggplot2 ou grobs oriundos dos pacotes grid e gridExtra. No exemplo abaixo, podemos ver como incluir tabelas e textos usando as fun√ß√µes gridExtra::tableGrob e gridExtra::textGrob\n# Exemplo com gr√°fico\r# primeira linha\r(g1 + grid::textGrob(\u0026quot;Todos os gr√°ficos indicam que est√°\\nrolando uma parad bi-modal.\u0026quot;))/\r# segunda linha\r(g2+g3)\rtabela \u0026lt;- dados::pinguins %\u0026gt;%\rdplyr::summarise(\rcomprimento_bico = mean(comprimento_bico, na.rm = TRUE),\rprofundidade_bico = mean(profundidade_bico, na.rm = TRUE)\r) %\u0026gt;%\rtidyr::pivot_longer(dplyr::everything(), names_to = \u0026quot;Vari√°vel\u0026quot;, values_to = \u0026quot;M√©dia\u0026quot;)\r# Exemplo com tabela\r# primeira linha\r(g1 + gridExtra::tableGrob(tabela, rows = c(\u0026quot;\u0026quot;, \u0026quot;\u0026quot;)))/\r# segunda linha\r(g2+g3)\r\rModificando a composi√ß√£o\rAt√© agora n√≥s vimos como montar o que aparecer√° na tela, partindo de objetos pr√©-prontos, mas o patchwork tamb√©m permite que fa√ßamos algumas mudan√ßas na composi√ß√£o final, tanto usando os estilos comuns do ggplot2 quanto usando as fun√ß√µes plot_annotation, para incluir t√≠tulos e subt√≠tulos, e plot_layouts, para manipular larguras e posicionamentos. Veja o exemplo abaixo, que utiliza todas essas funcionalidades.\n((\r# gr√°fico\r(# primeira coluna\r(g2 / g3) |\r# segunda coluna\rg1) +\r# alterando a largura\rplot_layout(widths = c(1, 2)\r)\r) +\r#\rplot_annotation(\rtitle = \u0026quot;Compara√ß√£o entre os a profundidade e o comprimento dos bicos\u0026quot;,\rsubtitle = \u0026quot;Os graficos indicam a presen√ßa de uma distribui√ß√£o bimodal, possivelmente porque existem v√°rias esp√©cies na base.\u0026quot;,\rcaption = \u0026quot;Fonte: github.com/cienciadedatos/dados\u0026quot;\r)) \u0026amp;\r# trocando os temas para branco. o operador `\u0026amp;` garante que o tema ser√° aplicado\r# a todos os sub-plots\rtheme_bw()\r\rConsidera√ß√µes finais\rEssas s√£o as principais funcionalidades do pacote patchwork, a riqueza de possibilidades surge das suas combina√ß√µes. Para mais detalhes, visite o site com a documenta√ß√£o oficial do pacote.\n\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre RMarkdown e Visualiza√ß√£o de Dados em geral, d√™ uma olhada no nosso curso Relat√≥rios e visualiza√ß√£o de dados e aproveite!\n\r","permalink":"https://blog.curso-r.com/posts/2021-05-19-patchwork/","tags":["ggplot2"],"title":"Como unir v√°rios gr√°ficos feitos em ggplot2: o pacote patchwork"},{"author":["Caio"],"categories":["discuss√µes"],"contents":"\r\rA profecia estava correta: o R finalmente vai ganhar um pipe pr√≥prio, embutido\r√† linguagem em si. Mais de 7 anos depois do\rprimeiro commit\rdo {magrittr}, o %\u0026gt;%, operador com o qual compartilhamos tantas boas\rmem√≥rias, s√≠mbolo do R moderno e inspira√ß√£o para o logo da\rCurso-R, vai se tornar obsoleto. De acordo com a\ragenda do R Project, no badalar da\rmeia-noite do dia 18/05/2021 ser√° lan√ßada oficialmente a vers√£o 4.1.0 (‚ÄúCamp\rPontanezen‚Äù) do R, contendo, dentre outras novidades, suporte para o operador\r|\u0026gt;.\nDevo admitir que estou um pouco triste com a despedida, como se eu estivesse\rprestes a mudar de casa: pode ser que a casa nova seja melhor e maior, mas, de\ruma forma ou de outra, estou abandonando um lugar que foi palco de v√°rias boas\rmem√≥rias por um lugar est√©ril e inerte‚Ä¶\nS√≥ que mesmo assim n√≥s seguimos em frente e mudamos de casa! As lembran√ßas n√£o\rv√£o embora e temos a oportunidade de criar mais boas mem√≥rias com esse novo\rplano de fundo. Sendo assim, vamos entender as principais mudan√ßas do R 4.1 e,\rprincipalmente, como usar o novo pipe.\nO novo pipe: |\u0026gt;\r√Ä primeira vista, o novo pipe √© igual ao antigo: usado no final de uma linha\rpara passar o resultado do que est√° √† sua esquerda como primeiro argumento da\rlinha debaixo. Aqui temos um exemplo simples do uso mais comum dos pipes:\nlibrary(dplyr)\r# Uma pipeline com o pipe novo\rstarwars |\u0026gt;\rgroup_by(species, sex) |\u0026gt;\rselect(species, sex, height) |\u0026gt;\rsummarise(height = mean(height, na.rm = TRUE)) |\u0026gt;\rpull(height) |\u0026gt;\rsummary()\r#\u0026gt; Min. 1st Qu. Median Mean 3rd Qu. Max. #\u0026gt; 66.0 163.0 181.3 173.5 196.0 264.0\rAs diferen√ßas aparecem quanto tentamos usar o ., a saber, o dot placeholder.\rBem comum no antigo pipe, o uso do . para escolher onde a substitui√ß√£o deve\rocorrer √© simplesmente proibido no novo pipe. Essa decis√£o foi tomada porque o\r. gera situa√ß√µes amb√≠guas como a descrita a seguir:\n# Vamos gerar essa string a partir de \u0026quot;-\u0026quot; %\u0026gt;% paste0()\r\u0026quot;-\u0026gt;\u0026lt;-\u0026quot;\r#\u0026gt; [1] \u0026quot;-\u0026gt;\u0026lt;-\u0026quot;\r# Podemos come√ßar colando o h√≠fen na esquerda\r\u0026quot;-\u0026quot; %\u0026gt;%\rpaste0(\u0026quot;\u0026gt;\u0026quot;)\r#\u0026gt; [1] \u0026quot;-\u0026gt;\u0026quot;\r# Agora adicionamos o . para colar na direita tamb√©m...\r# Mas isso d√° errado!\r\u0026quot;-\u0026quot; %\u0026gt;%\rpaste0(\u0026quot;\u0026gt;\u0026lt;\u0026quot;, .)\r#\u0026gt; [1] \u0026quot;\u0026gt;\u0026lt;-\u0026quot;\r# Precisamos colocar o . em dois lugares diferentes,\r# incluindo, contraintuitivamente, no primeiro argumento\r\u0026quot;-\u0026quot; %\u0026gt;%\rpaste0(., \u0026quot;\u0026gt;\u0026lt;\u0026quot;, .)\r#\u0026gt; [1] \u0026quot;-\u0026gt;\u0026lt;-\u0026quot;\rAssim, em troca de nunca mais precisar carregar o {magrittr}, usar\rusethis::use_pipe() ou se preocupar com o ambiente do {future}, vamos ser\robrigados a criar fun√ß√µes parciais que sempre esperam a substitui√ß√£o no seu\rprimeiro argumento. Mas, falando em fun√ß√µes, chegamos √† segunda maior novidade\rdo R 4.1‚Ä¶\n\rFun√ß√µes an√¥nimas: \\(x)\rSe voc√™ se acostumou com a nota√ß√£o de f√≥rmulas do {purrr}, ent√£o fun√ß√µes\ran√¥nimas n√£o s√£o nada de novo. Tamb√©m conhecidas como lambdas, fun√ß√µes\ran√¥nimas n√£o passam de fun√ß√µes que n√£o precisam receber um nome, ou seja, podem\rser utilizadas pelo programa na hora de sua cria√ß√£o. No caso do {purrr} isso\rse dava atrav√©s de uma gambiarra feita em cima das f√≥rmulas (~.x), mas, ainda\rassim, isso era melhor do que a sintaxe bastante prolixa que o R b√°sico exigia\r(function(x) x).\nA nova sintaxe √©, na minha opini√£o, bastante melhor que a estrat√©gia do\r{purrr}. Apesar de ela ser um pouco mais extensa, ela funciona em todos os\rlugares (n√£o s√≥ no tidyverse), permite nomes arbitr√°rios para os argumentos e\rn√£o bagun√ßa a fun√ß√£o do ~. A nova fun√ß√£o an√¥nima √© declarada com uma barra\robl√≠qua para a esquerda seguida por todos os argumentos entre par√™nteses e o\rc√≥digo; essencialmente, √© igual √† nota√ß√£o antiga, mas function vira \\. A\rescolha do s√≠mbolo \\ tamb√©m √© √≥tima, pois √© igual √† de\routras linguagens e porque lembra\rum Œª (lambda) com a perna cortada. Para comparar todas as diferentes nota√ß√µes,\rsegue um breve exemplo (sa√≠das suprimidas):\nlibrary(purrr)\r# Sem fun√ß√£o an√¥nima\rsoma_um \u0026lt;- function(x) {\rx + 1\r}\rmap(1:10, soma_um)\r# A nota√ß√£o antiga do {base} √© extensa\rmap(1:10, function(x) x + 1)\r# A nota√ß√£o do {purrr} for√ßa o .x\rmap(1:10, ~ .x + 1)\r# A nota√ß√£o nova permite qualquer nome\rmap(1:10, \\(n) n + 1)\r# A nota√ß√£o nova funciona fora do tidyverse\rlapply(1:10, \\(x) x + 1)\r# Para mais de 2 argumentos, o {purrr} muda\rpmap(list(1:10, 11:20, 21:30), ~ ..1 + ..2 + ..3)\r# A nota√ß√£o nova continua consistente\rpmap(list(1:10, 11:20, 21:30), \\(x, y, z) x + y + z)\rDe quebra, na minha opini√£o, tamb√©m ser√° muito mais f√°cil de ensinar o \\(x) do\rque o ~.x. A nota√ß√£o √© intuitiva, consistente e funciona fora do tidyverse,\rent√£o, para mim, o novo lambda √© at√© mais interessante do que o novo pipe!\n\rMiscel√¢nea\rDependendo de quando voc√™ estiver lendo este post, a vers√£o 4.1 j√° vai ter\rpassado pelo code freeze que est√° agendado\rpara 11/05/2021, que √© quando n√£o s√£o mais permitidas altera√ß√µes no c√≥digo da\rnova vers√£o e ela se torna uma release candidate. Conforme escrevo ainda\rest√£o permitidas altera√ß√µes no c√≥digo, ent√£o pode ser que alguma coisa mude at√©\ro lan√ßamento final do R 4.1, mas o grosso n√£o deve mudar muito.\nAssim, para te poupar desse trabalho, eu li o\rNEWS da nova vers√£o\ra fim de saber quais s√£o as novidades mais interessantes do 4.1. Fora o novo\rpipe e o novo lambda, achei algumas coisas dignas de nota:\n\rUsar c() para combinar fatores agora retorna um fator que tamb√©m combina\rtodos os n√≠veis (de forma similar ao forcats::fct_c());\n\rapply() agora tem um argumento simplify para desabilitar a simplifica√ß√£o\rde resultados;\n\rO novo utilit√°rio ...names() retorna os nomes dos argumentos passados via\r... (possivelmente facilitando o trabalho do {tidyselect});\n\rAs fun√ß√µes URLencode() e URLdecode() agora funcionam com vetores de URIs;\n\rgrep(), sub(), regexp(), etc. ficaram mais r√°pidas para fatores longos\rcom poucos n√≠veis e\n\rduplicated() e anyDuplicated() agora s√£o otimizados para vetores num√©ricos\rj√° ordenados via ALTREP.\n\r\r\rConclus√£o\rSe voc√™ n√£o consegue esperar para testar as novas funcionalidades, j√° √© poss√≠vel\rbaixar a vers√£o beta do R 4.1 diretamente do\rsite do R Project. O time do\rR Core apenas pede que voc√™\rreporte\rquaisquer bugs detectados!\nPara quem √© mais paciente e prefere esperar o lan√ßamento oficial daqui alguns\rdias, abra o seu RStudio, aperte CTRL + SHIFT + M com carinho e agrade√ßa por\rtodas as aventuras patrocinadas pelo pipe. O pacote {magrittr} continuar√° l√°,\rfuncionando, mas cada vez menos relevante‚Ä¶ Apesar de estarmos entrando em uma\rnova fase do R, as lembran√ßas e aprendizados do passado nunca ir√£o embora.\n%\u0026gt;%\n\r","permalink":"https://blog.curso-r.com/posts/2021-05-06-o-novo-pipe-esta-chegando/","tags":["programa√ß√£o","pipe"],"title":"R 4.1: o novo pipe est√° chegando!"},{"author":["Fernando"],"categories":["conceitos"],"contents":"\rQuando voc√™ est√° criando uma apresenta√ß√£o de slides super elegante com o pacote xaringan ou um relat√≥rio minimalista com alguma encarna√ß√£o do pacote rmarkdown, √© normal sentir falta de visualizar o resultado final ao vivo. Essa √© uma funcionalidade muito comum em v√°rios outros softwares de edi√ß√£o de documentos e a falta dela pode ser frustrante no nosso contexto, mesmo que rmarkdown tenha vantagens como flexibilidade e reprodutibilidade.\nNeste post vamos te mostrar dois jeitos de suprir essa necessidade:\nUse a fun√ß√£o xaringan::infinite_moon_reader\rAtualmente o pacote xaringan disponibiliza para n√≥s uma fun√ß√£o chamada xaringan::infinite_moon_reader, que √© uma m√£o na roda principalmente para quem est√° editando slides. O funcionamento √© bastante simples: voc√™ pode chamar essa fun√ß√£o sem nenhum argumento e a janela Viewer do RStudio vai se transformar em uma vers√£o ao vivo do documento que voc√™ estiver editando no momento em que rodar a fun√ß√£o. Voc√™ tamb√©m pode utilizar um argumento moon para ativar o live preview em algum arquivo espec√≠fico que te interesse.\nO gif abaixo, criado pelo pr√≥prio mantenedor principal do xaringan, ilustra muito bem essa funcionalidade.\nknitr::include_graphics(\u0026#39;https://user-images.githubusercontent.com/163582/53144527-35f7a500-3562-11e9-862e-892d3fd7036d.gif\u0026#39;)\r\rFigura 1: Ilustra√ß√£o sobre o pacote rmarkdown, criada por Yihui Xie.\r\r\rUse o Visual Markdown Editing do Rstudio\rDesde setembro do ano passado a janela de edi√ß√£o de texto do RStudio ganhou um novo √≠cone. Quando voc√™ estiver editando um rmd, pode clicar no compasso que fica no canto superior direito da janela e entrar no modo visual editing. Nesse modo, os chunks j√° s√£o convertidos automaticamente no seu output e isso tamb√©m vale para html widgets, f√≥rmulas matem√°ticas em MathJax (aquelas que a gente cria com o s√≠mbolo cifr√£o $) entre outras. N√£o √© t√£o direto quando o infinite_moon_reader, mas para documentos mais complexos pode ser interessante.\nknitr::include_graphics(\u0026#39;https://blog.rstudio.com/2020/09/30/rstudio-v1-4-preview-visual-markdown-editing/images/visual-editing.png\u0026#39;)\r\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre RMarkdown e Visualiza√ß√£o de Dados em geral, d√™ uma olhada no nosso curso Relat√≥rios e visualiza√ß√£o de dados e aproveite!\n\rFigura 2: Ilustra√ß√£o sobre o pacote rmarkdown, criada por Allison Horst.\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-05-05-visualizar-rmd-ao-vivo/","tags":["r-markdown","rstudio"],"title":"Como pr√©-visualizar um relat√≥rio em  RMarkdown"},{"author":["Fernando"],"categories":["an√°lises","conceitos","tutoriais"],"contents":"\r\rL√° no nosso canal do Youtube n√≥s conversamos um pouco sobre alguns conceitos b√°sicos de causalidade. Falamos sobre a import√¢ncia de ter um grafo descrevendo a rela√ß√£o entre as nossas vari√°veis para que a gente n√£o seja enganado pelas correla√ß√µes esp√∫rias, sobre vi√©ses de sele√ß√£o e, no final, mostramos a aplica√ß√£o de um m√©todo para construir um grafo de relacionamento entre as nossas vari√°veis usando o algoritmo PC. Neste post, vamos te mostrar como implementar esse algoritmo nas suas bases de dados.\nEntretanto, antes de implementar o algoritmo, vamos analisar como funciona esse algoritmo.\nFuncionamento geral do algoritmo PC\rA principal ideia por tr√°s do algoritmo PC √© que, dadas tr√™s vari√°veis \\(X\\), \\(Y\\), \\(Z\\), o √∫nico jeito de verificarmos \\(X \\not\\perp Y | Z\\) (isso √©, n√£o X √© independente de Y quando condicionamos no valor da vari√°vel Z) √© se a rela√ß√£o causal entre elas for \\(X \\rightarrow Z \\leftarrow Y\\) (\\(Z\\) √© um colisor). Se \\(X \\perp Y \\ | \\ Z\\) fosse verdade, qualquer uma das setas (ou todas) poderiam estar ao contr√°rio do que est√£o em \\(X \\rightarrow Z \\leftarrow Y\\).\nSendo assim, o algoritmo PC consegue decidir onde fica a ponta de algumas das setinhas usando esse crit√©rio e repetir esses testes sucessivamente. Em linhas gerais, o algoritmo faz o seguinte:\nComece com um grafo em que todas as vari√°veis est√£o conectadas, mas sem a ponta das setas.\rPara todo par de vari√°veis \\(X\\) e \\(Y\\), verifique se \\(X \\perp Y\\). Se a resposta for ‚ÄúSim‚Äù, remova essa conex√£o.\rPara todo par de vari√°veis \\(X\\) e \\(Y\\) e para todo conjunto de vari√°veis \\(S = \\{Z_1, Z_2, ...\\}\\) que n√£o contem \\(X\\) e \\(Y\\), verifique se \\(X \\perp Y \\ | \\ S\\). Se a resposta for ‚ÄúSim‚Äù, remova essa conex√£o.\rPara todas as triplas de vari√°veis que sobraram \\(X - Z - Y\\), verifique se \\(X \\not \\perp Y \\ | \\ Z\\). Se a resposta for ‚ÄúSim‚Äù, oriente essas setinhas na dire√ß√£o de \\(Z\\).\rCaso haja alguma setinha que est√° sem orienta√ß√£o, utilize o resultado dos testes que obteve no passo 3. para eventualmente orientar algumas outras setar por exclus√£o.\r\r\rO algortimo PC no pacote bnlearn\rlibrary(bnlearn)\rlibrary(tidyverse)\rSimilar ao que fizemos na live, aqui vamos procurar um grafo de relacionamentos entre as vari√°veis da base Auto, dispon√≠vel no pacote ISLR. Vamos excluir algumas vari√°veis dessa base e aplicar algumas transforma√ß√µes:\ndados_para_ajuste \u0026lt;- ISLR::Auto %\u0026gt;%\rdplyr::select(-name, -origin) # Vamos excluir algumas vari√°veis estritamente qualitativas\rPara buscar as rela√ß√µes entre as vari√°veis da tabela dados_para_ajuste, basta utilizarmos a fun√ß√£o bnlearn::pc.stable, cujo resultado pode ser plotado usando a fun√ß√£o plot.\ndados_para_ajuste %\u0026gt;% bnlearn::pc.stable(alpha = .01) %\u0026gt;%\rplot()\rBacana, n√©? O melhor √© que √© simples. Esse pacote, inclusive, permite que a gente misture vari√°veis cont√≠nuas e categ√≥rias, basta trocar a op√ß√£o de teste de independ√™ncia no par√¢metro test.\n\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre esse assunto, temos alguns cursos que tocam os temas deste post. D√™ uma olhada nos nossos cursos de Regress√£o Linear ou Machine Learning e aproveite!\nSe voc√™ quiser aprender um pouco mais sobre manipula√ß√£o de dados com R, d√™ uma olhada no nosso curso R para Ci√™ncia de Dados I e aproveite!\nCaso voc√™ tenha d√∫vidas entre em contato com a gente pelos coment√°rios aqui embaixo, pelo nosso Discourse ou pelo e-mail contato@curso-r.com.\n\r","permalink":"https://blog.curso-r.com/posts/2021-04-27-causal-discovery-como-estimar-redes-causais-no-r/","tags":["faxina","modelagem"],"title":"Causal Discovery: como estimar redes causais no R"},{"author":["Fernando"],"categories":["an√°lises","conceitos"],"contents":"\r\rVoc√™ j√° passou pela situa√ß√£o de fazer um gr√°fico e se deparar com uma imagem triste como essa? Quando voc√™ nem sequer consegue ver o que est√° acontecendo porque um ponto est√° deixando a sua escala completamente bagun√ßada?\nEsses dados que dificultam a nossa vida normalmente s√£o chamados de outliers ou tamb√©m de dados discrepantes e pontos fora da curva. Existem muitos jeitos de tratar esse tipo de dados, pois se por um lado ele pode ser um erro da base e deve ser descartado, tamb√©m existem situa√ß√µes em que os outliers s√£o caracter√≠sticas importantes dos seus dados e merecem ser compreendidos em profundidade. Hoje, n√≥s vamos falar sobre uma estrat√©gia r√°pida e f√°cil que tem o potencial de resolver os seus problemas sem te dar dor de cabe√ßa.\nO m√©todo mais comum para encontrar outliers usa o famoso z-score, que nada mais √© que uma transforma√ß√£o de uma vari√°vel \\(X\\) que padroniza a sua posi√ß√£o (pois a m√©dia do z-score √© sempre 0, enquanto a m√©dia de \\(X\\) pode ser qualquer coisa) e a sua escala (pois \\(X\\) pode variar muito ou pouco, com qualquer desvio padr√£o, mas o z-score n√£o. o z-score ter√° sempre desvio padr√£o igual a 1). A f√≥rmula do z-score √©:\n\\[Z_{SCORE} (X) = \\frac{X-M√©dia(X)}{Desvio Padr√£o (X)}\\]\nUma estrat√©gia para encontrar outliers, ent√£o, √© marcar aqueles pontos que, nessa escala, est√£o muito discrepantes. Normalmente se adota um ponto de corte pequeno, como -2 e 2 ou no m√°ximo -3 e 3. Ser√£o considerados outliers todos os pontos que estiverem fora desse intervalo.\nVamos ver o que aconteceria se us√°ssemos essa regra para arrumar o primeiro gr√°fico que mostramos? Primeiro, vamos criar uma base de dados onde poderemos trabalhar. Ela se chamar√° mtcars_com_outliers, como se v√™ abaixo.\nmtcars_com_outliers \u0026lt;- mtcars %\u0026gt;% # aqui vamos incluir os pontos bizarros...\rdplyr::bind_rows(\rtibble::tibble(\rmpg = c(0.1, 1039, 481, 1402),\rwt = c(3.21, 1.8230, 2.6740, 3.6720)\r)\r) \rAgora, vamos criar uma coluna e_outlier que vai nos dizer se estamos falando de um outlier ou n√£o. Para n√£o perder a viagem, tamb√©m vamos fazer um gr√°fico que ajude a identificar visualmente os pontos que podem ser outliers.\nmtcars_com_outliers %\u0026gt;% dplyr::mutate(\rz_score_mpg = (mpg-mean(mpg))/sd(mpg),\re_outlier_mpg = dplyr::if_else(abs(z_score_mpg) \u0026gt; 2, \u0026quot;√â outlier\u0026quot;, \u0026quot;N√£o √© outlier\u0026quot;)\r) %\u0026gt;% ggplot2::ggplot(ggplot2::aes(x = wt, y = mpg, color = e_outlier_mpg)) +\rggplot2::geom_point(size = 3) +\rggplot2::theme_minimal(15) +\rggplot2::labs(x = \u0026quot;Peso do carro\u0026quot;, y = \u0026quot;Consumo de combust√≠vel (milhas/gal√£o)\u0026quot;, color = \u0026quot;\u0026quot;)\rUsamos o ponto de corte 2 e parece que um outlier ficou de fora, n√©? Vamos diminuir um pouco o ponto de corte e ver se a gente consegue pegar esse que ficou fora.\nmtcars_com_outliers %\u0026gt;% dplyr::mutate(\rz_score_mpg = (mpg-mean(mpg))/sd(mpg),\re_outlier_mpg = dplyr::if_else(abs(z_score_mpg) \u0026gt; 1, \u0026quot;√â outlier\u0026quot;, \u0026quot;N√£o √© outlier\u0026quot;)\r) %\u0026gt;% ggplot2::ggplot(ggplot2::aes(x = wt, y = mpg, color = e_outlier_mpg)) +\rggplot2::geom_point(size = 3) +\rggplot2::theme_minimal(15) +\rggplot2::labs(x = \u0026quot;Peso do carro\u0026quot;, y = \u0026quot;Consumo de combust√≠vel (milhas/gal√£o)\u0026quot;, color = \u0026quot;\u0026quot;)\rConseguimos! Vamos fazer um novo plot para analisar os dados do jeito que a gente gostaria de ter feito desde o come√ßo, se n√£o fossem esses outliers chatos.\nmtcars_com_outliers %\u0026gt;% dplyr::mutate(\rz_score_mpg = (mpg-mean(mpg))/sd(mpg),\re_outlier_mpg = dplyr::if_else(abs(z_score_mpg) \u0026gt; 1, \u0026quot;√â outlier\u0026quot;, \u0026quot;N√£o √© outlier\u0026quot;)\r) %\u0026gt;% dplyr::filter(e_outlier_mpg == \u0026quot;N√£o √© outlier\u0026quot;) %\u0026gt;% ggplot2::ggplot(ggplot2::aes(x = wt, y = mpg)) +\rggplot2::geom_point(size = 3) +\rggplot2::theme_minimal(15) +\rggplot2::labs(x = \u0026quot;Peso do carro\u0026quot;, y = \u0026quot;Consumo de combust√≠vel (milhas/gal√£o)\u0026quot;, color = \u0026quot;\u0026quot;)\rAgora parece que tem mais um, o que √© que a gente faz? A gente at√© poderia repetir o processo: rodar o z-score nessa base filtrada, experimentar alguns cortes, refazer os gr√°fico e seguir at√© n√£o conseguirmos identificar nenhum outro outlier. Mas isso n√£o parece escalar muito bem, n√©?\nE se eu te dissesse que tem uma pequena modifica√ß√£o que a gente pode fazer no z-score que simplifica o nosso trabalho? Pois tem, e √© o que normalmente se chama de z-score robusto. A f√≥rmula √© s√≥ um pouquinho diferente:\n\\[Z_{SCORE}\\ ROBUSTO(X) = \\frac{X-Mediana(X)}{MAD(X)}\\]\rSe voc√™ comparar essa f√≥rmula com a outra que postamos l√° em cima, duas coisas mudaram: a m√©dia virou mediana e o desvio padr√£o virou MAD. O MAD √© um pouco menos conhecido que a mediana, mas ele est√° para o desvio padr√£o assim como a m√©dia est√° para a mediana. Essas duas medidas, o MAD e a mediana, s√£o mais robustas do que a m√©dia e o desvio padr√£o, respectivamente, porque consideram a estat√≠stica de ordem central, ao inv√©s de tomar uma m√©dia de todos os dados ou, no caso do desvio padr√£o, uma m√©dia de todos os desvio quadr√°ticos. Por conta desse comportamento baseado em estat√≠sticas de ordem, o z-score robusto se comporta muito melhor do que o z-score comum, principalmente quando o assunto √© encontrar outliers. De resto, vamos fazer mais ou menos a mesma coisa que fizemos antes: escolher um corte e seguir. Podemos inclusive come√ßar escolhendo 2 ou 3 para ver o que acontece:\nmtcars_com_outliers %\u0026gt;% dplyr::mutate(\rz_score_mpg = (mpg-median(mpg))/mad(mpg),\re_outlier_mpg = dplyr::if_else(abs(z_score_mpg) \u0026gt; 3, \u0026quot;√â outlier\u0026quot;, \u0026quot;N√£o √© outlier\u0026quot;)\r) %\u0026gt;% ggplot2::ggplot(ggplot2::aes(x = wt, y = mpg, color = e_outlier_mpg)) +\rggplot2::geom_point(size = 3) +\rggplot2::theme_minimal(15) +\rggplot2::labs(x = \u0026quot;Peso do carro\u0026quot;, y = \u0026quot;Consumo de combust√≠vel (milhas/gal√£o)\u0026quot;, color = \u0026quot;\u0026quot;)\rE olha s√≥ que beleza, encontramos todos os outliers, sem precisar fazer o pr√≥ximo gr√°fico! Legal n√©?\nConta pra gente a√≠ nos coment√°rios se voc√™ j√° conhecia o z-score robusto e o MAD.\nGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre manipula√ß√£o de dados com R, d√™ uma olhada no nosso curso R para Ci√™ncia de Dados I e aproveite!\nCaso voc√™ tenha d√∫vidas entre em contato com a gente pelos coment√°rios aqui embaixo, pelo nosso Discourse ou pelo e-mail contato@curso-r.com.\n\r","permalink":"https://blog.curso-r.com/posts/2021-04-15-como-encontrar-outliers/","tags":["base de dados"],"title":"Uma maneira pr√°tica de encontrar outliers nos seus dados"},{"author":["Fernando"],"categories":["an√°lises"],"contents":"\rUma das grandes conquistas da comunidade brasileira de dados abertos nos √∫ltimos anos foi a disponibiliza√ß√£o peri√≥dica dos dados cadastrais de todas as pessoas jur√≠dicas brasileiras. N√≥s j√° exploramos essa base em detalhes em outros posts do blog e hoje vamos voltar ao assunto te ajudando a acessar essa base de um jeito muito, muito r√°pido!\n√â um tutorial super simples, de 2 passinhos, que surgiu no contexto de uma pergunta feita l√° no nosso Discourse. Inclusive, recomendamos que voc√™s frequentem o nosso f√≥rum, pois muitas dicar de ouro surgem nas conversar que rolam por l√°.\nVamos ent√£o ao nosso tutorial:\nPasso 1: Baixe o banco de dados em formato SQLite.\rSQLite √© uma tecnologia muito conveniente para aproveitar as qualidades de um sistema de gerenciamento de banco de dados sem precisar instalar muitos programas ou configurar passos muito complexos. Ao contr√°rio de outras tecnologias, como MySQL por exemplo, SQLite permite que, sem muito trabalho, voc√™ consiga fazer queries em uma base grande como a da receita federal e recuperar a resposta para dentro do R. Por isso, nesse nosso tutorial enxuto vamos utilizar essa tecnologia.\nPara simplificar a nossa vida, o querido George Santiago disponibiliza para a comunidade um pacote feito de R para processar todos os dados brutos da RFB e uma vers√£o em SQLite dessa mesma base. Sendo assim, como a comunidade j√° fez uma grande parte do trabalho, o que resta para n√≥s √© baixar a base em SQLite por este link.\n\rPasso 2: Acesse a base usando o combo de pacotes DBI+RSQLite+dplyr\rO passo final √© usar a infraestrutura do pacote DBI e dplyr para acessar a base SQLite que baixamos no passo anterior. Entretanto, antes de fazer isso, vamos fazer um pequeno tratamento nos nossos CNPJs para que eles saiam do formato padr√£o 13.347.016/0001-17 para o formato que de armazenamento na base da RFB ‚Äú13347016000117‚Äù. Voc√™ pode consultar o c√≥digo que faz esse procedimento nas linhas abaixo:\n#install.packages(\u0026quot;stringr\u0026quot;)\rlista_de_cnpjs \u0026lt;- c(\r\u0026#39;13.347.016/0001-17\u0026#39;,\r) %\u0026gt;% stringr::str_remove_all(\u0026quot;[:punct:]\u0026quot;) %\u0026gt;% # remove pontua√ß√µes, tais como \u0026quot;,\u0026quot;, \u0026quot;.\u0026quot; e \u0026quot;-\u0026quot;\rstringr::str_pad(pad = \u0026quot;0\u0026quot;, width = 14, side = \u0026quot;left\u0026quot;)\r# caso o CNPJ tenha menos do que 14 digitos, preenche o CNPJ com 0s √† esquerda\rDepois dessa limpeza, temos s√≥ mais um passo a executar. Precisamos nos conectar com a base de dados em SQLite e utilizar esse vetor de CNPJs como filtro:\n#install.packages(\u0026quot;RSQLite\u0026quot;)\r#install.packages(\u0026quot;dplyr\u0026quot;)\rcon \u0026lt;- DBI::dbConnect(RSQLite::SQLite(), \u0026quot;bd_dados_qsa_cnpj.db\u0026quot;)\r# conecta o R ao banco de dados\rdados_cadastrais \u0026lt;- dplyr::tbl(con, \u0026quot;cnpj_dados_cadastrais_pj\u0026quot;) %\u0026gt;% # carrega a tabela de dados cadastrais\rdplyr::filter(cnpj %in% local(lista_de_cnpjs)) %\u0026gt;% # filtra as linhas da tabela \u0026quot;cnpj_dados_cadastrais_pj\u0026quot; que estejam no vetor \u0026quot;lista_de_cnpjs\u0026quot;\rdplyr::collect() %\u0026gt;% # carrega o resultado da consulta para o R\rACABOU! Caso voc√™ queira consultar mais CNPJs, basta aumentar a lista de documentos l√° no vetor lista_de_cnpjs. Bacana, n√©? Esperamos esses passos tenham tomado s√≥ um minuto mesmo. Deixe o seu coment√°rio a√≠ embaixo se demorou mais.\n\rC√≥digo completo\rPara que voc√™ consiga sair usando esse c√≥digo por a√≠, vamos colocar aqui embaixo o c√≥digo completo, com todos as partes juntas. Boa sorte!\n#install.packages(\u0026quot;DBI\u0026quot;)\r#install.packages(\u0026quot;RSQLite\u0026quot;)\r#install.packages(\u0026quot;dplyr\u0026quot;)\rcon \u0026lt;- DBI::dbConnect(RSQLite::SQLite(), \u0026quot;bd_dados_qsa_cnpj.db\u0026quot;)\r# conecta o R com o SQLite que baixamos\rlista_de_cnpjs \u0026lt;- c(\r\u0026#39;13.347.016/0001-17\u0026#39;,\r# aqui voc√™ insere os CNPJs que quer consultar\r) %\u0026gt;% stringr::str_remove_all(\u0026quot;[:punct:]\u0026quot;) %\u0026gt;% # remove pontua√ß√µes\rstringr::str_pad(pad = \u0026quot;0\u0026quot;, width = 14, side = \u0026quot;left\u0026quot;)\r# deixa todos os documento com o mesmo comprimento\rcnpj \u0026lt;- dplyr::tbl(con, \u0026quot;cnpj_dados_cadastrais_pj\u0026quot;)\r# acessa a tabela \u0026quot;cnpj_dados_cadastrais_pj\u0026quot;\rdados_cadastrais \u0026lt;- dplyr::cnpj %\u0026gt;% # carrega a tabela de dados cadastrais\rdplyr::filter(cnpj %in% local(lista_de_cnpjs)) %\u0026gt;% # filtra as linhas da tabela \u0026quot;cnpj_dados_cadastrais_pj\u0026quot; que estejam no vetor \u0026quot;lista_de_cnpjs\u0026quot;\rdplyr::collect()\r# carrega o resultado da consulta para o R\r\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre manipula√ß√£o de dados com R, d√™ uma olhada no nosso curso R para Ci√™ncia de Dados I e aproveite!\nCaso voc√™ tenha d√∫vidas entre em contato com a gente pelos coment√°rios aqui embaixo, pelo nosso Discourse ou pelo e-mail contato@curso-r.com.\n\r","permalink":"https://blog.curso-r.com/posts/2021-04-01-acessar-cnpj/","tags":["rfb","banco de dados"],"title":"Como acessar a base de dados de CNPJ da receita federal em literalmente 1 minuto"},{"author":["Beatriz Milz","Fernando Corr√™a"],"categories":["conceitos","erros","debugging","boas pr√°ticas"],"contents":"\rQuando estamos programando, √© muito comum executar algum c√≥digo e ele gerar um erro! Algumas vezes √© dif√≠cil entender as mensagens de erro para come√ßar a buscar ajuda, e isso pode atrasar nossas tarefas (e tamb√©m nos desanimar).\n\rFigura 1: Ilustra√ß√£o por Allison Horst\r\rPrincipalmente quando estamos iniciando a nossa jornada de aprendizagem de R, alguns erros podem ser mais frequentes. Esse post tem como objetivo listar alguns desses erros comuns, baseado na minha experi√™ncia aprendendo e ensinando R, e tamb√©m respondendo d√∫vidas :)\nVamos ent√£o ler um pouco sobre alguns erros frequentes, e como resolv√™-los? Prepara um caf√© ou ch√°, e vamos l√°! ‚òï\nObjeto n√£o encontrado\rImagine que queremos calcular a m√©dia do or√ßamento dos filmes que fazem parte da base de dados sobre filmes do IMDB, e recebemos o seguinte erro:\nmean(imdb$orcamento, na.rm = TRUE)\r#\u0026gt; Error in mean(imdb$orcamento, na.rm = TRUE): objeto \u0026#39;imdb\u0026#39; n√£o encontrado\rCreated on 2021-03-26 by the reprex package (v1.0.0)\nO R est√° dizendo para n√≥s que n√£o est√° encontrando o objeto imdb! Como podemos resolver esse erro? Precisamos carregar esse objeto no nosso ambiente, para que ele esteja dispon√≠vel para uso!\nPara isso, precisamos usar o sinal de atribui√ß√£o: \u0026lt;-.\nNo exemplo abaixo, importamos o arquivo imdb.csv e salvamos essa base de dados no objeto imdb. Dessa forma, n√£o obtemos um erro quando tentamos calcular a m√©dia da mesma forma que fizemos anteriormente, pois o objeto ser√° encontrado e o c√≥digo conseguir√° ser executado!\nimdb \u0026lt;- readr::read_csv2(\u0026quot;https://raw.githubusercontent.com/curso-r/202010-r4ds-1/master/dados/imdb2.csv\u0026quot;)\rmean(imdb$orcamento, na.rm = TRUE)\r## [1] 35237114\r\rN√£o foi poss√≠vel encontrar a fun√ß√£o ‚Äú‚Ä¶‚Äù\rJ√° tentou executar um c√≥digo e o retorno foi essa mensagem de erro?\nglimpse(imdb)\r#\u0026gt; Error in glimpse(imdb): n√£o foi poss√≠vel encontrar a fun√ß√£o \u0026quot;glimpse\u0026quot;\rCreated on 2021-03-26 by the reprex package (v1.0.0)\nIsso significa que o R n√£o encontrou essa fun√ß√£o. No R, podemos instalar pacotes que cont√©m fun√ß√µes para que a gente utilize nas nossas rotinas. Por√©m, √© preciso carregar o pacote para que as fun√ß√µes do mesmo fiquem dispon√≠veis para uso. Podemos carregar um pacote utilizando a fun√ß√£o library().\nNo exemplo abaixo, a fun√ß√£o glimpse() faz parte do pacote {dplyr}. Carregando o pacote no in√≠cio do c√≥digo deixar√° todas as fun√ß√µes do pacote {dplyr} dispon√≠veis para uso (incluindo a fun√ß√£o que queremos usar):\nlibrary(dplyr)\rglimpse(imdb)\r## Rows: 3,713\r## Columns: 15\r## $ titulo \u0026lt;chr\u0026gt; \u0026quot;Avatar¬†\u0026quot;, \u0026quot;Pirates of the Caribbean: At World\u0026#39;s End...\r## $ ano \u0026lt;dbl\u0026gt; 2009, 2007, 2012, 2012, 2007, 2010, 2015, 2016, 2006...\r## $ diretor \u0026lt;chr\u0026gt; \u0026quot;James Cameron\u0026quot;, \u0026quot;Gore Verbinski\u0026quot;, \u0026quot;Christopher Nola...\r## $ duracao \u0026lt;dbl\u0026gt; 178, 169, 164, 132, 156, 100, 141, 183, 169, 151, 15...\r## $ cor \u0026lt;chr\u0026gt; \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;...\r## $ generos \u0026lt;chr\u0026gt; \u0026quot;Action|Adventure|Fantasy|Sci-Fi\u0026quot;, \u0026quot;Action|Adventure...\r## $ pais \u0026lt;chr\u0026gt; \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;US...\r## $ classificacao \u0026lt;chr\u0026gt; \u0026quot;A partir de 13 anos\u0026quot;, \u0026quot;A partir de 13 anos\u0026quot;, \u0026quot;A par...\r## $ orcamento \u0026lt;dbl\u0026gt; 237000000, 300000000, 250000000, 263700000, 25800000...\r## $ receita \u0026lt;dbl\u0026gt; 760505847, 309404152, 448130642, 73058679, 336530303...\r## $ nota_imdb \u0026lt;dbl\u0026gt; 7.9, 7.1, 8.5, 6.6, 6.2, 7.8, 7.5, 6.9, 6.1, 7.3, 6....\r## $ likes_facebook \u0026lt;dbl\u0026gt; 33000, 0, 164000, 24000, 0, 29000, 118000, 197000, 0...\r## $ ator_1 \u0026lt;chr\u0026gt; \u0026quot;CCH Pounder\u0026quot;, \u0026quot;Johnny Depp\u0026quot;, \u0026quot;Tom Hardy\u0026quot;, \u0026quot;Daryl Sa...\r## $ ator_2 \u0026lt;chr\u0026gt; \u0026quot;Joel David Moore\u0026quot;, \u0026quot;Orlando Bloom\u0026quot;, \u0026quot;Christian Bale...\r## $ ator_3 \u0026lt;chr\u0026gt; \u0026quot;Wes Studi\u0026quot;, \u0026quot;Jack Davenport\u0026quot;, \u0026quot;Joseph Gordon-Levitt...\rOutra forma de utilizar a fun√ß√£o sem que seja necess√°rio carregar o pacote, √© utilizando o operador :: (voc√™ pode ler mais sobre ele neste cap√≠tulo do livro Zen do R).\nLeia o c√≥digo abaixo como: quero usar a fun√ß√£o glimpse() do pacote dplyr\ndplyr::glimpse(imdb)\r## Rows: 3,713\r## Columns: 15\r## $ titulo \u0026lt;chr\u0026gt; \u0026quot;Avatar¬†\u0026quot;, \u0026quot;Pirates of the Caribbean: At World\u0026#39;s End...\r## $ ano \u0026lt;dbl\u0026gt; 2009, 2007, 2012, 2012, 2007, 2010, 2015, 2016, 2006...\r## $ diretor \u0026lt;chr\u0026gt; \u0026quot;James Cameron\u0026quot;, \u0026quot;Gore Verbinski\u0026quot;, \u0026quot;Christopher Nola...\r## $ duracao \u0026lt;dbl\u0026gt; 178, 169, 164, 132, 156, 100, 141, 183, 169, 151, 15...\r## $ cor \u0026lt;chr\u0026gt; \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;, \u0026quot;Color\u0026quot;...\r## $ generos \u0026lt;chr\u0026gt; \u0026quot;Action|Adventure|Fantasy|Sci-Fi\u0026quot;, \u0026quot;Action|Adventure...\r## $ pais \u0026lt;chr\u0026gt; \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;US...\r## $ classificacao \u0026lt;chr\u0026gt; \u0026quot;A partir de 13 anos\u0026quot;, \u0026quot;A partir de 13 anos\u0026quot;, \u0026quot;A par...\r## $ orcamento \u0026lt;dbl\u0026gt; 237000000, 300000000, 250000000, 263700000, 25800000...\r## $ receita \u0026lt;dbl\u0026gt; 760505847, 309404152, 448130642, 73058679, 336530303...\r## $ nota_imdb \u0026lt;dbl\u0026gt; 7.9, 7.1, 8.5, 6.6, 6.2, 7.8, 7.5, 6.9, 6.1, 7.3, 6....\r## $ likes_facebook \u0026lt;dbl\u0026gt; 33000, 0, 164000, 24000, 0, 29000, 118000, 197000, 0...\r## $ ator_1 \u0026lt;chr\u0026gt; \u0026quot;CCH Pounder\u0026quot;, \u0026quot;Johnny Depp\u0026quot;, \u0026quot;Tom Hardy\u0026quot;, \u0026quot;Daryl Sa...\r## $ ator_2 \u0026lt;chr\u0026gt; \u0026quot;Joel David Moore\u0026quot;, \u0026quot;Orlando Bloom\u0026quot;, \u0026quot;Christian Bale...\r## $ ator_3 \u0026lt;chr\u0026gt; \u0026quot;Wes Studi\u0026quot;, \u0026quot;Jack Davenport\u0026quot;, \u0026quot;Joseph Gordon-Levitt...\r\rArgumento n√£o num√©rico para operador bin√°rio / non-numeric argument to binary operator\rDe toda a nossa lista de problemas, esse √© aquele com a mensagem de erro mais complicada. Voc√™ j√° tentou fazer algum c√°lculo como esse abaixo e o retorno foi essa mensagem de erro?\nx \u0026lt;- \u0026quot;a\u0026quot;\rx+1\r#\u0026gt; Error in x + 1: argumento n√£o-num√©rico para operador bin√°rio\rCreated on 2021-03-29 by the reprex package (v0.3.0)\nIsso √© muito comum, principalmente quando estamos trabalhando em scripts mais longos, e essa mensagem de erro √© o R tentando nos avisar que n√≥s estamos passando um texto, no caso a letra ‚Äúa‚Äù, para uma opera√ß√£o que espera receber um n√∫mero. Na verdade, o R √© at√© um pouco mais preciso: a opera√ß√£o esperava um n√∫mero e n√≥s frustramos essa expectativa, por isso o erro menciona um ‚Äúargumento n√£o-num√©rico‚Äù. No caso n√≥s tentamos fazer uma conta (a adi√ß√£o representada pelo s√≠mbolo +) usando um texto.\nO que podemos fazer quando esse erro aparece? Minha recomenda√ß√£o √© examinar o seu c√≥digo para verificar que tipo de argumento as suas opera√ß√µes matem√°ticas (por exemplo +, -, * e ^) est√£o recebendo. Muito provavelmente algum desses argumentos n√£o √© um n√∫mero‚Ä¶\n\rConflito de fun√ß√µes\rUm problema silencioso que pode acontecer √© o conflito de fun√ß√µes. Esse tipo de erro √© um pouco mais complicado de identificar pois a mensagem de erro causada por esse problema n√£o √© padronizada.\nMas o que √© um conflito de fun√ß√µes?\nO R permite que a gente instale e carregue diversos pacotes. E esses pacotes podem ter fun√ß√µes com nomes iguais.\nPor exemplo, o pacote {dplyr} possui uma fun√ß√£o chamada filter(), assim como o pacote {base} tamb√©m tem uma fun√ß√£o com o mesmo nome (o {base} sempre est√° carregado quando iniciamos o R).\nQuando usamos uma fun√ß√£o sem usar o operador ::, o R vai buscar no ambiente a fun√ß√£o com esse nome que foi carregada por √∫ltimo. Ent√£o podemos usar uma fun√ß√£o A quando queremos realmente usar a fun√ß√£o B.\nExemplo: queremos filtrar os filmes do diretor Zack Snyder. Obtemos esse erro dizendo que o objeto imdb n√£o foi encontrado, por√©m o objeto est√° carregado!\nfilter(imdb, diretor == \u0026quot;Zack Snyder\u0026quot;)\r#\u0026gt; Error in as.ts(x): objeto \u0026#39;imdb\u0026#39; n√£o encontrado\rCreated on 2021-03-26 by the reprex package (v1.0.0)\nIsso acontece pois o R utilizou a fun√ß√£o filter() do pacote {base}, e n√£o a fun√ß√£o filter() do pacote {dplyr}!\nUma forma de evitar esses erros de conflitos √© utilizar o operador ::, que foi citado anteriormente. Assim estamos falando explicitamente em qual pacote essa fun√ß√£o est√°:\ndplyr::filter(imdb, diretor == \u0026quot;Zack Snyder\u0026quot;)\r## # A tibble: 7 x 15\r## titulo ano diretor duracao cor generos pais classificacao orcamento\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Batma~ 2016 Zack S~ 183 Color Action~ USA A partir de ~ 250000000\r## 2 Man o~ 2013 Zack S~ 143 Color Action~ USA A partir de ~ 225000000\r## 3 Watch~ 2009 Zack S~ 215 Color Action~ USA A partir de ~ 130000000\r## 4 Legen~ 2010 Zack S~ 101 Color Action~ USA Livre 80000000\r## 5 Sucke~ 2011 Zack S~ 128 Color Action~ USA A partir de ~ 82000000\r## 6 300¬†2006 Zack S~ 117 Color Action~ USA A partir de ~ 65000000\r## 7 Dawn ~ 2004 Zack S~ 110 Color Action~ USA A partir de ~ 26000000\r## # ... with 6 more variables: receita \u0026lt;dbl\u0026gt;, nota_imdb \u0026lt;dbl\u0026gt;,\r## # likes_facebook \u0026lt;dbl\u0026gt;, ator_1 \u0026lt;chr\u0026gt;, ator_2 \u0026lt;chr\u0026gt;, ator_3 \u0026lt;chr\u0026gt;\r\rN√£o existe um pacote chamado ‚Ä¶ / There is no package called ..\rQuando queremos carregar um pacote, e ele n√£o est√° instalado, o erro gerado √© esse:\nlibrary(tidyverse)\r#\u0026gt; Error in library(tidyverse) : there is no package called ‚Äòtidyverse‚Äô\rCreated on 2021-03-26 by the reprex package (v1.0.0)\nComo resolver? Precisamos instalar o pacote!\nA forma mais comum de instala√ß√£o de um pacote √© atrav√©s do CRAN, utilizando a fun√ß√£o install.packages():\ninstall.packages(\u0026quot;tidyverse\u0026quot;)\rAp√≥s instalar o pacote, conseguiremos carreg√°-lo normalmente!\nlibrary(tidyverse)\r#\u0026gt; ‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 1.3.0 ‚îÄ‚îÄ\r#\u0026gt; ‚úì ggplot2 3.3.3 ‚úì purrr 0.3.4\r#\u0026gt; ‚úì tibble 3.1.0 ‚úì dplyr 1.0.5\r#\u0026gt; ‚úì tidyr 1.1.3 ‚úì stringr 1.4.0\r#\u0026gt; ‚úì readr 1.4.0 ‚úì forcats 0.5.1\r#\u0026gt; ‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ\r#\u0026gt; x dplyr::filter() masks stats::filter()\r#\u0026gt; x dplyr::lag() masks stats::lag()\r\rO pacote ‚Ä¶ n√£o est√° dispon√≠vel para essa vers√£o do R / Package ‚Äò‚Ä¶‚Äô is not available for this version of R\rNesse exemplo, mostraremos um caso onde n√£o √© gerado um erro, e sim uma mensagem de aviso (warning). Entretanto, o c√≥digo n√£o executa como esperamos, e pode impossibilitar a execu√ß√£o das etapas seguintes dos scripts.\nImagine que queremos calcular a m√©dia da massa corporal dos Pinguins que fazem parte da base de dados sobre Pinguins, dispon√≠vel no pacote {dados}.\ninstall.packages(\u0026quot;dados\u0026quot;)\r#\u0026gt; Warning: package \u0026#39;dados\u0026#39; is not available for this version of R\r#\u0026gt; #\u0026gt; A version of this package for your version of R might be available elsewhere,\r#\u0026gt; see the ideas at\r#\u0026gt; https://cran.r-project.org/doc/manuals/r-patched/R-admin.html#Installing-packages\rCreated on 2021-03-26 by the reprex package (v1.0.0)\nEssa mensagem acontece quando queremos instalar um pacote que n√£o est√° dispon√≠vel no CRAN.\rO que eu recomendo, neste caso, √© buscar o reposit√≥rio no GitHub do pacote desejado.\nNo caso do pacote que estamos mostrando neste exemplo, este √© o link do reposit√≥rio.\nCaso queira instalar o pacote atrav√©s do GitHub, devemos utilizar a fun√ß√£o install_github() do pacote {remotes}. Como argumento, devemos informar a organiza√ß√£o ou pessoa a quem este reposit√≥rio ‚Äúpertence‚Äù, e o nome do reposit√≥rio: \"nome_da_organizacao/nome_do_repositorio\". No caso do pacote {dados}, a organiza√ß√£o √© cienciadedatos, e o reposit√≥rio √© chamado de dados. Portanto, para instalar esse pacote, devemos executar o c√≥digo a seguir:\nremotes::install_github(\u0026quot;cienciadedatos/dados\u0026quot;)\rAgora conseguimos utilizar fun√ß√µes e bases de dados do pacote dados:\nlibrary(dados)\rmean(pinguins$massa_corporal, na.rm = TRUE)\r## [1] 4201.754\r\rO arquivo ‚Ä¶ n√£o existe no diret√≥rio de trabalho atual / ‚Ä¶ does not exist in current working directory\rE quando queremos importar uma base de dados (ou outro arquivo) para trabalhar no R, e recebemos essa mensagem?\nimdb \u0026lt;- readr::read_csv2(\u0026quot;imdb2.csv\u0026quot;)\r#\u0026gt; i Using \u0026#39;,\u0026#39; as decimal and \u0026#39;.\u0026#39; as grouping mark. Use `read_delim()` for more control.\r#\u0026gt; Error: \u0026#39;imdb2.csv\u0026#39; does not exist in current working directory (\u0026#39;C:/Users/seu_usuario/Documents\u0026#39;).\rCreated on 2021-03-29 by the reprex package (v0.3.0)\nO R est√° informando que n√£o encontrou o arquivo que a gente deseja importar. A maior parte das vezes quando esse erro acontece √© por que 1) esse arquivo n√£o existe no nosso computador, ou 2) estamos indicando o caminho incorreto at√© o arquivo.\n\rFigura 2: Ilustra√ß√£o sobre projetos no RStudio, por Allison Horst\r\rVamos considerar que j√° sabemos que o arquivo existe no computador, e trabalhar na resolu√ß√£o da segunda op√ß√£o: precisamos corrigir o caminho at√© o arquivo.\r√â muito mais f√°cil lidar com isso quando trabalhamos com projetos no RStudio (.Rproj). Recomendo muito ler desse cap√≠tulo do livro Zen do R, pois fala bastante sobre as vantagens dessa abordagem.\nQuando trabalhamos com projetos no RStudio (.Rproj), os caminhos s√£o relativos √† pasta raiz do projeto. Recomendo adicionar dentro do seu projeto o arquivo que deseja abrir. E para descobrir o caminho, existe uma super dica: o RStudio nos ajuda a navegar nos arquivos presentes no nosso projeto. √â necess√°rio escrever duas aspas \"\", posicionar o mouse entre elas (isso √©, clicando entre as suas aspas como se a gente fosse escrever algo dentro delas), e apertar a tecla TAB do teclado. O RStudio abrir√° janelinha que possibilitar√° que a gente navegue nos arquivos do nosso projeto dessa forma.\nDescobrindo o caminho correto, podemos importar a base sem que aquele erro seja gerado!\nimdb \u0026lt;- readr::read_csv2(\u0026quot;dados/imdb2.csv\u0026quot;)\r#\u0026gt; ‚Ñπ Using \u0026#39;,\u0026#39; as decimal and \u0026#39;.\u0026#39; as grouping mark. Use `read_delim()` for more control.\r#\u0026gt; #\u0026gt; ‚îÄ‚îÄ Column specification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\r#\u0026gt; cols(\r#\u0026gt; titulo = col_character(),\r#\u0026gt; ano = col_double(),\r#\u0026gt; diretor = col_character(),\r#\u0026gt; duracao = col_double(),\r#\u0026gt; cor = col_character(),\r#\u0026gt; generos = col_character(),\r#\u0026gt; pais = col_character(),\r#\u0026gt; classificacao = col_character(),\r#\u0026gt; orcamento = col_double(),\r#\u0026gt; receita = col_double(),\r#\u0026gt; nota_imdb = col_double(),\r#\u0026gt; likes_facebook = col_double(),\r#\u0026gt; ator_1 = col_character(),\r#\u0026gt; ator_2 = col_character(),\r#\u0026gt; ator_3 = col_character()\r#\u0026gt; )\rCreated on 2021-03-26 by the reprex package (v1.0.0)\n\rConclus√£o\rEspero que essas dicas sejam √∫teis para voc√™ resolver os erros no futuro, e voc√™ seja mais feliz enquanto escreve seus c√≥digos em R! E caso ainda tenha d√∫vidas, recomendo perguntar l√° no F√≥rum Discourse da Curso-R!\n\rFigura 3: Ilustra√ß√£o por Allison Horst\r\r\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre R em geral, d√™ uma olhada nos Cursos da Curso-R e aproveite! O pr√≥ximo curso a iniciar √© o R para Ci√™ncia de Dados II, e a primeira parte do curso √© sobre organiza√ß√£o de projetos, um tema muito presente neste post. üéâ\n\r","permalink":"https://blog.curso-r.com/posts/2021-03-29-desvendando-erros/","tags":["conceitos"],"title":"Desvendando erros: Entendendo mensagens de erro comuns em R."},{"author":["Fernando"],"categories":["conceitos"],"contents":"\r\rRMarkdown √© uma das ferramentas mais importantes e vers√°teis para quem pratica Ci√™ncia de Dados. Como n√£o podia deixar de ser, as vantagens de usar o querido .Rmd se devem √†s in√∫meras solu√ß√µes que deixam seus documentos elegantes e cheios de detalhes. Nesse post vamos te dar dicas para turbinar o seu RMarkdown com o melhor que o R tem a oferecer. Nossas dicas s√£o curtinhas e objetivas, mas v√™m sempre acompanhadas de um documento de exemplo para te ajudar a colocar em pr√°tica quando precisar.\nVamos a elas:\n1. Use o pacote prettydoc\rMuitas vezes a gente quer impressionar com um documento colorido, com uma fonte elegante e agrad√°vel pra quem l√™, mas o html_doc padr√£o n√£o ajuda muito nessa empreitada. Nessa situa√ß√£o voc√™ tem duas op√ß√µes: (a) deixar o seu relat√≥rio bonito criando um CSS customizado para a p√°gina, como voc√™ pode ver aqui ou (b) usar um template pronto (e bonito) como aqueles do pacote prettydoc. Embora as op√ß√µes de customiza√ß√£o sejam um pouco limitadas, praticamente sem esfor√ßo voc√™ consegue fazer um documento impressionante e que vai pegar muito bom com a sua audi√™ncia. D√° uma olhada:\nExemplo de documento.\nSite do pacote.\n\r2. Construa tabelas usando o pacote flextable\rEsse √© um daqueles casos em que uma imagem vale mais do que mil palavras‚Ä¶ D√° uma olhada nesse exemplo de visualiza√ß√£o da tabela mtcars que podemos construir usando o pacote flextable:\nMuito bonito, n√©? O pacote flextable √© uma biblioteca em R que foi constru√≠da pensando em (a) construir tabelas muito bonitas e vers√°teis sem quase nenhum sofrimento e (b) usar o mesmo pacote para fazer tabelas para Word, PDF, PPT e HTML. A sintaxe √© um pouco carregada, mas o resultado compensa muito.\nExemplo de documento.\nSite do pacote.\n\r3. Impressione nas suas apresenta√ß√µes usando xaringan\rMuito do que a gente faz s√≥ √© divulgado para o mundo se colocamos isso em formato de apresenta√ß√£o de slides. O pacote xaringan permite que voc√™ fa√ßa isso com muito estilo e flexibilidade. D√° uma olhada nesse exemplo e saia usando:\nExemplo de apresenta√ß√£o + tutorial.\nCap√≠tulo de livro sobre o pacote.\n\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre RMarkdown e Visualiza√ß√£o de Dados em geral, d√™ uma olhada no nosso curso Relat√≥rios e visualiza√ß√£o de dados e aproveite!\n\rFigura 1: Ilustra√ß√£o sobre o pacote rmarkdown, criada por Allison Horst.\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-03-18-dicas-de-rmarkdown-que-voce-precisa-conhecer/","tags":["faxina","gr√°ficos"],"title":"3 Dicas de Rmarkdown que voc√™ precisa saber"},{"author":["Beatriz Milz","William"],"categories":["divulga√ß√£o"],"contents":"\r\rOl√°!\nEste post √© uma continua√ß√£o dos posts onde apresentamos os trabalhos premiados no curso R para Ci√™ncia de Dados I (este e este).\nNeste post, apresentaremos algumas dicas para elaborar relat√≥rios com o pacote rmarkdown!\n\rFigura 1: Ilustra√ß√£o sobre o pacote rmarkdown, criada por Allison Horst.\r\rDicas para elaborar relat√≥rios\rContextualize!\rA primeira dica √© escrever uma introdu√ß√£o para ajudar a contextualizar a sua an√°lise. Por exemplo:\n\rQual √© a pergunta que deseja responder a partir dos dados?\n\rQual √© a base de dados utilizadas? √â legal tamb√©m contextualizar a base.\n\rQual √© a fonte destes dados?\rDe qual(ou quais) ano(s) essa base se refere?\rQuais s√£o as vari√°veis presentes na base de dados?\r\r\rDa mesma forma, √© legal tamb√©m escrever uma conclus√£o ao final da an√°lise. A pergunta inicial foi respondida? Se sim, qual √© a resposta?\n\rQuem √© o seu p√∫blico-alvo?\r√â interessante pensar tambem quem s√£o as pessoas do seu p√∫blico alvo, e adaptar o relat√≥rio para este p√∫blico. Para quem voc√™ est√° escrevendo?\nPor exemplo, em um relat√≥rio de neg√≥cios, dificilmente voc√™ deixar√° os c√≥digos vis√≠veis no seu relat√≥rio. Por outro lado, em um relat√≥rio feito para as pessoas do seu time de cientistas de dados, pode ser interessante deixar os c√≥digos para que saibam o que foi feito na an√°lise.\n\rControle como o conte√∫do √© apresentado!\rOs Chunks nos relat√≥rios feitos com RMarkdown s√£o campos de c√≥digo onde podemos executar c√≥digos em R. As chunk options (ou op√ß√µes de chunk), definem como esse c√≥digo e os resultados gerados aparecer√£o no relat√≥rio final. A seguir est√£o alguns √∫teis:\n\rN√£o √© interessante aparecer mensagens de aviso (warnings) e mensagens geradas pelo c√≥digo no relat√≥rio. Para ocultar essas mensagens e avisos, √© poss√≠vel utilizar as seguintes op√ß√µes de chunk: message = FALSE, warning = FALSE (mas cuidado, pois essas mensagens podem n√£o ser importantes para as pessoas leitoras do relat√≥rio, mas podem ser √∫teis para voc√™!).\n\rUtilize as chunk options para personalizar como as imagens devem aparecer! Por exemplo:\n\rfig.align='center' - para centralizar horizontalmente as imagens;\n\recho=FALSE - para n√£o mostrar o c√≥digo que gera as imagens;\n\rout.width=\"90%\" - para especificar a largura da p√°gina que deve ser ocupada pela imagem (neste exemplo, deixamos 90% para que a imagem ocupe 90% da largura dispon√≠vel na p√°gina).\n\r\rUtilize as chunk options para personalizar como os c√≥digos devem aparecer! Por exemplo:\n\rApresentar o c√≥digo e o resultado: echo=TRUE\n\rApresentar apenas o c√≥digo, e n√£o execut√°-lo: echo=TRUE, eval=FALSE\n\rApresentar apenas os resultados: echo=FALSE\n\r\r\r\rTabelas\rQuando quiser representar dados em tabelas, n√£o esque√ßa de format√°-las com alguma fun√ß√£o com essa finalidade. Por exemplo, primeiro vamos criar uma tabela pequena com os 5 personagens com maior massa presentes na base starwars.\n# Carregar o pacote tidyverse\rlibrary(tidyverse)\r# Criar uma tabela de exemplo\rsw_top5_maiormassa \u0026lt;- dplyr::starwars %\u0026gt;% arrange(desc(mass)) %\u0026gt;% select(name, mass) %\u0026gt;% head(5)\rPodemos apresentar esses dados usando apenas o nome da base criada, por√©m n√£o ficar√° com uma formata√ß√£o legal:\nsw_top5_maiormassa\r## # A tibble: 5 x 2\r## name mass\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Jabba Desilijic Tiure 1358\r## 2 Grievous 159\r## 3 IG-88 140\r## 4 Darth Vader 136\r## 5 Tarfful 136\rPodemos usar diversas fun√ß√µes para formatar esses dados como uma tabela organizada. Um exemplo de fun√ß√£o √© a knitr::kable():\nsw_top5_maiormassa %\u0026gt;% knitr::kable(col.names = c(\u0026quot;Nome\u0026quot;, \u0026quot;Massa\u0026quot;))\r\r\rNome\rMassa\r\r\r\rJabba Desilijic Tiure\r1358\r\rGrievous\r159\r\rIG-88\r140\r\rDarth Vader\r136\r\rTarfful\r136\r\r\r\rN√£o esque√ßa de conferir este post que apresenta dicas para formatar as tabelas!\nConfira tamb√©m outras fun√ß√µes √∫teis para gerar tabelas, como por exemplo: gt::gt(), DT::datatable(), kableExtra::kbl() e muitas outras!\n\rC√≥digo em linha\rPodemos adicionar resultados de c√≥digos junto aos textos, utilizando a seguinte sintaxe:\n`r codigo_em_r`\rPor exemplo, podemos primeiro criar alguns objetos para usarmos no texto:\npersonagem_mais_baixo \u0026lt;- dplyr::starwars %\u0026gt;%\rarrange(height) %\u0026gt;%\rslice(1)\rmedia_altura \u0026lt;- dplyr::starwars %\u0026gt;%\rsummarise(media_altura = mean(height, na.rm = TRUE)) %\u0026gt;%\rpull()\rAgora podemos usar estes objetos no texto:\n\rA base starwars, dispon√≠vel no pacote {dplyr}, apresenta 87 personagens presentes nos filmes. O personagem com menor altura da franquia √© o Yoda, com a altura de 66 cent√≠metros. A m√©dia da altura dos personagens presentes na base √© de 1.74 metros.\n\rO c√≥digo a seguir gera o par√°grafo que apresentamos acima:\nA base starwars, dispon√≠vel no pacote `{dplyr}`,\rapresenta `r nrow(dplyr::starwars)` personagens presentes nos filmes. O personagem com menor altura da franquia √© o `r personagem_mais_baixo[[1]]`,\rcom a altura de `r personagem_mais_baixo[[2]]` cent√≠metros.\rA m√©dia da altura dos personagens presentes na base √©\rde `r round(media_altura/100, 2)` metros.\rSabemos ent√£o que os personagens da s√©rie The Mandalorian n√£o est√£o na base, pois o personagem Baby Yoda teria uma estatura mais baixa que o Yoda! Mas um exemplo legal sobre a utilidade do c√≥digo em linha √© pensar que, se algum dia atualizarem a base, este relat√≥rio ao ser gerado novamente (atrav√©s do bot√£o knit) teria seus resultados atualizados tamb√©m!\n\r\rUm extra: escreva sobre assuntos que te interessa!\rUma √∫ltima dica (que nem sempre √© poss√≠vel): escreva sobre temas que te interessa! As an√°lises sempre ficam mais interessantes quando entendemos melhor os dados.\n\rConclus√µes\rEssas dicas surgiram a partir da avalia√ß√£o dos trabalhos do curso R para Ci√™ncia de Dados I. Por√©m existem muitas outras possibilidades para elaborar relat√≥rios! Recomendamos a leitura do cap√≠tulo sobre relat√≥rios do livro Ci√™ncia de Dados em R. Al√©m disso, dia 18 de mar√ßo come√ßam as aulas do curso de Relat√≥rios e visualiza√ß√£o de dados, ent√£o se voc√™ tem interesse nesse tema, confira a p√°gina do curso!\nE caso voc√™ tenha interesse em saber mais sobre os outros cursos, confira a p√°gina de cursos!\n\r","permalink":"https://blog.curso-r.com/posts/2021-03-15-dicas-relatorios-r4ds1_relatorios/","tags":["rmarkdown"],"title":"Feedback dos trabalhos do R para Ci√™ncia de Dados (Parte III): Dicas para Relat√≥rios"},{"author":["Fernando"],"categories":["conceitos"],"contents":"\r\rCi√™ncia de Dados √© uma √°rea nova e, embora relacionada a muitas outras √°reas mais tradicionais como estat√≠stica e computa√ß√£o, pode parecer um mar vasto demais. Por isso, nesse post vamos recomendar 3 livros muito legais para come√ßar os seus estudos.\nMuitos e muitos livros poderiam aparecer nessa lista, mas para garantir que mais pessoas possam ter acesso √†s nossas recomenda√ß√µes selecionamos apenas obras j√° publicadas em portugu√™s. Nosso recorte tamb√©m foi feito considerando materiais introdut√≥rios que n√£o exijam muito conhecimento pr√©vio de quem l√™. De toda forma, muitos outros livros ficaram de fora da lista, mas esses j√° representam um bom ponto de partida.\n1. ‚ÄúEstat√≠stica B√°sica‚Äù, por Wilton Bussab e Pedro Morettin\rEstat√≠stica √© uma das principais ferramentas no cinto de utilidades de Cientistas de Dados. Embora tamb√©m seja importante cultivar outros conhecimentos, as t√©cnicas e estrat√©gias de an√°lise tradicionais do campo da Estat√≠stica resolvem muitos problemas comuns da vida de quem mexe com dados.\n‚ÄúEstat√≠stica B√°sica‚Äù √© usado em diversos cursos introdut√≥rios de estat√≠stica e explica com clareza conceitos b√°sicos como tipos de vari√°veis, testes de hip√≥tese e princ√≠pios b√°sicos de amostragem. Algumas passagens do livro soam antiquadas para quem o l√™ hoje em dia, mas sendo um grande e completo cl√°ssico, esse livro n√£o pode faltar na sua estante.\n\r2. ‚ÄúStorytelling com Dados: um Guia Sobre Visualiza√ß√£o de Dados Para Profissionais de Neg√≥cios‚Äù, por Cole Nussbaumer Knaflic\rO verdadeiro trabalho de quem trabalha com dados √©, antes de tudo, conseguir traduzir o que os dados t√™m a dizer para uma linguagem que seja √∫til para um neg√≥cio, pesquisa ou qualquer outra forma de investiga√ß√£o. As pessoas que v√£o consumir nossos resultados, em geral, precisam acessar o amplo contexto no qual os dados est√£o inseridos e muitas vezes a forma mais produtiva de transmitir as nossas informa√ß√µes √© contando uma hist√≥ria com come√ßo, meio e fim. √Äs vezes podemos nos esquecer disso, j√° que gastamos uma grande parte do nosso tempo em tarefas complementares, como limpeza e modelagem de dados, mas nunca se pode perder de vista que no final vamos precisar contar uma hist√≥ria pra algu√©m, e possivelmente s√≥ a√≠ nosso trabalho ter√° sido √∫til.\n‚ÄúStorytelling com Dados: um Guia Sobre Visualiza√ß√£o de Dados Para Profissionais de Neg√≥cios‚Äù abra√ßa essa filosofia com muito afinco e a autora americana Cole Nussbaumer Knaflic nos guia pelas t√©cnicas que podem nos ajudar a apresentar nossos dados da maneira mais efetiva o poss√≠vel: quais gr√°ficos devemos usar, para quais aspectos devemos chamar aten√ß√£o, como fornecer contexto para a audi√™ncia e muitos outros temas que voc√™ n√£o pode viver sem.\n\r3. ‚ÄúR Para Data Science‚Äù, por Hadley Wickham e Garrett Grolemund\rMuitas pessoas definem como Ci√™ncia de Dados como uma uni√£o entre m√©todos quantitativos em geral (estat√≠stica, matem√°tica, machine learning etc), programa√ß√£o, e uma atua√ß√£o focada a neg√≥cios. Desses tr√™s temas, apenas um ainda n√£o estava contemplado na nossa lista: a progama√ß√£o.\n‚ÄúR para Data Science‚Äù √© uma obra prima moderna que ensina a extrair o melhor da linguagem R, contextualizando o uso de uma linguagem de programa√ß√£o para o uso mais frequente por quem pratica Ci√™ncia de Dados: gera√ß√£o de an√°lises reprodut√≠veis, escal√°veis e muito poderosas. O seu trabalho di√°rio como Cientista de Dados certamente vai melhorar muito depois de ler esse livro.\n\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre manipula√ß√£o de dados como abordada no livro ‚ÄúR para Data Science‚Äù, d√™ uma olhada nos nossos cursos de R para Ci√™ncia de Dados I e R para Ci√™ncia de Dados II. Se voc√™ quiser aprender um pouco mais sobre visualiza√ß√£o de dados, d√™ uma olhada no nosso curso Relat√≥rios e visualiza√ß√£o de dados e aproveite!\n\r","permalink":"https://blog.curso-r.com/posts/2021-03-08-recomendacao-livros/","tags":["faxina","modelagem"],"title":"3 livros essenciais para Cientistas de Dados "},{"author":["William","Julio"],"categories":["an√°lises"],"contents":"\r\r\r\r\r\r\r\rMotiva√ß√£o\rSer√° que a aus√™ncia de torcida nos jogos de futebol causada pela pandemia tem algum efeito no desempenho dos times mandantes?\nPara responder essa pergunta, o Julio e eu investigamos os resultados da era de pontos corridos da S√©rie A do Brasileir√£o.\n\rAcerte o seu a√≠ que eu arredondo o meu aqui. Est√° valendo! - Silvio Luiz, narrador esportivo brasileiro\n\r\rOs dados\rOs dados utilizados na an√°lise abaixo est√£o no pacote {brasileirao}. O pacote est√° dispon√≠vel neste reposit√≥rio e se voc√™ quiser saber mais sobre como usar, confira este post.\nhead(brasileirao::matches)\r## season date home score away\r## 1 2003 2003-03-29 Atl√©tico PR 2x0 Gr√™mio\r## 2 2003 2003-03-29 Guarani 4x2 Vasco\r## 3 2003 2003-03-30 Corinthians 0x3 Atl√©tico MG\r## 4 2003 2003-03-30 Goi√°s 2x2 Paysandu\r## 5 2003 2003-03-30 Crici√∫ma 2x0 Fluminense\r## 6 2003 2003-03-30 Cruzeiro 2x2 S√£o Caetano\r\rArrumando\rAntes de iniciar a an√°lise, precisamos dar aquele famoso tapa na base. A partir da coluna score, que tem seus valores no estilo gols_mandante x gols_visitante, constru√≠mos as seguintes vari√°veis de interesse:\n\rresult: que indica se o resultado foi vit√≥ria do mandante, empate ou derrota do mandante;\n\rpontos: que indica o n√∫mero de pontos feitos pelo mandante na partida.\n\r\rTamb√©m criamos um vari√°vel torcida, que indica como sem_torcida a temporada de 2020 e como com_torcida as demais.\nlibrary(tidyverse)\rlibrary(lubridate)\rtab_resul_mandante \u0026lt;- brasileirao::matches %\u0026gt;% dplyr::filter(season \u0026lt;= 2020) %\u0026gt;% separate(\rscore, c(\u0026quot;home_score\u0026quot;, \u0026quot;away_score\u0026quot;), sep = \u0026quot;x\u0026quot;, convert = TRUE\r) %\u0026gt;% mutate(\rhome_win = home_score \u0026gt; away_score,\rresult = case_when(\rhome_score \u0026gt; away_score ~ \u0026quot;Vit√≥ria do mandante\u0026quot;,\rhome_score == away_score ~ \u0026quot;Empate\u0026quot;,\rhome_score \u0026lt; away_score ~ \u0026quot;Derrota do mandante\u0026quot;\r),\rpontos = case_when(\rhome_score \u0026gt; away_score ~ 3,\rhome_score == away_score ~ 1,\rhome_score \u0026lt; away_score ~ 0\r),\rtorcida = ifelse(season == 2020, \u0026quot;sem_torcida\u0026quot;, \u0026quot;com_torcida\u0026quot;)\r) \r\rAlgumas visualiza√ß√µes\rA nossa primeira investiga√ß√£o foi sobre a propor√ß√£o de vit√≥rias dos mandantes, comparando a temporada de 2020 com as demais.\nO gr√°fico abaixo mostra a propor√ß√£o de vit√≥rias, empates e derrotas dos mandantes em cada temporada. Vemos que:\n\rA propor√ß√£o de vit√≥rias dos mandantes no Brasileir√£o de pontos corridos varia de 44% a 55%.\n\r2020, com 45%, foi a temporada com a segunda menor propor√ß√£o de vit√≥rias dos mandantes, perdendo para 2017 (44%).\n\r\rtab_grafico \u0026lt;- tab_resul_mandante %\u0026gt;% count(season, torcida, result) %\u0026gt;% group_by(season, torcida) %\u0026gt;% mutate(prop = n/sum(n)) %\u0026gt;% ungroup() tab_grafico %\u0026gt;% ggplot(aes(x = season, y = prop, fill = result)) +\rgeom_col(aes(colour = torcida), position = \u0026quot;stack\u0026quot;) +\rgeom_hline(yintercept = .5, linetype = 2, colour = 2, size = 1) +\rgeom_label(\raes(label = scales::percent(prop, accuracy = 1), y = prop / 2),\rsize = 3,\rcolor = \u0026quot;white\u0026quot;,\rdata = filter(tab_grafico, result == \u0026quot;Vit√≥ria do mandante\u0026quot;)\r) +\rtheme_minimal(14) +\rscale_colour_manual(values = c(\u0026quot;transparent\u0026quot;, \u0026quot;black\u0026quot;)) +\rguides(colour = FALSE) +\rtheme(\rlegend.position = \u0026quot;bottom\u0026quot;,\rplot.title = element_text(hjust = 0.5),\rplot.subtitle = element_text(hjust = 0.5),\rlegend.text = element_text(size = 10)\r) +\rscale_fill_viridis_d(begin = .8, end = .2) +\rscale_y_continuous(labels = scales::percent) +\rlabs(\rtitle = \u0026quot;Desempenho dos mandantes\u0026quot;,\rsubtitle = \u0026quot;por temporada\u0026quot;,\rx = \u0026quot;Temporada\u0026quot;,\ry = \u0026quot;Propor√ß√£o\u0026quot;,\rfill = \u0026quot;\u0026quot;\r)\rEm vez de olhar a propor√ß√£o dos resultados, poder√≠amos olhar diretamente a quantidade de pontos somados pelos mandantes em cada temporada.\nO gr√°fico a seguir mostra que o n√∫mero de pontos por temporada tende a permanecer entre 650 e 700, com algumas exce√ß√µes para mais e para menos. Novamente, 2020 foi a temporada com o segundo menor n√∫mero de pontos feitos pelos mandantes (621, contra 604 da temporada 2017).\ntab_resul_mandante %\u0026gt;% filter(season \u0026gt;= 2006) %\u0026gt;% group_by(season) %\u0026gt;% summarise(total_pontos = sum(pontos)) %\u0026gt;% ggplot(aes(x = season, y = total_pontos)) +\rgeom_line(color = viridis::viridis(1, begin = 0.2)) +\rgeom_label(aes(label = total_pontos), color = viridis::viridis(1, begin = 0.2)) +\rtheme_minimal(14) +\rlabs(\rx = \u0026quot;Temporada\u0026quot;,\ry = \u0026quot;N√∫mero de pontos do mandante\u0026quot;\r)\rPor fim, podemos investigar o efeito para cada time. A tabela a seguir mostra o n√∫mero de pontos como mandante conquistados por cada time na temporada de 2020 contra a m√©dia de pontos como mandante nas √∫ltimas 3 temporadas (2017, 2018 e 2019).\nlibrary(reactable)\rtab_resul_mandante %\u0026gt;% filter(season %in% c(2017:2020)) %\u0026gt;% mutate(home = brasileirao::fix_names(home)) %\u0026gt;% group_by(season, torcida, home) %\u0026gt;% summarise(total_pontos = sum(pontos)) %\u0026gt;% group_by(torcida, home) %\u0026gt;% summarise(media_pontos = mean(total_pontos)) %\u0026gt;% ungroup() %\u0026gt;%\rpivot_wider(\rid_cols = home,\rnames_from = torcida, values_from = media_pontos,\rnames_prefix = \u0026quot;pts_\u0026quot;\r) %\u0026gt;%\rfilter(!is.na(pts_sem_torcida)) %\u0026gt;% mutate(\rdiferenca_rel = (pts_sem_torcida - pts_com_torcida) / pts_com_torcida\r) %\u0026gt;% arrange(desc(diferenca_rel)) %\u0026gt;% mutate(\rpts_com_torcida = round(pts_com_torcida, 1),\rdiferenca_rel = scales::percent(diferenca_rel, accuracy = 0.1)\r) %\u0026gt;% reactable(\rpagination = FALSE,\rcompact = TRUE,\rstyle = \u0026quot;margin-bottom: 1px;\u0026quot;,\rcolumns = list(\rhome = colDef(\rname = \u0026quot;Time\u0026quot;\r),\rpts_com_torcida = colDef(\rname = \u0026quot;M√©dia √∫ltimas 3 temporadas\u0026quot;,\rna = \u0026quot;‚Äî\u0026quot;,\ralign = \u0026quot;center\u0026quot;\r),\rpts_sem_torcida = colDef(\rname = \u0026quot;Pontos como mandante em 2020\u0026quot;,\ralign = \u0026quot;center\u0026quot;\r),\rdiferenca_rel = colDef(\rname = \u0026quot;Diferen√ßa percentual\u0026quot;,\rna = \u0026quot;‚Äî\u0026quot;,\ralign = \u0026quot;center\u0026quot;\r)\r)\r)\r\r{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"home\":[\"Atl√©tico GO\",\"Atl√©tico MG\",\"Fluminense\",\"S√£o Paulo\",\"Internacional\",\"Gr√™mio\",\"Bahia\",\"Cear√°\",\"Sport\",\"Vasco\",\"Santos\",\"Fortaleza\",\"Athletico PR\",\"Flamengo\",\"Corinthians\",\"Palmeiras\",\"Coritiba\",\"Goi√°s\",\"Botafogo\",\"Bragantino\"],\"pts_com_torcida\":[17,32.3,28,36.3,42.5,38,32.3,29,29,30,39.7,35,37.3,43.3,37.7,44,26,36,32,\"NA\"],\"pts_sem_torcida\":[27,46,38,37,41,36,29,26,26,26,34,30,32,37,31,35,18,23,14,35],\"diferenca_rel\":[\"58.8%\",\"42.3%\",\"35.7%\",\"1.8%\",\"-3.5%\",\"-5.3%\",\"-10.3%\",\"-10.3%\",\"-10.3%\",\"-13.3%\",\"-14.3%\",\"-14.3%\",\"-14.3%\",\"-14.6%\",\"-17.7%\",\"-20.5%\",\"-30.8%\",\"-36.1%\",\"-56.2%\",null]},\"columns\":[{\"accessor\":\"home\",\"name\":\"Time\",\"type\":\"character\"},{\"accessor\":\"pts_com_torcida\",\"name\":\"M√©dia √∫ltimas 3 temporadas\",\"type\":\"numeric\",\"na\":\"‚Äî\",\"align\":\"center\"},{\"accessor\":\"pts_sem_torcida\",\"name\":\"Pontos como mandante em 2020\",\"type\":\"numeric\",\"align\":\"center\"},{\"accessor\":\"diferenca_rel\",\"name\":\"Diferen√ßa percentual\",\"type\":\"character\",\"na\":\"‚Äî\",\"align\":\"center\"}],\"defaultPageSize\":20,\"paginationType\":\"numbers\",\"showPageInfo\":true,\"minRows\":1,\"compact\":true,\"style\":{\"margin-bottom\":\"1px\"},\"dataKey\":\"2b468f9e054ebd18b78f798fe62e5ae4\",\"key\":\"2b468f9e054ebd18b78f798fe62e5ae4\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}\r\rConclus√µes\rExiste efeito da aus√™ncia de torcida no desempenho dos mandantes? Como bons cientistas, n√£o sabemos.\nDescritivamente, os dados indicam que, se o efeito existe, parece ser pequeno. Pelo menos menor do que o senso comum esperaria. Embora a propor√ß√£o de vit√≥rias e n√∫mero de pontos dos mandantes tenho sido abaixo da m√©dia, n√£o foi o pior ano e n√£o foi t√£o diferente das outras temporadas abaixo da m√©dia.\nOlhando por time, vimos queda no desempenho de alguns times que mantiveram ou refor√ßaram o elenco nos √∫ltimos anos, como Palmeiras e Flamengo. Outros times que n√£o apresentaram muita varia√ß√£o de elenco, como S√£o Paulo e Internacional, mantiveram a m√©dia dos √∫ltimos anos.\nPessoalmente, juntando o que vi nos dados e nos jogos, eu acredito na exist√™ncia de um efeito de torcida, mas acho muito dif√≠cil estud√°-lo isoladamente. As intera√ß√µes com time, est√°dio, advers√°rio, posi√ß√£o na tabela, entre outros fatores, podem ser muito importantes e, olhando s√≥ a m√©dia simples, ver√≠amos um efeito muito menor. Al√©m disso, existe o efeito pandemia, que mudou alguns aspectos do jogo (como as 5 substui√ß√µes e o calend√°rio ainda mais apertado) e trouxe mais ru√≠dos (como os surtos de COVID-19 que aconteceram em v√°rios times).\nAssim, deixo as seguintes perguntas:\n\rO que aconteceu em 2017?\n\rCom os dados dispon√≠veis, √© poss√≠vel testar (estatisticamente) o efeito da torcida? Quais seriam as suposi√ß√µes e limita√ß√µes?\n\rE voc√™? Acredita no efeito da torcida?\n\r\r√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2021-03-05-brasileirao-sem-torcida/","tags":["futebol","covid19"],"title":"Efeito da aus√™ncia de torcida nos jogos do Brasileir√£o"},{"author":["William"],"categories":["pacotes"],"contents":"\r\rRecentemente tive vontade de come√ßar a brincar com dados de futebol, mais especificamente o que sobrou do futebol brasileiro.\nDepois de uma busca bem r√°pida na internet, resolvi que montaria a minha pr√≥pria base, at√© como uma forma de praticar web scraping.\nFoi assim que surgiu o pacote {brasileirao}, que reune os resultados de todas as partidas da S√©rie A do Campeonato Brasileiro das temporadas de 2003 a 2020.\n\rAbrem-se as cortinas e come√ßa o espet√°culo - Fiori Gigliotti, narrador esportivo brasileiro\n\rO pacote\rO pacote est√° dispon√≠vel neste reposit√≥rio. Para instalar direto do R, basta rodar o c√≥digo abaixo:\nremotes::install_github(\u0026quot;williamorim/brasileirao\u0026quot;)\rPara acessar os dados das partidas, chame o objeto matches.\nlibrary(dplyr)\rlibrary(brasileirao)\rmatches\r## # A tibble: 7,646 √ó 5\r## season date home score away ## \u0026lt;dbl\u0026gt; \u0026lt;date\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 2003 2003-03-29 Athletico PR 2x0 Gr√™mio ## 2 2003 2003-03-29 Guarani 4x2 Vasco ## 3 2003 2003-03-30 Corinthians 0x3 Atl√©tico MG\r## 4 2003 2003-03-30 Goi√°s 2x2 Paysandu ## 5 2003 2003-03-30 Crici√∫ma 2x0 Fluminense ## 6 2003 2003-03-30 Cruzeiro 2x2 S√£o Caetano\r## 7 2003 2003-03-30 Flamengo 1x1 Coritiba ## 8 2003 2003-03-30 Fortaleza 0x0 Bahia ## 9 2003 2003-03-30 Internacional 1x1 Ponte Preta\r## 10 2003 2003-03-30 Juventude 2x2 S√£o Paulo ## # ‚Ä¶ with 7,636 more rows\rPara ver os dados de uma temporada, voc√™ pode usar a fun√ß√£o filter(), do pacote dplyr.\nmatches %\u0026gt;% filter(season == 2020)\r## # A tibble: 380 √ó 5\r## season date home score away ## \u0026lt;dbl\u0026gt; \u0026lt;date\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 2020 2020-08-08 Fortaleza 0x2 Athletico PR ## 2 2020 2020-08-08 Coritiba 0x1 Internacional\r## 3 2020 2020-08-08 Sport 3x2 Cear√° ## 4 2020 2020-08-09 Flamengo 0x1 Atl√©tico MG ## 5 2020 2020-08-09 Santos 1x1 Bragantino ## 6 2020 2020-08-09 Gr√™mio 1x0 Fluminense ## 7 2020 2020-09-30 Botafogo 1x2 Bahia ## 8 2020 2020-09-30 Corinthians 0x0 Atl√©tico GO ## 9 2020 2020-12-03 Goi√°s 0x3 S√£o Paulo ## 10 2020 2021-01-26 Palmeiras 1x1 Vasco ## # ‚Ä¶ with 370 more rows\rO pacote tamb√©m possui uma fun√ß√£o para padronizar o nome dos times: fix_names(). Alguns times, como o Atl√©tico mineiro aparecem como Atl√©tico MG e Atl√©tico-MG na base. Tamb√©m h√° casos de times que mudaram de nome nesse per√≠odo, como o Athetico e o Gr√™mio Barueri. Pode isso, Arnaldo?\nVeja a seguir um exemplo da fun√ß√£o em a√ß√£o:\natleticos \u0026lt;- matches %\u0026gt;%\rfilter(stringr::str_detect(home, \u0026quot;Atl√©tico\u0026quot;)) %\u0026gt;% pull(home) %\u0026gt;% unique()\ratleticos\r## [1] \u0026quot;Atl√©tico MG\u0026quot; \u0026quot;Atl√©tico GO\u0026quot;\rfix_names(atleticos)\r## [1] \u0026quot;Atl√©tico MG\u0026quot; \u0026quot;Atl√©tico GO\u0026quot;\rEla tamb√©m pode ser utilizada diretamente em uma coluna com nome de times usando o mutate().\nmatches %\u0026gt;% mutate(home = fix_names(home), away = fix_names(away))\r## # A tibble: 7,646 √ó 5\r## season date home score away ## \u0026lt;dbl\u0026gt; \u0026lt;date\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 2003 2003-03-29 Athletico PR 2x0 Gr√™mio ## 2 2003 2003-03-29 Guarani 4x2 Vasco ## 3 2003 2003-03-30 Corinthians 0x3 Atl√©tico MG\r## 4 2003 2003-03-30 Goi√°s 2x2 Paysandu ## 5 2003 2003-03-30 Crici√∫ma 2x0 Fluminense ## 6 2003 2003-03-30 Cruzeiro 2x2 S√£o Caetano\r## 7 2003 2003-03-30 Flamengo 1x1 Coritiba ## 8 2003 2003-03-30 Fortaleza 0x0 Bahia ## 9 2003 2003-03-30 Internacional 1x1 Ponte Preta\r## 10 2003 2003-03-30 Juventude 2x2 S√£o Paulo ## # ‚Ä¶ with 7,636 more rows\rO pacote √© atualizado diriamente, a partir de um script executado via Github Actions. Esse fluxo √© pausado nos meses entre temporadas.\n\rDe onde os dados vieram?\rOs dados das temporadas de 2003 a 2019 vieram do site Chance de gol. Particularmente, eu n√£o gosto muito de previs√µes de resultados esportivos, mas o site √© bem legal para quem gosta do tema! E, claro, ele √© bem f√°cil de scrapear, o que √© importante se voc√™ √© n√≠vel 1 em Web Scraping igual eu.\nComo no Chance de Gol n√£o tinha os dados da temporada de 2020, eu fui buscar na p√°gina do ge. A tarefa tamb√©m bem tranquila, pois os dados da p√°gina s√£o atualizados a partir de uma API, que consegui acessar diretamente.\nO c√≥digo que utilizei nos dois casos pode ser encontrado aqui.\n\rPr√≥ximos passos\rMeu objetivo √© continuar implementando o pacote, trazendo mais dados sobre as partidas da S√©rie A (local, p√∫blico, cart√µes, posse de bola, chutes a gol etc), al√©m de completar com os dados das demais s√©ries (B, C e D).\nSe voc√™ encontrar qualquer problema no pacote ou inconsist√™ncia nos dados, n√£o deixe de me avisar abrindo uma issue no reposit√≥rio.\n√â isso! D√∫vidas, sugest√µes e cr√≠ticas, mande aqui nos coment√°rios.\nAt√© a pr√≥xima!\n\r","permalink":"https://blog.curso-r.com/posts/2021-03-02-brasileirao/","tags":["futebol","web scraping"],"title":"O pacote {brasileirao}"},{"author":["Fernando"],"categories":["an√°lises","conceitos","tutoriais","r"],"contents":"\rA distribui√ß√£o normal (tamb√©m conhecida como distribui√ß√£o gaussiana) √© um dos conceitos mais importantes da estat√≠stica. Ela nos ajuda a interpretar resultados experimentais em todas as √°reas da ci√™ncia e tamb√©m √© o pressuposto de diversos modelos estat√≠sticos, como por exemplo os modelos de regress√£o linear.\nNessa s√©rie de posts, n√≥s te ajudamos a analisar estatisticamente se uma vari√°vel segue ou n√£o a distribui√ß√£o normal de maneira simples e r√°pida. Na parte 1 falamos sobre gr√°ficos que podem te ajudar a fazer isso e na parte 2 falamos do pacote PoweR, que concentra uma s√©rie de procedimentos estat√≠sticos.\nNo √∫ltimo post da nossa s√©rie vamos falar sobre um ponto muito importante: por que precisamos fazer testes de normalidade? Felizmente, a resposta √© simples, mas nem tanto:\nVoc√™ deve testar a normalidade dos seus dados quando isso for um pressuposto da sua an√°lise\rIsso pode parecer √≥bvio, mas √© a coisa mais importante que voc√™ precisa saber. Alguns m√©todos estat√≠sticos funcionam direitinho quando existe uma distribui√ß√£o normal por tr√°s, como por exemplo a regress√£o linear simples: os intervalos de confian√ßa t√™m as propriedades que dizem ter, as estimativas dos betas n√£o ter√£o vi√©s etc. Isso quer dizer que na aus√™ncia de normalidade voc√™ n√£o deveria usar uma regress√£o? N√ÉO! Regress√µes lineares funcionam bem em muitos contextos, mas se voc√™ quiser realizar testes de hip√≥teses sobre os par√¢metros da sua regress√£o, por exemplo, voc√™ pode ter problemas.\nAl√©m da regress√£o linear simples, muitos modelos pressup√µem direta ou indiretamente a normalidade dos seus dados, como por exemplo:\n\rANOVAs param√©tricas (de uma via, duas vias, MANOVA)‚Ä¶\rRegress√µes lineares simples e m√∫ltiplas\rClusteriza√ß√£o por K-m√©dias\r\rTamb√©m existem outros procedimentos estat√≠sticos que PODEM precisar que os dados brutos sigam a distribui√ß√£o normal, mas n√£o vamos falar muito deles pois se o tamanho da amostra for suficientemente grande (\\(N\\) \u0026gt; 100, por simplicidade) voc√™ pode seguir com seguran√ßa. Estamos falando de todos os sabores de teste t, por exemplo.\nPor que devo testar normalidade depois de fazer uma regress√£o?\rRegress√µes, bem como ANOVAs, MANOVAs e varia√ß√µes sobre o tema normalmente seguem o seguinte padr√£o:\n\\[Y_i = \\alpha + \\beta X_i+ \\epsilon_i \\\\ \\epsilon_i\\text{ segue a distribui√ß√£o normal com m√©dia } 0\\text{ e vari√¢ncia }\\sigma\\]\nA partir dessa segunda observa√ß√£o sobre a normalidade dos erros, √© poss√≠vel afirmar v√°rias coisas sobre \\(\\alpha\\), \\(\\beta\\) e \\(Y_i\\): quais s√£o os valores mais prov√°veis dessas vari√°veis e qu√£o prov√°vel √© que eles n√£o sejam 0, por exemplo. Se essas considera√ß√µes sobre a variabilidade das estimativas te interessam, voc√™ deveria testar a normalidade dos res√≠duos da sua regress√£o, isso √©, a normalidade dos erros \\(\\hat{Y}_i - Y\\) cometidos pelo seu ajuste \\(\\hat{Y}_i\\).\n\rPor que devo testar normalidade depois de ajustar uma clusteriza√ß√£o usando o m√©todo das k-m√©dias?\rAqui a coisa √© um pouco mais feia do que no caso da regress√£o, mas tamb√©m √© interessante. Uma das maneiras de construir esse algoritmo √© assumindo que dentro dos seus dados, sem que voc√™ saiba, existe um certo n√∫mero de distribui√ß√µes gaussianas. O m√©todo das k-m√©dias √© perfeito quando essa hip√≥tese √© verdadeira: ele √© capaz de encontrar perfeitamente esses grupos com um tamanho de amostra suficientemente grande. Mas o que acontece se essa hip√≥tese for falsa?\nUm exemplo interessante analisado pelo David Robinson √© o caso em que os dados est√£o distribu√≠dos ao longo de um c√≠rculo. A imagem abaixo mostra o que acontece quando rodamos um algoritmo de k-m√©dias nesse conjunto de dados: n√≥s quebramos as esferas/c√≠rculos no meio.\nEsquisito n√©? Os dados de fato se dividem em dois grupos (o c√≠rculo de fora e a bola de dentro), o k-m√©dias rodou, mas encontrou grupos diferentes dos ‚Äúreais‚Äù. Essa √© uma situa√ß√£o em que usar um teste de normalidade poderia nos dar uma dica de que estamos nesse cen√°rio de desalinho entre o algoritmo utilizado e os dados dispon√≠veis: √© muito claro que os grupos encontrados pelo k-m√©dias n√£o seguem uma distribui√ß√£o normal multivariada. A partir desse teste, poder√≠amos partir para um outro algoritmo que fosse capaz de encontrar esse padr√£o, como uma clusteriza√ß√£o hier√°rquica.\n\r\rConsidera√ß√µes finais\rLendo esse post voc√™ pode estar se perguntando ‚Äúo algoritmo sempre roda, para qualquer conjunto de dados. para que a normalidade importa?‚Äù. De fato, sempre podemos usar todos os algoritmos em todos os contextos, mesmo nos inadequados, e isso n√£o necessariamente √© ruim. Com cuidado, voc√™ sempre conseguir√° interpretar os resultados corretamente e extrair das an√°lises o que for mais √∫til para voc√™. O que √© realmente importante √© ter consci√™ncia: saber as regras para poder quebra-las, quando for adequado, ou trocar de estrat√©gia quando precisar.\n\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre esse assunto, temos alguns cursos que tocam os temas deste post. D√™ uma olhada nos nossos cursos de Regress√£o Linear ou Machine Learning e aproveite!\n\r","permalink":"https://blog.curso-r.com/posts/2021-02-26-testes-de-normalidade/","tags":["faxina","modelagem"],"title":"Testes de normalidade em R - Parte 3: Quando eu devo fazer um teste de normalidade?"},{"author":["Athos"],"categories":["an√°lises","conceitos","tutoriais","r"],"contents":"\r\rlibrary(torch)\rlibrary(torchvision)\rlibrary(zeallot)\rdevice \u0026lt;- torch_device(if(cuda_is_available()) \u0026quot;cuda\u0026quot; else \u0026quot;cpu\u0026quot;)\rcpu \u0026lt;- torch_device(\u0026quot;cpu\u0026quot;)\rNeural Style Transfer √© uma das t√©cnicas mais divertidas e ‚Äúart√≠sticas‚Äù do deep learning. A imagem abaixo resume o que a gente vai fazer.\ncontent\n\rVoc√™ fornece duas imagens √† rede neural: style e content e o resultado ser√° a imagem content com o estilo de style. √â como se fosse um filtro do instagram, mas com o estilo do seu artista predileto =P.\nEste post √© uma adapta√ß√£o para R + torch do exerc√≠cio do curso ‚ÄòConvolutional Neural Networks‚Äô do deeplearning.ai que eu fiz, originalmente em Python + tensorflow. Quando comecei a escrever esse post, tinha a inten√ß√£o de ser o mais did√°tico poss√≠vel, mas acho que eu n√£o conseguiria superar o curso do Coursera, ent√£o vou me ater aos principais pontos e comentar o c√≥digo para quem quiser criar suas pr√≥prias imagens! Al√©m disso, este v√≠deo em portugu√™s mostra um sum√°rio da estrat√©gia do NST.\nPS: durante a escrita desse post eu descobri que o Daniel j√° tinha feito um codigozinho de NST para o torchvision. Parte do c√≥digo roubei de l√° kkk.\nConceitos e ideias importantes\rA ideia √© gerar uma imagem generated G que tenha conte√∫do similar a content C e estilo similar a style S. O conte√∫do e o estilo s√£o, geralmente, extra√≠dos de uma convnet pr√©-treinada. O artigo original (Gatys, Ecker, and Bethge 2015) utiliza o VGG19, que j√° vem dentro do {torchvision}.\n# VGG19 model\rvgg \u0026lt;- model_vgg19(pretrained = TRUE)$features$to(device = device)\r# congelando os pesos\rvgg$parameters %\u0026gt;% purrr::walk(function(param) param$requires_grad_(FALSE))\rEnt√£o o VGG19 vai nos fornecer as features e agora precisamos definir fun√ß√µes de custo para achar a imagem que tem o melhor compromisso entre o conte√∫do de uma imagem e o estilo de outra. A constru√ß√£o do algoritmo pode ser divida em tr√™s partes:\n\rFun√ß√£o de custo do content: \\(L_{content}(C, G)\\)\rFun√ß√£o de custo do style: \\(L_{style}(S, G)\\)\rFun√ß√£o de custo global: \\(L(G) = \\alpha L_{content}(C, G) + \\beta L_{style}(S, G)\\)\r\rFun√ß√£o de custo do content\rSobre a escolha entre camadas rasas versus camadas profundas:\n\rAs primeiras camadas de uma rede convolucional tendem a extrair padr√µes mais b√°sicos como bordas e texturas simples.\rCamadas mais profundas costumam captar caracter√≠sticas mais sofisticadas como texturas detalhadas e objetos.\r\rE sobre a escolha de uma camada do meio, queremos a imagem generated com conte√∫do similar ao content. A estrat√©gia √©:\nescolher uma camada da rede para representar este tal ‚Äúconte√∫do.‚Äù\rpegar essa camada para cada uma das imagens content e generated.\rfazer a rede for√ßar com que essas duas camadas sejam o mais parecidas poss√≠vel.\r\rEnt√£o a fun√ß√£o de custo para refletir o ponto (3) pode ser simplesmente o erro quadr√°tico m√©dio entre os pixels dessa camada:\ncontent_loss \u0026lt;- function(content_layer, generated_layer) {\rnnf_mse_loss(content_layer, generated_layer)\r}\rOBS: Na pr√°tica, voc√™ ir√° obter o resultado ‚Äúmais legal‚Äù se escolher camadas da mei√∫ca: nem t√£o rasa, nem t√£o profunda. J√° que a VGG19 possui 37 camadas, a escolhida pode ser, por exemplo, a camada 14.\n\rFun√ß√£o de custo do style\rA finalidade da fun√ß√£o de custo do style √© minimizar a dist√¢ncia entre as tais Gram matrix das imagens style e generated.\nGram matrix\rA matriz de estilo √© chamada de Gram matrix na literatura. Na matem√°tica, dado um conjunto de vetores, a Gram matrix √© matriz dos produtos internos dos pares destes vetores. √â como se fosse uma matriz de correla√ß√£o, mas sem centralizar pela m√©dia. Na pr√°tica, pega-se uma camada da rede, transforma em um tensor 2D (matriz) e calcula \\(A * A^T\\).\ngram_matrix \u0026lt;- function(tensor) {\rc(b,c,h,w) %\u0026lt;-% tensor$size()\rtensor \u0026lt;- tensor$view(c(c, h*w))\rtorch_matmul(tensor, tensor$t())/(h*w)\r}\rA fun√ß√£o de custo \\(L_{style}(S, G)\\) √© o bom e velho erro quadr√°tico m√©dio entre as Gram matrices.\nstyle_loss \u0026lt;- function(style_layer, generated_layer) {\rstyle_gram \u0026lt;- gram_matrix(style_layer)\rgenerated_gram \u0026lt;- gram_matrix(generated_layer)\rnnf_mse_loss(style_gram, generated_gram)\r}\r\rCamadas dos estilos\rEm vez de uma, pega-se cinco camadas intermedi√°rias da rede para calcular as dist√¢ncias entre as respectivas Gram matrices. A fun√ß√£o de custo vai passar a ser uma pondera√ß√£o dessas cinco dist√¢ncias: \\(L_{style}(S, G) = \\sum_{l=1}^{5}\\lambda^{[l]}L_{style}^{[l]}(S,G)\\)\nstyle_layers \u0026lt;- c(2, 7, 12, 21, 29) # escolha das layers da VGG\rlambdas \u0026lt;- 1e5/(c(1,10,10,10,10)^2) # pesos para cada uma das layers no estilo final\rAgora vale criar uma nn_module() que retorne as camadas intermedi√°rias da rede (no caso VGG19). O argumento layers_out permite escolher quais camadas queremos trazer.\nfeatures \u0026lt;- nn_module(\rinitialize = function(convnet) {\r# poderia ser qualquer convnet pr√©-treinada. Iremos usar a VGG19\rself$convnet \u0026lt;- convnet\r},\rforward = function(img, layers_out = NULL) {\rlayers \u0026lt;- seq_along(self$convnet) # 1 a 37\rif(is.null(layers_out)) layers_out \u0026lt;- layers\rconv_outs \u0026lt;- purrr::accumulate(layers, ~self$convnet[[.y]](.x), .init = img) # lista de 37 tensores\rconv_outs[layers_out] # lista apenas com as layers selecionadas\r}\r)\r\r\r\rOtimiza√ß√£o\rAbaixo segue c√≥digo comentado para rodar a otimiza√ß√£o.\n#fun√ß√µes auxiliares\rto_r \u0026lt;- function(x) as.numeric(x$to(device = cpu))\rplot_image \u0026lt;- function(tensor) {\rim \u0026lt;- tensor$to(device = \u0026quot;cpu\u0026quot;)[1,..]$\rpermute(c(2, 3, 1))$\rto(device = \u0026quot;cpu\u0026quot;)$\rclamp(0,1) %\u0026gt;% # make it [0,1]\ras.array()\rpar(mar = c(0,0,0,0))\rplot(as.raster(im))\r}\rload_image \u0026lt;- function(path, geometry = \u0026quot;250x200\u0026quot;) {\rimg \u0026lt;- path %\u0026gt;%\rmagick_loader() %\u0026gt;%\rmagick::image_resize(geometry) %\u0026gt;%\rtransform_to_tensor() %\u0026gt;%\rtorch_unsqueeze(1)\rimg$to(device = device)\r}\rOs par√¢metros e inputs que valem a pena experimentar s√£o:\n\rcontent e style: Imagens de input: a de conte√∫do e a de estilo.\rcontent_layer: a layer da VGG19 para extrair o conte√∫do imagem de conte√∫do.\rstyle_layers: as layers da VGG19 para extrair o estilo imagem de estilo.\rlambdas: os pesos de cada feature de estilo na otimiza√ß√£o.\rcontent_weight: o peso das features de conte√∫do na otimiza√ß√£o.\rstyle_weight: o peso das features de estilo (global) na otimiza√ß√£o.\r\rOutros dois par√¢metros que afetam drasticamente o resultado s√£o as dimens√µes das duas imagens de input. No c√≥digo abaixo onde tem \"400x400\" e \"350x500\" pode-se trocar por outras dimens√µes a fim de se obter resultados diferentes.\nNo processo de cria√ß√£o voc√™ ir√° mexer nesses par√¢metros o tempo todo!\n# INPUT: content and style images\rcontent \u0026lt;- load_image(\u0026quot;content/posts/2021-02-22-neural-style-transfer/cristoredentor3.jpg\u0026quot;, \u0026quot;400x400\u0026quot;)\rstyle \u0026lt;- load_image(\u0026quot;content/posts/2021-02-22-neural-style-transfer/vangogh_starry_night.jpg\u0026quot;, \u0026quot;350x500\u0026quot;)\r# style and content feature setup\rcontent_layer \u0026lt;- 14\rstyle_layers \u0026lt;- c(2, 7, 12, 21, 29)\rlambdas \u0026lt;- 1e5/(c(1,10,10,10,10)^2)\rcontent_weight \u0026lt;- 2\rstyle_weight \u0026lt;- 4e-1\rcontent\n\rstyle\n\r# FEATURES: extra√≠das da VGG19\rvgg_features \u0026lt;- features(vgg)\rcontent_features \u0026lt;- vgg_features(content, content_layer)\rstyle_features \u0026lt;- vgg_features(style, style_layers)\r# OUTPUT: generated image\rgenerated \u0026lt;- torch_clone(content)$requires_grad_(TRUE)\roptim \u0026lt;- optim_adam(generated, lr = 0.02)\rlr_scheduler \u0026lt;- lr_step(optim, 100, 0.9)\r# loop de otimiza√ß√£o\rfor(step in seq_len(8000)) {\roptim$zero_grad()\r# atualiza as features da imagem que est√° sendo gerada\rgenerated_features \u0026lt;- vgg_features(generated, c(content_layer, style_layers))\r# losses\rLC \u0026lt;- content_loss(content_features[[1]], generated_features[[1]])\rLS \u0026lt;- 0\rfor(i in seq_along(lambdas)) LS \u0026lt;- LS + lambdas[i]*style_loss(style_features[[i]], generated_features[-1][[i]]) loss \u0026lt;- content_weight * LC + style_weight * LS\rloss$backward()\roptim$step()\rlr_scheduler$step()\r# feedback\rif(step %% 100 == 0) {\rcat(glue::glue(\u0026quot;LC = {to_r(LC)} - LS = {to_r(LS)} - Loss = {to_r(loss)}\\n\\n\u0026quot;))\rplot_image(generated)\r}\r}\r# imagem final\rplot_image(generated)\rLC = 2.70741701126099 - LS = 36.7998428344727 - Loss = 20.1347713470459\rLC = 2.61282753944397 - LS = 24.3190288543701 - Loss = 14.9532661437988\rLC = 2.54735898971558 - LS = 19.7909469604492 - Loss = 13.0110969543457\rLC = 2.49572896957397 - LS = 16.9353790283203 - Loss = 11.7656097412109\rLC = 2.44669985771179 - LS = 16.6177845001221 - Loss = 11.5405139923096\rE a√≠? Ficou com cara de pintura? Comente o que achou! Tente com suas imagens e compartilhe com a gente =). Aprender como NST funciona √© um grande exerc√≠cio para aprimorar o entendimento sobre modelos de deep learning em geral, principalmente sobre como podemos criar fun√ß√µes de custo mais especializadas em um determinado contexto.\n\rAprenda Deep learning com a Curso-R\rSe voc√™ quiser entrar no incr√≠vel mundo das redes profundas, nosso curso de Deep Learning √© a melhor porta de entrada, conhe√ßa!\nGatys, Leon A., Alexander S. Ecker, and Matthias Bethge. 2015. ‚ÄúA Neural Algorithm of Artistic Style.‚Äù http://arxiv.org/abs/1508.06576.\r\r\r\r","permalink":"https://blog.curso-r.com/posts/2021-02-22-neural-style-transfer/","tags":["deep learning","torch","neural style transfer","modelagem"],"title":"Neural Style Transfer com Torch"},{"author":["William"],"categories":["tutoriais"],"contents":"\r\rAbaixo segue um passo-a-passo para criar seu blogzinho com o R + blogdown e escrever posts com todo o poder do RMarkdown.\nCaminho das pedras do {blogdown}\r\rAbrir o RStudio limpo (sem estar em nenhum projeto)\n\rCriar o projeto com git/github\n\rusethis::create_project()\rusethis::use_git()\rusethis::use_github()\r\rCriar o site com o pacote {blogdown}\n\rinstall.packages(\"blogdown\")\rblogdown::new_site(\"caminho\", theme = \"usuario/repositorio\")\rhttps://themes.gohugo.io/ para escolher temas\r\rConfigurar o site no arquivo config.toml\n\rMexer nos posts dentro da pasta content/post\n\rUsar blogdown::new_post() para criar novos pots.\r\rRodar blogdown::serve_site() para testar local.\n\rRodar blogdown::build_site() para montar o site final.\n\rSubir para o Github para colocar em produ√ß√£o (se estiver usando o GH pages)\n\r\rClique aqui para assistir ao peda√ßo de live gravada da gente criando um blogdown do zero.\nE aqui para ver o repo do github com os c√≥digos resultantes!\nE se quiser ajuda profissional nessa caminhada, conhe√ßa nossos cursos de deploy, visualiza√ß√£o e relat√≥rios!\n\r","permalink":"https://blog.curso-r.com/posts/2021-02-12-receitinha-para-criar-seu-blog-com-blogdown/","tags":["blog","blogdown","web"],"title":"Receitinha para criar seu blog com {blogdown}"},{"author":["Fernando"],"categories":["an√°lises","conceitos","tutoriais","r"],"contents":"\r\rA distribui√ß√£o normal (tamb√©m conhecida como distribui√ß√£o gaussiana) √© um dos conceitos mais importantes da estat√≠stica. Ela nos ajuda a interpretar resultados experimentais em todas as √°reas da ci√™ncia e tamb√©m √© o pressuposto de diversos modelos estat√≠sticos, como por exemplo os modelos de regress√£o linear.\nNessa s√©rie de posts, vamos te ajudar a analisar estatisticamente se uma vari√°vel segue ou n√£o a distribui√ß√£o normal de maneira simples e r√°pida. Hoje vamos falar especificamente de testes de hip√≥teses.\nAproveite e d√™ uma olhada na parte 1 se voc√™ tamb√©m quiser sobre gr√°ficos que ajudam a detectar desvios da distribui√ß√£o normal.\nR b√°sico\rOs pacotes do R b√°sico, que j√° s√£o instalados automaticamente, contam com dois √∫nicos testes de normalidade pr√©-implementados: ks.test para o teste de Kolmogorov-Smirnov e shapiro.test para o teste de Shapiro-Wilk. Claro que √© poss√≠vel implementar outros testes manualmente, mas essas fun√ß√µes j√° calculam as estat√≠sticas de teste e fornecem valores p, inclusive com algumas parametriza√ß√µes dispon√≠veis. Vamos exemplificar o funcionamento dessas fun√ß√µes com a coluna hp (ou horse-power) da base mtcars.\nA fun√ß√£o shapiro.test tem uma interface bem amig√°vel. Voc√™ insere um vetor, que pode muito bem ser uma coluna de um banco de dados, e recebe de volta o valor calculado da estat√≠stica de teste e o valor p calculado. A implementa√ß√£o dessa fun√ß√£o segue as especifica√ß√µes de um paper famoso de 1995. No caso da coluna hp, o resultado do teste de Shapiro-Wilk √© um valor p de 0.0488082. Ou seja, observamos um desvio improv√°vel com rela√ß√£o ao que se esperaria caso os dados realmente viessem de uma distribui√ß√£o normal. N√£o parece que seria isso que aconteceria, n√©? O gr√°fico dava outra ideia.\n\rshapiro.test(mtcars$hp)\r## ## Shapiro-Wilk normality test\r## ## data: mtcars$hp\r## W = 0.93342, p-value = 0.04881\rPara tirar a d√∫vida, vamos ver qual √© o resultado do teste de Kolmogorov-Smirnov com a fun√ß√£o ks.test. Nesse caso, a usabilidade √© um pouco pior do que no caso da fun√ß√£o shapiro.test, j√° que voc√™ tamb√©m precisa imputar manualmente a m√©dia e o desvio padr√£o do seu vetor. Nesse caso, obtemos um valor p maior (aproximadamente 30%), mais condizente com o gr√°fico que constru√≠mos antes.\nks.test(mtcars$hp, \u0026quot;pnorm\u0026quot;, mean(mtcars$hp), sd(mtcars$hp), exact = TRUE)\r## ## One-sample Kolmogorov-Smirnov test\r## ## data: mtcars$hp\r## D = 0.16639, p-value = 0.3037\r## alternative hypothesis: two-sided\r\rO pacote PowerR\rMesmo que o R b√°sico disponha de apenas dois testes, dois pesquisadores da universidade de Montreal compilaram uma s√©rie de procedimentos estat√≠sticos no pacote PoweR e o resultado est√° dispon√≠vel no CRAN. A ideia central do pacote √© viabilizar a compara√ß√£o massiva de v√°rios testes de hip√≥teses, inclusive testes de normalidade, por isso todos os testes podem ser executados rapidamente e de maneira robusta. A t√≠tulo de compara√ß√£o, o teste de Shapiro-Wilk no R b√°sico s√≥ funciona at√© 5000 observa√ß√µes, enquanto no PoweR essa limita√ß√£o n√£o existe.\nAo inv√©s de ter uma fun√ß√£o para cada teste, como fizemos nos exemplos anteriores, neste pacote √© necess√°rio fazer refer√™ncia a c√≥digos internos que est√£o descritos na documenta√ß√£o do pacote. A vantagem dessa interface √© que a sa√≠da √© padronizada de em qualquer fun√ß√£o que a gente escolha usar. Vamos dar uma olhada em como ficam o resultado dos testes de Shapiro-Wilk.\n#install.packages(\u0026#39;PoweR\u0026#39;)\rlibrary(PoweR)\r# o c√≥digo identificador da distribui√ß√£o de Shapiro-Wilk √© o n√∫mero 21\rstatcompute(21, mtcars$hp)\r## $statistic\r## [1] 0.9334193\r## ## $pvalue\r## [1] 0.04880824\r## ## $decision\r## [1] 1 1\r## ## $alter\r## [1] 4\r## ## $stat.pars\r## [1] NA\r## ## $symbol\r## [1] \u0026quot;W\u0026quot;\rInfelizmente o PoweR n√£o tem a exata implementa√ß√£o do teste de Kolmogorov-Smirnov que temos no R. Entretanto, existem diversos testes, como o de Anderson-Darling e o teste Lilliefors, outros procedimentos comuns para testar a normalidade dos dados. No exemplo abaixo, podemos ver que esses dois outros testes concordam com o teste de Shapiro-Wilk: o resultado observado √© improv√°vel sob a hip√≥tese de que os dados realmente foram obtidos de uma distribui√ß√£o normal.\n\rlibrary(PoweR)\rprint(\u0026quot;O c√≥digo identificador da distribui√ß√£o de Lilliefors √© o n√∫mero 1\u0026quot;)\r## [1] \u0026quot;O c√≥digo identificador da distribui√ß√£o de Lilliefors √© o n√∫mero 1\u0026quot;\rstatcompute(1, mtcars$hp)\r## $statistic\r## [1] 0.1663854\r## ## $pvalue\r## [1] 0.02448416\r## ## $decision\r## [1] 1 1\r## ## $alter\r## [1] 3\r## ## $stat.pars\r## [1] NA\r## ## $symbol\r## [1] \u0026quot;K-S\u0026quot;\rprint(\u0026quot;O c√≥digo identificador da distribui√ß√£o de Anderson-Darling √© o n√∫mero 2\u0026quot;)\r## [1] \u0026quot;O c√≥digo identificador da distribui√ß√£o de Anderson-Darling √© o n√∫mero 2\u0026quot;\rstatcompute(2, mtcars$hp)\r## $statistic\r## [1] 0.7077449\r## ## $pvalue\r## [1] 0.05839104\r## ## $decision\r## [1] 0 1\r## ## $alter\r## [1] 3\r## ## $stat.pars\r## [1] NA\r## ## $symbol\r## [1] \u0026quot;AD^*\u0026quot;\rVoc√™ pode dar uma olhada em todos os procedimentos que est√£o dispon√≠veis no PoweR e escolher os que voc√™ achar mais interessantes para voc√™. Existem v√°rias refer√™ncias dispon√≠veis na documenta√ß√£o do pacote e voc√™ pode se informar sobre eles atrav√©s dos artigos que fundamentam os testes. √â interessante usar v√°rios testes diferentes, j√° que cada um deles funciona melhor/pior em determinadas situa√ß√µes, mas isso √© um assunto para o pr√≥ximo texto da s√©rie‚Ä¶ At√© l√°!\n\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre esse assunto, temos alguns cursos que tocam os temas deste post. D√™ uma olhada nos nossos cursos de Regress√£o Linear ou Machine Learning e aproveite!\n\r","permalink":"https://blog.curso-r.com/posts/2021-02-04-testes-de-normalidade/","tags":["faxina","modelagem"],"title":"Testes de normalidade em R - Parte 2: Testes"},{"author":["Fernando"],"categories":["an√°lises","conceitos","tutoriais","r"],"contents":"\r\rA distribui√ß√£o normal (tamb√©m conhecida como distribui√ß√£o gaussiana) √© um dos conceitos mais importantes da estat√≠stica. Ela nos ajuda a interpretar resultados experimentais em todas as √°reas da ci√™ncia e tamb√©m √© o pressuposto de diversos modelos estat√≠sticos, como por exemplo os modelos de regress√£o linear.\nNessa s√©rie de posts, vamos te ajudar a analisar estatisticamente se uma vari√°vel segue ou n√£o a distribui√ß√£o normal de maneira simples e r√°pida. Hoje vamos falar especificamente de gr√°ficos!\nM√©todo visual (Q-Q plot)\rNada como construir um gr√°fico para nos informar rapidamente o que est√° acontecendo com uma vari√°vel! Para isso, vamos usar o pacote ggpubr, que al√©m do Q-Q plot tamb√©m ajuda a produzir ggplot2 prontos para publica√ß√£o.\nVamos come√ßar analisando a distribui√ß√£o de duas vari√°veis de bases distintas: a pot√™ncia dos carros (vari√°vel hp) na cl√°ssica mtcars e o comprimento da nadadeira dos pinguins de palmer (dispon√≠vel em portugu√™s no pacote dados: https://github.com/cienciadedatos/dados).\nCome√ßando pelo peso dos carros, a fun√ß√£o que vamos usar para fazer os nosso gr√°fico √© a fun√ß√£o ggqqplot. O que essa fun√ß√£o faz √© comparar os quantis emp√≠ricos da nossa vari√°vel padronizada com os quantis te√≥ricos da distribui√ß√£o normal com m√©dia 0 e vari√¢ncia 1. Parece complicado, mas o gr√°fico √© bem mais f√°cil de entender:\nlibrary(ggpubr)\rggqqplot(mtcars$hp)\rA linha preta representa os resultados esperados se os dados seguissem a distribui√ß√£o normal. J√° a faixa cinza por sua vez representa a variabilidade toler√°vel ao redor dessa linha. Quanto mais o nossos dados (pontinhos pretos) escaparem dessa faixa mais fora do padr√£o da distribui√ß√£o normal os dados est√£o. No caso acima nenhum ponto saiu da faixa, o que indica que os nossos dados seguem uma distribui√ß√£o normal.\nVamos dar uma olhara em um caso em que n√£o h√° distribui√ß√£o normal para ver como fica?\nlibrary(ggpubr)\r#devtools::install_github(\u0026quot;https://github.com/cienciadedatos/dados\u0026quot;)\rlibrary(dados)\rggqqplot(pinguins$comprimento_nadadeira)\rDessa vez d√° para notar que tem muitos pontos fora da faixa n√©? Pois essa √© a evid√™ncia de que estamos fora da distribui√ß√£o normal!\nSe voc√™ quisesse parar de ler aqui e seguir com as suas an√°lises de normalidade, voc√™ at√© poderia, mas perderia as malandragens que vamos te ensinar daqui para frente‚Ä¶\nMuitos dados podem prejudicar sua visualiza√ß√£o!\rO m√©todo gr√°fico √© fant√°stico quando temos poucos dados, mas conforme o tamanho da nossa base aumenta o tempo de plotagem e a visibilidade geral do gr√°fico √© prejudicada.\nA base diamantes j√° nos d√° uma ideia de como a visualiza√ß√£o pode ficar ruim. Vamos analisar a vari√°vel profundidade para ter uma ideia:\nlibrary(ggpubr)\r#devtools::install_github(\u0026quot;https://github.com/cienciadedatos/dados\u0026quot;)\rlibrary(dados)\rggqqplot(diamante$profundidade)\rFica claro que a vari√°vel n√£o segue a distribui√ß√£o normal, mas a faixa cinza fica completamente esmagada, nem conseguimos ver quantos pontos est√£o dentro ou fora dela. O gr√°fico n√£o √© completamente in√∫til, pois √© poss√≠vel ver que existem in√∫meros pontos que dep√µem contra a normalidade da vari√°vel, mas √© um fato que o resultado n√£o √© t√£o elegante quanto o anterior.\nO que fazemos nesse cen√°rio ent√£o? √â aqui que entra outro jeito legal de verificar se uma vari√°vel tem distribui√ß√£o normal: um teste estat√≠stico.\nMas isso √© um assunto para o nosso pr√≥ximo post! Fique ligada ou ligado!\n\r\rGostou? Quer saber mais?\rSe voc√™ quiser aprender um pouco mais sobre esse assunto, temos alguns cursos que tocam os temas deste post. D√™ uma olhada nos nossos cursos de Regress√£o Linear ou Machine Learning e aproveite!\n\r","permalink":"https://blog.curso-r.com/posts/2021-01-28-testes-de-normalidade/","tags":["faxina","modelagem"],"title":"Testes de normalidade em R - Parte 1: Gr√°ficos"},{"author":["Athos"],"categories":["Tutoriais"],"contents":"\r\rResumo\r\rtabulizer::extract_tables(\"caminho/do/arquivo.pdf\", pages = 153)\n\rIsso √© tudo!! Eu resolvi escrever esse post porque fiquei contente por ter tido grande facilidade em conseguir trazer uma tabela do PDF para o R depois do CTLR+C/CTRL+V falhar miseravelmente.\nUm potencial obst√°culo pode ser o famigerado {rJava} do qual o {tabulizer} depende. Mas, no linux, eu rodei sudo apt install default-jdk default-jre e funcionou pra mim! No windows n√£o testei, mas tem esse tutorial aqui.\n\rTarefa\rExtrair uma tabela de uma p√°gina de um arquivo pdf. No url_pdf est√° o endere√ßo de um PDF da internet.\nurl_pdf \u0026lt;- \u0026quot;https://curso-r.github.io/main-regressao-linear/referencias/Ci%C3%AAncia%20de%20Dados.%20Fundamentos%20e%20Aplica%C3%A7%C3%B5es.%20Vers%C3%A3o%20parcial%20preliminar.%20maio%20Pedro%20A.%20Morettin%20Julio%20M.%20Singer.pdf\u0026quot;\r\rOlhada na p√°gina de PDF\r# tira print da pagina 153 e salva como imagem PNG.\rpdftools::pdf_convert(url_pdf, pages = 153, filenames = \u0026quot;pag153.png\u0026quot;)\r## Converting page 153 to pag153.png... done!\r## [1] \u0026quot;pag153.png\u0026quot;\r# mostra a imagem PNG.\rknitr::include_graphics(\u0026quot;/images/posts/conteudo/tabulizer/pag153.webp\u0026quot;)\r\rExtra√ß√£o da tabela PDF -\u0026gt; R\r# extrai a tabela do PDF (e n√£o do PNG!)\rtabela_extrida_do_pdf \u0026lt;- tabulizer::extract_tables(url_pdf, pages = 153)\rtabela_extrida_do_pdf[[1]]\r## [,1] [,2] [,3] [,4] [,5] [,6] ## [1,] \u0026quot;\u0026quot; \u0026quot;Idade\u0026quot; \u0026quot;Dist√¢ncia\u0026quot; \u0026quot;\u0026quot; \u0026quot;Idade\u0026quot; \u0026quot;Dist√¢ncia\u0026quot;\r## [2,] \u0026quot;Ident\u0026quot; \u0026quot;(anos)\u0026quot; \u0026quot;(m)\u0026quot; \u0026quot;Ident\u0026quot; \u0026quot;(anos)\u0026quot; \u0026quot;(m)\u0026quot; ## [3,] \u0026quot;1\u0026quot; \u0026quot;18\u0026quot; \u0026quot;170\u0026quot; \u0026quot;16\u0026quot; \u0026quot;55\u0026quot; \u0026quot;140\u0026quot; ## [4,] \u0026quot;2\u0026quot; \u0026quot;20\u0026quot; \u0026quot;197\u0026quot; \u0026quot;17\u0026quot; \u0026quot;63\u0026quot; \u0026quot;117\u0026quot; ## [5,] \u0026quot;3\u0026quot; \u0026quot;22\u0026quot; \u0026quot;187\u0026quot; \u0026quot;18\u0026quot; \u0026quot;65\u0026quot; \u0026quot;140\u0026quot; ## [6,] \u0026quot;4\u0026quot; \u0026quot;23\u0026quot; \u0026quot;170\u0026quot; \u0026quot;19\u0026quot; \u0026quot;66\u0026quot; \u0026quot;100\u0026quot; ## [7,] \u0026quot;5\u0026quot; \u0026quot;23\u0026quot; \u0026quot;153\u0026quot; \u0026quot;20\u0026quot; \u0026quot;67\u0026quot; \u0026quot;137\u0026quot; ## [8,] \u0026quot;6\u0026quot; \u0026quot;25\u0026quot; \u0026quot;163\u0026quot; \u0026quot;21\u0026quot; \u0026quot;68\u0026quot; \u0026quot;100\u0026quot; ## [9,] \u0026quot;7\u0026quot; \u0026quot;27\u0026quot; \u0026quot;187\u0026quot; \u0026quot;22\u0026quot; \u0026quot;70\u0026quot; \u0026quot;130\u0026quot; ## [10,] \u0026quot;8\u0026quot; \u0026quot;28\u0026quot; \u0026quot;170\u0026quot; \u0026quot;23\u0026quot; \u0026quot;71\u0026quot; \u0026quot;107\u0026quot; ## [11,] \u0026quot;9\u0026quot; \u0026quot;29\u0026quot; \u0026quot;153\u0026quot; \u0026quot;24\u0026quot; \u0026quot;72\u0026quot; \u0026quot;123\u0026quot; ## [12,] \u0026quot;10\u0026quot; \u0026quot;32\u0026quot; \u0026quot;137\u0026quot; \u0026quot;25\u0026quot; \u0026quot;73\u0026quot; \u0026quot;93\u0026quot; ## [13,] \u0026quot;11\u0026quot; \u0026quot;37\u0026quot; \u0026quot;140\u0026quot; \u0026quot;26\u0026quot; \u0026quot;74\u0026quot; \u0026quot;140\u0026quot; ## [14,] \u0026quot;12\u0026quot; \u0026quot;41\u0026quot; \u0026quot;153\u0026quot; \u0026quot;27\u0026quot; \u0026quot;75\u0026quot; \u0026quot;153\u0026quot; ## [15,] \u0026quot;13\u0026quot; \u0026quot;46\u0026quot; \u0026quot;150\u0026quot; \u0026quot;28\u0026quot; \u0026quot;77\u0026quot; \u0026quot;120\u0026quot; ## [16,] \u0026quot;14\u0026quot; \u0026quot;49\u0026quot; \u0026quot;127\u0026quot; \u0026quot;29\u0026quot; \u0026quot;79\u0026quot; \u0026quot;103\u0026quot; ## [17,] \u0026quot;15\u0026quot; \u0026quot;53\u0026quot; \u0026quot;153\u0026quot; \u0026quot;30\u0026quot; \u0026quot;82\u0026quot; \u0026quot;120\u0026quot;\rCQD! ‚¨õ\n\rB√¥nus: Faxina na tabela\rUma vez dentro do R, agora √© jogo. Bora faxinar que √© o que a gente sabe fazer de melhor. O desafio √© empilhar de 3 em 3 colunas, Ident, (anos), (m). Temos dois indiv√≠duos por linha, precisamos empilh√°-los para no fim termos uma linha para cada indiv√≠duo como manda o manual. O her√≥i aqui √© o pivot_longer().\nlibrary(tidyverse)\rlibrary(janitor)\rtabela_extrida_do_pdf[[1]] %\u0026gt;%\ras_tibble(.name_repair = \u0026quot;unique\u0026quot;) %\u0026gt;%\rrow_to_names(2) %\u0026gt;%\rclean_names() %\u0026gt;%\rpivot_longer(everything(), names_to = c(\u0026quot;.value\u0026quot;, \u0026quot;conjunto\u0026quot;), names_sep = \u0026quot;_\u0026quot;) %\u0026gt;%\rselect(-conjunto) %\u0026gt;%\rhead() %\u0026gt;%\rkableExtra::kable()\r\r\r\rident\r\ranos\r\rm\r\r\r\r\r\r1\r\r18\r\r170\r\r\r\r16\r\r55\r\r140\r\r\r\r2\r\r20\r\r197\r\r\r\r17\r\r63\r\r117\r\r\r\r3\r\r22\r\r187\r\r\r\r18\r\r65\r\r140\r\r\r\r\r\rLeituras relacionadas\rSugiro a leitura do post PDF e OCR do Julio Trecenti para funcionalidades mais avan√ßadas do {pdftools}, do {tesseract} e do {tabulizer}.\n\rComent√°rio aleat√≥rio\rAproveitem para conhecer o livro Ci√™ncia de dados: Fundamentos e Pr√°tica de 2020 dos Professores Julio Singer e Renato Morettin.\nValeu!\n\r","permalink":"https://blog.curso-r.com/posts/2021-01-08-tabulizer/","tags":["faxina","pdf","tabulizer","pdftools"],"title":"{tabulizer}: Tabela do PDF para data.frame em segundos"},{"author":["Caio"],"categories":["pacotes"],"contents":"\r\r{stockfish} √© um pacote R que implementa o protocolo aberto de comunica√ß√£o\rUCI e acompanha uma\rinstala√ß√£o do Stockfish 11,\rum motor de xadrez muito popular, open source e poderoso escrito em C++.\nInstala√ß√£o\rinstall.packages(\u0026quot;stockfish\u0026quot;)\rOu instale a vers√£o em desenvolvimento do\rGitHub com:\n# install.packages(\u0026quot;remotes\u0026quot;)\rremotes::install_github(\u0026quot;curso-r/stockfish\u0026quot;)\rVoc√™ tamb√©m pode encontrar mais (e mais recentes) vers√µes do motor Stockfish\rpara usar com o {stockfish} na\rp√°gina de download do projeto.\n\rExemplo\r√â t√£o f√°cil usar o {stockfish} quanto qualquer outro pacote UCI. Voc√™ deve\rinicializar o motor com fish$new() e enviar comandos com os seus m√©todos\rinternos, lembrando apenas de rodar quit() quando voc√™ terminar.\nlibrary(stockfish)\r# Inicializar o motor\rengine \u0026lt;- fish$new()\r# Examinar o processo em plano de fundo\rengine$process\r#\u0026gt; PROCESS \u0026#39;stockfish\u0026#39;, running, pid 173670.\r# Procurar a melhor jogada\rengine$go()\r#\u0026gt; [1] \u0026quot;bestmove e2e4 ponder d7d5\u0026quot;\r# Come√ßar um jogo a partir de um FEN\rengine$ucinewgame()\rengine$position(\u0026quot;6rk/2Q3p1/5qBp/5P2/8/7P/6PK/8 w - - 15 51\u0026quot;)\rengine$go()\r#\u0026gt; [1] \u0026quot;bestmove g6f7 ponder g8d8\u0026quot;\r# Finalizar o motor\rengine$quit()\r\rUso\rfish, a principal classe do pacote, representa um motor Stockfish, permitindo\rque o usu√°rio envie comandos e receba sa√≠das de acordo com o protocolo UCI.\rResumindo, um objeto fish, quando criado, cria um processo Stockfish\rdesacoplado e faz um pipe com as suas entrada e sa√≠da padr√µes.\nPara mais informa√ß√µes, veja a sua documenta√ß√£o completa executando ?fish.\nStockfish Incluso\rO pacote acompanha uma instala√ß√£o do\rStockfish, um motor de xadrez\rmuito popular, open source e poderoso escrito em C++. Ele consegue chegar em um\rELO de 3516, roda no Windows, macOS, Linux, iOS e Android, e pode ser compilado\rem menos de um minuto.\nQuando o {stockfish} (inicial min√∫scula) estiver sendo instalado, o\rc√≥digo-fonte do Stockfish (inicial mai√∫scula) √© compilado e o execut√°vel\rresultante √© armazenado junto com os seus pacote R. Isso n√£o √© uma instala√ß√£o\rpara todos os usu√°rios! Voc√™ n√£o precisa dar privil√©gios administrativos para\rele rodar ou se preocupar com qualquer software adicional.\nO √∫nico ponto negativo √© que a vers√£o inclusa √© o Stockfish 11, n√£o a vers√£o\rmais recente (Stockfish 12). Isso ocorre porque a vers√£o 12 precisa de downloads\radicionais, o que aumentaria dramaticamente o tempo de instala√ß√£o. Se quiser,\rvoc√™ pode baixar a vers√£o de sua escolha\re passar o caminho para o execut√°vel como argumento para fish$new().\n\rProtocolo UCI\rUCI (Universal Chess Interface) √© um protocolo aberto de comunica√ß√£o que\rpermite que motores de xadrez se comuniquem com interfaces de usu√°rio. Na\rverdade, a classe fish implementa o\rprotocolo UCI como publicado\rpor Stefan-Meyer Kahlen, apenas com um foco no Stockfish. Isso significa que\ralguns m√©todos n√£o s√£o implementados (veja Pegadinhas) e que todos os testes\rs√£o feitos com o Stockfish, mas todo o resto deveria funcionar perfeitamente com\routros motores.\nO texto entre aspas no fim da documenta√ß√£o de cada m√©todo foi extra√≠do\rdiretamente do protocolo UCI oficial para que voc√™ possa ver exatamente o que\raquele comando pode fazer. No geral, os comandos s√£o bem autoexplicativos,\rexceto pela LAN (long algebraic notation), a nota√ß√£o de jogadas usada pelo\rUCI. Nessa nota√ß√£o, jogadas s√£o registradas usando as posi√ß√µes inicial e final\rda pe√ßa, por exemplo, e2e4, e7e5, e1g1 (roque pequeno das brancas), e7e8q\r(promo√ß√£o), 0000 (jogada vazia).\n\rImplementa√ß√£o\rTodo o trabalho duro da classe fish √© feito pelo pacote {processx}. O\rprocesso do Stockfish √© criado com processx::process$new e a entrada/sa√≠da √©\rfeita com write_input() e read_output(). Um aspecto importante do protocolo\rde comunica√ß√£o de qualquer motor UCI √© esperar por respostas, e aqui isso √©\rfeito com um loop que verifica o processo com poll_io() e para assim que a\rsa√≠da volta vazia.\nAntes de implementar o protocolo UCI manualmente, o pacote usava o {bigchess}.\rEle √© um pacote incr√≠vel criado por\r@rosawojciech, mas ele tem algumas\rdepend√™ncias que est√£o al√©m do escopo do {stockfish} e, no final, eu queria\rmais controle da API (por exemplo usando {R6}).\n\rPegadinhas\rA classe fish tem algumas idiossincrasias que o usu√°rio deve ter em mente\rquando tentar se comunicar com o Stockfish. Algumas s√£o devidas a escolhas de\rimplementa√ß√£o, mas outras est√£o relacionadas ao protocolo UCI em si. Esta n√£o\r√© uma lista completa (e voc√™ provavelmente deveria ler a\rdocumenta√ß√£o do UCI), mas\raqui v√£o algumas coisas para ficar de olho.\n\rNem todos os m√©todos UCI foram implementados: como o {stockfish} foi feito\rcom o Stockfish (e especialmente o Stockfish 11) em mente, dois m√©todos do UCI\rque n√£o funcionam com o motor n√£o foram implementados. Eles s√£o debug() e\rregister().\n\rA maioria dos m√©todos retorna silenciosamente: como a maioria dos comandos UCI\rn√£o retornam nada ou retornam texto padr√£o, a maioria dos m√©todos retorna\rsilenciosamente. As exce√ß√µes s√£o run(), isready(), go() e stop(); voc√™\rpode ver exatamente o que eles retornam lendo as suas documenta√ß√µes.\n\rNem toda op√ß√£o do Stockfish vai funcionar: pelo menos quando usando a vers√£o\rinclusa do Stockfish, nem todas as op√ß√µes documentadas v√£o funcionar com\rsetoption(). Isso ocorre porque, como descrito acima, o pacote vem com o\rStockfish 11, que n√£o √© a vers√£o mais recente. Op√ß√µes que n√£o v√£o funcionar\rest√£o marcadas com um asterisco.\n\rTempos s√£o em milissegundos. diferentemente da maioria das fun√ß√µes do R, todo\rm√©todo que recebe um intervalo de tempo espera que o mesmo seja em milissegundos,\rn√£o segundos.\n\r\r\r\r","permalink":"https://blog.curso-r.com/posts/2020-12-18-stockfish/","tags":["xadrez"],"title":"Stockfish no R"},{"author":["Beatriz Milz","William"],"categories":["divulga√ß√£o"],"contents":"\r\rOl√°!\nEste post √© uma continua√ß√£o do post onde apresentamos os trabalhos premiados no curso R para Ci√™ncia de Dados I, e baseado nos feedbacks que enviamos para as pessoas alunas, escrevemos algumas dicas de formata√ß√£o de tabelas.\rNeste post, apresentaremos algumas dicas para elaborar gr√°ficos com o pacote ggplot2! Gr√°ficos s√£o representa√ß√µes visuais dos dados. Se bem constru√≠do, a informa√ß√£o nele √© absorvida mais rapidamente. Al√©m disso, funcionam como pausas, deixando a leitura de um relat√≥rio menos cansativa.\n\rFigura 1: Ilustra√ß√£o sobre o pacote ggplot2, criada por Allison Horst.\r\rDicas para formatar melhor seus gr√°ficos\rPrimeiro vamos carregar o pacote tidyverse:\nlibrary(tidyverse)\rO pr√≥ximo passo √© carregar a base que utilizaremos como exemplo: a base de filmes do IMDB.\nimdb \u0026lt;-\rread_delim(\r\u0026quot;https://raw.githubusercontent.com/curso-r/202010-r4ds-1/master/dados/imdb2.csv\u0026quot;,\r\u0026quot;;\u0026quot;,\rescape_double = FALSE,\rtrim_ws = TRUE\r) \rExemplo: Diretores de sucesso!\rPreparar a base de dados\rNeste exemplo, vamos criar um gr√°fico que apresente o lucro m√©dio dos filmes segundo o diretor, para identificar pessoas diretoras de sucesso! Primeiro precisaremos obter as informa√ß√µes necess√°rias para criar o gr√°fico.\nA base imdb apresenta 3713 linhas, sendo que cada linha possui informa√ß√£o de um filme. Dentre as vari√°veis presentes na base s√£o o or√ßamento e a receita dos filmes. Com essas vari√°veis, √© poss√≠vel calcular o lucro de cada filme. Por√©m, antes vamos remover os filmes das quais n√£o temos as informa√ß√µes de or√ßamento e/ou receita (ou seja, NA). Existem diversas formas de remover os valores faltantes - NA - de uma base, ent√£o utilizaremos a fun√ß√£o drop_na(), do pacote tidyr, indicando como argumento as colunas em que desejamos remover os NA. Depois, utilizando a fun√ß√£o mutate(), criaremos uma nova coluna que apresenta o valor do lucro de cada filme:\nimdb_lucro \u0026lt;- imdb %\u0026gt;%\rdrop_na(orcamento, receita) %\u0026gt;%\rmutate(lucro = receita - orcamento)\rPara obter a m√©dia do lucro por diretor, podemos utilizar as fun√ß√µes group_by() para agrupar por diretor, e summarise() para fazer as sumariza√ß√µes necess√°rias: neste caso calcularemos a m√©dia (com a fun√ß√£o mean()), e tamb√©m o n√∫mero de filmes por diretor (com a fun√ß√£o n() - que conta o n√∫mero de linhas, sendo que cada linha representa um filme).\nimdb_lucro_diretores \u0026lt;- imdb_lucro %\u0026gt;%\rgroup_by(diretor) %\u0026gt;%\rsummarise(media_lucro = mean(lucro),\rnumero_filmes = n())\rhead(imdb_lucro_diretores)\r## # A tibble: 6 x 3\r## diretor media_lucro numero_filmes\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt;\r## 1 Aaron Schneider 1676553 1\r## 2 Aaron Seltzer 28546578 1\r## 3 Abel Ferrara -11272676 1\r## 4 Adam Carolla -1394057 1\r## 5 Adam Goldberg -1647420 1\r## 6 Adam Marcus 13435068 1\rPor√©m n√£o podemos apresentar todas as 1419 pessoas diretoras no mesmo gr√°fico, pois n√£o seria leg√≠vel! Precisamos definir alguns crit√©rios para selecionar as pessoas diretoras que aparecer√£o no gr√°fico.\nO primeiro crit√©rio escolhido √© ter dirigido mais que um filme! Com a fun√ß√£o filter(condicao), esse crit√©rio √© poss√≠vel de ser satisfeito. Depois, ordenaremos a base de forma decrescente segundo o lucro m√©dio, assim teremos nas primeiras linhas as pessoas diretoras com os maiores lucros m√©dios. Isso √© poss√≠vel de ser feito com as fun√ß√µes arrange(desc(variavel)). Com a fun√ß√£o slice(), podemos ‚Äòcortar‚Äô a base: utilizando como argumento 1:10, estamos solicitando apenas as linhas 1 at√© 10.\nNeste caso, o resultado destes crit√©rios ser√° uma base com as 10 pessoas diretoras com maior lucro m√©dio e que tenham dirigido mais de um filme.\nimdb_top_diretores \u0026lt;- imdb_lucro_diretores %\u0026gt;% filter(numero_filmes \u0026gt; 1) %\u0026gt;% arrange(desc(media_lucro)) %\u0026gt;% slice(1:10)\rimdb_top_diretores\r## # A tibble: 10 x 3\r## diretor media_lucro numero_filmes\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt;\r## 1 George Lucas 277328296 5\r## 2 Colin Trevorrow 252717532. 2\r## 3 Pierre Coffin 237275640 2\r## 4 Joss Whedon 199202360. 3\r## 5 James Cameron 194620985 6\r## 6 Roger Allers 188543668. 2\r## 7 Pete Docter 158113780. 3\r## 8 Francis Lawrence 151100394. 5\r## 9 Peter Jackson 132967515 5\r## 10 Andrew Adamson 130611730 4\r\rCriar o gr√°fico\rAgora podemos come√ßar a criar o gr√°fico (e apresentar algumas dicas!).\nO c√≥digo abaixo apresenta um gr√°fico de barras (geom_col()) simples, criado com o pacote ggplot2, e vamos melhor√°-lo por etapas!\nimdb_top_diretores %\u0026gt;% ggplot() + geom_col(aes(x = diretor, y = media_lucro))\rA primeira dica √©: quando os nomes no eixo x estiverem se sobrepondo (no caso deste gr√°fico, o nome dos diretores), podemos inverter os eixos. Uma forma de fazer isso √© utilizando a fun√ß√£o coord_flip():\nimdb_top_diretores %\u0026gt;% ggplot() + geom_col(aes(x = diretor, y = media_lucro)) +\rcoord_flip()\rAgora est√° muito mais f√°cil de ler os nomes dos diretores!\nQuando trabalhamos com vari√°veis que representam dinheiro (como no caso da vari√°vel lucro), podemos formatar os valores para que fiquem formatados como dinheiro, utilizando a fun√ß√£o scales::dollar() :\nimdb_top_diretores %\u0026gt;% ggplot() + geom_col(aes(x = diretor, y = media_lucro)) +\rscale_y_continuous(labels = scales::dollar) +\rcoord_flip()\rAgora que os eixos est√£o bem formatados, podemos formatar a legenda para ficar claro o que cada eixo significa! A fun√ß√£o labs() permite escrever o que desejamos que apare√ßa como legenda em cada elemento (por exemplo: labs(x = \"Legenda do eixo X\", y = \"Legenda do eixo Y\") .\nimdb_top_diretores %\u0026gt;% ggplot() + geom_col(aes(x = diretor, y = media_lucro)) +\rscale_y_continuous(labels = scales::dollar) +\rlabs(x = \u0026quot;Pessoas diretoras\u0026quot;, y = \u0026quot;Lucro m√©dio\u0026quot;) +\rcoord_flip()\r√â interessante tamb√©m ordenar as barras do gr√°fico de barras, pois facilita a compara√ß√£o das categorias (neste caso, as pessoas diretoras).\nPara isso, podemos tratar a vari√°vel diretor como um fator (factor) 1, e ordenar os n√≠veis (levels) de diretores segundo a vari√°vel media_lucro. A fun√ß√£o fct_reorder() do pacote forcats pode ser utilizada para isso, pois ela ordena os n√≠veis de um fator utilizando a ordem de outra vari√°vel.\nimdb_top_diretores %\u0026gt;%\rmutate(diretor = forcats::fct_reorder(diretor, media_lucro)) %\u0026gt;%\rggplot() +\rgeom_col(aes(x = diretor, y = media_lucro)) +\rscale_y_continuous(labels = scales::dollar) +\rcoord_flip() +\rlabs(x = \u0026quot;Pessoas diretoras\u0026quot;, y = \u0026quot;Lucro m√©dio\u0026quot;)\rPor √∫ltimo (mas tamb√©m importante) √© uma dica est√©tica, por√©m tem o poder de deixar o gr√°fico muito mais atrativo! Existem v√°rias fun√ß√µes no pacote ggplot2 com temas para os gr√°ficos, e elas usam o prefixo theme_ (por exemplo, theme_light()). Al√©m disso, existem pacotes que oferecem mais temas, como o ggthemr e o ggthemes!\nO exemplo abaixo utiliza o tema theme_light():\nimdb_top_diretores %\u0026gt;%\rmutate(diretor = forcats::fct_reorder(diretor, media_lucro)) %\u0026gt;%\rggplot() +\rgeom_col(aes(x = diretor, y = media_lucro)) +\rscale_y_continuous(labels = scales::dollar) +\rlabs(x = \u0026quot;Pessoas diretoras\u0026quot;, y = \u0026quot;Lucro m√©dio\u0026quot;) +\rcoord_flip() +\rtheme_bw()\rO exemplo abaixo utiliza o tema flat do pacote ggthemr:\nimdb_top_diretores %\u0026gt;%\rmutate(diretor = forcats::fct_reorder(diretor, media_lucro)) %\u0026gt;%\rggplot() +\rgeom_col(aes(x = diretor, y = media_lucro)) +\rscale_y_continuous(labels = scales::dollar) +\rcoord_flip() +\rlabs(x = \u0026quot;Pessoas diretoras\u0026quot;, y = \u0026quot;Lucro m√©dio\u0026quot;) +\rggthemr::ggthemr(\u0026quot;flat\u0026quot;)$theme\r\r\r\rConclus√µes\rDepois dessas dicas, o resultado √© um gr√°fico mais atraente e informativo do que a vers√£o b√°sica que fizemos com o ggplot2 no come√ßo do post!\nExistem infinitas possibilidades para criar visualiza√ß√µes de dados com R. Neste post apresentamos algumas dicas simples para formatar melhor nossos gr√°ficos, e no pr√≥ximo post apresentaremos mais algumas dicas sobre relat√≥rios com o pacote R Markdown.\nE caso voc√™ tenha interesse em saber mais sobre os cursos, a p√°gina de cursos foi atualizada, e as incri√ß√µes para os cursos de 2021 j√° est√£o abertas!\n\r\rFalamos um pouco sobre fatores no post anterior.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2020-17-02-dicas-relatorios-r4ds1_graficos/","tags":["gr√°ficos"],"title":"Feedback dos trabalhos do R para Ci√™ncia de Dados (Parte II): Dicas para Gr√°ficos"},{"author":["Beatriz Milz","William Amorim"],"categories":["divulga√ß√£o"],"contents":"\r\rNa √∫ltima edi√ß√£o do curso de R para Ci√™ncia de dados I, realizada em outubro de 2020, apresentamos para as pessoas alunas como trabalho final a tarefa de realizar uma an√°lise estat√≠stica (descritiva) e comunicar os resultados utilizando um relat√≥rio produzido em R Markdown. Como sugest√£o, as pessoas poderiam utilizar a base de filmes do IMDB para realizar a an√°lise, por√©m eram livres para escolher outros temas de interesse tamb√©m.\nAssim como nas √∫ltimas edi√ß√µes do curso, para motivar as pessoas alunas, resolvemos premiar os melhores trabalhos com vagas em qualquer um dos nossos cursos. Neste post apresentamos o objetivo deste tipo de avalia√ß√£o, al√©m dos trabalhos premiados da turma de maio de 2020.\nEste post ser√° um pouco diferente deste: primeiro apresentaremos os trabalhos premiados, e ent√£o baseado nos feedbacks que escrevemos sobre os trabalhos, apresentaremos algumas dicas para visualiza√ß√µes de dados e relat√≥rios com RMarkdown. O conte√∫do foi dividido para que o post n√£o ficasse muito extenso, ent√£o neste post as dicas ser√£o sobre formata√ß√£o de tabelas!\nTrabalhos premiados\r\rLu√≠sa B√∂ck: O trabalho da Luisa √© uma an√°lise sobre a s√©rie The Office, e tanto a an√°lise dos dados, a parte est√©tica e o texto ficaram muito legais! Para quem gosta da s√©rie, √© uma oportunidade para aprender mais sobre ela! Confira o trabalho neste link.\n\rAndr√© Oliveira: O trabalho do Andr√© √© uma an√°lise utilizando a base de filmes do IMDB. O trabalho tamb√©m ficou muito legal: a an√°lise dos dados, a contextualiza√ß√£o e a parte est√©tica foram bem trabalhadas! Confira o trabalho neste link.\n\r\rParab√©ns, Lu√≠sa e Andr√©!\n\r5 Dicas para formatar melhor suas tabelas\rAgora seguimos para as dicas!\nPrimeiro vamos carregar o pacote tidyverse:\nlibrary(tidyverse)\rO pr√≥ximo passo √© carregar a base que utilizaremos como exemplo: a base de filmes do IMDB.\nimdb \u0026lt;-\rread_delim(\r\u0026quot;https://raw.githubusercontent.com/curso-r/202010-r4ds-1/master/dados/imdb2.csv\u0026quot;,\r\u0026quot;;\u0026quot;,\rescape_double = FALSE,\rtrim_ws = TRUE\r)\rExemplo 1: Ordenar, formatar dinheiro e nomear as colunas\rNo exemplo a seguir, primeiramente vamos selecionar as vari√°veis que representam o nome e o or√ßamento dos filmes (com a fun√ß√£o select()). √â interessante ordenar a tabela segundo alguma vari√°vel, para facilitar a leitura. No exemplo a seguir, vamos ordenar pelo or√ßamento de forma decrescente utilizando a fun√ß√£o arrange(desc(variavel)).\nVamos selecionar apenas as primeiras linhas da base, para facilitar a apresenta√ß√£o neste post (utilizando a fun√ß√£o head()), e salvar em um objeto chamado filmes_orcamento (que usaremos nos c√≥digos a seguir).\nfilmes_orcamento \u0026lt;- imdb %\u0026gt;%\rselect(titulo, orcamento) %\u0026gt;%\rarrange(desc(orcamento)) %\u0026gt;% head()\rfilmes_orcamento\r## # A tibble: 6 x 2\r## titulo orcamento\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Pirates of the Caribbean: At World\u0026#39;s End¬†300000000\r## 2 John Carter¬†263700000\r## 3 Tangled¬†260000000\r## 4 Spider-Man 3¬†258000000\r## 5 The Dark Knight Rises¬†250000000\r## 6 Avengers: Age of Ultron¬†250000000\rPara vari√°veis que representam dinheiro, √© poss√≠vel usar a fun√ß√£o scales::dollar() para que os valores fiquem formatados como dinheiro (e fiquem mais leg√≠veis!).\nfilmes_orcamento %\u0026gt;% mutate(orcamento = scales::dollar(orcamento)) \r## # A tibble: 6 x 2\r## titulo orcamento ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 Pirates of the Caribbean: At World\u0026#39;s End¬†$300,000,000\r## 2 John Carter¬†$263,700,000\r## 3 Tangled¬†$260,000,000\r## 4 Spider-Man 3¬†$258,000,000\r## 5 The Dark Knight Rises¬†$250,000,000\r## 6 Avengers: Age of Ultron¬†$250,000,000\rA tabela anteiror foi apresentada igual a um c√≥digo que aparece como retorno no console do R, e isso n√£o fica legal em um relat√≥rio. Existem diversas formas de apresentar tabelas, mas neste exemplo utilizaremos a fun√ß√£o knitr::kable() 1. Al√©m disso, √© comum que o nome das vari√°veis estejam escritas com letras min√∫sculas, sem acentua√ß√£o, etc (por exemplo: orcamento). Para que a tabela fique melhor formatada, podemos renomear o nome das colunas usando o argumento col.names da fun√ß√£o knitr::kable(), informando um vetor com os novos nomes para as colunas da tabela.\nimdb %\u0026gt;%\rselect(titulo, orcamento) %\u0026gt;%\rarrange(desc(orcamento)) %\u0026gt;% mutate(orcamento = scales::dollar(orcamento)) %\u0026gt;%\rhead() %\u0026gt;%\rknitr::kable(col.names = c(\u0026quot;T√≠tulo do filme\u0026quot;, \u0026quot;Or√ßamento\u0026quot;))\r\r\rT√≠tulo do filme\rOr√ßamento\r\r\r\rPirates of the Caribbean: At World‚Äôs End\r$300,000,000\r\rJohn Carter\r$263,700,000\r\rTangled\r$260,000,000\r\rSpider-Man 3\r$258,000,000\r\rThe Dark Knight Rises\r$250,000,000\r\rAvengers: Age of Ultron\r$250,000,000\r\r\r\rA tabela ficou mais f√°cil de ser lida. O que achou do resultado?\n\rExemplo 2: Arredondar valores e ordenar categorias\rNo exemplo a seguir, vamos calcular a nota m√©dia dos filmes na base do IMDB para cada classifica√ß√£o et√°ria. Fazemos isso utilizando as fun√ß√µes group_by() e summarise().\nSalvaremos o resultado em um objeto chamado nota_classificacao (que usaremos nos c√≥digos a seguir).\nnota_classificacao \u0026lt;- imdb %\u0026gt;%\rgroup_by(classificacao) %\u0026gt;%\rsummarise(nota_media_imdb = mean(nota_imdb, na.rm = TRUE)) nota_classificacao\r## # A tibble: 4 x 2\r## classificacao nota_media_imdb\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 A partir de 13 anos 61.8\r## 2 A partir de 18 anos 64.6\r## 3 Livre 62.6\r## 4 Outros 66.3\rO primeiro ponto interessante para arrumar s√£o os valores da vari√°vel nota_media_imdb, arredondando os valores para que n√£o apare√ßa as casas decimais. Para melhorar a apresenta√ß√£o, podemos usar a fun√ß√£o round() (utilizada para arredondar n√∫meros) junto com a fun√ß√£o mutate() (que altera ou cria novas vari√°veis). Com o argumento digits da fun√ß√£o round(), √© poss√≠vel definir quantas casas decimais voc√™ quer que o n√∫mero tenha.\nnota_classificacao %\u0026gt;%\rmutate(nota_media_imdb = round(nota_media_imdb, digits = 0))\r## # A tibble: 4 x 2\r## classificacao nota_media_imdb\r## \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 A partir de 13 anos 62\r## 2 A partir de 18 anos 65\r## 3 Livre 63\r## 4 Outros 66\rNa base que estamos usando de exemplo, a vari√°vel classificacao √© uma vari√°vel categ√≥rica do tipo chr (character), ou seja, um texto. Por padr√£o, a ordem utilizada √© a alfab√©tica (repare no resultado anterior, primeiro aparecem as classifica√ß√µes que come√ßam com A, depois com L e por √∫ltimo a que come√ßa com O).\nPara ordenar essa vari√°vel, precisamos transformar ela em um fator. Portanto, usaremos o pacote forcats, que faz parte do tidyverse e possui fun√ß√µes para trabalhar com fatores 2.\nUsando a fun√ß√£o mutate() com fct_relevel() (do pacote forcats), podemos alterar a ordem dos n√≠veis desta vari√°vel, passando como argumento:\n\ra vari√°vel que queremos transformar em fator e alterar os seus n√≠veis (os levels),\n\rum vetor com os n√≠veis (levels), na ordem que desejamos.\n\r\rPosteriormente podemos ordenar a vari√°vel utilizando a fun√ß√£o arrange(), e teremos como resultado a tabela ordenada de uma forma que faz mais sentido:\nnota_classificacao %\u0026gt;%\rmutate(nota_media_imdb = round(nota_media_imdb, digits = 0)) %\u0026gt;%\rmutate(classificacao = forcats::fct_relevel(\rclassificacao,\rc(\u0026quot;Livre\u0026quot;,\r\u0026quot;A partir de 13 anos\u0026quot;,\r\u0026quot;A partir de 18 anos\u0026quot;,\r\u0026quot;Outros\u0026quot;)\r)) %\u0026gt;%\rarrange(classificacao) %\u0026gt;%\rknitr::kable(col.names = c(\u0026quot;Classifica√ß√£o et√°ria\u0026quot;,\r\u0026quot;Nota m√©dia no IMDB\u0026quot;))\r\r\rClassifica√ß√£o et√°ria\rNota m√©dia no IMDB\r\r\r\rLivre\r63\r\rA partir de 13 anos\r62\r\rA partir de 18 anos\r65\r\rOutros\r66\r\r\r\r\r\rConclus√£o\rNeste post conhecemos os trabalhos premiados no curso de R para Ci√™ncia de dados I oferecido em outubro/2020, assim como algumas dicas que surgiram a partir do feedback dos trabalhos.\nNos pr√≥ximos posts apresentaremos mais algumas dicas sobre gr√°ficos com o pacote ggplot2 e relat√≥rios com o pacote R Markdown.\nE caso voc√™ tenha interesse em saber mais sobre os cursos, a p√°gina de cursos foi atualizada, e as incri√ß√µes para os cursos de 2021 j√° est√£o abertas!\n\r\rOutros pacotes que permitem criar tabelas s√£o: DT, reactable, flextable e kableExtra. Essa p√°gina tamb√©m apresenta materiais muito ricos sobre elabora√ß√£o de tabelas!‚Ü©Ô∏é\n\rCaso queira saber mais sobre fatores e o pacote forcats, recomendo consutar este material da Curso-R.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2020-12-03-dicas-relatorios-r4ds1_tabelas/","tags":["relat√≥rios"],"title":"Trabalhos premiados do curso R para Ci√™ncia de Dados I + Dicas !"},{"author":["Caio"],"categories":["tutoriais"],"contents":"\r\r{chess} √© uma interface opinionada em R para o\rpython-chess, uma biblioteca incr√≠vel\rcriada por Niklas Fiekas. Ela permite que usu√°rios\rleiam e escrevam arquivos PGN,\ral√©m de possibilitar a cria√ß√£o e explora√ß√£o de √°rvores de jogos como aquelas\rpresentes em livros de xadrez.\nEste pacote ainda est√° amadurecendo! Ent√£o eu encorajo todos a enviar suas\rsugest√µes e bugs em issues no\rreposit√≥rio do pacote.\nInstala√ß√£o\rVoc√™ pode instalar a vers√£o mais recente do {chess} do CRAN com:\ninstall.packages(\u0026quot;chess\u0026quot;)\rIsso deveria automaticamente instalar o python-chess no seu ambiente do\r{reticulate}, mas voc√™ tamb√©m pode fazer isso explicitamente com o comando:\nchess::install_chess()\r\rExemplo\rPara ler um jogo existente, basta usar read_game(). Para explorar ele, voc√™\rpode usar forward()/back(), assim como variations()/variation() para ver\rtodas as varia√ß√µes dispon√≠veis para o pr√≥ximo movimento e escolher uma delas.\nlibrary(chess)\r# Ler o primeiro jogo de My 60 Memorable Games\rfile \u0026lt;- system.file(\u0026quot;m60mg.pgn\u0026quot;, package = \u0026quot;chess\u0026quot;)\rfischer_sherwin \u0026lt;- read_game(file, n_max = 1)\r# Posi√ß√£o inicial\rfischer_sherwin\r#\u0026gt; \u0026lt;Start\u0026gt;\r#\u0026gt; r n b q k b n r\r#\u0026gt; p p p p p p p p\r#\u0026gt; . . . . . . . .\r#\u0026gt; . . . . . . . .\r#\u0026gt; . . . . . . . .\r#\u0026gt; . . . . . . . .\r#\u0026gt; P P P P P P P P\r#\u0026gt; R N B Q K B N R\r# Navegar para 4. g3\rfischer_sherwin %\u0026gt;%\rforward(7)\r#\u0026gt; \u0026lt;4. g3\u0026gt;\r#\u0026gt; r . b q k b n r\r#\u0026gt; p p . p . p p p\r#\u0026gt; . . n . p . . .\r#\u0026gt; . . p . . . . .\r#\u0026gt; . . . . P . . .\r#\u0026gt; . . . P . N P .\r#\u0026gt; P P P . . P . P\r#\u0026gt; R N B Q K B . R\r# Ver todas as varia√ß√µes de 4...\rfischer_sherwin %\u0026gt;%\rforward(7) %\u0026gt;%\rvariations()\r#\u0026gt; \u0026lt;4... Nf6\u0026gt; \u0026lt;4... d5\u0026gt;\r#\u0026gt; r . b q k b . r r . b q k b n r\r#\u0026gt; p p . p . p p p p p . . . p p p\r#\u0026gt; . . n . p n . . . . n . p . . .\r#\u0026gt; . . p . . . . . . . p p . . . .\r#\u0026gt; . . . . P . . . . . . . P . . .\r#\u0026gt; . . . P . N P . . . . P . N P .\r#\u0026gt; P P P . . P . P P P P . . P . P\r#\u0026gt; R N B Q K B . R R N B Q K B . R\r# Seguir a linha auxiliar\rfischer_sherwin %\u0026gt;%\rforward(7) %\u0026gt;%\rvariation(2)\r#\u0026gt; \u0026lt;4... d5\u0026gt;\r#\u0026gt; r . b q k b n r\r#\u0026gt; p p . . . p p p\r#\u0026gt; . . n . p . . .\r#\u0026gt; . . p p . . . .\r#\u0026gt; . . . . P . . .\r#\u0026gt; . . . P . N P .\r#\u0026gt; P P P . . P . P\r#\u0026gt; R N B Q K B . R\rVoc√™ tamb√©m pode criar o seu pr√≥prio jogo com game() e adicionar varia√ß√µes ao\rmesmo: a fun√ß√£o move() adiciona jogadas assim como ramos na √°rvore do jogo.\rStrings s√£o convertidas para jogadas simples, enquanto list() funciona\rexatamente como os par√™nteses de um PGN, criando uma varia√ß√£o para a √∫ltima\rjogada. Aqui podemos ver como recriar o\rMate do Pastor e algumas\rformas de evit√°-lo:\n# Mate do Pastor e algumas defesas\rscholars_mate \u0026lt;- game() %\u0026gt;%\rmove(\u0026quot;e4\u0026quot;) %\u0026gt;%\rmove(\u0026quot;e5\u0026quot;, list(\u0026quot;e6\u0026quot;), list(\u0026quot;d5\u0026quot;)) %\u0026gt;%\rmove(\u0026quot;Bc4\u0026quot;) %\u0026gt;%\rmove(\u0026quot;Nc6\u0026quot;, list(\u0026quot;Nf6\u0026quot;)) %\u0026gt;%\rmove(\u0026quot;Qh5\u0026quot;) %\u0026gt;%\rmove(\u0026quot;Nf6\u0026quot;, list(\u0026quot;g6\u0026quot;, \u0026quot;Qf3\u0026quot;, \u0026quot;Nf6\u0026quot;)) %\u0026gt;%\rmove(\u0026quot;Qxf7\u0026quot;)\r# √öltima jogada da linha principal\rscholars_mate\r#\u0026gt; \u0026lt;4. Qxf7#\u0026gt;\r#\u0026gt; r . b q k b . r\r#\u0026gt; p p p p . Q p p\r#\u0026gt; . . n . . n . .\r#\u0026gt; . . . . p . . .\r#\u0026gt; . . B . P . . .\r#\u0026gt; . . . . . . . .\r#\u0026gt; P P P P . P P P\r#\u0026gt; R N B . K . N R\rNote que h√° muitas formas de estruturar a entrada de move(). Veja\rvignette(\"chess\") para mais informa√ß√µes.\n{chess} tamb√©m traz muitas formas de ver tanto o jogo como um todo, quanto o\rtabuleiro em um momento espec√≠fico.\n# Tabuleiro com unicode (n√£o fica bonito no navegador)\rprint(scholars_mate, unicode = TRUE)\r#\u0026gt; \u0026lt;4. Qxf7#\u0026gt;\r#\u0026gt; ‚ôú . ‚ôù ‚ôõ ‚ôö ‚ôù . ‚ôú\r#\u0026gt; ‚ôü ‚ôü ‚ôü ‚ôü . ‚ôï ‚ôü ‚ôü\r#\u0026gt; . . ‚ôû . . ‚ôû . .\r#\u0026gt; . . . . ‚ôü . . .\r#\u0026gt; . . ‚ôó . ‚ôô . . .\r#\u0026gt; . . . . . . . .\r#\u0026gt; ‚ôô ‚ôô ‚ôô ‚ôô . ‚ôô ‚ôô ‚ôô\r#\u0026gt; ‚ôñ ‚ôò ‚ôó . ‚ôî . ‚ôò ‚ôñ\r# Exportar o FEN do tabuleiro\rfen(scholars_mate)\r#\u0026gt; [1] \u0026quot;r1bqkb1r/pppp1Qpp/2n2n2/4p3/2B1P3/8/PPPP1PPP/RNB1K1NR b KQkq - 0 4\u0026quot;\r# Ver o PGN depois de um movimento\rstr(back(scholars_mate, 3))\r#\u0026gt; 2... Nc6 3. Qh5 Nf6 ( 3... g6 4. Qf3 Nf6 ) 4. Qxf7#\r# Exportar o PGN depois de um movimento\rpgn(back(scholars_mate, 3))\r#\u0026gt; [1] \u0026quot;2... Nc6 3. Qh5 Nf6 ( 3... g6 4. Qf3 Nf6 ) 4. Qxf7#\u0026quot;\r# Imagem do tabuleiro atual\rplot(scholars_mate)\r\rMotiva√ß√£o\rO python-chess serviu como inspira√ß√£o (e base) para o {chess}. Enquanto a\rvers√£o original (e o {rchess}, por sinal)\rtrabalha genericamente com ‚Äúgera√ß√£o de jogadas, valida√ß√£o de jogadas‚Äù (com classes\rpoderosas e sintaxe orientada a objeto), o {chess} √© focado em facilitar a\rcria√ß√£o e explora√ß√£o de √°rvores PGN.\nAo limitar o escopo da API, eu acredito que o pacote fica mais intuitivo para\rpessoas que s√≥ querem um jeito r√°pido de criar an√°lises de jogos compartilh√°veis\rou facilmente explorar os jogos dos outros sem precisar depender de um software\rvisual.\nO primeiro uso do {chess} foi me ajudando a estudar o My 60 Memorable Games\rdo Bobby Fischer. Depois de um parsing\rmuito dif√≠cil, eu consegui converter o livro todo para PGN e disponibiliz√°-lo no\rlichess, mas eu ainda achava que a interface\rn√£o era boa o suficiente‚Ä¶\n\r","permalink":"https://blog.curso-r.com/posts/2020-11-25-chess/","tags":["xadrez"],"title":"Xadrez no R com {chess}"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rHoje acordei curioso para saber qual era a capital mais distante de Bras√≠lia. Essa n√£o √© uma quest√£o t√£o trivial quanto parece, pois, como a Terra √© esf√©rica (apesar de todas as controv√©rsias), podemos chegar em um ponto por mais de um caminho. Por isso, resolvi calcular todas as dist√¢ncias e montar um mapinha!\nEncontrando as coordenadas geogr√°ficas\rO primeiro passo para essa aventura foi encontrar as coordenadas geogr√°ficas das capitais de todo o mundo. Encontrei nesse post uma forma de fazer isso em R. O post estava desatualizado, ent√£o resolvi reescrev√™-lo da maneira tidy.\nCome√ßamos usando o maravilhoso pacote {httr} para obter o HTML da p√°gina que cont√©m os dados. Precisei modificar o User-Agent pois, sem ele, a requisi√ß√£o retornava com c√≥digo 406.\n## Download a partir do site\rr_capitals \u0026lt;- httr::GET(\r\u0026quot;https://lab.lmnixon.org/4th/worldcapitals.html\u0026quot;,\rhttr::user_agent(\u0026quot;Mozilla/5.0 (X11; Linux x86_64)\u0026quot;)\r)\rEm seguida, usamos nosso queridinho {xml2} para encontrar a tabela, e o n√£o t√£o queridinho {rvest} para transformar essa tabela (temos uma discuss√£o sobre isso aqui). Os pacotes {tibble} e {janitor} foram usados para deixar a tabela formatada.\n## Parse do resultado do site\rda_countries_raw \u0026lt;- r_capitals %\u0026gt;% xml2::read_html() %\u0026gt;% xml2::xml_find_first(\u0026quot;//table\u0026quot;) %\u0026gt;% rvest::html_table(header = TRUE) %\u0026gt;% tibble::as_tibble() %\u0026gt;% janitor::clean_names()\r\rArrumando os dados\rComo bom faxineiro de dados, eu n√£o poderia deixar se mostrar a parte mais divertida da ci√™ncia de dados: organizar os dados brutos! Primeiro, as coordenadas de latitude e longitude estavam em texto e, ao inv√©s de mostrar valores positivos e negativos, mostrava os valores N (norte), S (sul), E (leste), W (oeste). Al√©m disso, a latitude e longitude de Jerusal√©m (Israel) estava incorreta.\nlibrary(tidyverse)\rda_countries_tidy \u0026lt;- da_countries_raw %\u0026gt;% filter(country != \u0026quot;\u0026quot;) %\u0026gt;% # transforma (N,S) (E,W) em (1,-1), (1,-1)\rmutate(\rlat_num = str_detect(latitude, \u0026quot;N\u0026quot;) * 2 - 1,\rlng_num = str_detect(longitude, \u0026quot;E\u0026quot;) * 2 - 1\r) %\u0026gt;% # transforma em num√©rico\rmutate(\racross(c(latitude, longitude), parse_number),\rlat = latitude * lat_num,\rlng = longitude * lng_num\r) %\u0026gt;% # arruma Israel\rmutate(\rlat = if_else(country == \u0026quot;Israel\u0026quot;, 31.7683, lat),\rlng = if_else(country == \u0026quot;Israel\u0026quot;, 35.2137, lng)\r) %\u0026gt;% select(country, capital, lat, lng)\r\rTransformando os dados\rCom os dados arrumados em m√£os, calculei as dist√¢ncias atrav√©s da dist√¢ncia geod√©sica1, usando latitude e longitude como base e o maravilhoso pacote {sf}. S√£o duas fun√ß√µes principais: a sf::st_point() cria um objeto especial do tipo ponto, e a sf::st_distance() calcula a dist√¢ncia entre dois pontos. Utilizamos map2() e map() do pacote {purrr} para fazer aplicar essas opera√ß√µes em todos os pa√≠ses. No final, temos a base ordenada pelas dist√¢ncias. As dist√¢ncias s√£o calculadas em metros, que transformamos para quil√¥metros.\nda_countries \u0026lt;- da_countries_tidy %\u0026gt;% # cria pontos com base em lat lng e sf::st_point()\r# sf::st_sfc() transforma a lista num objeto POINT do {sf}\r# crs = 4326 serve para o {sf} saber que\r# s√£o coordenadas no planeta Terra.\rmutate(pt = sf::st_sfc(\rmap2(lng, lat, ~sf::st_point(c(.x, .y, 1))),\rcrs = 4326\r)) %\u0026gt;%\rmutate(\racross(c(lat, lng), list(br = ~.x[country == \u0026quot;Brazil\u0026quot;])),\rpt_br = sf::st_sfc(\rlist(sf::st_point(c(lng_br[1], lat_br[1], 1))), crs = 4326\r)\r) %\u0026gt;% mutate(\rdist_br = sf::st_distance(pt, pt_br, by_element = TRUE),\rdist_br = as.numeric(dist_br / 1000)\r) %\u0026gt;% # ordena a base pelas dist√¢ncias\rarrange(dist_br)\r\rVisualizando\rAs capitais mais pr√≥ximas est√£o na Tabela 1. Sem muitas surpresas aqui: como Bras√≠lia fica na regi√£o central do pa√≠s, a capital mais pr√≥xima √© a do Paraguai, seguida por outros pa√≠ses da Am√©rica do Sul.\n\rTabela 1: Capitais mais pr√≥ximas de Bras√≠lia.\r\r\r\rPa√≠s\r\rCapital\r\rDist√¢ncia (km)\r\r\r\r\r\rParaguay\r\rAsuncion\r\r1473\r\r\r\rBolivia\r\rLa Paz (administrative) / Sucre (legislative)\r\r2202\r\r\r\rUruguay\r\rMontevideo\r\r2276\r\r\r\rFrench Guiana\r\rCayenne\r\r2326\r\r\r\rSuriname\r\rParamaribo\r\r2464\r\r\r\rArgentina\r\rBuenos Aires\r\r2618\r\r\r\rGuyana\r\rGeorgetown\r\r2695\r\r\r\rChile\r\rSantiago\r\r3028\r\r\r\rPeru\r\rLima\r\r3206\r\r\r\rBarbados\r\rBridgetown\r\r3409\r\r\r\r\rAs coisas ficam mais interessantes quando visualizamos as capitais mais distantes, na Tabela 2. E temos nosso resultado: Koror (Palau) √© a capital mais distante da capital, Bras√≠lia, seguida por Manila (Filipinas) e Saipan (Ilhas Mariana do Norte).\n\rTabela 2: Capitais mais distantes de Bras√≠lia.\r\r\r\rPa√≠s\r\rCapital\r\rDist√¢ncia (km)\r\r\r\r\r\rPalau\r\rKoror\r\r19069\r\r\r\rPhilippines\r\rManila\r\r18801\r\r\r\rNorthern Mariana Islands\r\rSaipan\r\r18639\r\r\r\rMacao, China\r\rMacau\r\r17887\r\r\r\rBrunei Darussalam\r\rBandar Seri Begawan\r\r17765\r\r\r\rRepublic of Korea\r\rSeoul\r\r17517\r\r\r\rNorth Korea\r\rPyongyang\r\r17296\r\r\r\rEast Timor\r\rDili\r\r17264\r\r\r\rViet Nam\r\rHanoi\r\r17126\r\r\r\rMicronesia (Federated States of)\r\rPalikir\r\r17066\r\r\r\r\rMas ser√° mesmo? Vamos usar o pacote {leaflet} para visualizar:\nlibrary(leaflet)\r# Cria as labels dos popups\rmake_label \u0026lt;- function(pais, capital) {\rtxt \u0026lt;- stringr::str_glue(\r\u0026quot;\u0026lt;b\u0026gt;Pa√≠s\u0026lt;/b\u0026gt;: {pais}\u0026lt;br\u0026gt;\u0026quot;,\r\u0026quot;\u0026lt;b\u0026gt;Capital\u0026lt;/b\u0026gt;: {capital}\u0026quot;\r)\rhtmltools::HTML(txt)\r}\rp_leaflet \u0026lt;- da_countries %\u0026gt;% mutate(lab = map2(country, capital, make_label)) %\u0026gt;% # cria mapa\rleaflet() %\u0026gt;% # adiciona a casquinha\raddTiles() %\u0026gt;% # adiciona os pontos\raddMarkers(\rclusterOptions = markerClusterOptions(), lat = ~lat, lng = ~lng, popup = ~lab\r)\rp_leaflet\rAcesse o mapa din√¢mico neste link.\nOlhando o mapa (e considerando que a terra √© esf√©rica), parece mesmo que esses pa√≠ses est√£o bem longe, mesmo tentando acessar pelo leste ou pelo oeste.\nE, j√° que a terra √© esf√©rica, que tal criar um mapa 3D? Fiz isso usando o {plotly}, com base no tutorial dispon√≠vel neste link.\nlibrary(plotly)\rp_plotly \u0026lt;- plot_ly(height = 1000) %\u0026gt;%\r# adiciona o mapa mundi\radd_sf(\rdata = world, x = ~coord_x(x, y),\ry = ~coord_y(x, y),\rz = ~coord_z(y),\rcolor = I(\u0026quot;gray80\u0026quot;), size = I(2),\rhoverinfo = \u0026quot;none\u0026quot;\r) %\u0026gt;% # adiciona as linhas\radd_sf(\rdata = da_lines_sf,\rname = \u0026quot;linhas\u0026quot;,\rx = ~coord_x(x, y),\ry = ~coord_y(x, y),\rz = ~coord_z(y),\rcolor = ~dist_br,\rsize = I(3),\rtext = ~label_plotly(country, capital, dist_br),\rhoverinfo = \u0026quot;text\u0026quot;\r) %\u0026gt;% layout(showlegend = FALSE)\rp_plotly\rAcesse o mapa din√¢mico neste link.\n\rWrap-up\rNesse post vimos como usar ferramentas do {tidyverse}, {sf} para transforma√ß√£o de dados para mapas, al√©m de utilizar o {leaflet} e o {plotly} para visualiza√ß√µes interativas.\nO c√≥digo completo para construir as visualiza√ß√µes do zero est√° neste link.\n√â isso pessoal. Happy coding ;)\n\r\rKarney, Charles FF, 2013, Algorithms for geodesics, Journal of Geodesy 87(1), 43‚Äì55.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2020-09-19-map-dist/","tags":["visualizacao","mapas","leaflet","plotly"],"title":"Qual a capital mais distante de Bras√≠lia?"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rEssa semana o Julio fez uma pergunta aparentemente inocente no nosso f√≥rum. Achei a resposta fosse ser simples, mas depois de 1 hora percebi que tinha virado quase um detetive da computa√ß√£o‚Ä¶\nAbaixo copiei a pergunta do Julio e a minha resposta, ligeiramente editadas por quest√µes did√°ticas.\nA Pergunta\rQuero aplicar essa funcao_chata() em uma coluna do meu data frame. Mas quero aplicar isso somente a uma parte do vetor. E n√£o queria os warnings.\nUsando as fun√ß√µes do {dplyr}, tenho warnings, mas usando um simples ifelse() n√£o tenho warnings. Nesse caso tudo bem, uso ifelse(), mas se eu tiver um caso com v√°rias condi√ß√µes (que √© quando uso o case_when()), qual seria o melhor jeito de fazer?\nlibrary(tidyverse)\rfuncao_chata \u0026lt;- function(x) {\rif (any(x \u0026gt; 10)) warning(\u0026quot;n√£o gosto de vc\u0026quot;)\r1 / x\r}\r# usando if_else(), com warnings\rresultado \u0026lt;- mtcars %\u0026gt;% mutate(res = if_else(\rmpg \u0026lt; 10, funcao_chata(mpg),\rmpg\r))\r#\u0026gt; Warning: Problem with `mutate()` input `res`.\r#\u0026gt; ‚Ñπ n√£o gosto de vc\r#\u0026gt; ‚Ñπ Input `res` is `if_else(mpg \u0026lt; 10, funcao_chata(mpg), mpg)`.\r#\u0026gt; Warning in funcao_chata(mpg): n√£o gosto de vc\r# usando case_when(), com warnings\rresultado \u0026lt;- mtcars %\u0026gt;% mutate(res = case_when(\rmpg \u0026lt; 10 ~ funcao_chata(mpg),\rTRUE ~ mpg\r))\r#\u0026gt; Warning: Problem with `mutate()` input `res`.\r#\u0026gt; ‚Ñπ n√£o gosto de vc\r#\u0026gt; ‚Ñπ Input `res` is `case_when(mpg \u0026lt; 10 ~ funcao_chata(mpg), TRUE ~ mpg^2)`.\r#\u0026gt; Warning: n√£o gosto de vc\r# usando ifelse(), sem warnings\rresultado \u0026lt;- mtcars %\u0026gt;% mutate(res = ifelse(\rmpg \u0026lt; 10, funcao_chata(mpg),\rmpg\r))\rThanks.\n\rA Resposta\rA sua pergunta √© muito pertinente e j√° foi feita outras vezes, mas, para ficar bem claro, esse comportamento √© proposital. Veja o que o Hadley fala na vignette sobre estabilidade do {vectrs}:\n\rUnlike ifelse() this implies that if_else() must always evaluate both yes and no in order to figure out the correct type. I think this is consistent with \u0026amp;\u0026amp; (scalar operation, short circuits) and \u0026amp; (vectorised, evaluates both sides).\n\rComo fica claro pelas pr√≥prias palavras do Hadley, esse tipo de comportamento tem precedentes no R, mas para entender exatamente o que ele quer dizer vamos ter que aprender sobre alguns conceitos de linguagens de programa√ß√£o. Infelizmente vou aproveitar a sua pergunta para fazer o meu diploma valer alguma coisa‚Ä¶\nExecu√ß√£o especulativa\rExecu√ß√£o especulativa uma t√©cnica de otimiza√ß√£o na qual um programa executa uma tarefa que talvez n√£o seja necess√°ria. Isso pode ser √∫til por uma s√©rie de raz√µes apesar de parecer um desperd√≠cio! Se o seu computador consegue processar comandos em paralelo, ele pode executar a condi√ß√£o do if, o resultado caso ela seja TRUE e o resultado caso ela seja FALSE ao mesmo tempo, permitindo uma resposta at√© 2x mais r√°pida.\nEssa t√©cnica √© t√£o comum que aqueles famosos bugs de 2018 (Spectre e Meltdown) acontecem principalmente por causa dela.\nVoltando para o if_else(), a sua implementa√ß√£o de execu√ß√£o especulativa √© diferentemente da de outras linguagens que tentam ‚Äúadivinhar‚Äù se o if vai retornar TRUE ou FALSE: ele usa avalia√ß√£o ansiosa, ou seja, ele sempre executa os dois ramos do condicional independentemente do resultado do if. A motiva√ß√£o disso √© bem diferente de ‚Äúotimizar‚Äù a computa√ß√£o (como vimos no exemplo anterior), mas sim garantir que ambos os lados da resposta v√£o ter o mesmo comprimento e o mesmo tipo.\nVeja o c√≥digo do if_else() e perceba que nele n√£o existe nenhum if ou else, ou seja, ambos os ramos do condicional necessariamente v√£o ser executados:\nif_else \u0026lt;- function(condition, true, false, missing = NULL) {\rif (!is.logical(condition)) {\rbad_args(\u0026quot;condition\u0026quot;, \u0026quot;must be a logical vector.\u0026quot;)\r}\rout \u0026lt;- true[rep(NA_integer_, length(condition))]\rout \u0026lt;- replace_with(\rout, condition, true,\rfmt_args(~ true),\rglue(\u0026quot;length of {fmt_args(~condition)}\u0026quot;)\r)\rout \u0026lt;- replace_with(\rout, !condition, false,\rfmt_args(~ false),\rglue(\u0026quot;length of {fmt_args(~condition)}\u0026quot;)\r)\rout \u0026lt;- replace_with(\rout, is.na(condition), missing,\rfmt_args(~ missing),\rglue(\u0026quot;length of {fmt_args(~condition)}\u0026quot;)\r)\rout\r}\r\rAvalia√ß√£o de curto-circuito\rO conceito de avalia√ß√£o de curto-circuito √© mais simples e foi citado diretamente pelo Hadley. Ele basicamente quer dizer que, em uma opera√ß√£o booleana, o segundo argumento somente ser√° executado se o valor do primeiro n√£o for suficiente para determinar o valor da express√£o (por exemplo, se temos A \u0026amp;\u0026amp; B e A for FALSE, n√£o precisamos saber o valor de B para saber que a resposta da express√£o √© FALSE).\nArmados desse conhecimento, podemos entender finalmente a frase do Hadley: \" I think this is consistent with \u0026amp;\u0026amp; (scalar operation, short circuits) and \u0026amp; (vectorised, evaluates both sides)\". A implementa√ß√£o do if_else() foi feita para ser consistente com o operador \u0026amp;, ou seja, vetorizada e com avalia√ß√£o especulativa (ansiosa), enquanto um if-else comum √© consistente com o \u0026amp;\u0026amp;, a saber, escalar e com avalia√ß√£o de curto-circuito.\nAgora vamos ver alguns exemplos para tentar entender como cada um desses operadores se comporta:\n# Fun√ß√£o que retorna TRUE\rf \u0026lt;- function() {\rwarning(\u0026quot;ANSIOSO\u0026quot;)\rTRUE\r}\r# Pregui√ßoso (s√≥ escalares)\rif (TRUE) TRUE else f()\r#\u0026gt; [1] TRUE\r# Ansioso (funciona para vetores)\rdplyr::if_else(TRUE, TRUE, f())\r#\u0026gt; Warning in f(): ANSIOSO\r#\u0026gt; [1] TRUE\r# Com curto-circuito (s√≥ escalares)\rFALSE \u0026amp;\u0026amp; f()\r#\u0026gt; [1] FALSE\r# Sem curto-circuito (fuciona para vetores)\rFALSE \u0026amp; f()\r#\u0026gt; Warning in f(): ANSIOSO\r#\u0026gt; [1] FALSE\rAcho que com esses c√≥digos fica claro que, na verdade, o ifelse() √© a exce√ß√£o e n√£o a regra! Note que aqui eu usei sempre entradas escalares (comprimento 1) por quest√£o did√°tica, mas est√£o marcados os operadores que podem receber vetores.\n# Pregui√ßoso (funciona para vetores)\rifelse(TRUE, TRUE, f())\r#\u0026gt; [1] TRUE\rConclui-se que, no que diz respeito √† sua pergunta, n√£o existe um jeito √≥bvio de fazer o if_else() e o case_when() trabalharem com execu√ß√£o pregui√ßosa sem mudar fundamentalmente o comportamento (e a l√≥gica por tr√°s) dessas fun√ß√µes. Se voc√™ quiser uma alternativa, aparentemente o data.table::fcase() funciona como um case_when() sem avalia√ß√£o ansiosa.\n\r\r","permalink":"https://blog.curso-r.com/posts/2020-09-11-if_else_ifelse/","tags":["programa√ß√£o"],"title":"Warnings no if_else(), mas n√£o no ifelse()?"},{"author":["Julio","Athos"],"categories":["Tutoriais"],"contents":"\r\r","permalink":"https://blog.curso-r.com/posts/2020-08-27-applause/","tags":["manipula√ß√£o","tidyr"],"title":"Aplauda-me"},{"author":["Nicole Luduvice"],"categories":["Tutoriais"],"contents":"\r\rO tidyr √© um pacote muito √∫til para arrumar os dados, ou seja, deix√°-los tidy. Dizemos que os dados est√£o arrumados quando\n\rcada coluna √© uma vari√°vel;\rcada linha √© uma observa√ß√£o;\rcada c√©lula representa um √∫nico valor.\r\rO lan√ßamento da vers√£o 1.0.0 (em 09/11/19) apresentou uma grande mudan√ßa do pacote: a substitui√ß√£o das fun√ß√µes gather() e spread() pelas novas fun√ß√µes pivot_longer() e pivot_wider().\nNeste post, vamos apresentar o que mudou nessas novas fun√ß√µes e mostrar como aplicar as opera√ß√µes de pivotagem nesse novo framework.\nOs dados\rPara ilustrar a utiliza√ß√£o das fun√ß√µes, vamos criar uma tabelinha bem simples, que nos permita visualizar a mudan√ßa entre os formatos long e wide.\nSuponhamos que os dados a seguir representem as vendas de duas lojas nos meses de janeiro a junho de um determinado ano. √â muito comum recebermos uma tabela no formado wide.\ndados \u0026lt;- tibble::tribble(\r~loja, ~jan, ~fev, ~mar, ~abr, ~mai, ~jun,\r1, 20, 30, 23, 10, 40, 55,\r2, 30, 43, 29, 15, 40, 60\r)\rdados\r## # A tibble: 2 x 7\r## loja jan fev mar abr mai jun\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 20 30 23 10 40 55\r## 2 2 30 43 29 15 40 60\rRepare que, embora nessa tabela existam 3 vari√°veis, apenas 2 est√£o expl√≠citas: a loja e o m√™s. As vendas est√£o apenas no corpo da tabela e, sem contexo, n√£o saber√≠amos o que esses valores significam.\nAl√©m disso, essa tabela n√£o est√° no formato tidy, pois cada coluna n√£o represta uma vari√°vel: a vari√°vel m√™s est√° espalhada nas colunas e a vari√°vel vendas n√£o √© uma coluna.\nA seguir, vamos ver como utilizar as antigas fun√ß√µes gather() e spread() para deixar essa tabela tidy (ou para, uma vez tidy, voltar ao formato original).\n\rAs antigas fun√ß√µes gather() e spread()\rPara deixar os dados arrumados com as tr√™s vari√°veis (m√™s vendas e loja) como colunas, usamos a fun√ß√£o gather(). Essa fun√ß√£o vai transformar as colunas de janeiro a junho em valores de uma √∫nica coluna e vai criar uma nova coluna com os dados de vendas.\nlibrary(tidyr)\rdados_gather \u0026lt;- dados %\u0026gt;% gather(jan:jun, key = \u0026quot;mes\u0026quot;, value = \u0026quot;vendas\u0026quot;)\rdados_gather\r## # A tibble: 12 x 3\r## loja mes vendas\r## \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 jan 20\r## 2 2 jan 30\r## 3 1 fev 30\r## 4 2 fev 43\r## 5 1 mar 23\r## 6 2 mar 29\r## 7 1 abr 10\r## 8 2 abr 15\r## 9 1 mai 40\r## 10 2 mai 40\r## 11 1 jun 55\r## 12 2 jun 60\rAqui estamos selecionando as colunas de janeiro a junho e aplicando gather(). O argumento key recebe o nome da vari√°vel com os nomes das colunas (no nosso exemplo, meses) e value recebe o nome da vari√°vel com as observa√ß√µes das colunas, vendas.\nOk, conseguimos deixar nossos dados no formato tidy. Ser√° que √© possivel retorn√°-los ao formato original?\rPara isso, precisamos de uma fun√ß√£o que fa√ßa o inverso de gather(), ‚Äúespalhando‚Äù as observa√ß√µes da vari√°vel m√™s em v√°rias colunas e transformando vendas em observa√ß√µes dessas colunas. No pacote {tidyr} essa fun√ß√£o se chama spread().\ndados_spread \u0026lt;- dados_gather %\u0026gt;%\rspread(key = mes, value = vendas)\rdados_spread\r## # A tibble: 2 x 7\r## loja abr fev jan jun mai mar\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 10 30 20 55 40 23\r## 2 2 15 43 30 60 40 29\rObserve que o argumento key indica o nome da vari√°vel que ser√° espalhada em v√°rias colunas e o argumento value indica o nome da vari√°vel que vai ser transformada em observa√ß√µes.\nNo {tidyr} 1.0.0, essas fun√ß√µes foram aprimoradas, recebendo nomes e argumentos mais intuitivos e f√°ceis de lembrar, al√©m de apresentarem mais possibilidade de uso a fim de auxiliar na tarefa de estruturar os dados.\n\rAs novas fun√ß√µes pivot_longer() e pivot_wider()\rO pivot_longer(), em casos mais simples, equivale a fun√ß√£o gather(). Esse nome foi dado pois, ao rodar a fun√ß√£o, o banco de dados se torna mais longo (longer) em rela√ß√£o aos dados originais.\ndados_longer \u0026lt;- dados %\u0026gt;%\rpivot_longer(\rcols = jan:jun, names_to = \u0026quot;mes\u0026quot;, values_to = \u0026quot;vendas\u0026quot;\r) dados_longer\r## # A tibble: 12 x 3\r## loja mes vendas\r## \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 jan 20\r## 2 1 fev 30\r## 3 1 mar 23\r## 4 1 abr 10\r## 5 1 mai 40\r## 6 1 jun 55\r## 7 2 jan 30\r## 8 2 fev 43\r## 9 2 mar 29\r## 10 2 abr 15\r## 11 2 mai 40\r## 12 2 jun 60\rA fun√ß√£o spread() foi substituida por pivot_wider(). Ela vai transformar os dados em um formato mais largo. Veja que as duas fun√ß√µes funcionam de forma equivalente.\ndados_wider \u0026lt;- dados_longer %\u0026gt;%\rpivot_wider(names_from = mes, values_from = vendas)\rdados_wider\r## # A tibble: 2 x 7\r## loja jan fev mar abr mai jun\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 20 30 23 10 40 55\r## 2 2 30 43 29 15 40 60\rEssas novas fun√ß√µes de pivotagem trazem v√°rias outras funcionalidades para remodelar as bases de dados. Vamos falar delas em novos posts. Em quanto isso, se voc√™ quiser conferir, basta acessar o vignette do tidyr (ingl√™s).\n\r","permalink":"https://blog.curso-r.com/posts/2020-08-13-pivotagem/","tags":["manipula√ß√£o","tidyr"],"title":"As novas fun√ß√µes de pivotagem"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"A terminologia master/slave (mestre/escravo) existe h√° muitas d√©cadas na computa√ß√£o e parece ter migrado para a ind√∫stria da tecnologia j√° no in√≠cio do s√©culo XX. Esses conceitos normalmente est√£o associados a um modelo de comunica√ß√£o assim√©trico no qual um processo ou aparelho (o \u0026ldquo;mestre\u0026rdquo;) controla outros processos ou aparelhos (os \u0026ldquo;escravos\u0026rdquo;). N√£o √© necess√°rio dizer que os termos v√™m sendo contestados h√° anos devido √† evidente conota√ß√£o racista, mas o debate ganhou nova vida ap√≥s os protestos do Black Lives Matter em 2020.\nV√°rias linguagens de programa√ß√£o j√° abandonaram essa terminologia. Em 2018, no caso em que possivelmente houve maior repercuss√£o at√© hoje, o Python abandonou a palavra master por parent process (processo pai) e a palavra slave por worker (trabalhador) ou helper (ajudante) ap√≥s um debate acalorado.\nEnquanto isso, j√° em 2014, o Django passou a adotar a terminologia primary/replica (prim√°rio/r√©plica) e foi seguido pelo Drupal. Em 2017, o Internet Systems Consortium optou por primary/secondary (prim√°rio/secund√°rio). Como se pode ver, n√£o faltam alternativas para uma refer√™ncia √† escravid√£o.\nEnfim, este ano foi a vez do GitHub. Desde sua cria√ß√£o, a plataforma de controle de vers√£o tem utilizado o termo master para tratar do branch principal de um reposit√≥rio e, apesar de nem existir uma analogia para algo como um slave branch, a palavra continua at√© hoje. Antes tarde do que nunca, a empresa anunciou que vai fazer uma transi√ß√£o em breve para o termo main (principal) e aposentar seu antecessor.\nJustamente por pretender ser uma comunidade inclusiva e aberta, alguns programadores de R j√° come√ßaram a transferir seus reposit√≥rios do GitHub para o novo modelo. Em seu blog, Steven Mortimer forneceu o passo-a-passo para fazermos o mesmo. Os comandos s√£o bastante simples e est√£o listados abaixo:\n# Passo 1 # Crie o branch \u0026#39;main\u0026#39; localmente trazendo o hist√≥rico do \u0026#39;master\u0026#39; git branch -m master main  # Passo 2 # Fa√ßa o push do novo branch para o GitHub git push -u origin main  # Passo 3 # Substitua o HEAD do \u0026#39;master\u0026#39; para o \u0026#39;main\u0026#39; git symbolic-ref refs/remotes/origin/HEAD refs/remotes/origin/main  # Passo 4 # Troque o branch padr√£o no GitHub para o \u0026#39;main\u0026#39; # https://docs.github.com/pt/github/administering-a-repository/setting-the-default-branch  # Passo 5 # Delete o \u0026#39;master\u0026#39; git push origin --delete master Note apenas que o Passo 4 deve ser realizado diretamente no GitHub de acordo com a documenta√ß√£o (dispon√≠vel em portugu√™s).\nCaso voc√™ queira que o processo seja completamente automatizado, existe um aplicativo web que faz tudo para voc√™. Para saber mais sobre os esfor√ßos do pr√≥prio GitHub, acesse a p√°gina na qual est√£o sendo discutidas as mudan√ßas.\n","permalink":"https://blog.curso-r.com/posts/2020-07-27-github-main-branch/","tags":["github","git"],"title":"Abandonando o Termo 'master' no GitHub"},{"author":["Jos√© de Jesus Filho"],"categories":["tutoriais"],"contents":"\r\rIntrodu√ß√£o\rEste tutorial ir√° mostrar como instalar o R e o PostgreSQL num mesmo servidor Ubuntu 18.04 ou 16.04. Em seguida, falaremos sobre como chamar o R a partir do Postgres.\nFarei uma s√©rie de tutoriais. Este primeiro √© voltado para aqueles com familiaridade com fun√ß√µes do R e que gostariam de rod√°-las no PostgreSQL, sem necessariamente conhecer muito SQL.\nNum pr√≥ximo, iremos mostrar como criar queries e declara√ß√µes do PostgreSQL do R, ou seja, ser√° mais voltado para quem tem familiaridade com o SQL, mas n√£o necessariamente versada em R.\nOs tutoriais posteriores ser√£o voltados para aqueles com bastante familiaridade em tidyverse e que gostariam de realizar as mesmas coisas em SQL. Igualmente, servir√£o para aqueles que sabem manipular dados em SQL, mas gostariam de fazer as mesmas coisas no R.\nEm futuros tutoriais, falaremos quando compensa iniciar no PostgreSQL e terminar no R. Por exemplo, quando √© mais vantajoso dar um join no R em vez de faz√™-lo no PostgreSQL e vice-versa.\n\rInstalando o PostgreSQL\rA primeira coisa a fazer √© atualizar os pacotes do sistema:\nsudo apt update\rsudo apt -y install vim bash-completion wget\rsudo apt -y upgrade\r\rFeito isso, d√™ um reboot:\nsudo reboot\rImporte a chave GPG:\nwget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -\r\rAdicione a chave GPG ao systema:\necho \u0026quot;deb http://apt.postgresql.org/pub/repos/apt/ `lsb_release -cs`-pgdg main\u0026quot; |sudo tee /etc/apt/sources.list.d/pgdg.list\r\rAtualize os pacotes do sistema e instale os pacotes do PostgreSQL necess√°rios. Os dois primeiros s√£o necess√°rios para rodar o PostgreSQL, os tr√™s √∫ltimos s√£o necess√°rios para instalar o plr, o RPostgres e outras extens√µes. Falaremos deles mais adiante.\nsudo apt update\rsudo apt install postgresql-12 postgresql-client-12 postgresql-server-dev-all libpq-dev postgresql-contrib\r\r\rInstala√ß√£o do R\rsudo echo \u0026quot;deb https://cloud.r-project.org/bin/linux/ubuntu `lsb_release -cs`-cran40/\u0026quot; | sudo tee -a /etc/apt/sources.list\rAdicionar a chave GPG\rsudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9\r\rInstale o R\rsudo apt-get update\rsudo apt-get install -y r-base r-base-dev \rInstale tamb√©m o git\nsudo apt install git\rAgora use o git para clonar o plr. N√£o importa o local onde voc√™ ir√° clon√°-lo. Desde que voc√™ tenha seguido fielmente os passos anteriores, tudo terminar√° bem.\ngit clone https://github.com/postgres-plr/plr\r\rFeito isso, entre no diret√≥rio plr e rode os seguintes comandos para instal√°-lo como extens√£o.\ncd plr\rUSE_PGXS=1 make\rUSE_PGXS=1 make install\r\r\rCriando uma base de dados\rVamos para o Postgres a fim de criar uma base de dados.\nsudo -u postgres psql\rCREATE DATABASE datasets;\rAl√©m disso, voc√™ deve incluir a extens√£o plr na base de dados recentemente criada:\n\\c datasets -- conectar-se √† base\rCREATE EXTENSION plr;\r\\q -- sair do psql\rDe volta ao R.\nR\rInstale os pacotes RPostgres e broom\rInstalando esses dois pacotes √© suficiente para instalar tamb√©m outras depend√™ncias como o DBI e o dplyr, as quais igualmente usaremos.\ninstall.packages(c(\u0026quot;RPostgres\u0026quot;,\u0026quot;broom\u0026quot;))\r\r\rConnex√£o do R ao Postgres\rEventualmente, voc√™ ter√° de autorizar a conex√£o local. V√° para o arquivo:\nvim /etc/postgresql/12/main/pg_hba.conf\rE altere a seguinte linha de:\nlocal all all peer\rPara:\nlocal all all trust\rColocando uma tabela na base de dados\rAdmitindo que voc√™ ainda se encontra no R, estamos em condi√ß√µes de incluir uma tabela na base de dados.\nPrimeiramente, vamos conectar-nos √† base:\nconn \u0026lt;- DBI::dbConnect(RPostgres::Postgres(), dbname=\u0026quot;datasets\u0026quot;)\rEstou admidindo com o c√≥digo acima que voc√™ est√° usando o R na mesma m√°quina do Postgres, usando o usu√°rio postgres e dispensou o uso de senha para conex√£o local.\nVamos enviar o dataframe mtcars para a base de dados. O exemplo do mtcars n√£o √© muito feliz porque ele poderia ser chamado do pr√≥prio R quando rodado no Postgres, mas apenas a t√≠tulo de exemplo, iremos assumir que ele seja qualquer outro data.frame.\nDBI::dbWriteTable(conn,\u0026quot;tabela\u0026quot;, mtcars)\r\r\rDe volta ao Postgres\rMostraremos num pr√≥ximo tutorial como realizar os procedimentos a seguir sem sair do R, mas o prop√≥sito deste tutorial √© justamente ilustrar como podemos chamar o R do Postgres. Assim, faremos tudo no Postgres mesmo.\nVoltando para o shell, vamos conectar-nos √† base datasets:\nsudo -u postgres psql datasets\rVerifique se a tabela chamada ‚Äútabela‚Äù se encontra na base de dados:\n\\d+ -- ou \\d+ tabela\r\rPreparando o terreno\rVamos criar uma tabela que servir√° de refer√™ncia para receber os resultados de uma regress√£o linear. Veja que as colunas s√£o as mesmas do tibble retornado pela fun√ß√£o tidy do pacote broom, com a diferen√ßa de que os pontos foram substitu√≠dos pelo sublinhado e os nomes das colunas passados para o portugu√™s.\ncreate table modelo (termo text, estimativa float8, erro_padrao float8, estatistica float8, p_valor float8);\rCriando uma fun√ß√£o plr\rEnfim estamos em condi√ß√µes de criar uma fun√ß√£o no PostgreSQL que chama o R para rodar uma regress√£o linear em uma tabela contida no pr√≥prio Postgres:\nCREATE OR REPLACE FUNCTION lm_teste() RETURNS SETOF modelo AS\r$$ base \u0026lt;\u0026lt;- pg.spi.exec(\u0026#39;select mpg, wt, qsec, am from tabela\u0026#39;)\rdf \u0026lt;- lm(mpg ~ wt + qsec + factor(am), data=base)\rdf \u0026lt;- broom::tidy(df)\rnames(df) \u0026lt;- c(\u0026#39;termo\u0026#39;,\u0026#39;estimativa\u0026#39;,\u0026#39;erro_padrao\u0026#39;,\u0026#39;estatistica\u0026#39;,\u0026#39;p_valor\u0026#39;)\rdf \u0026lt;- dplyr::mutate_at(df,dplyr::vars(2:5), ~round(.,2))\rreturn(df)\r$$\rlanguage \u0026#39;plr\u0026#39;;\rNote que o esqueleto da fun√ß√£o √© o mesmo para qualquer outra fun√ß√£o do PostgreSQL. A diferen√ßa √© que, para importar um objeto da base de dados para nossa fun√ß√£o, devemos usar a fun√ß√£o pg.spi.exec.\n\r\rRodando a regress√£o linear\rAgora ficou f√°cil. Basta chamar a fun√ß√£o e ver os resultados:\nselect * from lm_teste();\rdatasets=# select * from lm_teste();\rtermo | estimativa | erro_padrao | estatistica | p_valor\r-------------+------------+-------------+-------------+---------\r(Intercept) | 9.62 | 6.96 | 1.38 | 0.18\rwt | -3.92 | 0.71 | -5.51 | 0\rqsec | 1.23 | 0.29 | 4.25 | 0\rfactor(am)1 | 2.94 | 1.41 | 2.08 | 0.05\r(4 rows)\r\rVantagens\rEu apontaria duas principais vantagens em usar o plr:\n1 - Uma vez que a base se encontra no PostgreSQL, voc√™ n√£o precisa mais transferi-la para o R a fim de rodar o modelo e retornar o resultado ao PostgreSQL. Essa viagem dos dados torna-se dispens√°vel. No exemplo mostrado, por√©m, a base ir√° para uma sess√£o do R de qualquer forma. Veremos como solucionar isso em tutoriais futuros.\n2 - Voc√™ pode continuar trabalhando no R, enquanto seu modelo roda no PostgreSQL. Se o modelo tomar horas, este se torna um problema menor.\n\r","permalink":"https://blog.curso-r.com/posts/2020-06-25-integracao-r-postgresql/","tags":["sql","postgresql"],"title":"Chamando o R do PostgreSQL"},{"author":["William"],"categories":["Tutoriais"],"contents":"\r\rO shinyapps.io √© um servi√ßo do RStudio que nos possibilita hospedar aplicativos em Shiny e compartilh√°-los online com qualquer pessoa no mundo. A conta gratuita permite at√© 5 aplicativos simult√¢neos e 25 horas mensais de uso. Al√©m disso, utilizando o shinyapps.io e o RStudio, a tarefa de subir um app para a internet pode ser feita em poucos minutos, com apenas alguns cliques.\nNo v√≠deo abaixo, eu mostro como conectar o RStudio com a sua conta do shinyapps.io e, com as contas conectadas, como √© f√°cil hospedar um aplicativo no servi√ßo.\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2020-06-18-shinyappsio/","tags":["shiny","rstudio","deploy"],"title":"Conectando o RStudio com o shinyapps.io"},{"author":["William"],"categories":["Divulga√ß√£o"],"contents":"\r\rAo fim do no nosso curso de R para Ci√™ncia de dados I, apresentamos aos alunos (que antes do curso tinham pouca ou nenhuma experi√™ncia com R) a tarefa de realizar uma an√°lise estat√≠stica (descritiva) e comunicar os resultados utilizando um relat√≥rio produzido em R Markdown ou um dashboard feito com o pacote flexdashboard.\nA an√°lise tinha o seguinte contexto: dois produtores que n√£o sabem nada de cinema querem investir seus milh√µes em um filme, mas n√£o sabem qual tipo de filme ou quais atrizes, atores e diretoras(res) teriam mais chance de gerar um potencial sucesso de cr√≠tica e bilheteria. Para responder essa pergunta, eles contrataram cientistas de dados para analisar uma base de filmes do IMDB e responder essa pergunta. O Athos e eu (William) fizemos o papel dos produtores, no sentido de que n√£o demos nenhuma dire√ß√£o sobre a an√°lise a ser realizada (apenas ajudamos com a programa√ß√£o em R, √© claro) e os alunos fizeram o papel dos cientistas de dados.\nPara motivar, resolvemos premiar os melhores trabalhos com vagas em qualquer um dos nossos cursos.\nO nosso objetivo, de in√≠cio, era trazer aos alunos um pouco da experi√™ncia do dia-a-dia do cientista de dados: usar an√°lise cr√≠tica (nesse caso, conhecimento sobre cinema) e uma ferramenta (no nosso caso, o R) para transformar uma base de dados em uma reposta para uma pergunta dif√≠cil1.\nAo final, recebemos trabalhos t√£o maravilhosos que, al√©m de parabenizar cada um dos participantes, decidimos compartilhar os 4 ganhadores com a comunidade. Esse √© o objetivo desse post.\nAbaixo, apresentamos as an√°lises, os autores e os principais pontos pelos quais decidimos destacar esses trabalhos. Todos os textos est√£o muito claros e bem escritos, ent√£o vamos focar apenas no que mais nos chamou aten√ß√£o em cada trabalho.\nLouise Mamedio\rDestaques do trabalho da Louise Mamedio:\n\rCriatividade. A an√°lise conta uma hist√≥ria.\rBom humor. A parte t√©cnica muito bem dilu√≠da em um texto muito gostoso de ser lido, o que √© muito convidativo para leitores pouco acostumados com an√°lises de dados.\rDireto ao ponto. Todos os seus textos s√£o informativos, sem enrola√ß√£o ou mera descri√ß√£o do que j√° est√° sendo mostrado no gr√°fico.\r\rVeja o trabalho completo aqui: https://curso-r.github.io/202005-r4ds-1/trabalhos_vencedores/concursolouise.html\n\rCamila Bertini\rDestaques do trabalho da Camila Bertini:\n\rT√©cnica. Dashboard muito bem constru√≠do e organizado.\rVisual. Gr√°ficos e tabelas bem formatados, com cores, labels e legendas que ajudam a interpreta√ß√£o.\r\rVeja o trabalho completo aqui: https://curso-r.github.io/202005-r4ds-1/trabalhos_vencedores/Desafio_flexdasboard.html\n\rRodrigo Almeida\rDestaques do trabalho do Rodrigo Almeida:\n\rOrganiza√ß√£o. O texto explica a an√°lise de maneira muito bem organizada.\rAn√°lise cr√≠tica. As visualiza√ß√µes escolhidas para apresentar cada informa√ß√£o e a defini√ß√£o das vari√°veis com poder de atua√ß√£o mostram como t√©cnica e conhecimento do tema (neg√≥cio) devem se relacionar em uma an√°lise de dados.\r\rVeja o trabalho completo aqui: https://curso-r.github.io/202005-r4ds-1/trabalhos_vencedores/Projeto_Curso-R.html\n\rMariana Costa\rDestaques do trabalho da Mariana Costa.\n\rEstrutura. An√°lise muito bem estruturada, com objetivo bem estabelecido e desenvolvimento coerente.\rVisual. Gr√°ficos e tabelas bem formatados, com cores, labels e legendas que ajudam a interpreta√ß√£o.s\rConclus√£o clara e direta ao ponto.\r\rVeja o trabalho completo aqui: https://curso-r.github.io/202005-r4ds-1/trabalhos_vencedores/analise_descritiva.pdf\n\r\rE claro: em tempo limitado. Os alunos tiveram uma semana para fazer o trabalho.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2020-06-20-melhores-trabalhos-r4ds1/","tags":["relat√≥rios"],"title":"Melhores trabalhos do curso R para Ci√™ncia de dados I (maio de 2020)"},{"author":["Athos"],"categories":["an√°lises"],"contents":"\r\rFui apresentado por uma amiga aO Teste de Bechdel, que avalia se um filme possui tr√™s regras b√°sicas:\nAo menos duas mulheres (com nome)\r‚Ä¶ que conversam entre si\r‚Ä¶ sobre algo que n√£o seja homem\r\rEsse teste foi nomeado em homenagem √† cartunista Alison Bechdel que, em um de seus quadrinhos, apresentou essa ideia e hoje √© utilizado para medir o grau de discrimina√ß√£o de g√™nero no cinema.\nO site bechdeltest.com oferece espa√ßo para qualquer um contribuir com filmes avaliados no teste de Bechdel e disponibiliza f√°cil acesso a um banco de dados de 8.440 filmes de 1888 at√© os dias de hoje.\nUm pitaco pessoal (Athos): Imagine as mesmas regras, mas invertendo homem por mulher. Quantos filmes voc√™ acha que n√£o passariam no teste? Na minha opini√£o? Menos de 1%!\nAchados\r\rPa√≠ses como Canad√° e Jap√£o parecem estarem melhorando;\rBrasil tem poucos dados, mas n√£o se destaca positivamente;\rPr√™mios e Notas IMDB n√£o s√£o diferentes entre filmes que passaram no teste e filmes que n√£o passaram no teste. Pode-se argumentar que a discrimina√ß√£o de g√™nero, mesmo que sempre injustific√°vel, n√£o sustenta nem a ret√≥rica de que vale a pena financeiramente;\r\r\rDados\rO site disponibiliza uma API para acessar os dados. Ent√£o para trazer para o R √© simples como a linha abaixo.\nbechdel \u0026lt;- fromJSON(\u0026quot;http://bechdeltest.com/api/v1/getAllMovies\u0026quot;)\rglimpse(bechdel)\r## Rows: 8,440\r## Columns: 5\r## $ year \u0026lt;int\u0026gt; 1888, 1892, 1895, 1895, 1896, 1896, 1896, 1896, 1898, 1898, 18‚Ä¶\r## $ title \u0026lt;chr\u0026gt; \u0026quot;Roundhay Garden Scene\u0026quot;, \u0026quot;Pauvre Pierrot\u0026quot;, \u0026quot;Tables Turned on t‚Ä¶\r## $ imdbid \u0026lt;chr\u0026gt; \u0026quot;0392728\u0026quot;, \u0026quot;0000003\u0026quot;, \u0026quot;0000014\u0026quot;, \u0026quot;0132134\u0026quot;, \u0026quot;0000091\u0026quot;, \u0026quot;000013‚Ä¶\r## $ rating \u0026lt;int\u0026gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶\r## $ id \u0026lt;int\u0026gt; 8040, 5433, 5444, 6200, 4982, 5406, 5445, 6199, 5411, 5410, 49‚Ä¶\rOBS: reparem na coluna imdbid. Ela permite coletar informa√ß√µes do IMDB para maiores an√°lises!\n\rRating\rO rating vai de 0 a 3, que representa quantas regras s√£o atendidas no filme. Vamos rotular para melhor leitura.\nbechdel \u0026lt;- bechdel %\u0026gt;%\rmutate(\rindice_bechdel = case_when(\rrating == 0 ~ \u0026quot;Menos de duas mulheres\u0026quot;,\rrating == 1 ~ \u0026quot;Pelo menos duas mulheres\u0026quot;,\rrating == 2 ~ \u0026quot;... que conversam entre si\u0026quot;,\rrating == 3 ~ \u0026quot;... sobre algo que n√£o seja homem\u0026quot;\r),\rindice_bechdel = fct_reorder(indice_bechdel, rating),\rdecada = (year %/% 10)*10\r)\rbechdel %\u0026gt;% count(indice_bechdel, rating) %\u0026gt;%\rmutate(\rrating_p = scales::percent(n/sum(n), accuracy = 1)\r) %\u0026gt;%\rggplot(aes(y = indice_bechdel, x = n)) +\rgeom_segment(aes(xend = 0, yend = indice_bechdel)) +\rgeom_point(size = 12) +\rgeom_text(aes(label = rating_p), color = \u0026quot;white\u0026quot;, fontface = \u0026quot;bold\u0026quot;) +\rlabs(x = \u0026quot;contagem\u0026quot;, y = NULL, title = \u0026quot;Filmes por Rating Bechdel\u0026quot;) +\rtheme(\rpanel.grid.minor.y = element_blank(),\rpanel.grid.major.y = element_blank(),\rpanel.grid.major.x = element_blank()\r)\r\rEvolu√ß√£o nas D√©cadas\rbechdel_por_decada \u0026lt;- bechdel %\u0026gt;%\rcount(decada, indice_bechdel, .drop = FALSE)\rbechdel_por_decada %\u0026gt;%\rggplot(aes(x = decada, fill = indice_bechdel, y = n)) +\rgeom_col(position = \u0026quot;fill\u0026quot;, colour = \u0026quot;black\u0026quot;, width = 10) +\rgeom_text(aes(label = indice_bechdel), position = \u0026quot;fill\u0026quot;, data = filter(bechdel_por_decada, decada == 1950), vjust = 2.5, colour = \u0026quot;white\u0026quot;, fontface = \u0026quot;bold\u0026quot;) +\rscale_fill_brewer(palette = \u0026quot;RdBu\u0026quot;, guide = \u0026quot;none\u0026quot;) +\rlabs(x = \u0026quot;D√©cada\u0026quot;, y = \u0026quot;Propor√ß√£o\u0026quot;, title = \u0026quot;Evolu√ß√£o dos Ratings Bechdel pelas D√©cadas\u0026quot;) +\rscale_y_continuous(labels = scales::percent) +\rtheme(\rpanel.grid = element_blank()\r) \rO Teste de Bechdel vem melhorando com o tempo, ent√£o as perspectivas s√£o positivas. Em um mundo cada vez mais conectado, espera-se que a informa√ß√£o chegue a cada vez mais pessoas e a discrimina√ß√£o encrustrada na nossa cultura se dissolva.\n\rInforma√ß√µes do IMDB\rA API do IMDB √© muito burocr√°tica de usar. Eu encontrei o site OMDB que foi bem mais f√°cil de usar, mas talvez tenha menos informa√ß√£o legal. Vou mostrar como usar:\nAPI Key\rPrimeiro eu peguei uma API KEY no site deles e coloquei no meu .Renviron porque da√≠ eu posso usar o Sys.get() pra us√°-la sem precisar mostrar pra ningu√©m.\nSys.getenv(\u0026#39;OMDB_APIKEY\u0026#39;)\r# [1] as48732f1d (de mentirinha)\r\rChamando a API\rDepois eu chamei a API do OMDB usando tanto minha API KEY quanto o IMDB ID. A chamada tem que ser assim: http://www.omdbapi.com/?apikey={Sys.getenv('OMDB_APIKEY')}\u0026amp;i=tt{imdbid}. Ela vai devolver um json que pode ser facilmente formatado pelo jsonlite::fromJSON().\nlibrary(glue)\rpega_info_imdb \u0026lt;- function(imdbid) {\rglue(\u0026quot;http://www.omdbapi.com/?apikey={Sys.getenv(\u0026#39;OMDB_APIKEY\u0026#39;)}\u0026amp;i=tt{imdbid}\u0026quot;) %\u0026gt;%\rfromJSON() %\u0026gt;%\ras_tibble()\r}\r# safely porque a API pode dar erro 522 (no servidor do OMDB)\rpega_info_imdb_safe \u0026lt;- safely(pega_info_imdb)\r# demora ~40 min\rbechdel_com_imdb \u0026lt;- bechdel %\u0026gt;%\ras_tibble() %\u0026gt;%\rmutate(\rinfos_imdb = map(imdbid, pega_info_imdb_safe)\r)\r\rArrumando os dados\rOs dados precisam de uma massagem antes porque vem em uma lista aninhada e tudo texto.\n# Arruma as tabelas aninhadas\rarruma_infos_imdb \u0026lt;- function(infos_imdb) {\rif(!is.null(infos_imdb$Ratings)) {\rinfos_imdb %\u0026gt;% nest(Ratings = c(Ratings)) %\u0026gt;%\rmutate(Ratings = map(Ratings, ~.x$Ratings %\u0026gt;% filter(Source %in% \u0026quot;Internet Movie Database\u0026quot;))) %\u0026gt;%\runnest(Ratings)\r} else {\rinfos_imdb\r}\r}\r# cria bechdel com as infos do imdb e arruma o tipo das vari√°veis\rbechdel_com_imdb \u0026lt;- bechdel_com_imdb %\u0026gt;%\rmutate(\rdeu_errado = map_lgl(infos_imdb, ~ !is.null(.x$error)),\rinfos_imdb = infos_imdb %\u0026gt;% map(\u0026quot;result\u0026quot;) %\u0026gt;% map(arruma_infos_imdb)\r) %\u0026gt;%\runnest(infos_imdb) %\u0026gt;%\rmutate(\rimdbRating_num = imdbRating %\u0026gt;% parse_number()\r)\r\rTabela final\rglimpse(bechdel_com_imdb)\r## Rows: 8,414\r## Columns: 41\r## $ year \u0026lt;int\u0026gt; 1888, 1892, 1895, 1895, 1896, 1896, 1896, 1896, 1898, ‚Ä¶\r## $ title \u0026lt;chr\u0026gt; \u0026quot;Roundhay Garden Scene\u0026quot;, \u0026quot;Pauvre Pierrot\u0026quot;, \u0026quot;Tables Tur‚Ä¶\r## $ imdbid \u0026lt;chr\u0026gt; \u0026quot;0392728\u0026quot;, \u0026quot;0000003\u0026quot;, \u0026quot;0000014\u0026quot;, \u0026quot;0132134\u0026quot;, \u0026quot;0000091\u0026quot;,‚Ä¶\r## $ rating \u0026lt;int\u0026gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, ‚Ä¶\r## $ id \u0026lt;int\u0026gt; 8040, 5433, 5444, 6200, 4982, 5406, 5445, 6199, 5411, ‚Ä¶\r## $ indice_bechdel \u0026lt;fct\u0026gt; Menos de duas mulheres, Menos de duas mulheres, Menos ‚Ä¶\r## $ decada \u0026lt;dbl\u0026gt; 1880, 1890, 1890, 1890, 1890, 1890, 1890, 1890, 1890, ‚Ä¶\r## $ Title \u0026lt;chr\u0026gt; \u0026quot;Roundhay Garden Scene\u0026quot;, \u0026quot;Poor Pierrot\u0026quot;, \u0026quot;The Sprinkle‚Ä¶\r## $ Year \u0026lt;chr\u0026gt; \u0026quot;1888\u0026quot;, \u0026quot;1892\u0026quot;, \u0026quot;1895\u0026quot;, \u0026quot;1895\u0026quot;, \u0026quot;1896\u0026quot;, \u0026quot;1896\u0026quot;, \u0026quot;1896\u0026quot;‚Ä¶\r## $ Rated \u0026lt;chr\u0026gt; \u0026quot;NOT RATED\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;Not Rated\u0026quot;, \u0026quot;Not Rated\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;‚Ä¶\r## $ Released \u0026lt;chr\u0026gt; \u0026quot;14 Oct 1888\u0026quot;, \u0026quot;28 Oct 1892\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;28 Aug 1895\u0026quot;, \u0026quot;N‚Ä¶\r## $ Runtime \u0026lt;chr\u0026gt; \u0026quot;1 min\u0026quot;, \u0026quot;4 min\u0026quot;, \u0026quot;1 min\u0026quot;, \u0026quot;1 min\u0026quot;, \u0026quot;3 min\u0026quot;, \u0026quot;1 min\u0026quot;, ‚Ä¶\r## $ Genre \u0026lt;chr\u0026gt; \u0026quot;Documentary, Short\u0026quot;, \u0026quot;Animation, Comedy, Short, Roman‚Ä¶\r## $ Director \u0026lt;chr\u0026gt; \u0026quot;Louis Aim√© Augustin Le Prince\u0026quot;, \u0026quot;√âmile Reynaud\u0026quot;, \u0026quot;Lou‚Ä¶\r## $ Writer \u0026lt;chr\u0026gt; \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;Georges M√©li√®s\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;‚Ä¶\r## $ Actors \u0026lt;chr\u0026gt; \u0026quot;Annie Hartley, Adolphe Le Prince, Joseph Whitley, Sar‚Ä¶\r## $ Plot \u0026lt;chr\u0026gt; \u0026quot;In the garden, a man asks his friends to do something‚Ä¶\r## $ Language \u0026lt;chr\u0026gt; \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;None\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A‚Ä¶\r## $ Country \u0026lt;chr\u0026gt; \u0026quot;UK, France\u0026quot;, \u0026quot;France\u0026quot;, \u0026quot;France\u0026quot;, \u0026quot;USA\u0026quot;, \u0026quot;France\u0026quot;, \u0026quot;Fr‚Ä¶\r## $ Awards \u0026lt;chr\u0026gt; \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;‚Ä¶\r## $ Poster \u0026lt;chr\u0026gt; \u0026quot;https://m.media-amazon.com/images/M/MV5BOGE3YjczMTQtZ‚Ä¶\r## $ Metascore \u0026lt;chr\u0026gt; \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;‚Ä¶\r## $ imdbRating \u0026lt;chr\u0026gt; \u0026quot;7.5\u0026quot;, \u0026quot;6.6\u0026quot;, \u0026quot;7.1\u0026quot;, \u0026quot;6.7\u0026quot;, \u0026quot;6.7\u0026quot;, \u0026quot;5.8\u0026quot;, \u0026quot;5.2\u0026quot;, \u0026quot;7.4\u0026quot;‚Ä¶\r## $ imdbVotes \u0026lt;chr\u0026gt; \u0026quot;4,609\u0026quot;, \u0026quot;1,144\u0026quot;, \u0026quot;4,287\u0026quot;, \u0026quot;1,755\u0026quot;, \u0026quot;2,149\u0026quot;, \u0026quot;1,040\u0026quot;, ‚Ä¶\r## $ imdbID \u0026lt;chr\u0026gt; \u0026quot;tt0392728\u0026quot;, \u0026quot;tt0000003\u0026quot;, \u0026quot;tt0000014\u0026quot;, \u0026quot;tt0132134\u0026quot;, \u0026quot;t‚Ä¶\r## $ Type \u0026lt;chr\u0026gt; \u0026quot;movie\u0026quot;, \u0026quot;movie\u0026quot;, \u0026quot;movie\u0026quot;, \u0026quot;movie\u0026quot;, \u0026quot;movie\u0026quot;, \u0026quot;movie\u0026quot;, ‚Ä¶\r## $ DVD \u0026lt;chr\u0026gt; \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;‚Ä¶\r## $ BoxOffice \u0026lt;chr\u0026gt; \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;‚Ä¶\r## $ Production \u0026lt;chr\u0026gt; \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;‚Ä¶\r## $ Website \u0026lt;chr\u0026gt; \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;, \u0026quot;N/A\u0026quot;‚Ä¶\r## $ Response \u0026lt;chr\u0026gt; \u0026quot;True\u0026quot;, \u0026quot;True\u0026quot;, \u0026quot;True\u0026quot;, \u0026quot;True\u0026quot;, \u0026quot;True\u0026quot;, \u0026quot;True\u0026quot;, \u0026quot;True\u0026quot;‚Ä¶\r## $ Source \u0026lt;chr\u0026gt; \u0026quot;Internet Movie Database\u0026quot;, \u0026quot;Internet Movie Database\u0026quot;, ‚Ä¶\r## $ Value \u0026lt;chr\u0026gt; \u0026quot;7.5/10\u0026quot;, \u0026quot;6.6/10\u0026quot;, \u0026quot;7.1/10\u0026quot;, \u0026quot;6.7/10\u0026quot;, \u0026quot;6.7/10\u0026quot;, \u0026quot;5.8‚Ä¶\r## $ Error \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA‚Ä¶\r## $ Season \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA‚Ä¶\r## $ Episode \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA‚Ä¶\r## $ seriesID \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA‚Ä¶\r## $ totalSeasons \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA‚Ä¶\r## $ Ratings \u0026lt;lgl\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA‚Ä¶\r## $ deu_errado \u0026lt;lgl\u0026gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE‚Ä¶\r## $ imdbRating_num \u0026lt;dbl\u0026gt; 7.5, 6.6, 7.1, 6.7, 6.7, 5.8, 5.2, 7.4, 6.0, 7.5, 7.5,‚Ä¶\r\rBechdel por Pa√≠s\rJap√£o e Canad√° s√£o os pa√≠ses que apresentem tend√™ncias mais claras de mudan√ßas. Os demais parecem estagnados. Brasil tem 45 filmes analisado e n√£o parece diferente da Alemanha, Reino Unido, EUA ou Fran√ßa.\nFilmes brasileiros\rbechdel_com_imdb %\u0026gt;%\rfilter(str_detect(Country, \u0026quot;Brazil\u0026quot;)) %\u0026gt;%\rselect(year, Title, rating) %\u0026gt;%\rarrange(rating) %\u0026gt;%\rknitr::kable()\r\r\ryear\rTitle\rrating\r\r\r\r2007\rEstomago: A Gastronomic Story\r0\r\r2007\rYou, Me and Him\r0\r\r2009\rThe Secret of Kells\r0\r\r2011\rSamsara\r0\r\r2013\rBoy and the World\r0\r\r2014\rArdor\r0\r\r2002\rCity of God\r1\r\r2003\rFear X\r1\r\r2011\rRio\r1\r\r2012\rTwo Rabbits\r1\r\r2013\rVai que d√° Certo\r1\r\r2014\rTrash\r1\r\r2014\rFuturo Beach\r1\r\r2018\rTito and the Birds\r1\r\r2019\rBacurau\r1\r\r1985\rKiss of the Spider Woman\r2\r\r2003\rThe Man Who Copied\r2\r\r2009\rFrom Beginning to End\r2\r\r2019\rTurma da M√¥nica: La√ßos\r2\r\r1986\rHour of the Star\r3\r\r1998\rCentral Station\r3\r\r2004\rNina\r3\r\r2005\r√Üon Flux\r3\r\r2007\rElite Squad\r3\r\r2008\rBlindness\r3\r\r2008\rLion‚Äôs Den\r3\r\r2010\rSo Hard to Forget\r3\r\r2011\rFast Five\r3\r\r2011\rFound Memories\r3\r\r2012\rNeighboring Sounds\r3\r\r2012\rTabu\r3\r\r2012\rSnezhnaya koroleva\r3\r\r2013\rReaching for the Moon\r3\r\r2013\rOpen Road\r3\r\r2013\rMy Mom Is a Character\r3\r\r2013\rBrazilian Western\r3\r\r2013\rTime and the Wind\r3\r\r2014\rAugust Winds\r3\r\r2014\rThe Way He Looks\r3\r\r2014\rLast Night\r3\r\r2015\rNeon Bull\r3\r\r2015\rThe Second Mother\r3\r\r2016\rAquarius\r3\r\r2017\rCall Me by Your Name\r3\r\r2018\rThe Heiresses\r3\r\r\r\r\r\rFilmes Premiados\rA base traz informa√ß√£o de premia√ß√µes. Filmes sem premia√ß√£o n√£o destoam dos filmes premiados em termos de avalia√ß√£o de Bechdel, o que indica que o machismo n√£o est√° relacionado com o sucesso de um filme.\nbechdel_por_decada_e_premiacao \u0026lt;- bechdel_com_imdb %\u0026gt;%\rmutate(\rpremiacao = case_when(\rstr_detect(Awards, \u0026quot;N/A\u0026quot;) | is.na(Awards) ~ \u0026quot;z Sem Premia√ß√£o\u0026quot;,\rstr_detect(Awards, \u0026quot;Won.*Oscar\u0026quot;) ~ \u0026quot;a Vencedor de Oscar\u0026quot;,\rstr_detect(Awards, \u0026quot;Won.*(BAFTA|Golden Globe)\u0026quot;) ~ \u0026quot;b Vencedor de BAFTA/Golden Globe\u0026quot;,\rstr_detect(Awards, \u0026quot;Nominated\u0026quot;) ~ \u0026quot;c Nomeado ao Oscar/BAFTA/Golden Globe\u0026quot;,\rstr_detect(Awards, \u0026quot;win\u0026quot;) ~ \u0026quot;d Vencedor de outros pr√™mios\u0026quot;,\rstr_detect(Awards, \u0026quot;nomination\u0026quot;) ~ \u0026quot;d Nomeado a outros pr√™mios\u0026quot;,\rTRUE ~ \u0026quot;e Outro\u0026quot;\r)\r) %\u0026gt;%\rcount(premiacao, decada, indice_bechdel, .drop = FALSE)\rbechdel_por_decada_e_premiacao %\u0026gt;%\rfilter(decada \u0026gt;= 1940) %\u0026gt;%\rggplot(aes(x = decada, fill = indice_bechdel, y = n)) +\rgeom_col(position = \u0026quot;fill\u0026quot;, colour = \u0026quot;black\u0026quot;, width = 10) +\rscale_fill_brewer(palette = \u0026quot;RdBu\u0026quot;, guide = \u0026quot;none\u0026quot;) +\rlabs(x = \u0026quot;D√©cada\u0026quot;, y = \u0026quot;Propor√ß√£o\u0026quot;, title = \u0026quot;Evolu√ß√£o dos Ratings Bechdel pelas D√©cadas\u0026quot;) +\rscale_y_continuous(labels = scales::percent) +\rtheme(\rpanel.grid = element_blank()\r) +\rfacet_wrap(vars(premiacao), ncol = 3)\r\rNota IMDB\rNotas do IMDB tamb√©m n√£o diferem entre filmes que passaram no teste e filmes que n√£o passaram no teste de Bechdel.\nbechdel_por_decada_e_pais \u0026lt;- bechdel_por_decada_e_pais %\u0026gt;%\rmutate(\rimdbVotes = parse_number(imdbVotes),\rpassou_no_teste = case_when(\rrating %in% 3 ~ \u0026quot;Sim\u0026quot;,\rTRUE ~ \u0026quot;N√£o\u0026quot;\r)\r)\rbechdel_nota_por_decada \u0026lt;- bechdel_por_decada_e_pais %\u0026gt;%\rgroup_by(pais) %\u0026gt;%\rfilter(n() \u0026gt; 10) %\u0026gt;%\rgroup_by(pais, decada, passou_no_teste) %\u0026gt;%\rsummarise(\rimdb_media = mean(imdbRating_num, na.rm = TRUE),\rimdb_dp = sd(imdbRating_num, na.rm = TRUE),\rimdb_inf = imdb_media - 2*imdb_dp,\rimdb_sup = imdb_media + 2*imdb_dp\r)\rbechdel_nota_por_decada %\u0026gt;% filter(decada \u0026gt;= 1940) %\u0026gt;%\rggplot(aes(x = decada, y = imdb_media, colour = passou_no_teste)) +\rgeom_line() +\rgeom_point() +\rgeom_jitter(data = bechdel_por_decada_e_pais %\u0026gt;% filter(decada \u0026gt;= 1940), aes(y = imdbRating_num), alpha = 0.05) +\rgeom_ribbon(aes(ymin = imdb_inf, ymax = imdb_sup, fill = passou_no_teste), alpha = 0.1) +\rfacet_wrap(vars(pais)) +\rlabs(x = \u0026quot;D√©cada\u0026quot;, y = \u0026quot;Nota IMDB\u0026quot;, colour = \u0026quot;Passou no Teste\u0026quot;, fill = \u0026quot;Passou no Teste\u0026quot;, title = \u0026quot;Notas do IMDB vs Teste de Bechdel\u0026quot;) +\rscale_x_continuous(breaks = c(1950, 2020)) +\rtheme(legend.position = \u0026quot;top\u0026quot;)\rO que voc√™ achou das an√°lises? Conte para a gente! √â um tema que vale a pena ser discutido por todos.\n\r\r","permalink":"https://blog.curso-r.com/posts/2020-06-09-bechdel/","tags":["ggplot2","tidyverse","api","imdb"],"title":"Bechdel: Filme e Machismo"},{"author":["Jos√© de Jesus Filho"],"categories":["pacotes"],"contents":"\r\rIntrodu√ß√£o\rH√° alguns anos, eu tenho me dedicado a aperfei√ßoar ferramentas de coleta, limpeza, organiza√ß√£o e an√°lise de dados processuais. Posso afirmar, com seguran√ßa, que tenho bem elaborado um processo que d√° conta eficientemente de todo o ciclo da ci√™ncia de dados utilizando apenas dois softwares livres: R e PostgreSQL.\nEste tutorial mostraraÃÅ como estruturar uma base de dados de textos no PostgreSQL, tokenizaÃÅ-los e montar um iÃÅndice invertido a fim de realizar buscas textuais em grande volumes de documentos em poucos segundos. Os textos seraÃÉo organizados a partir do R, enviados para o PostgreSQL, indexados e, de l√°,ÃÅ chamados a partir de um aplicativo shiny.\n\rBusca textual\rA busca textual confere a capacidade de identificar documentos em linguagem natural que atendam a uma consulta e, opcionalmente, classific√°-los por relev√¢ncia para a busca. O tipo mais comum de pesquisa √© encontrar todos os documentos que contenham os termos da consulta e retorn√°-los em ordem de semelhan√ßa com a consulta. As no√ß√µes de consulta e semelhan√ßa s√£o muito flex√≠veis e dependem da aplica√ß√£o espec√≠fica.\nOs operadores de pesquisa textual existem nos bancos de dados h√° anos. O PostgreSQL possui operadores ~, ~ *, LIKE e ILIKE para tipos de dados textuais, mas eles n√£o possuem muitas propriedades essenciais exigidas pelos modernos sistemas de informa√ß√£o:\n\rN√£o h√° suporte lingu√≠stico, mesmo para o ingl√™s. Express√µes regulares n√£o s√£o suficientes porque n√£o conseguem lidar facilmente com palavras derivadas, por exemplo, satisfazer e satisfeito.\n\rEles n√£o ordenam (classifica√ß√£o) os resultados da pesquisa conforme a relev√¢ncia, o que os torna ineficazes quando milhares de documentos correspondentes s√£o encontrados.\n\rEles tendem a ser lentos porque n√£o h√° suporte de √≠ndice; portanto, eles devem processar todos os documentos para cada pesquisa.\n\r\rEm outras palavras, para uma busca textual eficiente, √© importante tomar em considera√ß√£o ferramentas de NLP e um pr√©-processamente dos textos.\nA indexa√ß√£o de texto permite que os documentos sejam pr√©-processados e um √≠ndice salvo para posterior busca r√°pida. O pr√©-processamento inclui:\n\rTokeniza√ß√£o dos documentos;\n\rConvers√£o dos tokens em lexemas;\n\rSalvar documentos pr√©-processados e otimizados para pesquisa;\n\r\rPorque usar o R\r\rSoftware live;\rAcolhedor da diversidade;\rComposto por uma comunidade acad√™mica exigente e cientificamente rigorosa;\rPossui um grande n√∫mero de pacotes para coleta, limpeza e estrutura√ß√£o de dados. √â importante lembrar que esse trabalho chega a tomar 80% do ciclo de ci√™ncia de dados;\rD√° conta tanto de estat√≠stica quanto de machine learning;\rFacilita a publica√ß√£o de resultados tanto com relat√≥rios (Rmarkdown) quanto com aplicativos (shiny);\r\r\rPorque usar o PostgreSQL\r\rSoftware livre;\rF√°cil de instalar;\rBem documentado;\rAmpla comunidade;\rFunciona como motor de busca textual, dispensando o uso do\rSolr ou do Elasticsearch;\r\rAssumindo que voc√™ j√° tem o R, o RStudio, e o shiny-server instalados, irei mostar apenas como instalar o PostgreSQL. Caso queira instalar os tr√™s primeiros, voc√™ pode seguir este script para instal√°-los no Ubuntu.\n\r\rInstala√ß√£o do PostgreSQL\rSupondo um ambiente de desenvolvimento, irei considerar a instala√ß√£o do PostgreSQL, do RStudio e do Shiny numa √∫nica m√°quina. Em produ√ß√£o, eu criaria uma rede privada de m√°quinas virtuais e distribuiria as funcionalidades em diferentes m√°quinas numa mesma central de dados (data-center).\n- PostgreSQL instalado (irei mostrar como instalar no Ubuntu);\r- R, RStudio e Shiny instalados;\r- Pacotes RPostgres, dbx, pool, glue, abjutils e DT instalados;\r- Tidyverse \r\rInstalar o PostgreSQL\rO procedimento abaixo mostra como instalar o PostgreSQL\nAdicionar a chave GPG\rA instala√ß√£o da chave GPG preserva uma comunica√ß√£o segura entre o cliente eo servidor. Ela √© importante para assegurar a integridade dos dados e a autencidade da fonte. Ou seja, os dados s√£o criptografados antes de serem baixados por seu computador e decriptografados pela chave previamente instalada. Isso reduz significativamente as chances de que um terceiro intervenha no processo de transmiss√£o e instale algo nocivo na sua m√°quina.\nwget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -\rEm seguida, adicione o reposit√≥rio com o comando abaixo:\nsudo sh -c \u0026#39;echo \u0026quot;deb http://apt.postgresql.org/pub/repos/apt/ `lsb_release -cs`-pgdg main\u0026quot; \u0026gt;\u0026gt; /etc/apt/sources.list.d/pgdg.list\u0026#39;\rFeito isso, o passo seguinte √© instalar o PostgreSQL:\nsudo apt update\rsudo apt install postgresql postgresql-contrib\r\rConfigura√ß√£o do locale\rO PostgreSQL adota o locale da sua m√°quina, ent√£o √© importante assegurar que o locale est√° configurado para pt_BR.UTF-8. Crie um arquivo e adicione o script abaixo para configura√ß√£o do locale:\nsudo touch set_locale.sh ## cria√ß√£o do arquivo\rScript:\n#!/bin/bash\r# Set locales in /etc/default/locale file\recho \u0026quot;Setting locale...\u0026quot;\recho \u0026quot;# Locale settings\rexport LANGUAGE=pt_BR.UTF-8\rexport LANG=pt_BR.UTF-8\rexport LC_ALL=pt_BR.UTF-8\u0026quot; \u0026gt;\u0026gt; ~/.bash_profile\rlocale-gen pt_BR.UTF-8\rsudo dpkg-reconfigure locales\rsource ~/.bash_profile\rsudo chmod +x set_locale.sh\rsudo ./set_locale.sh\r\rTrabalhando com o PostgreSQL\rPara fins de completude, estou admitindo que voc√™ n√£o tem familiaridade com o PostgreSQL. Isso n√£o significa que darei explica√ß√£o de cada passo, mas apenas que n√£o os deixarei impl√≠citos.\nH√° muitos clientes que permitem acesso ao PostgreSQL para envio de queries e statements. N√≥s usaremos dois, o psql e o pr√≥prio R. Com o psql voc√™ acessa e trabalha com o Posgres via linha de comando. Quando voc√™ instalou o PostgreSQL, o psql tamb√©m foi instadado. Dito isso, vamos realizar nosso primeiro acesso.\nsudo -u postgres psql\r\rTO_TSVECTOR, TO_TSQUERY e @@\rAs fun√ß√µes to_tsvector, to_tsquery e o operador @@ (match) fazem a m√°gica da busca textual.\nSELECT to_tsvector(\u0026#39;portuguese\u0026#39;,\r\u0026#39;Alma minha gentil, que te partiste\rT√£o cedo desta vida descontente,\rRepousa l√° no C√©u eternamente,\rE viva eu c√° na terra sempre triste.(Cam√µes)\u0026#39;) @@ to_tsquery(\u0026#39;c√©u\u0026#39;);\r?column?\r----------\rt\r(1 row)\rSELECT to_tsvector(\u0026#39;portuguese\u0026#39;,\r\u0026#39;Minha m√£e me deu ao mundo\re, sem ter mais o que me dar,\rme ensinou a jogar palavra\rno vento pra ela voar.\rDizia: ‚ÄúFilho, palavra\rTem que saber como usar.\rAquilo √© que nem rem√©dio:\rCura, mas pode matar.(Aleixo)\u0026#39;) @@ to_tsquery(\u0026#39;filho \u0026amp; rem√©dio\u0026#39;);\r?column?\r----------\rt\r(1 row)\rSELECT to_tsvector(\u0026#39;portuguese\u0026#39;,\r\u0026#39;No fundo, no fundo,\rbem l√° no fundo,\ra gente gostaria\rde ver nossos problemas\rresolvidos por decreto\ra partir desta data,\raquela m√°goa sem rem√©dio\r√© considerada nula\re sobre ela ‚Äî sil√™ncio perp√©tuo\rextinto por lei todo o remorso,\rmaldito seja quem olhar pra tr√°s,\rl√° pra tr√°s n√£o h√° nada,\re nada mais\rmas problemas n√£o se resolvem,\rproblemas t√™m fam√≠lia grande,\re aos domingos\rsaem todos a passear\ro problema, sua senhora\re outros pequenos probleminhas.(Leminski)\u0026#39;) @@ to_tsquery(\u0026#39;remorso | probleminhas\u0026#39;);\r?column?\r----------\rt\r(1 row)\r\rTrabalhando com tabelas\rNo seguinte reposit√≥rio consta uma base de 48 mil not√≠cias do G1, a qual utilizaremos para fins de demonstra√ß√£o.\nInicialmente, vamos criar um usu√°rio (role) e uma base de dados para receber essas not√≠cias:\nCREATE ROLE saturday WITH PASSWORD \u0026#39;RshinesWithPostgres\u0026#39;; CREATE DATABASE noticias OWNER = saturday;\rAgora nos conectamos √† base, adicionamos a extens√£o unaccent retirar acentos das palavras.\n\\c noticias\rCREATE EXTENSION unaccent;\r\rConfigura√ß√µes necess√°rias\rVamos agora configurar a busca para que ela lide adequadamente com palavras acentuadas, mai√∫sculas e min√∫sculas, bem como, de suas varia√ß√µes.\nCREATE TEXT SEARCH CONFIGURATION pt (COPY = pg_catalog.portuguese);\rALTER TEXT SEARCH CONFIGURATION pt\rALTER MAPPING\rFOR hword, hword_part, word with unaccent, portuguese_stem;\r\rIndexa√ß√£o dos documentos\rDe agora em diante, passaremos a executar os queries e statemants a partir do pr√≥prio R, colocando-os dentro de fun√ß√µes.\nA primeira coisa a fazer √© conectar-se √† base e adicionar a tabela. Veja que eu apenas crio a tabela, mas n√£o insiro os documentos. Quando voc√™ tem muitos documentos, isso pode travar.\nconn \u0026lt;- DBI::dbConnect(RPostgres::Postgres(),\rdbname = \u0026quot;noticias\u0026quot;,\rhost = \u0026quot;localhost\u0026quot;,\ruser=\u0026quot;saturday\u0026quot;,\rpassword = \u0026quot;RshinesWithPostgres\u0026quot;)\rDBI::dbCreateTable(conn,\u0026quot;g1\u0026quot;,g1)\r\rInserindo os documentos\rPara inserir os documentos, eu prefiro usar o pacote dbx porque ele permite a inser√ß√£o em batches. Inserir centenas de milhares de documentos pode sobrecarregar sua m√°quina. Coloquei mil, mas 50 mil tem suportado bem.\ndbx::dbxInsert(con = conn, table = \u0026quot;g1\u0026quot;, records = g1, batch_size = 1000)\r\rIndexando os documentos\rHora de indexar os documentos. H√° dois indexadores, o GIN e o GIST, usaremos o GIN pq √© mais r√°pido, por√©m mais intenso. A fun√ß√£o a seguir cria o index estabelecendo pesos diferentes para duas colunas.\npsql_tokenize \u0026lt;- function(con, tbl, config = \u0026quot;pt\u0026quot;) {\rsource \u0026lt;- list(a = c(\u0026quot;intro\u0026quot;, \u0026quot;A\u0026quot;), j = c(\u0026quot;corpo\u0026quot;, \u0026quot;B\u0026quot;))\rtarget \u0026lt;- \u0026quot;document_tokens\u0026quot;\ridx \u0026lt;- paste0(tbl,\u0026quot;_idx\u0026quot;)\rquery \u0026lt;- glue::glue_sql(\u0026quot;ALTER TABLE {`tbl`} ADD COLUMN {`target`} TSVECTOR\u0026quot;, .con = con)\rres \u0026lt;- DBI::dbSendQuery(con, query)\rDBI::dbClearResult(res)\rquery \u0026lt;- glue::glue_sql(\u0026quot;UPDATE {`tbl`} SET\r{`target`} = setweight(to_tsvector({config},coalesce({`source$a[1]`},\u0026#39;\u0026#39;)), {source$a[2]}) ||\rsetweight(to_tsvector({config},coalesce({`source$j[1]`}, \u0026#39;\u0026#39;)), {source$j[2]})\u0026quot;, .con = con)\rres \u0026lt;- DBI::dbSendQuery(con, query)\rDBI::dbClearResult(res)\rquery \u0026lt;- glue::glue_sql(\u0026quot;CREATE INDEX {`idx`} ON {`tbl`} USING GIN ({`target`})\u0026quot;, .con = con)\rres \u0026lt;- DBI::dbSendQuery(con, query)\rDBI::dbClearResult(res)\r}\r\rCriando gatilho (trigger)\rA fun√ß√£o a seguir cria um gatilho para indexar novos documentos inseridos:\npsql_trigger \u0026lt;- function(con,tbl,config=\u0026quot;pt\u0026quot;){\ra\u0026lt;-\u0026quot;A\u0026quot;\rb\u0026lt;-\u0026quot;B\u0026quot;\rintro\u0026lt;-\u0026quot;new.intro\u0026quot;\rcorpo=\u0026quot;new.corpo\u0026quot;\rf_name\u0026lt;-paste0(tbl,\u0026quot;_trigger()\u0026quot;)\rq\u0026lt;-glue::glue_sql(\u0026quot;CREATE FUNCTION {DBI::SQL(f_name)} RETURNS trigger AS $$\rbegin\rnew.document_tokens :=\rsetweight(to_tsvector({config},coalesce({intro},\u0026#39;\u0026#39;)), {a}) ||\rsetweight(to_tsvector({config},coalesce({corpo},\u0026#39;\u0026#39;)), {b});\rreturn new;\rend\r$$ LANGUAGE plpgsql;\u0026quot;,.con=con)\rRPostgres::dbExecute(con,q)\rq \u0026lt;- glue::glue_sql(\u0026quot;\rCREATE TRIGGER tsvectorupdate BEFORE INSERT OR UPDATE\rON {`tbl`} FOR EACH ROW EXECUTE FUNCTION {DBI::SQL(f_name)}\u0026quot;,.con=con)\rRPostgres::dbExecute(con,q)\r}\r\rRealizando buscas\rPor fim, montamos a fun√ß√£o para realizar as buscas\npsql_query \u0026lt;-\rfunction (con,\rtbl,\rquery = \u0026quot;\u0026quot;)\r{\rtarget \u0026lt;- \u0026quot;document_tokens\u0026quot;\rq \u0026lt;-\rglue::glue_sql(\r\u0026quot;SELECT * FROM {`tbl`} WHERE {`tbl`}.{`target`} @@ websearch_to_tsquery(\u0026#39;pt\u0026#39;,{query})\u0026quot;,\r.con = con\r)\rDBI::dbGetQuery(con, q)\r}\r\r\rInclus√£o no aplicativo Shiny\rO reposit√≥rio FullTextSearch cont√©m template de aplicativo para realizar as buscas.\nInclu√≠ uma fun√ß√£o psql_g1_dt.R para criar um datatable htmlwidget com ajustes na apar√™ncia.\n\r","permalink":"https://blog.curso-r.com/posts/2020-04-18-fts/","tags":["sql","postgresql","text mining","tokenization"],"title":"Busca textual com R, Shiny e PostgreSQL"},{"author":["Caio"],"categories":["pacotes"],"contents":"\rSe voc√™ estiver interessado em web scraping, considere participar do nosso\rworkshop no dia 25/04/2020!\rL√° vou ensinar tudo sobre httr, xml2 e muito mais.\nSe voc√™ j√° trabalhou com\rweb scraping, ent√£o\rprovavelmente voc√™ j√° ouviu falar de tr√™s pacotes: httr, xml2 e rvest.\rTalvez voc√™ n√£o conhe√ßa ainda o xml2, mas o rvest foi por muito tempo o\rdivulgado como o principal pacote do R para raspagem de dados. A realidade,\rentretanto, √© que seu reinado acabou.\nComo este post √© voltado para pessoas que j√° t√™m um pouco de experi√™ncia com web\rscraping em R, n√£o vou me alongar em explicar o que cada fun√ß√£o do rvest faz.\rMeu objetivo aqui √© apresentar para o leitor as principais alternativas do\rxml2 (e do httr) para o rvest.\nO fim de uma era\rAcredite, eu digo isso com muito pesar, mas o rvest est√° morto. Ele pode ter\rsido muito √∫til em um passado distante, mas hoje em dia a nossa melhor op√ß√£o\rpara a raspagem de dados √© o bom e velho xml2.\nA realidade √© que o rvest nunca passou de um wrapper em torno do xml2 e do\rhttr; esta √© inclusive a sua descri√ß√£o oficial: Wrappers em torno dos pacotes\r‚Äòxml2‚Äô e ‚Äòhttr‚Äô para facilitar o download e a manipula√ß√£o de HTML e XML. Mas se\ro rvest est√° uma camada acima do xml2, ent√£o por que abandon√°-lo por essa\ralternativa mais ‚Äúr√∫stica‚Äù?\nO grande problema do rvest √© que ele foi majoritariamente abandonado. √â verdade\rque ele teve tr√™s novas atualiza√ß√µes em 2019, mas estas n√£o passaram de pequenos\rajustes. O √∫ltimo lan√ßamento relevante do rvest (a vers√£o 0.3.0) foi em 2015,\rpraticamente dois s√©culos atr√°s em anos da Internet.\nNestes √∫ltimos 4 anos e pouco, o xml2 continuou sendo atualizado e acabou se\rtornando t√£o simples de usar quanto o seu aparente sucessor. Por isso, na minha\ropini√£o, hoje em dia √© mais f√°cil aprender web scraping direto com o original.\n\rPequenas diferen√ßas\rA principal diferen√ßa entre os dois √© que o xml2 trabalha com XPath e n√£o\rseletores CSS. Na minha opini√£o, o XPath √© muito mais poderoso que os seletores,\rmas a verdade √© que trabalhar com ambos √© praticamente igual! Quando voc√™\restiver no seu navegador explorando a estrutura HTML de uma p√°gina a ser\rraspada, basta clicar com o bot√£o direito e copiar um ao inv√©s do outro.\rInclusive existem at√© alguns\rguias de convers√£o de\rum para o outro; o XPath √© naturalmente mais verborr√°gico, mas ele compensa com\ralgumas capacidades a mais.\nDepois que voc√™ tiver se acostumado com o XPath, basta entender qual √© o nome\rda nova fun√ß√£o a utilizar.\n\r\rrvest\rxml2/httr\r\r\r\rrvest::html_session()\rDesnecess√°rio com o httr\r\rrvest::follow_link()\rhttr::GET()\r\rrvest::read_html()\rxml2::read_html()\r\rrvest::html_nodes()\rxml2::xml_find_all()\r\rrvest::html_node()\rxml2::xml_find_first()\r\rrvest::html_text()\rxml2::xml_text()\r\rrvest::html_table()\r\r\rrvest::html_attr()\rxml2::xml_attr()\r\rrvest::html_children()\rxml2::xml_children()\r\r\rxml2::xml_parents()\r\r\rxml2::xml_contents()\r\r\rxml2::xml_siblings()\r\r\r\rComo fica claro acima, o xml2 possui praticamente todas as fun√ß√µes que o\rrvest possui e mais algumas. A grande vantagem de usar o primeiro √© precisar\rde uma depend√™ncia a menos: o rvest j√° importa o xml2, ent√£o porque n√£o\rfazer tudo direto em xml2?\nA √∫nica grande aus√™ncia do xml2 √© o html_table(), mas isso pode ser\rfacilmente corrigido com o c√≥digo abaixo:\n#\u0026#39; Parse an html table into a data frame\r#\u0026#39;\r#\u0026#39; @param x A node, node set or document.\r#\u0026#39; @param header Use first row as header? If NA, will use first row if it consists of th tags.\r#\u0026#39; @param trim Remove leading and trailing whitespace within each cell?\r#\u0026#39; @param fill If TRUE, automatically fill rows with fewer than the maximum number of columns with NAs.\r#\u0026#39; @param dec The character used as decimal mark.\r#\u0026#39;\r#\u0026#39; @export\rxml_table \u0026lt;- function(x, header = NA, trim = TRUE, fill = FALSE, dec = \u0026quot;.\u0026quot;) {\rif (\u0026quot;xml_nodeset\u0026quot; %in% class(x)) {\rreturn(lapply(x, xml_table, header = header, trim = trim, fill = fill, dec = dec))\r}\rstopifnot(xml2::xml_name(x) == \u0026quot;table\u0026quot;)\rrows \u0026lt;- xml2::xml_find_all(x, \u0026quot;.//tr\u0026quot;)\rn \u0026lt;- length(rows)\rcells \u0026lt;- lapply(rows, xml2::xml_find_all, xpath = \u0026quot;.//td|.//th\u0026quot;)\rncols \u0026lt;- lapply(cells, xml2::xml_attr, \u0026quot;colspan\u0026quot;, default = \u0026quot;1\u0026quot;)\rncols \u0026lt;- lapply(ncols, as.integer)\rnrows \u0026lt;- lapply(cells, xml2::xml_attr, \u0026quot;rowspan\u0026quot;, default = \u0026quot;1\u0026quot;)\rnrows \u0026lt;- lapply(nrows, as.integer)\rp \u0026lt;- unique(vapply(ncols, sum, integer(1)))\rmaxp \u0026lt;- max(p)\rif (length(p) \u0026gt; 1 \u0026amp; maxp * n != sum(unlist(nrows)) \u0026amp; maxp * n != sum(unlist(ncols))) {\rif (!fill) {\rstop(\u0026quot;Table has inconsistent number of columns. \u0026quot;, \u0026quot;Do you want fill = TRUE?\u0026quot;, call. = FALSE)\r}\r}\rvalues \u0026lt;- lapply(cells, xml2::xml_text, trim = trim)\rout \u0026lt;- matrix(NA_character_, nrow = n, ncol = maxp)\rfor (i in seq_len(n)) {\rrow \u0026lt;- values[[i]]\rncol \u0026lt;- ncols[[i]]\rcol \u0026lt;- 1\rfor (j in seq_len(length(ncol))) {\rout[i, col:(col + ncol[j] - 1)] \u0026lt;- row[[j]]\rcol \u0026lt;- col + ncol[j]\r}\r}\rfor (i in seq_len(maxp)) {\rfor (j in seq_len(n)) {\rrowspan \u0026lt;- nrows[[j]][i]\rcolspan \u0026lt;- ncols[[j]][i]\rif (!is.na(rowspan) \u0026amp; (rowspan \u0026gt; 1)) {\rif (!is.na(colspan) \u0026amp; (colspan \u0026gt; 1)) {\rnrows[[j]] \u0026lt;- c(\rutils::head(nrows[[j]], i),\rrep(rowspan, colspan - 1),\rutils::tail(nrows[[j]], length(rowspan) - (i + 1))\r)\rrowspan \u0026lt;- nrows[[j]][i]\r}\rfor (k in seq_len(rowspan - 1)) {\rl \u0026lt;- utils::head(out[j + k, ], i - 1)\rr \u0026lt;- utils::tail(out[j + k, ], maxp - i + 1)\rout[j + k, ] \u0026lt;- utils::head(c(l, out[j, i], r), maxp)\r}\r}\r}\r}\rif (is.na(header)) {\rheader \u0026lt;- all(xml2::xml_name(cells[[1]]) == \u0026quot;th\u0026quot;)\r}\rif (header) {\rcol_names \u0026lt;- out[1, , drop = FALSE]\rout \u0026lt;- out[-1, , drop = FALSE]\r} else {\rcol_names \u0026lt;- paste0(\u0026quot;X\u0026quot;, seq_len(ncol(out)))\r}\rdf \u0026lt;- lapply(seq_len(maxp), function(i) {\rutils::type.convert(out[, i], as.is = TRUE, dec = dec)\r})\rnames(df) \u0026lt;- col_names\rclass(df) \u0026lt;- \u0026quot;data.frame\u0026quot;\rattr(df, \u0026quot;row.names\u0026quot;) \u0026lt;- .set_row_names(length(df[[1]]))\rif (length(unique(col_names)) \u0026lt; length(col_names)) {\rwarning(\u0026quot;At least two columns have the same name\u0026quot;)\r}\rdf\r}\rApesar de ser uma fun√ß√£o bastante complicada, ela n√£o passa de uma c√≥pia do\rc√≥digo de rvest::html_table() utilizando apesar fun√ß√µes do xml2; com isso\rvoc√™ ter√° a sua pr√≥pria implementa√ß√£o de xml_table(). E depois de uma ou duas\rsemanas, voc√™ j√° estar√° pronto para abandonar o rvest e voltar a usar o bom e\rvelho xml2!\n\rQuer saber mais?\rPara mais informa√ß√µes sobre este e outros assuntos do mundo R, siga a Curso-R\rno GitHub, no\rFacebook e no\rTwitter. Al√©m disso, participe da nossa\rcomunidade no Discord e do nosso canal no\rTelegram onde compartilhamos as novidades mais quentes\rdo R e respondemos as suas perguntas pessoalmente.\n\r","permalink":"https://blog.curso-r.com/posts/2020-04-09-xml2/","tags":["xml2","rvest"],"title":"Abaixo ao rvest!"},{"author":["Daniel"],"categories":["divulga√ß√£o"],"contents":"\r\rLan√ßamos a Comunidade Curso-R!\nEste f√≥rum foi criado para qualquer um tenha interesse em aprender, compartilhar conhecimento e discutir assuntos relacionados √† linguagem R e assuntos correlacionados.\nAqui voc√™ pode tirar suas d√∫vidas, responder d√∫vidas de outras pessoas, compartilhar links interessantes, iniciar discuss√µes relevantes para a comunidade, divulgar eventos e at√© mesmo divulgar vagas de emprego - desde que sempre respeite o nosso c√≥digo de conduta.\nAqui tamb√©m √© o lugar que alunos e ex-alunos da Curso-R usam para tirar d√∫vidas com os nossos professores, fazendo com que nossos cursos permane√ßam o mais abertos poss√≠vel.\nCadastrem-se aqui e sejam bem vindos!\nNota: o banner deste post tamb√©m √© uma arte da Allison Horst\nArte da Allison Horst.\n","permalink":"https://blog.curso-r.com/posts/2020-02-21-discourse/","tags":["comunidade"],"title":"Anunciando a comunidade Curso-R"},{"author":["Daniel"],"categories":["pacotes"],"contents":"\r\rO gghighlight √© uma das extens√µes do ggplot2 que eu mais gosto. Este post serve como uma pequena introdu√ß√£o √© apresenta√ß√£o do que √© poss√≠vel fazer com ele.\nComo pr√≥prio nome indica, o gghighlight serve para real√ßar partes de um gr√°fico feito com o ggplot.\nReal√ßando pontos\rMuitas vezes temos um gr√°fico de dispers√£o em que queremos real√ßar alguns pontos\rde acordo com alguma caracter√≠stica. Por exemplo, abaixo estamos real√ßando os pontos que possuem carat \u0026gt; 4, al√©m disso colocamos uma label em cada um.\nlibrary(tidyverse)\r## ‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 1.3.0 ‚îÄ‚îÄ\r## ‚úì ggplot2 3.3.2 ‚úì purrr 0.3.4\r## ‚úì tibble 3.0.4 ‚úì dplyr 1.0.2\r## ‚úì tidyr 1.1.2 ‚úì stringr 1.4.0\r## ‚úì readr 1.4.0 ‚úì forcats 0.5.0\r## ‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ\r## x dplyr::filter() masks stats::filter()\r## x dplyr::lag() masks stats::lag()\rdiamonds %\u0026gt;% ggplot(aes(x = carat, y = price)) +\rgeom_point() +\rgghighlight::gghighlight(carat \u0026gt; 4, label_key = carat)\rTamb√©m √© poss√≠vel configurar a cor dos pontos que ser√£o real√ßados e dos que n√£o ser√£o, bem como o estilo dos labels.\ndiamonds %\u0026gt;% ggplot(aes(x = carat, y = price)) +\rgeom_point(color = \u0026quot;red\u0026quot;) +\rgghighlight::gghighlight(\rcarat \u0026gt; 4, label_key = carat, unhighlighted_colour = \u0026quot;black\u0026quot;,\rlabel_params = list(size = 10, fill = \u0026quot;grey\u0026quot;)\r)\r## Warning: The `unhighlighted_colour` argument of `gghighlight()` is deprecated as of gghighlight 0.2.0.\r## Please use the `unhighlighted_params` argument instead.\r## This warning is displayed once every 8 hours.\r## Call `lifecycle::last_warnings()` to see where this warning was generated.\r\rReal√ßando linhas\rCom o gghighlight tamb√©m √© poss√≠vel real√ßar linhas em um gr√°fico que possui varias linhas. Isso √© interessante quando voc√™ quer ver como uma s√©rie temporal se compara com rela√ß√£o √† um conjunto de outras s√©ries.\nd \u0026lt;- cranlogs::cran_downloads(\rpackages = tidyverse::tidyverse_deps()$package,\rfrom = \u0026quot;2019-01-01\u0026quot;, to = \u0026quot;2019-12-31\u0026quot;\r)\rNo gr√°fico a seguir mostramos o n√∫mero de downloads de cada um dos pacotes do\rtidyverse no ano de 2019. Uma das s√©ries se destaca por mudar de padr√£o no meio\rdo ano. Usamos o gghighlight para destac√°-la no gr√°fico.\nd %\u0026gt;% ggplot(aes(x = date, y = count, group = package)) +\rgeom_line() +\rgghighlight::gghighlight(max(count) \u0026gt; 100000)\r## label_key: package\r√â isso a√≠! Esse pacote existe e √© muito √∫til! A documenta√ß√£o √© bem boa tamb√©m.\n\r","permalink":"https://blog.curso-r.com/posts/2020-02-20-gghighlight/","tags":["ggplot2"],"title":"gghighlight"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rNesta s√©rie de posts, apresentamos a todos a nossa primeira tentativa de\rescrever um livro: O Zen do R! Durante\ralgumas semanas de 2019, todas as quartas, trouxemos para o nosso blog os\rcap√≠tulos do livro e respondemos qualquer pergunta sobre o conte√∫do.\nDepois de algum tempo na geladeira, voltamos a escrever! Vamos falar sobre como\rmanter as vers√µes de um pacote sobre controle.\nVers√µes\rA maior parte dos softwares que utilizamos no dia-a-dia possuem vers√µes, at√©\rmesmo aqueles que n√£o costumamos associar com esse tipo de pr√°tica. Sistemas\roperacionais, como Windows 10 e iOS 13 , t√™m as vers√µes embutidas em seus\rpr√≥prios nomes, enquanto muitos aplicativos, como WhatsApp 2.20.22, s√≥ exibem\resse tipo de informa√ß√£o no fundo da p√°gina de configura√ß√µes.\nPacotes do R tamb√©m possuem vers√µes. Ao executar o comando update.packages()\r(inclusive fa√ßa isso agora caso voc√™ nunca o tenha feito), o R √© for√ßado a\rprocurar por ves√µes mais recentes dos pacotes instalados na sua m√°quina. √â\rimportante deixar claro que ‚Äúvers√£o‚Äù n√£o √© nada mais que o identificador de uma\ratualiza√ß√£o do software; se eu mudar uma linha do c√≥digo do meu pacote e\ratualizar esse fonte no GitHub, pode-se dizer que criei uma nova vers√£o do meu\rpacote.\nMas por que marcar e dar nomes a essas atualiza√ß√µes? √â bastante mais f√°cil\rsimplesmente continuar programando e exigir que seus usu√°rios baixem a vers√£o\rmais recente do seu c√≥digo. Essa pr√°tica, entretanto, √© ruim para o usu√°rio e\rpara o programador.\nVoc√™, como programador, quer poder fazer altera√ß√µes no seu c√≥digo que n√£o\rnecessariamente est√£o prontas para o p√∫blico em geral. Erros acontecem e, muitas\rvezes, √© preciso fazer uma s√©rie de modifica√ß√µes antes que o pacote volte a ter\rcerta estabilidade. Por outro lado, o usu√°rio tamb√©m s√≥ quer atualizar seu\rpacote quando algo suficientemente diferente estiver dispon√≠vel (sejam corre√ß√µes\rde erros, sejam novas funcionalidades). Al√©m disso, caso uma nova vers√£o do seu\rc√≥digo gere problemas para ele, √© necess√°rio ter uma vers√£o est√°vel anterior\rclaramente rotulada para que o usu√°rio possa fazer o downgrade do pacote.\nE justamente s√£o esses r√≥tulos que precisamos utilizar para ter um bom sistema\rde vers√µes nos nossos pacotes. Ao contr√°rio de ‚Äúcontrole de vers√£o‚Äù, para o qual\rutilizamos o Git, ‚Äúversionamento sem√¢ntico‚Äù √© a pr√°tica de dar nomes f√°ceis de\rentender para as vers√µes de um projeto. Trazendo isso para termos concretos, o\rpacote dplyr est√° na vers√£o 0.8.4, o ggplot2 est√° na 3.2.1 e o shiny\rest√° na 1.4.0.\nVersionamento sem√¢ntico\rEm teoria, existe um padr√£o ouro para a nomenclatura de\rvers√µes de um software. Alguns dos seus preceitos, como o uso de 3 n√∫meros\rinteiros n√£o-negativos separados por pontos, s√£o extremamente valiosos, enquanto\routros nem sempre s√£o seguidos ao p√© da letra. Aqui tratamos do protocolo\rpadronizado, mas apenas voc√™ pode determinar quanto dele o seu esquema de\rnomenclatura seguir√°.\nUma vers√£o √© denotada pela forma X.Y.Z, onde:\r- X √© a vers√£o maior (denominada major);\r- Y √© a vers√£o menor (denominada minor) e\r- Z √© a vers√£o do conserto (denominada patch).\nUm patch n√£o passa de uma vers√£o atualizada na qual apenas bugs foram\rcorrigidos; nenhuma funcionalidade pode ser alterada e qualquer c√≥digo escrito\rutilizando a vers√£o sem o patch deve continuar funcionando. Quando alguma nova\rfuncionalidade √© introduzida ao programa, mas ele continua sendo\rretrocompat√≠vel (ou seja, compat√≠vel com as suas vers√µes anteriores), deve ser\rincrementada a vers√£o minor. Por fim, se for introduzida alguma mudan√ßa que\rquebra a retrocompatibilidade, deve ser increvementada a vers√£o major. √â\rimportante dizer tamb√©m que, depois de lan√ßada, uma vers√£o nunca dever√° ser\ralterada, pois isso confundir√° os usu√°rios da mesma.\nAlguns pontos do versionamento sem√¢ntico n√£o s√£o seguidos sempre, mas podem ser\r√∫teis. Por exemplo, o patch pode ser omitido se ele for 0, a major 0 normalmente\r√© reservada para software em fase de testes (o dplyr, portanto, n√£o segue essa\rregra) e √†s vezes sufixos em texto podem ser adicionados (como ‚Äú-alpha‚Äù,\r‚Äú-beta‚Äù, etc.).\nPara prop√≥sitos ilustrativos, imaginemos um pacote chamado pacotr que possui\rapenas uma fun√ß√£o com prot√≥tipo f(x, y, z = TRUE). Um caminho imagin√°rio para\rseu desenvolvimento pode ser o seguinte:\r- Vers√£o 0.1.0: a primeira vers√£o com c√≥digo do pacote cont√©m uma fun√ß√£o\rf(x, y);\r- Vers√£o 0.1.1: um bug √© consertado em f(x, y);\r- Vers√£o 0.1.2: mais um bug √© consertado em f(x, y);\r- Vers√£o 1.0.0: o pacote sai do beta quando a fun√ß√£o ganha um novo argumento\rz, agora necess√°rio para o seu funcionamento, e vira f(x, y, z);\r- Vers√£o 1.0.1: um bug √© consertado em f(x, y, z);\r- Vers√£o 1.2.0: o argumento z agora tem um valor padr√£o, transformando a\rfun√ß√£o em f(x, y, z = FALSE);\r- Vers√£o 2.0.0: o argumento z muda seu valor padr√£o, quebrando qualquer c√≥digo\rescrito utilizando a vers√£o 1.x.x, se tornando f(x, y, z = TRUE)\nUtilizando o exemplo acima sem perda de generalidade, entre qualquer dois passos\rsubsequentes haveriam vers√µes denominadas de desenvolvimento, como por exemplo\r0.1.1.9000, 1.0.0.9000 e assim por diante. Isso n√£o est√° no padr√£o ouro do\rversionamento sem√¢ntico, mas √© comumente utilizado em programas de R.\nUma vers√£o de desenvolvimento √© qualquer ‚Äúsubvers√£o‚Äù que n√£o deveria ser\rutilizada pelo usu√°rio final; qualquer commit entre patches, minors ou majors √©\ruma vers√£o de desenvolvimento. Por conven√ß√£o, a primeira vers√£o de\rdesenvolvimento √© marcada como 9000, podendo chegar at√© 9999. Alguns\rprogramadores incrementam esse n√∫mero a cada commit realizado, mas √© mais comum\rmanter o 9000 at√© que o c√≥digo esteja pronto para se tornar um verdadeiro patch,\rminor ou major.\nNa pr√°tica, √© muito simples trabalhar com vers√µes. Assim que um novo pacote √©\rcriado atrav√©s de usethis::create_package(), o arquivo DESCRIPTION tem a\rseguinte cara:\nPackage: demo\rTitle: What the Package Does (One Line, Title Case)\rVersion: 0.0.0.9000\rAuthors@R: person(given = \u0026quot;First\u0026quot;,\rfamily = \u0026quot;Last\u0026quot;,\rrole = c(\u0026quot;aut\u0026quot;, \u0026quot;cre\u0026quot;),\remail = \u0026quot;first.last@example.com\u0026quot;,\rcomment = c(ORCID = \u0026quot;YOUR-ORCID-ID\u0026quot;))\rDescription: What the package does (one paragraph).\rLicense: What license it uses\rEncoding: UTF-8\rLazyData: true\rNote como o campo Version j√° est√° populado com a primeira vers√£o poss√≠vel para\rum pacote: 0.0.0.9000. Depois de alguns commits, se acharmos que o c√≥digo est√°\rpreparado para a primeira minor, utilizamos:\nusethis::use_version(\u0026quot;minor\u0026quot;)\r#\u0026gt; ‚úî Setting Version field in DESCRIPTION to \u0026#39;0.1.0\u0026#39;\rA segunda linha j√° deixa claro que agora o arquivo DESCRIPTION cont√©m uma\rlinha Version: 0.1.0 (note como a vers√£o de desenvolvimento √© removida\rautomaticamente). Mas aten√ß√£o, antes de fazer qualquer outra altera√ß√£o no\rpacote, voc√™ deve se certificar de que esta altera√ß√£o receber√° um commit s√≥ para\rela. Atualmente o usethis faz isso automaticamente.\nO primeiro commit ap√≥s a altera√ß√£o da vers√£o deve trazer o pacote de volta\rpara o estado de desenvolvimento. Ou seja, deve existir um √∫nico commit no qual\ro pacote √© considerado est√°vel para cada sequ√™ncia de commits de\rdesenvolvimento.\nusethis::use_dev_version()\r#\u0026gt; ‚úî Setting Version field in DESCRIPTION to \u0026#39;0.1.0.9000\u0026#39;\rDepois que o pacote voltar para desenvolvimento, a programa√ß√£o pode continuar\rdesempedida. Por completude, usethis::use_version() pode ser utilizada para\rqualquer vers√£o cheia:\nusethis::use_version(\u0026quot;patch\u0026quot;)\r#\u0026gt; ‚úî Setting Version field in DESCRIPTION to \u0026#39;0.1.1\u0026#39;\rusethis::use_dev_version()\r#\u0026gt; ‚úî Setting Version field in DESCRIPTION to \u0026#39;0.1.1.9000\u0026#39;\rusethis::use_version(\u0026quot;major\u0026quot;)\r#\u0026gt; ‚úî Setting Version field in DESCRIPTION to \u0026#39;1.0.0\u0026#39;\r\rReleases\rUma parte interessante do processo de versionamento √© que o GitHub permite\rmarcar commits espec√≠ficos como est√°veis e atribuir um r√≥tulo aos mesmos. No\rfundo isso n√£o passa de um versionamento sem√¢ntico integrado ao site.\nComo exemplo, podemos ver a aba ‚ÄúReleases‚Äù do pacote decryptr:\n√â bom fazer esse tipo de versionamento externo porque os usu√°rios passam a ter\rum lugar de f√°cil acesso com o c√≥digo-fonte de absolutamente todas as vers√µes do\rseu pacote. Al√©m disso, a fun√ß√£o devtools::install_github() √© capaz de\rutilizar esses releases como indicador de qual vers√£o de um pacote deve ser\rbaixada.\nPara criar releases de um pacote seu, antes voc√™ deve dar push no commit da\rvers√£o atual (depois de usethis::use_version() e antes de\rusethis::use_dev_version()), pois assim estar√° p√∫blica no GitHub exatamente a\rvers√£o do seu pacote que deve ser baixada pelos usu√°rios. Depois basta ir para\ra aba das releases e clicar em Draft a new release. Preencha os campos\rcorrespondentes e publique a vers√£o.\nUma forma eficiente de manter todas as altera√ß√µes realizadas no pacote de forma\rorganizada √© com um arquivo NEWS. Ele pode ser criado com\rusethis::use_news_md() e criar um novo t√≠tulo para cada vers√£o. Observe como\resse arquivo √©\rutilizado no ggplot2.\n\r\r","permalink":"https://blog.curso-r.com/posts/2020-02-21-zen-do-r-8/","tags":["Zen do R"],"title":"Vers√µes e Releases (Zen do R parte 8)"},{"author":["Caio"],"categories":["an√°lises"],"contents":"\r\rUma Bela Heran√ßa\rO motivador da discuss√£o deste post √© meio estranho: em 17 de dezembro de 2020\rser√£o comemorados 250 anos desde o nascimento do grande compositor alem√£o Ludwig\rvan Beethoven. N√£o √© incomum ver pessoas abrindo poupan√ßas para seus filhos logo\rquando nascem (para que eles tenham um p√©-de-meia quando crescerem) e isso me\rfez pensar como ficaria uma poupa√ßa aberta para Beethoven 250 anos atr√°s‚Ä¶\nSendo assim, em pleno 2020, uma carta chega √† casa do √∫ltimo herdeiro vivo do\rm√∫sico, voc√™, lhe dando acesso √† rec√©m-descoberta poupan√ßa do seu\rtatara-tatarav√¥. Como poderia existir uma poupan√ßa em 17 de dezembro de 1770 ou\rcomo ela durou at√© hoje √© um mist√©rio, mas sabe-se que ela foi aberta com o que\ratualmente seriam R$ 500,00.\n\rVisualizando a Poupan√ßa\rPara saber quanto dinheiro h√° hoje na poupan√ßa, basta utilizar a f√≥rmula de\rjuros compostos:\n\\[\rV_f=V_p(1+j)^n\r\\]\nOnde \\(V_f\\) √© o valor final, \\(V_p\\) √© o valor inicial, \\(j\\) √© a taxa de juros e \\(n\\)\r√© o n√∫mero de per√≠odos que o dinheiro ficou guardado (n√∫mero de anos se os juros\rforem anuais, n√∫mero de meses se os juros forem mensais, etc.).\nMas, muito mais do que simplesmente obter o valor final, √© interessante ver o\rcrescimento dos fundos da poupan√ßa ao longo do tempo. Isso pode ser feito com o\rpacote ggplot2 facilmente: basta utilizar a f√≥rmula acima para cada um dos 250\ranos e plotar esses pontos em um scatterplot. Entretanto, temos uma op√ß√£o\rainda melhor.\nUm recurso pouco conhecido do ggplot2 √© o stat_function(), capaz de\rconstruir uma linha cont√≠nua no gr√°fico a partir de uma fun√ß√£o que recebe o\rvalor de uma abscissa e retorna o valor da ordenada correspondente. Ou seja, se\rtivermos uma fun√ß√£o f(x) = y, podemos pass√°-la como argumento para o\rstat_function() desenh√°-la (com o n√≠vel de resolu√ß√£o mais apropriado).\nSendo assim, precisamos transformar a fun√ß√£o\rtern√°ria Vp*(1+j)**n em uma fun√ß√£o\rque recebe apenas um argumento. Para isso devemos usar uma t√©cnica denominada\rcurrying, que essencialmente\r‚Äúpr√©-preenche‚Äù argumentos de uma fun√ß√£o; nesse caso, vamos fixar o valor de Vp\re j de modo que somente o n varie. A fun√ß√£o un√°ria final, que podemos\rconstruir com purrr::partial(), nos mostrar√° quanto tinha na poupan√ßa depois\rde n unidades de tempo (a saber, anos).\nO c√≥digo final para a visualiza√ß√£o √© o seguinte:\nlibrary(magrittr)\r# F√≥rmula de juros compostos\rjuro_composto \u0026lt;- function(Vp, j, n) Vp*(1+j)**n\r# Gerar um gr√°fico de juros compostos\rgrafico_juros \u0026lt;- function(Vp, j, n, SI = TRUE) {\r# Atalho para o ggplot (currying)\rjuro_fixado \u0026lt;- purrr::partial(juro_composto, Vp = Vp, j = j)\r# Exibir eixos de forma abreviada\rscale_real \u0026lt;- if (SI) { scales::label_number_si(prefix = \u0026quot;R$ \u0026quot;) } else { I }\r# Mostrar no gr√°fico\rc(0, n) %\u0026gt;%\rdplyr::tibble(x = .) %\u0026gt;%\rggplot2::ggplot(ggplot2::aes(x)) +\rggplot2::stat_function(fun = juro_fixado) +\rggplot2::scale_y_continuous(labels = scale_real) +\rggplot2::xlab(\u0026quot;Anos\u0026quot;) +\rggplot2::ylab(\u0026quot;Valor Final\u0026quot;) +\rggplot2::theme_minimal()\r}\rAgora vamos para os detalhes da poupan√ßa. Para desconsiderarmos a infla√ß√£o,\rdigamos que a poupan√ßa come√ßou com o que nos valores de hoje seriam R$ 500,00;\ruma poupan√ßa rende, em m√©dia, m√≥dicos 6% ao ano, ent√£o vamos usar isso como\rrefer√™ncia; por fim, o dinheiro ficou parado l√° por 250 anos. Quanto voc√™ acha\rque ter√° na conta agora em 2020?\ngrafico_juros(500, 0.06, 250)\rComo √© de se esperar, juros compostos s√£o uma fun√ß√£o exponencial. Depois desses\r250 anos, os R$ 500,00 se tornaram mais de\rR$ 1B. Nada mal para uma mera poupan√ßa.\n\rB√¥nus\rAproveitando que j√° temos todo o c√≥digo pronto, podemos visualizar outras s√©ries\rexponenciais. Se coloc√°ssemos 1 centavo na poupan√ßa no ano 1 D.C., hoje em dia\rter√≠amos aproximadamente R$ 1.311740210^{49}, ou mais ou menos\rR$ 0,10 para cada √°tomo da Terra. Essa √© a m√°gica dos juros compostos.\ngrafico_juros(0.01, 0.06, 2020, FALSE)\rUma propriedade interessante de frases como ‚Äúcrescimento de 3%‚Äù √© que raramente\rnotamos que essa porcentagem se acumuma ano-a-ano. Um pa√≠s cujo PIB cresce 3% ao\rano tem que dobrar a sua economia a cada 25 anos. Atualmente o PIB do Brasil\r√© de R$ 7T, vejamos o gr√°fico de nossa economia crescendo a 3% todo ano:\ngrafico_juros(7e12, 0.03, 25)\rIsso pode n√£o impressionar muito, mas, se come√ß√°rmos a falar em escalas globais,\ra coisa muda de figura. Os EUA t√™m um PIB de US$ 17T, enquanto a soma de todos\ros PIBs do mundo d√° aproximadamente US$ 80T; se a economia estadunidense\rcrescesse a 3% pelos pr√≥ximos 100 anos, precisar√≠amos de mais de 4 PIBs mundiais\rpara chegar perto desse novo PIB dos EUA.\ngrafico_juros(17e12, 0.03, 100)\rUma coisa que n√£o cresce exponencialmente, entretanto, √© a quantidade de\rrecursos dispon√≠veis na natureza‚Ä¶\n\r","permalink":"https://blog.curso-r.com/posts/2020-02-20-poupanca-beethoven/","tags":["ggplot2","finan√ßas"],"title":"A Poupan√ßa de Beethoven"},{"author":["Caio"],"categories":["an√°lises"],"contents":"\r\rEu Tenho um Problema\rEsse problema se chama fake news. N√£o importa a fonte, a inclina√ß√£o\rideol√≥gica, o estilo ou o grau da mentira; eu preciso me segurar muito\rpara n√£o passar a tarde toda desmascarando as not√≠cias falsas\r(antigamente conhecidas simplesmente como mentiras) que chegam no meu\rWhatsApp diariamente. Eu n√£o ligo tanto para an√°lises mal feitas ou\rmesmo tendenciosas (j√° que na minha opini√£o isso faz parte de viver em\rsociedade), mas quando o conte√∫do parece deliberadamente montado para\rludibriar o leitor eu perco o controle.\nNormalmente eu ignoro a mensagem/foto/montagem e sigo com o meu dia, mas\rh√° ocasi√µes raras em que o n√≠vel da mentira √© grande o bastante e eu\restou com a agenda livre o suficiente, que corro para o computador\rcom o √∫nico objetivo de desmentir a fake news. Geralmente em menos de\rmeia hora j√° tenho uma resposta pronta com dados confi√°veis, uma imagem\rsem Photoshop ou simplesmente um link para um site de fact-checking.\rMas ontem aconteceu algo in√©dito: a mentira lutou contra mim.\n\rA ‚ÄúNot√≠cia‚Äù\rA ‚Äúnot√≠cia‚Äù falsa em quest√£o √© na verdade uma imagem. Uma imagem\ralterada, por sinal.\nVamos por partes. Meu espanhol n√£o √© dos melhores, mas acho que qualquer\rlus√≥fono consegue compreender bem o que est√° sendo mostrado: o gr√°fico\rrepresenta a posi√ß√£o de dois pa√≠ses no ranking de PIB per capita. Al√©m\rdisso, destacam-se o per√≠odo de 1882 a 1950 (quando a Argentina nunca\rficou abaixo do 10¬∫ maior PIB per capita), o per√≠odo entre 1895 e 1896\r(quando a Argentina estava em 1¬∫ lugar) e o ranking atual dos nossos\rvizinhos (59¬∫ lugar).\nDe acordo com o que me parece ser a imagem\roriginal, nesta\rvers√£o da not√≠cia ganhamos de brinde tamb√©m uma pequena interven√ß√£o\r‚Äúart√≠stica‚Äù na forma de duas figuras da pol√≠tica Argentina: Juan\rBautista Alberdi\r(um dos principais respons√°veis pela primeira Constitui√ß√£o argentina) e\rJuan Domingo\rPer√≥n (tr√™s\rvezes presidente da Argentina). O texto que acompanha a foto de Per√≥n\rnos ‚Äúinforma‚Äù sobre a Constitui√ß√£o\rde 1949,\rquando o governo peronista reforma a Carta Magna e aparentemente d√°\rin√≠cio √† ‚Äújusti√ßa social‚Äù.\nO que esta imagem parece estar sugerindo √© que Per√≥n √© o grande culpado\rpela queda da Argentina no ranking do PIB per capita. A compara√ß√£o com a\rAustr√°lia (que evidentemente n√£o teve nenhum governo peronista) refor√ßa\ressa ideia porque ela permaneceu aproximadamente na camada superior do\rgr√°fico. Implicitamente, o leitor parece ser encorajado a equivaler PIB\rper capita com desenvolvimento econ√¥mico ou qualidade de vida.\nMas, como dito anteriormente, esta imagem n√£o √© uma fake news\rqualquer: para desment√≠-la ser√° necess√°rio explorar algumas camadas da\rnarrativa sendo tra√ßada.\n\rOs Dados N√£o Mentem‚Ä¶\rDiferentemente da maior parte das fake news, esta possui uma fonte. Os\rdados foram retirados do Maddison\rProject,\rum projeto acad√™mico da Universidade de Groningen cujo objetivo √©\restimar o valor de certas estat√≠sticas econ√¥micas para o passado\rlong√≠nquo (mais sobre isso em breve).\nSendo assim, acessei o site do projeto e coletei os dados. Eles n√£o\rpassam de uma planilha Excel com um pa√≠s por coluna e um ano por linha,\rcom cada c√©lula contendo o PIB per capita daquele pa√≠s naquele ano em\rd√≥lares constantes de 2011.\nUsando o ggplot2 podemos reproduzir a imagem com facilidade:\nQuando vi o gr√°fico, fiquei boquiaberto. Uma imagem em baixa resolu√ß√£o,\rcom Photoshop mal feito, linguagem tendenciosa e veiculada via WhatsApp\rparecia n√£o estar errada. Analisando o ranking da Argentina em 2016, o\rpa√≠s de fato estava na 62¬™ posi√ß√£o e n√£o na 59¬™, mas isso est√° longe de\rdesqualificar um argumento.\n\r‚Ä¶Mas Podem Enganar\rMesmo estando tecnicamente certo, um gr√°fico n√£o necessariamente\rest√° correto. A pr√≥xima visualiza√ß√£o que fiz pretendia explorar n√£o o ranking\rdos pa√≠ses, mas os seus PIBs per capita diretamente; isso √© relevante\rporque a suposta alega√ß√£o do gr√°fico diz respeito √† economia da\rArgentina e n√£o sobre ela em rela√ß√£o √†s de todos os outros pa√≠ses.\nO que me chamou a aten√ß√£o no gr√°fico acima foi que os PIBs per capita da\rArgentina e da Austr√°lia parecem estar se descolando consistentemente\rdesde 1905. Por que ent√£o o descolamento dos rankings s√≥ ocorre ap√≥s\r1950?\n\rContexto Importa‚Ä¶\rDepois de mexer mais no gr√°fico dos valores, notei que a grande maioria\rdos pa√≠ses da tabela n√£o tinham nenhum dado para antes de 1950. Isso me\rfez procurar outras fontes para dados do PIB, mas n√£o encontrei nada que\rcontemplasse um per√≠odo t√£o grande quanto o do projeto Maddison. Sendo\rassim, fui saber mais sobre o conceito de Produto Interno Bruto.\nEm primeiro lugar, descobri que a defini√ß√£o\rmoderna de PIB s√≥\rexiste desde 1934 e que ele s√≥ come√ßou a ser utilizado para medir a\reconomia dos pa√≠ses a partir de 1944.\nE agora entra em jogo o que de fato √© o projeto Maddison. J√° comentei\rque ele estima alguns √≠ndices socioecon√¥micos para o passado, mas n√£o\rfalei sobre um detalhe vital que s√≥ descobri depois: o projeto estima\resses dados somente para um conjunto limitado de pa√≠ses! Ou seja, antes\rde meados da d√©cada de 1950, s√≥ temos acesso √† informa√ß√£o de um grupo\rseleto de na√ß√µes.\nVoltando para a base, percebi que isso explicava a quantidade de pa√≠ses\rcom linhas vazias antes de 1950, pois apenas 28 na√ß√µes possu√≠am\restimativas para o PIB per capita a desde 1875. √â muito diferente dizer\rque a Argentina tinha o maior PIB per capita do mundo em 1895 e dizer\rque ela tinha o maior PIB per capita (estimado) entre 28 pa√≠ses\rselecionados. Abaixo √© poss√≠vel ver o ranking at√© 2016 se filtrarmos\rapenas os 28 pa√≠ses iniciais:\nFiz quest√£o de manter a escala deste gr√°fico igual √† do anterior porque\rassim fica f√°cil de ver o problema com a visualiza√ß√£o da ‚Äúnot√≠cia‚Äù. De\rfato a Argentina perdeu posi√ß√µes no ranking, isso √© indiscut√≠vel, mas √©\rmuito diferente perder algo em torno de 10 posi√ß√µes em 50 anos e perder\r50 posi√ß√µes no mesmo per√≠odo.\nPara entender ainda melhor o que a imagem original est√° escondendo,\rbasta exibir no gr√°fico os dados de todos os pa√≠ses contemplados\rpela base.\nNote como a quantidade de pa√≠ses presentes na tabela cresce\rsignificativamente depois do in√≠cio da d√©cada de 1950 dado que a m√©trica\rfoi colocada em vigor apenas 6 anos antes. Sendo assim, √© de se esperar\rque a Argentina e at√© a Austr√°lia percam posi√ß√µes no ranking. No fundo,\restamos visualizando uma base para antes de 1950 (as estimativas do\rprojeto Maddison) e uma para depois (as estat√≠sticas reais coletadas\rpela comunidade internacional).\nMais interessante ainda do que tentar visualizar todos os pa√≠ses em um\rmesmo gr√°fico, √© poss√≠vel utilizar a fun√ß√£o dplyr::percent_rank() que,\rao inv√©s de atribuir n√∫meros naturais como ranking, retorna o ranking\rdividido pelo total de elementos na compara√ß√£o.\nAqui fica claro que, mesmo depois de piorar muito no ranking do PIB per\rcapita, a Argentina ainda n√£o est√° t√£o ruim quanto estava no in√≠cio dos\ranos 1880 (em rela√ß√£o a todos os pa√≠ses dispon√≠veis para cada ano).\rConclus√£o muito diferente da sugerida pela imagem original.\n\r‚Ä¶E Hist√≥ria Tamb√©m\rA √∫ltima camada dessa fake news √© um pouco mais sutil e n√£o pode ser\ridentificada olhando somente para os dados. Na verdade, s√≥ fiquei\rsabendo disso enquanto pesquisava mais sobre a hist√≥ria da Argentina na\rWikip√©dia.\nSem querer entrar na discuss√£o ‚Äúperonistas vs.¬†antiperonistas‚Äù, mas\rnossos vizinhos possuem uma heran√ßa muito forte dos tr√™s governos de\rPer√≥n e a sociedade √© fortemente dividida entre aqueles que apoiam seu\rlegado e aqueles que o rejeitam (de forma similar ao nosso sentimento em\rrela√ß√£o a Vargas, mas certamente mais relevante para a pol√≠tica\rcontempor√¢nea).\nA imagem √© claramente montada para manchar o legado de Per√≥n e, para\risso, destaca a data na qual ele reformou a Constitui√ß√£o argentina. A\radi√ß√£o das fotos e do texto posteriormente em Photoshop √© o que mais faz\rsoar meu alarme de not√≠cia falsa.\nO que aprendi sobre a hist√≥ria argentina, entretanto, parece colocar em\rcheque a ideia de que teria sido a Constitui√ß√£o peronista que derrubou a\rArgentina no ranking dos PIBs per capita: Per√≥n foi deposto por um golpe\rmilitar em 1955 e no ano seguinte foi publicada uma nova Constitui√ß√£o que\ranulava a anterior. A Constitui√ß√£o de 1956 declarava ‚Äúvigente la\rConstituci√≥n Nacional sancionada en 1853, con las reformas de 1860, 1866\ry 1898, y exclusi√≥n de la de 1949‚Äù.\nAgora acho importante fazer uma visualiza√ß√£o final, destacando a\rvig√™ncia da Constitui√ß√£o que deu in√≠cio √† ‚Äújusti√ßa social‚Äù:\nSugiro que os autores da imagem original fa√ßam a mesma montagem com o\rgr√°fico acima.\n\r","permalink":"https://blog.curso-r.com/posts/2020-01-21-fake-news/","tags":["fake news"],"title":"Camadas de Fake News"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\rA base de dados de CNPJ da Receita Federal do Brasil (RFB) √©, na minha opini√£o, uma das maiores conquistas de dados abertos do Brasil. Trata-se de uma base com quase 42 milh√µes de linhas repleta de informa√ß√µes de todas as empresas do Brasil. Essa base pode ser √∫til para desenvolver diversos tipos de produtos e servi√ßos, bem como abre espa√ßo para realiza√ß√£od e estudos para pol√≠ticas p√∫blicas.\nA base de dados da RFB pode ser obtida de duas fontes distintas:\nO fant√°stico canal Brasil.io, do √Ålvaro Justen, ou turicas.\rDiretamente do site da RFB.\r\rLendo os dados em csv\rPara carregar a partir de (1), tamb√©m √© bem tranquilo. O Turicas gentilmente disponibilizou as bases em CSV, facilitando a leitura em qualquer software de an√°lise de dados.\nPor exemplo, podemos fazer a leitura usando o {vroom}:\nsocio \u0026lt;- vroom::vroom(\u0026quot;~/Downloads/rfb/socio.csv.gz\u0026quot;)\rsocio\rObservations: 26,188,771 Variables: 10\rchr [7]: cnpj, nome_socio, cnpj_cpf_do_socio, codigo_qualificacao_socio, cpf_representante_legal, nome_representante_legal, codigo_qualificacao_r...\rdbl [2]: identificador_de_socio, percentual_capital_social\rdate [1]: data_entrada_sociedade\rCall `spec()` for a copy-pastable column specification\rSpecify the column types with `col_types` to quiet this message\rSe voc√™ n√£o conhece o vroom, trata-se de um pacote para leitura de dados de texto que carrega as bases de forma extremamente r√°pida, pois ele n√£o carrega a base na mem√≥ria, apenas indexa. Mais detalhes na documenta√ß√£o do pacote.\n\rUsando o pacote {qsacnpj}\rPara carregar a partir de (2), voc√™ precisar√° ler arquivos do tipo Fixed Width, que geralmente d√° um pouco de trabalho, pois √© necess√°rio criar um arquivo de configura√ß√£o. Felizmente, o George Santiago j√° resolveu esse problema para n√≥s, criando o pacote {qsacnpj}.\nPara ler os arquivos da RFB usando o pacote {qsacnpj}, n√£o tem segredo. Basta seguir as instru√ß√µes dadas pelo George no README do pacote, que copiei aqui:\nBaixe os arquivos (.zip) da base de dados do CNPJ no site da Receita Federal.\rSalve o arquivo .zip no diret√≥rio que ser√° utilizado para o processamento dos dados.\rDescompacte os arquivos no diret√≥rio. Talvez os arquivos tenhom nomes semelhantes a K3241.K03200DV.D90607.L00001.\r\rOBS: Os arquivos descompactados t√™m mais de 85Gb. Verifique se h√° espa√ßo suficiente no seu HD\r\rAdicione a extens√£o .txt no final do nome do arquivo. Ex: K3241.K03200DV.D90607.L00001.txt\rCrie uma pasta espec√≠fica para armazenar somente os arquivos .txt.\rInstale e execute o pacote.\r\rPor exemplo:\nmeu_arquivo \u0026lt;- \u0026quot;~/Downloads/rfb/originais/K3241.K03200DV.D90805.L00001.txt\u0026quot;\rqsacnpj::gerar_bd_cnpj(meu_arquivo)\r[1] \u0026quot;Pasta \u0026#39;bd_cnpj_tratados\u0026#39; criada com sucesso!\u0026quot;\r[1] \u0026quot;Iniciando o tratamento e consolida√ß√£o dos dados do CNPJ. Esse processo pode levar entre 2h a 4h, dependenndo da configura√ß√£o do computador!\u0026quot;\r[1] \u0026quot;Base de Dados do CNPJ gerada com Sucesso! Tabelas geradas: `dados_cadastrais_pj`, `dados_socios_pj` e `dados_cnae_secundario_pj`\u0026quot;\r[1] \u0026quot;Adicionando na base a tabela com dados dos Entes P√∫blicos Federais, Estaduais e Municipais!\u0026quot;\r[1] \u0026quot;Tabela `tab_cnpj_entes_publicos_br` gerada com Sucesso!\u0026quot;\r[1] \u0026quot;Adicionando na base a tabela com C√≥digo e Nome da Qualifica√ß√£o dos Respons√°veis!\u0026quot;\r[1] \u0026quot;Tabela `tab_qualificacao_responsavel_socio` gerada com Sucesso!\u0026quot;\r[1] \u0026quot;Adicionando na base a tabela com C√≥digo e Nome da Situa√ß√£o Cadastral!\u0026quot;\r[1] \u0026quot;Tabela `tab_situacao_cadastral` gerada com Sucesso!\u0026quot;\r[1] \u0026quot;Adicionando na base a tabela com C√≥digo e Nome da Natureza Jur√≠dica!\u0026quot;\r[1] \u0026quot;Tabela `tab_natureza_juridica` gerada com Sucesso!\u0026quot;\r[1] \u0026quot;Adicionando na base a tabela com os CNAEs!\u0026quot;\r[1] \u0026quot;Tabela `tab_cnae` gerada com Sucesso!\u0026quot;\rFim do Processamento: Base de Dados do CNPJ gerada com Sucesso!\rEm seguida, √© poss√≠vel ler os arquivos em .csv gerados. Um detalhe importante √© que os arquivos foram gerados com o separador #.\nUma coisa que eu gostei do {qsacnpj} √© que ele j√° tem algumas bases auxiliares carregadas no pacote. Essas bases podem ser usadas para fazer o match com a base principal, com o objetivo de obter informa√ß√µes complementares.\n\rqsacnpj::tab_cnae: nomes e c√≥digos de atividades das empresas\rqsacnpj::tab_cnpj_entes_publicos_br: nome e c√≥digo dos Entes P√∫blicos Federais, Estaduais e Municipais\rqsacnpj::tab_natureza_juridica: nome e c√≥digo de Classifica√ß√£o da Natureza Jur√≠dica de 2018.\rqsacnpj::tab_qualificacao_responsavel_socio: nome e c√≥digo de Qualifica√ß√£o do Respons√°vel e/ou S√≥cio no Quadro Societ√°rio da Pessoa Jur√≠dica.\rqsacnpj::tab_situacao_cadastral: nome e c√≥digo da Situa√ß√£o Cadastral da Pessoa Jur√≠dica.\r\r\rAn√°lises\rPara dar um cheirinho de como essa base √© rica, fiz alguns gr√°ficos descritivos considerando apenas as informa√ß√µes do estado de SP. Usei como base o CSV do Turicas e usei as bases carregadas do {qsacnpj}.\nA Figura 1 mostra o volume de empresas na base por ano de abertura. √â interessante notar a evolu√ß√£o a partir do ano de 2004.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/qsacnpj/\r## abertura.png\u0026quot;): It is highly recommended to use relative paths for images. You\r## had absolute paths: \u0026quot;/images/posts/conteudo/qsacnpj/abertura.webp\u0026quot;\r\rFigura 1: Quantidade de empresas abertas por ano.\r\rA Figura 2 mostra as atividades principais das empresas. Eu fiquei surpreso com o fato de mais um quarto das empresas serem relacionadas a com√©rcio, repara√ß√£o de ve√≠culos automotores e motocicletas. Seria interessante aprofundar essa an√°lise criando um Treemap, por exemplo, para entender o que acontece nos subn√≠veis dessa categoria.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/qsacnpj/\r## atividade.png\u0026quot;): It is highly recommended to use relative paths for images. You\r## had absolute paths: \u0026quot;/images/posts/conteudo/qsacnpj/atividade.webp\u0026quot;\r\rFigura 2: Distribui√ß√£o da atividade principal (CNAE), considerando apenas o n√≠vel mais gen√©rico.\r\rA Figura 3 mostra a distribui√ß√£o do capital social das empresas. Quase metade das empresas tem capital social de at√© mil reais! Essa an√°lise, no entanto, pode estar distorcida, pois existem v√°rias empresas na base que n√£o t√™m capital social por conta do tipo societ√°rio.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/qsacnpj/\r## capital.png\u0026quot;): It is highly recommended to use relative paths for images. You\r## had absolute paths: \u0026quot;/images/posts/conteudo/qsacnpj/capital.webp\u0026quot;\r\rFigura 3: Distribui√ß√£o do capital social das empresas.\r\rA Figura 4 mostra os munic√≠pios de registro das empresas. Aqui n√£o tem nada de impressionante, apenas o esperado: cidades mais populosas t√™m mais empresas. Seria interessante aprofundar a an√°lise para taxa de empresas por 100 mil habitantes, por exemplo.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/qsacnpj/mapa.webp\u0026quot;):\r## It is highly recommended to use relative paths for images. You had absolute\r## paths: \u0026quot;/images/posts/conteudo/qsacnpj/mapa.webp\u0026quot;\r\rFigura 4: Mapa dos munic√≠pios de origem.\r\rA Figura 5 mostra a distribui√ß√£o da natureza jur√≠dica das empresas. Eu fiquei surpreso com o fato de que 60% das empresas s√£o empres√°rios individuais!\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/qsacnpj/\r## natureza.png\u0026quot;): It is highly recommended to use relative paths for images. You\r## had absolute paths: \u0026quot;/images/posts/conteudo/qsacnpj/natureza.webp\u0026quot;\r\rFigura 5: Distribui√ß√£o da natureza jur√≠dica das empresas.\r\rA Figura 6 mostra a distribui√ß√£o da quantidade de s√≥cios. √â esperado que a maioria das empresas tenham dois s√≥cios, j√° que as LTDAs devem ter pelo menos dois s√≥cios.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/qsacnpj/\r## qtd_socios1.png\u0026quot;): It is highly recommended to use relative paths for images.\r## You had absolute paths: \u0026quot;/images/posts/conteudo/qsacnpj/qtd_socios1.webp\u0026quot;\r\rFigura 6: Distribui√ß√£o da quantidade de s√≥cios.\r\rA Figura 7 mostra a distribui√ß√£o da quantidade de s√≥cios, considerando apenas Limitada e SA. √â poss√≠vel notar que as Sociedades An√¥nimas possuem mais s√≥cios.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/qsacnpj/\r## qtd_socios2.png\u0026quot;): It is highly recommended to use relative paths for images.\r## You had absolute paths: \u0026quot;/images/posts/conteudo/qsacnpj/qtd_socios2.webp\u0026quot;\r\rFigura 7: Distribui√ß√£o da quantidade de s√≥cios, comparando Limitada e SA.\r\r√â isso pessoal. Happy coding ;)\nO c√≥digo para gerar os gr√°ficos segue abaixo:\nlibrary(formattable)\rlibrary(tidyverse)\rlibrary(lubridate)\rlibrary(sf)\r# # precisei selecionar as colunas para n√£o estourar a mem√≥ria do # # meu computador\r# empresa \u0026lt;- vroom::vroom(\r# \u0026quot;empresa.csv.gz\u0026quot;, # col_select = c(\r# cnpj, identificador_matriz_filial, # razao_social, nome_fantasia, # situacao_cadastral, # codigo_natureza_juridica, data_inicio_atividade, # cnae_fiscal, descricao_tipo_logradouro, logradouro, # numero, complemento, # bairro, cep, uf, codigo_municipio, municipio, # qualificacao_do_responsavel, capital_social, # porte, opcao_pelo_simples\r# ))\r# socios \u0026lt;- vroom::vroom(\u0026quot;socio.csv.gz\u0026quot;, col_types = \u0026quot;cccccccccc\u0026quot;)\rempresa_sp \u0026lt;- read_rds(\u0026quot;empresa_sp.rds\u0026quot;) %\u0026gt;% filter(\r# apenas ativos\rsituacao_cadastral == \u0026quot;2\u0026quot;, # apenas filiais\ridentificador_matriz_filial == 1\r)\rsocios_sp \u0026lt;- read_rds(\u0026quot;socios_sp.rds\u0026quot;)\r# 1. Natureza jur√≠dica: Ltda, SA, outros. ------------------------\r# # Apenas uma curiosidade que acabei n√£o usando\r# empresa_sp %\u0026gt;%\r# count(porte, sort = TRUE) %\u0026gt;% # mutate(porte = case_when(\r# porte == \u0026quot;00\u0026quot; ~ \u0026quot;N√£o informado\u0026quot;,\r# porte == \u0026quot;01\u0026quot; ~ \u0026quot;Micro empresa\u0026quot;,\r# porte == \u0026quot;03\u0026quot; ~ \u0026quot;Empresa de Pequeno Porte\u0026quot;,\r# porte == \u0026quot;05\u0026quot; ~ \u0026quot;Demais\u0026quot;\r# )) %\u0026gt;% # mutate(prop = percent(n/sum(n)))\rnatureza \u0026lt;- qsacnpj::tab_natureza_juridica %\u0026gt;% mutate(codigo_natureza_juridica = as.numeric(cod_subclass_natureza_juridica))\rnatureza_sp \u0026lt;- empresa_sp %\u0026gt;% left_join(natureza, \u0026quot;codigo_natureza_juridica\u0026quot;) %\u0026gt;% replace_na(list(nm_natureza_juridica = \u0026quot;Vazio\u0026quot;,\rnm_subclass_natureza_juridica = \u0026quot;Vazio\u0026quot;)) %\u0026gt;% mutate(\rtipo = if_else(\rnm_natureza_juridica == \u0026quot;Administra√ß√£o P√∫blica\u0026quot;,\r\u0026quot;Administra√ß√£o P√∫blica\u0026quot;, nm_subclass_natureza_juridica\r),\rtipo = fct_lump(tipo, 10, other_level = \u0026quot;Outros\u0026quot;)\r) %\u0026gt;% count(tipo, sort = TRUE) %\u0026gt;% mutate(prop = percent(n/sum(n)))\rp_natureza \u0026lt;- natureza_sp %\u0026gt;%\rmutate(tipo = fct_reorder(str_wrap(tipo, 40), n)) %\u0026gt;% ggplot(aes(x = tipo, y = n / 1e3)) +\rgeom_col(fill = vistrnv::trnv_colors()[1], alpha = .9) +\rcoord_flip() +\rgeom_text(aes(label = prop), nudge_y = 150) +\rtheme_minimal(14) +\rlabs(x = \u0026quot;Natureza Jur√≠dica\u0026quot;, y = \u0026quot;Quantidade de empresas (milhares)\u0026quot;)\r# 2. Data da abertura. -------------------------------------------\r# li a base novamente sem o filtro de ativos\r# √© ineficiente, mas eu estava com pregui√ßa\rd_abertura \u0026lt;- read_rds(\u0026quot;empresa_sp.rds\u0026quot;) %\u0026gt;% filter(identificador_matriz_filial == 1) %\u0026gt;% mutate(\rmes_atividade = floor_date(data_inicio_atividade, \u0026quot;quarter\u0026quot;),\rano_atividade = floor_date(data_inicio_atividade, \u0026quot;year\u0026quot;)\r) %\u0026gt;% filter(mes_atividade \u0026gt; \u0026quot;1950-01-01\u0026quot;,\rmes_atividade \u0026lt; \u0026quot;2019-06-01\u0026quot;) %\u0026gt;% count(ano_atividade)\rp_abertura \u0026lt;- d_abertura %\u0026gt;% mutate(mes_atividade = ano_atividade) %\u0026gt;% filter(year(mes_atividade) \u0026gt; 1950,\ryear(mes_atividade) \u0026lt; 2019) %\u0026gt;% ggplot(aes(x = mes_atividade, y = n/1000)) +\rgeom_line(size = 1) +\rtheme_minimal(14) +\rscale_x_date(breaks = scales::date_breaks(\u0026quot;3 year\u0026quot;),\rlabels = scales::date_format(\u0026quot;%Y\u0026quot;)) +\rscale_y_continuous(limits = c(0, 800)) +\rlabs(x = \u0026quot;Ano de in√≠cio das atividades\u0026quot;,\ry = \u0026quot;Quantidade de empresas (milhares)\u0026quot;) +\rtheme(axis.text.x = element_text(angle = 45, hjust = 1),\rpanel.grid.minor.x = element_blank())\r# 3. Atividade econ√¥mica principal. ------------------------------\rtab_cnae \u0026lt;- empresa_sp %\u0026gt;% mutate(cod_cnae = str_pad(cnae_fiscal, 7, \u0026quot;left\u0026quot;, \u0026quot;0\u0026quot;)) %\u0026gt;% left_join(qsacnpj::tab_cnae, \u0026quot;cod_cnae\u0026quot;) %\u0026gt;% replace_na(list(nm_secao = \u0026quot;Vazio\u0026quot;, nm_divisao = \u0026quot;Vazio\u0026quot;,\rnm_grupo = \u0026quot;Vazio\u0026quot;, nm_classe = \u0026quot;Vazio\u0026quot;,\rnm_cnae = \u0026quot;Vazio\u0026quot;)) %\u0026gt;% count(nm_secao, nm_divisao, nm_grupo, nm_classe, nm_cnae)\rd_cnae \u0026lt;- empresa_sp %\u0026gt;% mutate(cod_cnae = str_pad(cnae_fiscal, 7, \u0026quot;left\u0026quot;, \u0026quot;0\u0026quot;)) %\u0026gt;% left_join(qsacnpj::tab_cnae, \u0026quot;cod_cnae\u0026quot;) %\u0026gt;% replace_na(list(nm_secao = \u0026quot;Vazio\u0026quot;, nm_divisao = \u0026quot;Vazio\u0026quot;,\rnm_grupo = \u0026quot;Vazio\u0026quot;, nm_classe = \u0026quot;Vazio\u0026quot;,\rnm_cnae = \u0026quot;Vazio\u0026quot;))\r# montei uma fun√ß√£o pois estava copiando muito c√≥digo\rp_cnae \u0026lt;- function(d_cnae, quebra, lump = 14) {\rd_cnae %\u0026gt;% mutate(tipo = fct_lump({{quebra}}, lump)) %\u0026gt;% count(tipo) %\u0026gt;% mutate(tipo = fct_reorder(str_wrap(tipo, 40), n)) %\u0026gt;% mutate(prop = percent(n/sum(n))) %\u0026gt;% ggplot(aes(x = tipo, y = n / 1e3)) +\rgeom_col(fill = vistrnv::trnv_colors()[1], alpha = .9) +\rcoord_flip() +\rgeom_text(aes(label = prop), nudge_y = 100) +\rtheme_minimal(12) +\rlabs(x = \u0026quot;Atividade principal\u0026quot;, y = \u0026quot;Quantidade de empresas (milhares)\u0026quot;)\r}\rgraficos_cnae \u0026lt;- list(\rsecao = d_cnae %\u0026gt;% p_cnae(nm_secao),\rdivisao = d_cnae %\u0026gt;% p_cnae(nm_divisao),\rgrupo = d_cnae %\u0026gt;% p_cnae(nm_grupo),\rclasse = d_cnae %\u0026gt;% p_cnae(nm_classe),\rcnae = d_cnae %\u0026gt;% p_cnae(nm_cnae)\r)\r# acabei usando s√≥ esse\rp_cnae \u0026lt;- graficos_cnae$secao\r# 4. Munic√≠pio da sede. -------------------------------------------\rd_muni \u0026lt;- brazilmaps::get_brmap(\r\u0026quot;City\u0026quot;, geo.filter = list(State = 35)\r) %\u0026gt;% mutate(nome = abjutils::rm_accent(nome))\rp_muni \u0026lt;- empresa_sp %\u0026gt;% count(municipio) %\u0026gt;%\rmutate(nome = case_when(\r# precisei arrumar alguns nomes na m√£o, pois n√£o consegui\r# dar match pelo c√≥digo do munic√≠pio\rmunicipio == \u0026quot;BIRITIBA-MIRIM\u0026quot; ~ \u0026quot;BIRITIBA MIRIM\u0026quot;,\rmunicipio == \u0026quot;MOGI-GUACU\u0026quot; ~ \u0026quot;MOGI GUACU\u0026quot;,\rTRUE ~ municipio\r)) %\u0026gt;% inner_join(d_muni, \u0026quot;nome\u0026quot;) %\u0026gt;% mutate(ncat = cut(n/1000, ceiling(c(0, 1e3, 2e3, 1e4, 1e5, max(n))/1000),\rdig.lab = 10)) %\u0026gt;% st_as_sf() %\u0026gt;% ggplot(aes(fill = ncat)) +\rgeom_sf(colour = \u0026quot;black\u0026quot;, size = .3) +\rscale_fill_viridis_d(option = \u0026quot;A\u0026quot;, begin = 0.1, alpha = .9) +\rtheme_void(14) +\rtheme(legend.position = c(.85,.8)) +\rlabs(fill = \u0026quot;Quantidade de\\nempresas (milhares)\u0026quot;)\r# 5. Quantidade de s√≥cios. ----------------------------------------\rqtd_socios \u0026lt;- socios_sp %\u0026gt;% count(cnpj)\rempresa_natureza \u0026lt;- empresa_sp %\u0026gt;% left_join(natureza, \u0026quot;codigo_natureza_juridica\u0026quot;) %\u0026gt;% replace_na(list(nm_natureza_juridica = \u0026quot;Vazio\u0026quot;,\rnm_subclass_natureza_juridica = \u0026quot;Vazio\u0026quot;)) %\u0026gt;% mutate(\rtipo = if_else(\rnm_natureza_juridica == \u0026quot;Administra√ß√£o P√∫blica\u0026quot;,\r\u0026quot;Administra√ß√£o P√∫blica\u0026quot;, nm_subclass_natureza_juridica\r),\rtipo = fct_lump(tipo, 10, other_level = \u0026quot;Outros\u0026quot;)\r)\rp_qtd_socios1 \u0026lt;- qtd_socios %\u0026gt;% mutate(n = fct_lump(str_pad(n, 2, \u0026quot;left\u0026quot;, 0), 10, other_level = \u0026quot;11 ou mais\u0026quot;)) %\u0026gt;% count(n) %\u0026gt;% mutate(prop = percent(nn/sum(nn)), n = fct_rev(n)) %\u0026gt;% ggplot(aes(x = n, y = nn / 1e3)) +\rgeom_col(fill = vistrnv::trnv_colors()[1], alpha = .9) +\rcoord_flip() +\rgeom_text(aes(label = prop), nudge_y = 30) +\rtheme_minimal(14) +\rlabs(x = \u0026quot;Quantidade de s√≥cios\u0026quot;, y = \u0026quot;Quantidade de empresas (milhares)\u0026quot;)\rd_plot_qtd_socios \u0026lt;- qtd_socios %\u0026gt;% inner_join(select(empresa_natureza, cnpj, tipo), \u0026quot;cnpj\u0026quot;) %\u0026gt;% filter(str_detect(tipo, \u0026quot;Limitada|An√¥n\u0026quot;)) %\u0026gt;% mutate(tipo = if_else(str_detect(tipo, \u0026quot;Limitada\u0026quot;), \u0026quot;Limitada\u0026quot;, \u0026quot;SA\u0026quot;)) %\u0026gt;% mutate(n = fct_lump(str_pad(n, 2, \u0026quot;left\u0026quot;, 0), 10, other_level = \u0026quot;11 ou mais\u0026quot;)) %\u0026gt;% count(tipo, n) %\u0026gt;% group_by(tipo) %\u0026gt;% mutate(prop = nn/sum(nn), n = fct_rev(n)) %\u0026gt;% ungroup() %\u0026gt;% mutate(prop = percent(prop, 1))\rp_qtd_socios2 \u0026lt;- d_plot_qtd_socios %\u0026gt;% ggplot(aes(x = n, y = prop, fill = tipo)) +\rgeom_col(position = \u0026quot;dodge\u0026quot;) +\rcoord_flip() +\rscale_fill_viridis_d(begin = 0.3, end = 0.8) +\rtheme_minimal(14) +\rscale_y_continuous(labels = scales::percent) +\rlabs(x = \u0026quot;Quantidade de s√≥cios\u0026quot;, y = \u0026quot;Propor√ß√£o das empresas\u0026quot;,\rfill = \u0026quot;Tipo\u0026quot;) +\rguides(fill = guide_legend(reverse = TRUE)) +\rtheme(legend.position = c(.8, .2))\r# 6. Capital social. -----------------------------------------------\rp_capital \u0026lt;- empresa_sp %\u0026gt;% mutate(capital_social_cat = cut(\rcapital_social/1e3, breaks = c(0, 1e3, 1e4, 1e5, 1e6, Inf)/1e3,\rinclude.lowest = TRUE, dig.lab = 10)\r) %\u0026gt;% count(tipo = capital_social_cat) %\u0026gt;% mutate(prop = percent(n/sum(n)),\rtipo = fct_rev(tipo)) %\u0026gt;% ggplot(aes(x = tipo, y = n / 1e3)) +\rgeom_col(fill = vistrnv::trnv_colors()[1], alpha = .9) +\rcoord_flip() +\rgeom_text(aes(label = prop), nudge_y = 100) +\rtheme_minimal(14) +\rlabs(x = \u0026quot;Capital social (milhares de reais)\u0026quot;, y = \u0026quot;Quantidade de empresas (milhares)\u0026quot;)\r# FIM -------------------------------------------------------------\rtodos_graficos \u0026lt;- list(\rnatureza = p_natureza,\rabertura = p_abertura,\ratividade = p_cnae,\rmapa = p_muni,\rqtd_socios1 = p_qtd_socios1,\rqtd_socios2 = p_qtd_socios2,\rcapital = p_capital\r)\rfs::dir_create(\u0026quot;graficos\u0026quot;)\riwalk(todos_graficos, ~ggsave(paste0(.y, \u0026quot;.png\u0026quot;), .x, path = \u0026quot;graficos\u0026quot;))\r\r","permalink":"https://blog.curso-r.com/posts/2019-09-20-qsacnpj/","tags":["rfb","banco de dados"],"title":"Explorando a base de dados de CNPJ da Receita Federal"},{"author":["Daniel"],"categories":["an√°lises"],"contents":"\r\rA partir do vestibular de 2019 a FUVEST alterou o seu sistema cotas. Antes de 2019,\ro sistema beneficiava com uma bonifica√ß√£o os candidatos que cursaram o ensino m√©dio\rna rede p√∫blica de ensino e passou a contar com reserva de vagas para os estudantes\rcotistas.\nPara cada curso as vagas s√£o divididas da seguinte forma:\n\r60% reservadas para ampla concorr√™ncia\r40% reservadas para candidatos cotistas\rdas 40% reservadas p/ cotistas, 37,5% s√£o reservadas para os candidatos de escolas\rp√∫blicas autodeclarados pretos, pardos e ind√≠genas.\r\rSegundo a resolu√ß√£o do Conselho Universit√°rio (CoG) ainda:\n\rO candidato concorrer√° apenas com os candidatos que tenham optado pela mesma modalidade\rde concorr√™ncia no Concurso Vestibular FUVEST 2019.\n\r√â a√≠ que aparece o problema. Algumas carreiras da FUVEST j√° possuiam historicamente\rpropor√ß√£o maior de 40% de alunos oriundos de escola p√∫blica. Esse ponto foi\rlevantado em janeiro de 2019 pela ADUSP e mesmo em 2018 pela imprensa.\nVejamos os dados.\nPara 37% das carreiras na primeira fase da FUVEST a nota de corte para\rser convocado para a segunda fase para candidatos cotistas foi maior do que a nota\rpara candidatos que se candidataram em ampla concorr√™ncia. Consideramos nas an√°lises\rapenas as modalidades que tiveram todas as vagas preenchidas - isto √©, foram convocados\rpara a segunda fase mais candidatos do que o n√∫mero de vagas dispon√≠veis.\nO gr√°fico a seguir mostra a diferen√ßa entre a nota de corte para candidatos\rcotistas de escola p√∫blica (EP) e candidatos da ampla concorr√™ncia (AC).\nVeja que para o curso de Filosofia, a nota de corte para alunos cotistas de escolas\rp√∫blicas foi 11 pontos maior do que a nota para alunos da ampla concorr√™ncia.\nQuando comparamos candidatos da modalidade PPI (estudaram na rede p√∫blica e se autodeclaram\rpretos, pardos ou ind√≠genas) com candidatos da modalidade EP, a situa√ß√£o se repete.\nAs notas de corte para candidatos PPI dos cursos de Sa√∫de P√∫blica e de Ci√™ncias dos alimentos\rforam 4 pontos superiores √†s notas dos cotistas do ensino p√∫blico.\nAs tabelas a seguir mostram os cursos que apresentaram maiores diferen√ßas:\nhtml {\rfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r}\r#vcrweikojf .gt_table {\rdisplay: table;\rborder-collapse: collapse;\rmargin-left: auto;\rmargin-right: auto;\rcolor: #333333;\rfont-size: 16px;\rfont-weight: normal;\rfont-style: normal;\rbackground-color: #FFFFFF;\rwidth: auto;\rborder-top-style: solid;\rborder-top-width: 2px;\rborder-top-color: #A8A8A8;\rborder-right-style: none;\rborder-right-width: 2px;\rborder-right-color: #D3D3D3;\rborder-bottom-style: solid;\rborder-bottom-width: 2px;\rborder-bottom-color: #A8A8A8;\rborder-left-style: none;\rborder-left-width: 2px;\rborder-left-color: #D3D3D3;\r}\r#vcrweikojf .gt_heading {\rbackground-color: #FFFFFF;\rtext-align: center;\rborder-bottom-color: #FFFFFF;\rborder-left-style: none;\rborder-left-width: 1px;\rborder-left-color: #D3D3D3;\rborder-right-style: none;\rborder-right-width: 1px;\rborder-right-color: #D3D3D3;\r}\r#vcrweikojf .gt_title {\rcolor: #333333;\rfont-size: 125%;\rfont-weight: initial;\rpadding-top: 4px;\rpadding-bottom: 4px;\rborder-bottom-color: #FFFFFF;\rborder-bottom-width: 0;\r}\r#vcrweikojf .gt_subtitle {\rcolor: #333333;\rfont-size: 85%;\rfont-weight: initial;\rpadding-top: 0;\rpadding-bottom: 4px;\rborder-top-color: #FFFFFF;\rborder-top-width: 0;\r}\r#vcrweikojf .gt_bottom_border {\rborder-bottom-style: solid;\rborder-bottom-width: 2px;\rborder-bottom-color: #D3D3D3;\r}\r#vcrweikojf .gt_col_headings {\rborder-top-style: solid;\rborder-top-width: 2px;\rborder-top-color: #D3D3D3;\rborder-bottom-style: solid;\rborder-bottom-width: 2px;\rborder-bottom-color: #D3D3D3;\rborder-left-style: none;\rborder-left-width: 1px;\rborder-left-color: #D3D3D3;\rborder-right-style: none;\rborder-right-width: 1px;\rborder-right-color: #D3D3D3;\r}\r#vcrweikojf .gt_col_heading {\rcolor: #333333;\rbackground-color: #FFFFFF;\rfont-size: 100%;\rfont-weight: normal;\rtext-transform: inherit;\rborder-left-style: none;\rborder-left-width: 1px;\rborder-left-color: #D3D3D3;\rborder-right-style: none;\rborder-right-width: 1px;\rborder-right-color: #D3D3D3;\rvertical-align: bottom;\rpadding-top: 5px;\rpadding-bottom: 6px;\rpadding-left: 5px;\rpadding-right: 5px;\roverflow-x: hidden;\r}\r#vcrweikojf .gt_column_spanner_outer {\rcolor: #333333;\rbackground-color: #FFFFFF;\rfont-size: 100%;\rfont-weight: normal;\rtext-transform: inherit;\rpadding-top: 0;\rpadding-bottom: 0;\rpadding-left: 4px;\rpadding-right: 4px;\r}\r#vcrweikojf .gt_column_spanner_outer:first-child {\rpadding-left: 0;\r}\r#vcrweikojf .gt_column_spanner_outer:last-child {\rpadding-right: 0;\r}\r#vcrweikojf .gt_column_spanner {\rborder-bottom-style: solid;\rborder-bottom-width: 2px;\rborder-bottom-color: #D3D3D3;\rvertical-align: bottom;\rpadding-top: 5px;\rpadding-bottom: 6px;\roverflow-x: hidden;\rdisplay: inline-block;\rwidth: 100%;\r}\r#vcrweikojf .gt_group_heading {\rpadding: 8px;\rcolor: #333333;\rbackground-color: #FFFFFF;\rfont-size: 100%;\rfont-weight: initial;\rtext-transform: inherit;\rborder-top-style: solid;\rborder-top-width: 2px;\rborder-top-color: #D3D3D3;\rborder-bottom-style: solid;\rborder-bottom-width: 2px;\rborder-bottom-color: #D3D3D3;\rborder-left-style: none;\rborder-left-width: 1px;\rborder-left-color: #D3D3D3;\rborder-right-style: none;\rborder-right-width: 1px;\rborder-right-color: #D3D3D3;\rvertical-align: middle;\r}\r#vcrweikojf .gt_empty_group_heading {\rpadding: 0.5px;\rcolor: #333333;\rbackground-color: #FFFFFF;\rfont-size: 100%;\rfont-weight: initial;\rborder-top-style: solid;\rborder-top-width: 2px;\rborder-top-color: #D3D3D3;\rborder-bottom-style: solid;\rborder-bottom-width: 2px;\rborder-bottom-color: #D3D3D3;\rvertical-align: middle;\r}\r#vcrweikojf .gt_from_md  :first-child {\rmargin-top: 0;\r}\r#vcrweikojf .gt_from_md  :last-child {\rmargin-bottom: 0;\r}\r#vcrweikojf .gt_row {\rpadding-top: 8px;\rpadding-bottom: 8px;\rpadding-left: 5px;\rpadding-right: 5px;\rmargin: 10px;\rborder-top-style: solid;\rborder-top-width: 1px;\rborder-top-color: #D3D3D3;\rborder-left-style: none;\rborder-left-width: 1px;\rborder-left-color: #D3D3D3;\rborder-right-style: none;\rborder-right-width: 1px;\rborder-right-color: #D3D3D3;\rvertical-align: middle;\roverflow-x: hidden;\r}\r#vcrweikojf .gt_stub {\rcolor: #333333;\rbackground-color: #FFFFFF;\rfont-size: 100%;\rfont-weight: initial;\rtext-transform: inherit;\rborder-right-style: solid;\rborder-right-width: 2px;\rborder-right-color: #D3D3D3;\rpadding-left: 12px;\r}\r#vcrweikojf .gt_summary_row {\rcolor: #333333;\rbackground-color: #FFFFFF;\rtext-transform: inherit;\rpadding-top: 8px;\rpadding-bottom: 8px;\rpadding-left: 5px;\rpadding-right: 5px;\r}\r#vcrweikojf .gt_first_summary_row {\rpadding-top: 8px;\rpadding-bottom: 8px;\rpadding-left: 5px;\rpadding-right: 5px;\rborder-top-style: solid;\rborder-top-width: 2px;\rborder-top-color: #D3D3D3;\r}\r#vcrweikojf .gt_grand_summary_row {\rcolor: #333333;\rbackground-color: #FFFFFF;\rtext-transform: inherit;\rpadding-top: 8px;\rpadding-bottom: 8px;\rpadding-left: 5px;\rpadding-right: 5px;\r}\r#vcrweikojf .gt_first_grand_summary_row {\rpadding-top: 8px;\rpadding-bottom: 8px;\rpadding-left: 5px;\rpadding-right: 5px;\rborder-top-style: double;\rborder-top-width: 6px;\rborder-top-color: #D3D3D3;\r}\r#vcrweikojf .gt_striped {\rbackground-color: rgba(128, 128, 128, 0.05);\r}\r#vcrweikojf .gt_table_body {\rborder-top-style: solid;\rborder-top-width: 2px;\rborder-top-color: #D3D3D3;\rborder-bottom-style: solid;\rborder-bottom-width: 2px;\rborder-bottom-color: #D3D3D3;\r}\r#vcrweikojf .gt_footnotes {\rcolor: #333333;\rbackground-color: #FFFFFF;\rborder-bottom-style: none;\rborder-bottom-width: 2px;\rborder-bottom-color: #D3D3D3;\rborder-left-style: none;\rborder-left-width: 2px;\rborder-left-color: #D3D3D3;\rborder-right-style: none;\rborder-right-width: 2px;\rborder-right-color: #D3D3D3;\r}\r#vcrweikojf .gt_footnote {\rmargin: 0px;\rfont-size: 90%;\rpadding: 4px;\r}\r#vcrweikojf .gt_sourcenotes {\rcolor: #333333;\rbackground-color: #FFFFFF;\rborder-bottom-style: none;\rborder-bottom-width: 2px;\rborder-bottom-color: #D3D3D3;\rborder-left-style: none;\rborder-left-width: 2px;\rborder-left-color: #D3D3D3;\rborder-right-style: none;\rborder-right-width: 2px;\rborder-right-color: #D3D3D3;\r}\r#vcrweikojf .gt_sourcenote {\rfont-size: 90%;\rpadding: 4px;\r}\r#vcrweikojf .gt_left {\rtext-align: left;\r}\r#vcrweikojf .gt_center {\rtext-align: center;\r}\r#vcrweikojf .gt_right {\rtext-align: right;\rfont-variant-numeric: tabular-nums;\r}\r#vcrweikojf .gt_font_normal {\rfont-weight: normal;\r}\r#vcrweikojf .gt_font_bold {\rfont-weight: bold;\r}\r#vcrweikojf .gt_font_italic {\rfont-style: italic;\r}\r#vcrweikojf .gt_super {\rfont-size: 65%;\r}\r#vcrweikojf .gt_footnote_marks {\rfont-style: italic;\rfont-size: 65%;\r}\r\r\r\r# vagas\r# inscritos\r# convocados 2¬™ fase\rPontua√ß√£o\r\r\r\rM√≠nima\rM√°xima\r\r\rFilosofia\r\r\rAC\r102\r431\r331\r27\r73\r\r\rEP\r17\r179\r72\r38\r60\r\r\rPPI\r0\r0\r0\rNA\rNA\r\rPedagogia\r\r\rAC\r108\r469\r377\r27\r64\r\r\rEP\r18\r215\r77\r35\r67\r\r\rPPI\r0\r0\r0\rNA\rNA\r\rCi√™ncias F√≠sicas e Biomoleculares ‚àí S√£o Carlos\r\r\rAC\r24\r62\r57\r27\r75\r\r\rEP\r2\r15\r8\r35\r51\r\r\rPPI\r2\r5\r5\r27\r47\r\rGeologia\r\r\rAC\r30\r144\r122\r29\r65\r\r\rEP\r5\r49\r20\r37\r57\r\r\rPPI\r0\r0\r0\rNA\rNA\r\rInform√°tica Biom√©dica ‚àí Ribeir√£o Preto\r\r\rAC\r12\r49\r44\r27\r67\r\r\rEP\r3\r17\r12\r33\r45\r\r\rPPI\r1\r3\r2\r27\r48\r\rQu√≠mica ‚àí Licenciatura ‚àí Ribeir√£o Preto\r\r\rAC\r20\r68\r57\r27\r66\r\r\rEP\r4\r17\r12\r33\r52\r\r\rPPI\r4\r4\r2\r33\r35\r\rLicenciatura em Educomunica√ß√£o\r\r\rAC\r16\r64\r55\r27\r61\r\r\rEP\r3\r20\r13\r32\r43\r\r\rPPI\r2\r4\r2\r33\r40\r\rPedagogia ‚àí Ribeir√£o Preto\r\r\rAC\r30\r100\r75\r27\r65\r\r\rEP\r2\r35\r12\r32\r40\r\r\rPPI\r3\r25\r12\r27\r45\r\rLicenciatura em Ci√™ncias Exatas ‚àí S√£o Carlos\r\r\rAC\r30\r106\r88\r27\r61\r\r\rEP\r2\r17\r8\r32\r50\r\r\rPPI\r3\r7\r3\r33\r37\r\rSistemas de Informa√ß√£o ‚àí S√£o Carlos\r\r\rAC\r25\r173\r103\r34\r67\r\r\rEP\r6\r79\r25\r39\r56\r\r\rPPI\r4\r23\r12\r28\r54\r\r\r\rA rela√ß√£o candidato vaga tamb√©m aumenta quando comparamos candidatos de cada\rmodalidade do vestibular. Por exemplo, o gr√°fico abaixo mostra a diferen√ßa\rpercentual entre a rela√ß√£o candidato/vaga para da ampla concorr√™ncia e cotistas\rde escola p√∫blica. Note que em alguns casos a rela√ß√£o aumentou mais de 400%.\nEm suma, este artigo tem por objetivo apresentar dados que contestam a efic√°cia\rdo sistema de cotas da fuvest. √â not√°vel que para a maior parte dos cursos o sistema\rde cotas teve efeito ben√©fico, no entanto, n√£o faz sentido melhorar de um lado\re piorar de outro. Al√©m disso, a decis√£o de se candidatar pelo sistema de cotas\rou n√£o √© uma decis√£o dif√≠cil para o candidato - que no momento da inscri√ß√£o n√£o\rpossui dados tal como a rela√ß√£o candidato vaga para cada uma das modalidades.\nTodo o c√≥digo para replicar os gr√°ficos e an√°lises deste artigo est√£o diospon√≠veis\raqui.\n","permalink":"https://blog.curso-r.com/posts/2019-11-27-fuvest/","tags":["pdf","banco de dados"],"title":"A (n√£o) efic√°cia do sistema de cotas na FUVEST"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rO pacote {arrow} √© uma atualiza√ß√£o importante para o mundo da ci√™ncia de dados. Essa tecnologia possibilitar√° uma integra√ß√£o ainda mais suave entre as principais linguagens de programa√ß√£o voltadas √† ci√™ncia de dados, como R/Python, bem como as diversas ferramentas que utilizamos na parte de engenharia de dados, como Spark, por exemplo.\nCada vez mais, o que percebo √© que a ci√™ncia de dados est√° conseguindo atingir uma meta que parece contradit√≥ria: unificar as ferramentas e, ao mesmo tempo, dar liberdade ao profissional. Isso acontece pois a parte que se quer libertar √© a do pensamento cr√≠tico, a modelagem e o problema de neg√≥cio, e o que se quer padronizar √© o armazenamento, o deploy e a escalabilidade.\nO que √© o Arrow?\rSegundo o site da Apache:\n\rApache Arrow is a development platform for in-memory analytics. It contains a set of technologies that enable big data systems to process and move data fast. It specifies a standardized language-independent columnar memory format for flat and hierarchical data, organized for efficient analytic operations on modern hardware.\n\rA instala√ß√£o do {arrow} ainda √© um pouco complicada e n√£o convencional. Para usu√°rios linux, como eu, √© necess√°rio baixar o c√≥digo fonte do github e mandar compilar na m√£o. O tutorial para isso √© relativamente simples de seguir, mas acredito que ainda pode melhorar.\nUma simples utiliza√ß√£o do {arrow} √© salvando e lendo objetos em extens√µes que podem ser utilizadas em diferentes linguagens. Um exemplo de extens√£o parquet, que pode ser lida em diversas linguagens, carregada pelo Google BigQuery e trabalhada em projetos envolvendo Spark.\nEstamos caminhando para um futuro unificado! Pretendo escrever mais sobre o arrow no futuro.\n√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-08-30-arrow/","tags":["arrow","dados"],"title":"O pacote arrow"},{"author":["Julio"],"categories":["tutoriais"],"contents":"\r\rUm or√°culo √© uma fun√ß√£o que diz para se uma predi√ß√£o est√° correta ou incorreta. Ou seja, ela diz a verdade sobre a vari√°vel resposta de um novo caso da sua base no qual voc√™ s√≥ observa as explicativas.\nO or√°culo nem sempre existe em problemas reais, pois a verdade n√£o costuma estar dispon√≠vel no momento em que fazemos a predi√ß√£o. Por exemplo, se estamos predizendo as vendas do pr√≥ximo m√™s, s√≥ saberemos a taxa de acerto com certeza no pr√≥ximo m√™s. Antes disso, s√≥ podemos fazer estimativas.\nEnt√£o o or√°culo √© como se fosse minha base de testes? Bem, sim, mas √© um tipo muito especial de base de teste. No contexto de captchas, n√≥s podemos gerar infinitas observa√ß√µes novas da base, criando uma base de dados de treino virtualmente infinita.\nO problema √© que a resposta do or√°culo n√£o √© sempre clara: usualmente, o or√°culo n√£o diz o qu√™ voc√™ errou, mas somente se voc√™ errou. Ou seja, √© uma informa√ß√£o incompleta, censurada.\nE como n√≥s fazemos para tratar informa√ß√£o incompleta nos nossos estudos? Botamos na verossimilhan√ßa! Essa √© uma poss√≠vel ideia para atingir nosso objetivo final: criar modelos que aprendem a resolver captchas automaticamente.\nNa pr√°tica, no entanto, isso √© uma tarefa dif√≠cil! Nesse post vou me ater em mostrar um toy model de or√°culo e, nos pr√≥ximos posts sobre o tema, vou desenvolver mais a parte estat√≠stica.\nConstruindo um or√°culo\rUm or√°culo precisa ter tr√™s partes implementadas: i) obten√ß√£o de uma imagem nova, ii) teste do modelo e iii) retorno, que deve envolver a matriz de entrada, o valor predito e a resposta (completa ou incompleta).\nVamos ent√£o ao c√≥digo:\n#\u0026#39; Or√°culo do MNIST\r#\u0026#39;\r#\u0026#39; @param model modelo que resolve o captcha do MNIST. Por padr√£o\r#\u0026#39; √© \u0026quot;ask\u0026quot;, significando que ele vai perguntar para o usu√°rio.\r#\u0026#39; @param type se for 0, fala s√≥ se acertou. Se for 1, #\u0026#39; informa quais letras acertou e quais errou. Se for 2,\r#\u0026#39; informa o gabarito.\r#\u0026#39;\roracle_mnist \u0026lt;- function(model = \u0026quot;ask\u0026quot;, type = 0) {\rmnist \u0026lt;- keras::dataset_mnist()\r# gerando um captcha\rN \u0026lt;- nrow(mnist$train$x)\rsample_nums \u0026lt;- sample(N, 5)\rsample_list \u0026lt;- purrr::map(sample_nums, ~mnist$train$x[.x,,])\rX \u0026lt;- abind::abind(sample_list, along = 2)\rY \u0026lt;- as.numeric(mnist$train$y[sample_nums])\r# teste do modelo\rif (is.character(model)[1] \u0026amp;\u0026amp; model == \u0026quot;ask\u0026quot;) {\rpar(mar=rep(0,4))\rplot(as.raster(X/256))\rans \u0026lt;- readline(\u0026quot;Answer: \u0026quot;)\rans \u0026lt;- as.numeric(unlist(strsplit(ans, \u0026quot;\u0026quot;)))\r} else {\rpred \u0026lt;- predict(model, tensorflow::array_reshape(X, c(1, dim(X), 1)))\rans \u0026lt;- apply(pred[1,,], 1, which.max) - 1\r}\r# retorno\rres \u0026lt;- list(\rpredito = ans,\racertou = all(ans == Y),\rquais = if (type \u0026gt; 0) (ans == Y),\rgabarito = if (type \u0026gt; 1) Y\r)\rlist(x = X, res = res)\r}\rVamos testar! Esse √© um caso que acertei\nresult \u0026lt;- oracle_mnist(type = 0)\rAnswer: 87685\rresult$res\r$predito\r[1] 8 7 6 8 5\r$acertou\r[1] TRUE\r$quais\rNULL\r$gabarito\rNULL\rE esse √© um caso que errei, e mandei mostrar todos os outputs poss√≠veis:\nresult \u0026lt;- oracle_mnist(type = 2)\rAnswer: 56198\rresult$res\r$predito\r[1] 5 6 1 9 8\r$acertou\r[1] FALSE\r$quais\r[1] TRUE TRUE TRUE TRUE FALSE\r$gabarito\r[1] 5 6 1 9 0\rEm seguida, mostro como podemos ajustar um modelo preditivo e como utilizar o or√°culo com esse modelo. Essa √© a opera√ß√£o que utilizaremos para aprimorar nosso modelo no futuro.\n\rDados\rOs dados que vou utilizar para esse exemplo v√™m da base MNIST, colando horizontalmente os caracteres de cinco em cinco para formar os captchas.\nlibrary(keras)\rmnist \u0026lt;- dataset_mnist()\r# cola as imagens lado a lado\rmontar_x \u0026lt;- function(x) {\rpos_x \u0026lt;- (seq_len(nrow(x))-1) %% 5 + 1\rxizes \u0026lt;- purrr::map(1:5, ~x[pos_x == .x,,]/256)\rX \u0026lt;- abind::abind(xizes, along = 3)\rtensorflow::array_reshape(X, c(dim(X), 1))\r}\r# monta a vari√°vel resposta usando\r# decryptr:::resize_answer()\r# a vari√°vel resposta de um captcha\r# √© uma matriz nesse formato # (lab = label, pos = posi√ß√£o)\r# # lab|0 1 2 3 4 5 6 7 8 9\r# pos|-------------------\r# 1 |0 0 0 0 0 1 0 0 0 0\r# 2 |1 0 0 0 0 0 0 0 0 0\r# 3 |0 0 0 0 1 0 0 0 0 0\r# 4 |0 1 0 0 0 0 0 0 0 0\r# 5 |0 0 0 0 0 0 0 0 0 1\rmontar_y \u0026lt;- function(y) {\rpos_y \u0026lt;- seq(0, ceiling(length(y)/5) - 1)\ry \u0026lt;- as.numeric(y)\ryizes \u0026lt;- purrr::map(\r.x = pos_y, .f = ~decryptr:::resize_answer(y[.x * 5 + 1:5], 0:9)\r)\rabind::abind(yizes, along = 0)\r}\r# montando os dados numa lista\rdata \u0026lt;- list(\rtrain = list(\rx = montar_x(mnist$train$x),\ry = montar_y(mnist$train$y)\r),\rtest = list(\rx = montar_x(mnist$test$x),\ry = montar_y(mnist$test$y)\r)\r)\r\rModelo\rMeu modelo √© uma rede neural convolucional simples, igual ao que est√° implementado no decryptr. Essa rede foi treinada com as 12 mil observa√ß√µes de treino montadas anteriormente. O modelo possui uma taxa de acerto de 92% para o captcha completo, ou seja, para todas as 5 letras.\n# meu input, come√ßando com as dimens√µes de X\rinput \u0026lt;- layer_input(shape = dim(data$train$x)[-1])\r# uma camada convolucional customizada, # j√° com o max pooling\rmy_conv \u0026lt;- function(obj, f, k) {\robj %\u0026gt;%\rlayer_conv_2d(\rfilters = f,\rkernel_size = c(k,k),\rpadding = \u0026quot;same\u0026quot;,\ractivation = \u0026quot;relu\u0026quot;\r) %\u0026gt;%\rlayer_max_pooling_2d()\r}\r# dimens√µes das bases\rdims \u0026lt;- list(\rx = dim(data$train$x)[-1],\ry = dim(data$train$y)[-1]\r)\r# rede completa\routput \u0026lt;- input %\u0026gt;%\rmy_conv(16, 5) %\u0026gt;%\rmy_conv(32, 3) %\u0026gt;%\rmy_conv(64, 3) %\u0026gt;%\rlayer_flatten() %\u0026gt;%\rlayer_dense(units = 64) %\u0026gt;%\rlayer_dropout(.1) %\u0026gt;%\r# fixar o n√∫mero de par√¢metros\r# para o output do modelo\rlayer_dense(units = prod(dims$y)) %\u0026gt;%\rlayer_reshape(target_shape = dims$y) %\u0026gt;%\rlayer_activation(\u0026quot;softmax\u0026quot;)\r# defini√ß√£o do modelo\rmodel \u0026lt;- keras_model(input, output)\r# m√©trica customizada para o captcha\rmetric_captcha \u0026lt;- custom_metric(\rname = \u0026quot;captcha\u0026quot;, metric_fn = function(y_true, y_pred) {\rk_equal(k_argmax(y_true), k_argmax(y_pred)) %\u0026gt;% k_all(axis = -1) %\u0026gt;% k_cast(k_floatx())\r})\r# adicionando regras de otimiza√ß√£o, # fun√ß√£o de perda e m√©trica a acompanhar\rmodel %\u0026gt;%\rcompile(\roptimizer = optimizer_adam(),\rloss = loss_categorical_crossentropy,\rmetrics = metric_captcha\r)\r# ajustando modelo\rmodel %\u0026gt;%\rfit(\rx = data$train$x, y = data$train$y,\rvalidation_data = list(data$test$x, data$test$y),\rbatch_size = 64,\repochs = 10\r)\rA estrutura do modelo ajustado √© dada abaixo:\n__________________________________________________________\rLayer (type) Output Shape Param # ==========================================================\rinput_1 (InputLayer) (None, 28, 140, 1) 0 __________________________________________________________\rconv2d (Conv2D) (None, 28, 140, 16) 416 __________________________________________________________\rmax_pooling2d (MaxPooling (None, 14, 70, 16) 0 __________________________________________________________\rconv2d_1 (Conv2D) (None, 14, 70, 32) 4640 __________________________________________________________\rmax_pooling2d_1 (MaxPooli (None, 7, 35, 32) 0 __________________________________________________________\rconv2d_2 (Conv2D) (None, 7, 35, 64) 18496 __________________________________________________________\rmax_pooling2d_2 (MaxPooli (None, 3, 17, 64) 0 __________________________________________________________\rflatten (Flatten) (None, 3264) 0 __________________________________________________________\rdense (Dense) (None, 64) 208960 __________________________________________________________\rdropout (Dropout) (None, 64) 0 __________________________________________________________\rdense_1 (Dense) (None, 50) 3250 __________________________________________________________\rreshape (Reshape) (None, 5, 10) 0 __________________________________________________________\ractivation (Activation) (None, 5, 10) 0 ==========================================================\rTotal params: 235,762\rTrainable params: 235,762\rNon-trainable params: 0\r__________________________________________________________\rAgora, podemos utilizar o or√°culo com o modelo:\nresult \u0026lt;- oracle_mnist(model, 0)\rresult$res\r$predito\r[1] 8 6 6 0 1\r$acertou\r[1] TRUE\r$quais\rNULL\r$gabarito\rNULL\rset.seed(13)\rresult \u0026lt;- oracle_mnist(model, 2)\rresult$res\r$predito\r[1] 7 2 2 7 7\r$acertou\r[1] FALSE\r$quais\r[1] FALSE TRUE TRUE TRUE TRUE\r$gabarito\r[1] 1 2 2 7 7\rVeja qual foi o caso que o modelo errou:\nN√£o parece t√£o f√°cil de ver que √© um 7, n√©?\n\rPacote mimir\rEstou montando um pacote chamado {mimir} para construir or√°culos e trabalhar com eles. O nome Mimir vem da figura da mitologia n√≥rdica, conhecida por ser muito s√°bia. Eu achei o nome legal pois i) mimi lembra gatos, o que interage bem com as brincadeiras purrr e forcats e ii) por ter um R no final, que √© sempre legal em pacotes! O pacote ainda n√£o est√° dispon√≠vel, mas assim que estiver eu aviso nas redes.\nNo pr√≥ximo post do tema, vou apresentar algumas formas de aproveitar a informa√ß√£o do or√°culo na verossimilhan√ßa e alguns testes que venho desenvolvendo.\n√â isso pessoal. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-09-20-captcha-oraculo/","tags":["captcha"],"title":"Quebrando Captchas - Parte VII: Or√°culos"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\r\rO que faz o R ser t√£o legal √© a comunidade que est√° por tr√°s dela. Existem v√°rias formas de acessar essa comunidade: pelo stackoverflow, twitter, facebook, entre outras. Nesse post vou falar um pouquinho sobre a comunidade RBrasil no telegram, usando dados!\nA comunidade @rbrasiloficial foi criada em 2015 pelo Felipe Barros e j√° tem mais de mil inscritos. O canal √© utilizado para tirar d√∫vidas, discutir sobre o futuro do R, divulgar trabalhos e dar pitacos sobre as coisas que est√£o acontecendo.\nNesse post vou mostrar como importar e arrumar os dados, e algumas visualiza√ß√µes da base de conversas do Telegram.\nImportando os dados\rO Telegram j√° possui uma ferramenta para exportar os chats. Basta clicar nas op√ß√µes do chat e mandar exportar. Ent√£o vou assumir que esses dados j√° est√£o em m√£os.\nOs dados est√£o dispon√≠veis no formato HTML. Para ler um arquivo, montei o seguinte c√≥digo:\nlibrary(magrittr)\rler_html_telegram \u0026lt;- function(html_file) {\r# pega todas as mensagens\rdivs \u0026lt;- xml2::read_html(html_file) %\u0026gt;% xml2::xml_find_all(\u0026quot;//div[@class=\u0026#39;message default clearfix\u0026#39;]\u0026quot;)\r# nome da pessoa\rnomes \u0026lt;- divs %\u0026gt;% xml2::xml_find_all(\u0026quot;./div/div[@class=\u0026#39;from_name\u0026#39;]\u0026quot;) %\u0026gt;% xml2::xml_text() %\u0026gt;% stringr::str_squish()\r# data e hora da mensagem\rdata_horas \u0026lt;- divs %\u0026gt;% xml2::xml_find_all(\u0026quot;./div/div[@class=\u0026#39;pull_right date details\u0026#39;]\u0026quot;) %\u0026gt;% xml2::xml_attr(\u0026quot;title\u0026quot;) %\u0026gt;% lubridate::dmy_hms()\r# texto da mensagem\rtextos \u0026lt;- divs %\u0026gt;% purrr::map(xml2::xml_find_first, \u0026quot;./div/div[@class=\u0026#39;text\u0026#39;]\u0026quot;) %\u0026gt;% purrr::map_chr(xml2::xml_text) %\u0026gt;% stringr::str_squish()\r# retorna numa tabela\rtibble::tibble(\rdata_hora = data_horas,\rnome = nomes,\rtexto = textos\r)\r}\rDepois, basta listar todos os arquivos e carregar cada arquivo usando purrr::map_dfr():\npath \u0026lt;- \u0026quot;~/Downloads/Telegram Desktop/ChatExport_17_08_2019/\u0026quot;\rtodos_arquivos \u0026lt;- fs::dir_ls(path, regexp = \u0026quot;messages\u0026quot;)\rd_msg \u0026lt;- purrr::map_dfr(\rtodos_arquivos, ler_html_telegram, .id = \u0026quot;arquivo\u0026quot;\r)\rNo final, fiquei com uma base de dados com 26.980 linhas e 4 colunas.\nContas deletadas ganharam no volume de mensagens‚Ä¶ Mas acho que n√£o queremos consider√°-las pois temos v√°rias pessoas nessa contagem. O grande Marcelo Ventura Freire venceu no n√∫mero de mensagens! Eu tamb√©m estou no p√°reo :)\nd_msg %\u0026gt;% dplyr::count(nome, sort = TRUE) %\u0026gt;% dplyr::mutate(prop = scales::percent(n/sum(n))) %\u0026gt;% head(10) %\u0026gt;% knitr::kable()\r\r\rnome\rn\rprop\r\r\r\rDeleted Account\r3101\r11.5%\r\rMarcelo Ventura Freire\r2313\r8.6%\r\rCharles Lula da Silva\r1897\r7.0%\r\rLeonard de Assis\r1677\r6.2%\r\rSillas Gonzaga\r1540\r5.7%\r\rJulio Trecenti\r1130\r4.2%\r\rBruna Wundervald\r951\r3.5%\r\rAndre Mesquita\r818\r3.0%\r\rFernando Barbalho\r696\r2.6%\r\rGeorge Santiago\r611\r2.3%\r\r\r\rE no tempo, como que fica? Parece que no in√≠cio o volume de mensagens era mais alto, e depois entramos num patamar est√°vel.\nlibrary(ggplot2)\rd_msg %\u0026gt;% dplyr::mutate(mes = lubridate::floor_date(data_hora, \u0026quot;month\u0026quot;)) %\u0026gt;% dplyr::count(mes) %\u0026gt;% ggplot(aes(x = mes, y = n)) +\rgeom_line() +\rgeom_point() +\rtheme_minimal(16)\rNo gr√°fico seguinte, peguei as doze pessoas que falaram mais historicamente e avaliei a evolu√ß√£o mensal de mensagens. Temos de tudo: os constantes, os que sumiram, os que ressurgiram das cinzas e os que chegaram para ficar.\nd_msg %\u0026gt;% dplyr::filter(nome != \u0026quot;Deleted Account\u0026quot;) %\u0026gt;% dplyr::mutate(nome = forcats::fct_lump(nome, 12),\rnome = as.character(nome),\rmes = lubridate::floor_date(data_hora, \u0026quot;month\u0026quot;)) %\u0026gt;% dplyr::filter(nome != \u0026quot;Other\u0026quot;) %\u0026gt;% dplyr::count(mes, nome, sort = TRUE) %\u0026gt;% tidyr::complete(mes, nome, fill = list(n = 0)) %\u0026gt;% ggplot(aes(x = mes, y = n)) +\rgeom_line() +\rfacet_wrap(~nome) +\rlabs(x = \u0026quot;M√™s\u0026quot;, y = \u0026quot;Quantidade de mensagens\u0026quot;) +\rtheme_bw()\rE qual √© o hor√°rio que as pessoas interagem mais? Parece que √© √†s 16 horas, aquele hor√°rio que a pessoa est√° ferrada no trabalho e precisa pedir uma ajuda aos amigos‚Ä¶\nd_msg %\u0026gt;% dplyr::mutate(hora = factor(lubridate::hour(data_hora))) %\u0026gt;% ggplot(aes(x = hora)) +\rgeom_bar(fill = \u0026quot;royalblue\u0026quot;) +\rtheme_minimal(14) +\rggtitle(\u0026quot;Hora das mensagens\u0026quot;)\rE o dia da semana? Ter√ßa-feira wins!\nd_msg %\u0026gt;% dplyr::mutate(wd = lubridate::wday(data_hora, label = TRUE)) %\u0026gt;% ggplot(aes(x = wd)) +\rgeom_bar(fill = \u0026quot;pink2\u0026quot;) +\rtheme_minimal(14) +\rggtitle(\u0026quot;Dia da semana das mensagens\u0026quot;)\rE claro, n√£o poderia faltar um wordcloud‚Ä¶\n# d√° pra criar fun√ß√µes an√¥nimas assim ;)\r# esse √© um limpador bem safado que fiz em 1 min\rlimpar \u0026lt;- . %\u0026gt;% abjutils::rm_accent() %\u0026gt;% stringr::str_to_title() %\u0026gt;% stringr::str_remove_all(\u0026quot;[^a-zA-Z0-9 ]\u0026quot;) %\u0026gt;% stringr::str_squish()\r# tirar palavras que nao quero\rbanned \u0026lt;- tidytext::get_stopwords(\u0026quot;pt\u0026quot;) %\u0026gt;% dplyr::mutate(palavra = limpar(word))\rcores \u0026lt;- viridis::viridis(10, begin = 0, end = 0.8)\rd_msg %\u0026gt;% tidytext::unnest_tokens(palavra, texto) %\u0026gt;% dplyr::mutate(palavra = limpar(palavra)) %\u0026gt;% dplyr::anti_join(banned, \u0026quot;palavra\u0026quot;) %\u0026gt;% dplyr::count(palavra, sort = TRUE) %\u0026gt;% with(wordcloud::wordcloud(\rpalavra, n, scale = c(5, .1), min.freq = 80, random.order = FALSE,\rcolors = cores\r))\rFiz poucos gr√°ficos para te deixar com vontade de brincar mais. Gostou da brincadeira? Ent√£o fa√ßa suas pr√≥prias an√°lises do seu chat preferido do Telegram!\n√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-09-10-rbrasil/","tags":["comunidade"],"title":"Comunidade R Brasil no Telegram"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\r\rUma forma poderosa de participar socialmente √© utilizando dados abertos. Dados abertos tornam a sociedade mais democr√°tica pois com eles podemos verificar afirma√ß√µes baseadas em estat√≠sticas e tamb√©m buscar novas narrativas para os fen√¥menos estudados.\nNesse post, mostramos um exemplo de como isso pode ser feito, utilizando os dados da Sistema Nacional de Informa√ß√µes de Seguran√ßa p√∫blica, o SINESP. O objetivo com esse texto √© empoderar as pessoas que trabalham com ci√™ncia de dados e mostrar como podemos participar socialmente usando o R.\nNo dia 16/julho o Ministro da Justi√ßa, S√©rgio Moro, fez a seguinte declara√ß√£o no Twitter:\nAbaixo not√≠cia de verdade. Dados do Sinesp, estes, sim, oficiais, apontam queda no primeiro trimestre de 2019 do n√∫mero dos principais crimes em todo o pa√≠s em compara√ß√£o com o mesmo per√≠odo de 2018. Vamos trabalhar para aprofundar essa queda e levar seguran√ßa a cada cidad√£o. pic.twitter.com/srnJZF4X6K\r‚Äî Sergio Moro (@SF_Moro) July 16, 2019\r\r\rO legal de existirem dados abertos √© que podemos checar esses informa√ß√µes e criar an√°lises mais aprofundadas sobre o tema. Infelizmente, ainda n√£o foram disponibilizados os dados do primeiro bimestre de 2019, que fazem parte do Tweet do Moro.\nMas isso n√£o √© um problema, pois podemos fazer diversos cruzamentos com os dados que est√£o dispon√≠veis. Nesta r√°pida an√°lise, mostro como baixar os dados a partir do portal de dados abertos https://dados.gov.br. Para isso, utilizarei o tidyverse, httr e xml2.\nlibrary(tidyverse)\rParte 1: Download\rComo o dados.gov.br √© um portal muito bem feito, √© poss√≠vel baixar todos os dados em CSV com um pipeline simples:\n# caminho do diret√≥rio\rpath_sinesp \u0026lt;- \u0026quot;~/data-raw/sinesp/\u0026quot;\r# cria o diret√≥rio\rfs::dir_create(path_sinesp)\r# link do SINESP no dados.gov.br\ru_sinesp \u0026lt;- paste0(\u0026quot;http://dados.gov.br/dataset\u0026quot;,\r\u0026quot;/sistema-nacional-de-estatisticas-de-seguranca-publica\u0026quot;)\ru_sinesp %\u0026gt;%\r# carrega a p√°gina\rhttr::GET() %\u0026gt;%\r# parseia o c√≥digo fonte da p√°gina\rxml2::read_html() %\u0026gt;%\r# identifica todas as tags que cont√™m os links\rxml2::xml_find_all(\u0026quot;//ul[@class=\u0026#39;dropdown-menu\u0026#39;]//a\u0026quot;) %\u0026gt;%\r# extrai a lista todos os links\rxml2::xml_attr(\u0026quot;href\u0026quot;) %\u0026gt;%\r# seleciona apenas os arquivos xlsx da lista\rstr_subset(\u0026quot;xlsx\u0026quot;) %\u0026gt;%\r# essa parte faz o loop de download. Demora ~1 minuto\rwalk(~httr::GET(.x, httr::write_disk(paste0(path_sinesp, basename(.x)))))\rNada impede o usu√°rio de baixar esses arquivos CSV manualmente. Pode ser at√© que seja mais r√°pido baixar manualmente se for uma vez s√≥. A vantagem desse c√≥digo √© que ele √© reprodut√≠vel, a menos que o site mude sua estrutura. Ou seja, quando chegarem os dados de 2019, provavelmente poderemos baixar tudo novamente usando o mesmo c√≥digo.\n\rParte 2: Importa√ß√£o e arruma√ß√£o\rO c√≥digo abaixo carrega e arruma os dados para an√°lise. Sempre existem inconsist√™ncias nos dados e devemos ficar atentos a eles.\nd_sinesp \u0026lt;- path_sinesp %\u0026gt;% # lista os arquivos\rfs::dir_ls() %\u0026gt;%\r# l√™ todos os arquivos xlsx e empilha\rmap_dfr(readxl::read_excel, col_types = \u0026quot;text\u0026quot;, .id = \u0026quot;file\u0026quot;) %\u0026gt;%\r# define os nomes das colunas\rset_names(c(\u0026quot;file\u0026quot;, \u0026quot;uf\u0026quot;, \u0026quot;tipo_crime\u0026quot;, \u0026quot;mes_ano\u0026quot;, \u0026quot;valor\u0026quot;)) %\u0026gt;%\r# transforma os valores para os tipos corretos\rtransmute(\ruf,\r# transformando string em data\rmes_ano = lubridate::dmy(paste0(\u0026quot;01/\u0026quot;, mes_ano)),\r# arrumando tipo de crime\rtipo_crime = str_to_title(tipo_crime),\rvalor = as.numeric(valor),\r# cria uma coluna com o bimestre\rbimestre = lubridate::floor_date(mes_ano, \u0026quot;bimonth\u0026quot;)\r)\rNo caso, o maior problema era um tipo de crime que estava escrito com nomes ligeiramente diferentes. Um stringr::str_to_title() foi suficiente para resolver. A base de dados ficou assim:\n\r\ruf\rmes_ano\rtipo_crime\rvalor\rbimestre\r\r\r\rAcre\r2015-01-01\rEstupro\r6\r2015-01-01\r\rAcre\r2015-01-01\rFurto De Ve√≠culo\r0\r2015-01-01\r\rAcre\r2015-01-01\rHomic√≠dio Doloso\r13\r2015-01-01\r\rAcre\r2015-01-01\rLes√£o Corporal Seguida De Morte\r0\r2015-01-01\r\rAcre\r2015-01-01\rRoubo A Institui√ß√£o Financeira\r0\r2015-01-01\r\rAcre\r2015-01-01\rRoubo De Carga\r0\r2015-01-01\r\rAcre\r2015-01-01\rRoubo De Ve√≠culo\rNA\r2015-01-01\r\rAcre\r2015-01-01\rRoubo Seguido De Morte (Latroc√≠nio)\r0\r2015-01-01\r\rAcre\r2015-01-01\rTentativa De Homic√≠dio\r2\r2015-01-01\r\rAcre\r2015-02-01\rEstupro\r8\r2015-01-01\r\r\r\r\rParte 3: Transforma√ß√£o\rNesse c√≥digo, meu objetivo foi reproduzir a tabela do Ministro da Justi√ßa, mas adicionando as mudan√ßas ocorridas entre 2015-2016, 2016-2017 e 2017-2018. N√£o fiz a an√°lise por trimestre, e sim por bimestre. O leitor interessado pode replicar as an√°lises para trimestres.\nresults \u0026lt;- d_sinesp %\u0026gt;%\r# agrupa por bimestre e sumariza\rgroup_by(bimestre, tipo_crime) %\u0026gt;%\rsummarise(valor = sum(valor, na.rm = TRUE)) %\u0026gt;%\rungroup() %\u0026gt;%\r# apenas primeiro bimestre e tirar dados de antes de 2015\rfilter(lubridate::month(bimestre) == 1,\rlubridate::year(bimestre) \u0026gt;= 2015) %\u0026gt;%\r# ordenar e agrupar por tipo de crime\rarrange(tipo_crime, bimestre) %\u0026gt;%\rgroup_by(tipo_crime) %\u0026gt;%\r# adicionar bimestre anterior\rmutate(vl_lag = lag(valor)) %\u0026gt;%\rungroup() %\u0026gt;%\r# tirar 2015\rfilter(!is.na(vl_lag)) %\u0026gt;%\r# calcula a raz√£o\rmutate(razao = scales::percent(valor / vl_lag - 1),\rbim1 = lubridate::year(bimestre)) %\u0026gt;%\r# seleciona as colunas importantes\rselect(bim1, tipo_crime, razao) %\u0026gt;%\r# joga os bimestres nas colunas\rspread(bim1, razao, sep = \u0026quot;_\u0026quot;)\rknitr::kable(results)\r\r\rtipo_crime\rbim1_2016\rbim1_2017\rbim1_2018\r\r\r\rEstupro\r4.3%\r1.2%\r11.5%\r\rFurto De Ve√≠culo\r5.5%\r-7.3%\r-6.4%\r\rHomic√≠dio Doloso\r3.3%\r6.5%\r-10.6%\r\rLes√£o Corporal Seguida De Morte\r21.6%\r23.0%\r-7.8%\r\rRoubo A Institui√ß√£o Financeira\r-4.8%\r-28.9%\r-1.4%\r\rRoubo De Carga\r-1.5%\r13.1%\r11.2%\r\rRoubo De Ve√≠culo\r9.8%\r7.0%\r-5.9%\r\rRoubo Seguido De Morte (Latroc√≠nio)\r12.5%\r13.7%\r-13.1%\r\rTentativa De Homic√≠dio\r-7.7%\r-2.0%\r-9.9%\r\r\r\rA tabela mostra que o primeiro bimestre de 2018, se comparado ao de 2017, tamb√©m apresenta quedas em todos os tipos de crime, com exce√ß√£o de estupro e roubo de cargas. Al√©m disso, como ser√° poss√≠vel ver no pr√≥ximo gr√°fico, as varia√ß√µes percentuais acima de 20% na tabela ocorrem em crimes com pequeno volume absoluto de ocorr√™ncias. Isso √© esperado, pois quando o valor absoluto √© pequeno, pequenas mudan√ßas podem significar grandes varia√ß√µes percentuais. Por exemplo, se uma contagem vai de 150 para 120 (queda de 30), a queda √© de 20%, mas se outra contagem vai de 1000 para 900 (queda de 100), a queda percentual √© de 10%\n\rParte 4: Visualiza√ß√£o\rNesse gr√°fico, mostrei a s√©rie bimestral de ocorr√™ncias por tipo de crime, buscando identificar tend√™ncias de subida ou queda.\nd_sinesp %\u0026gt;%\r# soma por bimestre e tipo de crime\rgroup_by(bimestre, tipo_crime) %\u0026gt;%\rsummarise(valor = sum(valor, na.rm = TRUE)) %\u0026gt;%\rungroup() %\u0026gt;%\r# apenas 2015 para frente\rfilter(lubridate::year(bimestre) \u0026gt;= 2015) %\u0026gt;%\r# monta o grafico\rggplot(aes(x = bimestre, y = valor)) +\r# adiciona linhas\rgeom_line() +\r# adiciona uma linha vertical par 2018\rgeom_vline(xintercept = as.Date(\u0026quot;2018-01-01\u0026quot;), colour = \u0026quot;red\u0026quot;, linetype = 2) +\r# divide o grafico por tipo de crime\rfacet_wrap(~tipo_crime, scales = \u0026quot;free_y\u0026quot;, ncol = 3) +\rtheme_bw()\rPelo gr√°fico, √© poss√≠vel identificar que, em diversos tipos de crime, existe uma tend√™ncia de queda ap√≥s o primeiro bimestre de 2018. Ou seja, n√£o se pode atribuir a queda nas estat√≠sticas de ocorr√™ncias ao novo governo de 2019. A queda vertiginosa no volume de estupros √© bem curiosa.\n\rWrap-up\r\rDado aberto √© a melhor forma de tornar as informa√ß√µes disponibilizadas publicamente audit√°veis.\rCom o R, √© f√°cil ingerir esses dados para realizar an√°lises simples e complexas.\rN√£o se engane: dado aberto n√£o √© dado arrumado. O trabalho de faxina de dados √© cont√≠nuo.\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-09-03-sinesp/","tags":["dados abertos"],"title":"Verificando afirma√ß√µes com dados abertos"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rEste √© o √∫ltimo post na sequ√™ncia que estou chamando de ‚Äúshiny em produ√ß√£o‚Äù. J√°\rfalamos sobre como usar o\rpacote golem para facilitar o desenvolvimento de shiny apps, sobre\rcomo transformar eles em\rpacotes e sobre\rcomo dockeriz√°-los para\robter compatibilidade m√°xima.\nE √© justamente essa compatibilidade que nos permite fazer o deploy desses apps\rna nuvem (mais especificamente no Google Cloud Platform) em menos de 20 minutos!\rComo esse tutorial √© muito visual, resolvemos fazer um v√≠deo para que tudo\rficasse mais claro:\n\rSe voc√™ quiser acessar o reposit√≥rio com o conte√∫do, deixamos\rele aberto a todos. Por fim, segue abaixo\ro c√≥digo em Node utilizado para criar as Cloud Functions:\nvar http = require(\u0026#39;http\u0026#39;);\rvar Compute = require(\u0026#39;@google-cloud/compute\u0026#39;);\rvar compute = Compute();\rexports.startInstance = function startInstance(req, res) {\rvar zone = compute.zone(\u0026#39;{SUA ZONA}\u0026#39;);\rvar vm = zone.vm(\u0026#39;{SUA VM}\u0026#39;);\rvm.start(function(err, operation, apiResponse) {\rconsole.log(\u0026#39;instance start successfully\u0026#39;);\r});\rres.status(200).send(\u0026#39;Success start instance\u0026#39;);\r};\r{\r\u0026quot;name\u0026quot;: \u0026quot;sample-http\u0026quot;,\r\u0026quot;dependencies\u0026quot;: {\r\u0026quot;@google-cloud/compute\u0026quot;: \u0026quot;0.7.1\u0026quot;},\r\u0026quot;version\u0026quot;: \u0026quot;0.0.1\u0026quot;\r}\rvar http = require(\u0026#39;http\u0026#39;);\rvar Compute = require(\u0026#39;@google-cloud/compute\u0026#39;);\rvar compute = Compute();\rexports.stopInstance = function stopInstance(req, res) {\rvar zone = compute.zone(\u0026#39;{SUA ZONA}\u0026#39;);\rvar vm = zone.vm(\u0026#39;{SUA VM}\u0026#39;);\rvm.stop(function(err, operation, apiResponse) {\rconsole.log(\u0026#39;instance stop successfully\u0026#39;);\r});\rres.status(200).send(\u0026#39;Success stop instance\u0026#39;);\r};\r{\r\u0026quot;name\u0026quot;: \u0026quot;sample-http\u0026quot;,\r\u0026quot;dependencies\u0026quot;: {\r\u0026quot;@google-cloud/compute\u0026quot;: \u0026quot;0.7.1\u0026quot;},\r\u0026quot;version\u0026quot;: \u0026quot;0.0.1\u0026quot;\r}\r","permalink":"https://blog.curso-r.com/posts/2019-09-06-app-deploy/","tags":["gcp","shiny"],"title":"Shiny em Produ√ß√£o: Deploy seu App em 20min"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rRecentemente, o Julio discutiu aqui no blog\rcomo usar o pacote golem\rpara facilitar o desenvolvimento de shiny apps em forma de pacotes e\rcomo transformar esses\rpacotes em ‚Äúexecut√°veis‚Äù de apenas uma linha. Nesse post eu vou continuar essa\rs√©rie e falar sobre como pegar esse app de uma linha e embrulh√°-lo em um\rcont√™iner docker para que o seu deploy seja instant√¢neo.\nInst\rEssencialmente toda a magia da transforma√ß√£o de um app em um docker ocorre na\rpasta /inst. Esse diret√≥rio, pouco utilizado no dia-a-dia, √© √∫til quando\rprecisamos adicionar dados, templates ou qualquer conte√∫do que pode ser\rnecess√°rio em algum momento para o pacote e, portanto, devem ser facilmente\racess√≠veis.\nQuando voc√™ transformar seu shiny app em pacote utilizando o tutorial do Julio,\rvoc√™ ter√° uma estrutura de diret√≥rios padr√£o na raiz do seu app: pastas /R,\r/man e assim por diante. Crie a pasta /inst e dentro dela /app; aqui √©\ronde seu app ir√° morar.\nEm princ√≠pio, voc√™ s√≥ precisa de um arquivo app.R dentro de /inst/app\rcontendo aquela linha m√°gica que executa seu app todo:\nshiny::shinyApp(meuPacote:::app_ui(), meuPacote:::app_server)\rSe voc√™ estiver desenvolvendo um app mais complexo, talvez voc√™ precise\rcriar tamb√©m uma pasta /www ou um\rarquivo _auth0.yml, mas\ro resumo da √≥pera √© que voc√™ deve ser capaz de rodar shiny::runApp() nesta\rpasta e ver o seu app funcionando perfeitamente. Durante o desenvolvimento, n√£o\rse esque√ßa de sempre reinstalar o seu pacote para que meuPacote:::app_ui()\re meuPacote:::app_server mantenham-se atualizados!\nO √∫ltimo arquivo que voc√™ pode querer adicionar a /inst/app √© a configura√ß√£o\rdo seu servidor shiny. No meu caso, eu desenvolvo apps dockerizados para\rsub√≠-los em m√°quinas virtuais na n√∫vem que podem ser acessadas por qualquer um,\rent√£o preciso deixar clara qual porta deve ser utilizada pelo meu shiny. Como\rminhas m√°quinas suportam o protocolo HTTP, meu shiny-server.conf √© o seguinte:\nrun_as shiny;\r# Log all Shiny output to files in this directory\rlog_dir /var/log/shiny-server;\r# Define a server that listens on port 80\rserver {\rlisten 80;\r# Define a location at the base URL\rlocation / {\r# Host the directory of Shiny Apps stored in this directory\rsite_dir /srv/shiny-server;\r# When a user visits the base URL rather than a particular application,\r# an index of the applications available in this directory will be shown.\rdirectory_index off;\r}\r}\rFazer com que o app seja ouvido na porta 80 permite que outra pessoas o acessem\rsem precisar especificar uma porta no URL! Sendo assim, voc√™ pode disponibilizar\rseu shiny app em meuApp.dominio.com.br.\n\rDockerfile\rAgora que a sua pasta /inst est√° devidamente configurada, voc√™ precisa criar\rum Dockerfile na raiz do seu app. Isso ir√° incomodar o devtools::check(),\rmas basta adicionar o nome desse arquivo ao seu .Rbuildignore para que ele\rseja ignorado durante a verifica√ß√£o.\nSe todas as depend√™ncias do seu aplicativo estiverem devidamente organizadas no\rDESCRIPTION e todas as suas bases internas estiverem propriamente exportadas\rcomo documentado pelo Julio, ent√£o o seu Dockerfile deve ser parecido com o\rseguinte:\nFROM rocker/shiny-verse\r# Instalar bibliotecas para o tidyverse\rRUN apt-get update -qq \u0026amp;\u0026amp; apt-get -y --no-install-recommends install \\\rbuild-essential \\\rlibcurl4-gnutls-dev \\\rlibxml2-dev \\\rlibssl-dev \\\rr-cran-curl \\\rr-cran-openssl \\\rcurl \\\rgnupg1 \\\rr-cran-xml2\r# Instalar seu pr√≥prio app (e suas depend√™ncias)\rCOPY ./ /tmp/app/\rRUN R -e \u0026quot;remotes::install_local(\u0026#39;/tmp/app/\u0026#39;)\u0026quot;\r# Copiar arquivos para o lugar certo\rEXPOSE 80/tcp\rRUN rm /srv/shiny-server/index.html\rCOPY ./inst/app /srv/shiny-server/\rCOPY ./inst/app/shiny-server.conf /etc/shiny-server/shiny-server.conf\r# Run\rCMD [\u0026quot;/usr/bin/shiny-server.sh\u0026quot;]\r\rDeploy\rAgora voc√™ j√° pode construir sua imagem docker e execut√°-la ou sub√≠-la para\ralguma m√°quina virtual. Para testar localmente o app, execute os comandos a\rseguir no terminal e acesse localhost:8080 no navegador:\ndocker build -t meuApp pasta/para/meuApp\rdocker run -p 8080:80 meuApp\r\r","permalink":"https://blog.curso-r.com/posts/2019-09-04-app-docker/","tags":["docker","shiny"],"title":"Shiny em Produ√ß√£o: dockerize seu app com 1 linha"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rEsse post √© um tutorial r√°pido de como voc√™ pode criar um livro usando o pacote {bookdown}. Eu uso esse pacote para escrever todos os meus grandes relat√≥rios e at√© minha tese de mestrado. A filosofia dele √© a mesma que a do markdown: o foco √© o conte√∫do; o formato fica pra depois.\nEsse √© um pacote maravilhoso, mas um pouco espinhudo, pois n√£o √© f√°cil lidar com v√°rios formatos distintos. Para dominar o {bookdown}, recomendo que voc√™ leia o livro feito pelo Yihui Xie: https://bookdown.org/yihui/bookdown/. O Yihui √© tamb√©m o autor do {knitr}, {rmarkdown}, {pagedown}, e do excepcional {xaringan}. Os pacotes dele t√™m todos a mesma caracter√≠stica: s√£o extremamente √∫teis, mas √†s vezes te mordem.\nNesse post, apresento um v√≠deo-tutorial fa√ßo apenas alguns coment√°rios adicionais\nV√≠deo\rPrometo que vou melhorar o √°udio nos pr√≥ximos tutoriais.\n\r\rO que faz o que?\rPara criar um livro com {bookdown}, voc√™ s√≥ precisa de dois componentes, descritos abaixo\nUm arquivo index.Rmd ou index.md, com o seguinte conte√∫do:\r\r---\rsite: bookdown::bookdown_site\r---\r# \rRodar a opera√ß√£o\r\rO primeiro componente diz que seu markdown deve ser compilado como um livro do {bookdown}. Isso substitui a fun√ß√£o rmarkdown::default_site(), que √© o padr√£o para desenvolver sites usando RMarkdown. Isso fica para outro post!\nJ√° o segundo componente √© o que compila o site de fato. O par√¢metro output_format √© o que controla a sa√≠da. Existem tr√™s op√ß√µes principais de formatos no {bookdown}: gitbook (HTML), pdf_book (PDF) e gitbook (E-pub).\n\rOutra forma mais enxuta, mas menos geral de obter o mesmo √© utilizando a fun√ß√£o\rbookdown::render_book() no lugar de rmarkdown::render_site(). Nesse caso,\rn√£o √© necess√°rio adicionar a tag site: bookdown::bookdown_site no arquivo\rindex.Rmd/index.md.\n\r\rE se eu quiser que meu site tenha v√°rios formatos?\rVoc√™ pode fazer isso trocando output_format por um vetor. No entanto, existem formas mais organizadas. Nesse caso, a recomenda√ß√£o √© criar um arquivo _output.yml, contendo os outputs que voc√™ quer ter, por exemplo\nbookdown::gitbook:\rcaption: false\rbookdown::pdf_book\rNote que √© poss√≠vel adicionar par√¢metros ao livro, que podem controlar o template que vamos utilizar, por exemplo.\nOutra forma de fazer isso √© diretamente no index.Rmd:\n---\rsite: bookdown::bookdown_site\routput:\rbookdown::gitbook:\rcaption: false\rbookdown::pdf_book\r---\r# meu livro \r\rE se eu quiser quebrar meu livro em v√°rios arquivos?\rSem problemas. Basta criar arquivos com uma ordem espec√≠fica, como 01_introducao.Rmd, 02_introducao.Rmd, etc. Esses arquivos s√£o agregados num grande Rmd antes de ser compilado.\nPor enquanto √© isso. Farei mais posts sobre markdown, pois √© muito √∫til e divertido! Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-08-28-bookdown/","tags":["bookdown"],"title":"Escrevendo livros com R e bookdown"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rNo meu √∫ltimo post sobre shiny, mostrei como √© poss√≠vel usar o pacote {golem} como framework para desenvolvimento de shiny apps como pacotes. O processo de desenvolvimento se torna ligeiramente mais burocr√°tico, mas os ganhos em consist√™ncia e reprodutibilidade s√£o enormes.\nMas eu acho que faltou uma coisa no post. Eu n√£o deixei clara qual √© a grande vantagem de desenvolver um app usando o golem: o poder de rodar seu app com uma linha de c√≥digo.\nNosso objetivo ser√° chegar num c√≥digo assim:\nshiny::shinyApp(meuPacote:::app_ui(), meuPacote:::app_server)\rIsso √© tudo que voc√™ precisar√° subir em uma m√°quina na nuvem ou no shinyapps.io!\nPara conseguir isso, no entanto, voc√™ precisar√° fazer duas coisas:\nCertifique-se de que seu app funciona com o pacote instalado numa sess√£o nova.\r(para o shinyapps.io) coloque seu app no github e instale o pacote de l√°.\rCriar um arquivo app.R com o c√≥digo shiny::shinyApp(meuPacote:::app_ui(), meuPacote:::app_server) e subir para seu servidor ou para o shinyapps.io.\r\rCertifique-se de que seu app funciona.\rUma boa forma de garantir que seu app funciona √© fazendo-o passar no devtools::check(). Se tudo der certo nessa etapa, a probabilidade de dar algum problema no passo (1) colocado acima √© realmente baixa.\nRecomendo fortemente a leitura do livro Zen do R para trilhar o caminho do desenvolvimento de pacotes sem dor nem sofrimento.\n\rTrabalhando com bases exportadas dentro do pacote\rSe o seu Shiny App utiliza bases de dados, sua base deve ser adicionada na pasta data/ de seu pacote. O problema √© que, como as bases na pasta data/ s√£o exportadas, elas n√£o s√£o diretamente acess√≠veis por fun√ß√µes internas do pacote. Para resolver esse problema, existem duas alternativas:\nUtilizar :: sempre que for acessar sua base nas fun√ß√µes de seu Shiny App. Usualmente isso ocorrer√° apenas algumas vezes, pois √© uma boa pr√°tica criar um reactive() que carrega e filtra os dados, e fazer todas as outras funcionalidades do app dependerem desse reactive(). Por exemplo:\r\rapp_ui \u0026lt;- function() {\rtagList(\rplotOutput(\u0026quot;grafico\u0026quot;)\r)\r}\rapp_server \u0026lt;- function(input, output, session) {\r# esse √© o reactive que controla seus dados.\r# se voc√™ tiver muitas bases no seu app, uma boa\r# ideia √© coloc√°-los numa lista neste reactive()\rdados \u0026lt;- reactive({\rmeuPacote::cars\r})\r# a partir daqui, voc√™ n√£o usa mais a base do pacote,\r# mas sim o que vem do reactive()\routput$grafico \u0026lt;- renderPlot({\rplot(dados())\r})\r}\rTratar seus dados como dados internos. Para isso, voc√™ dever√° usar usethis::use_data(dados, internal = TRUE). Nessa alternativa, seus dados ficar√£o num arquivo chamado sysdata.rda. A vantagem nesse caso √© que voc√™ n√£o precisar√° usar o :: sempre que for acessar seus dados. A desvantagem √© que todas suas bases ficar√£o em um arquivo s√≥, o que pode causar confus√µes.\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-08-27-app-pacote/","tags":["golem","shiny"],"title":"Shiny em Produ√ß√£o: Rodando seu App com 1 Linha"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rQuando voc√™ acessa um pacote no GitHub, muitas vezes voc√™ se depara com essas coisas verdinhas:\nEssas coisas s√£o chamadas distintivos (‚Äúbadges‚Äù). Indo da esquerda para a direita: a primeira delas serve para garantir ao leitor que o pacote √© instal√°vel no Linux, a segunda serve para garantir que o pacote √© instal√°vel no Windows, e a terceira serve para garantir que o pacote est√° no CRAN. Esses distintivos d√£o maior confiabilidade ao pacote e √© considerado como boa pr√°tica de programa√ß√£o.\nNesse post, vou discutir sobre o primeiro distintivo, e mostrar um exemplo de como voc√™ pode conseguir cri√°-la usando o pacote {usethis} e o servi√ßo Travis.\nO que √© o Travis?\rTravis √© um servi√ßo de integra√ß√£o cont√≠nua (Continuous Integration, CI), que automatiza a aplica√ß√£o de um conjunto de testes do seu c√≥digo. De forma muito simplificada, o Travis funciona assim:\nVoc√™ d√° um push do seu c√≥digo no GitHub\rO Travis pega seu novo c√≥digo e testa ele numa nova m√°quina Linux, criada na hora.\rSe o teste der certo, o Travis permite que seu distintivo fique verde. Se n√£o der certo, ele fica vermelho.\r\r\rSe voc√™ n√£o conhece muito de GitHub, d√™ uma olhada\rnesse post do Athos ou veja\resse maravilhoso livro\rda Jenny Bryan\n\rMas algumas coisas precisam ser configuradas para que esses passos sejam de fato aplicados.\nPara (1), √© necess√°rio que voc√™ i) tenha uma conta no servi√ßo travis-ci, ii) d√™ permiss√£o para que o Travis monitore seus reposit√≥rios do GitHub e iii) adicione o seu pacote no Travis para monitoramento. Voc√™ s√≥ precisa fazer (i) e (ii) uma vez.\nPara (2), √© necess√°rio definir que testes voc√™ quer fazer. Por padr√£o, o R j√° tem uma rotina na documenta√ß√£o do Travis. O que essa rotina faz √© passar o R CMD CHECK no seu pacote, que √© basicamente o que seu pacote precisa passar para que seja aceito no CRAN.\nPara (3), voc√™ precisa adicionar o distintivo do seu pacote corretamente no seu arquivo README.md. A melhor forma de fazer isso √© utilizando a fun√ß√£o usethis::use_travis()\n\rV√≠deo\rNesse v√≠deo, usei minha conta do GitHub e criei um pacote do zero usando o pacote usethis, vinculei ao Travis, e fiz ele dar build.\n\r\rDetalhes\r\rSe o seu pacote depende da instala√ß√£o de bibliotecas em C++, como libpoppler, libgsl, entre outras, voc√™ precisar√° adicion√°-las manualmente no seu arquivo .travis.yml. Acredito que a melhor forma de fazer isso √© copiando de outros pacotes que j√° fizeram isso antes, como esse aqui que eu fiz algumas semanas atr√°s.\rVoc√™ tamb√©m pode fazer o mesmo trabalho para testar seu c√≥digo no Windows. Para isso, uma alternativa legal √© o AppVeyor.\rPara testar seu pacote em m√∫ltiplas plataformas, principalmente quando for submeter seu pacote no CRAN, use o R-Hub.\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-08-21-travis/","tags":["travis","ci"],"title":"Fazendo seu pacote passar no Travis"},{"author":["Caio"],"categories":["tutoriais"],"contents":"\r\rQual a rela√ß√£o entre as duas partes do t√≠tulo deste post? O que a remo√ß√£o de\racentos de uma palavra em portugu√™s pode ter a ver com o Ano Novo mu√ßulmano? A\rresposta √© translitera√ß√£o.\nTranslitera√ß√£o √© uma opera√ß√£o em strings pouco discutida, mas bastante\rimportante quando lidamos com idiomas que n√£o o ingl√™s. Ela implica na convers√£o\rde texto de um sistema de escrita para outro, substituindo letras (ou\rcaracteres) de formas previs√≠veis, como, por exemplo, Œ± ‚Üí a ou √¶ ‚Üí ae.\nEm portugu√™s √© comum transliterarmos palavras sem mesmo saber o que isso\rsignifica. Por exemplo, a palavra ◊ó◊†◊ï◊õ◊î (/À°œáanuka/) √© normalmente escrita como\r‚Äúchanuc√°‚Äù apesar de essa n√£o ser uma correspond√™ncia da pron√∫ncia hebraica para\ros sons do portugu√™s. Se quis√©ssemos uma transposi√ß√£o de pron√∫ncia,\rprovavelmente escrever√≠amos ‚Äúranuc√°‚Äù, mas o mais correto √© justamente\rtransliterar a palavra de modo a preservar uma certa correspond√™ncia entre as\rletras do hebraico e as letras do portugu√™s; sendo assim, a primeira letra √©\rtransformada em um CH e n√£o em um R. O mesmo ocorre com a romaniza√ß√£o do japon√™s\re do mandarim, etc.\nLetras estrangeiras\rE qual a import√¢ncia da translitera√ß√£o no dia a dia? Em primeiro lugar, quando\rlidamos com idiomas que apresentam caracteres distintos dos nossos, muitas vezes\ras fun√ß√µes padr√£o do R n√£o s√£o capazes de tratar eles corretamente!\nVejamos por exemplo uma palavra do alem√£o e uma do holand√™s: ‚Äúgro√ü‚Äù e ‚Äúijsvrij‚Äù.\rNo alem√£o, a vers√£o capitalizada do beta (√ü) √© SS, enquanto no holand√™s o\rd√≠grafo IJ √© na verdade uma letra s√≥. Vejamos o que acontece se usamos as\rfun√ß√µes padr√µes:\ntoupper(\u0026quot;gro√ü\u0026quot;)\r## [1] \u0026quot;GRO√ü\u0026quot;\rstringr::str_to_title(\u0026quot;ijsvrij\u0026quot;)\r## [1] \u0026quot;Ijsvrij\u0026quot;\rPara corrigir esses problemas (o ‚Äú√ü‚Äù e o ‚ÄúIj‚Äù), devemos utilizar fun√ß√µes do\rpacote stringi que s√£o capazes de transliterar as strings antes de aplicar\ras outras transforma√ß√µes:\nlibrary(stringi)\rstri_trans_toupper(\u0026quot;gro√ü\u0026quot;, locale = \u0026quot;de_DE\u0026quot;)\r## [1] \u0026quot;GROSS\u0026quot;\rstri_trans_totitle(\u0026quot;ijsvrij\u0026quot;, locale = \u0026quot;nl_NL\u0026quot;)\r## [1] \u0026quot;IJsvrij\u0026quot;\r\rAcentos do portugu√™s\rO segundo uso da translitera√ß√£o (e provavelmente mais comum no dia a dia) √© a\rremo√ß√£o dos acentos do portugu√™s. Muitas vezes recebemos arquivos e tabelas nos\rquais a acentua√ß√£o das palavras est√° quebrada ou incorreta, tornando necess√°ria\ra remo√ß√£o dos diacr√≠ticos (acentos ortogr√°ficos + til + cedilha + trema + etc.)\rde todas as strings.\nJamais devemos criar uma regex para realizar essa tarefa porque a chance de ela\rn√£o funcionar √© muito grande! Suponha que esquecemos de um acento na regex, uma\rforma capitalizada, ou mesmo a exist√™ncia de palavras em outros idiomas no meio\rde um texto em portugu√™s. A solu√ß√£o para esse problema √©, voc√™ adivinhou, a\rtranslitera√ß√£o.\nstri_trans_general(\u0026quot;Str√≠ng c√µm m√º√¨t√¥s a√ß√´nt√≤s\u0026quot;, \u0026quot;Latin-ASCII\u0026quot;)\r## [1] \u0026quot;String com muitos acentos\u0026quot;\rA fun√ß√£o stri_trans_general() recebe dois argumentos: uma string e um\ridentificador de transforma√ß√£o. Neste caso e quando estivermos lidando com\rportugu√™s em geral, o que queremos √© passar uma string no alfabeto latino (o\rnosso alfabeto) para ASCII (o conjunto\rrestrito de caracteres sem nenhum tipo de diacr√≠tico) e, portanto, utilizamos o\rID \"Latin-ASCII\".\n\rAno Novo mu√ßulmano\rO terceiro e √∫ltimo uso da translitera√ß√£o serve para quando lidamos com l√≠nguas\rque apresentam ligaduras (duas ou mais letras unidas em um √∫nico glifo). O √°rabe\r√© o melhor exemplo disso porque grande parte da sua arte caligr√°fica envolve a\rcomposi√ß√£o de diversas palavras em uma s√≥ figura [observe o c√≠rculo central da\rimagem do Alcor√£o deste post e repare como ele √© preenchido por diversas\rpalavras entrela√ßadas].\nComo o Ano Novo mu√ßulmano deste ano √© amanh√£ (ao p√¥r-do-sol do dia 30/08/19),\racho que vale a pena aprender como lidar com a ligadura mais famosa do √°rabe:\ra frase conhecida como Sallallahou Alayhe Wasallam que significa ‚Äúb√™n√ß√£os de\rDeus estejam sobre Ele e Sua fam√≠lia e paz‚Äù. Esta frase √© comumente conectada ao\rnome dos profetas do Isl√£ em sinal de respeito e, pela frequ√™ncia de seu uso,\rfoi convertida em apenas um caractere Unicode:\nÔ∑∫\r\rFa√ßa um teste e copie o s√≠mbolo acima. Voc√™ pode notar que ele √© de fato apenas\rum glifo como qualquer outro e que pode ser enviado por qualquer WhatsApp da\rvida!\nA quest√£o √© que se estivermos analisando texto em √°rabe, esse tipo de ligadura\rpode atrapalhar, por exemplo, a contagem de palavras. Para lidar com essas\rsitua√ß√µes (especificamente em √°rabe) usamos a fun√ß√£o stri_trans_nfkc().\nstri_trans_nfkc(\u0026quot;\\ufdfa\u0026quot;)\r## [1] \u0026quot;ÿµŸÑŸâ ÿßŸÑŸÑŸá ÿπŸÑŸäŸá Ÿàÿ≥ŸÑŸÖ\u0026quot;\rE pronto! Agora nenhum feriado internacional vai pegar a sua programa√ß√£o de\rsurpresa.\nObs.: Acima utilizei o\rc√≥digo Unicode da ligadura\rporque sen√£o ela atrapalharia a formata√ß√£o da caixa de c√≥digo,\rmas basta executar cat(\"\\ufdfa\") no seu R para ver que ele realmente\rrepresenta o S.A.W.\n\r","permalink":"https://blog.curso-r.com/posts/2019-08-29-transliteracao/","tags":["strings"],"title":"Remo√ß√£o de Acentos e o Ano Novo Mu√ßulmano"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rO {dplyr} √© um pacote incr√≠vel pois permite realizar opera√ß√µes dif√≠ceis de forma iterada e intuitiva. Uma grande facilidade do {dplyr} √© a possibilidade de utilizar os nomes das vari√°veis sem encapsular com aspas, o que torna a programa√ß√£o mais fluida e compreens√≠vel.\nPor exemplo, √© f√°cil argumentar que\nmtcars %\u0026gt;% summarise(soma = sum(cyl ^ 2))\r√© mais intuitivo que\nmtcars %\u0026gt;% summarise(cyl = sum(mtcars$cyl ^ 2))\rou ainda\nmtcars %\u0026gt;% mutate(cyl = sum(mtcars[[\u0026quot;cyl\u0026quot;]] ^ 2))\rNo entanto, ao usar o {dplyr} com frequ√™ncia, passamos a querer coloc√°-lo em todos os contextos poss√≠veis, como novas fun√ß√£o ou Shiny apps. Assim, gostar√≠amos de fazer algo do tipo\nminha_fn \u0026lt;- function(dados, variavel) {\rdados %\u0026gt;% summarise(nova_variavel = sum(variavel ^ 2))\r}\rNo entanto, ao experimentar isso, temos o erro\nmtcars %\u0026gt;% minha_fn(cyl)\r# \u0026gt; Error: object \u0026#39;cyl\u0026#39; not found \rVoc√™ j√° se deparou com essa situa√ß√£o? √â bem frustrante. A verdade √© que o tidyverse foi desenvolvido com foco em facilitar o trabalho de an√°lise, com o custo de dificultar o trabalho de programa√ß√£o.\nPor√©m, gra√ßas a avan√ßos recentes no pacote {rlang}, isso est√° ficando mais f√°cil. Nesse post vou mostrar tr√™s casos casos comuns de programa√ß√£o com o tidyverse, e suas solu√ß√µes. Para casos mais complicados, recomendo dar uma olhada no livro sobre Tidyeval.\n\rPara reproduzir esse post, voc√™ precisar√° ter pelo menos a vers√£o 0.4.0 do {rlang} instalado na sua m√°quina!\n\rQuero que minha fun√ß√£o receba um nome sem aspas\rPara isso, podemos usar o quent√≠ssimo operador {{}}, que foi oficialmente apresentado na useR!2019, em Tolouse. Esse operador informa as fun√ß√µes do {dplyr} (e seus amigos {tidyr}, {ggplot2} etc) que olhem para a vari√°vel de dentro da base de dados, ao inv√©s de um objeto supostamente passado como argumento da fun√ß√£o.\nCom isso, a fun√ß√£o anterior fica simples assim:\nminha_fn_sem_aspas \u0026lt;- function(dados, variavel) {\rdados %\u0026gt;% summarise(nova_variavel = sum({{variavel}} ^ 2))\r}\rE sua utiliza√ß√£o:\nmtcars %\u0026gt;% minha_fn_sem_aspas(cyl)\r\r\rnova_variavel\r\r\r\r1324\r\r\r\rZero trauma.\n\rQuero que minha fun√ß√£o receba uma string\rPara isso, teremos de usar o objeto especial .data. Ele permite que voc√™ acesse a informa√ß√£o dos dados antes de aplicar a nova fun√ß√£o. √â muito similar ao . do pacote {magrittr}, para quem j√° conhece.\nminha_fn_com_aspas \u0026lt;- function(dados, variavel) {\rdados %\u0026gt;% summarise(nova_variavel = sum(.data[[variavel]] ^ 2))\r}\rE sua utiliza√ß√£o:\nmtcars %\u0026gt;% minha_fn_com_aspas(\u0026quot;cyl\u0026quot;)\r\r\rnova_variavel\r\r\r\r1324\r\r\r\rShow! Esse provavelmente √© o caso da maioria dos Shiny apps, pois acessamos as informa√ß√µes atrav√©s de input$id_input, que geralmente √© uma string.\nObserva√ß√£o: uma diferen√ßa essencial entre usar .data e . √© que o primeiro consegue lidar com grupos, e o segundo n√£o. Por exemplo, esses c√≥digos t√™m resultados diferentes:\nmtcars %\u0026gt;% group_by(cyl) %\u0026gt;% summarise(nova_variavel = sum(.data[[\u0026quot;cyl\u0026quot;]] ^ 2))\r\r\rcyl\rnova_variavel\r\r\r\r4\r176\r\r6\r252\r\r8\r896\r\r\r\rmtcars %\u0026gt;% group_by(cyl) %\u0026gt;% summarise(nova_variavel = sum(.[[\u0026quot;cyl\u0026quot;]] ^ 2))\r\r\rcyl\rnova_variavel\r\r\r\r4\r1324\r\r6\r1324\r\r8\r1324\r\r\r\rPara a lista completa de diferen√ßas, veja ?rlang::.data.\n\rQuero que minha fun√ß√£o crie uma coluna com nome vari√°vel\rE se voc√™ quiser mudar o nome de nova_variavel e incluir isso como argumento da fun√ß√£o? Nesse caso, √© necess√°rio introduzir o operador :=, e o resto √© resolvido com {{}}:\nminha_fn_sem_aspas_novo_nome \u0026lt;- function(dados, variavel, nome) {\rdados %\u0026gt;% summarise({{nome}} := sum({{variavel}} ^ 2))\r}\rE sua utiliza√ß√£o:\nmtcars %\u0026gt;% minha_fn_sem_aspas_novo_nome(cyl, novo_nome)\r\r\rnovo_nome\r\r\r\r1324\r\r\r\rCuriosamente, essa solu√ß√£o tamb√©m funciona com as aspas:\nmtcars %\u0026gt;% minha_fn_sem_aspas_novo_nome(cyl, \u0026quot;novo_nome\u0026quot;)\r\r\rnovo_nome\r\r\r\r1324\r\r\r\r\rWrap-up\r\rO pacote que est√° por tr√°s da programa√ß√£o com {dplyr} e amigos √© o {rlang}.\rUse {{variavel}} quando n√£o quiser colocar aspas no argumento da fun√ß√£o.\rUse .data[[\"variavel\"]] quando quiser colocar aspas no argumento da fun√ß√£o.\rUse {{nome}} := ... quando quiser criar colunas com nomes que est√£o no argumento da fun√ß√£o.\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-08-21-nse/","tags":["rlang"],"title":"Programando com o tidyverse"},{"author":["Julio"],"categories":["discuss√µes"],"contents":"\rUm dos posts mais legais da Curso-R, na minha opini√£o, √© esse aqui, feito pelo William Amorim. O texto n√£o tem nada de c√≥digos, mas cita motivos pelos quais √© muito bom aprender estat√≠stica e programa√ß√£o.\nMas eu colocaria um t√≥pico adicional no texto, que apesar de ter sido abordado, talvez n√£o tenha ficado com o devido destaque. Eu adicionaria a exist√™ncia da comunidade como elemento primordial para o sucesso no aprendizado de t√≥picos dif√≠ceis, especialmente a ci√™ncia ‚Äì e a estat√≠stica, que √© a meta ci√™ncia ‚Äì e linguagens de programa√ß√£o, com destaque especial para o R.\nEsse post √© uma tentativa de desenvolver esse t√≥pico adicional. Me baseei na palestra dada pela Julia Stewart Lowndes na useR!2019, que foi fant√°stica. Recomendo o texto abaixo para todos que se sentem perdidos quando falamos de ‚Äúcomunidade‚Äù.\nO que √© a comunidade?\rTodos n√≥s fazemos parte da comunidade. Ela √© o motor que faz a ci√™ncia aberta andar e os pacotes do R serem criados. Ningu√©m √© dono da comunidade ‚Äì e nunca ser√°. A √∫nica forma de tirar proveito dela, √© contribuindo, pois ao contribuir, colocamos atra√≠mos a aten√ß√£o dos trabalhos das outras pessoas. √â como se fosse o modelo da colcha de retalhos da teoria da relatividade do Einstein: cada pessoa atrai os trabalhos das outra pessoas, que seguem em diferentes dire√ß√µes.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/comunidade/rubber-\r## sheet.png\u0026quot;, : It is highly recommended to use relative paths for images. You had\r## absolute paths: \u0026quot;/images/posts/conteudo/comunidade/rubber-sheet.webp\u0026quot;\r\rFigura 1: Quem ser√° que √© a bolinha amarela?\r\rContribuir com a comunidade tem duas vantagens principais, ambas indiretas:\nEconomizar tempo. Pessoas v√£o trabalhar para voc√™, de gra√ßa, do nada. Voc√™ ganhar√°, tamb√©m de gra√ßa, o feedback necess√°rio para aprimorar seus trabalhos.\rGanhar dinheiro. As pessoas v√£o come√ßar a te chamar para participar de eventos, workshops e projetos. Esses espa√ßos t√™m um grande impacto na carreira e trazem oportunidades.\r\rIsso, √© claro, sem mencionar todas as vantagens sociais envolvidas. Preferi me ater somente √†s motiva√ß√µes ego√≠sticas para n√£o cair em argumentos baseados em emo√ß√£o.\nMas √© claro que essas vantagens v√™m com um custo. Para contribuir de forma efetiva com a comunidade, precisamos trabalhar.\n\rS√≥ abertura gera abertura\r√â necess√°rio ajudar a comunidade a te ajudar. Ser aberto n√£o √© f√°cil, pois exige o uso de certos padr√µes de organiza√ß√£o que s√£o utilizados por boa parte da comunidade.\nNa comunidade do R, isso envolve, por exemplo: i) usar do GitHub, ii) os princ√≠pios tidy e iii) estilos de programa√ß√£o, como o styleguide do tidyverse, dentre muitos outros.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/comunidade/\r## gentileza.png\u0026quot;, : It is highly recommended to use relative paths for images. You\r## had absolute paths: \u0026quot;/images/posts/conteudo/comunidade/gentileza.webp\u0026quot;\r√â importante destacar que esses padr√µes n√£o s√£o regras definitivas; s√£o apenas conven√ß√µes! Isso significa que n√£o devemos ficar bravos com quem n√£o usa, at√© porque n√≥s mesmos podemos acabar n√£o usando no futuro.\n\rMarketing √© importante\rA comunidade √© densa e dispersa. Por isso, √†s vezes √© necess√°rio dar um empurr√£ozinho nas nossas solu√ß√µes e divulgar nosso trabalho para atrair aten√ß√£o.\nNa comunidade do R, uma boa forma de divulgar nossos trabalhos √© usando do Twitter. Um poss√≠vel caminho seria i) fazer um novo pacote, ii) criar um blog post sobre isso, e iii) divulgar as atualiza√ß√µes do seu pacote de tempos em tempos e iv) interagir/retuittar com todos que citam voc√™ ou seus trabalhos. Para interagir, use a hashtag #rstats, emojis e piadas.\nMas tome cuidado. As redes socias tentam de todas as formas se tornar o objetivo, e n√£o o meio para um fim:\n\r‚ÄúSocial media, it‚Äôs just the market‚Äôs answer to a generation that demanded to perform. So the market said, ‚ÄòHere, perform everything to each other, all the time, for no reason.‚Äô It‚Äôs prison. It‚Äôs horrific. It is performer and audience melded together (‚Ä¶) I know very little about anything, but what I do know is that if you can live your life without an audience, you should do it.‚Äù\nBo Burnham (Make Happy, 2016)\n\rA rede social pode ser t√≥xica e nos tornar improdutivos. Por isso, temos de us√°-la com parcim√¥nia e consci√™ncia.\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/comunidade/\r## bad_opinions.png\u0026quot;, : It is highly recommended to use relative paths for images.\r## You had absolute paths: \u0026quot;/images/posts/conteudo/comunidade/bad_opinions.webp\u0026quot;\r\rFigura 2: https://xkcd.com/2051/\r\r\rA comunidade √© inclusiva\rNo passado, a comunidade de programadores era machista, grossa e antip√°tica. Ela ainda √© assim, mas hoje em dia isso n√£o √© mais legal.\nAgora, regra da comunidade √© ser gentil, mesmo com quem n√£o √© gentil com a gente. Ent√£o se voc√™ acha engra√ßado quando um programador ‚Äúraiz‚Äù tira sarro ou √© grosso com algum iniciante, est√° na hora de mudar. Felizmente isso aconteceu pois a comunidade finalmente chegou √† ‚Äì agora √≥bvia ‚Äì conclus√£o de que, quando somos inclusivos, aumentamos a quantidade de pessoas que contribuem com a gente.\nNa comunidade do R, isso acontece de forma muito especial. √â s√≥ ler o meu post sobre a useR ou o post da Bruna sobre a rstudio::conf para notar o quanto isso √© importante. E √© imposs√≠vel n√£o mencionar aqui o impacto que o RLadies tem nesse grande avan√ßo. Talvez um gr√°fico seja melhor do que palavras para explicar esse fen√¥meno:\n## Warning in knitr::include_graphics(\u0026quot;/images/posts/conteudo/comunidade/rladies-\r## growth.jpeg\u0026quot;, : It is highly recommended to use relative paths for images. You\r## had absolute paths: \u0026quot;/images/posts/conteudo/comunidade/rladies-growth.webp\u0026quot;\r\rFigura 3: https://twitter.com/RLadiesGlobal/status/1148600179236442112/photo/1\r\r\r√â trabalho mesmo?\rC√° entre n√≥s, √© f√°cil confundir esses trabalhos adicionais para que a comunidade nos ajude com simples boas pr√°ticas. Ser organizado, comunicar bem as ideias e ser gentil me parecem ser habilidades que realmente queremos ter na vida.\nMas pode ser dif√≠cil dar o pontap√© inicial. Por isso, separei um pequeno conjunto de sugest√µes para quem quiser entrar nesse mundo:\n\rSe voc√™ √© uma R lady ou faz parte de alguma minoria de g√™nero, participe do RLadies. Acredito que o jeito mais efetivo de entrar seja falando com algu√©m que faz parte, mas se voc√™ quiser, tamb√©m √© poss√≠vel acessar por esse link.\rComece a postar coisas de #rstats no Twitter. Sua primeira fun√ß√£o em R, seu primeiro pacote, seu resultado de sucesso, ou sua enorme falha. As pessoas v√£o come√ßar a interagir com voc√™ e voc√™ estar√° falando com pessoas famosas da comunidade antes que perceba.\rFale com a gente. A Curso-R √© uma empresa voltada a cursos de programa√ß√£o em R. Nossa miss√£o √© descomplicar a ci√™ncia de dados. Todos nossos materiais s√£o p√∫blicos por padr√£o e podem ser acessados pelo GitHub. Pode me procurar no Twitter por jtrecenti ou fale com todo mundo da Curso-R atrav√©s de contato@curso-r.com.\r\rS√£o apenas sugest√µes! Tamb√©m estou aprendendo.\n√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-07-15-comunidade/","tags":["comunidade"],"title":"Programando com a comunidade"},{"author":["Beatriz Milz","Ang√©lica Cust√≥dio"],"categories":["divulga√ß√£o"],"contents":"\r\rTidyverse developer day 2019 (tidy-dev-day)\rEste post tem como objetivo relatar a experi√™ncia de participar do Tidyverse Developer Day 2019, e tem como autoras a Beatriz Milz e a Ang√©lica Cust√≥dio. A Bea √© doutoranda em Ci√™ncia Ambiental na USP, e √© uma das co-organizadoras do R-Ladies S√£o Paulo, que √© uma organiza√ß√£o que tem como objetivo promover a diversidade de g√™nero na comunidade da linguagem R. A Ang√©lica √© formada em estat√≠stica pela UFSCar, e mestranda em Ci√™ncia da Computa√ß√£o na UFABC, tamb√©m faz parte do R-Ladies S√£o Paulo e do PyLadies S√£o Paulo.\nO tidy-dev-day\rO Tidyverse Developer Day (tidy-dev-day) √© um evento com dura√ß√£o de um dia, onde os participantes aprendem mais sobre como contribuir com o tidyverse. O evento relatado aqui foi a segunda edi√ß√£o, sendo que a primeira aconteceu na rstudio::conf2019.\nNesta edi√ß√£o, o tidy-dev-day foi √† parte da confer√™ncia useR!2019, que ocorreu em Toulouse, na Fran√ßa. O evento ocorreu um dia antes do in√≠cio da confer√™ncia, reunindo diversas pessoas que participaram dela.\nAlgo a destacar √© que a organiza√ß√£o da useR!2019 selecionou pessoas para serem contempladas com bolsas de diversidade, fornecendo ajuda financeira a membros de grupos sub-representados na comunidade de R, ou historicamente marginalizados. Essa iniciativa foi fundamental para a participa√ß√£o de diversas pessoas, de diferentes partes do mundo. Inclusive para as duas pessoas que est√£o escrevendo agora sobre a experi√™ncia l√°.\n\rComo funcionou o evento?\rO evento aconteceu no mesmo espa√ßo da useR!2019, e tinha um c√≥digo de conduta, com o objetivo de oferecer um ambiente seguro e amig√°vel para todos os participantes. O evento n√£o foi gratuito: foi necess√°rio pagar uma taxa de $10 (dez d√≥lares), com o intuito de diminuir o n√∫mero de pessoas que se inscreve e n√£o comparece no evento. No entanto, a organiza√ß√£o aponta que o dinheiro ser√° doado.\nComo o objetivo do evento √© proporcionar um aprendizado sobre como contribuir com desenvolvimento e manuten√ß√£o do tidyverse, estavam presentes diversos desenvolvedores e mantenedores do tidyverse, e tamb√©m um time para ajudar os participantes, tirar d√∫vidas, etc.\nO material utilizado (instru√ß√µes, apresenta√ß√µes, sugest√µes de material, etc) est√° dispon√≠vel neste reposit√≥rio no Github.\nEm uma parede no fundo da sala, haviam diversos post-its que indicavam issues a serem trabalhadas, e estavam separadas por pacotes, e tamb√©m por cor, onde a cor indicava o tipo de issue (documenta√ß√£o, bug, feature). Os participantes escolhiam uma issue para trabalhar durante o evento, at√© a realiza√ß√£o de um pull request. Em outra parede, os post-its estavam separados em: post-its de pull requests para serem avaliados pelo Hadley Wickham e outros contribuidores, e os post-its que j√° tinham sido avaliados e aceitos!\nOutra coisa legal √© que o espa√ßo disponibilizou diversas mesas agrupadas, o que ajudava a trabalhar em conjunto.\nLegenda: Foto tirada no tidy-dev-day, por [@Dale_Masch](https://twitter.com/Dale_Masch).\nPara quem estava participando pela primeira vez eram recomendadas as issues de documenta√ß√£o, pois elas s√£o mais naturais para quem nunca fez esse tipo de atividade antes. Para as pessoas que j√° tinham mais familiaridade eram recomendadas issues de bug ou feature que j√° exigem um conhecimento maior n√£o s√≥ do pacote, mas tamb√©m de como desenvolver a melhoria.\n\rExperi√™ncia pessoal - Bea\rEu nunca desenvovi um pacote, e ao chegar no evento nem sabia como pacotes eram estruturados.\rNa issue que eu escolhi, o objetivo era para melhorar uma mensagem de erro da fun√ß√£o filter(), do pacote dplyr, para que a mensagem estivesse de acordo com o style guide do tidyverse.\rLegenda: Foto da issue que estava trabalhando, e tamb√©m da moeda especial que recebemos, por [@Bea_Milz](https://twitter.com/Bea_Milz).\nInicialmente, eu fiz o fork do reposit√≥rio do dplyr, o clone no meu computador, e fiquei sem saber o que fazer depois. Eu n√£o sabia em qual diret√≥rio ficavam as fun√ß√µes, estava com receio de alterar algo e causar algum erro em outras fun√ß√µes do pacote‚Ä¶ Mas ainda bem que tive ajuda! A Ildi Czeller me mostrou em qual diret√≥rio as fun√ß√µes estavam (ali√°s, √© no /R), e e ent√£o consegui encontrar o arquivo que precisava alterar, e qual parte do c√≥digo era correspondente √† fun√ß√£o filter().\rUma coisa que conheci no evento e foi muito interessante √© o conceito de testes, pois tive que alterar o teste referente √† mensagem de erro que eu estava trabalhando.\nAp√≥s fazer as altera√ß√µes que entendi que eram necess√°rias, fiz um pull request. O Hadley respondeu que outra pessoa tamb√©m estava trabalhando neste t√≥pico (haviam duas issues criadas para o mesmo problema), e indicou onde a pessoa estava sentada.\rEnt√£o fui l√° e perguntei para o Colin (que estava trabalhando nesse mesmo problema) se poder√≠amos trabalhar na issue juntos. Ele foi super receptivo! Ele explicou como ele estava resolvendo, e eu tamb√©m mostrei o que havia feito. O Hadley pediu para mudar uma fun√ß√£o usada no teste, e ficamos trabalhando nisso juntos (no caso, eu estava mais aprendendo e perguntando para o Colin, pois os testes eram novidade para mim).\nLegenda: O pull request foi aceito!\nFoi uma experi√™ncia √∫nica, e aprendi muito nesse dia!\n\rExperi√™ncia pessoal - Ang√©lica\rDurante o tidy-dev-day trabalhei em issues do ggplot2, foi uma experi√™ncia totalmente nova para mim e foi super gratificante a sensa√ß√£o de que eu aprendi e tamb√©m pude contribuir.\nNo evento havia v√°rios monitores facilitando a atividade, eles ajudavam desde como fazer o fork no github e trabalhar a issue no R at√© como fazer o pull request para fechar a issue. Contei com a ajuda da Ildi Czeller que era uma das monitoras e me auxiliou em todas as etapas, dando dicas desde configura√ß√µes no git at√© ensinando atalhos no Rstudio que facilitaram a vida (est√£o documentados aqui).\nLegenda: Criando um pull request no pacote ggplot2.\nA atividade promoveu o engajamento e contribui√ß√£o de todos, desde de quem era novato at√© quem j√° tinha bastante experi√™ncia. Era um espa√ßo aberto para tirar d√∫vidas e pedir ajuda, em um determinado momento pude conversar com o Hadley e tirar d√∫vida sobre uma issue que eu estava trabalhando. Entender melhor qual era a interpreta√ß√£o de melhoria daquele ponto com um dos autores do pacote foi um aprendizado incr√≠vel.\n\rConclus√£o\rSegundo o Hadley, mais de 40 pull requests foram aceitos, e quase 30 precisavam ser revisados, o que mostra como o evento :\nHuge thanks to everyone who contributed to tidyverse developer day! We merged over 40 PRs and have almost 30 more to review over the next few days pic.twitter.com/uM9Tg1dMeX\r‚Äî Hadley Wickham (@hadleywickham) July 8, 2019\r\r\rFoi uma √≥tima oportunidade para conhecer pessoas novas tamb√©m! E para conhecer pessoalmente muitas refer√™ncias que temos na comunidade.\nLegenda: Ang√©lica e Bea mostrando as issues que estavam trabalhando no tidy-dev-day, por AngCustodio.\n\r\r","permalink":"https://blog.curso-r.com/posts/2019-08-12-tidydevday/","tags":["eventos"],"title":"Tidyverse developer day 2019"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rNesta s√©rie de posts, apresentamos a todos a nossa primeira tentativa de\rescrever um livro: O Zen do R! Durante\ras √∫ltimas semanas, todas as quartas, trouxemos para o nosso blog os cap√≠tulos\rque j√° escrevemos do livro e respondemos qualquer pergunta sobre o conte√∫do.\nEste √© o √∫ltimo cap√≠tulo (por enquanto)! Vamos falar sobre como armazenar dados\rem um pacote: os diret√≥rios data e data-raw.\nData e data-raw\rNa se√ß√£o anterior, foi discutida a import√¢ncia de empacotar uma an√°lise. Seja\rpara organizar depend√™ncias, reutilizar c√≥digo, manter testes automatizados, ou\rqualquer outra raz√£o, pacotes s√£o a melhor forma de guardar e compartilhar\rc√≥digo em R. Mas, apesar de toda a conversa sobre programa√ß√£o, pouco foi\rabordado sobre outro elemento essencial de uma an√°lise de dados: dados.\nFelizmente, pacotes em R t√™m lugares espec√≠ficos para guardar dados brutos e\rdados tratados. S√£o as pastas data e data-raw, cada uma com as suas\rpropriedades e possibilidades. Ambas podem ser criadas com facilidades por\rfun√ß√µes do pacote usethis, ent√£o elas se encaixam perfeitamente no fluxo de\ran√°lise descrito at√© agora.\nComo indicado anteriormente, existem dois tipos de dados: brutos e tratados.\rNormalmente dados brutos est√£o em formatos comumente compartilhados em ambientes\rde trabalho: planilhas Excel, arquivos CSV, etc. Os pacotes readxl e readr\rpermitem que esses formatos sejam importados para dentro do R, mas normalmente\ressas fun√ß√µes s√£o mais lentas e menos padronizadas do que readRDS(), por\rexemplo, que l√™ arquivos no formato nativo do R.\nAl√©m disso, raramente os dados recebidos durante uma an√°lise estar√£o\rperfeitamente organizados e padronizados. √â comum precisar de m√∫ltiplos fluxos\rde tratamento para poder transformar os dados brutos naquilo que de fato pode\rser utilizado durante uma an√°lise.\nO programador √© encorajado a separar essas planilhas brutas daquelas resultantes\rdo processo de limpeza e tratamento. Junto com os dados cr√∫s, √© importante\rtamb√©m guardar os arquivos que fazem o processo de limpeza; caso haja uma\rmudan√ßa nas demandas ou nas bases, o analista precisa ser capaz de alterar os\rscripts de tratamento e gerar novas bases consolidadas.\nNo exemplo abaixo, sup√µe-se um diret√≥rio com um pacote R e uma base bruta\rdenominada dados.xlsx. Primeiramente deve-se executar a fun√ß√£o\rusethis::use_data_raw() para criar a pasta data-raw e um arquivo de\rtratamento para a base em quest√£o.\nusethis::use_data_raw(\u0026quot;dados\u0026quot;)\r#\u0026gt; ‚úî Setting active project to \u0026#39;~/Documents/demo\u0026#39;\r#\u0026gt; ‚úî Creating \u0026#39;data-raw/\u0026#39;\r#\u0026gt; ‚úî Adding \u0026#39;^data-raw$\u0026#39; to \u0026#39;.Rbuildignore\u0026#39;\r#\u0026gt; ‚úî Writing \u0026#39;data-raw/dados.R\u0026#39;\r#\u0026gt; ‚óè Modify \u0026#39;data-raw/dados.R\u0026#39;\r#\u0026gt; ‚óè Finish the data preparation script in \u0026#39;data-raw/dados.R\u0026#39;\r#\u0026gt; ‚óè Use `usethis::use_data()` to add prepared data to package\rComo indicado pelos tr√™s √∫ltimos pontos da sa√≠da do comando, agora basta colocar\ro c√≥digo de tratamento da base dados em data-raw/dados.R e por fim utilizar\rusethis::use_data() para adicionar os dados preparados ao pacote. Para\rprosseguir o exemplo, o arquivo dados.xlsx foi copiado para o diret√≥rio\rdata-raw e o c√≥digo abaixo foi inserido em data-raw/dados.R.\nlibrary(magrittr)\r# Limpar a base dados.xlsx\rdados \u0026lt;- \u0026quot;data-raw/dados.xlsx\u0026quot; %\u0026gt;%\rreadxl::read_xlsx() %\u0026gt;%\rdplyr::filter(cyl \u0026gt; 4) %\u0026gt;%\rdplyr::mutate(\rbrand = stringr::str_extract(model, \u0026quot;^[A-z]+\u0026quot;)\r) %\u0026gt;%\rdplyr::group_by(brand) %\u0026gt;%\rdplyr::summarise(\rmean_mpg = mean(mpg),\rprop_6_cyl = sum(cyl == 6)/dplyr::n()\r) %\u0026gt;%\rdplyr::arrange(brand)\r# Salvar a base para uso no pacote\rusethis::use_data(dados)\r#\u0026gt; ‚úî Creating \u0026#39;data/\u0026#39;\r#\u0026gt; ‚úî Saving \u0026#39;dados\u0026#39; to \u0026#39;data/dados.rda\u0026#39;\rNeste caso o arquivo Excel foi criado de dentro do pr·πïrio R com o comando\rwritexl::write_xlsx(tibble::rownames_to_column(mtcars, \"model\"), \"data-raw/dados.xlsx\"),\rmas isso √© s√≥ um exemplo ilustrativo. O importante √© saber o que acontece quando\ra fun√ß√£o use_data() √© executada para um objeto do ambiente global, ou seja,\ras duas √∫ltimas linhas do bloco de c√≥digo acima.\nPor tr√°s das c√¢meras, use_data() est√° chamando a fun√ß√£o save() do R para\rgerar um arquivo RDA a partir de um objeto do ambiente global. Arquivos RDA s√£o\rextremamente est√°veis, compactos e podem ser carregados rapidamente pelo R,\rtornando este formato o principal meio de guardar dados de um pacote. Se os\rdados do pacote forem guardados assim, eles ficar√£o dispon√≠veis para serem\rchamados pelo usu√°rio (voc√™ mesmo durante a an√°lise)! Para entender como ficam\ros dados uma vez que eles s√£o inclu√≠dos na pasta data, basta dar uma olhada\rno objeto dplyr::starwars; neste caso, a base tratada e exportada se chama\rstarwars.\nPara carregar os dados na sua sess√£o e poder utiliz√°-los na an√°lise, basta\rexecutar pkgload::load_all() ou pressionar a combina√ß√£o CTRL + SHIFT + L no\rRStudio. Independentemente do n√∫mero de tabelas que estiverem salvas na pasta\rdata, todas ser√£o carregadas instantaneamente.\nA t√≠tulo de curiosidade, existem algumas situa√ß√µes em que as bases brutas s√£o\rgrandes demais para serem sincronizadas com o GitHub. A plataforma tem um\r(razo√°vel) limite de 1GB por reposit√≥rio que pode ser insuficiente para\rarmazenar dados brutos e tratados. Para n√£o sincronizar as bases brutas com o\rGit, basta adicion√°-las ao arquivo .gitignore do pacote; no caso do exemplo\racima, bastaria adicionar a esse arquivo uma linha com o texto\rdata-raw/dados.xlsx.\nDocumenta√ß√£o\rAl√©m de fun√ß√µes, tamb√©m √© poss√≠vel documentar bases de dados com o pacote\rroxygen2. Para isso, crie um arquivo data.R na pasta R/ do pacote e crie\rum objeto entre aspas com o nome de cada base de dados exportada. Documentar\rdados √© extremamente √∫til quando o pacote vai ser compartilhado com m√∫ltiplas\rpessoas da mesma organiza√ß√£o, pois assim n√£o √© necess√°rio compartilhar uma\rplanilha Excel separada descrevendo cada uma das colunas da tabela.\nUma boa documenta√ß√£o de bases de dados n√£o precisa de muita coisa. Abaixo √©\rexemplificado como seria documentada dados:\n#\u0026#39; Dados sobre 15 marcas de carros\r#\u0026#39;\r#\u0026#39; A tabela, gerada a partir de `mtcars`, apresenta algumas poucas\r#\u0026#39; informa√ß√µes sobre carros com mais de 4 cilindros de 15 marcas\r#\u0026#39; americanas de carros.\r#\u0026#39;\r#\u0026#39; @format Uma tabela com 3 colunas e 15 linhas:\r#\u0026#39; \\describe{\r#\u0026#39; \\item{brand}{Marca}\r#\u0026#39; \\item{mean_mpg}{Milhas por gal√£o m√©dias para aquela marca}\r#\u0026#39; \\item{prop_6_cyl}{Propor√ß√£o dos carros que apresentam 6 cilindros}\r#\u0026#39; }\r#\u0026#39; @source Henderson and Velleman (1981)\r\u0026quot;dados\u0026quot;\r\r\r","permalink":"https://blog.curso-r.com/posts/2019-08-13-zen-do-r-7/","tags":["zen-do-r"],"title":"Data e data-raw (Zen do R parte 7)"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rAlguns meses atr√°s o Daniel fez um post demonstrando como colocar autentica√ß√£o em shiny apps, baseado numa implementa√ß√£o do Jos√© Jesus Filho. Depois disso, trabalhamos bastante e conseguimos desenvolver o pacote auth0, que foi apresentado na useR!2019.\nNesse post, darei uma ideia b√°sica de como o pacote funciona, seus desafios atuais e pr√≥ximos passos. Novamente, a melhor forma de utilizar o pacote √© lendo a documenta√ß√£o completa, ent√£o aqui vou me ater a alguns detalhes.\nV√≠deo\rFiz um v√≠deo demonstrando a utiliza√ß√£o do auth0 aqui:\n\rO v√≠deo est√° bem simples e mostra os aspectos iniciais para configurar o Auth0 e fazer funcionar na plataforma shinyapps.io, da RStudio.\n\rDicas\rConfigura√ß√£o com _auth0.yml\rO arquivo yml pode ser criado com auth0::use_auth0() e come√ßa assim:\nname: myApp\rshiny_config:\rlocal_url: http://localhost:8100\rremote_url: \u0026#39;\u0026#39;\rauth0_config:\rapi_url: !expr paste0(\u0026#39;https://\u0026#39;, Sys.getenv(\u0026#39;AUTH0_USER\u0026#39;), \u0026#39;.auth0.com\u0026#39;)\rcredentials:\rkey: !expr Sys.getenv(\u0026quot;AUTH0_KEY\u0026quot;)\rsecret: !expr Sys.getenv(\u0026quot;AUTH0_SECRET\u0026quot;)\rO ideal √© que voc√™ use usethis::edit_r_environ() para adicionar as vari√°veis de configura√ß√£o AUTH0_USER, AUTH0_KEY e AUTH0_SECRET, por quest√µes de seguran√ßa.\n\rArrumando as informa√ß√µes no Auth0\rPelo que notei dos feedbacks da comunidade, a parte mais dif√≠cil de configurar o auth0 √© colocar as URLs no aplicativo. Primeiro, lembre-se sempre de que voc√™ precisa colocar essas informa√ß√µes em tr√™s lugares:\n\rAllowed Callback URLs\rAllowed Web Origins\r\rAqui, se a URL do seu app tiver algo depois do dom√≠nio e da porta, voc√™ deve tirar essas informa√ß√µes. Por exemplo, https://rseis.shinyapps.io/auth0Example vira https://rseis.shinyapps.io somente.\r\rLogout URLs\r\r√â importante notar tamb√©m que voc√™ precisa da URL completa, incluindo os https://, tando no arquivo .yml quanto na configura√ß√£o do Auth0. Esse √© o erro mais comum que notei nos aplicativos dos meus alunos.\n\r\rDesafios\r\rPor enquanto o auth0 n√£o funciona no paradigma ui.R/server.R. Preciso de ajuda para fazer funcionar! O problema principal aqui √© que talvez seja necess√°rio alterar algumas coisas no ambiente ao carregar o pacote, e eu gostaria de fazer isso da maneira menos intrusiva poss√≠vel.\rSeria interessante implementar toda a extensa API do auth0 no R, para ficar mais f√°cil de setar as web origins e configurar usu√°rios. Mas isso d√° bastante trabalho e eu tamb√©m aceito ajuda.\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-07-19-auth0-pkg/","tags":["auth0"],"title":"Autentica√ß√£o em Shiny Apps com o pacote auth0"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rNesta s√©rie de posts, estamos apresentamos a todos a nossa primeira tentativa de\rescrever um livro: O Zen do R! Durante\ras √∫ltimas semanas, todas as quartas, trouxemos para o nosso blog os cap√≠tulos\rque j√° escrevemos do livro e respondemos qualquer pergunta sobre o conte√∫do.\nEste √© o pen√∫ltimo cap√≠tulo, mas provavelmente √© o mais importante! Falamos\rsobre pacotes: por que e como faz√™-los.\nPacotes\rNas palavras do maior guru do R, Hadley Wickham, ‚Äúpacotes s√£o a unidade\rfundamental de c√≥digo R reprodut√≠vel‚Äù. Toda vez que voc√™ utiliza a fun√ß√£o\rlibrary(), algum pacote est√° sendo carregado na sess√£o. Muitas vezes criar uma\rbiblioteca de fun√ß√µes pode parecer uma tarefa √°rdua e confusa, restrita a\rgrandes conhecedores da linguagem, mas essa impress√£o n√£o poderia estar mais\rdistante da realidade: pacotes para o R s√£o bastante simples e intuitivos de\rfazer.\nNo in√≠cio deste livro foi abordado o conceito de projeto. Ele n√£o passa de um\rarquivo .Rproj que indica para o RStudio que aquele diret√≥rio √© um ambiente de\rtrabalho estruturado. Nesse sentido, pacotes iguais a projetos porque eles\rtamb√©m t√™m um .Rproj; pacotes na verdade s√£o projetos.\nA diferen√ßa entre os dois √© que pacotes podem ser documentados e instalados,\rpermitindo toda uma gama de novas possibilidades para o programador.\rMuitas vezes uma an√°lise de dados pode envolver dezenas de fun√ß√µes e diversas\rpessoas, fazendo com que o compartilhamento de c√≥digo seja vital para que a\ran√°lise n√£o fuja do controle. Pacotes permitem gerenciar depend√™ncias, manter\rdocumenta√ß√£o, executar testes unit√°rios e muito mais com o objetivo de deixar\rtodos os analistas na mesma p√°gina.\nSendo assim, recomenda-se criar um pacote para qualquer an√°lise que envolva pelo\rmenos meia d√∫zia de fun√ß√µes complexas e mais de uma pessoa; caso contr√°rio, um\rprojeto j√° √© suficiente. Outra motiva√ß√£o para criar um pacote √© compartilhar\rconjuntos √∫teis de fun√ß√µes com outras pessoas; isso acaba sendo menos comum para\ra maioria dos usu√°rios, mas √© importante ressaltar que o R n√£o seria a linguagem\rpopular que √© hoje se n√£o fossem pelas famosas bibliotecas ggplot2 e dplyr.\nusethis::create_package(\u0026quot;~/Documents/demo\u0026quot;)\r#\u0026gt; ‚úî Setting active project to \u0026#39;~/Documents/demo\u0026#39;\r#\u0026gt; ‚úî Creating \u0026#39;R/\u0026#39;\r#\u0026gt; ‚úî Writing \u0026#39;DESCRIPTION\u0026#39;\r#\u0026gt; Package: demo\r#\u0026gt; Title: What the Package Does (One Line, Title Case)\r#\u0026gt; Version: 0.0.0.9000\r#\u0026gt; Authors@R (parsed):\r#\u0026gt; * First Last \u0026lt;first.last@example.com\u0026gt; [aut, cre]\r#\u0026gt; Description: What the package does (one paragraph).\r#\u0026gt; License: What license it uses\r#\u0026gt; Encoding: UTF-8\r#\u0026gt; LazyData: true\r#\u0026gt; ‚úî Writing \u0026#39;NAMESPACE\u0026#39;\r#\u0026gt; ‚úî Writing \u0026#39;demo.Rproj\u0026#39;\r#\u0026gt; ‚úî Adding \u0026#39;.Rproj.user\u0026#39; to \u0026#39;.gitignore\u0026#39;\r#\u0026gt; ‚úî Adding \u0026#39;^demo\\\\.Rproj$\u0026#39;, \u0026#39;^\\\\.Rproj\\\\.user$\u0026#39; to \u0026#39;.Rbuildignore\u0026#39;\r#\u0026gt; ‚úî Opening \u0026#39;~/Documents/demo/\u0026#39; in new RStudio session\r#\u0026gt; ‚úî Setting active project to \u0026#39;demo\u0026#39;\rA fun√ß√£o executada acima √© exatamente an√°loga √† fun√ß√£o de cria√ß√£o de projetos.\rA principal diferen√ßa √© que ela cria um arquivo DESCRIPTION e assume que o\rnome do pacote √© igual ao nome da pasta onde o mesmo est√° sendo criado (neste\rcaso, ‚Äúdemo‚Äù). Alguns outros arquivos tamb√©m s√£o criados (como .Rbuildignore e\rNAMESPACE), mas eles n√£o v√™m ao caso. De resto, o pacote √© id√™ntico a um\rprojeto e pode ser sincronizado com o Git exatamente da mesma maneira.\nO primeiro passo para come√ßar a usar um pacote √© atribuir a ele uma licen√ßa\r(caso um dia voc√™ resolva compartilh√°-lo com o mundo) e preencher a descri√ß√£o.\rAbaixo encontra-se uma fun√ß√£o simples que adiciona uma licen√ßa MIT ao pacote.\nusethis::use_mit_license(\u0026quot;Seu Nome\u0026quot;)\r#\u0026gt; ‚úî Setting active project to \u0026#39;~/Documents/demo\u0026#39;\r#\u0026gt; ‚úî Setting License field in DESCRIPTION to \u0026#39;MIT + file LICENSE\u0026#39;\r#\u0026gt; ‚úî Writing \u0026#39;LICENSE.md\u0026#39;\r#\u0026gt; ‚úî Adding \u0026#39;^LICENSE\\\\.md$\u0026#39; to \u0026#39;.Rbuildignore\u0026#39;\r#\u0026gt; ‚úî Writing \u0026#39;LICENSE\u0026#39;\rO arquivo de descri√ß√£o, no entanto, √© um pouco mais complexo porque ele tem\ralguns campos que precisam ser preenchidos manualmente. Quando o pacote for\rcriado, eles j√° estar√£o populados com instru√ß√µes para facilitar a vida do\rprogramador. Abaixo est√° um exemplo de como DESCRIPTION deve ficar depois de\rcompleto:\nPackage: demo\rTitle: O Que o Pacote Faz (Uma Linha)\rVersion: 0.0.0.9000\rAuthors@R: person(given = \u0026quot;Seu\u0026quot;,\rfamily = \u0026quot;Nome\u0026quot;,\rrole = c(\u0026quot;aut\u0026quot;, \u0026quot;cre\u0026quot;),\remail = \u0026quot;seunome@dominio.com\u0026quot;)\rDescription: O que o pacote faz (um paragrafo curto terminado em ponto final).\rLicense: MIT + file LICENSE\rEncoding: UTF-8\rLazyData: true\rA partir deste ponto, os metadados do pacote est√£o essencialmente prontos e n√£o\rprecisam mais ser modificados. Assim como em um projeto, o que resta √© adicionar\rarquivos com fun√ß√µes √† pasta R/.\nDocumenta√ß√£o\rPara poder programar pacotes com mais facilidade, √© necess√°rio instalar o\rdevtools. Assim como o tidyverse, este √© um conjunto de pacotes (que inclui\ro usethis por sinal) que auxiliam no processo de criar e testar um pacote de\rR.\ninstall.packages(\u0026quot;devtools\u0026quot;)\rA partir de agora voc√™ pode, por exemplo, criar documenta√ß√µes para as fun√ß√µes do\rseu pacote. Quando outras pessoas o instalarem, elas poder√£o consultar esses\rmanuais da mesma forma que fazem com qualquer outra fun√ß√£o: ?funcao().\nA documenta√ß√£o mais simples (e obrigat√≥ria) envolve dar um t√≠tulo para a fun√ß√£o\re descrever o que cada par√¢metro significa. Para documentar uma fun√ß√£o qualquer,\rbasta adicionar coment√°rios em cima dela com #' assim como no exemplo abaixo:\n#\u0026#39; Fun√ß√£o demonstrativa que soma e imprime\r#\u0026#39;\r#\u0026#39; @param x Um n√∫mero ou vetor num√©rico\r#\u0026#39; @param y Um n√∫mero ou vetor num√©rico\r#\u0026#39; @param ... Outros argumentos passados para [print()]\r#\u0026#39;\r#\u0026#39; @export\rfuncao_demo \u0026lt;- function(x, y, ...) {\rz \u0026lt;- x + y\rprint(z, ...)\rreturn(z)\r}\rNo RStudio esse tipo de documenta√ß√£o √© tratado diferentemente de outros\rcoment√°rios, ent√£o certas palavras-chave ficam coloridas. @param por exemplo\rindica a documenta√ß√£o de um dos par√¢metros e @export indica que aquela fun√ß√£o\rser√° exportada pelo pacote, ou seja, ficar√° dispon√≠vel ao usu√°rio quando ele\rexecutar library(demo).\nPara gerar a documenta√ß√£o do pacote, basta chamar uma outra fun√ß√£o do\rdevtools:\ndevtools::document()\r#\u0026gt; Updating demo documentation\r#\u0026gt; Updating roxygen version in ~/Documents/demo/DESCRIPTION\r#\u0026gt; Writing NAMESPACE\r#\u0026gt; Loading demo\r#\u0026gt; Writing NAMESPACE\r#\u0026gt; Writing funcao_demo.Rd\r?funcao_demo()\r#\u0026gt; Rendering development documentation for \u0026#39;funcao_demo\u0026#39;\rConforme o n√∫mero de fun√ß√µes no pacote for crescendo, basta iterar nesse ciclo\rdescrito at√© aqui. Al√©m disso, √© importante lembrar (como destacado na sess√£o\ranterior) que qualquer fun√ß√£o utilizada de outro pacote deve ser invocada na\rforma pacote::funcao(); neste momento, o pacote em quest√£o se tornar√° uma\rdepend√™ncia do seu pacote e deve ser declarado como tal com\rusethis::use_package(\"pacote\").\nPara garantir que o R n√£o encontrar√° nenhum problema no seu pacote, basta\rexecutar a fun√ß√£o de verifica√ß√£o devtools::check(). Se nenhum defeito for\rencontrado, basta compartilhar o pacote com os seus colegas e instal√°-lo com\rdevtools::install_local().\ndevtools::check()\r#\u0026gt; Updating demo documentation\r#\u0026gt; Writing NAMESPACE\r#\u0026gt; Loading demo\r#\u0026gt; Writing NAMESPACE\r#\u0026gt; ‚îÄ‚îÄ Building ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ demo ‚îÄ‚îÄ\r#\u0026gt; Setting env vars:\r#\u0026gt; ‚óè CFLAGS : -Wall -pedantic -fdiagnostics-color=always\r#\u0026gt; ‚óè CXXFLAGS : -Wall -pedantic -fdiagnostics-color=always\r#\u0026gt; ‚óè CXX11FLAGS: -Wall -pedantic -fdiagnostics-color=always\r#\u0026gt; ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\r#\u0026gt; ‚úî checking for file ‚Äò/home/clente/Documents/demo/DESCRIPTION‚Äô ...\r#\u0026gt; #\u0026gt; [... omitido por brevidade ...]\r#\u0026gt; #\u0026gt; ‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ demo 0.0.0.9000 ‚îÄ‚îÄ‚îÄ‚îÄ\r#\u0026gt; Duration: 8.2s\r#\u0026gt; #\u0026gt; 0 errors ‚úî | 0 warnings ‚úî | 0 notes ‚úî\r\rTestes automatizados\rAntes de concluir a sess√£o sobre pacotes, se faz necess√°ria uma breve men√ß√£o aos\rtestes automatizados. Eles s√£o disponibilizados pelo pacote testthat e\rpermitem que um programador verifique que seu c√≥digo est√° atendendo √†s\respecifica√ß√µes. Testes unit√°rios garantem que uma altera√ß√£o pontual em algum\rponto do c√≥digo n√£o vai alterar o comportamento de nenhuma outra parte, j√° que\ras outras fun√ß√µes ainda ter√£o que passar nos seus pr√≥prios testes.\nPara criar um conjunto de testes √© necess√°rio primeiro criar o ambiente para tal\rdentro do pacote. Depois disso, basta criar conjuntos individuais de testes para\rcada fun√ß√£o.\nusethis::use_testthat()\r#\u0026gt; ‚úî Adding \u0026#39;testthat\u0026#39; to Suggests field in DESCRIPTION\r#\u0026gt; ‚úî Creating \u0026#39;tests/testthat/\u0026#39;\r#\u0026gt; ‚úî Writing \u0026#39;tests/testthat.R\u0026#39;\r#\u0026gt; ‚óè Call `use_test()` to initialize a basic test file and open it for editing.\rusethis::use_test(\u0026quot;funcao_demo\u0026quot;)\r#\u0026gt; ‚úî Increasing \u0026#39;testthat\u0026#39; version to \u0026#39;\u0026gt;= 2.1.0\u0026#39; in DESCRIPTION\r#\u0026gt; ‚úî Writing \u0026#39;tests/testthat/test-funcao_demo.R\u0026#39;\r#\u0026gt; ‚óè Modify \u0026#39;tests/testthat/test-funcao_demo.R\u0026#39;\rComo √© poss√≠vel notar, o pacote testthat permite criar um arquivo de testes\rpara funcao_demo() (neste caso tests/testthat/test-funcao_demo.R). Esse\rarquivo j√° vem com um teste padr√£o a t√≠tulo de demonstra√ß√£o, mas, depois de\rreescrito manualmente, um poss√≠vel conjunto de testes para funcao_demo() seria\ro seguinte:\nlibrary(demo)\rtest_that(\u0026quot;funcao_demo funciona\u0026quot;, {\rexpect_equal(funcao_demo(1, 2), 3)\rexpect_equal(funcao_demo(-1, -2), -3)\rexpect_equal(funcao_demo(1, -2), -1)\rexpect_output(funcao_demo(1, 2), \u0026quot;3\u0026quot;)\r})\rE o resultado da execu√ß√£o dos testes √© o seguinte:\ndevtools::test()\r#\u0026gt; Loading demo\r#\u0026gt; Testing demo\r#\u0026gt; ‚úî | OK F W S | Context\r#\u0026gt; ‚úî | 4 | funcao_demo\r#\u0026gt; #\u0026gt; ‚ïê‚ïê Results ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r#\u0026gt; OK: 4\r#\u0026gt; Failed: 0\r#\u0026gt; Warnings: 0\r#\u0026gt; Skipped: 0\r#\u0026gt; #\u0026gt; Keep up the good work.\r\r\r","permalink":"https://blog.curso-r.com/posts/2019-08-07-zen-do-r-6/","tags":["zen-do-r"],"title":"Pacotes (Zen do R parte 6)"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rDesenvolver shiny apps √© muito divertido, mas d√° trabalho. Os apps come√ßam com uma ideia simples, mas v√£o crescendo at√© o ponto que n√£o conseguimos mais entender onde est√£o os peda√ßos do app.\nPara resolver esse problema, os m√≥dulos foram criados. Com m√≥dulos, √© poss√≠vel separar peda√ßos de um shiny em scripts separados, que s√£o adicionados como fun√ß√µes dentro do app principal. Os m√≥dulos facilitam muito a manuten√ß√£o dos apps.\nNo entanto, novos problemas podem surgir em apps complexos. Um m√≥dulo pode usar fun√ß√µes de certo pacote, e √†s vezes esquecemos de checar se ele existe quando o app for colocado em produ√ß√£o. Al√©m disso, como existem v√°rios jeitos de organizar os arquivos que cont√©m os scripts dos m√≥dulos dentro do projeto, cada app acaba ficando com uma estrutura diferente.\nPara resolver esse problema, uma alternativa muito √∫til √© desenvolver o shiny dentro de um pacote. Dessa forma, as depend√™ncias s√£o checadas automaticamente, os m√≥dulos se tornam fun√ß√µes do pacote e tudo deve ficar documentado e organizado por padr√£o. Eu tenho essa pr√°tica desde 2018, quando percebi que meus apps estavam ficando muito complicados de manter.\nO pacote golem √© a generaliza√ß√£o dessa ideia. O pacote sugere um fluxo de trabalho excelente para desenvolver seu app dentro de um pacote do R. O pacote ainda n√£o est√° no CRAN, ent√£o use com cuidado. V√°rias coisas podem mudar!\nEu acredito que a melhor documenta√ß√£o poss√≠vel do golem √© a que est√° na pr√≥pria p√°gina do pacote. Eu simplesmente segui o tutorial indicado e em 5 minutos estava com meu app modular e funcionando perfeitamente. Por isso, vou apenas destacar alguns detalhes que considero importantes e podem acabar despercebidos numa primeira leitura.\nComo o golem trata de shiny apps dentro de pacotes, o ideal √© que voc√™ tenha algum conhecimento em desenvolvimento de pacotes. Se tiver interesse, o melhor material poss√≠vel sobre isso √© o http://r-pkgs.org.\nComo o golem funciona?\rO pacote √© uma esp√©cie de usethis para shiny apps. Ali√°s, se voc√™ n√£o conhece o usethis, pare tudo o que voc√™ est√° fazendo e acesse essa p√°gina. Ao criar um shiny app com o template do golem, voc√™ ver√° uma estrutura de arquivos assim\nDESCRIPTION ¬¶--dev/ # desenvolvimento\r¬¶--01_start.R ¬¶--02_dev.R ¬¶--03_deploy.R ¬¶--run_dev.R\r¬¶--inst/ # aqui fica o aplicativo\r¬¶--app ¬¶--server.R ¬¶--ui.R ¬¶--www/ ¬¶--favicon.ico\r¬¶--man/ # documenta√ß√£o das fun√ß√µes/m√≥dulos do pacote\r¬¶--run_app.Rd NAMESPACE # informa as fun√ß√µes que o pacote importa e exporta\rmyapp.Rproj # projeto\r¬¶--R/ # aqui ficam os m√≥dulos e as fun√ß√µes que geram ui e server\r¬¶--app_server.R ¬¶--app_ui.R ¬¶--run_app.R \rEssa √© uma estrutura de pacotes do R, com algumas coisas a mais.\n\rA pasta dev/, que geralmente n√£o existe em pacotes, cont√©m o tutorial que o usu√°rio deve seguir para fazer o setup e o desenvolvimento do app. O ideal √© ler esses scripts e ir rodando tudo com calma, verificando o que cada fun√ß√£o altera nos seus arquivos.\rA paste inst/ √© uma pasta especial que √© copiada diretamente na pasta do pacote, sem nenhuma modifica√ß√£o. √â gra√ßas √† ela que conseguimos acessar arquivos atrav√©s da fun√ß√£o system.file(), por exemplo. Por isso, √© nessa pasta que fica o nosso shiny app de verdade.\r\rO mais interessante de um app criado dessa forma √© que os arquivos ui.R e server.R ficam praticamente vazios. Isso acontece porque todo o trabalho sujo est√° sendo feito pelas fun√ß√µes app_ui() e app_server(), que agora s√£o fun√ß√µes documentadas do seu pacote.\n\rCaracter√≠sticas interessantes\r\rCom o golem, √© f√°cil de criar uma imagem Docker do seu app, o que facilita o deploy em escala. Atualmente, estou testando formas de integrar essa funcionalidade com a Google Cloud Platform, e parece bem promissor.\rO golem te obriga a documentar tudo o que voc√™ faz. Isso pode parecer entediante no in√≠cio, mas se paga no futuro.\rExistem fun√ß√µes que facilitam a utiliza√ß√£o de javascript e css no app, o que geralmente √© algo doloroso no desenvolvimento de apps no shiny.\r\r\rV√≠deo\rMontei um v√≠deo r√°pido mostrando a utiliza√ß√£o do golem na constru√ß√£o de um app simples, colocado no shinyapps.io. Se quiser acessar esse app, o link est√° na descri√ß√£o do v√≠deo!\n\rO √°udio ficou um pouco baixo e o meu computador estava fazendo um pouco de barulho. Mas voc√™ pode simplesmente ver sem o √°udio, ele nem importa muito.\n√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-07-16-golem/","tags":["golem","shiny"],"title":"Shiny Apps Empacotados com o golem"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rNesta s√©rie de posts, estamos apresentamos a todos a nossa primeira tentativa de\rescrever um livro: O Zen do R! Durante\ras pr√≥ximas semanas, todas as quartas, traremos para o nosso blog os cap√≠tulos\rque j√° escrevemos do livro e responderemos qualquer pergunta sobre o conte√∫do.\nHoje o assunto √© ideal para quem precisa escrever c√≥digo reprodut√≠vel: fun√ß√µes\re depend√™ncias.\nFun√ß√µes e depend√™ncias\rAt√© este momento, foi abordada apenas uma forma de organizar os arquivos de uma\ran√°lise: projetos. Entretanto existe ainda outra maneira, ainda mais\rinteressante, de guardar an√°lises. Se voc√™ programou em R, com certeza j√° se\rdeparou com essa ferramenta, os bons e velhos pacotes ou bibliotecas. √â\rsurpreendentemente f√°cil criar um diret√≥rio que pode ser completamente acessado\ratrav√©s da fun√ß√£o library().\nQuando uma tarefa de an√°lise de dados aumenta em complexidade, o n√∫mero de\rfun√ß√µes e arquivos necess√°rios para manter tudo em ordem cresce\rexponencialmente. Um arquivo para ler os dados, outro para limpar os nomes das\rcolunas, mais um para fazer joins‚Ä¶ Cada um deles com incont√°veis blocos de\rc√≥digo que rapidamente se transformam em uma\rmacarronada.\nO primeiro passo para sair dessa situa√ß√£o √© transformar tudo em fun√ß√µes. Essa\rtarefa est√° longe de simples, mas os benef√≠cios s√£o imensos; ao encontrar um\rerro no resultado, fica bem mais f√°cil depurar a fun√ß√£o culpada do que uma\rcole√ß√£o desordenada de c√≥digo. Fun√ß√µes t√™m argumentos e sa√≠das, enquanto c√≥digo\rsolto pode modificar globais e criar resultados tardios que s√£o imposs√≠veis de\racompanhar sem conhecer profundamente a tarefa sendo realizada.\nlibrary(dplyr)\rlibrary(tibble)\r# Limpar dados\rmtcars_clean \u0026lt;- mtcars %\u0026gt;%\rrownames_to_column(var = \u0026quot;model\u0026quot;) %\u0026gt;%\ras_tibble() %\u0026gt;%\rfilter(cyl \u0026lt; 8)\r# Selecionar carros com 4 cyl e tirar m√©dia de mpg e wt\rmtcars_clean %\u0026gt;%\rfilter(cyl == 4) %\u0026gt;%\rgroup_by(cyl) %\u0026gt;%\rsummarise(\rmpg = mean(mpg),\rwt = mean(wt)\r)\r#\u0026gt; # A tibble: 1 x 3\r#\u0026gt; cyl mpg wt\r#\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 4 26.7 2.29\r# Selecionar carros com 6 cyl e tirar m√©dia de drat e disp\rmtcars_clean %\u0026gt;%\rfilter(cyl == 6) %\u0026gt;%\rgroup_by(cyl) %\u0026gt;%\rsummarise(\rdrat = mean(drat),\rdisp = mean(disp)\r)\r#\u0026gt; # A tibble: 1 x 3\r#\u0026gt; cyl drat disp\r#\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 6 3.59 183.\rO c√≥digo acima √© somente um exemplo de an√°lise. Como descrito pelos coment√°rios,\rmtcars √© limpa e depois s√£o extra√≠das as m√©dias de diferentes vari√°veis para\rduas sele√ß√µes da tabela (n√∫mero de cilindros igual a 4 e 6). Abaixo est√°\rdescrita uma forma de transformar a maioria deste c√≥digo em fun√ß√µes. √â verdade\rque pela natureza simples do exemplo, fica dif√≠cil ver os benef√≠cios do\rencapsulamento das tarefas de limpeza e resumo, mas perceba, por exemplo, que,\rse fosse necess√°rio trocar mean() por median(), antes seria necess√°rio\ralterar quatro linhas e agora apenas uma. Esse tipo de ganho a longo prazo pode\rsalvar an√°lises inteiras do caos.\nlibrary(dplyr)\rlibrary(tibble)\r# Limpa tabela, filtrando cyl \u0026lt; cyl_max\rclean \u0026lt;- function(data, cyl_max = 8) {\rdata %\u0026gt;%\rrownames_to_column(var = \u0026quot;model\u0026quot;) %\u0026gt;%\ras_tibble() %\u0026gt;%\rfilter(cyl \u0026lt; cyl_max)\r}\r# Resume tabela onde cyl == cyl_max, tirando m√©dia das colunas em ...\rsummarise_cyl \u0026lt;- function(data, cyl_num, ...) {\rdata %\u0026gt;%\rfilter(cyl == cyl_num) %\u0026gt;%\rgroup_by(cyl) %\u0026gt;%\rsummarise_at(vars(...), mean)\r}\r# 4 cyl, m√©dia de mpg e wt\rmtcars %\u0026gt;%\rclean(cyl_max = 8) %\u0026gt;%\rsummarise_cyl(cyl_num = 4, mpg, wt)\r#\u0026gt; # A tibble: 1 x 3\r#\u0026gt; cyl mpg wt\r#\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 4 26.7 2.29\r# 6 cyl, m√©dia de drat e disp\rmtcars %\u0026gt;%\rclean(cyl_max = 8) %\u0026gt;%\rsummarise_cyl(cyl_num = 6, drat, disp)\r#\u0026gt; # A tibble: 1 x 3\r#\u0026gt; cyl drat disp\r#\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 6 3.59 183.\rUm c√≥digo bem encapsulado reduz a necessidade de objetos intermedi√°rios (\rbase_tratada, base_filtrada, etc.) pois para gerar um deles basta a\raplica√ß√£o de uma fun√ß√£o. Al√©m disso, programas com fun√ß√µes normalmente s√£o muito\rmais enxutos e limpos do que scripts soltos, pois estes estimulam repeti√ß√£o de\rc√≥digo. √Äs vezes √© mais r√°pido copiar e colar um peda√ßo de c√≥digo e adapt√°-lo ao\rnovo contexto do que criar uma fun√ß√£o que generalize a opera√ß√£o desejada para as\rduas situa√ß√µes, mas os benef√≠cios das fun√ß√µes s√£o de longo prazo: ao encontrar\rum bug, haver√° apenas um lugar para concertar; se surgir a necessidade de\rmodificar uma propriedade, haver√° apenas um lugar para editar; se aquele c√≥digo\rse tornar obsoleto, haver√° apenas um lugar para deletar.\nPense na programa√ß√£o funcional1 como ir √† academia. No in√≠cio o processo √©\rdif√≠cil e exige uma quantidade consider√°vel de esfor√ßo, mas depois de um tempo\rse torna um h√°bito e traz benef√≠cios consider√°veis para a sa√∫de (neste caso, do\rc√≥digo). As recomenda√ß√µes para quando criar uma nova fun√ß√£o ou separar uma\rfun√ß√£o em duas variam muito, mas normalmente √© uma boa ideia n√£o deixar uma\r√∫nica fun√ß√£o ser encarregada de mais uma tarefa ou ficar longa/complexa demais.\nNo mundo ideal, na pasta R/ do seu projeto haver√° uma cole√ß√£o de arquivos,\rcada um com uma cole√ß√£o de fun√ß√µes relacionadas e bem documentadas, e apenas\ralguns arquivos que utilizam essas fun√ß√µes para realizar a an√°lise em si. Como\rdito anteriormente, isso fica muito mais f√°cil se voc√™ j√° tiver esse objetivo em\rmente desde o momento de cria√ß√£o do novo projeto.\n::\rNo exemplo da se√ß√£o anterior, √© poss√≠vel notar as chamadas para as bibliotecas\rdplyr e tibble. Elas t√™m in√∫meras fun√ß√µes √∫teis, mas aqui somente algumas\rpoucas foram utilizadas. Al√©m disso, se o c√≥digo fosse muito maior, ficaria\rimposs√≠vel saber de uma biblioteca ainda est√° sendo utilizada; se n√£o fosse mais\rnecess√°rio utilizar rownames_to_column(), qual seria a melhor forma de saber\rque pode ser removida a chamada library(tibble)?\nA resposta para essa pergunta pode assustar: no c√≥digo ideal, a fun√ß√£o\rlibrary() nunca seria chamada, todas as fun√ß√µes teriam seus pacotes de origem\rexplicitamente referenciados pelo operador ::.\nEsta subse√ß√£o est√° separada porque ela de fato √© um pouco radical demais. √â\rexcessivamente preciosista pedir para que qualquer an√°lise em R seja feita sem\ra invoca√ß√£o de nenhuma biblioteca, apenas com chamadas do tipo\rbiblioteca::funcao(). Muitas pessoas inclusive nem sabem que √© poss√≠vel\rinvocar uma fun√ß√£o diretamente atrav√©s dessa sintaxe!\nSe algum leitor estiver tendendo a seguir o caminho do TOC da programa√ß√£o,\rexistem dois grandes benef√≠cios em chamar todas as fun√ß√µes diretamente:\r- O c√≥digo, no total, executa um pouco mais r√°pido porque s√£o carregadas menos\rfun√ß√µes no ambiente global (isso √© especialmente importante em aplica√ß√µes\rinterativas feitas em Shiny).\r- As depend√™ncias do c√≥digo est√£o sempre atualizadas porque elas est√£o\rdiretamente atreladas √†s pr√≥prias fun√ß√µes sendo utilizadas.\nExiste um terceiro e importante benef√≠cio, mas este ser√° abordado apenas no\rpr√≥ximo cap√≠tulo. A t√≠tulo de curiosidade, o c√≥digo anterior ficaria assim caso\rfosse escrito sem as chamadas para library():\n# Refer√™ncia ao pipe\r`%\u0026gt;%` \u0026lt;- magrittr::`%\u0026gt;%`\r# Limpa tabela, filtrando cyl \u0026lt; cyl_max\rclean \u0026lt;- function(data, cyl_max = 8) {\rdata %\u0026gt;%\rtibble::rownames_to_column(var = \u0026quot;model\u0026quot;) %\u0026gt;%\rdplyr::as_tibble() %\u0026gt;%\rdplyr::filter(cyl \u0026lt; cyl_max)\r}\r# Resume tabela onde cyl == cyl_max, tirando m√©dia das colunas em ...\rsummarise_cyl \u0026lt;- function(data, cyl_num, ...) {\rdata %\u0026gt;%\rdplyr::filter(cyl == cyl_num) %\u0026gt;%\rdplyr::group_by(cyl) %\u0026gt;%\rdplyr::summarise_at(dplyr::vars(...), mean)\r}\r# 4 cyl, m√©dia de mpg e wt\rmtcars %\u0026gt;%\rclean(cyl_max = 8) %\u0026gt;%\rsummarise_cyl(cyl_num = 4, mpg, wt)\r#\u0026gt; # A tibble: 1 x 3\r#\u0026gt; cyl mpg wt\r#\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 4 26.7 2.29\r# 6 cyl, m√©dia de drat e disp\rmtcars %\u0026gt;%\rclean(cyl_max = 8) %\u0026gt;%\rsummarise_cyl(cyl_num = 6, drat, disp)\r#\u0026gt; # A tibble: 1 x 3\r#\u0026gt; cyl drat disp\r#\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 6 3.59 183.\rSe serve de consolo, o RStudio facilita muito esse tipo de programa√ß√£o por causa\rda sua capacidade de sugerir continua√ß√µes para c√≥digo interativamente. Para\rescrever dplyr::, por exemplo, basta digitar d, p, l e apertar TAB uma\rvez. Com os ::, as sugest√µes passar√£o a ser somente de fun√ß√µes daquele pacote.\n\r\r\rAqui o termo ‚Äúprograma√ß√£o funcional‚Äù √© usado de forma figurativa. Na\rcomputa√ß√£o linguagens denominadas ‚Äúfuncionais‚Äù tem um modus operandi bastante\respec√≠fico n√£o abordado neste cap√≠tulo.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2019-07-30-zen-do-r-5/","tags":["Zen do R"],"title":"Fun√ß√µes e Depend√™ncias (Zen do R parte 5)"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rNesta s√©rie de posts, estamos apresentamos a todos a nossa primeira tentativa de\rescrever um livro: O Zen do R! Durante\ras pr√≥ximas semanas, todas as quartas, traremos para o nosso blog os cap√≠tulos\rque j√° escrevemos do livro e responderemos qualquer pergunta sobre o conte√∫do.\nHoje o assunto √© como usar projetos no R para nunca mais perder um arquivo\rimportante.\nGit e GitHub\rH√° poucas coisas mais frustrantes no mundo do que ter que refazer um trabalho.\rPerder progresso j√° feito por algum erro ou acidente transforma qualquer\rpacifista em um vulc√£o prestes a entrar em erup√ß√£o. Quando se trata de\rprograma√ß√£o, h√° v√°rias formas de isso acontecer: um disco r√≠gido que falha, o\rcopo de caf√© derramado no lugar errado, aquela altera√ß√£o que n√£o pode ser\rdesfeita.\nEste problema est√° longe de ser novo. Em 2005, Linus Torvalds (o criador do\rLinux) se deparava com essas quest√µes durante o seu desenvolvimento do kernel\rde seu sistema operacional. Muitas pessoas contribuindo para um mesmo c√≥digo,\rfazendo altera√ß√µes que deveriam ser revistas e possivelmente revertidas, n√£o √©\ruma tarefa facilmente solucion√°vel com m√©todos convencionais de armazenamento de\rarquivos. Com isso em mente, Torvalds criou o sistema de controle de vers√£o\rdistribu√≠do conhecido como Git.\nEm termos leigos, o Git permite gerenciar vers√µes de arquivos texto (outros\rtipos tamb√©m s√£o suportados, mas o foco principal √© em arquivos de c√≥digo). Ele\rn√£o passa de um programa para linha de comando que observa as mudan√ßas nos\rarquivos de um diret√≥rio e vai guardando essas informa√ß√µes para que seja\rposs√≠vel reverter qualquer altera√ß√£o indesejada. O Git tamb√©m pode se conectar\ra um servi√ßo de hospedagem e armazenar todas as vers√µes de um c√≥digo fora\rdo seu computador; o mais utilizado atualmente se chama GitHub.\nNa pr√°tica, a utiliza√ß√£o do Git e do GitHub tem dois principais benef√≠cios:\r- Nunca mais precisar controlar vers√µes com analise.R, analise_v2.R,\ranalise_v3.R, analise_final.R, analise_final_final.R,\ranalise_final_revisada.R‚Ä¶\r- Nunca mais precisar se preocupar em perder seus projetos por causa de falhas\rno seu computador.\nNada mal para dois servi√ßos gratuitos!\nNo cap√≠tulo anterior, √© apresentado o conceito de projeto. Agora o segundo passo\r√© entender como esses projetos podem ser utilizados em conjunto com controle de\rvers√£o para manter seu trabalho sempre sincronizado na nuvem. Criar\ruma conta no GitHub e\rinstalar o programa git no seu computador s√£o\rnecess√°rios para poder utilizar os recursos descritos a seguir. A partir daqui\rassume-se que ambos os requisitos foram cumpridos.\nPara permitir que os comandos do R acessem a sua conta do GitHub, √© essencial\rcriar um Personal Access Token (PAT). Tendo logado no GitHub, clique na sua\rimagem no canto direito superior e siga para\rSettings \u0026gt; Developer settings \u0026gt; Personal access tokens \u0026gt; Generate new token.\rNesta p√°gina basta descrever o seu uso para o token e selecionar o primeiro box\rde todos; por fim, gere e copie o seu token (uma sequ√™ncia com uns 40 letras e\rn√∫meros). Se voc√™ estiver sem nenhuma paci√™ncia, execute o comando abaixo:\nusethis::browse_github_token()\r#\u0026gt; ‚úî Opening URL \u0026#39;https://github.com/settings/tokens/new?scopes=repo,gist\u0026amp;description=R:GITHUB_PAT\u0026#39;\r#\u0026gt; ‚óè Call `usethis::edit_r_environ()` to open \u0026#39;.Renviron\u0026#39;.\r#\u0026gt; ‚óè Store your PAT with a line like:\r#\u0026gt; GITHUB_PAT=xxxyyyzzz\r#\u0026gt; ‚óè Make sure \u0026#39;.Renviron\u0026#39; ends with a newline!\rIndependentemente de como um PAT foi gerado, o importante √© seguir as instru√ß√µes\rdescritas no comando. Execute a fun√ß√£o usethis::edit_r_environ() e crie uma\rnova linha na forma GITHUB_PAT={SEU_TOKEN}. Assim que isso estiver feito, voc√™\rn√£o precisar√° mais se preocupar com nenhum tipo de configura√ß√£o.\nAgora, ao criar um novo projeto, √© poss√≠vel associar imediatamente a ele um\rreposit√≥rio no GitHub. O comando para criar projetos n√£o muda, mas torna-se\rposs√≠vel usar dois outros comando para associar aquela pasta com o sistema de\rcontrole de vers√µes.\nusethis::create_project(\u0026quot;~/Documents/demo\u0026quot;)\r#\u0026gt; ‚úî Creating \u0026#39;~/Documents/demo/\u0026#39;\r#\u0026gt; ‚úî Setting active project to \u0026#39;~/Documents/demo\u0026#39;\r#\u0026gt; ‚úî Creating \u0026#39;R/\u0026#39;\r#\u0026gt; ‚úî Writing \u0026#39;demo.Rproj\u0026#39;\r#\u0026gt; ‚úî Adding \u0026#39;.Rproj.user\u0026#39; to \u0026#39;.gitignore\u0026#39;\r#\u0026gt; ‚úî Opening \u0026#39;~/Documents/demo/\u0026#39; in new RStudio session\r#\u0026gt; ‚úî Setting active project to \u0026#39;demo\u0026#39; # No console do novo projeto\rusethis::use_git()\r#\u0026gt; ‚úî Setting active project to \u0026#39;~/Documents/demo\u0026#39;\r#\u0026gt; ‚úî Initialising Git repo\r#\u0026gt; ‚úî Adding \u0026#39;.Rhistory\u0026#39;, \u0026#39;.RData\u0026#39; to \u0026#39;.gitignore\u0026#39;\r#\u0026gt; There are 2 uncommitted files:\r#\u0026gt; * \u0026#39;.gitignore\u0026#39;\r#\u0026gt; * \u0026#39;demo.Rproj\u0026#39;\r#\u0026gt; Is it ok to commit them?\r#\u0026gt; #\u0026gt; 1: Negative\r#\u0026gt; 2: Not now\r#\u0026gt; 3: I agree\r#\u0026gt; #\u0026gt; Selection: 3\r#\u0026gt; ‚úî Adding files\r#\u0026gt; ‚úî Commit with message \u0026#39;Initial commit\u0026#39;\r#\u0026gt; ‚óè A restart of RStudio is required to activate the Git pane\r#\u0026gt; Restart now?\r#\u0026gt; #\u0026gt; 1: Absolutely not\r#\u0026gt; 2: No way\r#\u0026gt; 3: Yes\r#\u0026gt; #\u0026gt; Selection: 3\rusethis::use_github()\r#\u0026gt; ‚úî Checking that current branch is \u0026#39;master\u0026#39;\r#\u0026gt; Which git protocol to use? (enter 0 to exit) #\u0026gt; #\u0026gt; 1: ssh \u0026lt;-- presumes that you have set up ssh keys\r#\u0026gt; 2: https \u0026lt;-- choose this if you don\u0026#39;t have ssh keys (or don\u0026#39;t know if you do)\r#\u0026gt; #\u0026gt; Selection: 2\r#\u0026gt; ‚óè Check title and description\r#\u0026gt; Name: demo\r#\u0026gt; Description: #\u0026gt; Are title and description ok?\r#\u0026gt; #\u0026gt; 1: Nope\r#\u0026gt; 2: No way\r#\u0026gt; 3: Yup\r#\u0026gt; #\u0026gt; Selection: 3\r#\u0026gt; ‚úî Creating GitHub repository\r#\u0026gt; ‚úî Setting remote \u0026#39;origin\u0026#39; to \u0026#39;https://github.com/curso-r/demo.git\u0026#39;\r#\u0026gt; ‚úî Pushing \u0026#39;master\u0026#39; branch to GitHub and setting remote tracking branch\r#\u0026gt; ‚úî Opening URL \u0026#39;https://github.com/curso-r/demo\u0026#39;\rDepois de ter executado estes dois novos comandos, ser√° inicializada uma nova\raba no RStudio denominada Git. Atrav√©s dela √© poss√≠vel controlar todas as\rvers√µes do c√≥digo e envi√°-las ao GitHub para que sejam armazenadas com seguran√ßa\rna nuvem.\nPara testar se est√° tudo funcionando, crie um arquivo na pasta R/ e abra a aba\rGit. Clique na caixa em branco que l√° se encontra, aperte o bot√£o Commit\r(escreva uma mensagem que descreva aquilo que voc√™ fez) e ent√£o aperte o bot√£o\rPush. Em poucos segundos o reposit√≥rio deve ser atualizado na sua p√°gina\rcorrespondente no GitHub.\nExplicar todas as funcionalidades do Git e do GitHub est√£o al√©m do escopo deste\rmaterial. Os bot√µes mais importantes dessa aba s√£o as checkboxes, o Commit\re o Push. Para saber mais sobre esse assunto, recomendo o livro\rHappy Git with R (especialmente\reste cap√≠tulo) que aborda\rem detalhes minuciosos todo o processo e uso e manuten√ß√£o do Git com o RStudio.\n\r","permalink":"https://blog.curso-r.com/posts/2019-07-23-zen-do-r-4/","tags":["zen do R","github"],"title":"Git e GitHub (Zen do R parte 4)"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rNesta s√©rie de posts, estamos apresentamos a todos a nossa primeira tentativa de\rescrever um livro: O Zen do R! Durante\ras pr√≥ximas semanas, todas as quartas, traremos para o nosso blog os cap√≠tulos\rque j√° escrevemos do livro e responderemos qualquer pergunta sobre o conte√∫do.\nHoje o assunto √© como usar projetos no R para nunca mais perder um arquivo\rimportante.\nRproj e diret√≥rios\rUm programador iniciante corre o risco de n√£o gerenciar seus projetos. Muitas\rvezes seus arquivos de c√≥digo ficar√£o espalhados pelos infinitos diret√≥rios de\rseu computador, esperando a primeira oportunidade de sumir para sempre. No R\risso n√£o √© diferente: organizar arquivos √© uma parte integral do processo de\rprograma√ß√£o.\nFelizmente o RStudio possui uma ferramenta incr√≠vel que auxilia na tarefa de\rconsolidar todos os recursos necess√°rios para uma an√°lise. Denominados\r‚Äúprojetos‚Äù, eles n√£o passam de pastas comuns com um arquivo .Rproj.\nO primeiro passo para organizar um bom ambiente de trabalho para an√°lises de\rdados √© criar um diret√≥rio onde todos os seus programas R podem viver. No meu\rcomputador eu tenho a pasta ~/Documents/Dev/R/, mas n√£o importa onde ela\rest√°, apenas que seja um lugar o qual voc√™ lembre sem dificuldades. Tendo\rcriado um esse workspace, √© importante registr√°-lo como o seu ambiente de\rtrabalho no RStudio: basta selecion√°-lo em\rTools \u0026gt; Global Options‚Ä¶ \u0026gt; Browse.\nDesta forma, toda vez que voc√™ iniciar um novo projeto no R, ele por par√£o\rusar√° essa nova pasta como ambiente padr√£o! Se voc√™ j√° tiver alguns arquivos\respalhados pelo seu computador, traga eles para o seu diret√≥rio de programas.\nO segundo passo no processo de organiza√ß√£o dos seus projetos √© um pouco mais\rcomplexo e demanda mais aten√ß√£o. N√£o basta juntar todos os arquivos em um s√≥\rlugar, √© importante coloc√°-los em subdiret√≥rios para que a sua pasta\rn√£o vire um equivalente virtual a uma mesa desorganizada. Assim como em uma\rmesa cada papel e cada utens√≠lio tem uma gaveta, cada arquivo precisa fazer\rparte de um projeto.\n√â nesse ponto que os ‚Äúprojetos‚Äù do RStudio dialogam com os projetos da vida\rreal. Em uma empresa, cada cliente √© um projeto; na academia, cada pesquisa √©\rum projeto; e assim por diante. Cada projeto seu deve ter a sua pr√≥pria pasta\rpara que seja f√°cil encontrar todos os c√≥digos e dados pertencentes a um √∫nico\rassunto. Mas esta n√£o deve ser uma pasta comum, ela deve ser um projeto.\nO c√≥digo listado abaixo demonstra como criar um projeto no RStudio. Basta\rapenas um comando e ele j√° far√° tudo que for necess√°rio para preparar o seu\rambiente de desenvolvimento.\nusethis::create_project(\u0026quot;~/Documents/Dev/R/Proj/\u0026quot;)\r#\u0026gt; ‚úî Creating \u0026#39;~/Documents/Dev/R/Proj/\u0026#39;\r#\u0026gt; ‚úî Setting active project to \u0026#39;~/Documents/Dev/R/Proj\u0026#39;\r#\u0026gt; ‚úî Creating \u0026#39;R/\u0026#39;\r#\u0026gt; ‚úî Writing \u0026#39;Proj.Rproj\u0026#39;\r#\u0026gt; ‚úî Adding \u0026#39;.Rproj.user\u0026#39; to \u0026#39;.gitignore\u0026#39;\r#\u0026gt; ‚úî Opening \u0026#39;~/Documents/Dev/R/Proj/\u0026#39; in new RStudio session\r#\u0026gt; ‚úî Setting active project to \u0026#39;Proj\u0026#39;\rCada linha da sa√≠da do comando representa algo que ele fez para preparar o\rprojeto. A mais importante √© a quarta linha, que cria o arquivo Proj.Rproj;\rele indica para o RStudio que aquele diret√≥rio ser√° a raiz de um projeto e que,\rportanto, v√°rias outras funcionalidades podem ser ativadas. Por exemplo,\rclicando duas vezes neste arquivo j√° carrega o RStudio com os arquivos de\rProj.\nImportante tamb√©m √© a pasta R/ criada. Nela voc√™ deve colocar todos os seus\rarquivos de c√≥digo referentes √†quele projeto com nomes que descrevam bem o que\rcada um faz. Se voc√™ seguiu o conselho anterior e juntou todos os seus c√≥digos\rno seu diret√≥rio de trabalho, crie um projeto novo para cada grupo de programas\rque voc·∫Ω tiver detectado. Talvez um para exerc√≠cios de R, um para cada cliente,\rum para uma nova ideia, etc. Cada um deles deve ter um nome descritivo e\rconter, em sua pasta R, todos os arquivos necess√°rios para aquela an√°lise.\nDiret√≥rio de trabalho\rMas a funcionalidade mais importante dentre todas as j√° citadas √© o conceito do\rworking directory ou diret√≥rio de trabalho. No canto esquerdo superior do\rConsole do RStudio existe um caminho denominado diret√≥rio de trabalho, que √©\ressencialmente a raiz do seu projeto. Muitos programadores que aprenderam R h√°\rmuito tempo conhecem uma fun√ß√£o chamada setwd(); se voc√™ nunca ouviu falar\rdisso, n√£o se preocupe e continue assim, mas se voc√™ costuma us√°-la, siga\rprestando aten√ß√£o.\nO R d√° a possibilidade de mudar, instantaneamente, o diret√≥rio de trabalho.\rIsso que dizer que os caminhos relativos para arquivos podem mudar em quest√£o\rde linhas. O exemplo abaixo demonstra superficialmente como isso funciona:\n# Abrindo dois arquivos em diret√≥rios diferentes\rsetwd(\u0026quot;~/Downloads\u0026quot;)\ra \u0026lt;- read.csv(\u0026quot;a.csv\u0026quot;)\rsetwd(\u0026quot;~/Documents/Dev/R/Proj\u0026quot;)\rb \u0026lt;- read.csv(\u0026quot;b.csv\u0026quot;)\rwrite.csv(a, \u0026quot;c.csv\u0026quot;)\rIsso n√£o parece t√£o problem√°tico √† primeira vista, mas usar setwd() cria um\rv√≠cio dif√≠cil de abandonar. Essa fun√ß√£o estimula que os seus projetos continuem\rdesorganizados com arquivos espalhados pelo computador, mas tamb√©m confunde o\rprogramador na hora de salvar arquivos. Onde ser√° salvo o arquivo c.csv?\rDe onde veio o arquivo a.csv ou de onde veio o b.csv? E se essa linha fosse\rmudada de lugar para antes do segundo setwd()? S√£o perguntas dif√≠ceis de\rresponder caso voc√™ n√£o esteja atento ao c√≥digo todo.\nA solu√ß√£o que os projetos oferecem para isso √© fazer com que o diret√≥rio de\rtrabalho seja sempre a pasta do projeto. Neste caso √© como se, ao abrir o\rRStudio, ele executasse o comando setwd(\"~/Documents/Dev/R/Proj\")\rautomaticamente. Mas como ler ent√£o o arquivo a.csv?\n# Duas formas de ler a.csv\ra \u0026lt;- read.csv(\u0026quot;~/Downloads/a.csv\u0026quot;)\rfile.copy(\u0026quot;~/Downloads/a.csv\u0026quot;, \u0026quot;a.csv\u0026quot;)\ra \u0026lt;- read.csv(\u0026quot;a.csv\u0026quot;)\rA primeira forma deixa expl√≠cito que aquele arquivo n√£o faz parte do projeto e\rque portanto deve ser tratado como tempor√°rio. A segunda forma, mais indicada,\r√© trazer o arquivo para dentro do projeto! Se ele √© importante, √© essencial que\rele esteja junto com todos os outros dados de Proj. Com o c√≥digo acima, o\rcomando write.csv(a, \"c.csv\") salvaria c.csv dentro do projeto sem sombra\rde d√∫vidas.\nOs principais benef√≠cios de n√£o usar setwd() s√£o dois: saber sempre onde os\rarquivos utilizados est√£o/ser√£o salvos e poder compartilhar um projeto com\rqualquer pessoa. setwd() depende que seja explicitado um caminho dentro do\rseu computador e isso nem sempre √© verdade no computador de outra pessoa;\rfazendo com que todos os arquivos estejam no projeto e com caminhos relativos\rnos c√≥digos permite que outro usu√°rio replique a sua an√°lise sem ter que\rmodificar nem uma linha do programa.\n\r\r","permalink":"https://blog.curso-r.com/posts/2019-07-16-zen-do-r-3/","tags":["zen do R"],"title":"Rproj e diret√≥rios (Zen do R parte 3)"},{"author":["Julio"],"categories":["divulga√ß√£o"],"contents":"\r\rEntre os dias 8 e 12 de julho de 2019 aconteceu a useR, em Toulouse, Fran√ßa. A useR √© um evento bem tradicional e ocorre desde o ano de 2004. Tive a felicidade de participar pela primeira vez esse ano, juntamente com William Amorim, Daniel Falbel, Beatriz Milz e Ang√©lica Cust√≥dio. Tamb√©m encontrei o professor Elias Krainski, da UFPR, que nos introduziu √† professora Laurie Baker, que tamb√©m andou com a gente durante o evento.\nSe eu pudesse resumir minha experi√™ncia a uma palavra, seria pertencimento. Sinto que a comunidade do R √© verdadeiramente inclusiva e se esfor√ßa o m√°ximo poss√≠vel para que as pessoas de todos os lugares do mundo, de todas as culturas, sintam-se bem vindas e relevantes para produ√ß√£o do conhecimento cient√≠fico. Essa sensa√ß√£o de pertencimento √© t√£o importante quanto os avan√ßos t√©cnicos ‚Äì que com certeza foram mostrados, e foram incr√≠veis ‚Äì pois potencializa a produ√ß√£o de solu√ß√µes e incentiva a colabora√ß√£o, dentre muitas outras vantagens. √â √≥bvio que ainda temos um caminho enorme a seguir nesse sentido, mas acredito que estamos indo muito bem.\nHighlights de cada dia\rDia -1: Tidy dev day!\rJ√° pensou em sentar com o Hadley Wickham, a Jenny Bryan e outros para ajudar a resolver issues do dplyr e do ggplot2? Bom, o tidy dev day √© exatamente isso!\nInfelizmente eu n√£o participei do evento, ent√£o n√£o tenho muito para escrever. O que sei √© que as pessoas colocaram post-its na lousa para as pessoas irem pegando e fazendo pull requests nas issues dos pacotes do tidyverse.\nQuem sabe a Bea ou a Ang√©lica explicam melhor pra gente!\n\rFigura 1: Bea e Ang√©lica no tidy dev day.\r\r\rDia 0: Cursos!\rTamb√©m n√£o participei dos cursos, mas n√£o importa muito, pois vi todos os materiais apresentados ao mesmo tempo que meus amigos. Todos os cursos est√£o abertos por a√≠, basta fu√ßar no twitter e entrar no github dos autores.\nE como nossa comunidade √© maravilhosa, √© claro que algu√©m j√° criou um reposit√≥rio para colocar todos os links:\nhttps://github.com/sowla/useR2019-materials/\n\rDia 1: Uma palestra cheia de \u0026lt;3\rO que dizer da palestra da Julia Stewart Lowndes? Acho que a palavra √©: inspiradora. Ela mostrou como fazer ci√™ncia aberta potencializa os trabalhos e gera resultados efetivos. E mostrou como o ecossistema do R √© essencial para isso. E s√©rio, usar desenhos com o tema Star Wars foi uma ideia genial.\n\rFigura 2: Que vontade de abra√ßar esses slides.\r\r\rFigura 3: Que vontade de abra√ßar esses slides.\r\r\rDia 2: shiny, ensino e comunidade\rNo dia 2, ficou claro o impacto do shiny na comunidade R. Muitas apresenta√ß√µes corporativas sobre como usar o shiny de forma escal√°vel, como monitorar desempenho etc. Algumas pessoas chegaram at√© a comentar que a quantidade de falas sobre shiny foi excessiva, at√© porque a useR √©, tradicionalmente, um evento acad√™mico. Eu n√£o pude sentir isso pois o shiny √© uma parte essencial do meu trabalho, mas creio que essa seja uma poss√≠vel cr√≠tica construtiva ao evento.\nOutra coisa que ficou clara √© como a comunidade R quer ajudar o resto do mundo a entrar na ci√™ncia de dados. √â muito bonito. Ver a apresenta√ß√£o do Colin Rundel sobre o pacote ghclass, bem como diversos case studies sobre ensino de R em comunidades diversas e outras ferramentas e desafios para ensinar pessoas de todas as idades renovou meu compromisso com a miss√£o da Curso-R, que √© descomplicar a ci√™ncia de dados aqui no Brasil.\nDestaque para a palestra da Bea Milz, feita em conjunto com a Bruna Wundervald, sobre a experi√™ncia do RLadies no cap√≠tulo de S√£o Paulo. Foi muito tocante, e n√≥s da Curso-R ficamos muito felizes com o slide de agradecimento \u0026lt;3\n\rFigura 4: Palestra da Bea Milz sobre o RLadies S√£o Paulo.\r\r\rDia 3: mais shiny, vroom, auth0!\rA palestra do Joe Cheng foi excelente. √â muito legal ver como ele se mant√©m humilde sendo um dos fundadores da RStudio e criador do shiny. Ele falou sobre o pacote shinymeta, ainda em constru√ß√£o, para adicionar a funcionalidade de gerar relat√≥rios reprodut√≠veis diretamente do shiny. O mais legal foi ver o processo de desenvolvimento dele, que mostra que mesmo os grandes programadores ‚Äì talvez principalmente? ‚Äì sofrem ao n√£o saber como fazer/planejar as solu√ß√µes e pedem ajuda da comunidade para conseguir encontrar um caminho.\nOutro highlight do dia foi a apresenta√ß√£o do pacote vroom, pelo Jim Hester. Trata-se de um pacote que l√™ arquivos de texto muito r√°pido, ganhando muitas vezes do pr√≥prio data.table::fread(). O mais legal foi ver a cara de incredulidade de todos que estavam assistindo, pois antes isso nem parecia poss√≠vel. Claro que os benchmarks do vroom precisam ser olhados com cuidado, pois √© um sistema de leitura pregui√ßoso, diferente do readr e do data.table. Mas mesmo assim parece que o vroom, em m√©dia, √© mais eficiente que os concorrentes.\nE fala s√©rio, olha que capa legal dos slides\n\rFigura 5: Life‚Äôs too short to read slow.\r\rNesse dia eu tamb√©m apresentei sobre o auth0, um pacote que fizemos para facilitar a vida de quem quer adicionar autentica√ß√£o em shiny apps. Foi uma experi√™ncia muito legal! Apesar de serem apenas 5 minutos e do meu ingl√™s ruim, acho que deu para passar a ideia geral do pacote e tenho certeza de que mais pessoas v√£o utilizar!\n\rFigura 6: Eu falando sobre o auth0, provavelmente a palavra ‚ÄòAwesome‚Äô, pois disseram que eu abusei dessa palavra na fala.\r\r\r\rPacotes que definitivamente quero estudar\rTentei separar uma lista pessoal de coisas que definitivamente quero estudar mais e contribuir nos pr√≥ximos tempos.\n\rTidyverse\r\rPacote vroom: O autor do pacote, Jim Hester, me convenceu de que o vroom √© real deal.\rPacote usethis: O filhinho da Jenny Bryan √© realmente muito legal. √â um dos meus pacotes preferidos.\rPacote rray: Pacote mega interessante do Davis Vaughan para tratar arrays no R de uma forma mais intuitiva. Definitivamente vale tentar!\r\rWorkflow, ensino e comunica√ß√£o\r\rPacote remedy: com esse pacote, podemos adicionar diversos atalhos no RStudio para acelerar a escrita de documentos RMarkdown. Farei um post sobre esse pacote em breve.\rPacote ghactions: √© uma esp√©cie de generaliza√ß√£o do Travis CI, aplicado diretamente e gratuitamente pelo GitHub. Eu tenho at√© dificuldade de pensar nas possibilidades desse pacote, que s√£o muitas!\rPacote crrri: esse pacote permite abrir o chrome dentro do RStudio, o que pode tornar a experi√™ncia de desenvolver web scrapers muito mais fluida e interativa. Vale √† pena tentar.\rPacote ghclass: achei esse pacote interessante para ser usado em salas de aula.\r\rShiny:\r\rPacote shinyEventLogger: Esse pacote pode ser utilizado para verificar o que o seu shiny est√° fazendo e otimizar nas partes que ele est√° lento. Com um pouco de programa√ß√£o ele pode ser muito √∫til para apps complexos.\rPacote shinymeta: O pacote do Joe Cheng parece realmente muito √∫til para gerar relat√≥rios reprodut√≠veis a partir dos apps. Provavelmente esse √© o melhor jeito de fazer isso, e resolve um problema bem dif√≠cil, que supera diversas ferramentas de BI. Ainda est√° incipiente, mas quando ficar maduro, ser√° um diferencial absurdo do shiny.\rPacote golem: O golem √© uma forma estruturada de organizar apps do shiny na forma de pacotes. √â uma esp√©cie de usethis para shiny. Antes da useR, eu achava o golem bacana. Agora eu acho essencial.\r\r\r\rExtra\rOutra coisa legal da useR √© que as famosas da comunidade est√£o a uma cutucada de dist√¢ncia. Se voc√™ gosta de tietar seus √≠dolos, assim como eu, deveria fazer isso pelo menos uma vez. Tirei foto com o Hadley, falei com a filha do Romain Fran√ßois, troquei ideia com o Dirk Eddelbuetel e outras pessoas da comunidade que parecem t√£o distantes, mas s√£o t√£o pr√≥ximas.\nPor isso, vou encerrar meu post com algumas fotinhos legais\n\rFigura 7: Fiquei t√£o nervoso na foto com o Hadley que coloquei o copo na frente da c√¢mera.\r\r\rFigura 8: Depois pedi para tirar foto com ele e tampei o William, al√©m de ter ficado com um sorriso horr√≠vel. O Hadley, obviamente, estava √≥timo. Olha esses √≥culos, muito estilosos!\r\r\rFigura 9: Lexie, filha do Romain Fran√ßois (o do cabelo colorido), brincando com o Daniel Falbel. Coisa mais fofa!\r\r\rFigura 10: Playmobil com um pipe no escudo, da ThinkR\r\r\rFigura 11: Turma dos BR (+Laurie) na useR!\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2019-07-14-user2019/","tags":["comunidade","eventos"],"title":"Minha experi√™ncia na useR!2019"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rNesta s√©rie de posts, estamos apresentamos a todos a nossa primeira tentativa de\rescrever um livro: O Zen do R! Durante\ras pr√≥ximas semanas, todas as quartas, traremos para o nosso blog os cap√≠tulos\rque j√° escrevemos do livro e responderemos qualquer pergunta sobre o conte√∫do.\nHoje o assunto √© ‚Äú.RData e .Rhistory‚Äù, como eles funcionam e porque voc√™ n√£o\rdeveria us√°-los.\n.RData e .Rhistory\rO fluxo ideal de an√°lise de dados come√ßa na escolha da ferramenta. Por ser uma\rlinguagem especializada em estat√≠stica, o R √© a primeira escolha de muitos\rusu√°rios. Normalmente optar por programar em R tamb√©m implica na escolha de uma\rIDE (Integrated Development Environment) que, em 90%1 dos casos, ser√° o\rRStudio.\nO R, em combina√ß√£o com o RStudio, possui um conjunto de funcionalidades cuja\rinten√ß√£o √© ajudar no processo de desenvolvimento. Entretanto, isso acaba\rdeixando os programadores de R mal acostumados.\nComo um pai coruja, o RStudio faz quest√£o de lembrar tudo o que voc√™ fez\ranteriormente. Em sua configura√ß√£o padr√£o, a IDE manter√° na ‚Äúmem√≥ria‚Äù todos os\r√∫ltimos comandos executados, todos os dados utilizados e todos os objetos\rcriados. Ao fechar e abrir o RStudio, essas informa√ß√µes ser√£o recarregadas\rna mem√≥ria como se o usu√°rio nunca tivesse sa√≠do do programa.\nEsse recurso √© tornado poss√≠vel pela cria√ß√£o de dois arquivos ocultos: .RData\re .Rhistory. O primeiro abriga absolutamente todos os objetos criados por uma\rsess√£o R, enquanto o segundo cont√©m uma lista com os √∫ltimos comandos\rexecutados. Ao reabrir o RStudio, o conte√∫do armazenados nestes arquivos ser√°\rcarregado no ambiente de trabalho atual como se nada tivesse acontecido.\nPorque desistir desse recurso\rApesar de ser uma √≥tima conveni√™ncia, assim como o pai coruja, esse tipo de\rfuncionalidade pode deixar o programador mal acostumado. Se todos os resultados\rparciais de uma an√°lise estiverem dispon√≠veis a qualquer momento, diminui o\rincentivo para a escrita de c√≥digo reprodut√≠vel e, se todo o hist√≥rico de\rcomandos for acess√≠vel, acaba a necessidade de experimentos controlados.\nUm usu√°rio que dependa ativamente do .RData para recuperar seus dados estar√°\raos poucos contando cada vez mais com a sorte. Caso ele acidentalmente\rsobrescreva o objeto relevante e o c√≥digo para recri√°-lo j√° tenha sido apagado,\rn√£o haver√° nenhuma forma confi√°vel de recuperar esses dados. Idealmente, todo\ro c√≥digo necess√°rio para uma an√°lise de dados deve estar salvo em um arquivo\r.R perfeitamente reprodut√≠vel; assim, caso o programador cometa um engado,\r√© poss√≠vel executar aquele arquivo do in√≠cio e obter novamente os objetos que\restavam sendo utilizados.\nArquivos reprodut√≠veis tamb√©m tem uma outra vantagem: facilidade de\rcompartilhamento. A menos que o programador pretenda sentar com seu colega para\rexplicar como utilizar os objetos do .RData e do .Rhistory, n√£o pode-se\resperar que outra pessoa seja capaz de reproduzir uma an√°lise a partir de\rarquivos incompletos. Deste modo, abandonar essa funcionalidade permite utilizar\rferramentas de compartilhamento e controle de vers√£o da maneira como elas foram\ridealizadas.\nPor fim, √© importante notar uma desvantagem sutil mas muito relevante do uso\rdo .RData. O R trata todos os objetos guardados na mem√≥ria igualmente, sem\rlevar em conta sua utilidade ou tamanho. Isso significa que ele tamb√©m ir√°\rarmazenar nos arquivos ocultos todas as bases de dados da sess√£o (n√£o\rimportando qu√£o grande sejam). Isso faz com que o .RData normalmente seja um\rarquivo de m√∫ltiplos gigabytes.\nAo reabrir o RStudio, todos esses dados ser√£o recarregados e\rprovavelmente far√£o com que o programador espere v√°rios minutos at√© que ele\rpossa voltar ao seu trabalho. Com o .RData √© imposs√≠vel ter controle sobre\rquais dados devem ser utilizados em cada sess√£o de programa√ß√£o.\n\rComo desativar essa funcionalidade\rO processo de desabilitar o .RData e o .Rhistory √© bastante simples e afeta\rtodos os projetos do computador, ent√£o s√≥ √© necess√°rio passar por ele uma vez.\rBasta selecionar Tools \u0026gt; Global Options‚Ä¶ na aba de ferramentas do RStudio\re ent√£o ajustar tr√™s configura√ß√µes. No final a p√°gina de op√ß√µes gerais deve\rficar similar √† da imagem abaixo:\nSe acostumar com sess√µes ef√™meras n√£o √© uma tarefa f√°cil e um desconforto\rinicial √© esperado. Pode ser que o programador ache entediante executar o mesmo\rc√≥digo toda vez que abrir seu RStudio, mas √© importante ter em mente que esse\rprograma s√≥ est√° l√° e pode ser executado in√∫meras vezes porque o R n√£o estar√°\rmais fazendo o trabalho do analista.\n\r\r\rN√£o tenho nenhuma estat√≠stica confi√°vel sobre esse n√∫mero, mas sei que ele n√£o √© 100% porque conhe√ßo pelo menos uma pessoa que programa R no neovim.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2019-07-10-zen-do-r-2/","tags":["zen do R"],"title":".RData e .Rhistory (Zen do R parte 2)"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"O objetivo principal do pacote Kuber √© ajudar com computa√ß√µes massivamente paralelas. Ele usa o kubernetes e o docker de modo a criar um cont√™iner que automaticamente executa tarefas em paralelo via expans√£o. Se voc√™ j√° usa o Google Cloud Platform, o Kuber tamb√©m consegue automaticamente criar clusters, executar computa√ß√µes e gerenciar o seu progresso com o Google cloud SDK.\nSe voc√™ nunca ouviu falar sobre orquestra√ß√£o de cont√™ineres, armazenamento persistente na nuvem ou computa√ß√£o paralela, pode ser que esse tutorial pare√ßa avan√ßado demais. Voc√™ n√£o precisa ser nenhum especialista nesses assuntos, mas ajuda pelo menos saber o que significam esses termos.\nEsse tutorial vai te ajudar a criar a sua primeira tarefa do Kuber. Antes de come√ßar, certifique-se de que voc√™ instalou todos os requisitos corretamente com a vignette \u0026ldquo;Getting started\u0026rdquo;\nA tarefa em si A principal vantagem do Kuber em rela√ß√£o a outros pacotes de paraleliza√ß√£o (como Parallel ou Future/Furrr) √© que ele automaticamente cria um cluster de computadores que executa a sua tarefa via orquestra√ß√£o de cont√™ineres. Isso pode ser muito √∫til para web scraping, por exemplo, porque (1) cada m√°quina tem um IP diferente, (2) salvar os HTMLs raspados √© f√°cil com o Google Cloud Storage e (3) o processo pode ser facilmente ativado/desativado a qualquer momento.\nNeste tutorial a fun√ß√£o a ser paralelizada √© a seguinte:\n# Scrapear um vetor de caracteres de URLs scrape_urls \u0026lt;- function(urls) {   # Criar um diret√≥rio  dir \u0026lt;- fs::dir_create(\u0026#34;scraped\u0026#34;)   # Iterar nos URLs  paths \u0026lt;- c()  for (url in urls) {  path \u0026lt;- paste0(dir, \u0026#34;/\u0026#34;, stringr::str_remove_all(url, \u0026#34;[^a-z]\u0026#34;), \u0026#34;.html\u0026#34;)  paths \u0026lt;- append(paths, path)   httr::GET(url, httr::write_disk(path, overwrite = TRUE))  }   return(paths) } Em suma, essa fun√ß√£o recebe um vetor de URLs, os raspa e salva os HTMLs resultantes em um diret√≥rio local.\nCriando o cluster Agora para o Kuber. Se tudo estiver instalado corretamente, voc√™ deveria ser capaz de criar um cluster simples com o seguinte comando:\nlibrary(kuber)  kub_create_cluster(\u0026#34;toy-cluster\u0026#34;, machine_type = \u0026#34;f1-micro\u0026#34;) #\u0026gt; ‚úî Creating cluster V√° para o Kubernetes console para ver se tudo funcionou corretamente. N√£o se preocupe se voc√™ receber um monte de alertas, a maioria deles √© referente √† vers√£o do SDK.\nCriando a tarefa A fun√ß√£o mais importante do Kuber provavelmente √© a pr√≥xima. Ela cria um diret√≥rio na sua m√°quina local que descreve a computa√ß√£o paralela e seus cluster, pacote, imagem e conta de servi√ßo. Para executar o comando abaixo, apenas toy-key.json (a chave da conta de servi√ßo baixada na vignette \u0026ldquo;Getting started\u0026rdquo;) j√° precisa existir no caminho indicado; o resto √© todo criado para voc√™.\nkub_create_task(\u0026#34;~/toy-dir\u0026#34;, \u0026#34;toy-cluster\u0026#34;, \u0026#34;toy-bucket\u0026#34;, \u0026#34;toy-image\u0026#34;, \u0026#34;~/toy-key.json\u0026#34;) #\u0026gt; ‚úî Fetching cluster information #\u0026gt; ‚úî Fetching bucket information #\u0026gt; ‚úî Creating bucket #\u0026gt; ‚óè Edit `~/toy-dir/exec.R` #\u0026gt; ‚óè Create `~/toy-dir/list.rds` with usable parameters #\u0026gt; ‚óè Run `kub_push_task(\u0026#34;~/toy-dir\u0026#34;)` Editando o exec.R e o list.rds O diret√≥rio criado por kub_create_task() tem alguns arquivos que s√£o explorados em detalhe na documenta√ß√£o da pr√≥pria fun√ß√£o, mas os dois mais importantes s√£o exec.R e list.rds. O primeiro cont√©m o arquivo R a ser executado pela imagem docker, enquanto o segundo tem todos os objetos que cada m√°quina precisa para rodar o seu pr√≥prio exec.R.\nCome√ßando pelo exec.R, o arquivo j√° est√° populado com um exemplo simples:\n#!/usr/bin/env Rscript\rargs \u0026lt;- commandArgs(trailingOnly = TRUE)\r# Arguments\ridx \u0026lt;- as.numeric(args[1])\rbucket \u0026lt;- as.character(args[2])\r# Use this function to save your results\rsave_path \u0026lt;- function(path) {\rsystem(paste0(\u0026#34;gsutil cp -r \u0026#34;, file_, \u0026#34; gs://\u0026#34;, bucket, \u0026#34;/\u0026#34;, gsub(\u0026#34;/.+\u0026#34;, \u0026#34;\u0026#34;, file_)))\rdo.call(file.remove, list(list.files(path, full.names = TRUE)))\rreturn(path)\r}\r# Get object passed in list[[idx]]\robj \u0026lt;- readRDS(\u0026#34;list.rds\u0026#34;)[[idx]]\r###########################\r## INSERT YOUR CODE HERE ##\r########################### Como voc√™ pode ver, √© um Rscript que recebe dois argumentos: um √≠ndice e o nome de um bucket GCS. O c√≥digo em seguida descreve uma fun√ß√£o a ser usada quando salvando os resultados; ela envia o arquivo/diret√≥rio no path para o bucket especificado e ent√£o o deleta do disco da m√°quina. Finalmente, o script l√™ list.rds e seleciona o objeto guardado no √≠ndice idx.\nAgora √© hora de adicionar scrape_urls() para o arquivo. N√£o h√° muitas mudan√ßas na fun√ß√£o em si, apenas em como os arquivos resultantes s√£o gerenciados. Aqui est√° a vers√£o final do exec.R:\n#!/usr/bin/env Rscript\rargs \u0026lt;- commandArgs(trailingOnly = TRUE)\r# Arguments\ridx \u0026lt;- as.numeric(args[1])\rbucket \u0026lt;- as.character(args[2])\r# Use this function to save your results\rsave_path \u0026lt;- function(path) {\rsystem(paste0(\u0026#34;gsutil cp -r \u0026#34;, file_, \u0026#34; gs://\u0026#34;, bucket, \u0026#34;/\u0026#34;, gsub(\u0026#34;/.+\u0026#34;, \u0026#34;\u0026#34;, file_)))\rdo.call(file.remove, list(list.files(path, full.names = TRUE)))\rreturn(path)\r}\r# Get object passed in list[[idx]]\robj \u0026lt;- readRDS(\u0026#34;list.rds\u0026#34;)[[idx]]\r# Scrapear um vetor de caracteres de URLs\rscrape_urls \u0026lt;- function(urls) {\r# Criar um diret√≥rio\rdir \u0026lt;- fs::dir_create(\u0026#34;scraped\u0026#34;)\r# Iterar nos URLs\rpaths \u0026lt;- c()\rfor (url in urls) {\rpath \u0026lt;- paste0(dir, \u0026#34;/\u0026#34;, stringr::str_remove_all(url, \u0026#34;[^a-z]\u0026#34;), \u0026#34;.html\u0026#34;)\rpaths \u0026lt;- append(paths, path)\rhttr::GET(url, httr::write_disk(path, overwrite = TRUE))\r}\rreturn(paths)\r}\r# Rodar o scraper\rpaths \u0026lt;- scrape_urls(obj)\r# Salvar os HTMLs no GCS\rfor (path in paths) {\rsave_path(path)\r} Como voc√™ j√° pode imaginar pelos chamados acima, obj cont√©m os URLs a serem raspados. Isso faz sentido porque, como descrito anteriormente, list.rds tem todo objeto que cada m√°quina precisa para seu pr√≥prio exec.R; neste caso, cada m√°quina precisa de um vetor de URLs a serem scrapeados e idx √© simplesmente o √≠ndice de cada m√°quina (para que duas m√°quinas nunca raspem os mesmos URLs). √â s√≥ isso.\nAgora a √∫nica coisa que falta √© criar o list.rds, ou seja, a lista de URLs quebrada em um bloco para cada m√°quina. Como neste exemplo toy-cluster foi criado com o n√∫mero padr√£o de m√°quinas (3), list.rds vai ser uma lista com 3 elementos. Os comandos a seguir devem ser rodados na sua m√°quina local:\n# URLs a serem raspados, blocados por m√°quina url_list \u0026lt;- list(  c(\u0026#34;google.com\u0026#34;, \u0026#34;duckduckgo.com\u0026#34;),  c(\u0026#34;wikipedia.org\u0026#34;),  c(\u0026#34;facebook.com\u0026#34;, \u0026#34;twitter.com\u0026#34;, \u0026#34;instagram.com\u0026#34;) )  # Sobrescrever o list.rds com a lista de URLs readr::write_rds(url_list, \u0026#34;~/toy-dir/list.rds\u0026#34;) Com esse list.rds, o primeiro n√≥ vai raspar motores de busca, o segundo vai raspar a Wikip√©dia e o terceiro vai raspar m√≠dias sociais.\nDando push e executando a tarefa Por √∫ltimo mas n√£o menos importante, a tarefa deve ser pushada para o Google Container Registry (GCR), que √© onde as imagens docker do Kuber v√£o ficar guardadas. Isso garante controle de vers√£o para todas as tarefas e permitem que elas sejam executadas de outro computador, mas pode levar um bom tempo para rodar da primeira vez que voc√™ cria uma tarefa.\nkub_push_task(\u0026#34;~/toy-dir\u0026#34;) #\u0026gt; ‚úî Building image #\u0026gt; ‚úî Authenticating #\u0026gt; ‚úî Pushing image #\u0026gt; ‚úî Removing old jobs #\u0026gt; ‚úî Creating new jobs Se tudo funcionou at√© agora, o √∫ltimo comando obrigat√≥rio √© executar a tarefa:\nkub_run_task(\u0026#34;~/toy-dir\u0026#34;) #\u0026gt; ‚úî Authenticating #\u0026gt; ‚úî Setting cluster context #\u0026gt; ‚úî Creating jobs #\u0026gt; ‚óè Run `kub_list_pods()` to follow up on the pods Gerenciando o progresso da tarefa A duas formas principais de gerenciar o progresso de uma tarefa: listando os pods atualmente ativos e listando os arquivos guardados em um bucket. As letras estranhas no nome de cada processo √© um identificador √∫nico gerado pelo Kuber para gerenciar aqueles pods.\nkub_list_pods(\u0026#34;~/toy-dir\u0026#34;) #\u0026gt; ‚úî Setting cluster context #\u0026gt; ‚úî Fetching pods #\u0026gt; NAME READY STATUS RESTARTS AGE #\u0026gt; 1 process-mkewsr-item-1-8kpg7 1/1 Running 0 1m #\u0026gt; 2 process-mkewsr-item-2-cph8z 1/1 Running 0 1m #\u0026gt; 3 process-mkewsr-item-3-kpn5f 1/1 Running 0 1m Se o status dos seus pods indicar algo ruim, pode ser que voc√™ precise depurar o seu arquivo exec.R. Isso √© absolutamente normal e pode ser que sejam necess√°rias v√°rias tentativas at√© que a sua tarefa esteja rodando corretamente. Se voc√™ precisar de ajuda na depura√ß√£o da sua tarefa, d√™ uma olhada na vignette \u0026ldquo;Debugging exec.R\u0026rdquo;.\nO comando abaixo lista todo arquivo em um bucket. Voc√™ tamb√©m pode especificar o diret√≥rio dentro do bucket e se a listagem deve ser feita recursivamente. Aqui √© poss√≠vel ver que todo download terminou de rodar corretamente.\nkub_list_bucket(\u0026#34;~/toy-dir\u0026#34;, folder = \u0026#34;scraped\u0026#34;) #\u0026gt; ‚úî Listing content #\u0026gt; [1] \u0026#34;googlecom.html\u0026#34; \u0026#34;duckduckgocom.html\u0026#34; \u0026#34;wikipediaorg.html\u0026#34;  #\u0026gt; [4] \u0026#34;facebookcom.html\u0026#34; \u0026#34;twittercom.html\u0026#34; \u0026#34;instagramcom.html\u0026#34;  ","permalink":"https://blog.curso-r.com/posts/2019-05-14-scraper-orquestrado/","tags":["web-scraping"],"title":"Web Scraping Orquestrado"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\r\rNesse post vou trabalhar com Captchas e GANs. Se voc√™ n√£o sabe o que √© um Captcha e como estamos trabalhando para resolv√™-los at√© agora, recomendo que voc√™ veja a s√©rie de posts da Curso-R sobre o tema. Se voc√™ n√£o sabe nada de GAN, acredito que seja poss√≠vel acompanhar esse post. No entanto, n√£o acho que esse √© o exemplo mais simples poss√≠vel de GAN: se voc√™ quiser um ‚Äúhello world‚Äù no tema, recomendo ver esse exemplo e esse paper.\nObjetivo: criar um modelo capaz de, ao mesmo tempo, gerar novos Captchas e tamb√©m resolver Captchas existentes.\nMotivo: o motivo principal de usar modelos generativos √© aproveitar o fato de existirem muito mais Captchas n√£o classificados do que classificados. De certa forma, saber criar novos Captchas pode auxiliar no trabalho de resolv√™-los.\nBase de dados: ao inv√©s de utilizar um Captcha real, vamos trabalhar com um Captcha sint√©tico criado partir do MNIST. Chamarei esses carinhas de MNIST-Captcha. A ideia foi simplificar o problema para facilitar o desenvolvimento da solu√ß√£o. Um problema que enfrentamos no Deep Learning √© que existem tantos hiperpar√¢metros a serem escolhidos que √© muito dif√≠cil achar configura√ß√µes que funcionam bem. Em problemas mais simples, √© mais f√°cil achar esses par√¢metros.\n\rFigura 1: Exemplo de imagem do MNIST.\r\r\rFigura 2: Exemplo de MNIST-Captcha.\r\rO que √© GAN?\rA sigla GAN significa Generative Adversarial Networks. N√£o confunda com GAM (Generalized Additive Models)! Trata-se de um modelo recente, introduzido em 2014 pelo Ian Goodfellow, autor do famoso livro DeepLearningBook, que est√° ganhando cada vez mais espa√ßo na comunidade cient√≠fica, por conta de seus impressionantes resultados.\nGAN, na verdade, s√£o dois modelos co-dependentes, o gerador e o discriminador. O gerador tenta gerar novos Captchas a partir de nada, indistingu√≠veis dos originais, e o discriminador tenta discriminar se os Captchas criados pelo gerador s√£o reais ou n√£o. Ou seja, um fica brigando com o outro, e no final temos um excelente gerador de novos Captchas e um excelente discriminador de Captchas.\n\rO que √© AC-GAN?\rQuando nosso interesse est√° na predi√ß√£o, simples GANs n√£o ajudam, pois o discriminadores s√≥ sabem verificar se uma imagem √© original ou fake. No entanto, podemos adicionar respostas no discriminador, tornando-o um modelo duplo, capaz de discriminar imagens reais e falsas e, ao mesmo tempo, capaz de predizer o valor do Captcha.\nOK, mas n√£o est√° claro\rN√£o mesmo. Esses carinhas n√£o s√£o simples. O ideal √© sentar na cadeira e tentar entender o que o modelo faz. Eu fiz minha li√ß√£o de casa, e consegui extrair esses passos:\nColetar uma amostra das imagens de treino\rGerar Captchas fake.\rJuntar com Captchas reais.\rAndar 1 itera√ß√£o no ajuste do discriminador.\rGerar mais Captchas fake.\rCriar uma vari√°vel resposta sint√©tica para avaliar a qualidade do gerador.\rAndar 1 itera√ß√£o no ajuste do gerador, usando o discriminador para avaliar se as imagens foram bem geradas ou n√£o.\rVoltar ao passo 1 at√© coletar a totalidade das imagens de treino\rAplicar os passos 1 at√© 7 com as imagens de teste, para avaliar a performance dos modelos.\r\rOs passos s√£o at√© tranquilos de implementar, mas s√£o dif√≠ceis de entender. Particularmente, as partes que tive mais dificuldade foram 6 e 7.\nVamos ent√£o repassar esses pontos, s√≥ que agora assumindo que temos as fun√ß√µes generator() e discriminator() em m√£os.\n\r\rEstrutura do AC-GAN\rO generator()\rO generator() √© uma fun√ß√£o que recebe como input i) um vetor de valores aleat√≥rios e ii) uma label de um Captcha, e retorna a imagem de um Captcha. Os valores aleat√≥rios s√£o vari√°veis latentes que ajudam a criar os ru√≠dos do Captcha: se n√£o fossem eles, todos os Captchas gerados para uma dada label seriam iguais.\nMatematicamente, o gerador \\(g\\) de uma imagem \\(i\\) se comporta da seguinte forma:\n\\[\r\\mathbf X_i = g(\\mathbf Y_i, \\boldsymbol \\varepsilon_i),\r\\]\nonde\n\r\\(\\mathbf X_i\\) √© uma imagem. No caso da RFB, uma imagem 50x180.\r\\(\\mathbf Y_i\\) √© a label do Captcha, encodada na forma 0-1, como mostrada por esse post\r\\(\\boldsymbol \\varepsilon_i\\) √© um erro aleat√≥rio, usado para que os resultados gerados sejam diferentes toda vez.\r\\(g\\) √© uma fun√ß√£o altamente n√£o linear, capaz de receber os inputs mencionados e retornar uma imagem.\r\rUma forma interessante de representar g() √© atrav√©s de uma rede convolucional ao contr√°rio. Veja os coment√°rios da fun√ß√£o para entender o que ela est√° fazendo.\nbuild_generator \u0026lt;- function() {\r# ru√≠do\rlatent \u0026lt;- layer_input(c(2, 10), name = \u0026quot;noise\u0026quot;)\r# resposta\rlabel \u0026lt;- layer_input(c(2, 10), name = \u0026quot;sampled_labels\u0026quot;)\r# obt√©m o input a partir da soma da resposta e do ru√≠do\rinput \u0026lt;- layer_add(list(label, latent))\routput \u0026lt;- input %\u0026gt;%\r# destr√≥i as dimens√µes existentes e coloca num vetor\rlayer_flatten() %\u0026gt;% # remodela as dimens√µes iniciais da imagem\r# aqui, ela fica com 4 \u0026quot;cores\u0026quot; (canais),\r# 7 linhas e 14 colunas\rlayer_dense(4 * 7 * 14, activation = \u0026quot;tanh\u0026quot;) %\u0026gt;%\rlayer_reshape(c(4, 7, 14)) %\u0026gt;%\r# A rede convolucional transpose com strides aumenta # o tamanho da imagem. Agora est√° em 14 x 28\rlayer_conv_2d_transpose(64, 3, padding = \u0026quot;same\u0026quot;, strides = c(2, 2)) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;% # Agora est√° em 28 x 56\rlayer_conv_2d_transpose(64, 3, padding = \u0026quot;same\u0026quot;, strides = c(2, 2)) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;% # Agora est√° em 28 x 112 (note que strides = c(1, 2))\rlayer_conv_2d_transpose(32, 3, padding = \u0026quot;same\u0026quot;, strides = c(1, 2)) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;% # mais algumas convolucionais para gerar n√£o-linearidade\rlayer_conv_2d(16, 3, padding = \u0026quot;same\u0026quot;) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;%\rlayer_conv_2d(16, 3, padding = \u0026quot;same\u0026quot;) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;%\rlayer_conv_2d(8, 3, padding = \u0026quot;same\u0026quot;) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;%\r# Reduzir o n√∫mero de cores para 1 (imagem preto e branco)\rlayer_conv_2d( 1, 3, padding = \u0026quot;same\u0026quot;, activation = \u0026quot;tanh\u0026quot;)\r# coloca os dois inputs e o output no modelo\rkeras_model(list(latent, image_class), output)\r}\rbuild_generator()\rModel\r___________________________________________________________________________________________\rLayer (type) Output Shape Param # Connected to ===========================================================================================\rnoise (InputLayer) (None, 4, 10) 0 ___________________________________________________________________________________________\rsampled_labels (InputLayer) (None, 4, 10) 0 ___________________________________________________________________________________________\radd_2 (Add) (None, 4, 10) 0 noise[0][0] sampled_labels[0][0] ___________________________________________________________________________________________\rflatten_4 (Flatten) (None, 40) 0 add_2[0][0] ___________________________________________________________________________________________\rdense_10 (Dense) (None, 392) 16072 flatten_4[0][0] ___________________________________________________________________________________________\rreshape_5 (Reshape) (None, 4, 7, 14) 0 dense_10[0][0] ___________________________________________________________________________________________\rconv2d_transpose_4 (Conv2DTra (None, 64, 14, 28) 2368 reshape_5[0][0] ___________________________________________________________________________________________\rleaky_re_lu_10 (LeakyReLU) (None, 64, 14, 28) 0 conv2d_transpose_4[0][0] ___________________________________________________________________________________________\rconv2d_transpose_5 (Conv2DTra (None, 64, 28, 56) 36928 leaky_re_lu_10[0][0] ___________________________________________________________________________________________\rleaky_re_lu_11 (LeakyReLU) (None, 64, 28, 56) 0 conv2d_transpose_5[0][0] ___________________________________________________________________________________________\rconv2d_transpose_6 (Conv2DTra (None, 32, 28, 112) 18464 leaky_re_lu_11[0][0] ___________________________________________________________________________________________\rleaky_re_lu_12 (LeakyReLU) (None, 32, 28, 112) 0 conv2d_transpose_6[0][0] ___________________________________________________________________________________________\rconv2d_8 (Conv2D) (None, 1, 28, 112) 289 leaky_re_lu_12[0][0] ===========================================================================================\rTotal params: 74,121\rTrainable params: 74,121\rNon-trainable params: 0\r___________________________________________________________________________________________\rNo caso, nossa resposta √© 4747:\n [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]\r[1,] 0 0 0 1 0 0 0 0 0 0\r[2,] 0 0 0 0 0 0 1 0 0 0\r[3,] 0 0 0 1 0 0 0 0 0 0\r[4,] 0 0 0 0 0 0 1 0 0 0\rE temos uma matriz de n√∫meros aleat√≥rios do mesmo tamanho:\n [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]\r[1,] -0.06 0.02 -0.08 0.16 0.03 -0.08 0.05 0.07 0.06 -0.03\r[2,] 0.15 0.04 -0.06 -0.22 0.11 0.00 0.00 0.09 0.08 0.06\r[3,] 0.09 0.08 0.01 -0.20 0.06 -0.01 -0.02 -0.15 -0.05 0.04\r[4,] 0.14 -0.01 0.04 -0.01 -0.14 -0.04 -0.04 -0.01 0.11 0.08\rQueremos gerar uma resposta com ru√≠do a partir da resposta e de um vetor de n√∫meros aleat√≥rios. Fazemos isso simplesmente somando as duas quantidades:\nround(y + z , 2)\r [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]\r[1,] -0.06 0.02 -0.08 1.16 0.03 -0.08 0.05 0.07 0.06 -0.03\r[2,] 0.15 0.04 -0.06 -0.22 0.11 0.00 1.00 0.09 0.08 0.06\r[3,] 0.09 0.08 0.01 0.80 0.06 -0.01 -0.02 -0.15 -0.05 0.04\r[4,] 0.14 -0.01 0.04 -0.01 -0.14 -0.04 0.96 -0.01 0.11 0.08\rObserve que os valores da resposta continuam destacados. O resultado da aplica√ß√£o do generator() √© uma imagem com as mesmas dimens√µes do MNIST-Captcha e os n√∫meros dados no input. Queremos que essa imagem seja o mais parecida poss√≠vel com uma imagem real.\n\rO discriminator()\rO discriminador √© um modelo preditivo, mas ele prev√™ duas coisas: i) se a imagem recebida √© real ou fake e ii) qual √© a label de uma imagem recebida. Se o gerador for bom, (i) ter√° dificuldades para funcionar. Se o gerador for muito ruim (i) conseguir√° prever resultados com facilidade.\nVamos a um exemplo de discriminador, tamb√©m usando redes convolucionais:\nbuild_discriminator \u0026lt;- function() {\rimage \u0026lt;- layer_input(shape = c(1, 28, 28*4))\r# rede convolucional LENET-5 bem comum\routput \u0026lt;- image %\u0026gt;%\rlayer_conv_2d(32, 5, padding = \u0026quot;same\u0026quot;) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;% layer_max_pooling_2d() %\u0026gt;% layer_conv_2d(64, 5, padding = \u0026quot;same\u0026quot;) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;% layer_max_pooling_2d() %\u0026gt;% layer_conv_2d(64, 3, padding = \u0026quot;same\u0026quot;) %\u0026gt;%\rlayer_activation_leaky_relu() %\u0026gt;% layer_flatten() %\u0026gt;% layer_dense(64, activation = \u0026quot;relu\u0026quot;) %\u0026gt;%\rlayer_dropout(0.2) %\u0026gt;% layer_dense(128, activation = \u0026quot;relu\u0026quot;)\rcnn \u0026lt;- keras_model(image, output)\rfeatures \u0026lt;- cnn(image)\r# chega a primeira resposta (fake, n√£o fake)\rfake \u0026lt;- features %\u0026gt;% layer_dense(32, activation = \u0026quot;tanh\u0026quot;) %\u0026gt;% layer_dense(1, activation = \u0026quot;sigmoid\u0026quot;, name = \u0026quot;generation\u0026quot;)\r# chega na segunda resposta (Y)\raux \u0026lt;- features %\u0026gt;%\rlayer_dense(4 * 10, activation = \u0026quot;relu\u0026quot;) %\u0026gt;% layer_reshape(c(4, 10)) %\u0026gt;% layer_activation(\u0026quot;softmax\u0026quot;, name = \u0026quot;auxiliary\u0026quot;)\r# junta os dois no resultado\rkeras_model(image, list(fake, aux))\r}\rbuild_discriminator()\rModel\r___________________________________________________________________________________________\rLayer (type) Output Shape Param # Connected to ===========================================================================================\rinput_4 (InputLayer) (None, 1, 28, 112) 0 ___________________________________________________________________________________________\rmodel_5 (Model) (None, 128) 900224 input_4[0][0] ___________________________________________________________________________________________\rdense_9 (Dense) (None, 40) 5160 model_5[1][0] ___________________________________________________________________________________________\rdense_8 (Dense) (None, 32) 4128 model_5[1][0] ___________________________________________________________________________________________\rreshape_4 (Reshape) (None, 4, 10) 0 dense_9[0][0] ___________________________________________________________________________________________\rgeneration (Dense) (None, 1) 33 dense_8[0][0] ___________________________________________________________________________________________\rauxiliary (Activation) (None, 4, 10) 0 reshape_4[0][0] ===========================================================================================\rTotal params: 1,819,090\rTrainable params: 909,545\rNon-trainable params: 909,545\r___________________________________________________________________________________________\rNote que o resultado √© uma lista de dois outputs.\n\rO gan()\rgan() √© a fun√ß√£o que junta o discriminador e o gerador. Em teoria, ela n√£o serve para nada: √© s√≥ um meio pr√°tico de ajustar o modelo do gerador. Fazemos isso gerando algumas imagens falsas e avaliando a qualidade do gerador por quanto ele √© capaz de enganar o discriminador. Se o discriminador √© muito ruim, qualquer gerador vai mandar bem. Se o discriminador √© muito bom, o gerador ter√° de criar Captchas excepcionais para ganhar pontos.\nO gan() √© definido de forma muito simples, com:\n# placeholder para ru√≠do\rlatent \u0026lt;- layer_input(shape = list(4L, 10L))\r# placeholder para resposta\rimage_class \u0026lt;- layer_input(shape = list(4L, 10L))\r# imagem falsa\rfake \u0026lt;- generator(list(latent, image_class))\r# Only want to be able to train generation for the combined model\r# S√≥ queremos treinar o generator nessa parte;\r# utilizaremos o discriminator apenas para # avalia√ß√£o da qualidade do gerador.\r# Por isso, congelamos o discriminator aqui.\rfreeze_weights(discriminator)\rresults \u0026lt;- discriminator(fake)\rgan \u0026lt;- keras_model(list(latent, image_class), results)\rgan\rModel\r___________________________________________________________________________________________\rLayer (type) Output Shape Param # Connected to ===========================================================================================\rinput_5 (InputLayer) (None, 4, 10) 0 ___________________________________________________________________________________________\rinput_6 (InputLayer) (None, 4, 10) 0 ___________________________________________________________________________________________\rmodel_7 (Model) (None, 1, 28, 112) 74121 input_5[0][0] input_6[0][0] ___________________________________________________________________________________________\rmodel_6 (Model) [(None, 1), (None, 909545 model_7[1][0] ===========================================================================================\rTotal params: 983,666\rTrainable params: 74,121\rNon-trainable params: 909,545\r___________________________________________________________________________________________\r\r\rMas funciona?\r√â uma pergunta natural. Esse modelo √© meio maluco, pois usa uma parte do modelo para avaliar a qualidade do outro. Mas sim, temos alguns resultados matem√°ticos que garantem que estamos em um bom territ√≥rio.\nMeu desejo era coloc√°-los aqui, mas ainda n√£o sei explicar todos os detalhes. Pretendo estudar mais e adicionar em novos posts.\n\rExemplo de aplica√ß√£o nos MNIST-Captcha\rO exemplo completo que rodei com os MNIST-Captchas est√° neste link. Decidi n√£o colocar o c√≥digo completo aqui pois a minha implementa√ß√£o est√° muito feia o post ficaria muito longo.\nMuito bem, se o modelo serve para prever e para gerar, vamos avaliar a qualidade nesses quesitos.\nPrev√™ bem?\rA taxa de acerto de cada d√≠gito do MNIST-Captcha foi de 95%. Como temos 4 d√≠gitos nesse caso, o acerto de todo o Captcha seria de 81%. Comparado com os modelos funcionando em produ√ß√£o do pacote decryptr, esse resultado √© ruim. L√°, as taxas de acerto do Captcha s√£o de no m√≠nimo 93% e tem casos que acertamos tudo. Mas eu acredito que o motivo disso √© que n√£o ajustamos bem os hiperpar√¢metros. Se fizermos isso, provavelmente ficar√° melhor.\n\rGera bem?\rVamos ver! Para testar o gerador, montamos uma fun√ß√£o que gera e plota uma imagem a partir de um vetor de respostas:\ngenerate_image \u0026lt;- function(num = sample(0:9, 4)) {\r# Gerando barulho\rnoise \u0026lt;- rnorm(4 * 10, 0, .01) %\u0026gt;%\rarray(dim = c(4, 10)) %\u0026gt;% array_reshape(c(1, dim(.)))\r# Resposta (aleatorizada ou input)\rsampled_labels \u0026lt;- num %\u0026gt;%\rmatrix(ncol = 4) %\u0026gt;% # gera o one-hot dessa resposta\rtransform_to_matrix() %\u0026gt;% array_reshape(c(1, dim(.)))\r# Aplicar generator\rimg \u0026lt;- predict(generator, list(noise, sampled_labels))[1,1,,]\r# a imagem foi deixada em (-1,1). Arrumando\rpar(mar = rep(0, 4))\rplot(as.raster((img + 1) / 2))\r}\rRodando para alguns exemplos:\ngerar_imagem(c(1, 2, 4, 4))\rgerar_imagem(c(4, 0, 4, 7))\rgerar_imagem(c(9, 9, 9, 9))\rO que achou? Note que a √∫ltima est√° errada.\n\r\rPr√≥ximos passos\r\rFazer o GAN funcionar para mais Captchas.\rTestar algumas dicas que o Athos me passou.\rBuscar uma forma de aproveitar a informa√ß√£o parcial advinda de or√°culos. Fica o mist√©rio para os pr√≥ximos posts.\r\r\rWrap-up\r\rGAN √© um modelo interessante que pode nos ajudar a montar modelos n√£o supervisionados (diretamente) e supervisionados (AC-GAN).\rPara montar um GAN, voc√™ precisa definir um gerador e um discriminador.\rO AC-GAN parece ser uma boa abordagem para Captchas, considerando que temos muitas imagens dispon√≠veis e poucas classificadas.\rAinda temos muito a descobrir sobre esse modelo.\r\r\rAgradecimentos\rSempre ao Daniel Falbel, que √© meu guru do Deep Learning e autor do exemplo inicial que foi adaptado para esse post. Tamb√©m agrade√ßo ao Athos pelos insights e links que me passou!\n\r","permalink":"https://blog.curso-r.com/posts/2019-03-04-gan-captcha/","tags":["captcha"],"title":"Quebrando Captchas - Parte VI: Redes Generativas Adversariais com Classificador Auxiliar"},{"author":["Julio"],"categories":["tutoriais"],"contents":"\r\rEsse √© um post de matem√°tica. Mesmo se voc√™ n√£o curte essa faceta da ci√™ncia de dados, encorajo voc√™s a lerem e estudarem esse assunto. Nesse texto vou usar um pouco de teoria dos conjuntos e introduzir a teoria da medida, que √© a base matem√°tica de tudo que sabemos sobre probabilidade.\nAos matem√°ticos: eu tentei simplificar ao m√°ximo a linguagem, ent√£o posso ter cometido alguns deslizes. N√£o sou o Billingsley, ent√£o n√£o pe√ßo desculpas! ;)\nObjetivo\rNosso objetivo √© definir matematicamente a fun√ß√£o probabilidade. Isso √© diferente de definir a interpreta√ß√£o da probabilidade, como a interpreta√ß√£o frequentista e subjetivista, que √© assunto para outro texto.\nPra qu√™? Durante meus estudos, o argumento mais comum usado para me convencer a estudar probabilidade e medida foi: se voc√™ constr√≥i toda a estat√≠stica ‚Äì e consequentemente boa parte da ci√™ncia ‚Äì a partir de um objeto matem√°tico, √© bom que esse objeto esteja bem definido e funcione direito, n√©!? Mas n√≥s sabemos que ele est√° bem definido, pois j√° disseram isso pra gente em algum momento no passado. Devem ter v√°rias pessoas que j√° se preocuparam com isso, ent√£o deve funcionar!\nPor isso, eu vou te dar outro argumento: se algum dia voc√™ montar um novo modelo estat√≠stico e quiser mostrar que ele prev√™ bem em bases de dados diferentes da sua, voc√™ precisar√° extrair algumas propriedades do seu modelo. E para extrair essas propriedades, voc√™ precisar√° manjar de probabilidade no n√≠vel de medida.\n\rN√£o adianta voc√™ ser dono de uma padaria, contratar um padeiro e n√£o saber fazer p√£o. Um dia seu padeiro vai faltar e voc√™ estar√° ferrado.\n‚Äì WUNDERVALD, J.\n\r√â dif√≠cil? SIM! A defini√ß√£o de probabilidade seria muito simples e intuitiva se n√£o fossem algumas dificuldades associadas ao conjunto dos n√∫meros reais \\(\\mathbb R\\), e o fato deles serem n√£o cont√°veis1. Por isso, convido voc√™s a entrarem comigo nessa jornada com os seguintes passos:\nTentar definir a probabilidade intuitivamente.\rVerificar que essa defini√ß√£o tem problemas.\rTirar da cachola uma tal de \\(\\sigma\\)-√°lgebra que, em tese, resolve (2).\rMostrar que ela de fato resolve (2), mostrando mais um conjunto tirado da cachola: o conjunto dos mensur√°veis.\rMostrar que \\(\\sigma\\)-√°lgebras s√£o dif√≠ceis de trabalhar.\rMostrar que tem uma forma de trabalhar (5) sem nos deixar o cabelo em p√©, gra√ßas ao nosso amigo Caratheodory.\r\r\rDefinindo a probabilidade com intui√ß√£o\rProbabilidade nada mais √© que medir eventos, soltando n√∫meros entre zero e um. Mas o que s√£o eventos, e o que √© medir?\nO exemplo mais f√°cil de medida que consigo pensar √© a r√©gua. A r√©gua √© uma fun√ß√£o \\(\\lambda(\\cdot)\\) que recebe como input um intervalo \\((a,b]\\) e retorna \\(b-a\\). Ou seja, a fun√ß√£o de medida √© uma fun√ß√£o que trabalha com conjuntos e retorna n√∫meros reais n√£o-negativos. Mas \\(b-a\\) pode ser maior que um, ou at√© infinito. Logo, a probabilidade √© um caso particular de medida, que recebe como input um conjunto e como output um n√∫mero no intervalo \\([0,1]\\).\nNo caso da r√©gua, daria para resolver isso for√ßando \\(0 \\leq a \u0026lt; b \\leq 1\\). Assim todos os intervalos teriam medida entre zero e um. De fato, quando trabalhamos com vari√°veis aleat√≥rias\nNo entanto, nem tudo na vida s√£o intervalos na reta. Queremos poder calcular probabilidade de chover amanh√£, ou ent√£o a probabilidade de um cliente ficar inadimplente ap√≥s 100 dias ou mais. Para isso, precisamos definir um conjunto abstrato \\(\\Omega\\), que chamamos de espa√ßo amostral. Esse carinha cont√©m os eventos individuais que estamos interessados, e calculamos probabilidades sobre combina√ß√µes de peda√ßos dele.\nEssas combina√ß√µes de peda√ßos (ou subconjuntos) de \\(\\Omega\\) s√£o os eventos. Por exemplo, no caso da chuva \\(\\Omega\\) seria \\(\\{\\text{chover},\\text{n√£o chover}\\}\\) e calculamos probabilidades sobre \\(\\{\\text{n√£o chover}\\}\\), \\(\\{\\text{chover}\\}\\), \\(\\{\\text{n√£o chover}\\} \\text{ ou } \\{\\text{chover}\\}\\), e o vazio \\(\\emptyset\\). No caso da inadimpl√™ncia, nosso \\(\\Omega\\) poderia ser os naturais \\(\\mathbb N\\), por exemplo, e o evento de interesse seria \\(\\{i\\in \\mathbb N: i \\geq 100\\}\\).\nPrimeiro, defina como \\(\\mathcal P(\\Omega)\\) como o conjunto de todos os eventos baseados em \\(\\Omega\\). Chamamos esse objeto de partes de \\(\\Omega\\). Esse cara √© bem grande, pois tem n√£o s√≥ o pr√≥prio \\(\\Omega\\) e o vazio \\(\\emptyset\\), como tamb√©m todas as poss√≠veis combina√ß√µes de subconjuntos do \\(\\Omega\\). No caso da chuva, s√£o apenas os quatro eventos citados no par√°grafo anterior. No caso da inadimpl√™ncia, temos todos os n√∫meros naturais e ainda todas as combina√ß√µes desses n√∫meros. No caso da r√©gua ent√£o, temos desde o intervalo \\((0, \\frac \\pi 4]\\) at√© o conjunto de Cantor, o que pode ser bem infinito!\nSegundo, uma propriedade desej√°vel da probabilidade √© a aditividade. Ela significa que se eu tiver em m√£os dois eventos disjuntos (ou seja, com interse√ß√£o vazia), a probabilidade de algum desses eventos ocorrer √© igual √† soma das probabilidades de cada um desses eventos. Essa √© uma suposi√ß√£o bem intuitiva no caso da r√©gua. Se voc√™ pegar dois intervalos separados de uma reta e medir os dois intervalos de uma vez, isso ser√° equivalente a medir cada um dos intervalos e depois somar. Curiosamente, existem √°reas grandes da matem√°tica/estat√≠stica que trabalham com medidas que n√£o seguem essa regra. Veja, por exemplo, a medida de possibilidade.\nAgora estamos prontos para definir a medida de probabilidade. Queremos uma fun√ß√£o \\(\\mathbb P(\\cdot)\\) que tenha as seguintes caracter√≠sticas:\nRecebe um elemento de \\(\\mathcal P(\\Omega)\\) e retorna um n√∫mero real n√£o-negativo.\r(Normaliza√ß√£o) \\(P(\\Omega) = 1\\). Isso obriga a probabilidade a ficar sempre entre zero e um, pois nada tem medida maior que \\(\\Omega\\).\r(Aditividade) Para a sequ√™ncia \\(A_j\\), \\(j \\in \\mathbb N\\), com \\(A_j \\cap A_k = \\emptyset\\) (disjuntos) para todo \\(j\\) e \\(k\\), vale \\(\\mathbb P(\\cup_j A_j) = \\sum_j \\mathbb P(A_j)\\).\r\rNote que, se voc√™ pensar que \\(\\cup_j A_j\\) √© como uma soma dos \\(A_j\\), a propriedade (3) √© o que permite ‚Äúpassar a soma para fora‚Äù da probabilidade.\nNote tamb√©m que eu coloquei a√≠ uma uni√£o infinita e cont√°vel. Alguns pesquisadores gostam de restringir a medida de probabilidade para uni√µes finitas apenas. Isso ajuda bastante na parte matem√°tica, mas pode levar a alguns problemas pr√°ticos. Isso gerou uma treta enorme entre os matem√°ticos: leia aqui para uma abordagem hist√≥rica do tema. No final, a vers√£o mais popular √© a com uni√µes infinitas.\nMuito bem, esses s√£o os famosos Axiomas de Kolmogorov! Ou quase‚Ä¶\n\rO problema de usar as partes como a base de tudo\rEu comentei alguns par√°grafos atr√°s que a cole√ß√£o \\(\\mathcal P(\\Omega)\\) pode ser um objeto muito infinito. O problema √© que esse conjunto pode ser t√£o, mas t√£o grande, que pode bugar a fun√ß√£o de probabilidade. Um exemplo famoso de bug se chama conjunto de Vitali: a medida desse evento leva a uma contradi√ß√£o.\nPara explicar esse conjunto, vamos voltar √† medida r√©gua \\(\\lambda\\), sem restringir ao zero e um. A r√©gua tem mais uma propriedade interessante: se \\(x\\in \\mathbb R\\), o conjunto transladado \\(x+A\\), ou seja, o conjunto formado por todos os elementos de \\(A\\) somados de \\(x\\), tem a mesma medida que \\(A\\). Por exemplo, se \\(A = (a,b]\\), ent√£o \\(A+x = (a+x,b+x]\\), e a medida desse conjunto √©\n\\[\\lambda(A+x) = \\lambda((a+x,b+x]) = (b+x)-(a+x) = b-a = \\lambda(A).\\]\nAgora vamos ao exemplo de conjunto n√£o mensur√°vel. O exemplo √© um caso de matem√°gica, ou seja, √© bem complicado tirar a intui√ß√£o dele. Al√©m disso, esse exemplo usa diretamente o axioma da escolha. Mas tudo bem, √© um exemplo, e vamos ver que ele funciona.\nPasso 1. Para cada \\(x \\in \\mathbb R\\), defina \\([x] = \\{y\\in \\mathbb R, y-x \\in \\mathbb Q\\}\\). Ou seja, para cada \\(x\\) criamos um subconjunto de \\(\\mathbb R\\) que cont√©m todos os n√∫meros que subtra√≠dos de \\(x\\) s√£o racionais. Por exemplo, se \\(x = \\sqrt 2\\), \\([x] = \\{\\sqrt 2, 2\\sqrt 2, \\dots\\}\\) (s√£o muitos casos poss√≠veis). Defina o conjunto de todos os poss√≠veis \\([x]\\) de \\(\\Lambda\\). ou seja, \\(\\Lambda\\) √© o conjunto dos conjuntos \\([x]\\), e cada elemento \\(\\alpha \\in \\Lambda\\) √© um conjunto que cont√©m uma por√ß√£o de n√∫meros reais.\nPasso 2. Note que para cada conjunto \\(\\alpha \\in \\Lambda\\), sempre existe um elemento \\(a \\in \\alpha\\) que est√° no intervalo \\((0,1)\\). Agora, para cada \\(\\alpha \\in \\Lambda\\), pegamos um elemento \\(a_\\alpha \\in \\alpha\\) que est√° no intervalo \\((0,1)\\). Finalmente, chamamos \\(\\Omega\\) de todos esses conjuntos \\(a_\\alpha\\), e temos \\(\\Omega \\subseteq (0,1)\\). Numa imagem:\nMuito bem. Agora, note que se \\(p,q \\in \\mathbb Q\\), ent√£o \\((\\Omega+q)\\) e \\((\\Omega+p)\\) s√£o disjuntos. Na verdade, se n√£o fossem disjuntos, isso significaria que \\(p=q\\) e os conjuntos coincidiriam. Isso acontece porque, se \\(x \\in (\\Omega+q)\\cap (\\Omega+p)\\), ent√£o \\(x\\) √© um elemento dos dois conjuntos:\n\\[x = a+p = b+q \\implies b-a=q-p\\]\nComo \\(q-p\\) √© racional, ent√£o \\(b-a\\) √© racional, logo \\(b \\in [a]\\). Mas n√≥s montamos \\(\\Omega\\) com apenas um elemento de cada conjunto \\([a]\\) como esse, ent√£o \\(a=b\\). Logo, \\(p=q\\).\nAgora, vamos √†s contas. Estamos interessados em calcular, para \\(-1\u0026lt;p\u0026lt;1\\), \\(p \\in \\mathbb Q\\), a medida\n\\[\r\\lambda\\left(\\bigcup_{p} (\\Omega + p)\\right)\r\\]\nPor um lado, temos que \\(\\bigcup_{p} (\\Omega + p) \\subseteq(-1,2)\\). Ent√£o,\n\\[\r\\lambda\\left(\\bigcup_{p} (\\Omega + p)\\right) \\leq \\lambda((-1, 2]) = 3.\r\\]\nPor outro lado, como os \\((\\Omega + p)\\) s√£o disjuntos, temos\n\\[\\lambda\\left(\\bigcup_{p} (\\Omega + p)\\right) = \\sum_p\\lambda(\\Omega+p) = \\sum_p\\lambda(\\Omega)\\]\nComo estamos somando v√°rias vezes o mesmo termo, e como a soma deve ser menor ou igual a 3, ent√£o temos que \\(\\lambda(\\Omega) = 0\\). Logo,\n\\[\r\\lambda\\left(\\bigcup_{p} (\\Omega + p)\\right) = 0.\r\\]\nE agora vem o problema. Para \\(x \\in (0,1)\\), temos que existe um \\(a \\in [x]\\) que est√° em \\(\\Omega\\), certo? E sabemos tamb√©m que esse \\(a \\in (0,1)\\), porque definimos assim. Como \\(a \\in [x]\\), ent√£o \\(p^* = a - x\\) √© racional. Al√©m disso, \\(-1\u0026lt;p^*\u0026lt;1\\), por conta dos valores de \\(a\\) e \\(x\\). Logo, \\(x = a + p\\), onde \\(p=-p^*\\), ent√£o \\(x \\in (\\Omega + p)\\). Como isso vale para todo \\(x \\in (0,1)\\), temos que\n\\[(0,1) \\subseteq \\bigcup_{p} (\\Omega + p)\\]\rLogo,\n\\[\\lambda\\left(\\bigcup_{p} (\\Omega + p)\\right) \\geq \\lambda((0,1)) = 1\\]\nU√©, mas um n√∫mero n√£o pode ser zero e maior ou igual a um ao mesmo tempo. Isso √© uma contradi√ß√£o. Logo, como encontramos problemas em elementos de \\(\\mathcal P(\\Omega)\\), n√£o podemos definir a probabilidade nesse conjunto.\n\rA solu√ß√£o: \\(\\sigma\\)-√°lgebras\rUma \\(\\sigma\\)-√°lgebra \\(\\mathcal F\\) √© um conjunto de subconjuntos, como as partes, mas um pouco menor. Ela tem condi√ß√µes restritivas restritivas:\n\\(\\Omega \\in \\mathcal F\\)\rse \\(A \\in \\mathcal F\\), ent√£o \\(A^c \\in \\mathcal F\\).\rse \\(A_j \\in \\mathcal F, j\\in \\mathbb N\\), ent√£o \\(\\cup_j A_j \\in \\mathcal F\\).\r\r[este post ainda n√£o est√° finalizado. Volte depois‚Ä¶]\n\r\rUm conjunto cont√°vel \\(A\\) √© um conjunto que podemos mapear nos naturais \\(\\mathbb N\\). Ou seja, \\(A\\) √© cont√°vel se conseguirmos montar uma fun√ß√£o que associe cada elemento \\(a \\in A\\) a um novo elemento \\(n \\in \\mathbb N\\). Por exemplo, o conjunto dos inteiros \\(\\mathbb I\\) √© cont√°vel, pois, podemos montar uma fun√ß√£o que mapeia os n√∫meros positivos nos naturais pares e os negativos nos naturais √≠mpares. Outro exemplo de conjunto cont√°vel s√£o os racionais \\(\\mathbb Q\\). Um conjunto n√£o cont√°vel s√£o os irracionais (aquele que tem \\(\\pi\\), \\(e\\), \\(\\sqrt 2\\), etc) e o conjunto dos reais \\(\\mathbb R\\), j√° que ele cont√©m os irracionais. Vamos:‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2019-03-10-probabilidade/","tags":["estat√≠stica"],"title":"Probabilidade e medida: intui√ß√£o"},{"author":["Bruna Wundervald","Julio"],"categories":["an√°lises"],"contents":"\r\rIntrodu√ß√£o\rEsse ano, vamos participar da\rEscola de Modelos de Regress√£o (EMR-2019).\rTrata-se de um evento voltado a um nicho da comunidade de estat√≠sticos,\ros regresseiros, e traz avan√ßos importantes na √°rea de Regress√£o.\nPor√©m ao olhar a programa√ß√£o do evento ficamos surpresos com a baixa propor√ß√£o de mulheres dentre palestrantes e coordenadores. Isso √© um problema recorrente na comunidade cient√≠fica, especialmente em congressos: a maior parte dos eventos acabam apresentando propor√ß√µes baixas de mulheres. Nos √∫ltimos\ranos, v√°rios grupos t√™m monitorado e denunciado ocorr√™ncias desse fen√¥meno.\rPara enriquecer os debates aqui no Brasil, decidimos organizar os dados\rde tr√™s eventos (2 recentes e um que ainda vai acontecer este ano):\n\rEMR 2019: O evento que gerou a discuss√£o.\rRBras 2018: Evento sobre estat√≠stica aplicada a agronomia.\rSinape 2018: Maior evento sobre Estat√≠stica do Brasil.\r\r\rObten√ß√£o dos dados\rOs scripts para obten√ß√£o e organiza√ß√£o dos dados foram colocados nesse reposit√≥rio.\rUtilizamos as fun√ß√µes do tidyverse como manda o figurino, e o\rpacote httr para acessar as p√°ginas que cont√™m as informa√ß√µes.\rNo caso da EMR e do Sinape, utilizamos o pacote xml2 para extra√ß√£o\rdos conte√∫dos nas p√°ginas. No caso da RBras, foi necess√°rio utilizar\ro pdftools, pois as informa√ß√µes estavam em um arquivo PDF.\nA classifica√ß√£o do sexo foi feita manualmente. Adotamos a seguinte\restrat√©gia: criamos uma coluna com ‚ÄúM‚Äù de masculino e fomos substituindo\rquando o nome era de uma mulher. O trabalho foi f√°cil, j√° que a propor√ß√£o\rde mulheres era mais baixa em todos os casos‚Ä¶\nNo total, ficamos com 20 nomes para a EMR 2019 (que ainda n√£o tem a programa√ß√£o\rcompleta), 68 nomes para o Sinape 2018 e 102 nomes para a RBras 2018.\rQuando a mesma pessoa participa de duas atividades, o nome foi duplicado.\nOBS: No caso da RBras, pegamos sempre o nome do primeiro autor ou primeiro palestrante das confer√™ncias. Isso pode ter causado alguma pequena distor√ß√£o nos resultados, se houver um vi√©s na escolha do primeiro nome dos trabalhos com rela√ß√£o ao sexo.\n\rResultados\rObservamos a maior discrep√¢ncia na EMR 2019. A propor√ß√£o de mulheres √© menor 40% em todos os tipos de participa√ß√£o. No caso dos palestrantes, a participa√ß√£o feminina √© menor que 20%.\nNo Sinape 2018, os resultados se repetem para palestrantes e conferencistas, mas se inverte para coordenadores. Dos 11 coordenadores, 8 s√£o mulheres.\nNa RBras 2018, observamos novamente menor participa√ß√£o feminina, mas de forma menos gritante que o EMR 2019. No caso dos coordenadores, a participa√ß√£o √© igual para homens e mulheres.\nConsiderando os totais de cada evento, temos que a RBras 2018 √© a que se aproxima mais de ser parit√°ria, mas ainda longe do ideal, com aproximadante 35% de participa√ß√£o feminina.\n\r\r\r\r\r\r\r\r\r\r\rConclus√µes\rClaramente, existe falta de diversidade nas programa√ß√µes principais\rdos mais importantes eventos de Estat√≠stica no Brasil. A desculpa mais\rcomum que organizadores de congressos d√£o para isso √© de que n√£o existiam\rmulheres pra convidar, o que n√£o √© verdade. Talvez o que falte seja\ro reconhecimento da necessidade de consertar essa falha, e aplicar\ralgumas simples medidas, como:\nBuscar atingir um m√≠nimo realista de mulheres convidadas a palestrar nos\reventos.\rConsiderar outras minorias de g√™nero para as posic√µes.\rAbrir espa√ßo nos eventos para tratar do tema, e evidenciar o quanto\r√© importante combater o sexismo na academia. Exemplos de\reventos de estat√≠stica no Brasil com iniciativas parecidas s√£o o\rSeR 2018 e o RDay 2018.\rAmbos tiveram palestras da Gabriela de Queiroz, fundadora\rdo R-Ladies, sobre o assunto em quest√£o.\r\rE n√£o √© s√≥ isso, muito mais pode ser feito para promover a diversidade\rem eventos, desde o oferecimento de bolsas para minorias at√© a\rrealiza√ß√£o de eventos sat√©lites focados apenas nos trabalhos\rdelas. Medidas como essa est√£o cada vez mais populares em diversos\rramos da ci√™ncia, como na ci√™ncia computa√ß√£o e intelig√™ncia artificial.\rContinuar ignorando esse problema da\rcomunidade estat√≠stica s√≥ tem consequ√™ncias ruins: perderemos\rrelev√¢ncia e ficaremos para tr√°s.\nNo futuro, seria interessante colher e organizar os dados\rde mais eventos, para monitorar e pressionar os comit√™s organizadores, pois\rainda temos muito a evoluir para que a comunidade cient√≠fica deixe de\rpriorizar o sexo masculino em confer√™ncias.\nAproveitando: A Gabriela de Queiroz √© finalista do Women in Open Source Award. Voc√™ pode votar na sua finalista preferida nesse link.\n\r","permalink":"https://blog.curso-r.com/posts/2019-02-16-eventos-mf/","tags":["comunidade"],"title":"Precisamos falar sobre a participa√ß√£o de mulheres em eventos de estat√≠stica"},{"author":["Julio"],"categories":["tutoriais"],"contents":"\r\rAVISO: Infelizmente a fun√ß√£o pvec() n√£o est√° mais no pacote abjutils! No final deste texto deixamos o seu c√≥digo para que o leitor possa implement√°-la por conta pr√≥pria.\nQuando usamos la√ßos para rodar algoritmos complexos em uma lista de inputs, podemos pensar em power-ups. Tratam-se de funcionalidades que ajudam na aplica√ß√£o dos la√ßos, tanto do ponto de vista de efici√™ncia do c√≥digo quanto do ponto de vista de efici√™ncia do trabalho do cientista de dados.\nAqui na Curso-R n√≥s j√° vimos tr√™s desses power-ups:\n\rComo fazer la√ßos em paralelo.\rComo usar barras de progresso\rComo fazer tratamento de erros.\r\rMas ser√° que tem um jeito de juntar essas tr√™s funcionalidades em apenas uma opera√ß√£o?\nSim, √© claro que tem. E se algo √© poss√≠vel no R, o Caio Lente j√° fez. Trata-se da opera√ß√£o pvec(), do pacote abjutils.\nPara utiliz√°-la, voc√™ precisar√° instalar a vers√£o de desenvolvimento do abjutils no GitHub:\ndevtools::install_github(\u0026quot;abjur/abjutils\u0026quot;)\rPode ser que o pvec() n√£o funcione muito bem no Windows. Isso √© algo que vamos trabalhar no futuro.\nComo funciona\rO pvec() recebe duas informa√ß√µes de entrada: uma lista ou vetor de inputs e uma fun√ß√£o a ser aplicada. O pvec() funciona exatamente como um purrr::map(), mas retorna um data.frame com os outputs.\nPor exemplo, digamos que nosso objetivo seja aplicar a fun√ß√£o\nfuncao \u0026lt;- function(x) {\r# dorme 1s\rSys.sleep(1)\r# aplica o log\rlog(x)\r}\rem uma lista de entradas, dada por\ninput \u0026lt;- list(1, 2, -1, \u0026quot;a\u0026quot;)\rO resultado √© dado por:\nresultado \u0026lt;- abjutils::pvec(input, funcao)\rresultado\r# A tibble: 4 x 3\rid return output \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;list\u0026gt; 1 1 result \u0026lt;dbl [1]\u0026gt; 2 2 result \u0026lt;dbl [1]\u0026gt; 3 3 result \u0026lt;dbl [1]\u0026gt; 4 4 error \u0026lt;S3: simpleError\u0026gt;\rOu seja, o resultado √© um data.frame, que tem o n√∫mero de linhas exatamente igual ao comprimento do vetor ou lista de entrada, e tr√™s colunas espec√≠ficas.\nid, que guarda o √≠ndice de entrada. Se a lista de entrada √© nomeada, id guarda esses nomes.\rreturn identifica se a aplica√ß√£o retornou num resultado (result) ou erro (error)\routput √© uma coluna-lista que cont√©m os resultados. Quando o resultado √© um erro, o erro √© capturado e colocado no elemento correspondente.\r\rOu seja, uma caracter√≠stica do pvec() √© que ele nunca ir√° travar. Se essa opera√ß√£o travar, √© porque o computador todo travou.\n√â importante notar que alguns resultados nesse caso s√£o NaN. Isso ocorre pois log(-1) resulta em NaN, acompanhado de um warning. O pvec() n√£o trabalha com warnings.\nOutra caracter√≠stica importante do pvec() √© que ele roda em paralelo. Voc√™ pode controlar a quantidade de n√∫cleos de processamento com o par√¢metro .cores. Por padr√£o, ele usar√° o n√∫mero de n√∫cleos da sua m√°quina.\nFinalmente, o que n√£o poderia faltar no pvec() √© a utiliza√ß√£o de barras de progresso. Por exemplo, considerando como input\ninput \u0026lt;- list(a = 1, b = 2, c = -1, d = \u0026quot;a\u0026quot;,\re = 2, f = 3, g = -2, h = \u0026quot;b\u0026quot;)\rO resultado √©\nabjutils::pvec(input, funcao)\rProgress: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 100%\rProgress: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 100%\r# A tibble: 8 x 3\rid return output \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;list\u0026gt; 1 a result \u0026lt;dbl [1]\u0026gt; 2 b result \u0026lt;dbl [1]\u0026gt; 3 c result \u0026lt;dbl [1]\u0026gt; 4 d error \u0026lt;S3: simpleError\u0026gt;\r5 e result \u0026lt;dbl [1]\u0026gt; 6 f result \u0026lt;dbl [1]\u0026gt; 7 g result \u0026lt;dbl [1]\u0026gt; 8 h error \u0026lt;S3: simpleError\u0026gt;\rSe voc√™ quiser desligar a barra de progresso, basta adicionar .progress = FALSE.\n\rO par√¢metro .flatten\rEsse √© o par√¢metro dos pregui√ßosos (eu que pedi para o Caio adicionar). Em muitas opera√ß√µes, o resultado que sai no output √© uma lista de data.frames ou uma lista de vetores. A op√ß√£o .flatten faz tidyr::unnest(), empilhando os resultados e colando tudo num vetor ou data.frame.\nO √∫nico problema √© que nesse caso n√£o √© poss√≠vel guardar os erros. Por isso, o pvec() retorna um warning:\nabjutils::pvec(input, funcao, .flatten = TRUE)\rProgress: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 100%\r# A tibble: 6 x 2\rid output\r\u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r1 a 0 2 b 0.693\r3 c NaN 4 e 0.693\r5 f 1.10 6 g NaN Warning message:\rSince \u0026#39;.flatten = TRUE\u0026#39;, a total of 2 errors are being ignored \rNote que o resultado tem 6 linhas, menor que a entrada, que tem 8 elementos. Por isso, use .flatten somente quando voc√™ tem certeza do que est√° fazendo.\n\rPor tr√°s dos panos: o furrr\rO pvec() s√≥ funciona por conta de dois excelentes pacotes:\n\ro future, que √© um novo paradigma de computa√ß√£o em paralelo no R.\ro furrr, que faz todo o trabalho sujo e implementa a maioria das opera√ß√µes do purrr usando future.\r\rSe quiser estudar esses pacotes e implementar suas pr√≥prias solu√ß√µes, recomendo acessar aqui e aqui. N√£o inclu√≠ detalhes desses pacotes aqui para n√£o sair do foco.\nSe quiser adicionar op√ß√µes do future no pvec(), basta adicion√°-las na op√ß√£o .options. Por padr√£o, passamos furrr::future_options() nesse argumento.\nDiscuss√£o: o future √© o futuro do purrr?\rO purrr cont√©m uma s√©rie de discuss√µes no GitHub sobre a possibilidade de rodar fun√ß√µes em paralelo e com barras de progresso. Pode ser que a funcionalidade do pvec() passe a ser parte oficial no futuro.\nVeremos!\n\r\rWrap-up\rabjutils::pvec() √© um map() que roda em paralelo, tem barras de progresso e trata erros automaticamente.\rVoc√™ pode brincar com as op√ß√µes .cores, .progress e .flatten para controlar o comportamento do pvec(). Tome muito cuidado com o .flatten, pois ele pode n√£o tratar os erros da forma que voc√™ imagina!\rEstude future e furrr se quiser estender as funcionalidades do pvec().\r\r√â isso pessoal. Happy coding ;)\n\rP.S.: C√≥digo\rComo dito no come√ßo deste post, a fun√ß√£o pvec() foi removida do abjutils por causa de alguns problemas nas depend√™ncias que dificultavam a sua manuten√ß√£o em um pacote. O c√≥digo dela est√° preservado aqui para que voc√™ possa implement√°-la por conta pr√≥pria e ainda √© poss√≠vel acess√°-la no arquivo do abjutils.\n#\u0026#39; @title Verbose, parallel, and safe map-like\r#\u0026#39;\r#\u0026#39; @description Using the same argument notation as [purrr::map()], this function\r#\u0026#39; iterates over a list of inputs `.x`, applying `.f` to each element. It\r#\u0026#39; returns a tibble with the id, whether the function returned an error\r#\u0026#39; and the output.\r#\u0026#39;\r#\u0026#39; @importFrom magrittr %\u0026gt;%\r#\u0026#39;\r#\u0026#39; @param .x A list or atomic vector\r#\u0026#39; @param .f A function, formula, or atomic vector (see [purrr::map()])\r#\u0026#39; @param ... Other parameters passed on to `.f`\r#\u0026#39; @param .cores Number of cores to use when multiprocessing\r#\u0026#39; @param .progress Whether or not to display progress\r#\u0026#39; @param .flatten If `TRUE`, the errors are filtered from the output,\r#\u0026#39; and the returned object is flattened (a vector, a list, or a tibble)\r#\u0026#39; @param .options Options passed on to [furrr::future_map()]\r#\u0026#39; ([furrr::future_options()] by default)\r#\u0026#39;\r#\u0026#39; @seealso [purrr::map()], [furrr::future_map()], [furrr::future_options()]\r#\u0026#39;\r#\u0026#39; @return A tibble with 3 columns: input, return, and output\r#\u0026#39; @export\rpvec \u0026lt;- function(.x, .f, ..., .cores = get_cores(), .progress = TRUE, .flatten = FALSE, .options = future_options()) {\r.Deprecated(\u0026quot;furrr::future_map\u0026quot;)\r# Preserve execution plan\roplan \u0026lt;- future::plan()\ron.exit(future::plan(oplan), add = TRUE)\r# Set execution plan to multicore\rfuture::plan(future::multicore, workers = .cores)\r# Capture function side-effects\r.f \u0026lt;- purrr::safely(purrr::as_mapper(.f))\r# Run future map\rout \u0026lt;- furrr::future_map(.x, .f, ..., .progress = .progress, .options = .options)\r# Compact with care\rcompact_ \u0026lt;- function(x) {\rif (is.null(x[[1]]) \u0026amp;\u0026amp; is.null(x[[2]])) {\rreturn(list(result = NULL))\r}\relse {\rif (length(x$result) == 0) {\rreturn(list(result = NULL))\r}\rreturn(purrr::compact(x))\r}\r}\r# Process output\rpout \u0026lt;- out %\u0026gt;%\rpurrr::map(compact_) %\u0026gt;%\rpurrr::flatten() %\u0026gt;%\rdplyr::tibble(\rid = purrr::`%||%`(names(.x), seq_along(.x)),\rreturn = names(.), output = .\r)\r# Flatten results if necessary\rif (.flatten) {\rn_error \u0026lt;- length(pout$return[pout$return == \u0026quot;error\u0026quot;])\rif (n_error \u0026gt; 0) {\rwarning(\r\u0026quot;Since \u0026#39;.flatten = TRUE\u0026#39;, a total of \u0026quot;, n_error,\r\u0026quot; errors are being ignored\u0026quot;,\rcall. = FALSE\r)\r}\rpout \u0026lt;- pout %\u0026gt;%\rdplyr::filter(return != \u0026quot;error\u0026quot;) %\u0026gt;%\rdplyr::select(-return) %\u0026gt;%\rtidyr::unnest()\rif (ncol(pout) == 1) {\rpout \u0026lt;- dplyr::pull(pout, output)\r}\r}\rreturn(pout)\r}\r# Get number of available cores\rget_cores \u0026lt;- purrr::partial(future::availableCores, constraints = \u0026quot;multicore\u0026quot;)\r# Import of future_options()\rfuture_options \u0026lt;- furrr::future_options\r\r","permalink":"https://blog.curso-r.com/posts/2019-02-10-pvec/","tags":["algoritmos"],"title":"pvec: O la√ßo perfeito"},{"author":["Julio"],"categories":["tutoriais"],"contents":"\r\rSe voc√™ gosta de fazer mapinhas, talvez j√° tenha visto nosso post para fazer mapas tem√°ticos muito r√°pido. Mas esse post √© t√£o‚Ä¶ 2017!\nVamos ver agora como fazer isso ainda mais r√°pido, usando os excelentes pacotes sf e o brasileir√≠ssimo brazilmaps.\nResposta\rPara quem n√£o tem paci√™ncia de ler o post, a resposta est√° aqui, em 4 linhas de c√≥digo! Carregue o tidyverse e o brazilmaps e rode o c√≥digo abaixo.\nlibrary(tidyverse)\rlibrary(brazilmaps)\rget_brmap(\u0026quot;City\u0026quot;, geo.filter = list(State = 33)) %\u0026gt;% left_join(pop2017, c(\u0026quot;City\u0026quot; = \u0026quot;mun\u0026quot;)) %\u0026gt;% ggplot() +\rgeom_sf(aes(fill = pop2017/1e6))\rNo caso, estamos fazendo um mapa do Rio de Janeiro (Unidade Federativa de c√≥digo 33) e colorindo o mapa dos munic√≠pios com a popula√ß√£o das cidades em 2017 (pop2017, dividida por um milh√£o). A cidade em azul claro √© a capital.\nOK, mas como fizemos isso, e como podemos criar mapas mais bonitos? √â o que veremos a seguir!\n\rObjetivo\rNosso objetivo √© fazer mapas tem√°ticos, que s√£o mapas que levam alguma caracter√≠stica das regi√µes a cores dessas regi√µes. O nome espec√≠fico desse gr√°fico √© mapa coropl√©tico (choropleth map). Vamos fazer dois deles: um de unidades federativas e um de munic√≠pios.\nPara fazer um mapa desse tipo, precisamos de dois insumos principais: i) os dados que v√£o compor as cores de cada regi√£o e ii) os pol√≠gonos para desenhar o mapa.\nGeralmente esses dois insumos v√™m de bases de dados diferentes, ent√£o √© importante que exista uma chave para lig√°-las atrav√©s de um join. Se voc√™ obteve seus dados de uma fonte oficial, provavelmente voc√™ ter√° o c√≥digo do munic√≠pio ou da unidade federativa. Se n√£o, provavelmente voc√™ ter√° de cruzar pelos nomes, o que pode ser uma fonte de dores de cabe√ßa.\nPara reproduzir as an√°lises que seguem, carregue os pacotes tidyverse e brazilmaps:\nlibrary(tidyverse)\rlibrary(brazilmaps)\r\rPol√≠gonos\rA melhor fonte oficial para obter os pol√≠gonos do Brasil √© o Instituto Brasileiro de Geografia e Estat√≠stica (IBGE). L√°, voc√™ vai encontrar malhas territoriais em um formato chamado shapefile. Esse arquivo, que na verdade √© um conjunto de arquivos com dados e metadados, cont√©m as informa√ß√µes necess√°rias para desenhar os pol√≠gonos no seu mapa.\nPor muito tempo, a leitura desse tipo de arquivo no R foi uma dor de cabe√ßa. At√© 2015 pelo menos, eu utilizava o sp e o maptools, e sempre sofria um pouco para carregar a base e fazer mapas.\nAgora, com o pacote sf, isso ficou bem mais f√°cil. Atendendo aos princ√≠pios tidy, o sf armazena mapas em data.frames, onde cada cada linha √© um territ√≥rio, cada coluna representa uma caracter√≠stica desse territ√≥rio, e a lista-coluna geometry cont√©m as informa√ß√µes dos pol√≠gonos que representam esse territ√≥rio.\nComo objetos de classe sf s√£o data.frames, estamos em casa. Todas opera√ß√µes dos amados pacotes dplyr e ggplot2 j√° est√£o preparadas para lidar com esses objetos, logo a tarefa de trabalhar com mapas se resume √† tarefa de transforma√ß√£o e visualiza√ß√£o de dados, do jeito que gostamos.\nE como faz para ler esses dados no R? Com o pacote brazilmaps, basta utilizar a fun√ß√£o get_brmap(). Essa fun√ß√£o recebe par√¢metros do tipo de regi√£o que se deseja baixar, e tamb√©m algum filtro que se deseja aplicar. Por exemplo, se voc√™ quiser carregar a base no n√≠vel Regi√£o, utilize\nlibrary(brazilmaps)\rmapa \u0026lt;- get_brmap(\u0026quot;Region\u0026quot;)\rglimpse(mapa)\rNote que a base de dados cont√©m apenas cinco linhas, uma para cada regi√£o, e a coluna especial geometry. Se voc√™ deseja obter todos os munic√≠pios do estado de S√£o Paulo, utilize\nmapa \u0026lt;- get_brmap(\u0026quot;State\u0026quot;, geo.filter = list(State = 35))\rglimpse(mapa)\rO pacote brazilmaps permite que voc√™ obtenha as malhas em seis n√≠veis diferentes: Brasil, Regi√µes, Estados, Munic√≠pios, Mesorregi√µes e Microrregi√µes.\n\rDados\rPara preencher os dados, vamos utilizar a base pnud_muni do pacote abjData. Esse pacote foi desenvolvido pela Associa√ß√£o Brasileira de Jurimetria (ABJ) para guardar e organizar dados √∫teis para a Jurimetria. O pacote n√£o est√° dispon√≠vel no CRAN, ent√£o para utiliz√°-lo voc√™ precisar√° instalar o pacote do GitHub com\ndevtools::install_github(\u0026quot;abjur/abjData\u0026quot;)\rA base de dados pnud_muni, em particular, cont√©m as informa√ß√µes utilizadas para calcular o √çndice de Desenvolvimento Humano (IDH) a n√≠vel municipal, com base nos dados dos Censos de 1991, 2000 e 2010. √â uma base muito rica e pode ser utilizada para realizar diversas an√°lises interessantes.\nNo caso, utilizaremos apenas as colunas identificadoras de munic√≠pio, unidade federativa, regi√£o e IDH, e apenas o ano de 2010. Faremos isso rodando:\npnud_minima \u0026lt;- abjData::pnud_muni %\u0026gt;% filter(ano == 2010) %\u0026gt;% select(cod_uf = uf, cod_muni = codmun7, starts_with(\u0026quot;idh\u0026quot;))\rglimpse(pnud_minima)\rEssa base de dados cont√©m somente 5565 munic√≠pios, que eram os que existiam na √©poca que os dados foram levantados. Atualmente, temos 5570 munic√≠pios no Brasil.\n\rJuntando as bases\rVamos primeiro calcular o IDH m√©dio por unidade federativa, depois juntar com a base de estados. Rigorosamente falando, n√≥s n√£o dever√≠amos fazer isso, pois a m√©dia dos IDHs municipais de uma unidade federativa n√£o √© o IDH da unidade federativa. Mas vida que segue:\npnud_minima_estado \u0026lt;- pnud_minima %\u0026gt;% group_by(cod_uf) %\u0026gt;% summarise(idh = mean(idhm))\rglimpse(pnud_minima_estado)\rAgora vamos juntar com o mapa de unidades federativas:\nuf_map \u0026lt;- get_brmap(\u0026quot;State\u0026quot;) %\u0026gt;% inner_join(pnud_minima_estado, c(\u0026quot;State\u0026quot; = \u0026quot;cod_uf\u0026quot;))\rglimpse(uf_map)\rParece que funcionou! Agora, temos uma coluna idh. Agora vamos fazer um mapa. Para isso, usaremos uma opera√ß√£o geom√©trica especial do ggplot2: o geom_sf(). Essa fun√ß√£o permite desenhar o mapa diretamente, sem a necessidade de realizar transforma√ß√µes nos dados nem mapear longitude e latitude.\nuf_map %\u0026gt;% ggplot() +\rgeom_sf(aes(fill = idh))\rO gr√°fico mostra claramente o aspecto regional do IDH nos estados do Brasil.\nPara fazer o gr√°fico com os munic√≠pios, a l√≥gica √© a mesma: i) fazer um join das bases com dplyr e ii) usar o ggplot2 para desenhar o mapa. O √∫nico problema √© que o gr√°fico demora para rodar1.\nmuni_map \u0026lt;- get_brmap(\u0026quot;City\u0026quot;) %\u0026gt;% left_join(pnud_minima, c(\u0026quot;City\u0026quot; = \u0026quot;cod_muni\u0026quot;))\rmuni_map %\u0026gt;% ggplot() +\rgeom_sf(aes(fill = idhm))\rPodemos tamb√©m quebrar pelas regi√µes com um simples facet_wrap():\nmuni_map %\u0026gt;% ggplot() +\rgeom_sf(aes(fill = idhm)) +\rfacet_wrap(~Region)\rParece que estamos indo bem. Alguns problemas que podemos notar:\nAs linhas est√£o muito largas.\rAs cores ajudam a identificar tend√™ncias regionais, mas parece que a imagem est√° emba√ßada.\rOs mapas n√£o est√£o centralizados em cada facet. E n√£o adianta usar o par√¢metro scales=\"free\", pois infelizmente o sistema de coordenadas do sf n√£o suporta essa funcionalidade.\r\rResolveremos esses problemas na pr√≥xima se√ß√£o.\n\rMasterizando os mapas\rTweaks e temas\rO ggplot2 √© um sistema extremamente flex√≠vel e permite que voc√™ altere praticamente qualquer elemento do gr√°fico. No caso de mapas, eu gosto de trabalhar com tr√™s coisas espec√≠ficas: i) deixar as linhas na cor preta e um pouco mais finas e ii) tirar o fundo cinza do mapa e iii) mudar as cores das regi√µes. Um exemplo de como fazer isso:\nmuni_map %\u0026gt;% ggplot() +\rgeom_sf(aes(fill = idhm), # ajusta tamanho das linhas\rcolour = \u0026quot;black\u0026quot;, size = 0.1) +\r# muda escala de cores\rscale_fill_viridis_c(option = 2) +\r# tira sistema cartesiano\rtheme(panel.grid = element_line(colour = \u0026quot;transparent\u0026quot;),\rpanel.background = element_blank(),\raxis.text = element_blank(),\raxis.ticks = element_blank())\rOutra coisa legal de fazer √© demarcar os estados com outra largura da linha. Podemos fazer isso adicionando mais um geom_sf():\nmuni_map %\u0026gt;% ggplot() +\rgeom_sf(aes(fill = idhm), # ajusta tamanho das linhas\rcolour = \u0026quot;black\u0026quot;, size = 0.1) +\rgeom_sf(data = get_brmap(\u0026quot;State\u0026quot;),\rfill = \u0026quot;transparent\u0026quot;,\rcolour = \u0026quot;black\u0026quot;, size = 0.5) +\r# muda escala de cores\rscale_fill_viridis_c(option = 2) +\r# tira sistema cartesiano\rtheme(panel.grid = element_line(colour = \u0026quot;transparent\u0026quot;),\rpanel.background = element_blank(),\raxis.text = element_blank(),\raxis.ticks = element_blank())\rNo caso, usei a paleta de cores viridis. Eu gosto muito dessa paleta e uso sempre que poss√≠vel :)\n\rCategorizar ou n√£o, eis a quest√£o\rNo contexto de mapas, geralmente nosso interesse est√° em mapear informa√ß√µes ordinais ou num√©ricas. Quando a informa√ß√£o √© num√©rica, o mapa coropl√©tico pode ficar um pouco dif√≠cil de interpretar para o c√©rebro, pois temos de fazer uma conta com as cores para entender a diferen√ßa entre duas regi√µes. Al√©m disso, a legenda acaba n√£o ajudando muito, pois √© dificil de associar uma cor da legenda com a cor do gr√°fico.\nPor isso, quando a informa√ß√£o √© num√©rica, uma boa pr√°tica √© categorizar a vari√°vel que queremos observar em um conjunto pequeno de categorias (entre 3 e 7), para facilitar a visualiza√ß√£o. Isso induz um erro na an√°lise, mas facilita a interpreta√ß√£o de quem est√° vendo o gr√°fico.\nPodemos categorizar nosso mapa usando a fun√ß√£o cut():\nmuni_map %\u0026gt;% mutate(idhm = cut(idhm, c(0, 0.5, 0.6, 0.75, 1.0))) %\u0026gt;% ggplot() +\rgeom_sf(aes(fill = idhm), # ajusta tamanho das linhas\rcolour = \u0026quot;black\u0026quot;, size = 0.1) +\rgeom_sf(data = get_brmap(\u0026quot;State\u0026quot;),\rfill = \u0026quot;transparent\u0026quot;,\rcolour = \u0026quot;black\u0026quot;, size = 0.5) +\r# muda escala de cores\rscale_fill_viridis_d(option = 2, begin = 0.2, end = 0.8) +\r# tira sistema cartesiano\rtheme(panel.grid = element_line(colour = \u0026quot;transparent\u0026quot;),\rpanel.background = element_blank(),\raxis.text = element_blank(),\raxis.ticks = element_blank())\rN√£o sei voc√™s, mas para mim faz muito mais sentido olhar o gr√°fico categorizado do que o cont√≠nuo.\n\rFazendo facets de mapas\rPara fazer v√°rios mapas menores e juntar em um s√≥, podemos usar o fant√°stico pacote patchwork. Esse pacote permite somar v√°rios mapas, como m√°gica. Primeiro, vamos montar uma fun√ß√£o que gera o mapa para uma determinada regi√£o.\ngrafico_regiao \u0026lt;- function(regiao) {\r# titulo do mapa\rtitulo \u0026lt;- switch(regiao, \u0026quot;1\u0026quot; = \u0026quot;Norte\u0026quot;, \u0026quot;2\u0026quot; = \u0026quot;Nordeste\u0026quot;,\r\u0026quot;3\u0026quot; = \u0026quot;Sudeste\u0026quot;, \u0026quot;4\u0026quot; = \u0026quot;Sul\u0026quot;, \u0026quot;5\u0026quot; = \u0026quot;Centro-Oeste\u0026quot;)\rmuni_map %\u0026gt;% filter(Region == regiao) %\u0026gt;% mutate(idhm = cut(idhm, c(0, 0.5, 0.6, 0.75, 1.0))) %\u0026gt;% ggplot() +\rgeom_sf(aes(fill = idhm), # ajusta tamanho das linhas\rcolour = \u0026quot;black\u0026quot;, size = 0.1) +\rgeom_sf(data = filter(get_brmap(\u0026quot;State\u0026quot;), Region == regiao),\rfill = \u0026quot;transparent\u0026quot;,\rcolour = \u0026quot;black\u0026quot;, size = 0.5) +\r# muda escala de cores\rscale_fill_viridis_d(option = 2, begin = 0.2, end = 0.8) +\rguides(fill = FALSE) +\r# tira sistema cartesiano\rtheme(panel.grid = element_line(colour = \u0026quot;transparent\u0026quot;),\rpanel.background = element_blank(),\raxis.text = element_blank(),\raxis.ticks = element_blank()) +\rggtitle(titulo)\r}\rmapas \u0026lt;- map(1:5, grafico_regiao)\rAgora, vamos somar esses mapas:\nlibrary(patchwork)\rreduce(mapas, magrittr::add)\rPronto! Temos nossos mapas lindos maravilhosos no tidy way!\n\r\rWrap-up\rUse brazilmaps para carregar os mapas.\rFa√ßa join com a sua base de interesse.\rUse geom_sf() do ggplot2 para plotar os mapas.\rCustomize seus mapas com as op√ß√µes do ggplot2 e com o pacote patchwork!\r\rSe quiserem ver uma aplica√ß√£o legal disso, d√™em uma olhada nessa an√°lise da Bruna Wundervald elaborado durante a Datathon do RLadies-SP.\n√â isso pessoal. Happy coding ;)\n\r\rN√£o por muito tempo! Veja aqui\rjust more than tripled the speed of geom_sf‚Ä¶ in case anyone is interested in spatial plotting‚Ä¶\r‚Äî Thomas Lin Pedersen (@thomasp85) February 4, 2019\r\r\r‚Ü©Ô∏é\r\r\r","permalink":"https://blog.curso-r.com/posts/2019-02-10-sf-miojo/","tags":["mapas"],"title":"Gr√°ficos Miojo: mapas tem√°ticos, the tidy way"},{"author":["Daniel"],"categories":["tutoriais"],"contents":"\r\rEsse post serve como introdu√ß√£o aos modelos de suaviza√ß√£o exponencial e replica\rum exemplo dispon√≠vel no livro Forecasting principles and practice (FPP)\rdispon√≠vel aqui. Em seguida implementamos usando o\rpacote rstan uma abordagem bayesiana\rpara o mesmo problema usando como refer√™ncia o paper Fitting and Extending Exponential Smoothing Models with Stan.\nVamos portanto come√ßar descrevendo o modelo de suaviza√ß√£o exponencial simples.\rFazer um exemplo inicial usando o conhecido pacote forecast e partir para a implementa√ß√£o\rcom rstan.\nSuaviza√ß√£o exponencial simples\rSuaviza√ß√£o exponencial √© uma das principais classes de modelos usados em previs√£o\rde s√©ries temporais. Essa classe inclui diversos tipos de modelos como o bem conhecido\rHolt Winters e at√© o Theta Method\r- conhecido por ter ido bem em uma M3-competition.\nA suaviza√ß√£o exponencial simples, com o pr√≥prio nome diz, √© o caso particular mais\rsimples de suaviza√ß√£o exponencial. Esse tipo de modelo serve para quando n√£o existe\rnenhum padr√£o claro de sazonalidade ou tend√™ncia na s√©rie.\nNesta parte introdut√≥ria vou parafrasear o pr√≥prio Hyndman no FPP.\nConsidere que \\(y_t\\) seja a observa√ß√£o no tempo t de uma s√©rie temporal. O modelo mais simples\rposs√≠vel e que tamb√©m √© chamado de ing√™nuo (naive) seria:\n\\[y_{T+1|T} = y_{T}\\]\rIsto √©, a previs√£o para \\(T+1\\) dado que conhecemos o valor da s√©rie at√© o instante \\(T\\) seria\rsimplesmente o √∫ltimo valor observado da s√©rie \\(y_T\\). Neste modelo, a √∫ltima observa√ß√£o\rda s√©rie √© √∫nica importante para prever o seu pr√≥ximo valor.\nAgora considere um modelo chamado Average method em que consideraremos que a previs√£o\rpara a pr√≥xima observa√ß√£o da s√©rie √© a m√©dia aritm√©tica de todos os valores anteriores\rda s√©rie. Em nota√ß√£o matem√°tica:\n\\[y_{T+1|T} = \\frac{1}{T}\\sum_{t=1}^{T}y_t\\]\nNeste modelo, todas as observa√ß√µes anteriores da s√©rie possuem o mesmo peso (\\(1/T\\)) na previs√£o\rdo pr√≥ximo valor da s√©rie.\nEm geral queremos um meio termo. N√£o queremos que todas as observa√ß√µes tenham o mesmo\rpeso, nem que s√≥ a √∫ltima tenha o maior peso. Poder√≠amos escrever um modelo assim:\n\\[y_{T+1|T} = \\sum_{t=1}^{T}\\beta_t*y_t\\]\rCom \\(\\sum_{t=1}^{T}\\beta_t = 1\\). Neste modelo cada observa√ß√£o do passado teria um\rpesinho \\(\\beta_t\\) que poder√≠amos estimar por meio de algum algoritmo. A previs√£o\rpara o pr√≥ximo per√≠odo da s√©rie seria uma m√©dia ponderada das observa√ß√µes passadas.\nNo entanto, isso n√£o √© vi√°vel pois ter√≠amos tantos par√¢metros quanto observa√ß√µes.\nPara simplificar esse problema, a suaviza√ß√£o exponencial faz a suposi√ß√£o de que o\rpeso das observa√ß√µes passadas vai diminuindo conforme elas est√£o mais distantes do\rponto que estamos tentando prever. Mais especificamente esses pesos decaem exponencialmente\rcom o passar do tempo. Portanto, o modelo √© reescrito para:\n\\[y_{T+1|T} = \\alpha y_t + \\alpha(1 - \\alpha)y_{t-1} + \\alpha(1 - \\alpha)^2y_{t-2} + ...\\]\nEm que \\(0 \\le \\alpha \\le 1\\) √© o par√¢metro de suaviza√ß√£o. Neste modelo a previs√£o\rpara o pr√≥ximo per√≠odo da s√©rie √© uma m√©dia ponderada das observa√ß√µes passadas em\rque os pesos decrescem exponencialmente com uma taxa \\(\\alpha\\).\nQuando \\(\\alpha \\approx 0\\) ent√£o as observa√ß√µes mais distantes damos mais peso para\ras observa√ß√µes mais distantes. Quando \\(\\alpha = 1\\) ficamos exatamente com o modelo\ring√™nuo.\nA forma de componentes\rEm suaviza√ß√£o exponencial √© comum escrever os modelos em forma de componentes.\rIsso facilita extens√µes como adicionar tend√™ncias e sazonalidades. Para fazer\rsuaviza√ß√£o exponencial simples s√≥ precisamos do componente \\(l_t\\) (de level).\rEm outros m√©todos tamb√©m usam-se os componentes \\(b_t\\) (tend√™ncia) e \\(s_t\\) (sazonalidade).\nNa forma de componente escrevemos o modelo da seguinte forma:\n\rEqua√ß√£o de previs√£o: \\(\\hat{y_{t+1|t}} = l_t\\).\rEqua√ß√£o de suaviza√ß√£o: \\(l_t = \\alpha y_t + (1 - \\alpha )l_{t-1}\\)\r\rNote que essa forma √© equivalente ao que escrevemos anteriormente - basta substituir\r\\(l_t\\) por \\(\\hat{y_{t+1|t}}\\) e \\(l_{t-1}\\) por \\(\\hat{y_{t|t-1}}\\) na equa√ß√£o de suaviza√ß√£o.\nEscrevendo o modelo desta forma fica f√°cil de ver que precisamos escolher dois par√¢metros:\r\\(\\alpha\\) e \\(l_0\\). Com os dois conseguimos prever qualquer valor da s√©rie.\nAntigamente (antes de computadores existirem) era comum definir \\(l_0\\) como o primeiro\rvalor observado da s√©rie e \\(\\alpha\\) uma valor pequeno, por exemplo \\(0,2\\).\nHoje em dia temos jeitos melhores de encontrar bons valores para \\(\\alpha\\) e \\(l_0\\).\nPodemos minimizar a soma dos quadrados dos res√≠duos:\n\\[SSE = \\sum_{t=1}^{T}(y_t - \\hat{y}_{t|t-1})^2\\]\nOu assumir que \\(y_t \\sim Normal(l_t, \\sigma^2)\\) e estimar via m√°xima verossimilhan√ßa.\r√â isso que a fun√ß√£o ses do pacote forecast faz. As contas da verossimilhan√ßa s√£o\rchatinhas, mas d√° para provar que para suaviza√ß√£o exponencial simples as duas abordagens\rs√£o equivalentes.\nComo n√£o √© poss√≠vel resolver alg√©bricamente o problema de minimiza√ß√£o, precisamos de\rum algoritmo num√©rico. A fun√ß√£o ses tamb√©m possui algumas heur√≠sticas para decidir\ros valores iniciais dos par√¢metros.\nTudo isso est√° escrito no livro Forecasting with Exponential Smoothing\rtamb√©m do Hyndman et al.\n\r\rExemplo\rNo exemplo, vamos usar esse banco de dados oil que vem no pacote fpp (do livro FPP).\rEsse banco de dados cont√©m a produ√ß√£o anual de petr√≥leo na Ar√°bia Saudita.\nPara o exemplo pegamos dados desde 1996 at√© 2010.\nlibrary(forecast)\r## Registered S3 method overwritten by \u0026#39;quantmod\u0026#39;:\r## method from\r## as.zoo.data.frame zoo\rlibrary(fpp)\r## Loading required package: fma\r## Loading required package: expsmooth\r## Loading required package: lmtest\r## Loading required package: zoo\r## ## Attaching package: \u0026#39;zoo\u0026#39;\r## The following objects are masked from \u0026#39;package:base\u0026#39;:\r## ## as.Date, as.Date.numeric\r## Loading required package: tseries\rdata(oil)\roildata \u0026lt;- window(oil, start=1996)\rplot(oildata)\rPara ajustar um modelo de suaviza√ß√£o exponencial simples com o forecast podemos usar a fun√ß√£o\rses, mas ela j√° retorna os valores preditos para os pr√≥ximos anos e n√£o nos d√° a oportunidade\rde ver os valores de \\(\\alpha\\) e \\(l_0\\) que ela escolheu.\nses(oildata)\r## Point Forecast Lo 80 Hi 80 Lo 95 Hi 95\r## 2011 469.2669 433.4186 505.1153 414.4416 524.0923\r## 2012 469.2669 423.6608 514.8730 399.5184 539.0155\r## 2013 469.2669 415.6505 522.8834 387.2676 551.2663\r## 2014 469.2669 408.6902 529.8437 376.6228 561.9110\r## 2015 469.2669 402.4512 536.0827 367.0810 571.4529\r## 2016 469.2669 396.7469 541.7870 358.3571 580.1768\r## 2017 469.2669 391.4597 547.0742 350.2710 588.2629\r## 2018 469.2669 386.5096 552.0243 342.7005 595.8334\r## 2019 469.2669 381.8393 556.6946 335.5579 602.9760\r## 2020 469.2669 377.4061 561.1277 328.7780 609.7559\rNa nomenclatura do Hyndman para os modelos da classe de suaviza√ß√£o exponencial,\ra suaviza√ß√£o exponencial simples √© chamada de ANN. N√£o vou entrar em detalhes mas,\risto est√° descrito aqui.\nUsamos ent√£o a fun√ß√£o ets com o argumento model = \"ANN\".\nmodelo \u0026lt;- ets(oildata, \u0026quot;ANN\u0026quot;)\rmodelo\r## ETS(A,N,N) ## ## Call:\r## ets(y = oildata, model = \u0026quot;ANN\u0026quot;) ## ## Smoothing parameters:\r## alpha = 0.7869 ## ## Initial states:\r## l = 448.1262 ## ## sigma: 27.9726\r## ## AIC AICc BIC ## 144.4110 146.5929 146.5352\rAgora sim, podemos ver os valores estimados para \\(\\alpha\\) e \\(l_0\\).\nplot(forecast(modelo, h=5))\rAt√© aqui vimos como funciona o m√©todo de suaviza√ß√£o exponencial simples, como o pacote\rforecast estima os seus par√¢metros (m√©todo de m√°xima verossimilhan√ßa) e como fazer\rpara ajustar esse modelo com o forecast, bem como obter os valores estimados para\ros par√¢mteros.\nAgora vamos tentar obter estimativas para os par√¢metros \\(\\alpha\\) e \\(l_0\\) usando uma\rabordagem bayesiana.\n\rA abordagem bayesiana\rA partir do momento que sabemos escrever o modelo e sabemos todos os par√¢metros que\rprecisamos estimar fica f√°cil fazer com Stan.\nPara quem n√£o conhece, Stan √© uma plataforma para ajustar modelos probabil√≠sticos e possui\ruma linguagem probabil√≠stica pr√≥pria. Quando voc√™ escreve os modelos nessa linguagem,\ro Stan consegue compilar o seu modelo e criar um programa em C++ muito r√°pido para\rajustar o seu modelo.\nAbaixo definimos o modelo de suaviza√ß√£o exponencial simples usando a linguagem probabil√≠stica\rdo Stan. Esse c√≥digo √© uma leve adapta√ß√£o do c√≥digo que est√° neste paper do Slawek Smyl (esse cara √© muito bom, trabalha na Uber e ganhou recentemente competi√ß√µes de forecast).\nVeja que na linguagem definimos quais s√£o os dados de entrada:\n\rn - o tamanho da s√©rie\ry - um vetor de tamanho n com valores positivos.\rmean_y - a m√©dia dos valores de y\rvar_y - a vari√¢ncia dos valores de y\r\rEm seguida define quais s√£o os par√¢metros:\n\rsigma - vari√¢ncia do erro\ralpha - par√¢metro da suaviza√ß√£o exponencial\rl_0 - valor inicial do componente n√≠vel.\r\rEm seguida define os par√¢mteros transformados - aqueles que podem ser obtidos\ra partir dos valores definidos em parameters.\nPor fim, definimos o modelo.\n\rPrimeiro dizemos que a priori do sigma √© a cauda positiva de uma cauchy.\rDepois que a priori para \\(l_0\\) √© uma Normal com a mesma m√©dia e desvio padr√£o do que a pr√≥pria s√©rie.\rFalamos que \\(y_t\\) tem distribui√ß√£o normal com m√©dia \\(l_{t-1}\\) e desvio padr√£o \\(sigma\\).\rN√£o especificar uma priori para \\(\\alpha\\) indica que estamos assumindo uma priori uniforme no intervalo.\r\rdata {\rint\u0026lt;lower=1\u0026gt; n;\rvector\u0026lt;lower=0\u0026gt;[n] y;\rreal\u0026lt;lower=0\u0026gt; mean_y;\rreal\u0026lt;lower=0\u0026gt; sd_y;\r}\rparameters {\rreal\u0026lt;lower=0\u0026gt; sigma;\rreal \u0026lt;lower=0,upper=1\u0026gt;alpha;\rreal l_0;\r}\rtransformed parameters {\rvector\u0026lt;lower=0\u0026gt;[n] l;\rl[1] = l_0;\rfor (t in 2:n) {\rl[t] = alpha*y[t] + (1-alpha)*(l[t-1]) ;\r}\r}\rmodel {\rsigma ~ cauchy(0,2) T[0,]; // positive side of Cauchy distribution as prior\rl_0 ~ normal(mean_y, sd_y);\rfor (t in 2:n) {\ry[t] ~ normal(l[t-1], sigma);\r}\r}\rAgora ajustamos o modelo e obtemos as estimativas dos par√¢metros.\nlibrary(rstan)\rdata \u0026lt;- list(\rn = length(oildata),\ry = as.numeric(oildata),\rmean_y = mean(oildata),\rsd_y = sd(oildata)\r)\rmodel \u0026lt;- sampling(ann, data = data)\rprint(model, pars = c(\u0026quot;sigma\u0026quot;, \u0026quot;l_0\u0026quot;, \u0026quot;alpha\u0026quot;))\r## Inference for Stan model: 7201dbd28b82b04c1f1a89c8607dc886.\r## 4 chains, each with iter=2000; warmup=1000; thin=1; ## post-warmup draws per chain=1000, total post-warmup draws=4000.\r## ## mean se_mean sd 2.5% 25% 50% 75% 97.5% n_eff Rhat\r## sigma 28.72 0.10 5.87 19.78 24.70 27.79 31.85 42.15 3184 1\r## l_0 460.02 0.36 20.76 419.79 446.52 459.43 473.98 501.41 3260 1\r## alpha 0.71 0.00 0.19 0.25 0.59 0.74 0.86 0.98 3852 1\r## ## Samples were drawn using NUTS(diag_e) at Mon Jan 25 20:11:49 2021.\r## For each parameter, n_eff is a crude measure of effective sample size,\r## and Rhat is the potential scale reduction factor on split chains (at ## convergence, Rhat=1).\rPelo menos o Stan j√° nos d√° a previs√£o para 2011 por meio do par√¢metro l_15:\nprint(model, par = \u0026quot;l[15]\u0026quot;)\r## Inference for Stan model: 7201dbd28b82b04c1f1a89c8607dc886.\r## 4 chains, each with iter=2000; warmup=1000; thin=1; ## post-warmup draws per chain=1000, total post-warmup draws=4000.\r## ## mean se_mean sd 2.5% 25% 50% 75% 97.5% n_eff Rhat\r## l[15] 471.88 0.07 4.46 467.73 468.31 470.13 474.18 483.14 4029 1\r## ## Samples were drawn using NUTS(diag_e) at Mon Jan 25 20:11:49 2021.\r## For each parameter, n_eff is a crude measure of effective sample size,\r## and Rhat is the potential scale reduction factor on split chains (at ## convergence, Rhat=1).\rSabemos que √© o l[15] pois sabemos que \\(y_{T+1|T} = l_t\\) e \\(T=15\\) na nossa s√©rie.\nBom, como era de se esperar, as estimativas dos par√¢metros ficaram parecidas com\ras do pacote forecast. Ent√£o por que usar Stan? No forecast ele j√° me d√° a previs√£o\rcom intervalo de confian√ßa - aqui vou ter que escrever tudo do zero.\nA vatangem √© flexibilidade. O paper do Slawek comenta bastante sobre isso:\n\rFirst, the variations among consecutive time series\rpoints are sometimes too large to be fully captured by\ra light-tailed distribution like the Normal Distribution.\rSecond, the time series sometimes have growth rates\rfaster than linear but slower than exponential. Third,\rthe randomness of the time series often grows with\rvalues. Fourth, from the business side, expert\rsubjective information should be integrated into\rforecasting. Last but not least, from the\rimplementation side, forecasts should be generated in\ra scalable and automated fashion when hundreds or\reven thousands curves to be forecasted every day. The\rforecasting methodology should require a minimum\ramount of data scientists‚Äô attention when in\rproduction mode.\n\rEscrevendo o modelo probabil√≠stico com Stan, podemos lidar com cada um desses pontos\rpara definir um modelo mais adequado.\n\rConclus√£o\rAprendemos:\n\rO que s√£o e como funcionam os modelos de suaviza√ß√£o exponencial simples.\rComo ajust√°-los com o pacote forecast e como o forecast ajusta esses modelos.\rComo ajustar SES no Stan.\r\r\r","permalink":"https://blog.curso-r.com/posts/2019-02-10-ses/","tags":["estat√≠stica"],"title":"Suaviza√ß√£o exponencial simples com R"},{"author":["Bruna Wundervald"],"categories":["divulga√ß√£o"],"contents":"\r\rNa semana passada, eu participei da minha primeira\rrstudio::conf,\rem Austin, no Texas. Essa confer√™ncia\r√©, como o nome pode sugerir, organizada pelo pessoal do\rRStudio, e tem como objetivo reunir\rworkshops e apresenta√ß√µes sobre tudo de R \u0026amp; RStudio\r(‚ÄúAll things R and RStudio‚Äù). Eu fui para a confer√™ncia com uma das\rbolsas de diversidade das 6 oferecidas para pessoas de fora dos Estados\rUnidos. O oferecimento das bolsa j√° √© uma tradi√ß√£o, visto\rque o RStudio √© umas das empresas que mais apoia e promove a diversidade\rna nossa comunidade.\nPrimeiramente, eu preciso dizer que aproveitei bastante.\nTudo foi excepcional: os workshops, as apresenta√ß√µes, as pessoas\rextremamente receptivas, a sess√£o de e-posters, os grupos\rtem√°ticos de conversa,\ra localiza√ß√£o. Algo muito importante √© que, em todos os momentos, √©\rmuito claro o quanto qualquer tipo de julgamento ou ass√©dio n√£o √© bem\rvindo ali. Os participantes s√£o respeitados e acolhidos uns pelos\routros, independente de qualquer caracter√≠stica externa, como\rra√ßa ou g√™nero. Pode parecer √≥bvio que em todas as confer√™ncias\re congressos essa deva ser uma constante, mas isso n√£o √© o que\racontece na realidade. Neste post, eu vou falar brevemente sobre\rminha experi√™ncia na confer√™ncia deste ano.\nWorkshop\rEu participei do workshop de\raprendizado de m√°quina na pr√°tica,\rministrado majoritariamente pelo Max Kuhn. Em resumo, o workshop consistiu em\rapresentar as principais etapas de um projeto envolvendo\raprendizado de m√°quina (principios basicos - engenharia de\rcovariaveis - modelagem (regress√£o/classifica√ß√£o)), mas seguindo o\rframework do tidymodels,\ro descendente (e complementar) do caret\rque tem como objetivo ser uma interface uniforme de modelagem usando R.\nA raz√£o pela qual se justifica a exist√™ncia do tidymodels √© que\rexiste uma grande vari√¢ncia na forma de usar os diferentes pacotes\rde modelagem. A vers√£o tidy, por sua vez, faz o reuso das estruturas de dados,\rtornando mais f√°cil o encadeamento de fun√ß√µes atrav√©s do\rpipe e √© compat√≠vel com programa√ß√£o funcional (purrr). A sequ√™ncia\rdo workshop foi:\n\rPrinc√≠pios b√°sicos: manipula√ß√£o de dados com dplyr,\rvisualiza√ß√£o com ggplot2, um pouco de purrr e quasiquotation\re modelagem com parsnip.\n\rEngenharia de covari√°veis e pr√©-processamento com recipes\rrsample,parsnip\n\rModelagem, para regress√£o e classifica√ß√£o, usando o recipes, caret,\rbroom e tidyposterior.\n\r\rE com isso, o framework foi apresentado do come√ßo ao fim com aplia√ß√£o\rem alguns estudos de caso. Os materiais\rdo workshop, claro, est√£o dispon√≠veis aqui: https://github.com/topepo/rstudio-conf-2019\n\rApresenta√ß√µes\r√â realmente meio dif√≠cil escolher quais palestras assistir durante\ra rstudio::conf, geralmente s√£o 3 ocorrendo ao mesmo tempo e todas\rs√£o interessantes. Eu preferi escolher que mais se aproximaram dos meis\rinteresses pessoais ou que pareciam algo complicado de entender\rpor conta pr√≥pria. Aqui eu vou dar s√≥ um overview sobre\ras minhas 3 apresenta√ß√µes favoritas, mas os slides\re v√≠deos de todas elas podem ser encontrados\raqui e\raqui:\n\r\"The unreasonable effectiveness of public work‚Äô, David Robinson:\ra palestra foi basicamente sobre a efetividade do compartilhamento\rde conhecimento online. David mostrou como ele mesmo foi convidado\ra trabalhar no StackOverFlow ap√≥s\rter dado uma resposta muito boa √† uma das perguntas de l√°. A partir\rdisso, ele desenvolve e exemplifica porque √© t√£o importante\ra exist√™ncia de trabalhos p√∫blicos (e reprodut√≠veis!), seja\rno Twitter, blogs, GitHub, etc. A dica fundamental\rdo David √©: se voc√™ j√° precisou repetir uma mesma coisa v√°rias vezes,\rtorne-a ‚Äúautom√°tica‚Äù, o que nesse contexto significa\n\rse voc√™ j√° precisou escrever a mesma fun√ß√£o diversas\rvezes, fa√ßa um pacote;\rse voc√™ j√° precisou dar o mesmo conselho diversas\rvezes, escreva um post num blog.\r\r\rFenomenal. Essa palestra vale muito a pena e eu com certeza vou\rusar ela como refer√™ncia futura.\n\r‚ÄúA guide to modern reproducible data science with R‚Äù, Karthik Ram:\rOk, eu sei, mais uma palestra sobre ci√™ncia reproduz√≠vel, eu\rrealmente quero enfatizar a import√¢ncia dela aqui. Essa palestra\rcomplementa a do David, mas nesse caso,\rKarthik n√≥s mostra quais s√£o as ferramentas atuais\rpara ci√™ncia reproduz√≠vel usando R e fornece os links\rpara todas elas depois. Ou seja, agora n√£o h√° mais desculpas:\rtemos a motiva√ß√£o e as ferramentas para compartilhar nossos\rtrabalhos e fortalecer a comunidade cada vez mais :)\n\r‚ÄúTidy eval in context‚Äù, Jenny Brian:\rnon-standard evaluation √© algo que eu estou achando extremamente\r√∫til ultimamente. A maioria dos meus c√≥digos mais\rrecentes usam em algum momento, mas at√©\rantes dessa palestra, eu n√£o poderia dizer que entendia\r100% o que √© non-standard evaluation. Jenny apresentou\rcasos sobre por que, quando e como usar NSE de forma correta, o que\rclarificou bastante a ideia pra mim.\n\r\r\rBonus: tidyverse developer day\rA rstudio::conf tem um evento sat√©lite chamado\rtidyverse developer day, que acontece no dia posterior ao do encerramento do evento.\rNesse dia, os participantes se reunem para trabalhar em\ralgo relacionado ao tidyverse ou algum outro projeto de\rinteresse (cada um escolhe o seu). Pode ser resolver uma issue\rno GitHub, escrever um post ou um livro, criar novos projetos\rcom as pessoas que est√£o ali, trabalhar em seus pr√≥prios pacotes,\rqualquer coisa. O que isso tem de especial √©: voc√™ tem a\roportunidade de estar trabalhando em conjunto com todos os\rmembros do RStudio e outros desenvolvedores importantes.\rEles tiram d√∫vidas, d√£o dicas/sugest√µes, ideias novas.\rEu foquei em resolver issues do broom e\rpude conversar com os pr√≥prios autores do pacote,\respecialmente o Alex Hayes,\rsobre o funcionamento do mesmo\re como ele pode ser aprimorado. Essa √© uma forma bem\refetiva de estimular a participa√ß√£o e criatividade\rde todos e demonstrar que n√≥s podemos contar uns com os outros.\n\rA pergunta que n√£o quer calar: vale a pena?\rResposta: sim. Essa foi a confer√™ncia mais cara que eu j√° participei\r(tudo bem, eu tive bolsa, mas quero falar do custo em geral)\rconsiderando evento + hotel + passagens + visto + outros gastos.\rCom certeza n√£o √© um valor que todos os acad√™micos podem\rpagar, mas o RStudio est√° trabalhando neste problema. Por√©m,\rapesar do pre√ßo eu considero que vale a pena principalmente\rpela parte do networking e de ser uma experi√™ncia de confer√™ncia\rtotalmente diferente das outras. A maioria das pessoas que n√≥s\rconhecemos, seja porque √© autor de um bom pacote ou pelos contatos\rvia Twitter, est√£o l√°. Isso j√° configura uma √≥tima oportunidade\rde estender a rede profissional e acad√™mica e o participantes s√£o\rexcepcionalmente receptivos. As palestras s√£o absolutamente\rexcelentes. Tirando a parte dos minicursos, essa\rn√£o √© uma confer√™ncia para se aprender a programar em R,\re sim aprender sobre tudo que √© relacionado mas vai al√©m disso.\rEu tive a impress√£o de que as palestras s√£o muito cuidadosamente\rselecionadas e apresentadas de forma excepcional, tornando\rexperi√™ncia de estar ali assistindo realmente √∫nica.\rAno que vem estarei l√° novamente na rstudio::conf 2020, que vai\rser em S√£o Francisco :)\n\rPS\rO Hadley gostou de cacha√ßa e voltei com muitos stickers:\n@bwundervald thanks for the cacha√ßa ‚Äî it‚Äôs delicious!\n\u0026mdash; Hadley Wickham (@hadleywickham) January 22, 2019  stiiiickers üë©‚Äçüíªüéâ #rstats pic.twitter.com/J7N4NZXbmE\n\u0026mdash; Bruna Wundervald (@bwundervald) January 16, 2019  \r","permalink":"https://blog.curso-r.com/posts/2019-01-30-rconf/","tags":["rstudio"],"title":"Resumo da rstudio::conf 2019"},{"author":["Julio"],"categories":["tutoriais"],"contents":"\r\rNesse post vamos discutir um pouco sobre regress√£o log√≠stica, tensorflow e Modelos Lineares Generalizados (Generalized Linear Models, GLMs). N√£o vou economizar nas matem√°ticas nem nos c√≥digos.\n\rSe voc√™ n√£o conhece GLMs, recomendo dar uma lida, pelo menos na introdu√ß√£o, do livro do professor Gilberto A. Paula.\rSe voc√™ n√£o conhece o Tensorflow, recomendo ver a p√°gina do RStudio sobre Tensorflow.\rSe voc√™ curte a parte computacional da estat√≠stica, esse livro do LEG-UFPR √© obrigat√≥rio. Eles s√£o os melhores.\r\rIntrodu√ß√£o: o tensorglm\rUm de meus interesses no momento √© implementar GLMs usando Tensorflow. O Tensorflow √© uma biblioteca computacional mantida pela Google que utiliza paraleliza√ß√£o e o poder das GPUs (Graphical Processing Units) para fazer contas. O Tensorflow foi especialmente desenhado para facilitar o ajuste de redes neurais profundas e outros modelos sofisticados.\nGLMs s√£o casos particulares de redes neurais. Uma rede neural com apenas uma camada e com fun√ß√µes de perda / verossimilhan√ßas baseadas na Diverg√™ncia de Kullback-Leibler s√£o exatamente iguais aos GLMs. Por exemplo, essa diverg√™ncia equivale ao erro quadr√°tico m√©dio para a distribui√ß√£o gaussiana e binary-crossentropy para log√≠stica.\nPor isso, n√£o √© de se surpreender que j√° existam solu√ß√µes prontas para modelos espec√≠ficos, como regress√£o linear normal, log√≠stica, e at√© Poisson. No entanto, essas solu√ß√µes t√™m duas limita√ß√µes:\nN√£o s√£o extensivas. Por exemplo, n√£o achei c√≥digos para as distribui√ß√µes normal inversa, gama e binomial negativa.\n\rAs solu√ß√µes atuais utilizam o algoritmo descida de gradiente para otimiza√ß√£o, que √© muito legal, mas n√£o se aproveita de alguns resultados que temos na √°rea de GLMs, como o IWLS (Iterated Weighted Least Squares), que √© uma deriva√ß√£o do algoritmo Fisher-scoring, que reduz o problema do ajuste ao c√°lculo iterado de inversas e multiplica√ß√µes de matrizes.\n\r\rMeu intuito √©, ent√£o, montar uma solu√ß√£o alternativa que funcione igual √† fun√ß√£o glm() do R, mas usando Tensorflow no backend ao inv√©s do algoritmo atual, que √© em Fortran. Com isso, espero que o ajuste seja mais eficiente quando os dados s√£o grandes e permita trabalhar com dados que n√£o cabem na mem√≥ria.\n\rA regress√£o log√≠stica\rMeu primeiro experimento com o tensorglm foi implementar a regress√£o log√≠stica usando tensorflow, com descida de gradiente. Considere o problema\n\\[P(Y=1\\;|\\;\\mu, x) = \\mu = \\sigma(\\alpha + \\beta x),\\]\nem que \\(Y\\) √© nossa vari√°vel resposta, \\(x\\) √© nossa vari√°vel explicativa, \\(\\alpha\\) e \\(\\beta\\) s√£o os par√¢metros que queremos estimar e \\(\\sigma(\\cdot)\\) √© a fun√ß√£o sigmoide, cuja inversa √© a fun√ß√£o de liga√ß√£o log√≠stica.\n\\[\\sigma(\\eta) = \\frac{1}{1 + e^{-\\eta}}\\]\nConsiderando que temos observa√ß√µes \\(Y_1, \\dots, Y_n\\) condicionalmente independentes, j√° temos o suficiente para especificar nosso modelo de regress√£o log√≠stica. O pr√≥ximo passo √© definir, com base nisso, a fun√ß√£o que queremos otimizar.\nA partir de uma amostra \\(y_1, \\dots, y_n\\) e observando que \\(\\mu_i = \\sigma(\\alpha + \\beta x_i)\\), a verossimilhan√ßa do modelo √© dada por\n\\[\r\\mathcal L((\\alpha, \\beta)|\\mathbf y) = \\prod_{i=1}^n f(y_i|(\\alpha, \\beta), x_i) = \\prod_{i=1}^n\\mu_i^{y_i}(1-\\mu_i)^{1-y_i}\r\\]\nO logaritmo da verossimilhan√ßa √© dado por\n\\[\r\\begin{aligned}\rl((\\alpha, \\beta)|\\mathbf y) \u0026amp;= \\sum_{i=1}^n y_i\\log(\\mu_i) + (1-y_i)\\log(1-\\mu_i)\\\\\r\u0026amp;= \\sum_{i=1}^n y_i\\log(\\sigma(\\alpha + \\beta x_i)) + (1-y_i)\\log(1 - \\sigma(\\alpha + \\beta x_i))\r\\end{aligned}\r\\]\nNosso objetivo √© maximizar \\(l\\) com rela√ß√£o √† \\(\\alpha\\) e \\(\\beta\\).\n\rDetalhe: essa soma, se multiplicada por -1, tamb√©m √© chamada de fun√ß√£o de perda\rbinary cross-entropy. Por isso que tanto faz voc√™ definir GLMs a partir de\r\\(P(Y|x)\\) ou a partir da fun√ß√£o de perda!\n\rOK, problema dado! vamos implementar usando tensorflow!\nlibrary(tensorflow)\r# gerando X usando uma distribui√ß√£o qualquer\rset.seed(123)\rN \u0026lt;- 10000\rx \u0026lt;- rnorm(N)\r# gerando y usando distribui√ß√£o binomial (com n = 1 para ser bernoulli)\r# aqui alpha_gerador = 1 e beta_gerador = 2\rsigmoide \u0026lt;- function(eta) 1 / (1 + exp(-eta))\ry \u0026lt;- rbinom(N, 1, sigmoide(1 + 2 * x))\r# transformando esses vetores objetos do tensorflow\rx \u0026lt;- tf$to_float(x)\ry \u0026lt;- tf$to_float(y)\r# inicializa√ß√£o das vari√°veis\r# o par√¢metro seed √© para permitir reprodutibilidade\ralfa \u0026lt;- tf$Variable(tf$random_normal(shape(1L), seed = 1))\rbeta \u0026lt;- tf$Variable(tf$random_normal(shape(1L), seed = 1))\r# c√°lculo da perda\rmu \u0026lt;- sigmoide(alfa + beta * x)\rperda \u0026lt;- -tf$reduce_sum(y*log(mu) + (1-y)*log(1-mu))\rFeito! Agora podemos usar a magia do tensorflow, que √© esperto o suficiente para otimizar essa perda sem a gente se preocupar em calcular derivadas na m√£o. Para quem n√£o conhece o algoritmo de descida de gradiente, ele funciona assim:\n\\[\r(\\alpha, \\beta)_{\\text{novo}} = (\\alpha, \\beta)_{\\text{velho}} + k \\nabla_{(\\alpha, \\beta)} l((\\alpha, \\beta)_{\\text{velho}}), \\]\nonde\n\r\\(\\nabla_{(\\alpha, \\beta)} l((\\alpha, \\beta)_{\\text{velho}})\\) √© o gradiente da verossimilhan√ßa em rela√ß√£o ao vetor \\((\\alpha, \\beta)\\), ou seja, s√£o as derivadas parciais de \\(l\\) em rela√ß√£o √† \\(\\alpha\\) e \\(\\beta\\). Isso d√° a dire√ß√£o e intensidade em que os valores devem ser atualizados.\n\r\\(k\\) √© chamado de learning rate, √© um fator usado para controlar o tamanho do passo dado pelo gradiente. Esse valor normalmente √© definido √† m√£o. No caso dos GLMs, \\(k\\) √© substitu√≠do pelo inverso da segunda derivada da \\(l\\) em rela√ß√£o aos par√¢metros, gerando assim os algoritmos de Newton-Raphson e Fisher-scoring.\n\r\rDetalhe: se voc√™ procurar esse algoritmo na internet, voc√™ vai encontrar um \\(-\\) e n√£o um \\(+\\). Isso acontece porque estamos usando a verossimilhan√ßa e n√£o a perda.\n# definindo o otimizador\rk \u0026lt;- 0.001 # essa √© a taxa de aprendizado k: learning rate\rotimizador \u0026lt;- tf$train$GradientDescentOptimizer(k)\r# calcular os gradientes e aplicar\rgradientes \u0026lt;- otimizador$compute_gradients(perda)\ratualizar \u0026lt;- otimizador$apply_gradients(gradientes)\r# agora realmente iniciamos o tensorflow para fazer as contas\rsess \u0026lt;- tf$Session()\rsess$run(tf$global_variables_initializer())\r# agora aplicamos a atualiza√ß√£o iterativamente\r# normalmente o n√∫mero de itera√ß√µes √© escolhido dinamicamente\r# a partir da diferen√ßa entre os valores velhos e novos calculados.\r# se a diferen√ßa √© muito pequena, ent√£o pode parar.\riteracoes \u0026lt;- 10\rfor (step in seq_len(iteracoes)) {\rsess$run(atualizar)\rs \u0026lt;- \u0026#39;Iter: %02d, alpha=%s, beta=%s\\n\u0026#39;\rcat(sprintf(s, step, round(sess$run(alfa), 3), round(sess$run(beta), 3)))\r}\rIter: 01, alpha=2.32, beta=3.593\rIter: 02, alpha=1.56, beta=3.409\rIter: 03, alpha=1.411, beta=2.989\rIter: 04, alpha=1.261, beta=2.665\rIter: 05, alpha=1.153, beta=2.422\rIter: 06, alpha=1.078, beta=2.257\rIter: 07, alpha=1.033, beta=2.154\rIter: 08, alpha=1.006, beta=2.095\rIter: 09, alpha=0.992, beta=2.062\rIter: 10, alpha=0.984, beta=2.045\rParece que funcionou! Agora sabemos ajustar uma regress√£o log√≠stica na m√£o, com o algoritmo de descida de gradiente‚Ä¶ ou ser√° que n√£o?\n\rO Problema\rVamos considerar o mesmo problema, mas agora com duas explicativas. temos\n\\[P(Y=1\\;|\\;\\mu, x) = \\mu = \\sigma(\\alpha + \\beta_1 x_2+ \\beta_2 x_2),\\]\nAs contas s√£o exatamente as mesmas e vou omitir, mostrando apenas o c√≥digo novo.\n# gerando X usando uma distribui√ß√£o qualquer\rset.seed(1)\rN \u0026lt;- 10000\rx1 \u0026lt;- rnorm(N)\rx2 \u0026lt;- rnorm(N)\ry \u0026lt;- rbinom(N, 1, sigmoide(1 + 2 * x1 + 3 * x2))\rx1 \u0026lt;- tf$to_float(x1)\rx2 \u0026lt;- tf$to_float(x2)\ry \u0026lt;- tf$to_float(y)\ralfa \u0026lt;- tf$Variable(tf$random_normal(shape(1L), seed = 1))\rbeta1 \u0026lt;- tf$Variable(tf$random_normal(shape(1L), seed = 1))\rbeta2 \u0026lt;- tf$Variable(tf$random_normal(shape(1L), seed = 1))\rmu \u0026lt;- sigmoide(alfa + beta1 * x1 + beta2 * x2)\rperda \u0026lt;- -tf$reduce_sum(y*log(mu) + (1-y)*log(1-mu))\rk \u0026lt;- 0.001\rotimizador \u0026lt;- tf$train$GradientDescentOptimizer(k)\rgradientes \u0026lt;- otimizador$compute_gradients(perda)\ratualizar \u0026lt;- otimizador$apply_gradients(gradientes)\rsess \u0026lt;- tf$Session()\rsess$run(tf$global_variables_initializer())\riteracoes \u0026lt;- 10\rfor (step in seq_len(iteracoes)) {\rsess$run(atualizar)\rs \u0026lt;- \u0026#39;Iter: %02d, alpha=%s, beta1=%s, beta2=%s\\n\u0026#39;\rcat(sprintf(s, step, round(sess$run(alfa), 3), round(sess$run(beta1), 3),\rround(sess$run(beta2), 3)))\r}\rIter: 01, alpha=1.674, beta1=2.703, beta2=3.461\rIter: 02, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 03, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 04, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 05, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 06, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 07, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 08, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 09, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 10, alpha=NaN, beta1=NaN, beta2=NaN\rOops! Explodiu! Por que ser√°???\nUma forma de corrigir esse problema √© considerando uma taxa de aprendizado k um pouco menor. Com os mesmos dados e modelo acima, ao fazer\nk \u0026lt;- 0.00094\re rodar novamente, j√° conseguimos chegar nos resultados abaixo.\nIter: 01, alpha=1.525, beta1=2.492, beta2=3.205\rIter: 02, alpha=1.183, beta1=2.32, beta2=3.36\rIter: 03, alpha=1.122, beta1=2.248, beta2=3.34\rIter: 04, alpha=1.101, beta1=2.208, beta2=3.296\rIter: 05, alpha=1.085, beta1=2.178, beta2=3.254\rIter: 06, alpha=1.073, beta1=2.152, beta2=3.216\rIter: 07, alpha=1.062, beta1=2.13, beta2=3.183\rIter: 08, alpha=1.053, beta1=2.112, beta2=3.154\rIter: 09, alpha=1.044, beta1=2.095, beta2=3.13\rIter: 10, alpha=1.037, beta1=2.082, beta2=3.109\rMais algumas itera√ß√µes e o modelo converge.\nMas n√≥s n√£o queremos ficar fazendo um ajuste t√£o fino no valor de k, certo? Afinal, queremos resolver problemas do mundo real, n√£o ficar escolhendo valores de k‚Ä¶ Outra forma de resolver isso √© evitando problemas num√©ricos nas contas. O c√°lculo da fun√ß√£o de perda, por exemplo, pode ser melhorado. Mas como?\nBom, problemas num√©ricos n√£o s√£o minha especialidade, ent√£o agora √© hora de seguir os mestres. Vamos olhar como o R e como o Tensorflow implementam as fun√ß√µes de perda para regress√£o log√≠stica.\nOs objetos de classe family no R\rNo R, os GLMs buscam informa√ß√µes de objetos da classe family() para realizar os ajustes. No caso da log√≠stica, o objeto √© retornado por uma fun√ß√£o chamada binomial().\nfam \u0026lt;- binomial()\rO resultado disso √© uma lista com v√°rios m√©todos implementados. Por exemplo, a vari√¢ncia da binomial √© dada por:\nfam$variance\rfunction (mu) mu * (1 - mu)\r\u0026lt;bytecode: 0x55fc8e220a18\u0026gt;\r\u0026lt;environment: 0x55fca4eb5040\u0026gt;\rA fun√ß√£o de perda √© dada pelo m√©todo fam$dev.resids() (res√≠duos deviance), e o c√≥digo fonte √©:\nfam$dev.resid\rfunction (y, mu, wt) .Call(C_binomial_dev_resids, y, mu, wt)\r\u0026lt;bytecode: 0x55fc8e2253a0\u0026gt;\r\u0026lt;environment: 0x55fca4eb5040\u0026gt;\rHmm, parece que √© uma fun√ß√£o feita em C. Como as contas da nossa perda (soma, logaritmo, multiplica√ß√£o e divis√£o) j√° s√£o todas implementadas em C, provavelmente a conta foi implementada em C para garantir estabilidade num√©rica.\nOlhando o c√≥digo-fonte do pacote stats, encontramos a defini√ß√£o da fun√ß√£o. A fun√ß√£o √© um pouco longa, ent√£o eu mantive apenas as partes importantes:\nstatic R_INLINE\rdouble y_log_y(double y, double mu)\r{\rreturn (y != 0.) ? (y * log(y/mu)) : 0;\r}\rSEXP binomial_dev_resids(SEXP y, SEXP mu, SEXP wt)\r{\r/* inicializa√ß√£o de vari√°veis e verifica√ß√µes */\r/* rmu e ry s√£o os valores de mu e y transformados para reais */\r/* rmu e ry s√£o os valores de mu e y transformados para reais */\rfor (i = 0; i \u0026lt; n; i++) {\rmui = rmu[i];\ryi = ry[i];\rrans[i] = 2 * rwt[lwt \u0026gt; 1 ? i : 0] * (y_log_y(yi, mui) + y_log_y(1 - yi, 1 - mui));\r}\r/* outros c√≥digos n√£o muito importantes */\rUNPROTECT(nprot);\rreturn ans;\r}\rEu n√£o programo muito em C, mas desse c√≥digo d√° para ver duas coisas importantes: i) a fun√ß√£o y_log_y s√≥ faz a conta se o valor de \\(y\\) for diferente de zero, se n√£o, ela j√° retorna zero; ii) a fun√ß√£o y_log_y faz a conta \\(y\\log({y}/{\\mu})\\), ao inv√©s de apenas \\(y\\log({\\mu})\\). Isso acontece pois no R estamos minimizando o Desvio do modelo, dado por\n\\[\r\\begin{aligned}\r\u0026amp;D(\\mathbf y, \\mu) = 2[l(\\mathbf y|\\mathbf y) - l(\\mathbf y|(\\alpha, \\beta))]\\\\\r\u0026amp;=2\\left[\\sum_{i=1}^n y_i\\log(y_i) + (1-y_i)\\log(1-y_i)\\right. - \\\\\r\u0026amp;\\left. -\\sum_{i=1}^n y_i\\log(\\mu_i) + (1-y_i)\\log(1-\\mu_i)\\right] \\\\\r\u0026amp;=2\\left[\\sum_{i=1}^n y_i\\log\\left(\\frac{y_i}{\\mu_i}\\right) + (1-y_i)\\log\\left(\\frac{1-y_i}{1-\\mu_i}\\right)\\right].\r\\end{aligned}\r\\]\nEssa √© a formula√ß√£o usual na literatura de GLMs, que apresenta uma s√©rie de propriedades estat√≠sticas. Minimizar o desvio equivale a maximizar a verossimilhan√ßa. Ser√° que isso ajuda nos problemas num√©ricos? Vamos ver:\n## mesmos c√≥digos de antes...\r## s√≥ substitua a perda por essas duas linhas\ry_log_y \u0026lt;- function(y, mu) y * log(y / mu)\rperda \u0026lt;- tf$reduce_sum(tf$where(y == 0, y_log_y(1-y, 1-mu), y_log_y(y, mu)))\r## mesmos c√≥digos de antes...\rIter: 01, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 02, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 03, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 04, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 05, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 06, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 07, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 08, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 09, alpha=NaN, beta1=NaN, beta2=NaN\rIter: 10, alpha=NaN, beta1=NaN, beta2=NaN\rHmm, parece que n√£o. Se olharmos mais atentamente para a fun√ß√£o desvio, como \\(y\\) pode assumir apenas os valores zero ou um, √© poss√≠vel observar que a conta √© equivalente √† perda calculada anteriormente. Possivelmente o problema aqui √© que o tensorflow n√£o trabalha muito bem com essas condi√ß√µes (tf$where) na perda, e isso d√° problemas na hora de calcular o gradiente.\nEssa fun√ß√£o do R simplesmente n√£o resolve o problema inicial. Melhor olhar o que o tensorflow faz!\n\rA binary cross-entropy no Tensorflow\rEu escondi de voc√™s, mas o tensorflow j√° tem a fun√ß√£o de perda implementada: tf$nn$sigmoid_cross_entropy_with_logits. Ela j√° assume que a fun√ß√£o de liga√ß√£o √© log√≠stica, por isso o sigmoid_ no in√≠cio. Traduzindo livremente o help da fun√ß√£o, temos o seguinte (z=\\(y\\) e x=\\(\\eta = \\alpha + \\beta x\\))\n z * -log(sigmoid(x)) + (1 - z) * -log(1 - sigmoid(x))\r= z * -log(1 / (1 + exp(-x))) + (1 - z) * -log(exp(-x) / (1 + exp(-x)))\r= z * log(1 + exp(-x)) + (1 - z) * (-log(exp(-x)) + log(1 + exp(-x)))\r= z * log(1 + exp(-x)) + (1 - z) * (x + log(1 + exp(-x))\r= (1 - z) * x + log(1 + exp(-x))\r= x - x * z + log(1 + exp(-x))\rPara \\(\\eta \u0026lt; 0\\) para evitar problemas num√©ricos com \\(\\exp(-\\eta)\\), reformulamos para\n x - x * z + log(1 + exp(-x))\r= log(exp(x)) - x * z + log(1 + exp(-x))\r= - x * z + log(1 + exp(x))\rEnt√£o, para garantir estabilidade e evitar problemas num√©ricos, a implementa√ß√£o usa essa formula√ß√£o equivalente\nmax(x, 0) - x * z + log(1 + exp(-abs(x)))\rBeleza, vamos tentar!\n## mesmos c√≥digos de antes...\r## s√≥ substitua a perda por essas duas linhas\r## agora n√£o precisa calcular o sigmoide\r# mu \u0026lt;- sigmoide(alfa + beta1 * x1 + beta2 * x2)\rperda \u0026lt;- tf$nn$sigmoid_cross_entropy_with_logits(\rlabels = y, logits = alfa + beta1 * x1 + beta2 * x2\r)\r## mesmos c√≥digos de antes...\rIter: 01, alpha=1.674, beta1=2.703, beta2=3.461\rIter: 02, alpha=1.276, beta1=2.495, beta2=3.608\rIter: 03, alpha=1.197, beta1=2.396, beta2=3.562\rIter: 04, alpha=1.164, beta1=2.335, beta2=3.489\rIter: 05, alpha=1.14, beta1=2.287, beta2=3.42\rIter: 06, alpha=1.12, beta1=2.245, beta2=3.358\rIter: 07, alpha=1.102, beta1=2.21, beta2=3.303\rIter: 08, alpha=1.086, beta1=2.178, beta2=3.256\rIter: 09, alpha=1.073, beta1=2.152, beta2=3.215\rIter: 10, alpha=1.061, beta1=2.129, beta2=3.18\rFuncionou! :)\n\r\rWrap-up\rTensorflow √© uma biblioteca interessante a ser explorada.\r√â poss√≠vel implementar uma regress√£o log√≠stica do zero em poucos passos.\rPrecisamos tomar cuidado com problemas num√©ricos!\r\rNo futuro, brincaremos tamb√©m com o algoritmo IWLS. Ser√° que ele roda mais r√°pido que a descida de gradiente?\n√â isso pessoal. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2018-11-18-logistica-comp/","tags":["estat√≠stica"],"title":"Regress√£o log√≠stica: aspectos computacionais"},{"author":["Daniel"],"categories":["tutoriais"],"contents":"\r\rO Caio j√° escreveu aqui no blog sobre o CronR, um pacote do R que permite agendar scripts do R para rodar de tempos em tempos. O problema do CronR √© que ele necessita que o computador que hospeda o processo fique ligado o tempo todo.\nEm geral, n√£o colocamos processos agendados no nosso pr√≥prio computador de trabalho, uma vez que nem sempre o deixamos ligado. Por isso, o mais comum √© agendar scripts em um servidor que fique sempre ligado, por√©m deixar um servidor ligado todos os dias o dia inteiro para rodar um script a cada 12h parece desperd√≠cio, certo?\n√â a√≠ que entra o Hyper.sh! Para quem n√£o conhece o Hyper √© um servi√ßo cloud de hospedagem de containers. Basicamente ele funciona da seguinte maneira: voc√™ passa a imagem de um container Docker e como voc√™ quer execut√°-la l√° dentro. O Hyper pode servir tanto para hospedar apps Shiny, API‚Äôs em plumber e outros servi√ßos que ficam online o tempo inteiro quanto para executar scripts agendados, e √© sobre essa parte que vamos falar nesse post.\nObjetivo\rNeste post vamos criar e colocar em produ√ß√£o um script em R que envia para voc√™ mesmo no Telegram a cada 2 horas uma mensagem do pacote fortunes. Vamos fazer isso simples, mas nada impede de voc√™ criar um bot que avisa que o Bitcoin t√° barato.\n\rCriando o bot\rAntes de mais nada, vamos criar um bot no Telegram. Para isso clique neste link e comece a conversar com o BotFather.\nVoc√™ vai ter que dar um nome e usu√°rio para o seu bot e em troca, o BotFather vai retornar um token, parecido com 6768271902:AAGKFXUz7P_Qg2X_pE0ZjKSLPZ45TEX9Z5QL4.\nEsse token √© secreto, ent√£o n√£o √© legal coloc√°-lo direto no seu script. A forma usual de deix√°-lo dispon√≠vel para o R √© colocar no .Renviron.\n\rColocando o token no .Renviron\rO .Renviron √© um arquivo de configura√ß√£o do R que permite que voc√™ especifique vari√°veis de ambiente para que fiquem dispon√≠veis para o R. Ele √© muito usado para disponibilizar senhas, chaves de API, ‚Ä¶ - coisas que s√£o secretas e por isso n√£o √© boa pr√°tica coloc√°-las no c√≥digo.\nO jeito mais f√°cil de abrir o .Renviron √© usando o pacote usethis. O usethis √© um pacote do R que tem uma s√©rie de fun√ß√µes √∫teis no dia a dia de um desenvolvedor R.\nInstale o pacote e depois rode:\nusethis::edit_r_environ()\rSe voc√™ estiver no RStudio, isso vai abrir o arquivo .Renviron. Adicione a linha:\nR_TELEGRAM_BOT_RBot=6768271902:AAGKFXUz7P_Qg2X_pE0ZjKSLPZ45TEX9Z5QL4\rN√£o esque√ßa de trocar o token que est√° a√≠ pelo seu token, gerado pelo BotFather.\nAgora vamos testar se est√° tudo certo. Instale o pacote telegram (install.packages(\"telegram\")) e rode:\nlibrary(telegram)\rbot \u0026lt;- TGBot$new(token = bot_token(\u0026#39;RBot\u0026#39;))\rbot$getMe()\rIsso deve retornar o nome e username do seu bot.\n\rComece um chat com o seu bot\rPara come√ßar um chat com o seu bot no Telegram volte para a conversa com o BotFather e clique no link que ele te mandou na √∫ltima mensagem (a mensagem que veio o token)\nClique no link e depois comece uma conversa com o seu bot. Agora volte para o R e rode:\nmsgs \u0026lt;- bot$getUpdates()\rmsgs$message$chat$id[1]\rAssim voc√™ vai ter o o id do seu chat com o seu bot. Vamos setar esse id como o chat padr√£o do bot.\nbot$set_default_chat_id(137007207)\rPodemos ent√£o come√ßar a enviar mensagens direto do R com:\nbot$sendMessage(\u0026quot;Oioioioi\u0026quot;)\r\rCriando o script\rNo nosso caso, queremos enviar uma mensagem no telegram com mensagens do pacote fortunes.\rA fun√ß√£o fortunes solta aleat√≥riamente frases famosas que apareceram na lista de e-mails do R ao longo do tempo.\nlibrary(fortunes)\rfortune()\r## ## I recently read the small print on the academic license our site has for SAS.\r## You have to:\r## ## 1 inform SAS of any taught courses that use SAS,\r## 2 inform SAS of any research projects using SAS,\r## 3 allow SAS to refer to your institution as a SAS user,\r## 4 allow SAS to review your taught courses,\r## 5 ensure your courses are taught using qualified personnel,\r## 6 give SAS your first-born male offspring.\r## ## I spoke to our site\u0026#39;s licensing supremos and they say they\u0026#39;ve never heard of\r## anyone complying with 1 or 2. Point 4 sounds like petty fiddling in our\r## educational business, and point 5 left \u0026#39;qualified\u0026#39; undefined. Point 6 doesn\u0026#39;t\r## bother me since I don\u0026#39;t have kids.\r## -- Barry Rowlingson\r## R-help (February 2008)\rVamos criar uma fun√ß√£o que envia uma mensagem aleatoriamente pelo Telegram. A fun√ß√£o poderia ser algo assim:\nmain \u0026lt;- function() {\rbot \u0026lt;- TGBot$new(token = bot_token(\u0026#39;RBot\u0026#39;))\rbot$set_default_chat_id(137007207)\rbot$sendMessage(fortune())\r}\rOk? Quando rodamos a fun√ß√£o main() recebemos uma nova mensagem no Telegram, certo? Por fim, o nosso script pode ser:\nlibrary(telegram)\rlibrary(fortunes)\rmain \u0026lt;- function() {\rbot \u0026lt;- TGBot$new(token = bot_token(\u0026#39;RBot\u0026#39;))\rbot$set_default_chat_id(user_id(\u0026#39;me\u0026#39;))\rbot$sendMessage(fortune())\r}\rmain()\rSalvei esse c√≥digo em um arquivo chamado send_fortune.R.\nEu gosto de encapsular todo o c√≥digo em uma fun√ß√£o sem argumentos para ser mais f√°cil para parar a execu√ß√£o em caso de errros durante o c√≥digo, mas isso vai da forma que voc√™ preferir programar.\n\rA estrutura do projeto\rO nosso projeto possui a seguinte estrutura:\n.\r‚îú‚îÄ‚îÄ Dockerfile\r‚îî‚îÄ‚îÄ send_fortune.R\rO nosso script .R e o Dockerfile que vamos falar em seguida. Nada impede de termos outros arquivos, ok? O que √© necess√°rio √© que tanto o Dockerfile quanto o script estejam na mesma pasta.\n\rCriando o Dockerfile\rO Hyper n√£o sabe que o R existe. Ele s√≥ sabe executar imagens do Docker. O Docker √© uma ferramenta muito poderosa que permite que a partir de um arquivo chamado Dockerfile voc√™ especifique exatamente o estado de um computador, simulando a instala√ß√£o de todos os softwares necess√°rios e etc. N√£o √© objetivo deste post explicar exatamente como funciona o Docker, por isso vamos direto ao necess√°rio.\nCrie um arquivo chamado Dockerfile (sem nenhuma extens√£o nem nada) e coloque o seguinte dentro dele:\nFROM rocker/tidyverse\rCOPY . /service\r# Install the R libraries needed to run the scripts\rRUN R -e \u0026quot;install.packages(c(\u0026#39;telegram\u0026#39;, \u0026#39;fortunes\u0026#39;), repos = \u0026#39;http://cran.us.r-project.org\u0026#39;)\u0026quot;\r# Execute the target script\rCMD [\u0026quot;Rscript\u0026quot;, \u0026quot;/service/send_fortune.R\u0026quot;]\rVou explicar rapidamente o que significa cada linha do Dcoker:\n\rFROM rocker/tidyverse indica que vamos usar como base para o nosso container a imagem do rocker/tidyverse.\rCOPY . /service copia todos os arquivos da pasta (indicado pelo .) para a pasta /service dentro do container.\rRUN R -e \"install.packages(c('telegram', 'fortunes'), repos = 'http://cran.us.r-project.org')\" instala os pacotes necess√°rios para a execu√ß√£o do script.\rCMD [\"Rscript\", \"/service/send_fortune.R\"] indica o comando que ser√° executado. No nosso caso: execute o script send_fortune.R que est√° na pasta service/.\r\r\rConstruindo e subindo o container\rPara usar o nosso container no Hyper, precisamos que ele esteja em um registry. O pr√≥prio Docker oferece um servi√ßo gratuito de hospedagem de containers. Basta criar um login l√°.\nPara subir um container para o registry voc√™ precisa ter buildado o container localmente. Vamos fazer isso agora. Se voc√™ n√£o possui o Docker instalado, instale por aqui.\nAbra um terminal na pasta do em que est√£o os arquivos Dockerfile e send_fortune.R e rode:\ndocker build -t seu_user_docker/nome_img .\rEsse passo transforma o seu Dockerfile em uma imagem. O argumento -t d√° um nome para sua imagem, no caso estamos usando seu_user_docker/nome_da_img (No meu caso usei dfalbel/hyper-cron-r).\nCom o container buildado voc√™ pode test√°-lo fazendo o seguinte:\ndocker run --env R_TELEGRAM_BOT_RBot=6793020822:AAGKFXUz7P_Qg2X_pshau8432X9ZAKHQL4 dfalbel/hyper-cron-r\rIsso deveria enviar uma mensagem para voc√™ no telegram. Se n√£o mandar tem algo errado. N√£o esque√ßa de trocar o valor do Token para o que voc√™ obteve no primeiro passo.\nPassamos o argumento --env para poder passar as vari√°veis de ambiente que s√£o necess√°rias para executar o nosso c√≥digo. No nosso caso, temos que passar o token do Telegram, fiz isso\rpassando o --env R_TELEGRAM_BOT_RBot=6793020822:AAGKFXUz7P_Qg2X_pshau8432X9ZAKHQL4.\nAgora vamos subir a imagem para o Docker registry. Se voc√™ j√° criou a sua conta aqui, rode e siga as inscri√ß√µes para efetuar o login no CLI do Docker.\ndocker login\rSe seu login deu tudo certo, voc√™ pode rodar:\ndocker push seu_user_docker/nome_da_img\rIsso vai fazer o upload da sua imagem para o * registry*. No meu caso usei docker push dfalbel/hyper-cron-r.\nSe tiver dado tudo certo, voc√™ vai conseguir acessar uma p√°gina com uma url parecida com essa:\nhttps://hub.docker.com/r/seu_user_docker/nome_da_img/\rO Docker hub permite quantas imagens p√∫blicas voc√™ quiser, mas se n√£o me engano apenas 1 privada. Se voc√™ precisar que sua imagem seja privada, tente procurar pelo GCR (Google Container Registry).\n\rFinalmente, o Hyper\rSe voc√™ ainda n√£o criou sua conta no Hyper, crie aqui. Tamb√©m fa√ßa o download do CLI deles, aqui. As instru√ß√µes completas de instala√ß√£o est√£o aqui.\nCom o hyper instalado e se a sua imagem do Docker for p√∫blica basta rodar. Est√° fora do escopo deste tutorial, mas √© poss√≠vel fazer isso com imagens privadas tamb√©m.\nhyper pull seu_user_docker/nome_da_img/\rIsso ir√° copiar a sua imagem - do registry para o Hyper. Agora estamos prontos para criar o processo agendado.\nFazemos isso tamb√©m com apenas uma linha no Hyper:\nhyper cron create --minute=*/5 --hour=* --name test-cron-job1 --env R_TELEGRAM_BOT_RBot=6793020822:AAGKFXUz7P_Qg2X_pEAHDGJ8432X9Z5QL4 seu_user_docker/nome_da_img/\rMais uma vez, n√£o esque√ßa de trocar o valor do token para o token do seu bot!\nO c√≥digo acima especifica que desejo executar esse container a cada 5 minutos, mas tudo isso pode ser configurado pelas op√ß√µes do hyper-cron. A documenta√ß√£o completa est√° aqui.\nPor exemplo, se quis√©ssemos rodar o script todo dia √†s 8h da poder√≠amos colocar:\nhyper cron create --minute=0 --hour=11 --name test-cron-job1 --env R_TELEGRAM_BOT_RBot=6793020822:AAGKFXUz7P_Qg2X_pEAHDGJ8432X9Z5QL4 seu_user_docker/nome_da_img/\rNote que no lugar da hora colocamos 11 e n√£o 8, isso se d√° porque a hora dos servidores do Hyper √© sempre UTC+0, que √© 3 horas na frente do fuso de S√£o Paulo.\nSe tudo estiver correto, voc√™ pode rodar o seguinte no terminal para ver todos os processos agendados:\nhyper cron ls\r#$ Name Schedule Image Command\r#$ test-cron-job1 */5 * * * * dfalbel/hyper-cron-r\rVoc√™ tamb√©m pode olhar o hist√≥rico de execu√ß√µes do seu processo.\nhyper cron history test-cron-job1\r#$ Container Start End Status Message\r#$ test-cron-job1-1538685600 2018-10-04 20:40:00 +0000 UTC 2018-10-04 20:40:39 +0000 UTC done Job[test-cron-job1] is success to run\r\rCustos\rO Hyper implica em custos. Ele cobra por segundos de execu√ß√£o do seu script e por GB da sua imagem. D√™ uma lida melhor na p√°gina de pre√ßos.\nQuando terminar, para remover tudo e evitar custos depois, rode:\nhyper cron rm test-cron-job1\rhyper rmi dfalbel/hyper-cron-r\rSubstituindo os devidos nomes.\n\rConclus√£o\rNeste post usamos o Hyper e Docker para agendar um script R para rodar de tempos em tempos.\rSei que tem bastante coisa e n√£o d√° para descrever todos os passos com toda precis√£o necess√°ria para quem est√° fora do contexto. Por favor, se tiverem problemas ou d√∫vidas entre em contato para que possa melhorar o post.\nSe voc√™ quiser ver o c√≥digo completo desse tutorial em um lugar s√≥ d√™ uma olhada neste reposit√≥rio.\n\r","permalink":"https://blog.curso-r.com/posts/2018-10-04-hyper-cron/","tags":["cron"],"title":"Agendando scripts do R"},{"author":["Daniel","Jos√©"],"categories":["tutoriais"],"contents":"\r\rNeste post vamos criar um Shiny App simples usando o Auth0 como servidor de autentica√ß√£o. O Auth0 implementa o OAuth2, o principal protocolo de autoriza√ß√£o utilizado atualmente na ind√∫stria de software. Ele permite que os aplicativos tenham acesso limitado √†s contas de usu√°rio em servi√ßos HTTP.\nComo funciona o oauth2.0?\rAntes de come√ßarmos - nesta parte do post resumi um pouco o que est√° escrito aqui. Para se aprofundar, vale a pena ler essa postagem do Aaron Parecki.\nPap√©is\rA autoriza√ß√£o/autentica√ß√£o feita por meio de OAuth2 envolve 4 pap√©is:\n\rCliente: √â o aplicativo que est√° tentando acessar a conta do usu√°rio. Ele precisa obter a permiss√£o do usu√°rio antes de poder acessar as informa√ß√µes.\rAPI: √â o servidor de recursos que √© usado para acessar as informa√ß√µes do usu√°rio.\rServidor de autoriza√ß√£o: Esse √© o servidor que vai aprovar ou recusar as requisi√ß√µes. Ele pode ser o mesmo servidor que o API. No caso do Auth0 que vamos ver mais tarde, eles s√£o o mesmo servidor.\rDono do recurso: O dono do recurso √© a pessoa que est√° dando acesso de alguma parte das informa√ß√µes da sua conta.\r\r\rCriando um App\rAntes de come√ßar o processo de autentica√ß√£o com o OAuth, voc√™ deve registrar o seu app com o servi√ßo - no nosso caso, vamos registr√°-lo com o Auth0. Ao registrar em geral passamos informa√ß√µes b√°sicas sobre o app e o principal √© o redirect URI - que ser√° chamado de callback URL pelo Auth0. O servidor de autentica√ß√£o s√≥ pode redirecionar o usu√°rio para essas URL‚Äôs cadastradas ap√≥s completar a autoriza√ß√£o - isso ajuda a evitar alguns tipos de ataques.\nDepois de registrar o seu app voc√™ receber√° um client ID e um client secret. Em teoria o client ID √© informa√ß√£o p√∫blica e o client secret (√© segredo) e n√£o pode ser divulgado.\n\rO fluxo da autentica√ß√£o\rExistem 4 fluxos distintos de autentica√ß√£o no OAuth2.0, cada um utilizado em circunt√¢ncias diferentes. No nosso caso vamos usar um m√©todo chamado de * Authorization Code*. Esse m√©todo funciona da seguinte forma:\nCriamos um link de autentica√ß√£o para o usu√°rio com as seguintes informa√ß√µes:\n\rclient_id\rredirect_uri\rscope\rstate\r\rJ√° falamos dos 2 primeiros. O scope vai indicar quais partes da conta do usu√°rio que o cliente pode ver. O state, uma string aleat√≥ria que verificaremos depois. O link que criamos √© algo da forma:\nhttps://authorization-server.com/auth?response_type=code\u0026amp;\rclient_id=CLIENT_ID\u0026amp;redirect_uri=REDIRECT_URI\u0026amp;scope=photos\u0026amp;state=1234zyx\rAo acessar este link o usu√°rio v√™ o que chamamos de prompt de autoriza√ß√£o. Algo do tipo:\nImg do post https://aaronparecki.com/oauth-2-simplified/\n\rSe o usu√°rio clicar em Autorizar, ele ser√° redirecionado para o seu app passando um c√≥digo gerado pelo servidor de autoriza√ß√£o e o state. A URL ser√° algo do tipo:\nhttps://example-app.com/cb?code=AUTH_CODE_HERE\u0026amp;state=1234zyx\rSe o state for o mesmo que tiver sido gerado anteriormente, estamos prontos para requisitar o token de acesso. O token de acesso √© solicitado pelo app ao servidor de autoriza√ß√£o por meio de uma requisi√ß√£o do tipo POST que envia as seguintes informa√ß√µes:\n\rgrant_type: o n√≠vel de autoriza√ß√£o requisitada\rcode: o c√≥digo de autentica√ß√£o gerado no anteriormente\rredirect_uri: a URL de redirecionamente\rclient_id: o c√≥digo do cliente.\r\rEm posse do token, temos o que √© necess√°rio para fazer requisi√ß√µes para a API e assim obter as informa√ß√µes que o usu√°rio nos permitiu acesso.\n\r\rConfigurando o Auth0\rV√° para a p√°gina applications e crie um novo app clicando no bot√£o Create Application no canto superior direito.\nNa pr√≥xima tela, d√™ um nome para o app (esse √© o nome que aparecer√° na p√°gina de login) e selecione o Regular Web Applications. Selecionamos esse tipo de app para n√£o ter que se preocupar em esconder o client secret.\nEm seguida v√° para a aba Settings para configurarmos alguns detalhes do app.\nAs coisas mais importantes aqui s√£o:\n\rDomain: indica o endpoint do OAuth2. Vamos nos referir a ele posteriormente como base_url.\rClient Id: √© a chave do cliente. No nosso c√≥digo vamos nos referir a ele como key.\rClient Secret: √© a chave secreta do app. Vamos nos referir a ele como secret.\r\rMais para baixo, na mesma p√°gina, vamos configurar o campo Allowed Callback URLs, essas s√£o as URL‚Äôs para as quais permitimos que o usu√°rio seja redirecionado ap√≥s a autentica√ß√£o. Tamb√©m vamos configurar o campo Allowed Web Origins para poder indicar quis URL‚Äôs podem redirecionar para a p√°gina de autentica√ß√£o.\nNo nosso caso, vamos preencher os dois campos com as mesmas URL‚Äôs. A primeira: https://localhost:8100 - caminho e porta que vamos usar para testes locais.\rA segunda URL √© aquela em que o Shiny ficar√° hospedado. Voc√™ n√£o precisa preencher as duas agora, por enquanto pode deixar somente a URL local enquanto testamos o app localmente.\nNo Auth0 √© s√≥ isso. Agora vamos para o R.\n\rConectando o R com o Auth0\rO c√≥digo que vamos desenvolver e uma vers√£o adaptada do c√≥digo que est√° dispon√≠vel neste link. A diferen√ßa √© que este faz a autentica√ß√£o usando a conta do Github e o nosso far√° a autentica√ß√£o com o Auth0. A vers√£o completa deste c√≥digo est√° dispon√≠vel aqui.\nVamos desenvolver um app simples em Shiny que mostra as informa√ß√µes disponibilizadas pelo usu√°rio. Neste app usaremos duas bibliotecas:\nlibrary(shiny)\rlibrary(httr)\rSetup do Oauth\rOs c√≥digos nesta sess√£o podem ser incluidos no arquivo global.R ( se voc√™ estiver desenvolvendo o seu shiny separando por arquivos ui.R e server.R) se voc√™ estiver usando apenas um app.R, esses blocos podem ser inclu√≠dos no in√≠cio do arquivo - antes da chamada por shinyApp(uiFunc, server).\nNeste primeiro bloco de c√≥digo vamos definir qual √© a URL que o app est√° sendo servido.\rCriamos um bloco que faz o seguinte - quando estivermos em uma sess√£o interativa (por exemplo, rodando pelo RStudio) use a url APP_URL \u0026lt;- \"https://localhost:8100/\". J√° quando estiver em uma sess√£o n√£o interativa, use https://shiny.curso-r.com.\nif (interactive()) {\r# testing url\roptions(shiny.port = 8100)\rAPP_URL \u0026lt;- \u0026quot;https://localhost:8100/\u0026quot;\r} else {\r# deployed URL\rAPP_URL \u0026lt;- \u0026quot;https://shiny.curso-r.com\u0026quot;\r}\rEssas devem ser as URL‚Äôs que indicamos anteriormente para o Auth0 nos campos Allowed Web Origins e Allowed Callback URLs.\nAgora vamos criar um objeto chamado app que vai armazenar todas as informa√ß√µes relativas ao seu app configurado no Auth0. Colocamos entre {} as informa√ß√µes que voc√™ deve preencher com os seus dados.\nAqui voc√™ indicar√° a sua key e secret que obtivemos ao criar um App no Auth0.\napp \u0026lt;- oauth_app(\rappname = \u0026quot;{coloque um nome para o seu App. (esse nome √© opcional)}\u0026quot;,\rkey = \u0026quot;{coloque aqui o seu Client ID - tamb√©m chamamos de key\u0026quot;,\r# n√£o √© uma boa ideia deixar o secret no c√≥digo # use vari√°veis de ambiente ou o pacote keyring\rsecret = \u0026quot;{coloque aqui o seu Client Secret - tamb√©m chamamos de secret}\u0026quot;,\rredirect_uri = APP_URL\r)\rAgora vamos criar um outro objeto chamado api que vai armazenar as informa√ß√µes necess√°rias para determinar os endpoints para as requisi√ß√µes necess√°rias para fazer a autentica√ß√£o com o Auth0. Esse objeto nos ajuda a fazer rapidamente um wrapper para a API de auentica√ß√£o do Auth0 - documentada aqui.\napi \u0026lt;- oauth_endpoint(\rbase_url = \u0026quot;{coloque aqui o seu Domain - tamb√©m chamamos de base_url}\u0026quot;,\rrequest = \u0026quot;oauth/token\u0026quot;, authorize = \u0026quot;authorize\u0026quot;,\raccess = \u0026quot;oauth/token\u0026quot;\r)\rBasicamente, aqui estamos dizendo o seguinte. Para requisitar um token use o endpoint oauth/token, para solicitar autoriza√ß√£o, use o endpoint authorize e para solicitar acesso use o endpoint oauth/token.\nN√£o √© recomendado, mas voc√™ poderia alterar esses endpoints na sess√£o Endpoints das configura√ß√µes avan√ßadas do seu aplicativo no Auth0 - como mostra a imagem abaixo.\nOutro objeto importante que temos que definir √© o scope. Essa string indica quais informa√ß√µes vamos solicitar do usu√°rio para acesso. No nosso caso vamos usar:\nscope \u0026lt;- \u0026quot;openid profile\u0026quot;\rIndicando assim que queremos acesso ao openid e ao perfil do usu√°rio. Mais informa√ß√µes sobre esse scope podem ser encontradas aqui.\nPor fim, definimos um objeto state uma string aleat√≥ria que vai servir para validar que falamos mesmo com o Auth0. Ele deve nos redirecionar para uma p√°gina com o mesmo state.\nstate \u0026lt;- paste(sample(c(letters, 0:9), size = 10, replace = TRUE), collapse = \u0026quot;\u0026quot;)\rTamb√©m vamos definir uma fun√ß√£o chamada has_auth_code. Ela retorna TRUE quando baseando-se nos par√¢metros da URL, parece que existe c√≥digo do OAuth e quando o state √© o mesmo que foi enviado para o Auth0, caso contr√°rio ela retorna FALSE.\nhas_auth_code \u0026lt;- function(params, state) {\rif (is.null(params$code)) {\rreturn(FALSE)\r} else if (params$state != state) {\rreturn(FALSE)\r} else {\rreturn(TRUE)\r}\r}\r\rConstruindo o UI\rAgora vamos construir a UI do nosso app. Se voc√™ estiver usando apenas um app.R pode definir os objetos da mesma forma que vamos fazer aqui. Se voc√™ estiver usando arquivos separados √© s√≥ fazer a fun√ß√£o que vamos definir a seguir uiFunc seja a √∫ltima expressao do seu arquivo ui.R.\nPrimeiro definimos um objeto chamado ui que cont√©m a UI normalmente, como se n√£o estiv√©ssemos criando a autentica√ß√£o:\nui \u0026lt;- fluidPage(\rverbatimTextOutput(\u0026quot;code\u0026quot;)\r)\rAgora vem a parte importante. Uma feature que √© pouco conhecida no Shiny, √© que o UI pode ser uma fun√ß√£o e n√£o somente um objeto. Essa fun√ß√£o pode ser usada para modificar a interface baseando-se na requisi√ß√£o.\nNo nosso caso, a nossa fun√ß√£o uiFunc ir√° identificar se o par√¢metro code foi enviado na * query string.  Query string* √© um nome que damos aos par√¢metros que vem pela URL. No exemplo www.curso-r.com?abb=1\u0026amp;x=2 temos os par√¢metros abb=1 e x=2. No nosso caso precisamos receber um par√¢metro code que √© usado para obter o token de autentica√ß√£o e um par√¢metro state que usamos para evitar ataques do tipo CSRF.\nSe esses par√™metros n√£o estiverem na URL, retornamos uma resposta de redirecionamento - para redirecionar o usu√°rio para a url de autentica√ß√£o.\nuiFunc \u0026lt;- function(req) {\rif (!has_auth_code(parseQueryString(req$QUERY_STRING), state)) {\rurl \u0026lt;- oauth2.0_authorize_url(api, app, scope = scope, state = state)\rredirect \u0026lt;- sprintf(\u0026quot;location.replace(\\\u0026quot;%s\\\u0026quot;);\u0026quot;, url)\rtags$script(HTML(redirect))\r} else {\rui\r}\r}\rCom isso, quando o usu√°rio tentar acessar o seu app pela URL direta, como ela n√£o ter√° o par√¢metro code, ent√£o o uiFunc vai redirecion√°-lo para a p√°gina de autentica√ß√£o. Quando o usu√°rio fizer a autentica√ß√£o, ele ser√° novamente redirecionado para a mesma URL, no entanto, o Auth0 ir√° incluir os par√¢metros code e state na requisi√ß√£o, fazendo que a fun√ß√£o uiFunc retorne a UI regular do Shiny, e n√£o o redirecionamento.\n\rConstruindo o server\rVamos definir o server da forma a seguir. Lembre-se que se voc√™ estiver usando arquivos separados para ui e server, n√£o precisar√° colocar a atribui√ß√£o server \u0026lt;-.\nserver \u0026lt;- function(input, output, session) {\rparams \u0026lt;- parseQueryString(isolate(session$clientData$url_search))\rif (!has_auth_code(params, state)) {\rreturn()\r}\rtoken \u0026lt;- oauth2.0_token(\rapp = app,\rendpoint = api,\rcredentials = oauth2.0_access_token(api, app, params$code),\rcache = FALSE,\ruser_params = list(grant_type = \u0026quot;authorization_code\u0026quot;)\r)\rresp \u0026lt;- GET(\u0026quot;https://dfalbel.auth0.com/userinfo\u0026quot;, config(token = token))\routput$code \u0026lt;- renderPrint(content(resp, \u0026quot;text\u0026quot;))\r}\rAgora vamos explicar passo a passo da fun√ß√£o server. Nas linhas abaixo estamos obtendo os par√¢metros da Query String e em seguida verificamos se existe um par√¢metro code e se o state retornado √© o mesmo que enviamos para o Auth0 (usando a fun√ß√£o has_auth_code). Se esses par√¢metros n√£o estiverem corretos fazemos o server parar retornando vazio.\nparams \u0026lt;- parseQueryString(isolate(session$clientData$url_search))\rif (!has_auth_code(params, state)) {\rreturn()\r}\rEm seguida, dado que existe um par√¢metro code, vamos requisitar o token de autoriza√ß√£o do OAuth. Isso verifica que o code que temos √© v√°lido. No caso de o par√¢metro code n√£o ser v√°lido, a fun√ß√£o oauth2.0_token retorna um erro parando a execu√ß√£o do server. Fazemos isso da seguinte forma:\ntoken \u0026lt;- oauth2.0_token(\rapp = app,\rendpoint = api,\rcredentials = oauth2.0_access_token(api, app, params$code),\rcache = FALSE,\ruser_params = list(grant_type = \u0026quot;authorization_code\u0026quot;)\r)\rNesse momento, se a autentica√ß√£o tiver ocorrido corretamente voc√™ ter√° um objeto token que deve ser enviado junto com as suas pr√≥ximas requisi√ß√µes para obter informa√ß√µes sobre o usu√°rio.\nUm exemplo do que podemos obter √© usar o endpoint userinfo para obter informa√ß√µes sobre o perfil do usu√°rio logado. Voc√™ poderia usar essas informa√ß√µes para personalizar o app.\nresp \u0026lt;- GET(\u0026quot;https://dfalbel.auth0.com/userinfo\u0026quot;, config(token = token))\rprint(content(resp, \u0026quot;parsed\u0026quot;))\r# $sub\r# [1] \u0026quot;google-oauth2|ashjkdhique92392\u0026quot;\r# # $given_name\r# [1] \u0026quot;Daniel\u0026quot;\r# # $family_name\r# [1] \u0026quot;Falbel\u0026quot;\r# # $nickname\r# [1] \u0026quot;dfalbel\u0026quot;\r# # $name\r# [1] \u0026quot;Daniel Falbel\u0026quot;\r# # $picture\r# [1] \u0026quot;https://lh6.googleusercontent.com/-KAr2tY871g4/AAAAAAAAAAI/AAAAAAAANMw/ZK4kajskakvs_5ftmk/photo.jpg\u0026quot;\r# # $gender\r# [1] \u0026quot;male\u0026quot;\r# # $locale\r# [1] \u0026quot;pt-BR\u0026quot;\r# # $updated_at\r# [1] \u0026quot;2018-09-24T17:44:49.768Z\u0026quot;\r\r\rMais op√ß√µes do Auth0\rNo Auth0 existem diversas op√ß√µes de login que podem ser configuradas na aba Connections.\nVoc√™ tamb√©m pode impedir que as pessoas se cadastrem no seu app (somente o administrador pode cadastrar usu√°rios) - assim voc√™ restringe as pessoas que podem acessar o seu app. Isso pode ser feito na aba Connections \u0026gt; Database e em seguida desabilitando o Sign up\nVoc√™ poderia ainda conectar o Auth0 com diret√≥rios de autentica√ß√£o como LDAP, comuns no mundo corporativo.\n\rDisclaimer\rN√£o somos especialistas em seguran√ßa portanto usem esse c√≥digo com desconfian√ßa e sempre perguntem a um especialista antes de usar em ambiente de produ√ß√£o.\n\rAgradecimentos\rEsse post n√£o teria sido poss√≠vel sem a ajuda do Jos√© de Jesus Filho que nos apresentou a solu√ß√£o depois de muito tempo explorando diversas formar de criar autentica√ß√£o para seus Shiny‚Äôs.\n\r","permalink":"https://blog.curso-r.com/posts/2018-09-24-shiny-auth0/","tags":["shiny"],"title":"Autentica√ß√£o no Shiny com Auth0"},{"author":["Julio"],"categories":["conceitos"],"contents":"\r\r\r\r\r\r\r\rVoc√™ est√° num jogo na TV e o apresentador pede para escolher uma entre 3 portas. Atr√°s de uma dessas portas tem uma Ferrari e nas outras duas temos cabras. Voc√™ escolhe uma porta. Depois, o apresentador retira uma porta que tem uma cabra e pergunta: voc√™ quer trocar de porta?\nA princ√≠pio, voc√™ pode achar que sua probabilidade de ganhar √© 1/2, j√° que uma das portas foi retirada, ent√£o n√£o importa se voc√™ troca ou n√£o. Mas a resposta √© que sim, vale √† pena trocar de porta! A probabilidade de vencer o jogo trocando a porta √© de 2/3.\n\r\rFigura 1: Brincadeira do XKCD.\r\r\rO problema de Monty Hall √© talvez o mais eloquente exemplo de como a probabilidade pode confundir a mente humana. Esse problema desafiou a comunidade cient√≠fica no final do s√©culo XX e chegou at√© a ser considerado um paradoxo. Recomendo ler o livro O Andar do B√™bado, de Leonard Mlodinow, que conta essa e muitas outras hist√≥rias interessantes sobre a probabilidade.\nExistem v√°rias formas de explicar por qu√™ trocar a porta √© a melhor estrat√©gia. A que eu mais gosto √© a do pr√≥prio Andar do B√™bado, que mostra que, quando voc√™ escolhe a primeira porta, voc√™ est√° apostando se acertou ou n√£o a Ferrari. Se voc√™ apostar que acertou a Ferrari, n√£o deve trocar a porta e, se voc√™ apostar que errou a Ferrari, deve trocar. A aposta de errar a Ferrari de primeira tem probabilidade 2/3, logo, vale √† pena trocar.\nNesse post, mostramos uma solu√ß√£o alternativa, simples e elegante para o problema usando diagramas de influ√™ncia e o pacote bnlearn.\nRedes bayesianas\rAs redes Bayesianas s√£o o resultado da combina√ß√£o de conceitos probabil√≠sticos e conceitos da teoria dos grafos. Segundo Pearl, tal uni√£o tem como consequ√™ncias tr√™s benef√≠cios: i) prover formas convenientes para expressar suposi√ß√µes do modelo; ii) facilitar a representa√ß√£o de fun√ß√µes de probabilidade conjuntas; e iii) facilitar o c√°lculo eficiente de infer√™ncias a partir de observa√ß√µes.\nDa teoria de probabilidades precisamos apenas de alguns resultados b√°sicos sobre probabilidade condicional. Primeiramente, pela defini√ß√£o de probabilidade condicional, sabemos que\n\\[\rp(x_1, x_2) = p(x_1)p(x_2|x_1).\r\\]\nAplicando essa regra iterativamente para \\(n\\) vari√°veis, temos\n\\[\rp(x_1, \\dots, x_p) = \\prod_j p(x_j|x_1,\\dots, x_{j-1}).\r\\]\nAgora, imagine que, no seu problema, a vari√°vel aleat√≥ria \\(X_j\\) n√£o dependa probabilisticamente de todas as vari√°veis \\(X_1,\\dots, X_{j-1}\\), e sim apenas de um subconjunto \\(\\Pi_j\\) dessas vari√°veis. Fazendo isso, a equa√ß√£o pode ser escrita como\n\\[\rp(x_1, \\dots, x_p) = \\prod_j p(x_j|\\pi_j).\r\\]\nChamamos \\(\\Pi_j\\) de pais de \\(X_j\\). Esse conjunto pode ser pensado como as vari√°veis que s√£o suficientes para determinar as probabilidades de \\(X_j\\).\nA parte mais legal das redes Bayesianas √© que elas podem ser representadas a partir de DAGs (grafos direcionados ac√≠clicos). No grafo, se \\(X_1\\) aponta para \\(X_2\\), ent√£o \\(X_1\\) √© pai de \\(X_2\\). Por exemplo, esse grafo aqui\n\r\r{\"x\":{\"diagram\":\"\\ngraph LR;\\nA(X1Esta√ß√£o do ano)--B(X2Regador ligado)\\nA--C(X3Choveu)\\nB--D(X4Ch√£o Molhado)\\nC--D\\nD--E(X5Ch√£o Escorregadio)\\n\"},\"evals\":[],\"jsHooks\":[]}\r\rrepresenta a distribui√ß√£o de probabilidades \\(p(x_1, \\dots, x_5)\\) com\n\\[\rp(x_1, \\dots, x_5) = p(x_1)p(x_2|x_1)p(x_3|x_1)p(x_4|x_3,x_2)p(x_5|x_4).\r\\]\n\rDiagrama de influ√™ncias\rUm diagrama e influ√™ncias √© uma rede Bayesiana com n√≥s de decis√£o e utilidade (ganhos). Ou seja, √© uma jun√ß√£o de tr√™s conceitos:\n\\[\r\\underbrace{\\text{prob. condicional} + \\text{grafos}}_{\\text{rede Bayesiana}} + \\text{teoria da decis√£o} = \\text{diagrama de influ√™ncias}\r\\]\nNa teoria da decis√£o, usualmente estamos interessados em maximizar a utilidade esperada. No diagrama, considerando a estrutura de probabilidades dada pela rede Bayesiana e as informa√ß√µes dispon√≠veis, queremos escolher a decis√£o que faz com que, em m√©dia, nosso retorno seja mais alto.\nCom diagramas de influ√™ncias, √© poss√≠vel organizar sistemas complexos com m√∫ltiplas decis√µes, considerando diferentes conjuntos de informa√ß√µes dispon√≠veis. √â uma ferramenta realmente muito poderosa.\n\rVoltando ao Monty Hall\rAgora que sabemos um pouquinho de diagramas de influ√™ncia, podemos desenhar o do Monty Hall:\n\r\r{\"x\":{\"diagram\":\"\\ngraph LR;\\nA{D1Escolha inicial}--B(X2Porta retirada);\\nC(X1Ferrari)--B;\\nB--D{D2Trocar porta};\\nD--E[U1Ganhar]\\nC--E\\nA--E\\n\"},\"evals\":[],\"jsHooks\":[]}\r\rO jogador tem duas decis√µes a tomar:\n\r\\(D_1\\) (escolha_inicial): A escolha da porta inicial (1, 2, 3).\r\\(D_2\\) (trocar): Trocar a porta ou n√£o (s, n).\r\rTamb√©m temos duas fontes de incerteza:\n\r\\(X_1\\) (ferrari): Em qual porta est√° a Ferrari (1, 2, 3).\r\\(X_2\\) (porta_retirada): Qual porta foi retirada (1, 2, 3). Essa vari√°vel n√£o √© sempre aleat√≥ria: se eu escolho a porta 1 e a Ferrari est√° em 2, o apresentador √© obrigado a retirar a porta 3. Se o apresentador tiver a op√ß√£o de escolher (que acontece no caso da escolha inicial ser a Ferrari), o apresentador escolhe uma porta para retirar aleatoriamente.\r\rFinalmente, temos um n√≥ de utilidade:\n\r\\(U_1\\) (result): Ganhei a Ferrari (ganhei, perdi).\r\rEm R, podemos construir a rede Bayesiana do problema utilizando o pacote bnlearn:\n# n√≥s do grafo\rnodes \u0026lt;- c(\u0026quot;escolha_inicial\u0026quot;, \u0026quot;ferrari\u0026quot;, \u0026quot;porta_retirada\u0026quot;, \u0026quot;trocar\u0026quot;, \u0026quot;result\u0026quot;)\r# matriz de adjac√™ncias\redges \u0026lt;- matrix(\rc(\u0026quot;escolha_inicial\u0026quot;, \u0026quot;porta_retirada\u0026quot;,\r\u0026quot;ferrari\u0026quot;, \u0026quot;porta_retirada\u0026quot;,\r\u0026quot;porta_retirada\u0026quot;, \u0026quot;trocar\u0026quot;,\r\u0026quot;trocar\u0026quot;, \u0026quot;result\u0026quot;,\r\u0026quot;ferrari\u0026quot;, \u0026quot;result\u0026quot;,\r\u0026quot;escolha_inicial\u0026quot;, \u0026quot;result\u0026quot;),\rncol = 2, byrow = TRUE)\redges\r## [,1] [,2] ## [1,] \u0026quot;escolha_inicial\u0026quot; \u0026quot;porta_retirada\u0026quot;\r## [2,] \u0026quot;ferrari\u0026quot; \u0026quot;porta_retirada\u0026quot;\r## [3,] \u0026quot;porta_retirada\u0026quot; \u0026quot;trocar\u0026quot; ## [4,] \u0026quot;trocar\u0026quot; \u0026quot;result\u0026quot; ## [5,] \u0026quot;ferrari\u0026quot; \u0026quot;result\u0026quot; ## [6,] \u0026quot;escolha_inicial\u0026quot; \u0026quot;result\u0026quot;\r# criando o grafo a partir de um grafo vazio\rg \u0026lt;- bnlearn::empty.graph(nodes)\rbnlearn::arcs(g) \u0026lt;- edges\rO output desse conjunto de opera√ß√µes √© um objeto do tipo bn com v√°rias propriedades pr√© calculadas pelo pacote bnlearn:\ng\r Random/Generated Bayesian network\rmodel:\r[escolha_inicial][ferrari][porta_retirada|escolha_inicial:ferrari][trocar|porta_retirada]\r[result|escolha_inicial:ferrari:trocar]\rnodes: 5 arcs: 6 undirected arcs: 0 directed arcs: 6 average markov blanket size: 3.60 average neighbourhood size: 2.40 average branching factor: 1.20 generation algorithm: Empty \rCom as especifica√ß√£o do problema dada, se gerarmos aleatoriamente todos os cen√°rios, chegamos √† essa combina√ß√£o de casos equiprov√°veis (ver Extra 2)\nAgora, vamos escrever todas as combina√ß√µes poss√≠veis de cen√°rios e guardar num data.frame chamado dados:\n\r\rescolha_inicial\rferrari\rporta_retirada\rtrocar\rresult\r\r\r\r1\r1\r2\rn\rganhei\r\r1\r1\r2\rs\rperdi\r\r1\r1\r3\rn\rganhei\r\r1\r1\r3\rs\rperdi\r\r1\r2\r3\rn\rperdi\r\r1\r2\r3\rs\rganhei\r\r1\r3\r2\rn\rperdi\r\r1\r3\r2\rs\rganhei\r\r2\r1\r3\rn\rperdi\r\r2\r1\r3\rs\rganhei\r\r2\r2\r1\rn\rganhei\r\r2\r2\r1\rs\rperdi\r\r2\r2\r3\rn\rganhei\r\r2\r2\r3\rs\rperdi\r\r2\r3\r1\rn\rperdi\r\r2\r3\r1\rs\rganhei\r\r3\r1\r2\rn\rperdi\r\r3\r1\r2\rs\rganhei\r\r3\r2\r1\rn\rperdi\r\r3\r2\r1\rs\rganhei\r\r3\r3\r2\rn\rganhei\r\r3\r3\r2\rs\rperdi\r\r3\r3\r1\rn\rganhei\r\r3\r3\r1\rs\rperdi\r\r\r\rFinalmente, ajustamos nossa rede Bayesiana, usando a fun√ß√£o bnlearn::bn.fit().\nfit \u0026lt;- bnlearn::bn.fit(g, dados)\rA fun√ß√£o bnlearn::cpquery() (conditional probability query) serve para realizar uma consulta de probabilidades dada a rede ajustada. No nosso caso, a partir de uma escolha inicial qualquer \\(d_1\\), queremos saber o ganho ao trocar √© maior que o ganho ao n√£o trocar.\n\\[\r\\mathbb E(U_1\\; |\\; D_2 = \\text{s}, D_1 = d_1) \u0026gt; \\mathbb E(U_1\\; |\\; D_2 = \\text{n}, D_1 = d_1).\r\\]\nFazendo contas, isso equivale matematicamente a consultar se\n\\[\r\\mathbb P(U_1=\\text{ganhei}\\; |\\; D_2 = \\text{s}) \u0026gt; \\mathbb P(U_1=\\text{ganhei}\\; |\\; D_2 = \\text{n})\r\\]\nAgora, podemos consultar \\(\\mathbb P(U_1=\\text{ganhei}\\; |\\; D_2 = \\text{s})\\) com nosso modelo!\nset.seed(13) # reprodutibilidade\rbnlearn::cpquery(\rfitted = fit, event = (result == \u0026quot;ganhei\u0026quot;), # o que queremos saber?\revidence = (trocar == \u0026quot;s\u0026quot;), # qual informa√ß√£o adicionar?\rn = 5e6) # n grande para aumentar a precis√£o\r[1] 0.6666704\rE n√£o √© que d√° 2/3 mesmo? Da mesma forma, temos\nbnlearn::cpquery(fit, (result == \u0026quot;ganhei\u0026quot;), (trocar == \u0026quot;n\u0026quot;), n = 5e6)\r[1] 0.3333187\rResolvido!\n\rWrap-up\r\rVale √† pena trocar a porta!\rRedes Bayesianas juntam grafos e probabilidades condicionais\rDiagramas de influ√™ncia juntam redes Bayesianas e teoria da decis√£o\rEssas ferramentas podem ser utilizadas tanto para resolver Monty Hall quanto para ajudar em sistemas complexos.\r\r√â isso pessoal. Happy coding ;)\nExtra\rSe voc√™ ficou interessada em como eu fiz o diagrama, utilizei o pacote DiagrammeR. O c√≥digo est√° aqui:\ndiagrama \u0026lt;- \u0026quot;\rgraph LR;\rA{D1Escolha inicial}--\u0026gt;B(X2Porta retirada);\rC(X1Ferrari)--\u0026gt;B;\rB--\u0026gt;D{D2Trocar porta};\rD--\u0026gt;E[U1Ganhar]\rC--\u0026gt;E\rA--\u0026gt;E\r\u0026quot;\r# tweak para centralizar e grifar as vari√°veis\rdiagrama \u0026lt;- stringr::str_replace_all(\rdiagrama, pattern = \u0026quot;([XDU][0-9])\u0026quot;, replacement = \u0026quot;\u0026lt;center\u0026gt;\u0026lt;b\u0026gt;\\\\1\u0026lt;/b\u0026gt;\u0026lt;/center\u0026gt;\u0026lt;br/\u0026gt;\u0026quot;)\rDiagrammeR::DiagrammeR(diagrama)\r\rExtra 2\r√â poss√≠vel simular os dados que coloquei no post com uma fun√ß√£o simples, que adicionei abaixo. Na verdade, o fato de eu ter considerado somente as combina√ß√µes √∫nicas de cen√°rios e n√£o os dados simulados abaixo √© um pouco roubado, e s√≥ funciona porque os cen√°rios calham de ser, de fato, equiprov√°veis.\nset.seed(13)\rsimular_monty_hall \u0026lt;- function(z = 0) {\rv \u0026lt;- 1:3 # opcoes\rescolha_inicial \u0026lt;- sample(v, 1) # escolha inicial aleatoria\rferrari \u0026lt;- sample(v, 1) # ferrari aleatoria\r# qual porta retirar?\rif (escolha_inicial == ferrari) {\rporta_retirada \u0026lt;- sample(setdiff(v, ferrari), 1)\r} else {\rporta_retirada \u0026lt;- setdiff(v, c(escolha_inicial, ferrari))\r}\r# trocar porta?\rtrocar \u0026lt;- sample(c(\u0026quot;s\u0026quot;, \u0026quot;n\u0026quot;), 1)\r# calculando resultado\rif (trocar == \u0026quot;s\u0026quot;) {\rescolha_final \u0026lt;- setdiff(v, c(escolha_inicial, porta_retirada))\r} else {\rescolha_final \u0026lt;- escolha_inicial\r}\rresult \u0026lt;- ifelse(escolha_final == ferrari, \u0026quot;ganhei\u0026quot;, \u0026quot;perdi\u0026quot;)\r# guardando no BD\rtibble::tibble(escolha_inicial, ferrari, porta_retirada, trocar, result)\r}\rdados_simulados \u0026lt;- purrr::map_dfr(seq_len(1e4), simular_monty_hall) %\u0026gt;% dplyr::mutate_all(as.factor)\rdplyr::glimpse(dados_simulados)\rObservations: 10,000\rVariables: 5\r$ escolha_inicial \u0026lt;fct\u0026gt; 3, 1, 2, 1, 1, 1, 3, 1, 2, 3, 3, 1, 3, 1, 2, 2, 2,...\r$ ferrari \u0026lt;fct\u0026gt; 1, 1, 2, 1, 1, 2, 3, 3, 1, 2, 3, 3, 2, 1, 1, 3, 1,...\r$ porta_retirada \u0026lt;fct\u0026gt; 2, 3, 1, 3, 2, 3, 2, 2, 3, 1, 1, 2, 1, 2, 3, 1, 3,...\r$ trocar \u0026lt;fct\u0026gt; n, s, s, n, s, n, n, n, n, s, s, s, s, n, n, s, n,...\r$ result \u0026lt;fct\u0026gt; perdi, perdi, perdi, ganhei, perdi, perdi, ganhei,...\rOs dados do post podem ser obtidos fazendo isso aqui:\ndados_simulados %\u0026gt;% dplyr::distinct() %\u0026gt;% dplyr::arrange(escolha_inicial, ferrari)\rAgradecimentos: Rafael Stern, que me convenceu de que vale √† pena mostrar os dados simulados üòâ\n\r\r","permalink":"https://blog.curso-r.com/posts/2018-09-03-monty-hall/","tags":["modelagem"],"title":"Monty hall e diagramas de influ√™ncia"},{"author":["Bruna Wundervald"],"categories":["tutoriais"],"contents":"\r\rCom uma frequ√™ncia di√°ria, eu me deparo com pessoas\rtendo d√∫vidas sobre a realiza√ß√£o de tarefas no R,\rem grupos de Facebook, Telegram, Twitter, e assim\rpor diante. Estas d√∫vidas tem duas principais fontes:\ndificuldades em construir o algoritmo para alcan√ßar o\rresultado desejado.\rdificuldades em entender como se d√° a utiliza√ß√£o de alguma fun√ß√£o.\r\rO foco deste post √© dar uma no√ß√£o sobre como podemos contornar\ro segundo problema: a utiliza√ß√£o das fun√ß√µes. Para dar um\rpouco de contexto, deve-se comentar que os pacotes do R s√£o\rconstru√≠dos pela comunidade, de forma volunt√°ria. Logo, nem\rtodas as documenta√ß√µes s√£o escritas de forma t√£o clara\rquanto necess√°rio, o que pode gerar confus√£o em rela√ß√£o a\r√† estrutura dos objetos que devem sem passados a uma fun√ß√£o, por exemplo.\rAtualmente, o CRAN exige um certo rigor no que diz\rrespeito ao bom funcionamento dos c√≥digos dos pacotes, mas\risso n√£o se aplica √† documenta√ß√£o das fun√ß√µes. Felizmente,\ressa situa√ß√£o est√° melhorando, o que pode ser observado com\ra exist√™ncia de recomenda√ß√µes como a que est√° a seguir,\rretirada do livro do Hadley sobre constru√ß√£o de pacotes:\nEnquanto as documenta√ß√µes n√£o s√£o perfeitas, os usu√°rios precisam\rbuscar entender os erros inesperados em suas tarefas de outras formas.\rO m√©todo que eu vou descrever agora consiste basicamente em olhar o c√≥digo\rda fun√ß√£o e procurar nele aonde est√° a fonte causadora de problemas.\nExistem fun√ß√µes que podem ser diretamente visualizadas no console,\rapenas imprimindo seu nome sem os par√™nteses () finais, por exemplo:\nsoma \u0026lt;- function(x, y){\rz \u0026lt;- x + y\rz\r}\rsoma\r## function(x, y){\r## z \u0026lt;- x + y\r## z\r## }\rAssim, s√≥ de rodar o nome da fun√ß√£o podemos saber qual √© o c√≥digo\rque a comp√µe. Se eu tentar fazer, por exemplo:\nsoma(2, \u0026quot;1\u0026quot;)\rTemos o erro:\nError in x + y : argumento n√£o-num√©rico para operador bin√°rio\nCausado pelo ‚Äú1‚Äù ser um caractere e n√£o um n√∫mero, o que n√£o\rparece estar t√£o √≥bvio na mensagem. Copiamos o c√≥digo da\rfun√ß√£o e rodamos linha por linha dele, fornecendo os devidos argumentos,\rat√© encontrar o erro:\nx \u0026lt;- 2\ry \u0026lt;- \u0026quot;1\u0026quot;\r# C√≥digo da fun√ß√£o soma\rz \u0026lt;- x + y\r## Error in x + y: non-numeric argument to binary operator\rEncontrando exatamente aonde o erro est√°, fica muito mais f√°cil entender\rqual √© o pr√≥vavel motivo do que apenas tentando interpretar a mensagem\rquando a fun√ß√£o n√£o roda. Muitas vezes, a quest√£o √© exatamente\rsobre objetos com a estrutura incorreta sendo usados, √© isso por acaso\rtamb√©m √© o que gera os erros mais estranhos.\nO exemplo acima √© com uma fun√ß√£o simples e curta. Comumente voc√™\rvai se deparar com fun√ß√µes grandes ou que, quando impressas no console,\rn√£o mostram o c√≥digo, e sim o seu qual m√©todo ela utiliza:\nmean\r## function (x, ...) ## UseMethod(\u0026quot;mean\u0026quot;)\r## \u0026lt;bytecode: 0x7fea5b839a88\u0026gt;\r## \u0026lt;environment: namespace:base\u0026gt;\rE o que isso significa? que essa √© uma fun√ß√£o gen√©rica da classe S3,\rque tem m√©todos para diferentes classes de objetos. Mas como assim?\nVamos usar o exemplo da fun√ß√£o mean, que √© usada para o calculo\rde m√©dias. Quais s√£o os tipos de objeto que podem ser usados\rnessa fun√ß√£o? Em geral, utilizamos vetores, mas ela consegue\rlidar com outros tipos, como datas. O que queremos dizer aqui\r√© que a mesma fun√ß√£o vai conseguir fazer sua tarefa com\robjetos diferentes, atrav√©s dos ‚Äúm√©todos‚Äù da fun√ß√£o mean.\rUm m√©todo √© uma fun√ß√£o associada com um tipo particular de\robjeto. Podemos verificar quais s√£o os m√©todos dispon√≠veis com:\nmethods(mean)\r## [1] mean.Date mean.default mean.difftime mean.POSIXct mean.POSIXlt ## [6] mean.quosure*\r## see \u0026#39;?methods\u0026#39; for accessing help and source code\r(dependendo do pacote, os m√©todos n√£o est√£o exportados. Se encontrar problemas com isso, experimente usar o operador :::. Por exemplo, dplyr:::filter.tbl_df)\nNesse caso, √© poss√≠vel ver o c√≥digo de um m√©todo espec√≠fico\rimprimindo n√£o s√≥ o nome da fun√ß√£o, mas a sua extens√£o com\ro m√©todo desejado:\nmean.default\r## function (x, trim = 0, na.rm = FALSE, ...) ## {\r## if (!is.numeric(x) \u0026amp;\u0026amp; !is.complex(x) \u0026amp;\u0026amp; !is.logical(x)) {\r## warning(\u0026quot;argument is not numeric or logical: returning NA\u0026quot;)\r## return(NA_real_)\r## }\r## if (na.rm) ## x \u0026lt;- x[!is.na(x)]\r## if (!is.numeric(trim) || length(trim) != 1L) ## stop(\u0026quot;\u0026#39;trim\u0026#39; must be numeric of length one\u0026quot;)\r## n \u0026lt;- length(x)\r## if (trim \u0026gt; 0 \u0026amp;\u0026amp; n) {\r## if (is.complex(x)) ## stop(\u0026quot;trimmed means are not defined for complex data\u0026quot;)\r## if (anyNA(x)) ## return(NA_real_)\r## if (trim \u0026gt;= 0.5) ## return(stats::median(x, na.rm = FALSE))\r## lo \u0026lt;- floor(n * trim) + 1\r## hi \u0026lt;- n + 1 - lo\r## x \u0026lt;- sort.int(x, partial = unique(c(lo, hi)))[lo:hi]\r## }\r## .Internal(mean(x))\r## }\r## \u0026lt;bytecode: 0x7fea596dfc10\u0026gt;\r## \u0026lt;environment: namespace:base\u0026gt;\rVoltando ao descobrimento dos erros. Digamos que n√≥s rodamos o\rseguinte peda√ßo de c√≥digo, que vai dar um erro:\nmean(c(\u0026quot;1\u0026quot;, 3))\r## Warning in mean.default(c(\u0026quot;1\u0026quot;, 3)): argument is not numeric or logical:\r## returning NA\r## [1] NA\rNote que isso n√£o √© um erro e sim um warning. Mas certamente n√£o √© esse o resultado que gostar√≠amos, e o valor num√©rico 2, que √© a m√©dia entre 1 e 3.\nAgora, a mensagem √© mais explic√≠ta, mas podemos encontrar\ro problema diretamente na fun√ß√£o, usando o c√≥digo da mean.default.\rComo vimos antes, a fun√ß√£o precisa de um vetor de entrada ‚Äúx‚Äù:\n# Definindo o objeto de entrada da fun√ß√£o\rx \u0026lt;- c(\u0026quot;1\u0026quot;, 3)\r# C√≥digo da mean.default if (!is.numeric(x) \u0026amp;\u0026amp; !is.complex(x) \u0026amp;\u0026amp; !is.logical(x)) {\rwarning(\u0026quot;argument is not numeric or logical: returning NA\u0026quot;)\rreturn(NA_real_)\r}\r## Warning: argument is not numeric or logical: returning NA\r## [1] NA\r# Paramos aqui porque o problema j√° foi encontrado\rLogo na primeira linha do c√≥digo da fun√ß√£o, j√° temos a\rindica√ß√£o do problema: o vetor passado n√£o √© do tipo num√©rico,\rcomplexo ou l√≥gico.\nPor qu√™ eu devo procurar entender os erros?\rEm linhas gerais, na minha experi√™ncia com a procura pelos erros\nde fun√ß√µes, eu sempre acabo aprendendo algo novo, como por\rexemplo justamente a corre√ß√£o do erro. A m√°xima do\r‚Äú√© errando que se aprende‚Äù √© altamente aplic√°vel nestes\rcasos. Os erros gerados pelas fun√ß√µes nos levam a procurar\rentend√™-los melhor, o que consequentemente leva a uma\rcompreens√£o aprimorada sobre l√≥gica de programa√ß√£o\re R em geral.\nAl√©m disso, √© bem mais eficiente desenvolver t√©cnicas para resolver seu\rpr√≥prio problema. N√£o √© raro que uma pergunta sobre R\rem grupos da internet demore pra ter resposta. Com uma\rbusca mais aprofundada pela fonte geradora do erro e sua\rconsequente solu√ß√£o, essa espera pode ser evitada (n√£o que\rseja errado fazer perguntas, claro).\nMais particularmente, eu posso comentar que, j√° que os\rpacotes do R s√£o feitos pela comunidade, existe uma grande\rdiversidade de formas de escrita de c√≥digo presente neles.\rAssim, o contato com essa diversidade me leva tanto a aprender\rmais sobre R como formas de refinar o escrita de c√≥digo.\n\rWrap-up\rNeste post, eu expliquei como fa√ßo para procurar\rerros em fun√ß√µes do R. Em geral, falamos sobre:\n\rcomos mostrar o c√≥digo fonte de fun√ß√µes simples na tela;\rcomo mostrar o c√≥digo fonte de fun√ß√µes da classe S3.\rcomo usar estes c√≥digos para identificar o erro;\rcomo podemos aprender com nossos pr√≥prios erros;\rcomo este m√©todo pode ser √∫til na economia de tempo com\ra resolu√ß√£o de erros;\r\r\r","permalink":"https://blog.curso-r.com/posts/2018-09-03-funcoes/","tags":["debug"],"title":"Uma forma de encontrar erros no R"},{"author":["Julio"],"categories":["discuss√µes"],"contents":"\r\rA pesquisa eleitoral √© a forma mais comum de conectar a popula√ß√£o geral com conceitos b√°sicos de estat√≠stica, como amostragem e infer√™ncia. Por isso, a descren√ßa nas pesquisas eleitorais pode levar √† descren√ßa na estat√≠stica como um todo. Isso √© prejudicial para nossos profissionais e, consequentemente, para a sociedade.\nUma discuss√£o frequente em debates, redes sociais e conversas de bar √© a validade de pesquisas eleitorais. No Brasil, existe uma sensa√ß√£o de descren√ßa nas pesquisas, j√° que, historicamente, elas erraram os resultados de v√°rias elei√ß√µes.\nMas ser√° que a compara√ß√£o de resultados de pesquisas eleitorais e resultados de elei√ß√µes √© correta? Nesse artigo, argumentarei que n√£o e darei uma ideia de como isso poderia funcionar na pr√°tica.\nPesquisas eleitorais: duas culturas\rLeo Breiman, em seu famoso artigo de 2001, discorre sobre a exist√™ncia de duas culturas entre estat√≠sticos: a voltada para modelagem de dados e a voltada para modelagem algor√≠tmica. A primeira est√° interessada em compreender o mecanismo gerador dos dados observados, enquanto a segunda est√° interessada em predizer um conjunto de outputs a partir de um conjunto de inputs.\nDo ponto de vista matem√°tico, essas culturas est√£o intimamente relacionadas e diferem somente com rela√ß√£o √† fun√ß√£o de perda que se quer minimizar. Na pr√°tica, no entanto, isso gera muito atrito na comunidade cient√≠fica e √© o que est√° por tr√°s da maior parte dos debates sobre estat√≠stica vs machine learning.\nCuriosamente, o principal problema na interpreta√ß√£o de pequisas eleitorais est√° relacionado com as duas culturas. Considere as seguintes perguntas:\nSe a elei√ß√£o fosse hoje, qual seria a propor√ß√£o de votos do candidato \\(A\\)?\rQual a probabilidade do candidato \\(A\\) ganhar a elei√ß√£o?\r\rA principal afirma√ß√£o desse artigo √© a seguinte:\n\rPesquisas eleitorais t√™m como objetivo responder (1), mas a sociedade as usa para responder (2).\n\rPesquisas eleitorais s√£o levantamentos de inten√ß√£o de voto. Seu objetivo √© entender as opini√µes da sociedade sobre os candidatos, hoje. O objetivo n√£o √© predizer qual ser√° o resultado da elei√ß√£o.\nIsso significa que utilizar resultados de elei√ß√µes para avaliar a qualidade das pesquisas √© uma compara√ß√£o, no m√≠nimo, injusta. √â como avaliar a qualidade de um livro pela sua capacidade de servir como peso de papel, uma vez que esta n√£o √© sua finalidade.\n\rPesquisas eleitorais podem ser utilizadas para predizer elei√ß√µes?\rClaro que sim! Modelos estat√≠sticos sempre t√™m propriedades preditivas. Um modelo preditivo para as elei√ß√µes, no entanto, deve utilizar muito mais informa√ß√µes do que apenas as inten√ß√µes de voto dos eleitores. Alguns exemplos de dados adicionais que poderiam ser utilizados:\n\rPodemos tratar indecisos como dados faltantes. Utilizando pesquisas anteriores, podemos estimar a propor√ß√£o de indecisos que votar√£o em cada candidato, ao inv√©s de simplesmente descartar os dados dos indecisos.\rHistoricamente, sabemos que a propor√ß√£o de brancos e nulos observada nas urnas √© diferente do que as pessoas afirmam nas pesquisas. Podemos utilizar esse dado para predizer a propor√ß√£o de votos brancos e nulos.\rEm determinadas regi√µes, as pessoas mudam o voto de √∫ltima hora, possivelmente por a√ß√µes ilegais como propaganda em boca de urna. Podemos utilizar essa informa√ß√£o para ponderar as estimativas obtidas nas pesquisas eleitorais.\rPodemos utilizar os dados de diversas pesquisas eleitorais ao mesmo tempo, dando pesos diferentes para elas, para predizer os resultados da elei√ß√£o.\r\rEsses exemplos n√£o s√£o exaustivos. Existem muitas outras formas de considerar todo o conhecimento que temos em nossas predi√ß√µes sobre as elei√ß√µes.\n\rComo podemos avaliar pesquisas eleitorais?\rPesquisas de inten√ß√£o de voto s√≥ podem ser avaliadas atrav√©s da metodologia e da execu√ß√£o. Existem diversos par√¢metros para levar em conta, como:\n\rMetodologia de listagem dos indiv√≠duos da amostra: discuss√µes como amostragem probabil√≠stica ou amostragem por cotas.\rMetodologia de acesso aos respondentes: discuss√µes como ponto de fluxo, pesquisa em domic√≠lio ou pesquisa por telefone.\rTratamento da n√£o resposta: discuss√µes sobre auto sele√ß√£o.\rVerifica√ß√£o das respostas: t√©cnicas para evitar manipula√ß√£o de resultados e fraudes na coleta de dados.\r\rO problema √© que a avalia√ß√£o das pesquisas sempre acaba sendo subjetiva. Por exemplo, sempre √© poss√≠vel argumentar que uma pesquisa √© ruim por n√£o ter utilizado amostragem aleat√≥ria simples (AAS) para realiza√ß√£o do estudo, o que gera um debate incessante.\nAssim, me parece que a forma mais adequada de avaliar pesquisas de inten√ß√£o de voto √© o atendimento a requisitos formais, como o clarifica√ß√£o sobre o m√©todo de condu√ß√£o do estudo. Isso pode ser atingindo com a disponibiliza√ß√£o de:\n\rDescri√ß√£o detalhada da metodologia.\rApresenta√ß√£o do question√°rio do estudo.\rBase de dados final utilizada e script ou lista de passos utilizados para reprodu√ß√£o dos resultados.\r\rO √∫nico crit√©rio estat√≠stico coerente para avaliar uma pesquisa eleitoral desse tipo seria a compara√ß√£o dos resultados da pesquisa com outras pesquisas que t√™m o mesmo objetivo. Por exemplo, se no dia 03 desse m√™s foram divulgadas dez pesquisas para presidente e uma das pesquisas coloca o candidato \\(A\\) com 15% de vantagem em rela√ß√£o √† m√©dia das dez pesquisas, existem evid√™ncias de que algo pode estar errado nesse levantamento.\nHoje em dia temos alguns agregadores de pesquisas eleitorais que podem ser utilizados para monitorar os resultados das pesquisas e avaliar a qualidade dos resultados. Os meus preferidos s√£o o do Agregador do JOTA, elaborado pelo Guilherme Jardim Duarte e o do Poder360, elaborado pelo Volt Data Lab.\n\rComo poder√≠amos mudar essa realidade?\rSe o interesse da sociedade est√° em (2), por qu√™ n√£o divulgar exatamente isso? Nos Estados Unidos, √© o que o famoso portal FiveThirtyEight se disp√¥s a fazer. Eles soltam predi√ß√µes peri√≥dicas dos resultados de elei√ß√µes e de eventos esportivos. No Brasil, iniciativas como o PollingData do Neale El-Dash fazem o mesmo, com diferentes metodologias.\nAvaliar a qualidade de estudos preditivos para responder (2) √© muito mais f√°cil. Bastaria comparar o resultado do estudo com os resultados das elei√ß√µes. O √∫nico cuidado seria o de, eventualmente, n√£o dar o mesmo peso para pesquisas mais antigas e mais recentes. Uma forma de fazer isso √© utilizando uma adapta√ß√£o dos scores de Brier:\n\\[\rB = \\frac{1}{N}\\sum_{t=1}^N\\sum_{i=1}^C p_t(f_{ti} - r_i)^2, \\]\nonde\n\r\\(C\\) √© o n√∫mero de candidatos.\r\\(N\\) √© a quantidade de pesquisas realizadas.\r\\(f_{ti}\\) √© a probabilidade de vit√≥ria do candidato \\(i\\) na data \\(t\\).\r\\(p_t\\) √© um peso para a predi√ß√£o realizada na data \\(t\\), com a propriedade \\(\\sum_{t=1}^N p_t = 1\\). Idealmente, se \\(t=N\\) √© a data mais pr√≥xima das elei√ß√µes, ent√£o \\(p_N \\geq p_{N-1} \\geq \\dots \\geq p_1\\), ou seja, √© dado maior peso para predi√ß√µes feitas perto das elei√ß√µes.\r\\(r_i\\) √© zero se o candidato \\(i\\) perdeu e um se o candidato \\(i\\) ganhou.\r\rMinha recomenda√ß√£o √© que o Tribunal Superior Eleitoral (TSE) defina algumas datas para divulga√ß√£o de estudos preditivos. Os institutos de pesquisa passariam a divulgar esses estudos nas datas especificadas e, com isso, seria poss√≠vel elaborar um ranking dos melhores institutos. Essa metodologia j√° √© utilizada pelo BACEN, por exemplo, para avaliar predi√ß√µes sobre a infla√ß√£o.\n\rWrap-up\r\rN√£o avalie pesquisas de inten√ß√£o de voto usando os resultados das elei√ß√µes.\rA avalia√ß√£o de qualidade de pesquisas de inten√ß√£o de voto deve se limitar a i) atendimento a crit√©rios formais e ii) compara√ß√£o com resultados de outras pesquisas realizadas no mesmo per√≠odo.\rEstudos preditivos de resultados de elei√ß√µes √© o que realmente responde ao que a popula√ß√£o quer saber.\rProponho que o TSE determine algumas datas para divulga√ß√£o de modelos preditivos e, posteriormente, fa√ßa um ranking dos melhores institutos.\r\rEu sei que o artigo √© pol√™mico, ent√£o por favor sejam gentis nos coment√°rios.\n√â isso pessoal. Happy Coding e n√£o esque√ßam de acessar o aplicativo pesqEle para monitorar as pesquisas eleitorais!\n\rErrata\rDepois de divulgar o texto, recebi algumas sugest√µes de melhorias. Agrade√ßo pelas contribui√ß√µes! Preferi colocar coment√°rios adicionais no lugar de substituir o texto original para n√£o causar confus√£o nos leitores. Segue abaixo.\n‚Äúelas erraram os resultados de v√°rias elei√ß√µes.‚Äù\r\rEssa frase est√° um pouco exagerada. Na verdade, muitas vezes o resultado de elei√ß√µes acompanha a tend√™ncia ajustada com o hist√≥rico de levantamentos das pesquisas eleitorais.\n‚Äúuma adapta√ß√£o dos scores de Brier‚Äù\r\rA f√≥rmula est√° ruim! Como os \\(p_t\\) somam 1, o \\(1/N\\) est√° a√≠ de bobeira. Ent√£o a f√≥rmula que eu sugiro √© essa aqui:\n\\[\rB = \\sum_{t=1}^N\\sum_{i=1}^C p_t(f_{ti} - r_i)^2, \\]\n‚Äúuma pesquisa √© ruim por n√£o ter utilizado amostragem aleat√≥ria simples (AAS)‚Äù\r\rQuando mencionei AAS, eu quis dizer amostragem probabil√≠stica. Acho que quase todos concordam que AAS √© p√©ssimo nesses casos por conta da abrang√™ncia territorial do Brasil, que torna essa metodologia inexequ√≠vel.\n‚Äúse no dia 03 desse m√™s foram divulgadas dez pesquisas‚Äù\r\rAqui √© melhor colocar ‚Äúse no per√≠odo X foram conduzidas dez pesquisas‚Äù. As pesquisas devem ser pareadas pelo per√≠odo de condu√ß√£o do levantamento das opini√µes, n√£o pela data de divulga√ß√£o.\nVoc√™ quer substituir pesquisas eleitorais por modelos preditivos?\r\rN√£o! Pesquisas eleitorais devem continuar existindo, at√© porqu√™ elas s√£o o input mais importante para modelos preditivos. A ideia do ranking √© que as empresas se voluntariem para competir. A √∫nica restri√ß√£o √© que elas devem enviar suas predi√ß√µes para o TSE em datas pr√©-definidas pelo √≥rg√£o. Se as datas de submiss√£o fossem diferentes, isso geraria uma competi√ß√£o injusta, pois o instituto A poderia usar a submiss√£o de B para melhorar sua predi√ß√£o.\n\r","permalink":"https://blog.curso-r.com/posts/2018-08-31-eleitorais/","tags":["elei√ß√µes"],"title":"N√£o use resultados de elei√ß√µes para avaliar pesquisas eleitorais"},{"author":["Athos","Daniel","Bruna Wundervald"],"categories":["divulga√ß√£o"],"contents":"\r\rArquivos com extens√£o .jpg guardam 5 coordenadas, que s√£o\rsuficientes para o computador entender e desenhar a imagem:\n\rx e y: s√£o as coordenadas cartesianas da imagem; e\rr, g e b: red, green e blue, respectivamente, que juntas formam cores.\r\rTodas as cores que conhecemos podem ser compostas pela combina√ß√£o dessas\rtr√™s cores. A intensidade de cada cor varia de 0 a 1. Para cada\rponto no plano (x,y) existe uma cor associada. Assim, uma imagem pode\rser representada por um banco de dados com 5 colunas (x, y,\rr, g e b) e cujo n√∫mero de linhas √© n√∫mero de pixels da imagem.\nObjetivos\r\rVerificar qual modelo entre regress√£o linear e √°rvores de decis√£o √© o\rmais adequado para recuperar a o componente azul da\rimagem purple_wave.jpg.\r\r\rVerificar qual modelo entre regress√£o linear e √°rvores de decis√£o √© o\rmais adequado para recuperar a o componente azul da\rimagem xadrez_colorido.jpg.\r\r\rComo come√ßar?\rCom aux√≠lio da fun√ß√£o readJPEG() do pacote jpeg, carregue uma das\rimagens no R e transforme para data.frame:\nlibrary(tidyverse)\rlibrary(jpeg)\r# carrega uma imagem jpeg no R\rdownload.file(\u0026quot;http://curso-r.comimages/posts/conteudo/desafio-recuperacao-img/purple_wave.webp\u0026quot;, destfile = \u0026quot;purple_wave.jpg\u0026quot;)\rimg \u0026lt;- readJPEG(\u0026quot;purple_wave.jpg\u0026quot;)\r# transforma o array da imagem em data.frame com infos de posicao (x,y)\r# e cor (r,g,b) dimens√µes da imagem\rimg_dim \u0026lt;- dim(img)\r# RGB para data.frame\rimg_df \u0026lt;- data.frame(\rx = rep(1:img_dim[2], each = img_dim[1]),\ry = rep(img_dim[1]:1, img_dim[2]),\rr = as.vector(img[,,1]),\rg = as.vector(img[,,2]),\rb = as.vector(img[,,3])\r) %\u0026gt;%\rmutate(cor = rgb(r, g, b),\rid = 1:n())\rDivida o data.frame em duas partes: uma com o azul (coluna b) e outra sem.\r- Parte 1) x, y, r, g\r- Parte 2) x, y, r, g, b\n# para reprodu√ß√£o\rset.seed(2018) # Parte 1) x, y, r, g\rimg_df_parte1 \u0026lt;- img_df %\u0026gt;% sample_frac(3/5) %\u0026gt;% # separando 3/5 do banco\rmutate(b_backup = b, # backup do azul original\rb = 0, # retirando o azul da imagem\rcor = rgb(r, g, b)) # cor da imagem sem o azul\r# Parte 2) x, y, r, g, b\rimg_df_parte2 \u0026lt;- img_df %\u0026gt;% filter(!id%in%img_df_parte1$id)\rVisualizando:\n# Imagem sem o azul\rggplot(data = img_df_parte1, aes(x = x, y = y)) + geom_point(colour = img_df_parte1$cor) +\rlabs(x = \u0026quot;x\u0026quot;, y = \u0026quot;y\u0026quot;, title = \u0026quot;Imagem sem B (azul)\u0026quot;) +\rcoord_fixed(ratio = 1) +\rtheme_bw()\rA sua tarefa √© recuperar o azul (que n√≥s apagamos da imagem) da Parte 1,\rutilizando modelos preditivos constru√≠dos com a Parte 2 (que ainda tem o azul!) para as duas imagens (xadrez_colorido e purple_wave).\n\rResultado\rO resultado desse desafio de dados ser√° publicado no blog no dia 24 de agosto! Boa sorte!\n\r","permalink":"https://blog.curso-r.com/posts/2018-08-09-desafio-recuperacao-imagem/","tags":["app","pacotes"],"title":"Desafio de Dados - Recupera√ß√£o de imagens"},{"author":["Daniel"],"categories":["divulga√ß√£o"],"contents":"\r\rO radix √© um formato do RMarkdown para publica√ß√µes t√©cnicas e ci√™nt√≠ficas. Esse template tem entre suas vantagens:\n\rUma fonte boa para leitura.\rAceita LaTeX, cita√ß√µes e footnotes.\rPermite posicionar as figuras de forma bastante flex√≠vel.\retc.\r\rO template baseado no formato usado no Distill Research Journal que √© uma revista cient√≠fica dedicada a artigos cient√≠ficos que explicam de forma clara e din√¢mica conceitos relacionados √† Machine Learning.\nPara come√ßar a usar o radix voc√™ precisa instalar o pacote radix que por enquanto s√≥ est√° dispon√≠vel pelo Github:\ndevtools::install_github(\u0026quot;rstudio/radix\u0026quot;)\rEm seguida basta criar um novo RMarkdown e adicionar o seguinte no cabe√ßalho de metadados:\n---\rtitle: \u0026quot;Radix for R Markdown\u0026quot;\rdescription: | Scientific and technical writing, native to the web\rdate: May 4, 2018\rauthor:\r- name: \u0026quot;JJ Allaire\u0026quot;\rurl: https://github.com/jjallaire\raffiliation: RStudio\raffiliation_url: https://www.rstudio.com\r- name: \u0026quot;Rich Iannone\u0026quot;\rurl: https://github.com/rich-iannone\raffiliation: RStudio\raffiliation_url: https://www.rstudio.com\r- name: \u0026quot;Yihui Xie\u0026quot;\rurl: https://github.com/yihui\raffiliation: RStudio\raffiliation_url: https://www.rstudio.com\rbibliography: biblio.bib\routput: radix::radix_article\r---\rAl√©m disso, e talvez o mais legal do radix √© que ele permite que voc√™ crie sites e blogs com conjuntos de artigos. N√£o vamos falar sobre isso nesse post mas, voc√™ pode ler mais na documenta√ß√£o do pacote.\nAlguns exemplos de sites que j√° est√£o feitos nesse formato s√£o:\n\rBlog do Tensorflow para R\rReproducible Finance\rR-Music\r\rE a√≠, o que acharam?\n","permalink":"https://blog.curso-r.com/posts/2018-07-27-radix/","tags":["r markdown"],"title":"radix: um template RMarkdown"},{"author":["Daniel","Bruna Wundervald"],"categories":["divulga√ß√£o"],"contents":"\r\rBem vindos √† primeira edi√ß√£o do Desafio de Dados.\nO pesqEle √© o reposit√≥rio oficial de pesquisas eleitorais disponibilizado pelo Tribunal Superior Eleitoral (TSE). L√° podemos encontrar diversas informa√ß√µes sobre as pesquisas registradas. D√° at√© para ver os question√°rios aplicados e a metodologia de coleta.\nO CONRE3 fez um pacote para o R que permite acessar esses dados de forma mais organizada. Leia mais sobre o pacote neste post do blog.\nJunto com o pacote, o CONRE3 fez tamb√©m um aplicativo em shiny, dispon√≠vel neste link.\nA ideia dessa primeira edi√ß√£o do Desafio de Dados √© replicar o mapa da p√°gina inicial do aplicativo que mostra a distribui√ß√£o de pesquisas eleitorais por estado do Brasil.\nOs dados podem ser obtidos rodando o trecho de c√≥digo abaixo:\n# devtools::install_github(\u0026quot;conre3/pesqEle\u0026quot;) # instala√ß√£o do pacote;\rlibrary(pesqEle)\rpe \u0026lt;- pesqEle_2018\rdplyr::glimpse(pe)\rO shapefile do mapa est√° dispon√≠vel no pacote ufshapes:\n# devtools::install_github(\u0026#39;jtrecenti/ufshape\u0026#39;) # instala√ß√£o do pacote;\rdf_uf \u0026lt;- ufshape::df_uf\rLinks sugeridos:\n\rGr√°ficos Miojo: Mapas tem√°ticos do Brasil em 3 minutos ou menos\rMaterial Curso-R\r\rO post com a solu√ß√£o ser√° publicado no dia 09-08-18.\n","permalink":"https://blog.curso-r.com/posts/2018-07-26-desafio-pesqele/","tags":["app","pacotes"],"title":"Desafio de Dados - PesqEle (parte I)"},{"author":["Julio","Bruna Wundervald"],"categories":["Tutoriais"],"contents":"\r\rHoje nosso amigo Marcio Chiara nos procurou pedindo ajuda pois n√£o estava conseguindo fazer o pacote Rfacebook funcionar. O problema estava logo no come√ßo: a autentica√ß√£o com a API do Facebook.\nO procedimento\rO procedimento b√°sico para autenticar no Facebook usando o pacote Rfacebook consiste em tr√™s passos:\nCrie um aplicativo no facebook developers:\r\rO aplicativo deve ser do tipo ‚ÄúLogin do Facebook‚Äù\rDepois de clicar em ‚ÄúConfigurar‚Äù, seleccione a plataforma ‚Äúweb‚Äù\r\rNo menu da esquerda, clique em Configura√ß√µes e obtenha o ID do Aplicativo e a Chave Secreta do Aplicativo.\r\rGuarde nos objetos client_id e client_secret. Exemplo:\r\rRodar Rfacebook::fbOAuth().\r\rExemplo (n√£o rode):\nclient_id \u0026lt;- \u0026quot;274017323361669\u0026quot;\rclient_secret \u0026lt;- \u0026quot;6ced33b11f41944e5a960f74c475a5fe\u0026quot;\rRfacebook::fbOAuth(client_id, client_secret)\r\rO erro\rO erro aparece ao rodar\nRfacebook::fbOAuth(client_id, client_secret, extended_permissions = TRUE)\rA op√ß√£o extended_permissions serve para dar acesso √† algumas op√ß√µes adicionais como anivers√°rio, cidade de nascimento, etc. O erro que aparece √© esse aqui:\nComo somos pessoas espertinhas, o que fizemos? Abrimos os links que o Facebook sugeriu? Re-estudamos toda a API do Facebook? N√£o! Apenas lemos e interpretamos o erro. A API estava recusando acesso √†s op√ß√µes user_relationships e publish_actions, que s√£o requeridas por meio da fun√ß√£o Rfacebook::fbOAuth(). Aha!\nDepois de estudar um pouquinho, notamos que a API do Facebook mudou recentemente. Isso ocorreu por conta de altera√ß√µes na pol√≠tica de privacidade do Facebook, que √© sempre algo pol√™mico. Hoje em dia n√£o √© mais poss√≠vel autorizar aplicativos para terem acesso √† rede de relacionamentos e a√ß√µes do usu√°rio.\nO problema √© que infelizmente o mantenedor do Rfacebook parou de atualizar o pacote:\nEnt√£o, o que fazer? Quando temos uma ferramenta que n√£o funciona mais ou que est√° obsoleta, podemos i) jogar fora e fazer outra do zero ou ii) tentar arrum√°-la para ficar top novamente.\nPor sorte, o R √© open-source e permite que (ii) seja feito sem maiores esfor√ßos. De fato, basta mudar uma linha de c√≥digo para que tudo volte a funcionar como antes. Basta mudar o objeto scope de\nscope \u0026lt;- c(\u0026quot;user_birthday\u0026quot;, \u0026quot;user_hometown\u0026quot;, \u0026quot;user_location\u0026quot;, \u0026quot;user_relationships\u0026quot;, \u0026quot;publish_actions\u0026quot;, \u0026quot;user_status\u0026quot;, \u0026quot;user_likes\u0026quot;)\rpara\nscope \u0026lt;- c(\u0026quot;user_birthday\u0026quot;, \u0026quot;user_hometown\u0026quot;, \u0026quot;user_location\u0026quot;, \u0026quot;user_status\u0026quot;, \u0026quot;user_likes\u0026quot;)\r\rA solu√ß√£o\rCom base nessas altera√ß√µes, a Bruna sugere a utiliza√ß√£o da fun√ß√£o modificada abaixo:\nnew_fbOAuth \u0026lt;- function (app_id, app_secret, extended_permissions = FALSE, legacy_permissions = FALSE, scope = NULL) {\rfacebook \u0026lt;- oauth_endpoint(authorize = \u0026quot;https://www.facebook.com/dialog/oauth\u0026quot;, access = \u0026quot;https://graph.facebook.com/oauth/access_token\u0026quot;)\rmyapp \u0026lt;- oauth_app(\u0026quot;facebook\u0026quot;, app_id, app_secret)\rif (is.null(scope)) {\rif (extended_permissions == TRUE) {\r# as altera√ß√µes significativas est√£o aqui \u0026gt;\u0026gt;\u0026gt;\rscope \u0026lt;- c(\u0026quot;user_birthday\u0026quot;, \u0026quot;user_hometown\u0026quot;, \u0026quot;user_location\u0026quot;, # \u0026quot;user_relationships\u0026quot;, \u0026quot;publish_actions\u0026quot;, \u0026quot;user_status\u0026quot;, \u0026quot;user_likes\u0026quot;)\r} else {\rscope \u0026lt;- c(\u0026quot;public_profile\u0026quot;, \u0026quot;user_friends\u0026quot;)\r}\rif (legacy_permissions == TRUE) {\rscope \u0026lt;- c(scope, \u0026quot;read_stream\u0026quot;)\r}\r}\rif (packageVersion(\u0026quot;httr\u0026quot;) \u0026lt; \u0026quot;1.2\u0026quot;) {\rstop(\u0026quot;Rfacebook requires httr version 1.2.0 or greater\u0026quot;)\r}\rif (packageVersion(\u0026quot;httr\u0026quot;) \u0026lt;= \u0026quot;0.2\u0026quot;) {\rfacebook_token \u0026lt;- oauth2.0_token(facebook, myapp, scope = scope)\rfb_oauth \u0026lt;- sign_oauth2.0(facebook_token$access_token)\rif (GET(\u0026quot;https://graph.facebook.com/me\u0026quot;, config = fb_oauth)$status == 200) {\rmessage(\u0026quot;Authentication successful.\u0026quot;)\r}\r}\rif (packageVersion(\u0026quot;httr\u0026quot;) \u0026gt; \u0026quot;0.2\u0026quot; \u0026amp; packageVersion(\u0026quot;httr\u0026quot;) \u0026lt;= \u0026quot;0.6.1\u0026quot;) {\rfb_oauth \u0026lt;- oauth2.0_token(facebook, myapp, scope = scope, cache = FALSE)\rif (GET(\u0026quot;https://graph.facebook.com/me\u0026quot;, config(token = fb_oauth))$status == 200) {\rmessage(\u0026quot;Authentication successful.\u0026quot;)\r}\r}\rif (packageVersion(\u0026quot;httr\u0026quot;) \u0026gt; \u0026quot;0.6.1\u0026quot; \u0026amp; packageVersion(\u0026quot;httr\u0026quot;) \u0026lt; \u0026quot;1.2\u0026quot;) {\rSys.setenv(HTTR_SERVER_PORT = \u0026quot;1410/\u0026quot;)\rfb_oauth \u0026lt;- oauth2.0_token(facebook, myapp, scope = scope, cache = FALSE)\rif (GET(\u0026quot;https://graph.facebook.com/me\u0026quot;, config(token = fb_oauth))$status == 200) {\rmessage(\u0026quot;Authentication successful.\u0026quot;)\r}\r}\rif (packageVersion(\u0026quot;httr\u0026quot;) \u0026gt;= \u0026quot;1.2\u0026quot;) {\rfb_oauth \u0026lt;- oauth2.0_token(facebook, myapp, scope = scope, cache = FALSE)\rif (GET(\u0026quot;https://graph.facebook.com/me\u0026quot;, config(token = fb_oauth))$status == 200) {\rmessage(\u0026quot;Authentication successful.\u0026quot;)\r}\r}\rerror \u0026lt;- tryCatch(callAPI(\u0026quot;https://graph.facebook.com/pablobarbera\u0026quot;, fb_oauth), error = function(e) e)\rif (inherits(error, \u0026quot;error\u0026quot;)) {\rclass(fb_oauth)[4] \u0026lt;- \u0026quot;v2\u0026quot;\r}\rif (!inherits(error, \u0026quot;error\u0026quot;)) {\rclass(fb_oauth)[4] \u0026lt;- \u0026quot;v1\u0026quot;\r}\rreturn(fb_oauth)\r}\r√â isso. Happy coding ;)\nNota: Se voc√™ j√° tinha um app criado no Facebook antes da mudan√ßa de pol√≠tica de privacidade, o ideal √© que ele passe pelo App Review, como sugerido no pr√≥prio pacote do Rfacebook.\n\r","permalink":"https://blog.curso-r.com/posts/2018-07-22-rfacebook/","tags":["app","pacotes"],"title":"RFacebook: como conectar?"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rProvavelmente voc√™ j√° ouviu falar do operador pipe (%\u0026gt;%). Muita gente acha\rque ele √© uma sequ√™ncia m√°gica de s√≠mbolos que muda completamente o visual do\rseu c√≥digo, mas na verdade ele n√£o passa de uma fun√ß√£o como outra qualquer.\nNesse post vou explorar um pouco da hist√≥ria do pipe, como ele funciona e\rpor que utiliz√°-lo.\nOrigem\rO conceito de pipe existe pelo menos desde os anos 1970. De acordo com seu\rcriador, o operador foi concebido em ‚Äúuma noite febril‚Äù e tinha o objetivo de\rsimplificar comandos cujos resultados deveriam ser passados para outros\rcomandos.\nls | cat\r#\u0026gt; Desktop\r#\u0026gt; Documents\r#\u0026gt; Downloads\r#\u0026gt; Music\r#\u0026gt; Pictures\r#\u0026gt; Public\r#\u0026gt; Templates\r#\u0026gt; Videos\rPor essa descri√ß√£o j√° conseguimos ter uma ideia de onde vem o seu nome: pipe\rem ingl√™s significa ‚Äúcano‚Äù, referindo-se ao transporte das sa√≠das dos comandos.\rEm portug√™s o termo √© traduzido como ‚Äúcanaliza√ß√£o‚Äù ou ‚Äúencadeamento‚Äù, mas\rno dia-a-dia √© mais comum usar o termo em ingl√™s.\nA partir da√≠ o pipe tem aparecido nas mais diversas aplica√ß√µes, desde HTML at√©\ro nosso t√£o querido R. Ele pode ter m√∫ltiplos disfarces, mas o seu objetivo\r√© sempre o mesmo: transportar resultados.\n\rComo funciona\rEm R o pipe tem uma cara meio estranha (%\u0026gt;%), mas no fundo ele n√£o passa\rde uma fun√ß√£o infixa, ou seja, uma fun√ß√£o que aparece entre os seus argumentos\r(como a + b ou a %in% b). Na verdade √© por isso mesmo que ele tem\rporcentagens antes e depois: porque no R uma fun√ß√£o infixa s√≥ pode ser\rdeclarada assim.\nVamos come√ßar demonstrando sua funcionalidade b√°sica. Carregue o pacote\rmagrittr e declare o pipe usando Ctrl + Shift + M.\nlibrary(magrittr)\r`%\u0026gt;%`(\u0026quot;oi\u0026quot;, print)\r#\u0026gt; [1] \u0026quot;oi\u0026quot;\rN√£o ligue para os acentos graves em volta do pipe, o comando acima s√≥ serve\rpara demonstrar que ele n√£o √© nada mais que uma fun√ß√£o; perceba que o seu\rprimeiro argumento (\"oi\") virou a entrada do seu segundo argumento (print).\n\u0026quot;oi\u0026quot; %\u0026gt;% print()\r#\u0026gt; [1] \u0026quot;oi\u0026quot;\rObserve agora o comando abaixo. Queremos primeiro somar 3 a uma sequ√™ncia de\rn√∫meros e depois divid√≠-los por 2:\nmais_tres \u0026lt;- function(x) { x + 3 }\rsobre_dois \u0026lt;- function(x) { x / 2 }\rx \u0026lt;- 1:3\rsobre_dois(mais_tres(x))\r#\u0026gt; [1] 2.0 2.5 3.0\rPerceba como fica dif√≠cil de entender o que est√° acontecendo primeiro? A linha\rrelevante come√ßa com a divis√£o por 2, depois vem a soma com 3 e, por fim, os\rvalores de entrada.\nNesse tipo de situa√ß√£o √© mais leg√≠vel usar a nota√ß√£o de\rcomposi√ß√£o de fun√ß√µes,\rcom as fun√ß√µes sendo exibidas na ordem em que ser√£o aplicadas: \\(f \\circ g\\).\nIsso pode ser realizado se tivermos uma fun√ß√£o que passa o resultado do que est√°\r√† sua esquerda para a fun√ß√£o que est√° √† sua direita‚Ä¶\nx %\u0026gt;% mais_tres() %\u0026gt;% sobre_dois()\r#\u0026gt; [1] 2.0 2.5 3.0\rNo comando acima fica evidente que pegamos o objeto x, somamos 3 e dividimos\rpor 2.\nVoc√™ pode j√° ter notado isso, mas a entrada (esquerda) de um pipe sempre √©\rpassada como o primeiro argumento agumento da sua sa√≠da (direita). Isso n√£o\rimpede que as fun√ß√µes utilizadas em uma sequ√™ncia de pipes tenham outros\rargumentos.\nmais_n \u0026lt;- function(x, n) { x + n }\rx %\u0026gt;% mais_n(4) %\u0026gt;% sobre_dois()\r#\u0026gt; [1] 2.5 3.0 3.5\r\rVantagens\rA grande vantagem do pipe n√£o √© s√≥ enxergar quais fun√ß√µes s√£o aplicadas\rprimeiro, mas sim nos ajudar a programar pipelines (‚Äúencanamento‚Äù em ingl√™s)\rde tratamentos de dados.\nlibrary(dplyr)\rstarwars %\u0026gt;% mutate(bmi = mass/((height/100)^2)) %\u0026gt;%\rselect(name, bmi, species) %\u0026gt;%\rgroup_by(species) %\u0026gt;%\rsummarise(bmi = mean(bmi))\r#\u0026gt; # A tibble: 38 x 2\r#\u0026gt; species bmi\r#\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt;\r#\u0026gt; 1 Aleena 24.0\r#\u0026gt; 2 Besalisk 26.0\r#\u0026gt; 3 Cerean 20.9\r#\u0026gt; 4 Chagrian NA #\u0026gt; 5 Clawdite 19.5\r#\u0026gt; 6 Droid NA #\u0026gt; 7 Dug 31.9\r#\u0026gt; 8 Ewok 25.8\r#\u0026gt; 9 Geonosian 23.9\r#\u0026gt; 10 Gungan NA #\u0026gt; # ... with 28 more rows\rAcima fica extremamente claro o que est√° acontecendo em cada passo da pipeline.\rPartindo da base starwars, primeiro transformamos, depois selecionamos,\ragrupamos e resumimos; em cada linha temos uma opera√ß√£o e elas s√£o executadas\rem sequ√™ncia.\nIsso n√£o melhora s√≥ a legibilidade do c√≥digo, mas tamb√©m a sua debugabilidade!\rSe tivermos encontrado um bug na pipeline, basta executar linha a linha do\rencadeamento at√© que encontremos a linha problem√°tica. Com o pipe podemos\rprogramar de forma mais compacta, leg√≠vel e correta.\nTodos os exemplos acima envolvem passar a entrada do pipe como o primeiro\rargumento da fun√ß√£o √† direita, mas n√£o √© uma obrigatoriedade. Com um operador\rplaceholder . podemos indicar exatamente onde deve ser colocado o valor\rque chega no pipe:\ny_menos_x \u0026lt;- function(x, y) { y - x }\rx %\u0026gt;%\rmais_tres() %\u0026gt;%\rpurrr::map2(4:6, ., y_menos_x)\r# [[1]]\r# [1] 0\r# # [[2]]\r# [1] 0\r# # [[3]]\r# [1] 0\r\rB√¥nus\rAgora que voc√™ j√° sabe dos usos mais comuns do pipe, aqui est√° uma outra\rfuncionalidade interessante: fun√ß√µes un√°rias. Se voc√™ estiver familiarizado\rcom o pacote purrr, esse √© um jeito\rbastante simples de criar fun√ß√µes descart√°veis.\nm3_s2 \u0026lt;- . %\u0026gt;%\rmais_tres() %\u0026gt;%\rsobre_dois()\rm3_s2(x)\r#\u0026gt; [1] 2.0 2.5 3.0\rUsando novamente o . definimos uma fun√ß√£o que recebe apenas um argumento\rcom uma sequ√™ncia de aplica√ß√µes de outras fun√ß√µes.\n\rConclus√£o\rO pipe n√£o √© apenas algo que deve ser usado pelos f√£s do\rtidyverse. Ele √© uma fun√ß√£o extremamente √∫til\rque ajuda na legibilidade e programa√ß√£o de c√≥digo, independentemente de\rquais pacotes utilizamos.\nSe quiser saber mais sobre o mundo do pipe, leia\reste post\rdo Daniel sobre o Manifesto Tidy e o\rnosso tutorial mais aprofundado sobre o\rpr√≥prio pipe.\n\r","permalink":"https://blog.curso-r.com/posts/2018-07-03-tutorial-pipe/","tags":["pipe","tidyverse"],"title":"Por que usar o %\u003e%"},{"author":["William"],"categories":["an√°lises"],"contents":"\r\r\r\r\r\r\r\rCom a greve dos caminhoneiros no final do m√™s de maio, muitas cidades tiveram uma redu√ß√£o at√≠pica no tr√°fego de caminh√µes e, posteriormente, com a falta de combust√≠vel, de ve√≠culos em geral.\nComo as emiss√µes veiculares s√£o a principal fonte de diversos poluentes em centros urbanos, faz todo o sentido analisarmos o impacto das paralisa√ß√µes nos n√≠veis de polui√ß√£o.\nNeste post, vamos analisar descritivamente as concentra√ß√µes de alguns poluentes um pouco antes, durante e um pouco depois da greve dos caminhoneiros.\nComo aperitivo, veja a varia√ß√£o dos poluentes durante as paralisa√ß√µes:\n\r\rpollutant\rIbirapuera\rOsasco\rParque D.Pedro II\rPinheiros\r\r\r\rCO (manh√£)\r-48.02%\r-32.78%\r-51.16%\r-65.9%\r\rCO (noite)\r-61.18%\r-50.81%\r-60.77%\r-62.96%\r\rMP10\rNaN%\r-19.1%\r-19.06%\r-20.06%\r\rMP2.5\r-10.26%\r-21.08%\r-20.98%\r-21.13%\r\rNO\r-89.66%\r-50.9%\r-75.38%\r-83.09%\r\rNO2\r-42.49%\r-13.24%\r-38.73%\r-39.45%\r\rO3\r53.7%\rNaN%\r68.43%\r126%\r\r\r\rContextualizando\rA greve dos caminhoneiros foi como ficou conhecida a paralisa√ß√£o de caminhoneiros aut√¥nomos em todo o territ√≥rio nacional em maio de 2018. As manifesta√ß√µes come√ßaram no dia 21 de maio e duraram at√© o in√≠cio de junho. Nesse per√≠odo, muitas cidades sofreram com desabastecimento, principalmente de combust√≠vel.\nNesta an√°lise, eu foquei a observa√ß√£o entre o dias 23 e 30 de maio, per√≠odo em que as consequ√™ncias da greve foram mais intensos. Os poluentes considerados foram:\n\rMon√≥xido de carbono (CO), g√°s t√≥xico que pode causar dor de cabe√ßa, tontura, n√°usea e, em altas concentra√ß√µes, desorienta√ß√£o e morte por asfixia. Segundo a CETESB, 97% do CO liberado em S√£o Paulo vem de emiss√µes veiculares.\n\rOz√¥nio (O3), na estratosfera, faz papel de her√≥i, filtrando parte da radia√ß√£o solar (camada de oz√¥nio). Na troposfera, camada mais baixa da atmosfera, faz papel de vil√£o, sendo associado a diversas doen√ßas respirat√≥rias e cardiovasculares. N√£o √© gerado diretamente pela queima de combust√≠veis, mas sim por rea√ß√µes qu√≠micas atmosf√©ricas que envolvem diversos compostos e radia√ß√£o solar.\n\rMon√≥xido de nitrog√™nio (NO) e di√≥xido de nitrog√™nio (NO2), gases t√≥xicos que contribuem para a forma√ß√£o de chuva √°cida e do oz√¥nio troposf√©rico. Est√£o associados a diversos problemas respirat√≥rios, como enfisema pulmonar e bronquite.\n\rMaterial particulado 2.5 (MP2.5) e material particulado 10 (MP10), part√≠culas suspensas no ar com di√¢metro menor que 2.5 \\(\\mu\\)m (MP2.5) ou entre 2.5 e 10 \\(\\mu\\)m (MP10). Est√£o associadas a diversas doen√ßas respirat√≥rias e c√¢ncer de pulm√£o.\n\r\rAs concentra√ß√µes de cada poluente foram medidas em esta√ß√µes de monitoramento da CETESB. Considerei quatro esta√ß√µes na Grande S√£o Paulo: Osasco, Pinheiros, Parque Dom Pedro II e Ibirapuera. O crit√©rio para a escolha foi a disponibilidade de dados para os poluentes escolhidos e o perfil do tr√°fego de ve√≠culos na regi√£o das esta√ß√µes. As esta√ß√µes Parque Dom Pedro II e Pinheiros ficam em regi√µes de tr√°fego intenso, a primeira no centro da cidade e a segunda pr√≥xima √† marginal Pinheiros. A esta√ß√£o de Osasco tamb√©m fica numa regi√£o de tr√°fego intenso e relativamente pr√≥xima a duas rodovias. A esta√ß√£o Ibirapuera n√£o √© muito afetada pelo tr√°fego pois fica dentro do Parque Ibirapuera e ser√° utilizada como compara√ß√£o.\nA localiza√ß√£o de cada uma delas est√° representada no mapa a seguir:\n\r{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"\u0026copy; OpenStreetMap contributors, CC-BY-SA\"}]},{\"method\":\"addCircleMarkers\",\"args\":[[-23.591838,-23.526757,-23.544841,-23.561441],[-46.660682,-46.792086,-46.627672,-46.70202],10,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#03F\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"#03F\",\"fillOpacity\":0.2},null,null,[\"Ibirapuera\",\"Osasco\",\"Parque D.Pedro II\",\"Pinheiros\"],null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[-23.591838,-23.526757],\"lng\":[-46.792086,-46.627672]}},\"evals\":[],\"jsHooks\":[]}\r\nComo s√£o muitos gr√°ficos e tabelas, vou apresentar apenas alguns resultados aqui no post. O restante est√° dispon√≠vel nesse flexdashboard.\n\rDados\rOs dados desta an√°lise foram extra√≠dos do sistema Qualar, como discutido neste post. O per√≠odo considerado foi 01/05/2018 a 14/06/2018. Tamb√©m considerei esse mesmo per√≠odo nos anos de 2016 e 2017 para pode comparar o comportamento dos poluentes com e sem a greve de caminhoneiros.\nO c√≥digo utilizado pode ser acessado aqui. Repare que, para facilitar o acompanhamento do processo, as requisi√ß√µes foram feitas separadamente para cada esta√ß√£o/ano, pois requisi√ß√µes com um volume muito grande de dados demoravam muito para serem conclu√≠das. Ap√≥s todos os arquivos serem baixados, os dados foram consolidados em uma √∫nica base, que pode ser acessada neste link.\n\rFun√ß√µes usadas para gerar os gr√°ficos\rDado um poluente, um ano e um conjunto de horas, a fun√ß√£o abaixo devolve um plot com os gr√°ficos da s√©rie temporal das quatro esta√ß√µes, utilizando a m√©dia di√°ria do poluente nas horas especificadas.\nmake_series_plot \u0026lt;- function(df, pollutant, year_, hours) {\rif(year_ == 2018) {\rp_lab \u0026lt;- labs(x = \u0026quot;Dia\u0026quot;, y = pollutant)\r} else {\rp_lab \u0026lt;- labs(x = \u0026quot;\u0026quot;, y = pollutant)\r}\rdf %\u0026gt;% filter(\rhour %in% hours\r) %\u0026gt;% group_by(date, stationname) %\u0026gt;%\rselect(y = pollutant, everything()) %\u0026gt;% summarise(conc = mean(y, na.rm = TRUE)) %\u0026gt;% ungroup() %\u0026gt;% mutate(year = lubridate::year(date)) %\u0026gt;%\rfilter(year == year_) %\u0026gt;% ggplot(aes(x = date, y = conc)) +\rgeom_line() +\rgeom_vline(\rxintercept = lubridate::dmy(paste0(\u0026quot;23-05-\u0026quot;, year_)),\rlinetype = 2,\rcolor = \u0026quot;red\u0026quot;\r) +\rgeom_vline(\rxintercept = lubridate::dmy(paste0(\u0026quot;30-05-\u0026quot;, year_)),\rlinetype = 2,\rcolor = \u0026quot;red\u0026quot;\r) +\rfacet_grid(year ~ stationname, scales = \u0026quot;free_y\u0026quot;) +\rtheme_bw() +\rscale_x_date(\rlabels = scales::date_format(\u0026quot;%d-%m\u0026quot;),\rbreaks = c(\rlubridate::dmy(paste0(\u0026quot;01-05-\u0026quot;, year_)), lubridate::dmy(paste0(\u0026quot;01-06-\u0026quot;, year_))\r),\rdate_breaks = \u0026quot;1 month\u0026quot;\r) +\rp_lab\r}\rA fun√ß√£o make_grid_plot() aplica a fun√ß√£o acima e junta os gr√°ficos dos tr√™s anos considerados.\nmake_grid_plot \u0026lt;- function(df, pollutant, hours) {\rmap(\r2016:2018, make_series_plot,\rdf = df,\rpollutant = pollutant,\rhours = hours\r) %\u0026gt;% patchwork::wrap_plots(nrow = 3) %\u0026gt;% print()\r}\rA fun√ß√£o make_bar_plot() faz um gr√°fico de barras para a m√©dia dos poluentes para cada esta√ß√£o em diferentes per√≠odos (antes, durante e ap√≥s a greve).\nmake_bar_plot \u0026lt;- function(df, pollutant_, hours) {\rdf %\u0026gt;% mutate(period = case_when(\rdate \u0026gt; dmy(\u0026quot;09-05-2018\u0026quot;) \u0026amp; date \u0026lt; dmy(\u0026quot;16-05-2018\u0026quot;) ~ 1,\rdate \u0026gt; dmy(\u0026quot;23-05-2018\u0026quot;) \u0026amp; date \u0026lt; dmy(\u0026quot;30-05-2018\u0026quot;) ~ 2,\rdate \u0026gt; dmy(\u0026quot;06-06-2018\u0026quot;) \u0026amp; date \u0026lt; dmy(\u0026quot;14-06-2018\u0026quot;) ~ 3,\rTRUE ~ 0\r)) %\u0026gt;%\rfilter(period != 0) %\u0026gt;% gather(pollutant, conc, CO:O3) %\u0026gt;% group_by(pollutant, stationname, period) %\u0026gt;%\rfilter(hour %in% hours, pollutant == pollutant_) %\u0026gt;% summarise(conc = mean(conc, na.rm = TRUE)) %\u0026gt;%\rggplot(aes(x = stationname, y = conc, fill = as.factor(period))) +\rgeom_bar(stat = \u0026quot;identity\u0026quot;, position = \u0026quot;dodge\u0026quot;) +\rlabs(y = pollutant_, fill = \u0026quot;Per√≠odo\u0026quot;, x = \u0026quot;Esta√ß√£o\u0026quot;) +\rscale_fill_discrete(\rlabels = c(\u0026quot;09/05 a 16/05\u0026quot;, \u0026quot;23/05 a 30/05\u0026quot;, \u0026quot;06/06 a 14/06\u0026quot;)\r) +\rtheme(legend.position = \u0026quot;bottom\u0026quot;)\r}\r\rResultados\rPara construir as s√©ries, eu usei o gr√°fico abaixo para avaliar a m√©dia hor√°ria de cada poluente em cada dia da semana. Assim, em vez de usar as s√©ries hor√°rias, que, em geral, apresentam sazonalidade di√°ria, eu usei contru√≠ as s√©ries da m√©dia di√°ria nos hor√°rios de pico. O gr√°fico mostra, por exemplo, que os picos de CO acontecem de manh√£ e no come√ßo da noite e que os n√≠veis desse poluente s√£o bem menores nos fins de semana.\ndf %\u0026gt;%\rgroup_by(dayofweek, hour) %\u0026gt;% summarise_at(vars(CO:O3), funs(mean), na.rm = TRUE) %\u0026gt;%\rgather(polluent, conc, CO:O3) %\u0026gt;% ggplot(aes(x = hour, y = conc)) +\rgeom_line() +\rfacet_grid(polluent ~ dayofweek, scales = \u0026quot;free_y\u0026quot;) +\rtheme_bw() +\rlabs(x = \u0026quot;Hora\u0026quot;, y = \u0026quot;Concentra√ß√£o\u0026quot;)\rUsando ent√£o a fun√ß√£o make_grid_plot() e as informa√ß√µes do gr√°fico acima, podemos construir e analisar as s√©ries de cada poluente. Nos gr√°ficos abaixo, o intervalo entre as retas pontilhadas representa o per√≠odo de greve.\nO gr√°fico abaixo mostra as s√©ries do mon√≥xido de carbono (CO), utilizando a m√©dia di√°ria das 7 √†s 11 horas. Os fins de semana foram retirados da amostra.\ndf %\u0026gt;% filter(!dayofweek %in% c(\u0026quot;s√°b\u0026quot;,\u0026quot;dom\u0026quot;)) %\u0026gt;% make_grid_plot(\u0026quot;CO\u0026quot;, 7:11)\rAgora, o gr√°fico do mon√≥xido de nitrog√™nio (NO), tamb√©m com m√©dia di√°ria das 7 √†s 11 horas. Os domingos foram retirados da amostra.\ndf %\u0026gt;% filter(!dayofweek %in% c(\u0026quot;dom\u0026quot;)) %\u0026gt;% make_grid_plot(\u0026quot;NO\u0026quot;, 7:11)\rE o gr√°fico do oz√¥nio, com m√©dia di√°ria das 12 √†s 17 horas. Osasco foi retirada pois n√£o h√° dados de oz√¥nio nessa esta√ß√£o.\ndf %\u0026gt;%\rfilter(!stationname == \u0026quot;Osasco\u0026quot;) %\u0026gt;% make_grid_plot(\u0026quot;O3\u0026quot;, 12:17)\rO gr√°fico abaixo apresenta a m√©dia das m√©dias di√°rias de CO (das 7h √†s 11h) em um per√≠odo anterior (09/05 a 16/05), durante (23/05 a 30/05) e em um per√≠odo posterior √† greve (06/06 a 14/06). Os tr√™s per√≠odos t√™m o mesmo n√∫mero de dias da semana e fins de semana.\nmake_bar_plot(df, \u0026quot;CO\u0026quot;, 7:11)\rComo comentei anteriormente, os gr√°ficos restantes podem ser visualizados neste dashboard.\nPor fim, eu juntei os per√≠odos anterior (09/05 a 16/05) e posterior (06/06 a 14/06), calculei a m√©dia dos poluentes nesses dias e comparei com a m√©dia durante o per√≠odo de greve. A varia√ß√£o dos poluentes para cada esta√ß√£o est√° apresentada na tabela abaixo. O CO pela manh√£, por exemplo, diminuiu 58.62% em Pinheiros durante a greve, enquanto o oz√¥nio aumentou 111.75%.\ntab\r\r\rpollutant\rIbirapuera\rOsasco\rParque D.Pedro II\rPinheiros\r\r\r\rCO (manh√£)\r-48.02%\r-32.78%\r-51.16%\r-65.9%\r\rCO (noite)\r-61.18%\r-50.81%\r-60.77%\r-62.96%\r\rMP10\rNaN%\r-19.1%\r-19.06%\r-20.06%\r\rMP2.5\r-10.26%\r-21.08%\r-20.98%\r-21.13%\r\rNO\r-89.66%\r-50.9%\r-75.38%\r-83.09%\r\rNO2\r-42.49%\r-13.24%\r-38.73%\r-39.45%\r\rO3\r53.7%\rNaN%\r68.43%\r126%\r\r\r\r\rComent√°rios\r\rCom exce√ß√£o do oz√¥nio, a concentra√ß√£o m√©dia dos poluentes durante o per√≠odo de paralisa√ß√£o diminuiu. A maior redu√ß√£o foi a de NO, que √© diretamente produzido pela queima de combust√≠veis, principalmente gasolina e diesel. A greve n√£o parece ter influenciado muito nos n√≠veis de MP2.5.\n\rO oz√¥nio n√£o √© produzido diretamente pela combust√£o de combust√≠veis. Ele √© produto de um complexo processo qu√≠mico que ocorre ao longo do dia, envolvendo diversos compostos e a radia√ß√£o solar. O aumento da concentra√ß√£o de oz√¥nio durante a greve era esperada, pois o NO emitido pela queima de diesel e gasolina reage com o O3 troposf√©rico, diminuindo a sua concentra√ß√£o ao longo da tarde. Como o NO diminuiu por causa do menor tr√°fego de ve√≠culos, o n√≠vel de oz√¥nio foi maior durante a greve. Para mais detalhes sobre esse fen√¥meno, veja este post.\n\rEsta an√°lise s√≥ considera o per√≠odo de greve e vari√°veis de calend√°rio para explicar a varia√ß√£o da concentra√ß√£o dos poluentes. Uma an√°lise mais completa deveria considerar tamb√©m os efeitos clim√°ticos (temperatura, precipita√ß√£o, vento, radia√ß√£o, entre outros). As conclus√µes aqui sup√µem que esses fatores se mantiveram homog√™neos durante o per√≠odo analisado, o que pode n√£o ser razo√°vel.\n\r\rTem sugest√µes? Alguma cr√≠tica? Est√° carente? Deixe seu coment√°rio abaixo. :)\n\r","permalink":"https://blog.curso-r.com/posts/2018-06-18-poluicao-greve-caminhoneiros/","tags":["web scraping","dados abertos"],"title":"A polui√ß√£o do ar durante a greve dos caminhoneiros"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\r\rAl√©m de ser s√≥cio-fundador da R6 consultoria, a holding que controla a Curso-R.com, tamb√©m estou presidente do Conselho Regional de Estat√≠stica - 3a Regi√£o. Uma de nossas incumb√™ncias como conselheiros √© encontrar formas de monitorar e fiscalizar as pesquisas eleitorais.\nNesse ano eleitoral, por conta da pluralidade de candidatos e grande fragmenta√ß√£o do cen√°rio pol√≠tico, a preocupa√ß√£o com as pesquisas eleitorais √© ainda maior. O cen√°rio incerto gera pesquisas com resultados incertos. Isso √© um prato cheio para oportunistas que desejam influenciar a opini√£o p√∫blica atrav√©s de pesquisas forjadas.\nPor isso, √© nossa obriga√ß√£o como cidad√£os e cidad√£s acompanhar e monitorar as pesquisas eleitorais registradas, detectando e apontando o dedo para poss√≠veis fraudes. Esse post busca ajudar a popula√ß√£o nesse sentido.\nO sistema pesqEle\rO pesqEle √© o reposit√≥rio oficial de pesquisas eleitorais disponibilizado pelo Tribunal Superior Eleitoral (TSE). L√° podemos encontrar diversas informa√ß√µes sobre as pesquisas registradas. D√° at√© para ver os question√°rios aplicados e a metodologia de coleta.\nInfelizmente, o formul√°rio de cadastro do pesqEle √© problem√°tico, permitindo a entrada de dados sem padroniza√ß√£o. Isso atrapalha bastante na hora de organizar os dados e fazer an√°lises.\nOutro problema do pesqEle √© que ele √© pouco divulgado. Essa base de dados tem informa√ß√µes important√≠ssimas que deveriam ser usadas pelas associa√ß√µes, conselhos e m√≠dia para monitorar as pesquisas, mas o foco √© sempre nos resultado que s√£o apresentados, e n√£o na metodologia empregada para realiza√ß√£o dos levantamentos.\nComo bom estat√≠stico que sou e faxineiro de dados, me senti obrigado a divulgar esses dados de uma forma razo√°vel. Veja como abaixos\n\rO pacote pesqEle\rO site do pesqEle n√£o disponibiliza API para acesso aos dados e seria muito complicado pedir atualiza√ß√µes de dados via LAI. Por isso, foi criamos um raspador para obter os dados automaticamente. O pacote pesqEle √© o resultado desse esfor√ßo.\nO pacote exporta apenas uma fun√ß√£o, pe_2018(), usada para download e arruma√ß√£o dos dados do pesqEle. Ela faz o download de todas as pesquisas de 2018 por raspagem de dados. Por padr√£o, os arquivos HTML s√£o armazenados na pasta data-raw/html_2018, mas √© poss√≠vel alterar essa pasta pelo par√¢metro path=. Exemplo:\npe \u0026lt;- pe_2018(\u0026quot;pasta\u0026quot;)\rdplyr::glimpse(pe)\rObservations: 186\rVariables: 24\r$ id_seq \u0026lt;int\u0026gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14...\r$ id_pesq \u0026lt;chr\u0026gt; \u0026quot;MA-05302/2018\u0026quot;, \u0026quot;DF-03958/2018\u0026quot;, \u0026quot;DF-06553/2...\r$ info_uf \u0026lt;chr\u0026gt; \u0026quot;MA\u0026quot;, \u0026quot;DF\u0026quot;, \u0026quot;DF\u0026quot;, \u0026quot;PI\u0026quot;, \u0026quot;PI\u0026quot;, \u0026quot;SP\u0026quot;, \u0026quot;SP\u0026quot;, \u0026quot;PI...\r$ info_election \u0026lt;chr\u0026gt; \u0026quot;Elei√ß√µes Gerais 2018\u0026quot;, \u0026quot;Elei√ß√µes Gerais 2018...\r$ info_position \u0026lt;chr\u0026gt; \u0026quot;\u0026quot;, \u0026quot;Deputado Distrital\u0026quot;, \u0026quot;Deputado Federal\u0026quot;,...\r$ comp_nm \u0026lt;chr\u0026gt; \u0026quot;M R BORGES SERVICOS / MBO PUBLICIDADE, MARKE...\r$ comp_cnpj \u0026lt;chr\u0026gt; \u0026quot;00905916000190\u0026quot;, \u0026quot;00850844000121\u0026quot;, \u0026quot;00850844...\r$ comp_contract_same \u0026lt;chr\u0026gt; \u0026quot;Sim\u0026quot;, \u0026quot;Sim\u0026quot;, \u0026quot;Sim\u0026quot;, \u0026quot;N√£o\u0026quot;, \u0026quot;N√£o\u0026quot;, \u0026quot;N√£o\u0026quot;, \u0026quot;N√£...\r$ stat_id \u0026lt;chr\u0026gt; \u0026quot;1791\u0026quot;, \u0026quot;CONRE 1a. Regi√£o No. 9403\u0026quot;, \u0026quot;CONRE 1...\r$ stat_nm \u0026lt;chr\u0026gt; \u0026quot;ANTONIO CARLOS RODRIGUES BARBOSA\u0026quot;, \u0026quot;LUCIANA ...\r$ pesq_n \u0026lt;dbl\u0026gt; 10973, 3200, 3200, 320, 320, 601, 601, 320, 8...\r$ pesq_val \u0026lt;dbl\u0026gt; 15700, 32000, 32000, 3000, 3000, 6000, 0, 300...\r$ pesq_contractors \u0026lt;chr\u0026gt; \u0026quot;CNPJ: 00905916000190 - M R BORGES SERVICOS\u0026quot;,...\r$ pesq_origin \u0026lt;chr\u0026gt; \u0026quot;Vazio\u0026quot;, \u0026quot;Vazio\u0026quot;, \u0026quot;Vazio\u0026quot;, \u0026quot;Recursos proprios...\r$ pesq_same \u0026lt;lgl\u0026gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL...\r$ dt_reg \u0026lt;date\u0026gt; 2018-05-12, 2018-03-26, 2018-03-26, 2018-02-...\r$ dt_pub \u0026lt;date\u0026gt; 2018-05-18, 2018-04-01, 2018-04-01, 2018-02-...\r$ dt_start \u0026lt;date\u0026gt; 2018-03-26, 2018-03-21, 2018-03-21, 2018-02-...\r$ dt_end \u0026lt;date\u0026gt; 2018-05-04, 2018-03-30, 2018-03-30, 2018-02-...\r$ txt_verif \u0026lt;chr\u0026gt; \u0026quot;Sistema interno de controle e verifica√ß√£o, c...\r$ txt_method \u0026lt;chr\u0026gt; \u0026quot;METODOLOGIA: A pesquisa foi realizada median...\r$ txt_about \u0026lt;chr\u0026gt; \u0026quot;Trata-se de uma amostra n√£o aleat√≥ria por co...\r$ txt_plan \u0026lt;chr\u0026gt; \u0026quot;. PLANO AMOSTRAL E INTERVALOS DE CONFIAN√áA: ...\r$ stat_unique \u0026lt;chr\u0026gt; \u0026quot;1791_A535\u0026quot;, \u0026quot;9403_L252\u0026quot;, \u0026quot;9403_L252\u0026quot;, \u0026quot;5102_...\rAo rodar pela primeira vez, provavelmente o download demorar√° por volta de 15-20 minutos, dependendo da conex√£o com a internet. Nas pr√≥ximas vezes o download √© mais r√°pido pois o programa n√£o baixa pesquisas j√° armazenadas em arquivos HTML.\nSe n√£o quiser rodar a fun√ß√£o pe_2018(), armazenamos os dados no objeto pesqEle::pesqEle_2018. Esse objeto √© uma data.frame() com as mesmas colunas resultantes de pe_2018(). Essas vari√°veis s√£o\n\rIdentificadores:\r\rid_seq: ID sequencial\rid_pesq: ID de registro da pesquisa\r\rInforma√ß√µes da elei√ß√£o\r\rinfo_uf: Unidade Federativa indicando abrang√™ncia da pesquisa (‚ÄúBR‚Äù = Brasil)\rinfo_election: Elei√ß√£o (no caso, sempre 2018)\rinfo_position: Cargo eleitoral\r\rInforma√ß√µes da empresa\r\rcomp_nm: Nome da empresa que realizou a pesquisa\rcomp_cnpj: CNPJ da empresa que realizou a pesquisa\rcomp_contract_same: Contratante √© a pr√≥pria empresa?\r\rInforma√ß√µes do estat√≠stico respons√°vel\r\rstat_id: ID do estat√≠stico\rstat_nm\rstat_unique: C√≥digo √∫nico do estat√≠stico. Os nomes dos estat√≠sticos estavam escritos de formas diferentes, ent√£o arrumamos utilizando o pacote SoundexBR e outras heur√≠sticas. Nada garante que o pacote contenha mais erros nos nomes.\r\rInforma√ß√µes sobre a pesquisa\r\rpesq_n: Tamanho da amostra.\rpesq_val: Custo da pesquisa informado no registro.\rpesq_contractors: Empresas que contrataram a pesquisa.\rpesq_origin: Origem dos recursos da pesquisa.\rpesq_same: Indica se o contratante da pesquisa √© a pr√≥pria empresa e a pesquisa foi realizada com recursos pr√≥prios (em 2018 n√£o tem nenhuma).\r\rDatas\r\rdt_reg: Data de registro da pesquisa.\rdt_pub: Data de publica√ß√£o da pesquisa.\rdt_start: Data de in√≠cio da pesquisa.\rdt_end: Data de t√©rmino da pesquisa.\r\rInforma√ß√µes adicionais (texto)\r\rtxt_verif, txt_method, txt_about, txt_plan: informa√ß√µes adicionais da pesquisa, geralmente em texto, sobre metodologia, aplica√ß√£o e outros detalhes.\r\r\rA base passou por uma s√©rie de limpezas para ficar minimamente utiliz√°vel. Essas faxinas incluem arruma√ß√£o de nomes dos estat√≠sticos, empresas e UFs.\n\rShiny App\rN√£o podemos ficar s√≥ nas tabelinhas, n√©?\nTamb√©m fizemos um app para visualizar os dados e levantar algumas estat√≠sticas b√°sicas. O William √© o ser maravilhoso e iluminado por tr√°s desse app, que ficou realmente lindo.\nAp√≥s instalar o pacote, voc√™ pode abrir o app do pesqEle localmente rodando\nshiny::runApp(system.file(\u0026quot;app\u0026quot;, package = \u0026quot;pesqEle\u0026quot;))\rPara rodar o app, al√©m dos pacotes do tidyverse e shiny, voc√™ precisar√° instalar os pacotes shinydashboard, highcharter, shinyBS e shinyjs. Todos eles est√£o no CRAN e podem ser instalados via install.packages().\nTamb√©m disponibilizamos o app nos servidores do CONRE-3. Voc√™ pode acessar diretamente aqui:\nhttp://pesqele.conre3.org.br/app\n\rColoquei o app dentro de um iframe para acesso direto:\n\r\r\rDesenvolvendo o pesqEle\rSe voc√™ tem interesse em baixar os dados de outras formas e aplicar outras regras para arruma√ß√£o, voc√™ pode! No entanto, para isso ter√° de trabalhar com as fun√ß√µes n√£o documentadas do pesqEle. O pacote est√° longe de seu estado ideal.\nCaso essa parte do pacote se torne realmente √∫til no futuro, pretendo deixar essas fun√ß√µes exportadas e documentadas. Para isso, no entanto, precisarei de muito apoio da comunidade.\nPor enquanto, recomendo que voc√™ d√™ uma fu√ßada no reposit√≥rio do pacote no github e adicione issues.\n\rLinks\r\rSiga o CONRE-3 no Facebook e acesse a p√°gina do site sobre pesquisas eleitorais.\rContribua com o pesqEle!!\r\r\r","permalink":"https://blog.curso-r.com/posts/2018-05-30-pesqele/","tags":["app","pacotes"],"title":"pesqEle: dados de pesquisas eleitorais"},{"author":["Athos","Julio"],"categories":["conceitos"],"contents":"\r\rModelos baseados em √°rvores como √°rvores de decis√£o, random forest, ligthGBM e xgboost s√£o conhecidos, dentre outras qualidades, pela sua robust√™s diante do problema de multicolinearidade. √â sabido que seu poder preditivo n√£o se abala na presen√ßa de vari√°veis extremamente correlacionadas.\nPor√©m, quem nunca usou um Random Forest pra fazer sele√ß√£o de vari√°veis? Pegar, por exemplo, as top 10 mais importantes e descartar o resto?\nOu at√© mesmo arriscou uma interpreta√ß√£o e concluiu sobre a ordem das vari√°veis mais importantes?\nAbaixo mostraremos o porqu√™ n√£o devemos ignorar a quest√£o da multicolinearidade completamente!\nUm modelo bonitinho\rPrimeiro vamos ajustar um modelo bonitinho, livre de multicolinearidade. Suponha que queiramos prever Petal.Length utilizando as medidas das s√©palas (Sepal.Width e Sepal.Length) da nossa boa e velha base iris.\nlibrary(tidyverse)\r## ‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 1.3.0 ‚îÄ‚îÄ\r## ‚úì ggplot2 3.3.2 ‚úì purrr 0.3.4\r## ‚úì tibble 3.0.4 ‚úì dplyr 1.0.2\r## ‚úì tidyr 1.1.2 ‚úì stringr 1.4.0\r## ‚úì readr 1.4.0 ‚úì forcats 0.5.0\r## ‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ\r## x dplyr::filter() masks stats::filter()\r## x dplyr::lag() masks stats::lag()\riris2 \u0026lt;- iris %\u0026gt;% select(Sepal.Length, Sepal.Width, Petal.Length)\riris2 %\u0026gt;% cor %\u0026gt;% corrplot::corrplot()\rO gr√°fico acima mostra que as vari√°veis explicativas n√£o s√£o fortemente correlacionadas. Ajustando uma random fores, temos a seguinte ordem de import√¢ncia das vari√°veis:\nlibrary(randomForest)\riris2_rf \u0026lt;- randomForest(Petal.Length ~ ., data = iris2)\rvarImpPlot(iris2_rf)\rSem surpresas. Agora vamos para o problema!\n\rUm modelo com feinho\rVamos forjar uma situa√ß√£o extrema em que muitas vari√°veis sejam multicolineares. Vou fazer isso repetindo a coluna Sepal.Length v√°rias vezes.\niris3 \u0026lt;- accumulate(1:20, ~{\r.x[[paste0(\u0026quot;Sepal.Length\u0026quot;, .y)]] \u0026lt;- iris2$Sepal.Length\r.x\r}, .init = iris2)\riris3[[20]] %\u0026gt;% cor %\u0026gt;% corrplot::corrplot(order = \u0026quot;alphabet\u0026quot;)\rAgora a coisa t√° feia! Temos 20 vari√°veis perfeitamente colineares. Mesmo assim um random forest nessa nova base n√£o perderia poder preditivo.\nMas como ficou a import√¢ncia das vari√°veis?\niris3_rf \u0026lt;- randomForest(Petal.Length ~ ., data = iris3[[20]])\rvarImpPlot(iris3_rf)\rAqui o jogo j√° se inverteu: concluir√≠amos que Sepal.Width √© mais importante de todas as vari√°veis!\n\rSele√ß√£o de vari√°veis furado\rO gr√°fico abaixo mostra que quanto mais vari√°veis correlacionadas tivermos, menor a import√¢ncia de TODAS ELAS SIMULTANEAMENTE! √â como se as vari√°veis colineares repartissem a import√¢ncia entre elas.\n# ajusta random forest para bases com 1 a 20 repeti√ß√µes de `Sepal.Length`\rrfs \u0026lt;- map(iris3, ~ randomForest(Petal.Length ~ ., data = .x) %\u0026gt;% importance)\r# extrai as import√¢ncias das repeti√ß√µes de `Sepal.Length`\rimportancia \u0026lt;- map_dfr(rfs, ~{\r.x %\u0026gt;% as.data.frame() %\u0026gt;% tibble::rownames_to_column() %\u0026gt;% dplyr::filter(stringr::str_detect(rowname, \u0026quot;^Sepal.Length\u0026quot;))\r}, .id = \u0026quot;n_repeticoes\u0026quot;) %\u0026gt;%\rmutate(n_repeticoes = as.numeric(n_repeticoes))\r# Gr√°fico do n√∫mero de vari√°veis multicolineares vs import√¢ncia\rimportancia %\u0026gt;%\rggplot(aes(x = n_repeticoes, y = IncNodePurity)) +\rgeom_point() +\rgeom_hline(yintercept = 40, size = 1, linetype = \u0026quot;dashed\u0026quot;, colour = \u0026quot;red\u0026quot;) +\rlabs(x = \u0026quot;Qtd de repeti√ß√µes da coluna `Sepal.Length`\u0026quot;, y = \u0026quot;Import√¢ncia\u0026quot;, title = \u0026quot;Gr√°fico da rela√ß√£o entre o n√∫mero de vari√°veis multicolineares vs import√¢ncia\u0026quot;)\rNa pr√°tica, se estabelecessemos um corte no valor de import√¢ncia pra descartar vari√°veis (como ilustrado pela linha vermelha), ter√≠amos um problema em potencial: poder√≠amos estar jogando fora informa√ß√£o muito importante.\n\rComo tratar multicolinearidade, ent√£o?\rAlgumas maneiras de lidar com multicolinearidade s√£o:\n\rObservar a matriz de correla√ß√£o\rVIF\rRecursive feature elimination\r\r\rConclus√£o\rCuidado ao jogar tudo no caldeir√£o! Devemos sempre nos preocupar com multicolinearidade, mesmo ajustando modelos baseados em √°rvores.\nAbs!\n\r","permalink":"https://blog.curso-r.com/posts/2018-05-22-arvore-e-multicolinearidade/","tags":["machine learning","random forest","multicolinearidade"],"title":"Modelos beseados em √°rvores s√£o imunes √† multicolinearidade?"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\r\r\r\rDurante nosso √∫ltimo curso de introdu√ß√£o a programa√ß√£o em R, o Reinaldo Chaves me pediu ajuda para carregar os dados de CNPJs da Receita Federal. Eu me animei tanto com essa base que decidi montar um pacotinho para baixar, ler e organizar esses dados.\nPacote\rO pacote rfbCNPJ baixa e l√™ os arquivos contendo a lista de todas as empresas do Brasil, disponibilizado pela Receita Federal em 15 de dezembro de 2017.\nS√£o duas tabelas, separadas por UF: i) empresas, contendo informa√ß√µes de CNPJ e nome da empresa e ii) socios, contendo quadro de s√≥cios. Essa base de dados √© atualizada pela pr√≥pria RFB e eu n√£o fa√ßo ideia de quando ser√° atualizada novamente.\nComo os arquivos s√£o do tipo fixed width, algumas pessoas podem ter dificuldade para ler e empilhar os arquivos no R. Esse pacote facilita as opera√ß√µes de download e leitura.\nInstala√ß√£o\rVoc√™ pode instalar o pacote rfbCNPJ do CRAN rodando\n# ainda n√£o foi aprovado no CRAN...\rinstall.packages(\u0026quot;rfbCNPJ\u0026quot;)\rVoc√™ tamb√©m pode baixar diretamente do GitHub rodando:\n# install.packages(\u0026quot;devtools\u0026quot;)\rdevtools::install_github(\u0026quot;jtrecenti/rfbCNPJ\u0026quot;)\r\rDownload de arquivos brutos\rVoc√™ pode baixar o arquivo .txt bruto de cada UF usando o comando\rrfb_download(). Por padr√£o, temos ufs = NULL, que baixar√° os arquivos\rde todas as UFs. Esses arquivos somam aproximadamente 4.8 GB em disco.\nrfb_download(ufs = c(\u0026quot;AC\u0026quot;, \u0026quot;RR\u0026quot;), path = \u0026quot;caminho/da/pasta\u0026quot;)\r\rParse\rA partir de uma pasta contendo os arquivos txt, voc√™ pode carregar as bases\rde dados rodando rfb_read() com os caminhos dos arquivos ou rfb_read_dir()\rdiretamente para ler todos os arquivos da pasta. Certifique-se de que a pasta\rque cont√©m os arquivos a serem lidos cont√©m apenas os arquivos baixados\rem .txt.\npath \u0026lt;- \u0026quot;caminho/da/pasta\u0026quot;\rall_files \u0026lt;- fs::dir_ls(path)\rdados \u0026lt;- rfb_read(all_files)\rdados \u0026lt;- rfb_read_dir(path) # equivalente\r\rCarregando dados\rOs dados s√£o carregados numa tabela complexa com duas list-columns.\nlibrary(tibble)\rprint(dados, n = 27)\r# A tibble: 27 x 3\rfile empresa socio \u0026lt;chr\u0026gt; \u0026lt;list\u0026gt; \u0026lt;list\u0026gt; 1 D71214AC.txt \u0026lt;tibble [15,690 √ó 3]\u0026gt; \u0026lt;tibble [26,268 √ó 6]\u0026gt; 2 D71214AL.txt \u0026lt;tibble [60,067 √ó 3]\u0026gt; \u0026lt;tibble [109,762 √ó 6]\u0026gt; 3 D71214AM.txt \u0026lt;tibble [64,306 √ó 3]\u0026gt; \u0026lt;tibble [121,095 √ó 6]\u0026gt; 4 D71214AP.txt \u0026lt;tibble [15,941 √ó 3]\u0026gt; \u0026lt;tibble [28,063 √ó 6]\u0026gt; 5 D71214BA.txt \u0026lt;tibble [422,396 √ó 3]\u0026gt; \u0026lt;tibble [787,637 √ó 6]\u0026gt; 6 D71214CE.txt \u0026lt;tibble [193,654 √ó 3]\u0026gt; \u0026lt;tibble [352,841 √ó 6]\u0026gt; 7 D71214DF.txt \u0026lt;tibble [194,734 √ó 3]\u0026gt; \u0026lt;tibble [368,607 √ó 6]\u0026gt; 8 D71214ES.txt \u0026lt;tibble [179,150 √ó 3]\u0026gt; \u0026lt;tibble [354,358 √ó 6]\u0026gt; 9 D71214GO.txt \u0026lt;tibble [328,524 √ó 3]\u0026gt; \u0026lt;tibble [619,810 √ó 6]\u0026gt; 10 D71214MA.txt \u0026lt;tibble [123,736 √ó 3]\u0026gt; \u0026lt;tibble [201,854 √ó 6]\u0026gt; 11 D71214MG.txt \u0026lt;tibble [962,930 √ó 3]\u0026gt; \u0026lt;tibble [1,916,405 √ó 6]\u0026gt;\r12 D71214MS.txt \u0026lt;tibble [102,208 √ó 3]\u0026gt; \u0026lt;tibble [189,673 √ó 6]\u0026gt; 13 D71214MT.txt \u0026lt;tibble [141,464 √ó 3]\u0026gt; \u0026lt;tibble [262,358 √ó 6]\u0026gt; 14 D71214PA.txt \u0026lt;tibble [159,079 √ó 3]\u0026gt; \u0026lt;tibble [274,004 √ó 6]\u0026gt; 15 D71214PB.txt \u0026lt;tibble [79,275 √ó 3]\u0026gt; \u0026lt;tibble [138,596 √ó 6]\u0026gt; 16 D71214PE.txt \u0026lt;tibble [224,184 √ó 3]\u0026gt; \u0026lt;tibble [426,520 √ó 6]\u0026gt; 17 D71214PI.txt \u0026lt;tibble [61,627 √ó 3]\u0026gt; \u0026lt;tibble [105,008 √ó 6]\u0026gt; 18 D71214PR.txt \u0026lt;tibble [708,109 √ó 3]\u0026gt; \u0026lt;tibble [1,392,658 √ó 6]\u0026gt;\r19 D71214RJ.txt \u0026lt;tibble [843,040 √ó 3]\u0026gt; \u0026lt;tibble [1,708,931 √ó 6]\u0026gt;\r20 D71214RN.txt \u0026lt;tibble [80,562 √ó 3]\u0026gt; \u0026lt;tibble [150,411 √ó 6]\u0026gt; 21 D71214RO.txt \u0026lt;tibble [62,385 √ó 3]\u0026gt; \u0026lt;tibble [109,774 √ó 6]\u0026gt; 22 D71214RR.txt \u0026lt;tibble [11,908 √ó 3]\u0026gt; \u0026lt;tibble [21,737 √ó 6]\u0026gt; 23 D71214RS.txt \u0026lt;tibble [670,093 √ó 3]\u0026gt; \u0026lt;tibble [1,350,159 √ó 6]\u0026gt;\r24 D71214SC.txt \u0026lt;tibble [498,511 √ó 3]\u0026gt; \u0026lt;tibble [974,351 √ó 6]\u0026gt; 25 D71214SE.txt \u0026lt;tibble [63,303 √ó 3]\u0026gt; \u0026lt;tibble [114,081 √ó 6]\u0026gt; 26 D71214SP.txt \u0026lt;tibble [2,730,412 √ó 3]\u0026gt; \u0026lt;tibble [5,585,988 √ó 6]\u0026gt;\r27 D71214TO.txt \u0026lt;tibble [51,629 √ó 3]\u0026gt; \u0026lt;tibble [89,911 √ó 6]\u0026gt;\rA primeira coluna complexa mostra dados das empresas, e a segunda mostra dados dos s√≥cios. Para carregar uma dessas listas, use tidyr::unnest(), como veremos abaixo.\nEmpresas:\nlibrary(magrittr)\rempresas \u0026lt;- dados %\u0026gt;% dplyr::select(file, empresa) %\u0026gt;% tidyr::unnest(empresa)\rempresas\r# A tibble: 9,048,917 x 4\rfile tipo cnpj nome_empresarial \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 D71214AC.txt 01 07398403000180 BOI GORDO AGROPECUARIA COMERCIO E R‚Ä¶\r2 D71214AC.txt 01 03173169000131 CONSELHO ESCOLAR BOM JESUS 3 D71214AC.txt 01 07399184000153 D \u0026amp; A SOLUCOES INFORMATICA LTDA - ME\r4 D71214AC.txt 01 07399188000131 SOCIEDADE AGRICOLA POERINHA 5 D71214AC.txt 01 03300047000169 ASSOCIACAO MAO AMIGA DE PRODUTORES ‚Ä¶\r6 D71214AC.txt 01 04940648000107 ASSOCIACAO DOS PRODUTORES RURAIS E ‚Ä¶\r7 D71214AC.txt 01 04940653000101 CONSELHO ESCOLAR POLO HORTIGRANJEIRO\r8 D71214AC.txt 01 04940654000156 CONSELHO ESCOLAR CENTRO EDUCACIONAL‚Ä¶\r9 D71214AC.txt 01 03301098000105 ASSOCIACAO AGROEXTRATIVISTA SANTOS ‚Ä¶\r10 D71214AC.txt 01 01653480000152 DENEVS - TERCEIRIZACAO LTDA # ... with 9,048,907 more rows\r\rS√≥cios:\nsocios \u0026lt;- dados %\u0026gt;% dplyr::select(file, socio) %\u0026gt;% tidyr::unnest(socio)\rsocios\r# A tibble: 17,780,860 x 7\rfile tipo cnpj indicador_cpf_c‚Ä¶ cpf_cnpj_socio qualificacao nome \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 D7121‚Ä¶ 02 0739‚Ä¶ 2 NA 49 SELMA‚Ä¶\r2 D7121‚Ä¶ 02 0739‚Ä¶ 2 NA 22 MARCE‚Ä¶\r3 D7121‚Ä¶ 02 0317‚Ä¶ 2 NA 16 MARIA‚Ä¶\r4 D7121‚Ä¶ 02 0739‚Ä¶ 2 NA 49 DILSO‚Ä¶\r5 D7121‚Ä¶ 02 0739‚Ä¶ 2 NA 22 ANGEL‚Ä¶\r6 D7121‚Ä¶ 02 0739‚Ä¶ 2 NA 16 RAIMU‚Ä¶\r7 D7121‚Ä¶ 02 0330‚Ä¶ 2 NA 16 MOISE‚Ä¶\r8 D7121‚Ä¶ 02 0494‚Ä¶ 2 NA 16 RAIMU‚Ä¶\r9 D7121‚Ä¶ 02 0494‚Ä¶ 2 NA 16 MARIA‚Ä¶\r10 D7121‚Ä¶ 02 0494‚Ä¶ 2 NA 16 EUCLI‚Ä¶\r# ... with 17,780,850 more rows\r\rA descri√ß√£o das qualifica√ß√µes pode ser encontrada na base qualificacao, dispon√≠vel dentro do pacote:\ndata(qualificacao, package = \u0026quot;rfbCNPJ\u0026quot;)\rqualificacao\r# A tibble: 40 x 2\rqualificacao qualificacao_nm \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 05 Administrador 2 08 Conselheiro de Administra√ß√£o\r3 10 Diretor 4 16 Presidente 5 17 Procurador 6 20 Sociedade Consorciada 7 21 Sociedade Filiada 8 22 S√≥cio 9 23 S√≥cio Capitalista 10 24 S√≥cio Comanditado # ... with 30 more rows\rPara juntar com a base de dados dos s√≥cios, basta dar dplyr::inner_join()!\n\rDownload de arquivos bin√°rios\rVoc√™ pode carregar os arquivos bin√°rios (em .rds) diretamente da web usando a fun√ß√£o rfb_import(). Essa fun√ß√£o baixa os arquivos bin√°rios diretamente do\rDropbox. Voc√™ pode baixar usando o par√¢metro type=, com as op√ß√µes ‚Äúall‚Äù\r(tibble complexa com list-columns), ‚Äúempresas‚Äù (tibble retangular) e\r‚Äúsocios‚Äù (tibble retangular).\nempresas \u0026lt;- rfb_import(\u0026quot;empresas\u0026quot;, path = \u0026quot;.\u0026quot;)\rVoc√™ tamb√©m pode baixar os dados dos arquivos bin√°rios em .rds desses links\rcom arquivos armazenados diretamente no dropbox:\n\rrfb (list-column)\rempresas\rsocios\r\rPara ler um desses arquivos, basta rodar\ndados \u0026lt;- readRDS(\u0026quot;caminho/para/dados.rds\u0026quot;)\r\r\rAn√°lises\rVamos brincar um pouco com esses dados?\nEmpresas por UF\rMinha hip√≥tese inicial era que o estado com maior quantidade de CNPJs por pessoa era SP. Mas isso n√£o √© verdade! Os estados do Sul est√£o dominando, junto com DF. S√£o Paulo aparece apenas na quarta posi√ß√£o.\n\r# voc√™ pode baixar o `abjData` do GitHub rodando\r# devtools::install_github(\u0026quot;abjur/abjData\u0026quot;)\r# rela√ß√£o de c√≥digos de UF e UFs\rcods \u0026lt;- abjData::cadmun %\u0026gt;% dplyr::select(uf_sigla = uf, uf_cod = UFCOD) %\u0026gt;% dplyr::distinct()\r# Popula√ß√£o de cada UF\rpop \u0026lt;- abjData::pnud_uf %\u0026gt;% dplyr::filter(ano == 2010) %\u0026gt;% dplyr::inner_join(cods, c(\u0026quot;uf\u0026quot; = \u0026quot;uf_cod\u0026quot;)) %\u0026gt;% dplyr::select(uf_sigla, popt)\r# fazendo o join das bases!\rempresas %\u0026gt;% dplyr::mutate(uf_sigla = stringr::str_extract(\rfile, \u0026quot;([A-Z]{2})(?=\\\\.txt)\u0026quot;)) %\u0026gt;% dplyr::inner_join(pop, \u0026quot;uf_sigla\u0026quot;) %\u0026gt;%\r# calculando a raz√£o entre popula√ß√£o e quantidade de empresas\rdplyr::group_by(uf_sigla) %\u0026gt;% dplyr::summarise(n = n(), pop = dplyr::first(popt),\rprop = n / pop) %\u0026gt;% dplyr::arrange(dplyr::desc(prop)) %\u0026gt;% dplyr::mutate(prop = scales::percent(prop)) %\u0026gt;% knitr::kable()\r\r\r\rUF\rQtd. Empresas\rPopula√ß√£o\rRaz√£o(%)\r\r\r\rSC\r498511\r6199948\r8.04%\r\rDF\r194734\r2541714\r7.66%\r\rPR\r708109\r10348243\r6.84%\r\rSP\r2730412\r40915382\r6.67%\r\rRS\r670093\r10593366\r6.33%\r\rGO\r328524\r5934767\r5.54%\r\rRJ\r843040\r15871448\r5.31%\r\rES\r179150\r3477472\r5.15%\r\rMG\r962930\r19383604\r4.97%\r\rMT\r141464\r2961977\r4.78%\r\rMS\r102208\r2404628\r4.25%\r\rRO\r62385\r1515025\r4.12%\r\rTO\r51629\r1349770\r3.83%\r\rSE\r63303\r2038459\r3.11%\r\rBA\r422396\r13755200\r3.07%\r\rRR\r11908\r421159\r2.83%\r\rPE\r224184\r8646409\r2.59%\r\rRN\r80562\r3127820\r2.58%\r\rAP\r15941\r652768\r2.44%\r\rCE\r193654\r8317604\r2.33%\r\rAC\r15690\r690774\r2.27%\r\rPA\r159079\r7247979\r2.19%\r\rPB\r79275\r3706991\r2.14%\r\rPI\r61627\r3050838\r2.02%\r\rAL\r60067\r3045851\r1.97%\r\rMA\r123736\r6317987\r1.96%\r\rAM\r64306\r3301221\r1.95%\r\r\r\r\rQuantidade de s√≥cios\rQual a distribui√ß√£o de quantidade de s√≥cios?\nPara responder √† essa pergunta, considerei apenas s√≥cios pessoa f√≠sica. N√£o fiz filtros de qualifica√ß√£o. Voc√™ tem alguma ideia de como poder√≠amos selecionar as qualifica√ß√µes corretas sobre a base de qualificacao?\n\r\rQtd. S√≥cios\rEmpresas\rPropor√ß√£o\r\r\r\r2\r5911971\r65.4%\r\r1\r2265100\r25.0%\r\r3\r551072\r6.1%\r\r4\r174558\r1.9%\r\r[5, 15]\r134898\r1.5%\r\r[16, 584]\r5714\r0.1%\r\r\r\rDois ter√ßos das empresas s√£o formadas por dois s√≥cios e 90% das empresas s√£o formadas por um ou dois s√≥cios.\nFiquei interessado em saber quais empresas est√£o na √∫ltima faixa de quantidade de s√≥cios. A tabela abaixo mostra as 10 empresas com mais s√≥cios nessa base. Al√©m da EY, n√£o conhe√ßo nenhuma das empresas abaixo. O que d√° para notar √© que boa parte delas est√° ligada ao ramo m√©dico.\n\r\r\r\rnome_empresarial\rn\r\r\r\rCOMED - CORPO MEDICO LTDA\r584\r\rQUIRON PRONTO SOCORRO LTDA - ME\r481\r\rSIMEA - SOCIEDADE INTEGRADA MEDICA DO AMAZONAS LTDA\r391\r\rNOVA FAMILIA LTDA - EPP\r371\r\rSOCIEDADE BAURUENSE DE PRESTACAO DE SERVICOS MEDICOS SOBAME\r347\r\rERNST \u0026amp; YOUNG ASSESSORIA EMPRESARIAL LTDA\r332\r\rUNIAO CONSULTORIA LTDA\r285\r\rINSTITUTO MEDICO DE CLINICA E PEDIATRIA DO ESTADO DO AMAZONAS S/S LTDA\r284\r\rUROLOGISTAS DO ESTADO DO RIO DE JANEIRO LTDA\r281\r\rSNC \u0026amp; CIA ADMINISTRACAO DE BENS\r277\r\r\r\r\rPessoas com mais empresas\rQuem s√£o os s√≥cios com maior n√∫mero de empresas? Temos abaixo uma lista dos 20 mais. Claramente, muitos desses nomes s√£o hom√¥nimos. O primeiro nome da lista que me parece pouco prov√°vel de ter hom√¥nimos √© o Renato Gamba Rocha Diniz. Tamb√©m fiquei interessado nesse ‚ÄúN√£o Consta na Base‚Äù‚Ä¶\n\r\rnome\rn_empresas\r\r\r\rJOSE CARLOS DA SILVA\r2084\r\rJOAO BATISTA DA SILVA\r1518\r\rLUIZ CARLOS DA SILVA\r1488\r\rMARIA APARECIDA DA SILVA\r1487\r\rANTONIO CARLOS DA SILVA\r1372\r\rJOSE CARLOS DOS SANTOS\r1339\r\rMARIA JOSE DA SILVA\r1119\r\rCARLOS ALBERTO DA SILVA\r1091\r\rJOSE CARLOS DE OLIVEIRA\r1055\r\rMARCOS ANTONIO DA SILVA\r1038\r\rNAO CONSTA NA BASE\r1035\r\rJOSE ANTONIO DA SILVA\r1017\r\rRENATO GAMBA ROCHA DINIZ\r946\r\rJOSE ROBERTO DA SILVA\r907\r\rLUIZ CARLOS DOS SANTOS\r882\r\rPAULO ROBERTO DA SILVA\r839\r\rJOSE PEREIRA DA SILVA\r804\r\rJOAO BATISTA DE OLIVEIRA\r770\r\rRENATA ROSSI CUPPOLONI RODRIGUES\r766\r\rANTONIO CARLOS DOS SANTOS\r762\r\r\r\r\rSexo dos s√≥cios\rAgora vamos usar o pacote genderBR para pegar o sexo mais prov√°vel de todas as pessoas. No total, temos 11.388.120 nomes √∫nicos na base (isso subestima a quantidade de pessoas, por conta de hom√¥nimos).\nPara essa an√°lise, tivemos de retirar 392.533 nomes em que o genderBR n√£o foi capaz de estimar o sexo. Isso corresponde a 2,2% da base. Creio que n√£o seja absurdo afirmar que os valores omitidos influenciam no resultado.\nNessa an√°lise tamb√©m n√£o desconsiderei pessoas que fazem parte de mais de uma empresa. Ou seja, se uma pessoa tem 2 ou mais empresas, ela √© contada 2 ou mais vezes.\nMinha hip√≥tese inicial era a de que ter√≠amos mais homens como s√≥cios de empresas, por raz√µes hist√≥ricas/culturais (e queremos mudar isso!). Aparentemente a hip√≥tese foi confirmada: 3/5 dos s√≥cios s√£o homens. Sugiro refinar essa an√°lise pela qualifica√ß√£o e pela repeti√ß√£o de pessoas em empresas distintas.\nsexo_socios \u0026lt;- socios %\u0026gt;% # apenas pessoas f√≠sicas\rdplyr::filter(indicador_cpf_cnpj == \u0026quot;2\u0026quot;) %\u0026gt;% # extrai primeiro nome\rdplyr::mutate(primeiro_nome = stringr::str_extract(nome, \u0026quot;[^ ]+\u0026quot;)) %\u0026gt;%\r# conta primeiro nome\rdplyr::count(primeiro_nome) %\u0026gt;%\r# estima a probabilidade de ser do sexo feminino\rdplyr::mutate(sexo = genderBR::get_gender(primeiro_nome, prob = TRUE)) %\u0026gt;% # retira estima√ß√µes NA (cuidado!)\rdplyr::filter(!is.na(sexo))\rlibrary(ggplot2)\rgrafico \u0026lt;- sexo_socios %\u0026gt;% # √â feminino se sexo \u0026gt; 0.5 (mais de 50% feminino observado no IBGE)\rdplyr::mutate(sexo = dplyr::if_else(sexo \u0026gt; .5, \u0026quot;Fem\u0026quot;, \u0026quot;Masc\u0026quot;)) %\u0026gt;% dplyr::group_by(sexo) %\u0026gt;% dplyr::summarise(total = sum(n)) %\u0026gt;% dplyr::arrange(dplyr::desc(total)) %\u0026gt;%\r# adiciona propor√ß√£o em %\rdplyr::mutate(prop = scales::percent(total / sum(total))) %\u0026gt;% # aqui come√ßa o gr√°fico\rggplot(aes(x = sexo, y = total/1000, fill = sexo)) +\rgeom_col() +\r# daqui pra baixo √© s√≥ est√©tica\rcoord_flip() +\rgeom_text(aes(label = prop), size = 6, hjust = 1, vjust = -1) +\rtheme_minimal(16) +\rggtitle(\u0026quot;Quantidade de empresas por sexo\u0026quot;) +\rlabs(x = \u0026quot;Sexo\u0026quot;, y = \u0026quot;Total (milhares)\u0026quot;)\rgrafico\r\rAn√°lise Extra\rO Sillas sugeriu (e executou!) uma an√°lise adicional. A ideia era montar um grafo das empresas que compartilham s√≥cios da Comiss√£o de Valores Mobili√°rios (CVM). A CVM guarda informa√ß√µes de todas as empresas de capital aberto do Brasil. Uma investiga√ß√£o interessante √© estudar se os s√≥cios fazem parte de v√°rias empresas. A visualiza√ß√£o adequada para isso √© um grafo das companhias, ligados pela presen√ßa de s√≥cios com o mesmo nome.\nBaixando dados da CVM\r√â bem tranquilo baixar as informa√ß√µes das empresas cadastradas na CVM:\n\r# download do arquivo \\ipado\rlink \u0026lt;- \u0026quot;http://sistemas.cvm.gov.br/cadastro/SPW_CIA_ABERTA.ZIP\u0026quot;\rfile_name \u0026lt;- \u0026quot;~/Downloads/companhias.zip\u0026quot;\rhttr::GET(link, httr::write_disk(file_name))\r# dezipando arquivo\runzip(\u0026quot;companhias.zip\u0026quot;, exdir = \u0026quot;.\u0026quot;)\rcvm \u0026lt;- readr::read_delim(\rfile = \u0026quot;SPW_CIA_ABERTA.txt\u0026quot;, delim = \u0026quot;\\t\u0026quot;,\rcol_types = stringr::str_dup(\u0026quot;c\u0026quot;, 42),\rlocale = readr::locale(encoding = \u0026quot;latin1\u0026quot;)\r) %\u0026gt;% # limpa os nomes zoados\rjanitor::clean_names()\r# pega apenas empresas da CVM\rsocios_cvm \u0026lt;- socios %\u0026gt;% dplyr::inner_join(cvm, \u0026quot;cnpj\u0026quot;) %\u0026gt;% dplyr::filter(indicador_cpf_cnpj == \u0026quot;2\u0026quot;) %\u0026gt;% dplyr::distinct(cnpj, nome, .keep_all = TRUE)\r\rMontando o grafo\rCada n√≥ de nosso grafo √© uma empresa Uma aresta existe entre dois n√≥s se as empresas t√™m pelo menos uma pessoa em comum no quadro de s√≥cios. Para fazer o grafo, eu fiz uma pequena altera√ß√£o no c√≥digo que o Sillas me mandou, para usar o visNetwork (que √© din√¢mico) no lugar do ggraph (que √© lindo, por√©m est√°tico).\n# pequena limpeza na base\rempresas \u0026lt;- socios_cvm %\u0026gt;% dplyr::select(empresa = denom_comerc, pessoa = nome) %\u0026gt;% dplyr::mutate(empresa = abjutils::rm_accent(empresa)) %\u0026gt;% dplyr::distinct(empresa, pessoa)\r# arestas do grafo\redges \u0026lt;- dplyr::inner_join(empresas, empresas, by = \u0026quot;pessoa\u0026quot;) %\u0026gt;% dplyr::filter(empresa.x != empresa.y) %\u0026gt;% dplyr::distinct(empresa.x, empresa.y) %\u0026gt;% dplyr::rowwise() %\u0026gt;% # concatena as empresas de forma ordenada\rdplyr::mutate(concat = paste(sort(c(empresa.x, empresa.y)), collapse = \u0026quot;_\u0026quot;)) %\u0026gt;% dplyr::ungroup() %\u0026gt;% # tira arestas duplicadas\rdplyr::distinct(concat, .keep_all = TRUE) %\u0026gt;% dplyr::select(from = empresa.x, to = empresa.y)\r# n√≥s do grafo\rnodes \u0026lt;- empresas %\u0026gt;% dplyr::distinct(empresa, .keep_all = TRUE) %\u0026gt;% dplyr::transmute(id = empresa, label = empresa) %\u0026gt;% # apenas empresas com alguma conex√£o\rdplyr::filter(label %in% c(edges$from, edges$to))\r# guarda numa lista\rg \u0026lt;- list(nodes = nodes, edges = edges)\rlibrary(visNetwork)\rv \u0026lt;- visNetwork::visNetwork(g$nodes, g$edges)\rv \u0026lt;- visNetwork::visOptions(v, highlightNearest = TRUE,\rnodesIdSelection = TRUE)\rv\r\r{\"x\":{\"nodes\":{\"id\":[\"BOMPRECO - HIPER BOMPRECO\",\"BRASKEM\",\"POLIALDEN\",\"PRONOR\",\"NITROCARBONO\",\"TRIKEM SA\",\"POLITENO IND E COMERCIO S.A.\",\"OXITENO NORDESTE\",\"BBM PARTICIPACOES\",\"SEGUROS DA BAHIA\",\"ODEBRECHT\",\"BCO BOCOM BBM\",\"BCO ECONOMICO\",\"COELBA\",\"BANEB\",\"SIBRA\",\"CARAIBA METAIS S.A\",\"CONEPAR\",\"KIEPPE\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"J. MACEDO ALIM NORDESTE S/A - AGUIA S/A\",\"TELEST\",\"BRASPEROLA S/A\",\"TEBA\",\"ECO101 CONCESSIONARIA DE RODOVIAS S.A.\",\"SAMA\",\"BR HOME CENTERS S.A.\",\"ENERGISA MINAS GERAIS\",\"MAGNESITA S/A\",\"SIDERURGICA PAINS\",\"SANTANENSE\",\"BANCO CREDITO REAL DE MG\",\"COTEMINAS\",\"USIMINAS\",\"PARAIBUNA\",\"REDE ENERGIA PARTICIPACOES S.A.\",\"WEMBLEY SOCIEDADE ANONIMA\",\"MERCANTIL LEASING\",\"MERCANTIL BRASIL\",\"BANCO MERCANTIL DE INVESTIMENTOS SA\",\"CEMIG\",\"SAMITRI\",\"BANCO MERCANTIL DO BRASIL S/A\",\"TELEMIG\",\"SAAG INVESTIMENTOS S.A.\",\"CONCESSIONARIA BR-040 S.A.\",\"ENERSUL\",\"ALL - AMERICA LATINA LOGISTICA MALHA NORTE S.A.\",\"SID ACONORTE\",\"CELPE\",\"FIBRASIL TEXTIL\",\"BOMPRECO SUPERMERCADO\",\"BANCO BANESTADO\",\"HSBC SEGUROS BRASIL\",\"BCO BAMERINDUS DO BRASIL S.A. - EM LIQUIDACAO EXTRAJUDICIAL\",\"BAMERINDUS SA PARTICIPACOES E EMPREENDIMENTOS - EM LIQUIDACAO EXTRAJUDICIAL\",\"PINCEIS TIGRE\",\"COMPANHIA DE CREDITO FINANCIAMENTO E INVESTIMENTO RCI BRAISL\",\"CIA DE ARREND MERCANTIL RCI BRASIL\",\"HSBC LEASING\",\"BEMATECH S/A\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"EOX ENERGIA EOLICA S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"DELUXE MOTORS S.A\",\"ECTAS HOLDING S.A.\",\"DROGARIAS AMERICANAS SA\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"ETHOS SECURITIZADORA S/A\",\"LOGOS COMPANHIA SECURITIZADORA S/A\",\"SUL AMERICA STA CRUZ\",\"UNIAO DE SEGUROS\",\"IPIRANGA DISTRIBUIDORA\",\"NORDESTE QUIMICA\",\"AMIL PARTICIPACOES S/A\",\"FERRO LIGAS\",\"BRASIL TELECOM S.A.\",\"BTG PACTUAL SERVICOS FINANCEIROS S/A DTVM\",\"LIGHT\",\"CIMINAS\",\"BANGU DESENV\",\"SADE\",\"COMPANHIA DE EMBALAGENS METALICAS - MMSA\",\"IVI\",\"RHEEM EMPRS\",\"NORTEC QUIMICA S.A.\",\"SUL AMERICA S/A\",\"BANCO UBS PACTUAL S/A\",\"CAEMI\",\"NORBERTO ODEBRECHT\",\"FABRICA BANGU\",\"TELEMAR\",\"VOTEC\",\"SULACAP\",\"SUL AMERICA SEGUROS\",\"MUCISA\",\"FABRIMAR\",\"MOTORTEC\",\"PETROLEO IPIRANGA\",\"FININVEST\",\"CEDULA CFI\",\"BERJ\",\"BCO NACIONAL INV\",\"SATMA SUL AMERICA\",\"GERDAU S.A.\",\"IBM LEASING\",\"NACIONAL BANCO\",\"LINHAS DE MACAPA TRANSMISSORA DE ENERGIA S.A.\",\"LINHAS DE XINGU TRANSMISSORA DE ENERGIA S.A.\",\"AFLUENTE TRANSMISSAO DE ENERGIA ELETRICA S/A\",\"CENTENNIAL ASSET PARTICIPACOES SUDESTE S/A\",\"MLOG S.A.\",\"PRINER SERVICOS INDUSTRIAIS S.A.\",\"CONCESSIONARIA PONTE RIO-NITEROI S.A. - ECOPONTE\",\"TRIPLICE SECURITIZADORA DE ATIVOS MERCANTIS S.A.\",\"TRIUNFO SECURITIZADORA DE ATIVOS S.A.\",\"YARA BRASIL FERTILIZANTES S.A.\",\"TITAN\",\"VINICOLA RIOGRAND\",\"METALURGICA GERDAU\",\"INDAC - INDUSTRIA, ADM. E COMERCIO S.A.\",\"ADUBOS CRA\",\"BCO CRED REAL DO RS\",\"BANRISUL S.A. ADMINISTRADORA DE CONSORCIOS\",\"BANRISUL S/A\",\"BAGERGS\",\"ZIVI S/A\",\"CIA IOCHPE\",\"ELEVA\",\"FORJAS TAURUS SA\",\"CELULOSE IRANI\",\"DHB\",\"SDV\",\"SONAE DISTRIBUICAO BRASIL\",\"ANTARCTICA POLAR\",\"AMADEO ROSSI SA METALURGICA E MUNICOES\",\"CALCADOS AZALEIA S.A.\",\"SEIVA S.A. - FLORESTAS E INDUSTRIAS\",\"CIA HABITASUL DE PARTICIPACOES\",\"FRAS-LE S.A.\",\"GRANOLEO S/A\",\"STARA S.A. - INDUSTRIA DE IMPLEMENTOS AGRICOLAS\",\"NOVO HAMBURGO SEGS\",\"PETROPAR S.A.\",\"FUNDIROSSI\",\"SADIA\",\"CECRISA\",\"KARSTEN\",\"KUALA S.A.\",\"CHAPECO AVICOLA\",\"RENAUXVIEW\",\"CHAPECO\",\"BUNGE ALIMENTOS SA\",\"TIGRE\",\"EMBRACO\",\"COMPANHIA ENERGETICA JAGUARA\",\"COMPANHIA ENERGETICA MIRANDA\",\"ENERGISA SERGIPE\",\"BANCO ITABANCO S/A\",\"ERNESTO NEUGEBAUER\",\"HERCULES S/A\",\"BANK OF AMERICA - BRASIL S/A ( BANCO MULTIPLO )\",\"FERTISUL SA\",\"DURATEX\",\"PROMON TECNOLOGIA\",\"TECPART\",\"EPEDA\",\"FENICIAPAR S/A\",\"ZOGBI LEASING\",\"AGROCERES\",\"SID MICROELETRONICA\",\"ELUMA\",\"COMPANHIA BRASILEIRA DE CARTUCHOS - CBC\",\"COFAP\",\"RHODIA\",\"ODONTOPREV S/A\",\"BANCO SAFRA\",\"ALL - AMERICA LATINA LOGISTICA MALHA OESTE S.A.\",\"RACINVEST\",\"SID INFORMATICA\",\"WHIRLPOOL S.A\",\"BCP TELECOMUNICACOES\",\"BANCO PAN SA\",\"POLPAR S.A.\",\"EMBRAER\",\"ITAMARATI LEASING\",\"NOROESTE SEGURADORA\",\"SERRANA FERTILIZANTES SA\",\"GERAL DE CONCRETO S.A.\",\"PAPEL SAO ROBERTO\",\"MAHLE METAL LEVE\",\"KLABIN\",\"ANTARCTICA PAULISTA\",\"SAMCIL\",\"JEREISSATI PARTICIPACOES S/A\",\"DROGA RAIA\",\"SUZANO HOLDING S.A.\",\"ACOS VILLARES\",\"PEVE PARTICIPACOES\",\"BCO SANTANDER NOROESTE\",\"ITAU UNIBANCO\",\"BANCO BRADESCO S.A.\",\"ALFA DE INVESTIMENTO\",\"ALUSA\",\"ENIA\",\"BONFIGLIOLI\",\"SEARLE\",\"SANTANDER LEASING S.A. ARREND MERC\",\"BANCO BCN S.A.\",\"BANCO SUDAMERIS BRASIL SA\",\"BOAVISTA SA ARR MERC\",\"PAULISTA DE ENERGIA\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BCO BANDEIRANTES\",\"BUNGE BRASIL S.A.\",\"BUNGE FERTILIZANTES\",\"BRASMOTOR S.A\",\"FABRICACAO DE CIMENTO PORTLAND\",\"ETERNIT\",\"PROMON\",\"VIGOR\",\"PREMESA\",\"CBPO\",\"BANCO BMG\",\"BANCO COMERCIAL E DE INVESTIMENTO SUDAMERIS S.A.\",\"BENZENEX\",\"BANESPA\",\"VICU\",\"FERTIBRAS S/A\",\"BANCO NOSSA CAIXA S/A\",\"COINVEST CIA.DE INVESTIMENTOS INTERLAGOS\",\"D F VASCONCELLOS S/A O.M.A.P.\",\"CAMARGO CORREA\",\"ITAUSA\",\"CETENCO\",\"RACIONAL ENGENHARIA\",\"DROGASIL SA\",\"SECURIT\",\"MEDIAL SAUDE S/A\",\"AES ELETROPAULO\",\"CENTENARIO\",\"WAGNER\",\"BFB LEASING\",\"ARRENDAMENTO MERCANTIL\",\"BRADESPLAN PARTICIPACOES S.A.\",\"COMPANHIA DE GAS DE SAO PAULO - COMGAS\",\"SABESP\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"NORCHEM\",\"BANCO CRUZEIRO DO SUL SA\",\"UNIBANCO LEASING S.A.\",\"CAMARGO CORREA CIMENTOS SA\",\"BANESTADO LEASING\",\"OXITENO S.A. INDUSTRIA E COMERCIO\",\"USINA COSTA PINTO S/A ACUCAR E ALCOOL\",\"USINA S BARBARA\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"BCO BANDEIRANTES INVESTIMENTOS\",\"SPLICE\",\"AUXILIAR PART\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"SANTANDER LEASING S.A.\",\"VILLARES MECANICA\",\"SCOPUS\",\"PAO DE ACUCAR\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"TAM\",\"FINASA LEASING\",\"ABC BRASIL\",\"CPM BRAXIS S/A\",\"DIBENS LEASING SA\",\"ELEKEIROZ\",\"BANCO DE PERNAMBUCO S.A. - BANDEPE\",\"-\",\"MUNCK\",\"ITAULEASING\",\"PERDIGAO AGRO SA\",\"SAO CARLOS EMPREEND.E PARTICIPACOES S.A.\",\"PEVE PREDIOS S.A.\",\"MADEPAN\",\"COSAN SA INDUSTRIA E COMERCIO\",\"VULCABRAS S/A.\",\"HUMAITA\",\"IGUATEMI EMPRESA DE SHOPPING CENTERS S/A\",\"MUNDIAL\",\"ITAUTEC INFORMATICA S.A.\",\"GERDAU INFORMATICA\",\"ELEKEIROZ S/A\",\"CITI CP\",\"CMA PARTICIPACOES SA\",\"OPP PETROQUIMICA\",\"JSL S.A.\",\"TOTVS S.A\",\"SANTISTA TEXTIL S.A.\",\"ECONOMICO SA A M\",\"SANTISTA ALIMENTOS\",\"FISIBA\",\"CSN\",\"CPFL\",\"MELAMINA ULTRA SA INDUSTRIA QUIMICA\",\"BANCO SANTANDER (BRASIL) S.A.\",\"ULTRAPAR PARTICIPACOES SA\",\"LDC BIOENERGIA SA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"BANCO SANTANDER S.A.\",\"LA FONTE TELECOM S/A\",\"UNIBANCO SA\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"FIBRA LEASING SA ARREND MERC\",\"POLONIA\",\"UNIPAR CARBOCLORO S.A.\",\"AYMORE LEASING\",\"CREDICARD\",\"HSBC ASSET FINANCE (BRASIL) AR MERC S.A.\",\"BMG LEASING\",\"ULTRA PARTICIPACOES\",\"TEXTILIA\",\"ITAUTEC S.A. - GRUPO ITAUTEC\",\"BCO REAL\",\"ALFA HOLDINGS\",\"ALFA FINANCEIRA\",\"CONSORCIO ALFA\",\"BANCO ITAU BBA S.A.\",\"COPERSUCAR SA\",\"CONCESSIONARIA AUTO RAPOSO TAVARES SA-CART\",\"VIARONDON CONCESSIONARIA DE RODOVIA SA\",\"CVC BRASIL OPERADORA E AGENCIA DE VIAGENS SA\",\"CONCESSIONARIA DAS RODOVIAS AYRTON SENNA E CARVALHO PINTO S/A\",\"BRASIL PHARMA SA\",\"ROPASC PARTICIPACOES S/A\",\"FERREIRA GOMES ENERGIA S.A.\",\"VOSTOK PARTICIPACOES SA\",\"MENFIS PARTICIPACOES S/A\",\"HIDROVIAS DO BRASIL S.A.\",\"PATMOS PARTICIPACOES S/A\",\"EGEU PARTICIPACOES SA\",\"VIGOR ALIMENTOS S.A.\",\"HARPIA OMEGA PARTICIPACOES S.A.\",\"NISA PARTICIPACOES\",\"NAOMI PARTICIPACOES\",\"BELEZA PARTICIPACOES\",\"NOAH PARTICIPACOES\",\"GAIA FLORESTAL SECURITIZADORA S.A.\",\"JP PARTICIPACOES S.A.\",\"COSAN LOGISTICA S.A.\",\"GAIA CRED CIA SECURITIZADORA DE CREDITOS FINANCEIROS S.A.\",\"MOVIDA PARTICIPACOES S.A.\",\"BTGI QUARTZO PARTICIPACOES S.A.\",\"BTGI SAFIRA PARTICIPACOES S.A.\",\"FINSBURY PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"ARGO TRANSMISSAO DE ENERGIA S.A.\",\"ARGO ENERGIA EMPREENDIMENTOS E PARTICIPACOES S.A.\",\"VERT COMPANHIA SECURITIZADORA\",\"COMPANHIA SEC. DE CREDITOS FIN. CARTOES CONSIGNADOS BMG\"],\"label\":[\"BOMPRECO - HIPER BOMPRECO\",\"BRASKEM\",\"POLIALDEN\",\"PRONOR\",\"NITROCARBONO\",\"TRIKEM SA\",\"POLITENO IND E COMERCIO S.A.\",\"OXITENO NORDESTE\",\"BBM PARTICIPACOES\",\"SEGUROS DA BAHIA\",\"ODEBRECHT\",\"BCO BOCOM BBM\",\"BCO ECONOMICO\",\"COELBA\",\"BANEB\",\"SIBRA\",\"CARAIBA METAIS S.A\",\"CONEPAR\",\"KIEPPE\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"J. MACEDO ALIM NORDESTE S/A - AGUIA S/A\",\"TELEST\",\"BRASPEROLA S/A\",\"TEBA\",\"ECO101 CONCESSIONARIA DE RODOVIAS S.A.\",\"SAMA\",\"BR HOME CENTERS S.A.\",\"ENERGISA MINAS GERAIS\",\"MAGNESITA S/A\",\"SIDERURGICA PAINS\",\"SANTANENSE\",\"BANCO CREDITO REAL DE MG\",\"COTEMINAS\",\"USIMINAS\",\"PARAIBUNA\",\"REDE ENERGIA PARTICIPACOES S.A.\",\"WEMBLEY SOCIEDADE ANONIMA\",\"MERCANTIL LEASING\",\"MERCANTIL BRASIL\",\"BANCO MERCANTIL DE INVESTIMENTOS SA\",\"CEMIG\",\"SAMITRI\",\"BANCO MERCANTIL DO BRASIL S/A\",\"TELEMIG\",\"SAAG INVESTIMENTOS S.A.\",\"CONCESSIONARIA BR-040 S.A.\",\"ENERSUL\",\"ALL - AMERICA LATINA LOGISTICA MALHA NORTE S.A.\",\"SID ACONORTE\",\"CELPE\",\"FIBRASIL TEXTIL\",\"BOMPRECO SUPERMERCADO\",\"BANCO BANESTADO\",\"HSBC SEGUROS BRASIL\",\"BCO BAMERINDUS DO BRASIL S.A. - EM LIQUIDACAO EXTRAJUDICIAL\",\"BAMERINDUS SA PARTICIPACOES E EMPREENDIMENTOS - EM LIQUIDACAO EXTRAJUDICIAL\",\"PINCEIS TIGRE\",\"COMPANHIA DE CREDITO FINANCIAMENTO E INVESTIMENTO RCI BRAISL\",\"CIA DE ARREND MERCANTIL RCI BRASIL\",\"HSBC LEASING\",\"BEMATECH S/A\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"EOX ENERGIA EOLICA S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"DELUXE MOTORS S.A\",\"ECTAS HOLDING S.A.\",\"DROGARIAS AMERICANAS SA\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"ETHOS SECURITIZADORA S/A\",\"LOGOS COMPANHIA SECURITIZADORA S/A\",\"SUL AMERICA STA CRUZ\",\"UNIAO DE SEGUROS\",\"IPIRANGA DISTRIBUIDORA\",\"NORDESTE QUIMICA\",\"AMIL PARTICIPACOES S/A\",\"FERRO LIGAS\",\"BRASIL TELECOM S.A.\",\"BTG PACTUAL SERVICOS FINANCEIROS S/A DTVM\",\"LIGHT\",\"CIMINAS\",\"BANGU DESENV\",\"SADE\",\"COMPANHIA DE EMBALAGENS METALICAS - MMSA\",\"IVI\",\"RHEEM EMPRS\",\"NORTEC QUIMICA S.A.\",\"SUL AMERICA S/A\",\"BANCO UBS PACTUAL S/A\",\"CAEMI\",\"NORBERTO ODEBRECHT\",\"FABRICA BANGU\",\"TELEMAR\",\"VOTEC\",\"SULACAP\",\"SUL AMERICA SEGUROS\",\"MUCISA\",\"FABRIMAR\",\"MOTORTEC\",\"PETROLEO IPIRANGA\",\"FININVEST\",\"CEDULA CFI\",\"BERJ\",\"BCO NACIONAL INV\",\"SATMA SUL AMERICA\",\"GERDAU S.A.\",\"IBM LEASING\",\"NACIONAL BANCO\",\"LINHAS DE MACAPA TRANSMISSORA DE ENERGIA S.A.\",\"LINHAS DE XINGU TRANSMISSORA DE ENERGIA S.A.\",\"AFLUENTE TRANSMISSAO DE ENERGIA ELETRICA S/A\",\"CENTENNIAL ASSET PARTICIPACOES SUDESTE S/A\",\"MLOG S.A.\",\"PRINER SERVICOS INDUSTRIAIS S.A.\",\"CONCESSIONARIA PONTE RIO-NITEROI S.A. - ECOPONTE\",\"TRIPLICE SECURITIZADORA DE ATIVOS MERCANTIS S.A.\",\"TRIUNFO SECURITIZADORA DE ATIVOS S.A.\",\"YARA BRASIL FERTILIZANTES S.A.\",\"TITAN\",\"VINICOLA RIOGRAND\",\"METALURGICA GERDAU\",\"INDAC - INDUSTRIA, ADM. E COMERCIO S.A.\",\"ADUBOS CRA\",\"BCO CRED REAL DO RS\",\"BANRISUL S.A. ADMINISTRADORA DE CONSORCIOS\",\"BANRISUL S/A\",\"BAGERGS\",\"ZIVI S/A\",\"CIA IOCHPE\",\"ELEVA\",\"FORJAS TAURUS SA\",\"CELULOSE IRANI\",\"DHB\",\"SDV\",\"SONAE DISTRIBUICAO BRASIL\",\"ANTARCTICA POLAR\",\"AMADEO ROSSI SA METALURGICA E MUNICOES\",\"CALCADOS AZALEIA S.A.\",\"SEIVA S.A. - FLORESTAS E INDUSTRIAS\",\"CIA HABITASUL DE PARTICIPACOES\",\"FRAS-LE S.A.\",\"GRANOLEO S/A\",\"STARA S.A. - INDUSTRIA DE IMPLEMENTOS AGRICOLAS\",\"NOVO HAMBURGO SEGS\",\"PETROPAR S.A.\",\"FUNDIROSSI\",\"SADIA\",\"CECRISA\",\"KARSTEN\",\"KUALA S.A.\",\"CHAPECO AVICOLA\",\"RENAUXVIEW\",\"CHAPECO\",\"BUNGE ALIMENTOS SA\",\"TIGRE\",\"EMBRACO\",\"COMPANHIA ENERGETICA JAGUARA\",\"COMPANHIA ENERGETICA MIRANDA\",\"ENERGISA SERGIPE\",\"BANCO ITABANCO S/A\",\"ERNESTO NEUGEBAUER\",\"HERCULES S/A\",\"BANK OF AMERICA - BRASIL S/A ( BANCO MULTIPLO )\",\"FERTISUL SA\",\"DURATEX\",\"PROMON TECNOLOGIA\",\"TECPART\",\"EPEDA\",\"FENICIAPAR S/A\",\"ZOGBI LEASING\",\"AGROCERES\",\"SID MICROELETRONICA\",\"ELUMA\",\"COMPANHIA BRASILEIRA DE CARTUCHOS - CBC\",\"COFAP\",\"RHODIA\",\"ODONTOPREV S/A\",\"BANCO SAFRA\",\"ALL - AMERICA LATINA LOGISTICA MALHA OESTE S.A.\",\"RACINVEST\",\"SID INFORMATICA\",\"WHIRLPOOL S.A\",\"BCP TELECOMUNICACOES\",\"BANCO PAN SA\",\"POLPAR S.A.\",\"EMBRAER\",\"ITAMARATI LEASING\",\"NOROESTE SEGURADORA\",\"SERRANA FERTILIZANTES SA\",\"GERAL DE CONCRETO S.A.\",\"PAPEL SAO ROBERTO\",\"MAHLE METAL LEVE\",\"KLABIN\",\"ANTARCTICA PAULISTA\",\"SAMCIL\",\"JEREISSATI PARTICIPACOES S/A\",\"DROGA RAIA\",\"SUZANO HOLDING S.A.\",\"ACOS VILLARES\",\"PEVE PARTICIPACOES\",\"BCO SANTANDER NOROESTE\",\"ITAU UNIBANCO\",\"BANCO BRADESCO S.A.\",\"ALFA DE INVESTIMENTO\",\"ALUSA\",\"ENIA\",\"BONFIGLIOLI\",\"SEARLE\",\"SANTANDER LEASING S.A. ARREND MERC\",\"BANCO BCN S.A.\",\"BANCO SUDAMERIS BRASIL SA\",\"BOAVISTA SA ARR MERC\",\"PAULISTA DE ENERGIA\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BCO BANDEIRANTES\",\"BUNGE BRASIL S.A.\",\"BUNGE FERTILIZANTES\",\"BRASMOTOR S.A\",\"FABRICACAO DE CIMENTO PORTLAND\",\"ETERNIT\",\"PROMON\",\"VIGOR\",\"PREMESA\",\"CBPO\",\"BANCO BMG\",\"BANCO COMERCIAL E DE INVESTIMENTO SUDAMERIS S.A.\",\"BENZENEX\",\"BANESPA\",\"VICU\",\"FERTIBRAS S/A\",\"BANCO NOSSA CAIXA S/A\",\"COINVEST CIA.DE INVESTIMENTOS INTERLAGOS\",\"D F VASCONCELLOS S/A O.M.A.P.\",\"CAMARGO CORREA\",\"ITAUSA\",\"CETENCO\",\"RACIONAL ENGENHARIA\",\"DROGASIL SA\",\"SECURIT\",\"MEDIAL SAUDE S/A\",\"AES ELETROPAULO\",\"CENTENARIO\",\"WAGNER\",\"BFB LEASING\",\"ARRENDAMENTO MERCANTIL\",\"BRADESPLAN PARTICIPACOES S.A.\",\"COMPANHIA DE GAS DE SAO PAULO - COMGAS\",\"SABESP\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"NORCHEM\",\"BANCO CRUZEIRO DO SUL SA\",\"UNIBANCO LEASING S.A.\",\"CAMARGO CORREA CIMENTOS SA\",\"BANESTADO LEASING\",\"OXITENO S.A. INDUSTRIA E COMERCIO\",\"USINA COSTA PINTO S/A ACUCAR E ALCOOL\",\"USINA S BARBARA\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"BCO BANDEIRANTES INVESTIMENTOS\",\"SPLICE\",\"AUXILIAR PART\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"SANTANDER LEASING S.A.\",\"VILLARES MECANICA\",\"SCOPUS\",\"PAO DE ACUCAR\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"TAM\",\"FINASA LEASING\",\"ABC BRASIL\",\"CPM BRAXIS S/A\",\"DIBENS LEASING SA\",\"ELEKEIROZ\",\"BANCO DE PERNAMBUCO S.A. - BANDEPE\",\"-\",\"MUNCK\",\"ITAULEASING\",\"PERDIGAO AGRO SA\",\"SAO CARLOS EMPREEND.E PARTICIPACOES S.A.\",\"PEVE PREDIOS S.A.\",\"MADEPAN\",\"COSAN SA INDUSTRIA E COMERCIO\",\"VULCABRAS S/A.\",\"HUMAITA\",\"IGUATEMI EMPRESA DE SHOPPING CENTERS S/A\",\"MUNDIAL\",\"ITAUTEC INFORMATICA S.A.\",\"GERDAU INFORMATICA\",\"ELEKEIROZ S/A\",\"CITI CP\",\"CMA PARTICIPACOES SA\",\"OPP PETROQUIMICA\",\"JSL S.A.\",\"TOTVS S.A\",\"SANTISTA TEXTIL S.A.\",\"ECONOMICO SA A M\",\"SANTISTA ALIMENTOS\",\"FISIBA\",\"CSN\",\"CPFL\",\"MELAMINA ULTRA SA INDUSTRIA QUIMICA\",\"BANCO SANTANDER (BRASIL) S.A.\",\"ULTRAPAR PARTICIPACOES SA\",\"LDC BIOENERGIA SA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"BANCO SANTANDER S.A.\",\"LA FONTE TELECOM S/A\",\"UNIBANCO SA\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"FIBRA LEASING SA ARREND MERC\",\"POLONIA\",\"UNIPAR CARBOCLORO S.A.\",\"AYMORE LEASING\",\"CREDICARD\",\"HSBC ASSET FINANCE (BRASIL) AR MERC S.A.\",\"BMG LEASING\",\"ULTRA PARTICIPACOES\",\"TEXTILIA\",\"ITAUTEC S.A. - GRUPO ITAUTEC\",\"BCO REAL\",\"ALFA HOLDINGS\",\"ALFA FINANCEIRA\",\"CONSORCIO ALFA\",\"BANCO ITAU BBA S.A.\",\"COPERSUCAR SA\",\"CONCESSIONARIA AUTO RAPOSO TAVARES SA-CART\",\"VIARONDON CONCESSIONARIA DE RODOVIA SA\",\"CVC BRASIL OPERADORA E AGENCIA DE VIAGENS SA\",\"CONCESSIONARIA DAS RODOVIAS AYRTON SENNA E CARVALHO PINTO S/A\",\"BRASIL PHARMA SA\",\"ROPASC PARTICIPACOES S/A\",\"FERREIRA GOMES ENERGIA S.A.\",\"VOSTOK PARTICIPACOES SA\",\"MENFIS PARTICIPACOES S/A\",\"HIDROVIAS DO BRASIL S.A.\",\"PATMOS PARTICIPACOES S/A\",\"EGEU PARTICIPACOES SA\",\"VIGOR ALIMENTOS S.A.\",\"HARPIA OMEGA PARTICIPACOES S.A.\",\"NISA PARTICIPACOES\",\"NAOMI PARTICIPACOES\",\"BELEZA PARTICIPACOES\",\"NOAH PARTICIPACOES\",\"GAIA FLORESTAL SECURITIZADORA S.A.\",\"JP PARTICIPACOES S.A.\",\"COSAN LOGISTICA S.A.\",\"GAIA CRED CIA SECURITIZADORA DE CREDITOS FINANCEIROS S.A.\",\"MOVIDA PARTICIPACOES S.A.\",\"BTGI QUARTZO PARTICIPACOES S.A.\",\"BTGI SAFIRA PARTICIPACOES S.A.\",\"FINSBURY PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"ARGO TRANSMISSAO DE ENERGIA S.A.\",\"ARGO ENERGIA EMPREENDIMENTOS E PARTICIPACOES S.A.\",\"VERT COMPANHIA SECURITIZADORA\",\"COMPANHIA SEC. DE CREDITOS FIN. CARTOES CONSIGNADOS BMG\"]},\"edges\":{\"from\":[\"BOMPRECO - HIPER BOMPRECO\",\"BOMPRECO - HIPER BOMPRECO\",\"BRASKEM\",\"BRASKEM\",\"BRASKEM\",\"BRASKEM\",\"BRASKEM\",\"POLIALDEN\",\"POLIALDEN\",\"PRONOR\",\"PRONOR\",\"PRONOR\",\"NITROCARBONO\",\"TRIKEM SA\",\"OXITENO NORDESTE\",\"OXITENO NORDESTE\",\"OXITENO NORDESTE\",\"OXITENO NORDESTE\",\"BBM PARTICIPACOES\",\"ODEBRECHT\",\"BCO BOCOM BBM\",\"BCO ECONOMICO\",\"COELBA\",\"COELBA\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"BANEB\",\"SIBRA\",\"CARAIBA METAIS S.A\",\"CONEPAR\",\"CONEPAR\",\"KIEPPE\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"BANCO BILBAO VIZCAYA ARGENTARIA BRASILSA\",\"J. MACEDO ALIM NORDESTE S/A - AGUIA S/A\",\"J. MACEDO ALIM NORDESTE S/A - AGUIA S/A\",\"TELEST\",\"BRASPEROLA S/A\",\"ECO101 CONCESSIONARIA DE RODOVIAS S.A.\",\"ECO101 CONCESSIONARIA DE RODOVIAS S.A.\",\"SAMA\",\"SAMA\",\"BR HOME CENTERS S.A.\",\"ENERGISA MINAS GERAIS\",\"ENERGISA MINAS GERAIS\",\"ENERGISA MINAS GERAIS\",\"MAGNESITA S/A\",\"SIDERURGICA PAINS\",\"SIDERURGICA PAINS\",\"SANTANENSE\",\"SANTANENSE\",\"BANCO CREDITO REAL DE MG\",\"BANCO CREDITO REAL DE MG\",\"BANCO CREDITO REAL DE MG\",\"BANCO CREDITO REAL DE MG\",\"BANCO CREDITO REAL DE MG\",\"COTEMINAS\",\"USIMINAS\",\"PARAIBUNA\",\"REDE ENERGIA PARTICIPACOES S.A.\",\"REDE ENERGIA PARTICIPACOES S.A.\",\"MERCANTIL LEASING\",\"MERCANTIL LEASING\",\"MERCANTIL LEASING\",\"MERCANTIL BRASIL\",\"MERCANTIL BRASIL\",\"BANCO MERCANTIL DE INVESTIMENTOS SA\",\"CEMIG\",\"CEMIG\",\"CEMIG\",\"SAMITRI\",\"CONCESSIONARIA BR-040 S.A.\",\"ENERSUL\",\"ALL - AMERICA LATINA LOGISTICA MALHA NORTE S.A.\",\"ALL - AMERICA LATINA LOGISTICA MALHA NORTE S.A.\",\"SID ACONORTE\",\"CELPE\",\"FIBRASIL TEXTIL\",\"FIBRASIL TEXTIL\",\"BOMPRECO SUPERMERCADO\",\"BANCO BANESTADO\",\"BANCO BANESTADO\",\"BANCO BANESTADO\",\"BANCO BANESTADO\",\"BANCO BANESTADO\",\"BANCO BANESTADO\",\"HSBC SEGUROS BRASIL\",\"HSBC SEGUROS BRASIL\",\"BCO BAMERINDUS DO BRASIL S.A. - EM LIQUIDACAO EXTRAJUDICIAL\",\"BCO BAMERINDUS DO BRASIL S.A. - EM LIQUIDACAO EXTRAJUDICIAL\",\"BCO BAMERINDUS DO BRASIL S.A. - EM LIQUIDACAO EXTRAJUDICIAL\",\"BCO BAMERINDUS DO BRASIL S.A. - EM LIQUIDACAO EXTRAJUDICIAL\",\"BAMERINDUS SA PARTICIPACOES E EMPREENDIMENTOS - EM LIQUIDACAO EXTRAJUDICIAL\",\"BAMERINDUS SA PARTICIPACOES E EMPREENDIMENTOS - EM LIQUIDACAO EXTRAJUDICIAL\",\"BAMERINDUS SA PARTICIPACOES E EMPREENDIMENTOS - EM LIQUIDACAO EXTRAJUDICIAL\",\"PINCEIS TIGRE\",\"PINCEIS TIGRE\",\"COMPANHIA DE CREDITO FINANCIAMENTO E INVESTIMENTO RCI BRAISL\",\"COMPANHIA DE CREDITO FINANCIAMENTO E INVESTIMENTO RCI BRAISL\",\"CIA DE ARREND MERCANTIL RCI BRASIL\",\"HSBC LEASING\",\"BEMATECH S/A\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"INTERMULTIMODAL S.A OPERADORA DE PLATAFORMAS INTERNACIONAIS DE LOGISTICA MULTIMODAL\",\"EOX ENERGIA EOLICA S.A.\",\"EOX ENERGIA EOLICA S.A.\",\"EOX ENERGIA EOLICA S.A.\",\"EOX ENERGIA EOLICA S.A.\",\"EOX ENERGIA EOLICA S.A.\",\"EOX ENERGIA EOLICA S.A.\",\"EOX ENERGIA EOLICA S.A.\",\"EOX ENERGIA EOLICA S.A.\",\"EOX ENERGIA EOLICA S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"DELUXE MOTORS S.A\",\"DELUXE MOTORS S.A\",\"DELUXE MOTORS S.A\",\"DELUXE MOTORS S.A\",\"DELUXE MOTORS S.A\",\"DELUXE MOTORS S.A\",\"DELUXE MOTORS S.A\",\"ECTAS HOLDING S.A.\",\"ECTAS HOLDING S.A.\",\"ECTAS HOLDING S.A.\",\"ECTAS HOLDING S.A.\",\"ECTAS HOLDING S.A.\",\"ECTAS HOLDING S.A.\",\"DROGARIAS AMERICANAS SA\",\"DROGARIAS AMERICANAS SA\",\"DROGARIAS AMERICANAS SA\",\"DROGARIAS AMERICANAS SA\",\"DROGARIAS AMERICANAS SA\",\"EKOPARKING SA\",\"EKOPARKING SA\",\"EKOPARKING SA\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"INTERCOSMETIC HOLDING S/A\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ETHOS SECURITIZADORA S/A\",\"SUL AMERICA STA CRUZ\",\"SUL AMERICA STA CRUZ\",\"SUL AMERICA STA CRUZ\",\"IPIRANGA DISTRIBUIDORA\",\"IPIRANGA DISTRIBUIDORA\",\"NORDESTE QUIMICA\",\"AMIL PARTICIPACOES S/A\",\"BRASIL TELECOM S.A.\",\"BTG PACTUAL SERVICOS FINANCEIROS S/A DTVM\",\"CIMINAS\",\"BANGU DESENV\",\"SADE\",\"COMPANHIA DE EMBALAGENS METALICAS - MMSA\",\"NORTEC QUIMICA S.A.\",\"SUL AMERICA S/A\",\"SUL AMERICA S/A\",\"BANCO UBS PACTUAL S/A\",\"NORBERTO ODEBRECHT\",\"VOTEC\",\"SULACAP\",\"SUL AMERICA SEGUROS\",\"MUCISA\",\"PETROLEO IPIRANGA\",\"FININVEST\",\"FININVEST\",\"FININVEST\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BERJ\",\"BCO NACIONAL INV\",\"BCO NACIONAL INV\",\"GERDAU S.A.\",\"GERDAU S.A.\",\"GERDAU S.A.\",\"GERDAU S.A.\",\"IBM LEASING\",\"LINHAS DE MACAPA TRANSMISSORA DE ENERGIA S.A.\",\"CENTENNIAL ASSET PARTICIPACOES SUDESTE S/A\",\"CONCESSIONARIA PONTE RIO-NITEROI S.A. - ECOPONTE\",\"TRIPLICE SECURITIZADORA DE ATIVOS MERCANTIS S.A.\",\"YARA BRASIL FERTILIZANTES S.A.\",\"YARA BRASIL FERTILIZANTES S.A.\",\"TITAN\",\"TITAN\",\"TITAN\",\"VINICOLA RIOGRAND\",\"VINICOLA RIOGRAND\",\"METALURGICA GERDAU\",\"METALURGICA GERDAU\",\"METALURGICA GERDAU\",\"INDAC - INDUSTRIA, ADM. E COMERCIO S.A.\",\"INDAC - INDUSTRIA, ADM. E COMERCIO S.A.\",\"ADUBOS CRA\",\"BCO CRED REAL DO RS\",\"BCO CRED REAL DO RS\",\"BCO CRED REAL DO RS\",\"BCO CRED REAL DO RS\",\"BCO CRED REAL DO RS\",\"BCO CRED REAL DO RS\",\"BCO CRED REAL DO RS\",\"BCO CRED REAL DO RS\",\"BANRISUL S.A. ADMINISTRADORA DE CONSORCIOS\",\"BANRISUL S/A\",\"ZIVI S/A\",\"ZIVI S/A\",\"CIA IOCHPE\",\"ELEVA\",\"FORJAS TAURUS SA\",\"FORJAS TAURUS SA\",\"CELULOSE IRANI\",\"CELULOSE IRANI\",\"DHB\",\"ANTARCTICA POLAR\",\"ANTARCTICA POLAR\",\"AMADEO ROSSI SA METALURGICA E MUNICOES\",\"CALCADOS AZALEIA S.A.\",\"SEIVA S.A. - FLORESTAS E INDUSTRIAS\",\"CIA HABITASUL DE PARTICIPACOES\",\"FRAS-LE S.A.\",\"NOVO HAMBURGO SEGS\",\"NOVO HAMBURGO SEGS\",\"NOVO HAMBURGO SEGS\",\"NOVO HAMBURGO SEGS\",\"NOVO HAMBURGO SEGS\",\"SADIA\",\"CECRISA\",\"KARSTEN\",\"KUALA S.A.\",\"CHAPECO AVICOLA\",\"BUNGE ALIMENTOS SA\",\"COMPANHIA ENERGETICA JAGUARA\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"BANCO ITABANCO S/A\",\"ERNESTO NEUGEBAUER\",\"HERCULES S/A\",\"BANK OF AMERICA - BRASIL S/A ( BANCO MULTIPLO )\",\"FERTISUL SA\",\"FERTISUL SA\",\"DURATEX\",\"DURATEX\",\"DURATEX\",\"DURATEX\",\"DURATEX\",\"DURATEX\",\"PROMON TECNOLOGIA\",\"EPEDA\",\"ZOGBI LEASING\",\"ZOGBI LEASING\",\"ZOGBI LEASING\",\"ZOGBI LEASING\",\"ZOGBI LEASING\",\"ZOGBI LEASING\",\"AGROCERES\",\"SID MICROELETRONICA\",\"COMPANHIA BRASILEIRA DE CARTUCHOS - CBC\",\"COFAP\",\"RHODIA\",\"ODONTOPREV S/A\",\"BANCO SAFRA\",\"ALL - AMERICA LATINA LOGISTICA MALHA OESTE S.A.\",\"RACINVEST\",\"WHIRLPOOL S.A\",\"BCP TELECOMUNICACOES\",\"BANCO PAN SA\",\"BANCO PAN SA\",\"BANCO PAN SA\",\"BANCO PAN SA\",\"BANCO PAN SA\",\"BANCO PAN SA\",\"BANCO PAN SA\",\"BANCO PAN SA\",\"BANCO PAN SA\",\"POLPAR S.A.\",\"POLPAR S.A.\",\"EMBRAER\",\"ITAMARATI LEASING\",\"ITAMARATI LEASING\",\"ITAMARATI LEASING\",\"ITAMARATI LEASING\",\"ITAMARATI LEASING\",\"ITAMARATI LEASING\",\"ITAMARATI LEASING\",\"ITAMARATI LEASING\",\"NOROESTE SEGURADORA\",\"NOROESTE SEGURADORA\",\"NOROESTE SEGURADORA\",\"NOROESTE SEGURADORA\",\"SERRANA FERTILIZANTES SA\",\"SERRANA FERTILIZANTES SA\",\"GERAL DE CONCRETO S.A.\",\"SAMCIL\",\"SAMCIL\",\"JEREISSATI PARTICIPACOES S/A\",\"JEREISSATI PARTICIPACOES S/A\",\"JEREISSATI PARTICIPACOES S/A\",\"DROGA RAIA\",\"SUZANO HOLDING S.A.\",\"PEVE PARTICIPACOES\",\"PEVE PARTICIPACOES\",\"PEVE PARTICIPACOES\",\"PEVE PARTICIPACOES\",\"PEVE PARTICIPACOES\",\"PEVE PARTICIPACOES\",\"PEVE PARTICIPACOES\",\"PEVE PARTICIPACOES\",\"PEVE PARTICIPACOES\",\"BCO SANTANDER NOROESTE\",\"BCO SANTANDER NOROESTE\",\"BCO SANTANDER NOROESTE\",\"BCO SANTANDER NOROESTE\",\"BCO SANTANDER NOROESTE\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"ITAU UNIBANCO\",\"BANCO BRADESCO S.A.\",\"BANCO BRADESCO S.A.\",\"BANCO BRADESCO S.A.\",\"BANCO BRADESCO S.A.\",\"BANCO BRADESCO S.A.\",\"BANCO BRADESCO S.A.\",\"BANCO BRADESCO S.A.\",\"BANCO BRADESCO S.A.\",\"ALFA DE INVESTIMENTO\",\"ALFA DE INVESTIMENTO\",\"ALFA DE INVESTIMENTO\",\"ALFA DE INVESTIMENTO\",\"ALFA DE INVESTIMENTO\",\"ALUSA\",\"BONFIGLIOLI\",\"SANTANDER LEASING S.A. ARREND MERC\",\"SANTANDER LEASING S.A. ARREND MERC\",\"SANTANDER LEASING S.A. ARREND MERC\",\"SANTANDER LEASING S.A. ARREND MERC\",\"SANTANDER LEASING S.A. ARREND MERC\",\"BANCO BCN S.A.\",\"BANCO BCN S.A.\",\"BANCO BCN S.A.\",\"BANCO BCN S.A.\",\"BANCO BCN S.A.\",\"BANCO BCN S.A.\",\"BANCO BCN S.A.\",\"BANCO SUDAMERIS BRASIL SA\",\"BANCO SUDAMERIS BRASIL SA\",\"BANCO SUDAMERIS BRASIL SA\",\"BOAVISTA SA ARR MERC\",\"BOAVISTA SA ARR MERC\",\"BOAVISTA SA ARR MERC\",\"BOAVISTA SA ARR MERC\",\"BOAVISTA SA ARR MERC\",\"BOAVISTA SA ARR MERC\",\"BOAVISTA SA ARR MERC\",\"BOAVISTA SA ARR MERC\",\"PAULISTA DE ENERGIA\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BCO BANDEIRANTES\",\"BCO BANDEIRANTES\",\"BCO BANDEIRANTES\",\"BCO BANDEIRANTES\",\"BCO BANDEIRANTES\",\"BCO BANDEIRANTES\",\"BCO BANDEIRANTES\",\"BCO BANDEIRANTES\",\"BCO BANDEIRANTES\",\"BUNGE BRASIL S.A.\",\"FABRICACAO DE CIMENTO PORTLAND\",\"FABRICACAO DE CIMENTO PORTLAND\",\"ETERNIT\",\"ETERNIT\",\"ETERNIT\",\"VIGOR\",\"VIGOR\",\"BANCO BMG\",\"BANCO BMG\",\"BANCO BMG\",\"DURATEX\",\"BANCO COMERCIAL E DE INVESTIMENTO SUDAMERIS S.A.\",\"BANCO COMERCIAL E DE INVESTIMENTO SUDAMERIS S.A.\",\"BENZENEX\",\"BANESPA\",\"BANESPA\",\"BANESPA\",\"BANESPA\",\"VICU\",\"VICU\",\"VICU\",\"BANCO NOSSA CAIXA S/A\",\"COINVEST CIA.DE INVESTIMENTOS INTERLAGOS\",\"CAMARGO CORREA\",\"ITAUSA\",\"ITAUSA\",\"ITAUSA\",\"ITAUSA\",\"ITAUSA\",\"CETENCO\",\"AES ELETROPAULO\",\"BFB LEASING\",\"BFB LEASING\",\"BFB LEASING\",\"BFB LEASING\",\"BFB LEASING\",\"BFB LEASING\",\"BFB LEASING\",\"ARRENDAMENTO MERCANTIL\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"COMPANHIA DE GAS DE SAO PAULO - COMGAS\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"NORCHEM\",\"NORCHEM\",\"NORCHEM\",\"BANCO CRUZEIRO DO SUL SA\",\"CAMARGO CORREA CIMENTOS SA\",\"BANESTADO LEASING\",\"BANESTADO LEASING\",\"BANESTADO LEASING\",\"BANESTADO LEASING\",\"BANESTADO LEASING\",\"BANESTADO LEASING\",\"BANESTADO LEASING\",\"OXITENO S.A. INDUSTRIA E COMERCIO\",\"USINA COSTA PINTO S/A ACUCAR E ALCOOL\",\"USINA COSTA PINTO S/A ACUCAR E ALCOOL\",\"USINA COSTA PINTO S/A ACUCAR E ALCOOL\",\"USINA COSTA PINTO S/A ACUCAR E ALCOOL\",\"USINA S BARBARA\",\"USINA S BARBARA\",\"USINA S BARBARA\",\"BRADESCO BCN LEASING\",\"BRADESCO BCN LEASING\",\"BRADESCO BCN LEASING\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"BANCOCIDADE LEASING\",\"BANCOCIDADE LEASING\",\"SPLICE\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"SANTANDER LEASING S.A.\",\"SANTANDER LEASING S.A.\",\"SANTANDER LEASING S.A.\",\"SCOPUS\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"TAM\",\"FINASA LEASING\",\"DIBENS LEASING SA\",\"DIBENS LEASING SA\",\"DIBENS LEASING SA\",\"DIBENS LEASING SA\",\"DIBENS LEASING SA\",\"ELEKEIROZ\",\"ELEKEIROZ\",\"BANCO DE PERNAMBUCO S.A. - BANDEPE\",\"BANCO DE PERNAMBUCO S.A. - BANDEPE\",\"ITAULEASING\",\"ITAULEASING\",\"ITAULEASING\",\"ITAULEASING\",\"SAO CARLOS EMPREEND.E PARTICIPACOES S.A.\",\"MADEPAN\",\"COSAN SA INDUSTRIA E COMERCIO\",\"COSAN SA INDUSTRIA E COMERCIO\",\"HUMAITA\",\"IGUATEMI EMPRESA DE SHOPPING CENTERS S/A\",\"ITAUTEC INFORMATICA S.A.\",\"ITAUTEC INFORMATICA S.A.\",\"ELEKEIROZ S/A\",\"CITI CP\",\"CITI CP\",\"CITI CP\",\"JSL S.A.\",\"CSN\",\"CSN\",\"MELAMINA ULTRA SA INDUSTRIA QUIMICA\",\"BANCO SANTANDER (BRASIL) S.A.\",\"BANCO SANTANDER (BRASIL) S.A.\",\"ULTRAPAR PARTICIPACOES SA\",\"UNIBANCO SA\",\"UNIBANCO SA\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"FIBRA LEASING SA ARREND MERC\",\"AYMORE LEASING\",\"CREDICARD\",\"ALFA HOLDINGS\",\"ALFA HOLDINGS\",\"ALFA FINANCEIRA\",\"BRASIL PHARMA SA\",\"BRASIL PHARMA SA\",\"BRASIL PHARMA SA\",\"ROPASC PARTICIPACOES S/A\",\"ROPASC PARTICIPACOES S/A\",\"ROPASC PARTICIPACOES S/A\",\"ROPASC PARTICIPACOES S/A\",\"VOSTOK PARTICIPACOES SA\",\"VOSTOK PARTICIPACOES SA\",\"VOSTOK PARTICIPACOES SA\",\"MENFIS PARTICIPACOES S/A\",\"MENFIS PARTICIPACOES S/A\",\"HIDROVIAS DO BRASIL S.A.\",\"HIDROVIAS DO BRASIL S.A.\",\"PATMOS PARTICIPACOES S/A\",\"HARPIA OMEGA PARTICIPACOES S.A.\",\"HARPIA OMEGA PARTICIPACOES S.A.\",\"NISA PARTICIPACOES\",\"NISA PARTICIPACOES\",\"NISA PARTICIPACOES\",\"NISA PARTICIPACOES\",\"NISA PARTICIPACOES\",\"NISA PARTICIPACOES\",\"NISA PARTICIPACOES\",\"NAOMI PARTICIPACOES\",\"NAOMI PARTICIPACOES\",\"NAOMI PARTICIPACOES\",\"NAOMI PARTICIPACOES\",\"NAOMI PARTICIPACOES\",\"NAOMI PARTICIPACOES\",\"BELEZA PARTICIPACOES\",\"BELEZA PARTICIPACOES\",\"BELEZA PARTICIPACOES\",\"BELEZA PARTICIPACOES\",\"BELEZA PARTICIPACOES\",\"NOAH PARTICIPACOES\",\"NOAH PARTICIPACOES\",\"NOAH PARTICIPACOES\",\"NOAH PARTICIPACOES\",\"GAIA FLORESTAL SECURITIZADORA S.A.\",\"BTGI QUARTZO PARTICIPACOES S.A.\",\"FINSBURY PARTICIPACOES S.A.\",\"FINSBURY PARTICIPACOES S.A.\",\"FINSBURY PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"ARGO TRANSMISSAO DE ENERGIA S.A.\",\"VERT COMPANHIA SECURITIZADORA\"],\"to\":[\"BOMPRECO SUPERMERCADO\",\"SONAE DISTRIBUICAO BRASIL\",\"CONEPAR\",\"ODEBRECHT\",\"KIEPPE\",\"POLITENO IND E COMERCIO S.A.\",\"MLOG S.A.\",\"KIEPPE\",\"OPP PETROQUIMICA\",\"NITROCARBONO\",\"BBM PARTICIPACOES\",\"SEGUROS DA BAHIA\",\"BBM PARTICIPACOES\",\"LDC BIOENERGIA SA\",\"OXITENO S.A. INDUSTRIA E COMERCIO\",\"ULTRAPAR PARTICIPACOES SA\",\"MELAMINA ULTRA SA INDUSTRIA QUIMICA\",\"ULTRA PARTICIPACOES\",\"SEGUROS DA BAHIA\",\"KIEPPE\",\"FIBRA LEASING SA ARREND MERC\",\"ECONOMICO SA A M\",\"CELPE\",\"AFLUENTE TRANSMISSAO DE ENERGIA ELETRICA S/A\",\"BCO CRED REAL DO RS\",\"NOVO HAMBURGO SEGS\",\"BOAVISTA SA ARR MERC\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO BCN LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BANCO ITABANCO S/A\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BANCOCIDADE LEASING\",\"BANCO CREDITO REAL DE MG\",\"BANCO BCN S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BERJ\",\"PEVE PARTICIPACOES\",\"BANCO BRADESCO S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"FERRO LIGAS\",\"ELUMA\",\"COSAN SA INDUSTRIA E COMERCIO\",\"COSAN LOGISTICA S.A.\",\"OPP PETROQUIMICA\",\"BERJ\",\"BANCO ITABANCO S/A\",\"ZOGBI LEASING\",\"PEVE PARTICIPACOES\",\"BANCO BRADESCO S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"HUMAITA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"SADIA\",\"PERDIGAO AGRO SA\",\"TELEMIG\",\"TEBA\",\"CONCESSIONARIA PONTE RIO-NITEROI S.A. - ECOPONTE\",\"CONCESSIONARIA DAS RODOVIAS AYRTON SENNA E CARVALHO PINTO S/A\",\"ETERNIT\",\"WAGNER\",\"PRINER SERVICOS INDUSTRIAIS S.A.\",\"REDE ENERGIA PARTICIPACOES S.A.\",\"ENERSUL\",\"ENERGISA SERGIPE\",\"PAO DE ACUCAR\",\"SID ACONORTE\",\"INDAC - INDUSTRIA, ADM. E COMERCIO S.A.\",\"COTEMINAS\",\"WEMBLEY SOCIEDADE ANONIMA\",\"BOAVISTA SA ARR MERC\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"BERJ\",\"WEMBLEY SOCIEDADE ANONIMA\",\"KLABIN\",\"CAEMI\",\"ENERSUL\",\"ENERGISA SERGIPE\",\"MERCANTIL BRASIL\",\"BANCO MERCANTIL DE INVESTIMENTOS SA\",\"BANCO MERCANTIL DO BRASIL S/A\",\"BANCO MERCANTIL DO BRASIL S/A\",\"BANCO MERCANTIL DE INVESTIMENTOS SA\",\"BANCO MERCANTIL DO BRASIL S/A\",\"SAAG INVESTIMENTOS S.A.\",\"LIGHT\",\"FRAS-LE S.A.\",\"CENTENNIAL ASSET PARTICIPACOES SUDESTE S/A\",\"CONCESSIONARIA AUTO RAPOSO TAVARES SA-CART\",\"ENERGISA SERGIPE\",\"ALL - AMERICA LATINA LOGISTICA MALHA OESTE S.A.\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"INDAC - INDUSTRIA, ADM. E COMERCIO S.A.\",\"AFLUENTE TRANSMISSAO DE ENERGIA ELETRICA S/A\",\"FIBRA LEASING SA ARREND MERC\",\"TEXTILIA\",\"SONAE DISTRIBUICAO BRASIL\",\"ARRENDAMENTO MERCANTIL\",\"ITAU UNIBANCO\",\"BANCO BMG\",\"BFB LEASING\",\"BMG LEASING\",\"COPERSUCAR SA\",\"UNIAO DE SEGUROS\",\"BANCO BRADESCO S.A.\",\"BAMERINDUS SA PARTICIPACOES E EMPREENDIMENTOS - EM LIQUIDACAO EXTRAJUDICIAL\",\"BANCO UBS PACTUAL S/A\",\"BTG PACTUAL SERVICOS FINANCEIROS S/A DTVM\",\"ITAMARATI LEASING\",\"BANCO UBS PACTUAL S/A\",\"BTG PACTUAL SERVICOS FINANCEIROS S/A DTVM\",\"ITAMARATI LEASING\",\"TIGRE\",\"FABRIMAR\",\"CIA DE ARREND MERCANTIL RCI BRASIL\",\"BANCO SANTANDER (BRASIL) S.A.\",\"BANCO SANTANDER (BRASIL) S.A.\",\"HSBC ASSET FINANCE (BRASIL) AR MERC S.A.\",\"TOTVS S.A\",\"EOX ENERGIA EOLICA S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"DELUXE MOTORS S.A\",\"ECTAS HOLDING S.A.\",\"DROGARIAS AMERICANAS SA\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"LOUCOS POR FUTEBOL S.A.\",\"DELUXE MOTORS S.A\",\"ECTAS HOLDING S.A.\",\"DROGARIAS AMERICANAS SA\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"DELUXE MOTORS S.A\",\"ECTAS HOLDING S.A.\",\"DROGARIAS AMERICANAS SA\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"ECTAS HOLDING S.A.\",\"DROGARIAS AMERICANAS SA\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"DROGARIAS AMERICANAS SA\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"EKOPARKING SA\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"INTERCOSMETIC HOLDING S/A\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"COMPANHIA FERRIFERA BRASILEIRA S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"TECNO WASTE S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"ATIVOS BRASILEIROS S.A.\",\"LOGOS COMPANHIA SECURITIZADORA S/A\",\"SUL AMERICA S/A\",\"SUL AMERICA SEGUROS\",\"SATMA SUL AMERICA\",\"PETROLEO IPIRANGA\",\"ULTRAPAR PARTICIPACOES SA\",\"ENIA\",\"MEDIAL SAUDE S/A\",\"TELEMAR\",\"BANCO UBS PACTUAL S/A\",\"EMBRACO\",\"FABRICA BANGU\",\"IVI\",\"RHEEM EMPRS\",\"STARA S.A. - INDUSTRIA DE IMPLEMENTOS AGRICOLAS\",\"SUL AMERICA SEGUROS\",\"SATMA SUL AMERICA\",\"ITAMARATI LEASING\",\"CBPO\",\"MOTORTEC\",\"SATMA SUL AMERICA\",\"SATMA SUL AMERICA\",\"CEDULA CFI\",\"ULTRAPAR PARTICIPACOES SA\",\"UNIBANCO LEASING S.A.\",\"ITAU UNIBANCO\",\"BCO BANDEIRANTES\",\"BANCO ITABANCO S/A\",\"ZOGBI LEASING\",\"PEVE PARTICIPACOES\",\"BANCO BRADESCO S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"HUMAITA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"BOAVISTA SA ARR MERC\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"IGUATEMI EMPRESA DE SHOPPING CENTERS S/A\",\"NACIONAL BANCO\",\"METALURGICA GERDAU\",\"INDAC - INDUSTRIA, ADM. E COMERCIO S.A.\",\"SEIVA S.A. - FLORESTAS E INDUSTRIAS\",\"ACOS VILLARES\",\"GERDAU INFORMATICA\",\"LINHAS DE XINGU TRANSMISSORA DE ENERGIA S.A.\",\"MLOG S.A.\",\"CONCESSIONARIA DAS RODOVIAS AYRTON SENNA E CARVALHO PINTO S/A\",\"TRIUNFO SECURITIZADORA DE ATIVOS S.A.\",\"BENZENEX\",\"FERTIBRAS S/A\",\"VINICOLA RIOGRAND\",\"DHB\",\"SDV\",\"DHB\",\"SDV\",\"SEIVA S.A. - FLORESTAS E INDUSTRIAS\",\"INDAC - INDUSTRIA, ADM. E COMERCIO S.A.\",\"ACOS VILLARES\",\"SEIVA S.A. - FLORESTAS E INDUSTRIAS\",\"ACOS VILLARES\",\"PETROPAR S.A.\",\"NOVO HAMBURGO SEGS\",\"BOAVISTA SA ARR MERC\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO BCN LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BANCOCIDADE LEASING\",\"BANRISUL S/A\",\"BAGERGS\",\"HERCULES S/A\",\"MUNDIAL\",\"COSAN SA INDUSTRIA E COMERCIO\",\"GRANOLEO S/A\",\"COMPANHIA BRASILEIRA DE CARTUCHOS - CBC\",\"D F VASCONCELLOS S/A O.M.A.P.\",\"CIA HABITASUL DE PARTICIPACOES\",\"PAPEL SAO ROBERTO\",\"SDV\",\"ANTARCTICA PAULISTA\",\"FABRICACAO DE CIMENTO PORTLAND\",\"FUNDIROSSI\",\"VULCABRAS S/A.\",\"ACOS VILLARES\",\"PAPEL SAO ROBERTO\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"BOAVISTA SA ARR MERC\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO BCN LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"PERDIGAO AGRO SA\",\"COPERSUCAR SA\",\"RENAUXVIEW\",\"POLONIA\",\"CHAPECO\",\"BUNGE FERTILIZANTES\",\"COMPANHIA ENERGETICA MIRANDA\",\"BOAVISTA SA ARR MERC\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BANCO BCN S.A.\",\"ZOGBI LEASING\",\"PEVE PARTICIPACOES\",\"BANCO BRADESCO S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"HUMAITA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"FENICIAPAR S/A\",\"MUNDIAL\",\"ABC BRASIL\",\"SERRANA FERTILIZANTES SA\",\"BUNGE BRASIL S.A.\",\"MADEPAN\",\"ITAUSA\",\"TECPART\",\"ITAUTEC INFORMATICA S.A.\",\"ELEKEIROZ S/A\",\"ITAUTEC S.A. - GRUPO ITAUTEC\",\"PROMON\",\"BCO BANDEIRANTES INVESTIMENTOS\",\"PEVE PARTICIPACOES\",\"BANCO BRADESCO S.A.\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"HUMAITA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"SEARLE\",\"SID INFORMATICA\",\"D F VASCONCELLOS S/A O.M.A.P.\",\"MAHLE METAL LEVE\",\"FISIBA\",\"SANTANDER LEASING S.A. ARREND MERC\",\"ARRENDAMENTO MERCANTIL\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"RACIONAL ENGENHARIA\",\"BRASMOTOR S.A\",\"CMA PARTICIPACOES SA\",\"ITAMARATI LEASING\",\"BANCO BCN S.A.\",\"BOAVISTA SA ARR MERC\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"SUZANO HOLDING S.A.\",\"PREMESA\",\"ULTRAPAR PARTICIPACOES SA\",\"BANCO BCN S.A.\",\"BOAVISTA SA ARR MERC\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BCO SANTANDER NOROESTE\",\"SANTANDER LEASING S.A. ARREND MERC\",\"BANESPA\",\"BANCO SANTANDER S.A.\",\"BUNGE BRASIL S.A.\",\"COPERSUCAR SA\",\"FABRICACAO DE CIMENTO PORTLAND\",\"MUNCK\",\"SECURIT\",\"LA FONTE TELECOM S/A\",\"IGUATEMI EMPRESA DE SHOPPING CENTERS S/A\",\"JP PARTICIPACOES S.A.\",\"DROGASIL SA\",\"PREMESA\",\"BANCO BRADESCO S.A.\",\"BOAVISTA SA ARR MERC\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"BRADESPLAN PARTICIPACOES S.A.\",\"HUMAITA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"SANTANDER LEASING S.A. ARREND MERC\",\"BANESPA\",\"SANTANDER LEASING S.A.\",\"BANCO SANTANDER (BRASIL) S.A.\",\"BANCO SANTANDER S.A.\",\"BFB LEASING\",\"BANCO ITAU BBA S.A.\",\"ITAULEASING\",\"CITI CP\",\"UNIBANCO SA\",\"BCO BANDEIRANTES\",\"BANESTADO LEASING\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"CREDICARD\",\"DIBENS LEASING SA\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"BRADESPLAN PARTICIPACOES S.A.\",\"HUMAITA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"BOAVISTA SA ARR MERC\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"ALFA FINANCEIRA\",\"BANCO SUDAMERIS BRASIL SA\",\"BANCO COMERCIAL E DE INVESTIMENTO SUDAMERIS S.A.\",\"ALFA HOLDINGS\",\"CONSORCIO ALFA\",\"FERREIRA GOMES ENERGIA S.A.\",\"AUXILIAR PART\",\"BANESPA\",\"SANTANDER LEASING S.A.\",\"BANCO SANTANDER (BRASIL) S.A.\",\"BANCO SANTANDER S.A.\",\"BANCO DE PERNAMBUCO S.A. - BANDEPE\",\"BOAVISTA SA ARR MERC\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BANCO COMERCIAL E DE INVESTIMENTO SUDAMERIS S.A.\",\"BCO REAL\",\"ABC BRASIL\",\"BANCO MERCANTIL DE SAO PAULO S/A\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"CPFL\",\"BRADESPLAN PARTICIPACOES S.A.\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"BRADESCO LEASING S.A. ARREND. MERCANTIL\",\"CREDICARD\",\"CITI CP\",\"BANESTADO LEASING\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"DIBENS LEASING SA\",\"ITAULEASING\",\"UNIBANCO SA\",\"BANCO ITAU BBA S.A.\",\"BFB LEASING\",\"SANTISTA ALIMENTOS\",\"COSAN SA INDUSTRIA E COMERCIO\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"WAGNER\",\"UNIPAR CARBOCLORO S.A.\",\"AES ELETROPAULO\",\"UNIPAR CARBOCLORO S.A.\",\"VIGOR ALIMENTOS S.A.\",\"BFB LEASING\",\"ARRENDAMENTO MERCANTIL\",\"BMG LEASING\",\"ELEKEIROZ\",\"AYMORE LEASING\",\"BCO REAL\",\"FERTIBRAS S/A\",\"BANCO SANTANDER S.A.\",\"SANTANDER LEASING S.A.\",\"BANCO SANTANDER (BRASIL) S.A.\",\"BANCO DE PERNAMBUCO S.A. - BANDEPE\",\"FIBRA LEASING SA ARREND MERC\",\"TEXTILIA\",\"CSN\",\"CPM BRAXIS S/A\",\"VILLARES MECANICA\",\"SANTISTA TEXTIL S.A.\",\"ELEKEIROZ S/A\",\"ITAUTEC S.A. - GRUPO ITAUTEC\",\"ELEKEIROZ\",\"MADEPAN\",\"ITAUTEC INFORMATICA S.A.\",\"CENTENARIO\",\"SABESP\",\"ARRENDAMENTO MERCANTIL\",\"BMG LEASING\",\"BANCO ITAU BBA S.A.\",\"BANESTADO LEASING\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"UNIBANCO SA\",\"CREDICARD\",\"BMG LEASING\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"HUMAITA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"BRADESCO BCN LEASING\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BANCO DE PERNAMBUCO S.A. - BANDEPE\",\"BANCO SANTANDER (BRASIL) S.A.\",\"SANTANDER LEASING S.A.\",\"BCO REAL\",\"-\",\"FINAUSTRIA ARRENDAMENTO MERCANTIL S.A.\",\"UNIBANCO SA\",\"CREDICARD\",\"DIBENS LEASING SA\",\"ITAULEASING\",\"BANCO ITAU BBA S.A.\",\"CITI CP\",\"ULTRAPAR PARTICIPACOES SA\",\"USINA S BARBARA\",\"COSAN SA INDUSTRIA E COMERCIO\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"COSAN LOGISTICA S.A.\",\"COSAN SA INDUSTRIA E COMERCIO\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"COSAN LOGISTICA S.A.\",\"BANCOCIDADE LEASING\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"FINASA LEASING\",\"PEVE PREDIOS S.A.\",\"BRADESCO LEASING SA ARREND MERCANTIL\",\"VIARONDON CONCESSIONARIA DE RODOVIA SA\",\"UNIBANCO SA\",\"CREDICARD\",\"DIBENS LEASING SA\",\"ITAULEASING\",\"BANCO ITAU BBA S.A.\",\"CITI CP\",\"BANCO DE PERNAMBUCO S.A. - BANDEPE\",\"BANCO SANTANDER (BRASIL) S.A.\",\"BANCO SANTANDER S.A.\",\"GERDAU INFORMATICA\",\"HUMAITA\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"CVC BRASIL OPERADORA E AGENCIA DE VIAGENS SA\",\"PEVE PREDIOS S.A.\",\"CITI CP\",\"UNIBANCO SA\",\"CREDICARD\",\"BANCO ITAU BBA S.A.\",\"ITAULEASING\",\"MADEPAN\",\"ITAUTEC INFORMATICA S.A.\",\"BANCO SANTANDER (BRASIL) S.A.\",\"BANCO SANTANDER S.A.\",\"UNIBANCO SA\",\"CREDICARD\",\"BANCO ITAU BBA S.A.\",\"CITI CP\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"ITAUTEC INFORMATICA S.A.\",\"RUMO LOGISTICA OPERADORA MULTIMODAL S.A.\",\"COSAN LOGISTICA S.A.\",\"BANCO BOAVISTA INTERATLANTICO SA\",\"JP PARTICIPACOES S.A.\",\"ELEKEIROZ S/A\",\"ITAUTEC S.A. - GRUPO ITAUTEC\",\"ITAUTEC S.A. - GRUPO ITAUTEC\",\"UNIBANCO SA\",\"CREDICARD\",\"BANCO ITAU BBA S.A.\",\"MOVIDA PARTICIPACOES S.A.\",\"FIBRA LEASING SA ARREND MERC\",\"TEXTILIA\",\"ULTRA PARTICIPACOES\",\"BANCO SANTANDER S.A.\",\"COPERSUCAR SA\",\"ULTRA PARTICIPACOES\",\"CREDICARD\",\"BANCO ITAU BBA S.A.\",\"COSAN LOGISTICA S.A.\",\"TEXTILIA\",\"BCO REAL\",\"BANCO ITAU BBA S.A.\",\"ALFA FINANCEIRA\",\"CONSORCIO ALFA\",\"CONSORCIO ALFA\",\"HARPIA OMEGA PARTICIPACOES S.A.\",\"BTGI QUARTZO PARTICIPACOES S.A.\",\"BTGI SAFIRA PARTICIPACOES S.A.\",\"VOSTOK PARTICIPACOES SA\",\"MENFIS PARTICIPACOES S/A\",\"PATMOS PARTICIPACOES S/A\",\"EGEU PARTICIPACOES SA\",\"MENFIS PARTICIPACOES S/A\",\"PATMOS PARTICIPACOES S/A\",\"EGEU PARTICIPACOES SA\",\"PATMOS PARTICIPACOES S/A\",\"EGEU PARTICIPACOES SA\",\"ARGO TRANSMISSAO DE ENERGIA S.A.\",\"ARGO ENERGIA EMPREENDIMENTOS E PARTICIPACOES S.A.\",\"EGEU PARTICIPACOES SA\",\"BTGI QUARTZO PARTICIPACOES S.A.\",\"BTGI SAFIRA PARTICIPACOES S.A.\",\"NAOMI PARTICIPACOES\",\"BELEZA PARTICIPACOES\",\"NOAH PARTICIPACOES\",\"FINSBURY PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"BELEZA PARTICIPACOES\",\"NOAH PARTICIPACOES\",\"FINSBURY PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"NOAH PARTICIPACOES\",\"FINSBURY PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"FINSBURY PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"GAIA CRED CIA SECURITIZADORA DE CREDITOS FINANCEIROS S.A.\",\"BTGI SAFIRA PARTICIPACOES S.A.\",\"FOXFIELD PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"FOURSTONES PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"FRIESTON PARTICIPACOES S.A.\",\"ARGO ENERGIA EMPREENDIMENTOS E PARTICIPACOES S.A.\",\"COMPANHIA SEC. DE CREDITOS FIN. CARTOES CONSIGNADOS BMG\"]},\"nodesToDataframe\":true,\"edgesToDataframe\":true,\"options\":{\"width\":\"100%\",\"height\":\"100%\",\"nodes\":{\"shape\":\"dot\"},\"manipulation\":{\"enabled\":false}},\"groups\":null,\"width\":null,\"height\":null,\"idselection\":{\"enabled\":true,\"style\":\"width: 150px; height: 26px\",\"useLabels\":true,\"main\":\"Select by id\"},\"byselection\":{\"enabled\":false,\"style\":\"width: 150px; height: 26px\",\"multiple\":false,\"hideColor\":\"rgba(200,200,200,0.5)\",\"highlight\":false},\"main\":null,\"submain\":null,\"footer\":null,\"background\":\"rgba(0, 0, 0, 0)\",\"highlight\":{\"enabled\":true,\"hoverNearest\":false,\"degree\":1,\"algorithm\":\"all\",\"hideColor\":\"rgba(200,200,200,0.5)\",\"labelOnly\":true},\"collapse\":{\"enabled\":false,\"fit\":false,\"resetHighlight\":true,\"clusterOptions\":null,\"keepCoord\":true,\"labelSuffix\":\"(cluster)\"}},\"evals\":[],\"jsHooks\":[]}\rUse seu mouse para navegar no grafo e descobrir os principais clusters de empresas!\n\r\r\rWrap-up\r\rO pacote rfbCNPJ serve para organizar os dados de CNPJ da Receita Federal.\rUse a fun√ß√£o rfb_import() para ler os bin√°rios prontinhos para leitura diretamente do dropbox.\rAl√©m de descobrir todos os 9.048.917 CNPJs e 11.388.120 nomes √∫nicos de pessoas, podemos fazer an√°lises explorat√≥rias com esses dados.\r\rLinks e agradecimentos\r\rValeu, amigos da curso-r.com e agregados, que me orientaram a criar a fun√ß√£o rfb_import().\rVeja tamb√©m o Brasil.io do Turicas, que tem os mesmos arquivos para download. Ele me informou tamb√©m que a base dele √© mais confi√°vel, pois apresenta corre√ß√µes de dados incorretos da Receita.\rAcompanhe o blog do Sillas que √© muito mara!\r\r√â isso. Happy coding ;)\n\r\r","permalink":"https://blog.curso-r.com/posts/2018-05-13-rfbcnpj/","tags":["banco de dados","pacotes","rfb"],"title":"rfbCNPJ: Reposit√≥rio de CNPJs da Receita"},{"author":["Bruna Wundervald"],"categories":["an√°lises"],"contents":"\r\r\r\r\r\rOl√°! Tudo bem? Eu sou a Bruna,\re talvez voc√™ j√° me conhe√ßa de algum grupo de R no Telegram\rou Facebook, ou mesmo pelo meu outro pacote, o\nvagalumeR. Eu estou prestes a me formar em Estat√≠stica na\rUFPR, e esse post vai ter muito a ver com o tema do meu\rtrabalho de conclus√£o de curso, que est√° sendo feito\rsob orienta√ß√£o do Professor\rWalmes Zeviani.\nRecentemente, eu fiz a primeira vers√£o do pacote do meu TCC,\ro chorrrds. Ainda tem muito a ser feito nele, mas os primeiros\rresultados j√° s√£o bem legais. O pacote chorrrds pode ser\rutilizado para a obten√ß√£o acordes de m√∫sicas, atrav√©s da\rraspagem do site CifraClub.\rJunto com o pacote j√° v√™m diversos bancos de dados\rrelativos √† m√∫sica brasileira. Ele j√° est√° dispon√≠vel no\rCRAN, mas as pr√≥ximas atualiza√ß√µes devem sair em\rprimeira m√£o nesse reposit√≥rio: https://github.com/brunaw/chorrrds\n# Instala√ß√£o\rdevtools::install_github(\u0026quot;brunaw/chorrrds\u0026quot;)\r# ou\rinstall.packages(\u0026quot;chorrrds\u0026quot;) # do CRAN\rdata(package = \u0026quot;chorrrds\u0026quot;)\rA base de dados chamada all, presente no pacote, cont√©m dados\rreferentes a 106 artistas nacionais, dos gen√™ros: ‚Äúrock‚Äù, ‚Äúpop‚Äù,\r‚Äúsertanejo‚Äù, ‚ÄúMPB‚Äù, ‚Äúbossa nova‚Äù, ‚Äúforr√≥‚Äù, ‚Äúreggae‚Äù e ‚Äúsamba‚Äù.\rEla j√° cont√©m, al√©m das vari√°veis extra√≠das com o pacote,\ras datas de lan√ßamento e a popularidade das m√∫sicas, obtidas\ratrav√©s da API do\rSpotify. Os\rdetalhes sobre a sele√ß√£o dos artistas e combina√ß√£o dos\rdados com os do Spotify ser√£o omitidos por enquanto, mas\rquem quiser falar sobre isso comigo, pode ficar a vontade :)\nEnt√£o vamos l√°. Eu vou come√ßar acertando alguns pontos\rsobre os dados, j√° que eles n√£o est√£o perfeitos, como:\n\rDeixar apenas os anos de lan√ßamento das m√∫sicas, e n√£o a\rdata completa;\rEncontrar as formas mais simples dos acordes (sem acidentes\rou extens√µes);\rConectar a base original com a dos gen√™ros dos artistas;\rConsertar enarmonias, ou seja, transformar as diferentes\rvers√µes de um acorde com as mesmas notas em uma coisa s√≥\r(por exemplo, Gb passa a ser F#, j√° que na pr√°tica eles\rs√£o iguais).\r\rlibrary(tidyverse)\r# Base de g√™neros\rgenre \u0026lt;- chorrrds::genre\rda \u0026lt;- chorrrds::all %\u0026gt;% dplyr::mutate(date = stringr::str_extract(date, pattern = \u0026quot;[0-9]{4,}\u0026quot;)) %\u0026gt;%\r# Extrai apenas os anos\rdplyr::mutate(date = as.numeric(date), # Deixa as datas como valores num√©ricos\racorde = stringr::str_extract(chord, # Extrai as partes fundamentais dos\rpattern = \u0026quot;^([A-G]#?b?)\u0026quot;)) %\u0026gt;% # acordes\rdplyr::filter(date \u0026gt; 1900) %\u0026gt;% # Mant√©m apenas os anos que fazem sentido\rdplyr::left_join(genre, by = \u0026quot;artist\u0026quot;) %\u0026gt;% # Traz os g√™neros dos artistas\rdplyr::mutate(acorde = case_when( # Contribui√ß√£o do Julio acorde == \u0026quot;Gb\u0026quot; ~ \u0026quot;F#\u0026quot;,\racorde == \u0026quot;C#\u0026quot; ~ \u0026quot;Db\u0026quot;, acorde == \u0026quot;G#\u0026quot; ~ \u0026quot;Ab\u0026quot;,\racorde == \u0026quot;A#\u0026quot; ~ \u0026quot;Bb\u0026quot;,\racorde == \u0026quot;D#\u0026quot; ~ \u0026quot;Eb\u0026quot;,\racorde == \u0026quot;E#\u0026quot; ~ \u0026quot;F\u0026quot;,\racorde == \u0026quot;B#\u0026quot; ~ \u0026quot;C\u0026quot;,\rTRUE ~ acorde)) # Convers√£o de enarmonias\rhead(da)\r\r\r\r\rdate\rmusic\rpopul\rchord\rkey\rartist\racorde\rgenre\r\r\r\r1992\radriana calcanhotto a fabrica do poema\r51\rCm\rD#\radriana calcanhotto\rC\rMPB\r\r1992\radriana calcanhotto a fabrica do poema\r51\rAb\rD#\radriana calcanhotto\rAb\rMPB\r\r1992\radriana calcanhotto a fabrica do poema\r51\rDb7\rD#\radriana calcanhotto\rDb\rMPB\r\r1992\radriana calcanhotto a fabrica do poema\r51\rDb7/9\rD#\radriana calcanhotto\rDb\rMPB\r\r1992\radriana calcanhotto a fabrica do poema\r51\rCm\rD#\radriana calcanhotto\rC\rMPB\r\r1992\radriana calcanhotto a fabrica do poema\r51\rFm\rD#\radriana calcanhotto\rF\rMPB\r\r\r\rA base est√° no formato longo, ou seja, temos uma linha para cada\racorde da m√∫sica, mantendo a sequ√™ncia na qual eles aparecem\rno site.\nMuito se fala sobre o quanto as m√∫sicas no Brasil andam ficando mais\r‚Äúsimples‚Äù, ou que alguns gen√™ros musicais s√£o mais ricos que\routros. Com os dados que temos, ser√° que √© poss√≠vel concluir\ralgo sobre isso olhando simplesmente para a quantidade m√©dia\rde acordes por m√∫sica ao longo dos anos? Vejamos o gr√°fico a\rseguir.\nda_g \u0026lt;- da %\u0026gt;% # 2018 ainda n√£o √© um ano completo\rdplyr::mutate(date \u0026lt; 2018) %\u0026gt;% # Agrupamento por data + acorde + musica\rdplyr::group_by(date, genre, music, chord) %\u0026gt;% # Mant√©m os acordes distintos/ano\rdplyr::summarise(distintos = n_distinct(chord)) %\u0026gt;% dplyr::summarise(cont = n()) %\u0026gt;% # M√©dia de acordes distintos nas m√∫sicas/ano\rdplyr::summarise(media = mean(cont), contagem = n()) # grafico\rp \u0026lt;- da_g %\u0026gt;% ggplot(aes(x = date, y = media)) +\rgeom_point(colour = \u0026quot;skyblue3\u0026quot;) +\rfacet_wrap(\u0026quot;genre\u0026quot;) +\rscale_fill_hue(c = 55, l = 75) +\rgeom_smooth(aes(group = genre), span = 0.65, colour = \u0026quot;white\u0026quot;, fill = \u0026quot;tan\u0026quot;, method = \u0026quot;loess\u0026quot;) +\rlabs(x = \u0026quot;Anos\u0026quot;, y = \u0026quot;M√©dia de acordes/m√∫sica\u0026quot;)\r# tema para deixar o gr√°fico bonitinho\rtema \u0026lt;- theme(\rlegend.position=\u0026#39;none\u0026#39;, axis.line = element_line(size = 0.5, colour = \u0026quot;tan\u0026quot;),\rpanel.grid.major = element_line(\rcolour = \u0026quot;black\u0026quot;, size = 0.08, linetype = \u0026quot;dotted\u0026quot;),\rpanel.border = element_blank(),\rpanel.background = element_blank(),\rstrip.background = element_rect(colour = \u0026quot;tan\u0026quot;, fill = \u0026quot;white\u0026quot;, size = 0.6), strip.text = element_text(size = 14),\raxis.title = element_text(size = 14),\raxis.text = element_text(size = 12))\rp + tema\rClaramente, g√™neros como o samba, MPB e bossa nova t√™m, em geral,\ruma quantidade m√©dia de acordes distintos por m√∫sica muito\rmaior do que os outros. E eles t√™m mais varia√ß√£o ao longo dos\ranos tamb√©m, o que pode ser um reflexo da maior criatividade\renvolvida nestes gen√™ros. Os menores valores, como √©\resperado, est√£o principalmente no sertanejo, que √© um\rgen√™ro conhecidamente mais uniforme na quest√£o harm√¥nica.\nN√≥s podemos avan√ßar um pouco e olhar para os pr√≥prios artistas.\rQuem ser√° que usa as maiores quantidades de acordes\rdistintos em suas composi√ß√µes? Vamos ver o pr√≥ximo gr√°fico,\rque mostra apenas os artistas com mediana maior do que 8\racordes diferentes por m√∫sica.\nda_g \u0026lt;- da %\u0026gt;% dplyr::mutate(artist = stringr::str_to_title(artist)) %\u0026gt;% # Agrupamento por artista + m√∫sica\rdplyr::group_by(artist, genre, music) %\u0026gt;% # Mant√©m os acordes distintos\rdplyr::summarise(distintos = n_distinct(chord)) %\u0026gt;% # Obt√©m a mediana e quantis de acordes distintos por m√∫sica/artistas\rdplyr::summarise(med = median(distintos), contagem = n(),\rinf = quantile(distintos)[2],\rsup = quantile(distintos)[4])\r# grafico\rp \u0026lt;- da_g %\u0026gt;%\rdplyr::filter(med \u0026gt; 8) %\u0026gt;% ggplot(aes(x = reorder(artist, med), y = med)) +\rgeom_pointrange(aes(ymin = inf, ymax = sup, colour = genre), size = 0.7) + scale_colour_hue(c = 55, l = 75) +\rcoord_flip() +\rlabs(colour = \u0026quot;G√™nero\u0026quot;, x = \u0026quot;Artistas\u0026quot;, y = \u0026quot;Primeiro quartil, mediana e terceiro quartil\u0026quot;)\r# tema\rtema \u0026lt;- theme(\raxis.line = element_line(size = 0.5, colour = \u0026quot;tan\u0026quot;),\rpanel.grid.major = element_line(colour = \u0026quot;black\u0026quot;, size = 0.08, linetype = \u0026quot;dotted\u0026quot;),\rpanel.border = element_blank(),\rpanel.background = element_blank(),\raxis.text = element_text(size = 12), axis.title.x = element_text(size = 16),\raxis.title.y = element_text(size = 16))\rp + tema\rE voil√°. A primeira posi√ß√£o √© ocupada por um dos maiores\rmusicistas brasileiros, que √© refer√™ncia internacional em quest√µes\rde harmonia: Chico Buarque. Logo em seguida, temos o Reinaldo,\rum dos maiores sambistas que o Brasil j√° conheceu, e o\rPixinguinha, um g√™nio do choro. E assim a lista segue, com\rartistas principalmente da bossa nova, samba e MPB. Demora\rat√© que apare√ßa o primeiro dos rockeiros nesta lista, que\r√© a Rita Lee. Dos membros do sertanejo, nenhum chega a\raparecer no gr√°fico, mostrando que a ‚Äúvariedade‚Äù harm√¥nica\rdeste g√™nero musical √© mesmo bem baixa.\nAt√© agora est√° legal mas, com m√∫sica, sempre pode\rficar ainda mais. A ideia mais recente que o meu caro\rorientador Walmes Zeviani\rteve para o nosso trabalho √© de\rencadear as transi√ß√µes entre os acordes em um diagrama\rde cordas. Voc√™s j√° ouviram falar desse diagrama? Eu\rmal o conhe√ßo e j√° considero pacas.\nO diagrama de cordas √© um m√©todo gr√°fico (e lindo)\rde explicitar rela√ß√µes entre grupos ou\rindiv√≠duos. Os grupos ficam arranjados de forma radial/circular,\re as cordas que aparecem dentro do c√≠rculo demonstram\ras conex√µes entre eles e suas for√ßas. Pra quem sabe um pouquinho\rsobre harmonia, vai ser sensacional ver o quanto isso faz\rsentido (mas tamb√©m n√£o vou entrar nesse m√©rito agora).\nO exemplo que eu vou mostrar aqui √© extremamente simples.\rAntes eu separei, dos acordes ‚Äúcrus‚Äù retirados do CifraClub,\rapenas a parte fundamental deles. Isto √©, desconsiderei\rse um acorde tem notas extras, acidentes e maior/menor.\rOu seja, aqui n√≥s s√≥ veremos acordes como C, D, B, A#, o\rmiolo da coisa. Podemos perder informa√ß√£o fazendo isso? Sim,\re bastante. Mas como eu disse, esse caso √© pra ser bem simples mesmo.\nEnfim, vamos voltar ao exemplo. A seguir, eu considero como\ruma ‚Äútransi√ß√£o‚Äù quando um acorde aparece em sequ√™ncia do outro\r(exemplo de transi√ß√£o muito comum: d√≥-sol). O c√≥digo abaixo\rconstr√≥i o diagrama de cordas atrav√©s do pacote chordiag:\ndevtools::install_github(\u0026quot;mattflor/chorddiag\u0026quot;)\r# Ordenando por c√≠rculo das quintas\rordem \u0026lt;- c(\u0026quot;G\u0026quot;, \u0026quot;D\u0026quot;, \u0026quot;A\u0026quot;, \u0026quot;E\u0026quot;, \u0026quot;B\u0026quot;, \u0026quot;F#\u0026quot;, \u0026quot;Db\u0026quot;, \u0026quot;Ab\u0026quot;, \u0026quot;Eb\u0026quot;, \u0026quot;Bb\u0026quot;, \u0026quot;F\u0026quot;, \u0026quot;C\u0026quot;)\rda$acorde \u0026lt;- factor(da$acorde, levels = ordem)\rcomp \u0026lt;- data.frame(\racorde = da$acorde, seq = dplyr::lead(da$acorde)) %\u0026gt;% # Pega o acorde \u0026quot;seguinte\u0026quot;\rdplyr::group_by(acorde, seq) %\u0026gt;% # Agrupa por cada transi√ß√£o\rdplyr::summarise(contagem = n()) # Conta quantas s√£o as transi√ß√µes\rmat_comp \u0026lt;- reshape2::dcast(comp, # Arranja em do tipo matriz quadrada\racorde ~ seq, value.var = \u0026quot;contagem\u0026quot;) mm \u0026lt;- as.matrix(mat_comp[ ,-1]) # Converte o df em matriz (exig√™ncia do pacote)\rmm[is.na(mm)] \u0026lt;- 0 # Substitui na por 0 (exig√™ncia do pacote)\rdimnames(mm) \u0026lt;- list(acorde = unique(mat_comp$acorde),\rseq = unique(mat_comp$acorde))\r# Constr√≥i o diagrama interativo\rchorddiag::chorddiag(mm, showTicks = FALSE,\rpalette = \u0026quot;Set2\u0026quot;, palette2 = \u0026quot;#Set3\u0026quot;)\r\r{\"x\":{\"matrix\":[[6967,14126,10059,3832,1842,2329,409,929,734,1459,4266,17887,15],[20455,8125,15269,9222,3597,1291,1327,443,851,1461,2645,5562,5],[6928,24159,9653,14863,8550,3207,1348,1512,392,1175,3209,3875,4],[3358,6037,24697,7533,8979,5092,2092,902,899,348,1634,3139,3],[2764,2374,5350,17924,4013,4210,2727,953,247,901,351,1681,6],[1437,1908,2184,3066,9718,1773,2182,1683,390,286,1012,330,3],[372,1067,1747,1172,1812,5019,1127,1512,746,341,217,905,0],[1401,320,1418,811,543,1196,3195,741,878,799,553,397,4],[525,1426,421,578,448,329,483,1687,725,1455,1035,729,0],[1117,764,2147,532,778,302,365,724,2469,1359,3056,2579,3],[5998,2299,1793,2778,623,626,265,513,777,4576,2597,8004,1],[13518,7647,4133,2397,2593,597,517,649,732,2032,10275,5352,1],[14,1,4,5,5,1,0,8,1,3,0,2,157]],\"options\":{\"type\":\"directional\",\"width\":800,\"height\":800,\"margin\":100,\"showGroupnames\":true,\"groupNames\":[\"G\",\"D\",\"A\",\"E\",\"B\",\"F#\",\"Db\",\"Ab\",\"Eb\",\"Bb\",\"F\",\"C\",null],\"groupColors\":[\"#66C2A5\",\"#FC8D62\",\"#8DA0CB\",\"#E78AC3\",\"#A6D854\",\"#FFD92F\",\"#E5C494\",\"#B3B3B3\"],\"groupThickness\":0.1,\"groupPadding\":0.0349065850398866,\"groupnamePadding\":[30,30,30,30,30,30,30,30,30,30,30,30,30],\"groupnameFontsize\":18,\"groupedgeColor\":null,\"chordedgeColor\":\"#808080\",\"categoryNames\":null,\"categorynamePadding\":100,\"categorynameFontsize\":28,\"showTicks\":false,\"tickInterval\":1000,\"ticklabelFontsize\":10,\"fadeLevel\":0.1,\"showTooltips\":true,\"showZeroTooltips\":true,\"tooltipNames\":[\"G\",\"D\",\"A\",\"E\",\"B\",\"F#\",\"Db\",\"Ab\",\"Eb\",\"Bb\",\"F\",\"C\",null],\"tooltipFontsize\":12,\"tooltipUnit\":\"\",\"tooltipGroupConnector\":\" \u0026#x25B6; \",\"precision\":\"null\",\"clickAction\":null,\"clickGroupAction\":null}},\"evals\":[],\"jsHooks\":[]}\rVejam que interessante. Como eu disse antes, uma das\rrela√ß√µes mais fortes do diagrama √© o C-G (ou d√≥-sol),\rque √© justificada teoricamente, j√° que o G √© a quinta do\rC. O mesmo acontece com D-A, A-E, F-C e assim por diante.\rQuem quiser saber mais sobre esse comportamento, pode\rdar uma olhada aqui.\rTransi√ß√µes meio malucas, como\rB-Bb, tamb√©m acontecem. ‚ÄúMaluca‚Äù porque um acorde\rbemol, indicado pelo ‚Äúb‚Äù, √© aquele cuja ra√≠z esta\rmeio tom abaixo do indicado pela letra anterior,\rque neste caso √© o B (si), ent√£o esse acontecimento n√£o\rfaz muito sentido.\nConsidera√ß√µes Finais\rO que vimos aqui √© um peda√ßo da an√°lise inicial do meu TCC,\rque ainda n√£o est√° nem um pouco pronto. S√£o exemplos\rsimples das informa√ß√µes podemos extrair com o pacote chorrrds,\re o universo de possibilidades √© infinito. Isso que n√≥s nem\rcome√ßamos a falar sobre as conex√µes que podem ser feitas\rcom a API do Spotify, o pacote music21, que √© do pr√≥prio\rJulio Trecenti, com as letras das m√∫sicas,‚Ä¶\nAl√©m disso, om certeza, meu objetivo com os gr√°ficos apresentados\rn√£o √© fazer nenhum tipo de ju√≠zo de valor sobre os gen√™ros\rpor conta de ‚Äúcomplexidade harm√¥nica‚Äù. Diga-se de passagem,\reu mesma sou bem f√£ de todos esses gen√™ros, desde a MPB\rat√© o sertanejo :D\n\rAgradecimentos\rAo meu orientador, Walmes Zeviani,\rque fez eu me apaixonar pelo R, e ao\rJulio Trecenti, que √© t√£o\rentusiasta do meu TCC quanto eu, e j√° fez diversas contribui√ß√µes\rvaliosas.\n\r","permalink":"https://blog.curso-r.com/posts/2018-04-25-chorrrds/","tags":["m√∫sica"],"title":"chorrrds: Analisando acordes de m√∫sicas brasileiras"},{"author":["Athos"],"categories":["divulga√ß√£o"],"contents":"\r\rAl√¥ al√¥ww Comunidade\nLan√ßamos uma competi√ß√£o Kaggle e agora √© a hora de voc√™ mostrar que √© Jedi em DATA SCIENCE! =D\nLink: https://www.kaggle.com/c/guess-the-correlation/\nA gente fez isso por esporte, favor n√£o tentar achar utilidade nessa aplica√ß√£o =P.\nO Jogo\rO site Guess The Correlation coloca o ser humano frente a frente com um gr√°fico de dispers√£o em que √© em seguida desafiado a adivinhar a respectiva a correla√ß√£o linear.\nNo nosso desafio Kaggle, desafio similar foi constru√≠do. Por exemplo: quanto voc√™ chutaria que √© a correla√ß√£o entre os dados da figura abaixo?\n\r\rForam geradas 200 mil imagens em png como a figura acima e cada uma delas tem a sua correle√ß√£o anotada para treinarmos um modelinho.\n\rObjetivo\rO objetivo √© simples e direto: construir um rob√¥ que calcula a correla√ß√£o (linear) apenas vendo o gr√°fico de dispers√£o.\nEm machine l√¢rn√™s, queremos\n\r\rem que essa f seja digna de ser f de F@!#.\n\rChute inicial\rO Juli√£o j√° andou trabalhando nesse problema e deu um chute inicial nos c√≥digos pra voc√™s se inspirarem. Ali√°s, ‚Äúinicial‚Äù numas, porque ele j√° saiu fazendo um CNN com a ajuda do pacote decryptr:\nlibrary(keras)\rlibrary(tidyverse)\rlibrary(decryptr)\rpath \u0026lt;- \u0026quot;.\u0026quot;\rarqs \u0026lt;- dir(paste0(path, \u0026quot;/train_imgs\u0026quot;), full.names = TRUE)\rresp \u0026lt;- readr::read_csv(paste0(path, \u0026quot;/train_responses.csv\u0026quot;))\ri_train \u0026lt;- sample(1:nrow(resp), 10000)\rarqs_train \u0026lt;- arqs[i_train]\rarqs_test \u0026lt;- arqs[-i_train]\rgen \u0026lt;- function(batch_size = 100, arqs = arqs_train) {\rf \u0026lt;- function() {\ra \u0026lt;- sort(sample(arqs, batch_size))\rimgs \u0026lt;- decryptr::read_captcha(a)\rcaptchas_t \u0026lt;- purrr::transpose(imgs)\rxs \u0026lt;- captchas_t$x\rxs \u0026lt;- abind::abind(xs, along = 0.1)\ra_clean \u0026lt;- a %\u0026gt;% basename() %\u0026gt;% tools::file_path_sans_ext() %\u0026gt;% tolower()\rcorr \u0026lt;- resp %\u0026gt;% filter(id %in% a_clean) %\u0026gt;% arrange(id) %\u0026gt;% pull(corr)\rdata \u0026lt;- list(xs, corr)\rdata\r}\rf\r}\r# Create model\rmodel \u0026lt;- keras_model_sequential()\rmodel %\u0026gt;%\rlayer_conv_2d(\rinput_shape = c(150, 150, 1),\rfilters = 16, kernel_size = c(3, 3),\rpadding = \u0026quot;same\u0026quot;,\ractivation = \u0026quot;relu\u0026quot;) %\u0026gt;%\rlayer_max_pooling_2d() %\u0026gt;%\rlayer_conv_2d(\rfilters = 32, kernel_size = c(3, 3),\rpadding = \u0026quot;same\u0026quot;,\ractivation = \u0026quot;relu\u0026quot;) %\u0026gt;%\rlayer_max_pooling_2d() %\u0026gt;%\rlayer_conv_2d(\rfilters = 64, kernel_size = c(3, 3),\rpadding = \u0026quot;same\u0026quot;,\ractivation = \u0026quot;relu\u0026quot;) %\u0026gt;%\rlayer_max_pooling_2d() %\u0026gt;%\rlayer_flatten() %\u0026gt;%\rlayer_dense(units = 300) %\u0026gt;%\rlayer_dropout(.1) %\u0026gt;%\rlayer_dense(units = 1, activation = \u0026quot;tanh\u0026quot;)\r# Compile and fit model\rmodel %\u0026gt;%\rcompile(\roptimizer = \u0026quot;sgd\u0026quot;,\rloss = \u0026quot;mean_squared_error\u0026quot;,\rmetrics = \u0026quot;mean_squared_error\u0026quot;)\rmodel %\u0026gt;%\rfit_generator(\rgen(100, arqs_train),\rsteps_per_epoch = 100,\rvalidation_data = gen(100, arqs_test),\rvalidation_steps = 10\r)\rE a√≠? Ser√° que d√° pra acertar 100%? Ou ser√° imposs√≠vel?\nBoa R‚Äôada!\n\r","permalink":"https://blog.curso-r.com/posts/2018-03-29-guess-the-correlation/","tags":["kaggle","deep learning"],"title":"Chamada pra briga - Competi√ß√£o Kaggle Guess The Correlation"},{"author":["William"],"categories":["Tutoriais"],"contents":"\r\r\rA minha tese de doutorado envolve a an√°lise de dados de polui√ß√£o do ar. Parte do trabalho est√° em encontrar bases de dados que exemplifiquem temas que eu precise discutir. Informa√ß√µes sobre polui√ß√£o do ar geralmente s√£o disponibilizados por √≥rg√£os p√∫blicos de monitoramento ambiental, o que deveria, por princ√≠pio, garantir a f√°cil acesso e a coleta eficiente dos dados. Como sabemos, nem sempre √© isso que acontece.\nNeste post, vamos exercitar a arte do web scraping construindo um scraper para coletar dados de polui√ß√£o do ar da CETESB. O texto original est√° no blog que criei para divulgar resultados parciais da minha tese.\nQualar\rO Qualar √© o sistema de informa√ß√µes de qualidade do ar da CETESB. Por meio dele, podemos acessar os dados de todas as esta√ß√µes de monitoramento do estado de S√£o Paulo. O sistema exige a cria√ß√£o de um login e ent√£o o envio de um pequeno formul√°rio com quais informa√ß√µes voc√™ gostaria de visualizar.\nO Qualar funciona muito bem para pequenas consultas, mas na extra√ß√£o de uma massa grande de dados existem duas dificuldades:\nSe voc√™ precisa de dados de v√°rias esta√ß√µes e de v√°rios poluente, voc√™ precisar√° repetir esse processo para cada combina√ß√£o de esta√ß√£o/poluente. Pegar todos os dados de oz√¥nio da Grande S√£o Paulo, por exemplo, exigiria repetir a solicita√ß√£o 23 vezes.\n\rComo a planilha √© impressa na tela, se voc√™ precisar de uma s√©rie muito longa, voc√™ vai demorar bastante para carregar a p√°gina e seu computador corre um grande risco de travar no meio do caminho por falta de RAM.\n\r\rPara contornar este problema, vamos usar o R para construir um c√≥digo que simule uma requisi√ß√£o de dados ao Qualar. Em seguida, vamos transformar o c√≥digo numa fun√ß√£o para replicar o processo para diversos par√¢metros rodando apenas algumas linhas de c√≥digos.\nObserva√ß√£o: o sistema tamb√©m tem uma op√ß√£o ‚ÄúExportar dados Avan√ßado‚Äù. Nela, √© poss√≠vel escolher at√© 3 par√¢metros para cada esta√ß√£o e os dados n√£o s√£o impressos na tela, sendo gerado diretamente um arquivo csv para download. Por√©m, com a desculpa de praticar a constru√ß√£o do scraper, n√£o vamos usar essa op√ß√£o.\n\rConstruindo o scraper\rPara construir o scraper, vamos seguir os passos definidos neste post da Curso-R escrito pelo Fernando Corr√™a. S√£o eles:\nDefinir a p√°gina que voc√™ quer raspar.\rIdentificar exatamente as requisi√ß√µes que produzem o que voc√™ quer.\rConstruir um programa que imite as requisi√ß√µes que voc√™ faria manualmente.\rRepetir o passo (3) quantas vezes quiser.\r\rUm fluxo mais estruturado do web scraping √© discutido neste post do Caio Lente.\nPASSO 1\rPara chegar na p√°gina que queremos raspar, precisamos passar pelas seguintes etapas dentro do Qualar: login, pesquisa e janela com os dados. Veja abaixo como prosseguir.\nLogin: fazer o login na p√°gina inicial.\nPesquisa: na pr√≥xima p√°gina, acessar ‚ÄúConsultas/Exportar Dados‚Äù no menu da esquerda e preencher a pesquisa com os dados do par√¢metro que voc√™ quer acessar.\nDados: na nova janela aberta pelo site est√£o os dados que queremos raspar.\n\n\rPASSO 2\rPara descobrir qual requisi√ß√£o √© feita em cada momento, podemos utilizar o ‚ÄúInspect element‚Äù do navegador. Eu estou usando o Firefox neste post, mas o procedimento √© semelhante em outros navegadores.\nO login √© uma submiss√£o de formul√°rio. Inspecionando o html da p√°gina, podemos ver que os itens que o formul√°rio precisa enviar s√£o o ‚Äúcetesb_login‚Äù e o ‚Äúcetesb_passoword‚Äù.\nPara descobrir que tipo de requisi√ß√£o o login faz, basta abrir o Inspect element antes de fazer o login, logar no site e olhar a aba ‚ÄúNetwork‚Äù. A requisi√ß√£o que queremos √© a ‚Äúautenticador‚Äù. Ela faz uma requisi√ß√£o POST para a url ‚Äúhttp://qualar.cetesb.sp.gov.br/qualar/autenticador‚Äù.\nN√£o vou mostrar aqui, mas a requisi√ß√£o que a pesquisa faz para acessar os dados tamb√©m √© a submiss√£o de um formul√°rio e pode ser encontrada de forma equivalente.\nAssim, para acessar os dados, precisaremos enviar outra requisi√ß√£o POST, agora para a url ‚Äúhttp://qualar.cetesb.sp.gov.br/qualar/exportaDados.do‚Äù, contendo os itens desse novo formul√°rio, que s√£o as informa√ß√µes que preencher√≠amos na pesquisa. No pr√≥ximo passo, vai ficar mais claro o que estamos fazendo nessa etapa.\n\rPASSO 3\rVamos criar um c√≥digo que imite essas requisi√ß√µes.\nPrimeiro, como o sistema Qualar exige login, precisamos capturar o cookie do site para manter a sess√£o logada nas requisi√ß√µes seguintes. O cookie da sess√£o √© guardado no objeto my_cookie, que ser√° passado em todas as requisi√ß√µes.\nlibrary(magrittr)\rlibrary(httr)\rres \u0026lt;- GET(\u0026quot;http://qualar.cetesb.sp.gov.br/qualar/home.do\u0026quot;)\rmy_cookie \u0026lt;- cookies(res)$value %\u0026gt;% purrr::set_names(cookies(res)$name)\rAgora, precisamos enviar a requisi√ß√£o POST para fazer o login e acessar o sistema.\n\rOs par√¢metros do formul√°rio s√£o colocados dentro do argumento body= da fun√ß√£o POST(). Se voc√™ estiver replicando, basta substituir os valores seu_login e sua_senha pelo login e senha que voc√™ obteve ao se cadastrar no Qualar.\n\rO argumento encode = \"form\" especifica que a requisi√ß√£o √© uma submiss√£o de formul√°rio.\n\rO par√¢metro enviar = \"OK\" indica que estamos submetendo o formul√°rio.\n\rO cookie √© passado usando a fun√ß√£o set_cookies().\n\r\rurl \u0026lt;- \u0026quot;http://qualar.cetesb.sp.gov.br/qualar/autenticador\u0026quot;\rres \u0026lt;- POST(\rurl, body = list(\rcetesb_login = \u0026quot;seu_login\u0026quot;,\rcetesb_password = \u0026quot;sua_senha\u0026quot;,\renviar = \u0026quot;OK\u0026quot;\r), encode = \u0026quot;form\u0026quot;,\rset_cookies(my_cookie)\r)\rEnt√£o fazemos uma requisi√ß√£o POST para acessar os dados. Essa requisi√ß√£o imita a pesquisa dentro da p√°gina ‚ÄúExportar dados‚Äù. Nela, precisamos definir quais dados queremos acessar.\nurl \u0026lt;- \u0026quot;http://qualar.cetesb.sp.gov.br/qualar/exportaDados.do\u0026quot;\rres \u0026lt;- POST(\rurl,\rquery = list(method = \u0026quot;pesquisar\u0026quot;),\rbody = list(\rirede = \u0026quot;A\u0026quot;,\rdataInicialStr = \u0026quot;04/03/2018\u0026quot;,\rdataFinalStr = \u0026quot;05/03/2018\u0026quot;,\rcDadosInvalidos = \u0026quot;on\u0026quot;,\riTipoDado = \u0026quot;P\u0026quot;,\restacaoVO.nestcaMonto = \u0026quot;72\u0026quot;,\rparametroVO.nparmt = \u0026quot;63\u0026quot;\r),\rencode = \u0026quot;form\u0026quot;,\rset_cookies(my_cookie)\r)\rObserve que, apesar de na pesquisa conseguirmos selecionar o nome da esta√ß√£o e do par√¢metro, a requisi√ß√£o envia ids num√©ricos. No Qualar, eu encontrei apenas os ids das esta√ß√µes, mas os valores de ambos os par√¢metros podem ser encontrados inspecionando o html da p√°gina. Para facilitar a nossa vida, eu salvei esses valores nos arquivos station_ids.csv e param_ids.csv, que podem ser baixados pelo reposit√≥rio do blog no Github.\nPara finalizar, precisamos ler o resultado da nossa requisi√ß√£o e transformar a tabela existe no html em um data frame.\ncontent(res) %\u0026gt;% rvest::html_table(fill = TRUE) %\u0026gt;%\rextract2(2)\r\rPasso 4\rAgora, vamos transformar nosso c√≥digo numa fun√ß√£o para poder repetir o processo v√°rias vezes para diversos par√¢metros.\nscraper_CETESB \u0026lt;- function(station, parameter, start, end, type = \u0026quot;P\u0026quot;, login, password, invalidData = \u0026quot;on\u0026quot;, network = \u0026quot;A\u0026quot;) {\rres \u0026lt;- GET(\u0026quot;http://qualar.cetesb.sp.gov.br/qualar/home.do\u0026quot;)\rmy_cookie \u0026lt;- cookies(res)$value %\u0026gt;% purrr::set_names(cookies(res)$name)\rurl \u0026lt;- \u0026quot;http://qualar.cetesb.sp.gov.br/qualar/autenticador\u0026quot;\rres \u0026lt;- POST(\rurl, body = list(\rcetesb_login = login,\rcetesb_password = password,\renviar = \u0026quot;OK\u0026quot;\r), encode = \u0026quot;form\u0026quot;,\rset_cookies(my_cookie)\r)\rurl \u0026lt;- \u0026quot;http://qualar.cetesb.sp.gov.br/qualar/exportaDados.do\u0026quot;\rres \u0026lt;- POST(\rurl,\rquery = list(method = \u0026quot;pesquisar\u0026quot;),\rbody = list(\rirede = network,\rdataInicialStr = start,\rdataFinalStr = end,\rcDadosInvalidos = invalidData,\riTipoDado = type,\restacaoVO.nestcaMonto = station,\rparametroVO.nparmt = parameter\r),\rencode = \u0026quot;form\u0026quot;,\rset_cookies(my_cookie)\r)\rcontent(res) %\u0026gt;% rvest::html_table(fill = TRUE) %\u0026gt;%\rextract2(2)\r}\rAssim, basta rodar a fun√ß√£o abaixo com o seu login e senha para obter em alguns segundos uma tabela com os dados solicitados. Veja um exemplo:\ndados_cetesb \u0026lt;- scraper_CETESB(station = \u0026quot;72\u0026quot;, parameter = \u0026quot;63\u0026quot;, start = \u0026quot;04/03/2018\u0026quot;, end = \u0026quot;05/03/2018\u0026quot;, type = \u0026quot;P\u0026quot;, login = \u0026quot;seu_login\u0026quot;, password = \u0026quot;sua_senha\u0026quot;, invalidData = \u0026quot;on\u0026quot;, network = \u0026quot;A\u0026quot;)\rPrecisamos apenas tirar as colunas vazias e corrigir o nome das colunas.\ndados_cetesb \u0026lt;- dados_cetesb %\u0026gt;%\rjanitor::remove_empty_cols()\rcol_names \u0026lt;- as.character(dados_cetesb[1,])\rdados_cetesb \u0026lt;- dados_cetesb %\u0026gt;% magrittr::set_colnames(col_names) %\u0026gt;% dplyr::slice(-1)\rAssim obtemos os dados que quer√≠amos:\ndados_cetesb %\u0026gt;% dplyr::select(`Nome Esta√ß√£o`:`M√©dia Hor√°ria`) %\u0026gt;% head %\u0026gt;% knitr::kable() %\u0026gt;% kableExtra::kable_styling()\r\r\rNome Esta√ß√£o\r\rNome Par√¢metro\r\rUnidade de Medida\r\rM√©dia Hor√°ria\r\r\r\r\r\rParque D.Pedro II\r\rO3 (Oz√¥nio)\r\r¬µg/m3\r\r20\r\r\r\rParque D.Pedro II\r\rO3 (Oz√¥nio)\r\r¬µg/m3\r\r19\r\r\r\rParque D.Pedro II\r\rO3 (Oz√¥nio)\r\r¬µg/m3\r\r18\r\r\r\rParque D.Pedro II\r\rO3 (Oz√¥nio)\r\r¬µg/m3\r\r12\r\r\r\rParque D.Pedro II\r\rO3 (Oz√¥nio)\r\r¬µg/m3\r\r11\r\r\r\rParque D.Pedro II\r\rO3 (Oz√¥nio)\r\r¬µg/m3\r\r12\r\r\r\r\rIterando essa fun√ß√£o fica f√°cil repetir o processo para diversas esta√ß√µes e par√¢metros.\n√â isso! D√∫vidas, cr√≠ticas e sugest√µes, deixe um coment√°rio.\nAt√© a pr√≥xima!\n\r\r","permalink":"https://blog.curso-r.com/posts/2018-03-19-scraper-cetesb/","tags":["web-scraping","dados-abertos"],"title":"Web scraping do sistema de qualidade do ar da CETESB"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rRStudio √© a melhor IDE para fazer ci√™ncia de dados. R e python s√£o, no momento, as melhores linguagens para fazer ci√™ncia de dados. O RStudio foi criado para rodar R.\nMas ser√° que o RStudio √© bom para rodar python?\nNesse post curtinho eu mostro que sim e explico como.\nRodando R e python no RMarkdown\rPrimeiro, certifique-se de que voc√™ tem a vers√£o 1.1.x ou maior do RStudio instalado na sua m√°quina. Abra um arquivo RMarkdown em\nFile \u0026gt; New file \u0026gt; R Markdown...\rTalvez seja necess√°rio instalar alguns pacotes (por exemplo, o pr√≥prio rmarkdown) para abrir a telinha.\n\rSe voc√™ n√£o sabe o que √© RMarkdown, d√™ uma olhada na documenta√ß√£o oficial do RStudio. Em poucas palavras, o RMarkdown √© uma forma escrever textos e c√≥digos dentro de um mesmo arquivo. Fazer an√°lises com RMarkdown no RStudio √© uma das coisas que torna essa IDE t√£o poderosa.\n\rCom o RMarkdown aberto, voc√™ pode inserir um chunk com Ctrl + Alt + I. Vai aparecer isso aqui:\n\u0026#39;\u0026#39;\u0026#39;{r}\r\u0026#39;\u0026#39;\u0026#39;\rSe voc√™ escrever um c√≥digo em R a√≠ dentro e mandar rodar, ele vai rodar.\n\u0026#39;\u0026#39;\u0026#39;{r}\reu_gosto_de_R \u0026lt;- \u0026quot;nossa, como voc√™ √© legal!\u0026quot;\reu_gosto_de_R\r\u0026#39;\u0026#39;\u0026#39;\r[1] \u0026quot;nossa, como voc√™ √© legal!\u0026quot;\r\rSe voc√™ trocar r por python, voc√™ poder√° rodar python. S√≥ isso!\n\u0026#39;\u0026#39;\u0026#39;{python}\reu_gosto_de_python = \u0026quot;tudo bem, vida que segue\u0026quot;\rprint eu_gosto_de_python\r\u0026#39;\u0026#39;\u0026#39;\rtudo bem, vida que segue\r\r\r√â poss√≠vel preservar a sess√£o entre chunks?\rAt√© o RStudio 1.1.x, n√£o. Mas a partir da vers√£o 1.2.x, que ainda n√£o foi lan√ßada oficialmente, isso j√° funciona. Ent√£o, isso aqui funciona:\n\u0026#39;\u0026#39;\u0026#39;{python}\reu_gosto_de_python += \u0026quot;!!!\u0026quot; print eu_gosto_de_python\r\u0026#39;\u0026#39;\u0026#39;\rtudo bem, vida que segue!!!\r\rCom essa atualiza√ß√£o, voc√™ tamb√©m pode pegar os objetos rodados em python direto para o R, e vice-versa\nLer objetos do python no R, carregando o pacote reticulate:\n\u0026#39;\u0026#39;\u0026#39;{r}\rlibrary(reticulate)\rveio_do_python \u0026lt;- py$eu_gosto_de_python\rpaste(veio_do_python, \u0026quot; Segue no R.\u0026quot;)\r\u0026#39;\u0026#39;\u0026#39;\r[1] \u0026quot;tudo bem, vida que segue!!! Segue no R.\u0026quot;\r\rLer objetos do R no python usando o objeto r.:\n\u0026#39;\u0026#39;\u0026#39;{python}\rprint r.eu_gosto_de_R + \u0026quot; Tamb√©m no python.\u0026quot;\r\u0026#39;\u0026#39;\u0026#39;\rnossa, como voc√™ √© legal! Tamb√©m no python\r\r\rAs vers√µes 1.2.x ainda n√£o foram lan√ßadas oficialmente. Ou seja, elas podem ter problemas de funcinamento. Muito cuidado ao usar as daily builds do RStudio!\n\r\rUm pouco de explica√ß√£o\rTudo isso √© poss√≠vel gra√ßas ao pacote reticulate do RStudio, que √© respons√°vel por criar uma sess√£o do python dentro do R. A vers√£o mais atualizada desse pacote utiliza a fun√ß√£o reticulate::eng_python, que √© adicionada como uma op√ß√£o knitr::knit_engines$set() do pacote knitr.\nNa vers√£o 1.2.x do RStudio, a utiliza√ß√£o dessa engine vem integrada ao editor do RMarkdown, permitindo que voc√™ rode os c√≥digos em python e em R diretamente. Nas vers√µes anteriores, voc√™ s√≥ conseguir√° obter os resultados ap√≥s compilar o documento para algum formato de sa√≠da (HTML, PDF, Word, etc).\nAtualmente, o reticulate j√° sabe transferir v√°rios objetos entre as linguagens:\r- Objetos at√¥micos como n√∫meros, strings etc funcionam sem nenhuma dor.\r- Com um pouquinho de esfor√ßo, tamb√©m podemos transferir data.frames entre R e Pandas, matrizes e arrays entre R e NumPy.\r- Objetos complexos do python s√£o tratados como environments no R.\r- Para mais detalhes, veja esse link.\nO pacote reticulate tamb√©m permite que voc√™ abra uma sess√£o interativa do python dentro do console do R, usando a fun√ß√£o py_repl(). Veja essa parte da documenta√ß√£o do reticulate para detalhes.\n\rWrap-up\r\rVoc√™ pode rodar R e python no RMarkdown dentro do RStudio.\rPara obter todas as funcionalidades, baixe a daily build, vers√£o 1.2.x. Mas tome cuidado.\rO objeto reticulate::py guarda objetos carregados no python dentro do R.\rO objeto r. guarda objetos carregados no R dentro do python.\rFique atualizada e obtenha mais informa√ß√µes no pacote reticulate.\r\r√â isso pessoal. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2018-03-11-python/","tags":["python","rstudio","reticulate"],"title":"√â poss√≠vel rodar python no RStudio?"},{"author":["Daniel"],"categories":["Tutoriais"],"contents":"\r\rExistem diversas formas de hospedar o seu app feito em shiny. A maneira mais simples √© usando o shinyapps.io, SaaS desenvolvido pela pr√≥pria RStudio. No entanto, na vers√£o Free o seu app fica com um logotipo do RStudio no canto e n√£o √© permitido configurar um dom√≠nio pr√≥prio, ou seja, a url do seu app sempre vai ser algo do tipo: dfalbel.shinyapps.io/meuapp.\nUma alternativa gratuita e que n√£o possui essas contra-partidas √© usar o servi√ßo now.sh. O now, originalmente, foi desenvolvido para hospedar aplicativos feitos em nodejs e javascript, mas recentemente eles possibilitaram a hospedagem de aplicativos feitos com Docker.\nAl√©m dessas vantagens o now conta com infraestrutura, segundo os desenvolvedores ‚Äúauto scaling ready‚Äù, isto √© o n√∫mero de inst√¢ncias servindo o seu aplicativo pode variar de acordo com tr√°fego que o seu app est√° recebendo. No plano free o n√∫mero de inst√¢ncias pode ser 0 ou 1, ou seja, seu app fica desligado se ningu√©m estiver usando. Nos planos pagos voc√™ pode fazer esse n√∫mero variar da forma que quiser. Tudo isso est√° na documenta√ß√£o.\n√â dif√≠cil explicar o que √© o Docker em poucas palavras, mas ele √© uma plataforma de containers que facilita a configura√ß√£o e prepara√ß√£o do ambiente para a hospedagem de um app. Em outras palavras, voc√™ escreve em um arquivo chamado Dockerfile especificando como voc√™ quer que seja o ambiente, o que voc√™ precisa instalar, que arquivos voc√™ quer colocar l√° dentro. Para este tutorial voc√™ s√≥ precisar√° fazer pequenas modifica√ß√µes no Dockerfile e n√£o precisar√° entender profundamente como ele funciona.\nInstala√ß√£o:\rPara seguir o tutorial voc√™ precisa instalar o now e criar uma conta. Siga este link para instala√ß√£o e configura√ß√£o do now.\n\rEstrutura do projeto\rEsse reposit√≥rio cont√©m um exemplo simples funcionando do que iremos detalhar agora. Crie uma pasta no seu computador ou um projeto no RStudio com a seguinte estrutura:\n.\r‚îú‚îÄ‚îÄ Dockerfile\r‚îú‚îÄ‚îÄ app\r‚îÇ ‚îî‚îÄ‚îÄ app.R\r‚îú‚îÄ‚îÄ app.R\r‚îî‚îÄ‚îÄ shiny-now.Rproj\rDockerfile √© um arquivo de texto vazio por enquanto. Dentro da pasta app coloque o seu app shiny. No meu exemplo coloquei um shiny com apenas umarquivo app.R, mas nada impede voc√™ de colocar um shiny com a estrtura mais comum (um arquivo ui.R e um arquivo server.R).\n\rDockerfile\rDockerfiles podem ser referenciados a outras imagens docker. Existe uma imagem chamada rocker/shiny que j√° deixa quase tudo preparado para hospedar um app shiny, por isso em nosso Dockerfile vamos incluir a linha:\nFROM rocker/shiny\rEm seguida vamos indicar as instru√ß√µes para instala√ß√£o dos pacotes do R que s√£o usados no shiny. No meu caso, como o app n√£o faz praticamente nada, s√≥ usei o pacote shinydashboard por isso a pr√≥xima linha do meu Dockerfile √© apenas:\nRUN R -e \u0026quot;install.packages(c(\u0026#39;shinydashboard\u0026#39;), repos=\u0026#39;https://cran.rstudio.com/\u0026#39;)\u0026quot;\rSe voc√™ precisar instalar mais pacotes basta colocar o nome deles no comando acima, por exemplo:\nRUN R -e \u0026quot;install.packages(c(\u0026#39;shinydashboard\u0026#39;, \u0026#39;tidyverse\u0026#39;), repos=\u0026#39;https://cran.rstudio.com/\u0026#39;)\u0026quot;\rFeito isso, o pr√≥ximo comando do Dockerfile √© o COPY que serve para indicar para o Docker quais arquivos da pasta devem ser copiados para dentro do ambiente de hospedagem e para qual pasta dentro do novo ambiente eles devem copiados. No nosso caso, queremos copiar a pasta app para dentro da pasta /srv/shiny-server/ (que √© por padr√£o a pasta em que o Shiny Server procura por apps). Para fazer isso, adicionamos a linha:\nCOPY /app/ /srv/shiny-server/\rNo final, o nosso Dockerfile cont√©m apenas 3 linhas:\nFROM rocker/shiny\rRUN R -e \u0026quot;install.packages(c(\u0026#39;shinydashboard\u0026#39;), repos=\u0026#39;https://cran.rstudio.com/\u0026#39;)\u0026quot;\rCOPY /app/ /srv/shiny-server/\r\rApp\rDentro da pasta app, coloque o seu c√≥digo shiny. A princ√≠pio, voc√™ n√£o precisa fazer nenhuma modifica√ß√£o.\rNo meu exemplo, coloquei o arquivo app.R contendo um aplicativo usando o shinydashboard (copiado da documenta√ß√£o do pacote).\nO conte√∫do do arquivo do arquivo app.R est√° abaixo:\nlibrary(shinydashboard)\rui \u0026lt;- dashboardPage(\rdashboardHeader(title = \u0026quot;Basic dashboard\u0026quot;),\rdashboardSidebar(),\rdashboardBody(\r# Boxes need to be put in a row (or column)\rfluidRow(\rbox(plotOutput(\u0026quot;plot1\u0026quot;, height = 250)),\rbox(\rtitle = \u0026quot;Controls\u0026quot;,\rsliderInput(\u0026quot;slider\u0026quot;, \u0026quot;Number of observations:\u0026quot;, 1, 100, 50)\r)\r)\r)\r)\rserver \u0026lt;- function(input, output) {\rset.seed(122)\rhistdata \u0026lt;- rnorm(500)\routput$plot1 \u0026lt;- renderPlot({\rdata \u0026lt;- histdata[seq_len(input$slider)]\rhist(data)\r})\r}\rshinyApp(ui, server)\r\rChamando o now\rSe voc√™ configurou o now corretamente essa ser√° a parte mais f√°cil. Basta abrir um terminal e rodar now.\nEle vai soltar uma mensagem parecida com a abaixo:\nDaniels-MacBook-Air:shiny-now dfalbel$ now\r\u0026gt; Deploying ~/Documents/shiny-now under dfalbel@curso-r.com\r\u0026gt; Your deployment\u0026#39;s code and logs will be publicly accessible because you are subscribed to the OSS plan.\r\u0026gt; \u0026gt; NOTE: You can use `now --public` or upgrade your plan (https://zeit.co/account/plan) to skip this prompt\r\u0026gt; Ready! https://shiny-now-zoyrrtdqwv.now.sh (copied to clipboard) [5s]\r\u0026gt; Synced 1 file (131B) [5s]\r\u0026gt; Initializing‚Ä¶\r\u0026gt; Building\r\u0026gt; ‚ñ≤ docker build\rSending build context to Docker daemon 6.656 kBkB\r\u0026gt; ‚ñ≤ Deploying image\r\u0026gt; ‚ñ≤ Container started\r\u0026gt; [2018-03-05T20:48:12.696] [INFO] shiny-server - Shiny Server v1.5.7.883 (Node.js v6.10.3)\r\u0026gt; [2018-03-05T20:48:12.701] [INFO] shiny-server - Using config file \u0026quot;/etc/shiny-server/shiny-server.conf\u0026quot;\r\u0026gt; [2018-03-05T20:48:12.780] [WARN] shiny-server - Running as root unnecessarily is a security risk! You could be running more securely as non-root.\r\u0026gt; [2018-03-05T20:48:12.788] [INFO] shiny-server - Starting listener on 0.0.0.0:3838\r\u0026gt; Deployment complete!\rNa sexta linha dessa mensagem, temos o endere√ßo do nosso aplicativo. Basta abrir essa url no navegador e ver o aplicativo funcionando. Por enquanto, o now colocou um endere√ßo para testes, mas tudo isso √© configur√°vel.\nPara mudar a url do seu app voc√™ vai precisar usar o comando now alias. A documenta√ß√£o desse comando √© muito boa e vai ser melhor do que qualquer coisa que eu escrever aqui. V√° para este link!\n\rConclus√£o\rO now √© um servi√ßo gratuito que permite a hospedagem de containers Docker. Neste post configuramos um Dockerfile para instalar hospedar um app shiny e usando o comando now rapidamente enviamos o nosso aplicativo para o now e iniciamos a hospedagem.\n\r","permalink":"https://blog.curso-r.com/posts/2018-03-05-shiny-now/","tags":["shiny"],"title":"Hospedando seu Shiny app no now"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\r\r\r\r\r\r\rTiago Belotti √© o meu cr√≠tico de cinema favorito. Gasto uma quantidade de tempo que n√£o me orgulho vendo os v√≠deos desse ser maravilhoso. Atualmente, muitas vezes eu prefiro ver a cr√≠tica dele do filme que o pr√≥prio filme, seguindo cegamente as indica√ß√µes dele a partir das notas que ele coloca no final da cr√≠tica. Recomendo fortemente que acessem o canal do Belotti.\nO Tiago j√° mencionou v√°rias vezes que as notas que ele d√° aos filmes n√£o representam toda a cr√≠tica realizada. Por exemplo, ele j√° montou listas de Top 10 colocando filmes com notas medianas √† frente de filmes com notas altas. Mesmo assim, n√£o d√° pra n√£o querer saber a nota que ele d√° aos filmes, √© um v√≠cio!\nA minha necessidade visceral de saber as notas dadas aos filmes come√ßou quando a seguinte pergunta apareceu na minha mente:\n\rSer√° que o Tiago est√° ficando bonzinho?\rA nota m√©dia est√° aumentando ao longo do tempo?\n\rE assim acabou o meu final de semana. Eu precisava obter esses dados de qualquer forma.\nComo extrair as notas dos v√≠deos\rO c√≥digo para extrair as notas √© pra l√° de esot√©rico e usa um monte de fun√ß√µes auxiliares de pacotes do linux. Como o amigo Caio Lente adora falar, meus c√≥digos costumam ter muitas partes m√≥veis‚Ä¶\nA obten√ß√£o das notas dos filmes passa pelo seguinte fluxo:\nBaixar os v√≠deos do youtube\rExtrair os frames dos v√≠deos\rEncontrar a imagem que tem a nota\rLimpar a imagem que tem a nota\rPassar um algoritmo de OCR (Optical Character Recognition) na imagem\rCruzar com uma base de metadados do YouTube, usando o pacote tuber\r\rVou explicar brevemente como cada um desses passos foi executado. O c√≥digo n√£o √© totalmente reprodut√≠vel pois o c√≥digo completo com os loops ficaria pouco leg√≠vel.\n\rPasso 1: Baixar os v√≠deos\rOs v√≠deos foram baixados usando um pacote chamado youtube-dl. Para instal√°-lo num Ubuntu 16.04 podemos rodar\nsudo apt install youtube-dl\rO download da lista de reprodu√ß√£o do Tiago Belotti de 2015 pode ser realizada rodando, por exemplo:\nyoutube-dl -f 160 https://www.youtube.com/playlist?list=PLy-phHpv7EKaioTZ39lNd_nvitGNtQadl\rRealizei o download numa resolu√ß√£o bem ruim e sem √°udio, para ocupar pouco espa√ßo em disco. Fa√ßa isso para todos os anos (2013 at√© 2017) e pronto! Temos os v√≠deos.\n\r\r\rPasso 2: Extrair os frames dos v√≠deos\rOs arquivos de v√≠deo foram transformados utilizando ffmpeg, tamb√©m baixado como pacote do linux. Para instal√°-lo num Ubuntu 16.04 podemos rodar\nsudo apt install ffmpeg\rA fun√ß√£o tirar_screenshots() recebe o nome de um arquivo de v√≠deo, cria uma pasta com esse nome e salva os screenshots na pasta.\ntirar_screenshots \u0026lt;- function(vfile) {\r# folder and file names\rfile_name \u0026lt;- tools::file_path_sans_ext(basename(vfile))\rfolder_name \u0026lt;- glue(\u0026quot;imgs/{file_name}\u0026quot;)\rif (!file.exists(folder_name)) {\rdir.create(folder_name, showWarnings = FALSE, recursive = TRUE)\rout \u0026lt;- glue(\u0026quot;{folder_name}/out_\u0026quot;)\r# take screenshots\rtake_shots \u0026lt;- glue(\u0026quot;ffmpeg -y -i \u0026#39;{vfile}\u0026#39; -vf fps=1 \u0026#39;{out}%04d.png\u0026#39;\u0026quot;)\rsystem(take_shots)\r}\r}\rBasta fazer um loop (com purrr, n√£o for, rs) para processar todos os arquivos de v√≠deo. Resultado:\n\rPasso 3: Encontrar a imagem que tem a nota\rA nota geralmente aparece no canto superior direito da imagem:\nEnt√£o, vamos recortar esse peda√ßo e pegar qual imagem tem maior concentra√ß√£o de vermelho. A fun√ß√£o cortar_canto() utiliza o magick para pegar o canto da imagem e salva num arquivo tempor√°rio.\ncortar_canto \u0026lt;- function(img_file) {\rimg_file %\u0026gt;% magick::image_read() %\u0026gt;% magick::image_crop(\u0026quot;x60+180\u0026quot;) %\u0026gt;% magick::image_write(tempfile())\r}\rA fun√ß√£o somar_vermelho() pega a imagem e calcula a quantidade de vermelhos, tirando os casos em que h√° vermelho conjuntamente com outras cores (como branco, por exemplo).\nsomar_vermelho \u0026lt;- function(img_file) {\rp \u0026lt;- png::readPNG(img_file)\rif (length(dim(png_img)) != 3) return(0)\rsum(p[,,1] == 1.0 \u0026amp; p[,,2] \u0026lt; 0.1 \u0026amp; p[,,3] \u0026lt; 0.1)\r}\rAssim, a soma de vermelhos de um arquivo fica\n\u0026quot;out_0277.png\u0026quot; %\u0026gt;%\rcortar_canto() %\u0026gt;% somar_vermelho()\r# [1] 758\rBasta rodar isso para todos os arquivos e depois selecionar a imagem que tem a maior contagem.\n\rPasso 4: Limpar a imagem que tem a nota\rA fun√ß√£o limpar_imagem() recebe a imagem cortada e faz a limpeza, soltando apenas os n√∫meros, prontos para receber o algoritmo de OCR.\nlimpar_imagem \u0026lt;- function(img_cut) {\rtmp \u0026lt;- tempfile()\r# filtros a serem aplicados em cada cor\rparms \u0026lt;- c(red = .9, green = .2, blue = .2)\rpng::readPNG(img_cut) %\u0026gt;% purrr::array_branch(3) %\u0026gt;% purrr::map2(parms, ~.x \u0026gt; .y) %\u0026gt;% purrr::map_at(2:3, magrittr::not) %\u0026gt;% purrr::reduce(magrittr::and) %\u0026gt;% magrittr::multiply_by(-1) %\u0026gt;% magrittr::add(1) %\u0026gt;% png::writePNG(tmp)\rtmp\r}\r\u0026quot;out_0277.png\u0026quot; %\u0026gt;%\rcortar_canto() %\u0026gt;% limpar_imagem()\r\rPasso 5: Passar um algoritmo de OCR\rFinalmente, a fun√ß√£o pegar_nota() utiliza tesseract para transformar as imagens em n√∫meros\npegar_nota \u0026lt;- function(img_filtered) {\r# whitelist de numeros\rengine \u0026lt;- tesseract::tesseract(options = list(\rtessedit_char_whitelist = \u0026quot;1234567890.\u0026quot;))\r# apply tesseract\rimg \u0026lt;- img_filtered %\u0026gt;% magick::image_read() %\u0026gt;% magick::image_trim() %\u0026gt;% tesseract::ocr(engine = engine) %\u0026gt;% readr::parse_number()\r}\rA utiliza√ß√£o final do algoritmo fica assim:\n\u0026quot;out_0277.png\u0026quot; %\u0026gt;%\rcortar_canto() %\u0026gt;% limpar_imagem() %\u0026gt;% pegar_nota()\r# [1] 8.3\rPronto! Agora √© s√≥ loopar em todos os arquivos e teremos as notas de todos os filmes.\n\rInfelizmente, o algoritmo de OCR do tesseract n√£o √© l√° essas coisas, e precisei arrumar muitos desses dados na m√£o.\n\r\rPasso 6: Cruzar com uma base de metadados do YouTube\rAgora, vamos cruzar com os metadados do youtube. Os nomes dos arquivos baixados pelo youtube-dl v√™m com um c√≥digo no final, por exemplo com UVN6ljuRzp8. √â poss√≠vel utilizar esses c√≥digos no tuber para obter metadados de um v√≠deo, dessa forma:\n## c√≥digo para obter um token de acesso\r# tuber::yt_oauth(\r# \u0026quot;998136489867-5t3tq1g7hbovoj46dreqd6k5kd35ctjn.apps.googleusercontent.com\u0026quot;,\r# \u0026quot;MbOSt6cQhhFkwETXKur-L9rN\u0026quot;)\rdetalhes \u0026lt;- tuber::get_video_details(\u0026quot;UVN6ljuRzp8\u0026quot;)\r## pegar nome do filme\rpurrr::pluck(detalhes, 4, 1, \u0026quot;snippet\u0026quot;, \u0026quot;title\u0026quot;)\r# [1] \u0026quot;JOGO PERIGOSO (Gerald\u0026#39;s Game, Netflix, 2017) - Cr√≠tica\u0026quot;\r## pegar data de disponibiliza√ß√£o\rpurrr::pluck(detalhes, 4, 1, \u0026quot;snippet\u0026quot;, \u0026quot;publishedAt\u0026quot;)\r# [1] \u0026quot;2017-10-07T14:39:54.000Z\u0026quot;\rUsei esses metadados para extrair a data de disponibiliza√ß√£o dos v√≠deos. No final, fiquei com a seguinte base de dados com 386 filmes classificados (mostrando apenas 20 linhas):\n\r\r\r\rid\rnm\rdata\rnota\r\r\r\rj5udRStwytk\r007 CONTRA SPECTRE (2015)\r2015-11-05\r6.4\r\rHdYnkiiWwe8\r120 BATIMENTOS POR MINUTO (2017)\r2018-01-04\r8.6\r\rGXfe2CSKiHw\r12 YEARS A SLAVE (12 Anos de Escravid√£o, 2013)\r2014-01-04\r9.0\r\rj-kiltl6_uk\r1922 (Netflix, 2017)\r2017-10-24\r7.0\r\rzsNoXCMnTmo\r300 - A ASCENS√ÉO DO IMP√âRIO (2014)\r2014-03-07\r7.1\r\r60hUNlmK30A\rA AUT√ìPSIA (The Autopsy of Jane Doe, 2016)\r2017-05-01\r5.7\r\r1sNNzBDVlLk\rA BELA E A FERA (Beauty and the Beast, 2017)\r2017-03-16\r8.5\r\rZuk5QzVccWA\rABOUT TIME (Quest√£o de Tempo, 2013)\r2013-11-28\r8.1\r\raRjxN0ShsE8\rA BRUXA (The Witch, 2016)\r2016-03-05\r8.2\r\rn4xrIu4xKo8\rA CABANA (The Shack, 2017)\r2017-04-07\r3.4\r\rt8W-DbCbPVY\rA CHEGADA (Arrival, 2016)\r2016-11-22\r9.4\r\rM5GBLtYgz14\rA COLINA ESCARLATE (Crimson Peak, 2015)\r2015-10-15\r6.2\r\rSv-M7jfTGM0\rA CULPA √â DAS ESTRELAS (The Fault in Our Stars, 2014)\r2014-06-05\r7.2\r\rEALV4nw-vx0\rA ENTREVISTA (The Interview, 2014)\r2014-12-27\r6.7\r\r4I44eE82Jk4\rA FORMA DA √ÅGUA (The Shape of Water, 2017)\r2018-01-24\r9.3\r\rMnpZqlfZ_KE\rA GAROTA DINAMARQUESA (The Danish Girl, 2015)\r2016-02-12\r6.8\r\rHjAxuKPzucY\rA GAROTA NO TREM (The Girl on the Train, 2016)\r2016-10-27\r5.1\r\rUuyN4G9BQgI\rA GHOST STORY (2017)\r2017-09-28\r10.0\r\r9irKAQoDN88\rA GRANDE APOSTA (The Big Short, 2015)\r2016-01-18\r7.8\r\rbNsUkl8hGvk\r√ÅGUAS RASAS (The Shallows, 2016)\r2016-08-07\r7.0\r\r\r\r\rAn√°lises\rAgora que temos uma base de dados, podemos fazer algumas an√°lises!\nPrimeiro, √© claro, vamos fazer os top 20 e os top -20\nnotas_2cents %\u0026gt;%\rdplyr::select(nm, nota) %\u0026gt;% dplyr::arrange(desc(nota)) %\u0026gt;% utils::head(20) %\u0026gt;% knitr::kable()\r\r\rnm\rnota\r\r\r\rA GHOST STORY (2017)\r10.0\r\rA QUALQUER CUSTO (Hell or High Water, 2016)\r10.0\r\rBINGO - O REI DAS MANH√ÉS (2017)\r10.0\r\rBLADE RUNNER 2049 (2017)\r10.0\r\rELLE (2016)\r10.0\r\rMAD MAX - ESTRADA DA F√öRIA (2015)\r10.0\r\rMOONLIGHT (2016)\r10.0\r\rRELATOS SELVAGENS (Relatos salvajes, 2014)\r10.0\r\rSPOTLIGHT (Segredos Revelados, 2015)\r10.0\r\rTHE HANDMAIDEN (Ah-ga-ssi, 2016)\r10.0\r\rO QUARTO DE JACK (Room, 2015)\r9.9\r\rTR√äS AN√öNCIOS PARA UM CRIME (2017)\r9.9\r\rBOYHOOD (2014)\r9.7\r\rDEADPOOL (2016)\r9.5\r\rWHIPLASH - EM BUSCA DA PERFEI√á√ÉO (2014)\r9.5\r\rA CHEGADA (Arrival, 2016)\r9.4\r\rAMOR \u0026amp; AMIZADE (Love \u0026amp; Friendship, 2016)\r9.4\r\rCORRA! (Get Out, 2017)\r9.4\r\rLA LA LAND (2016)\r9.4\r\rO REGRESSO (The Revenant, 2015)\r9.4\r\r\r\r\rN√£o assistiu a algum desses filmes? T√° na hora de ver!\nnotas_2cents %\u0026gt;%\rdplyr::select(nm, nota) %\u0026gt;% dplyr::arrange(nota) %\u0026gt;% utils::head(20) %\u0026gt;% knitr::kable()\r\r\rnm\rnota\r\r\r\rDEUSES DO EGITO (Gods of Egypt, 2016)\r0.0\r\rPORTA DOS FUNDOS - CONTRATO VITAL√çCIO (2016)\r2.1\r\rMULHERES AO ATAQUE (The Other Woman, 2014)\r2.3\r\rCINQUENTA TONS DE CINZA (2015)\r2.5\r\rTRANSFORMERS - A ERA DA EXTIN√á√ÉO (2014)\r2.5\r\rINFERNO (2016)\r3.3\r\rA CABANA (The Shack, 2017)\r3.4\r\rASSASSINS CREED (2016)\r3.5\r\rALICE ATRAV√âS DO ESPELHO (2016)\r3.6\r\rFRANKENSTEIN - ENTRE ANJOS E DEM√îNIOS (2014)\r3.6\r\rPETER PAN (Pan, 2015)\r3.6\r\rA M√öMIA (The Mummy, 2017)\r3.8\r\rANTES QUE EU V√Å (Before I Fall, 2017)\r3.8\r\rQUARTETO FANT√ÅSTICO (2015)\r3.8\r\rCONVERGENTE (Allegiant, 2016)\r3.9\r\rDEBI \u0026amp; L√ìIDE 2 (Dumb and Dumber To, 2014)\r3.9\r\rJOGOS MORTAIS - JIGSAW (2017)\r4.0\r\rJUNTOS E MISTURADOS (Blended, 2014)\r4.0\r\rThe Mortal Instruments - City of Bones (2013)\r4.0\r\rANNABELLE (2014)\r4.1\r\r\r\r\rJ√° assistiu a algum desses filmes? Meus p√™sames!\nTestando a minha hip√≥tese\rFinalmente, pude testar minha hip√≥tese!\np \u0026lt;- notas_2cents %\u0026gt;% ggplot(aes(x = data, y = nota, group = nm)) +\rgeom_point() +\rgeom_smooth(aes(group = 1), method = \u0026quot;lm\u0026quot;, se = FALSE) +\rtheme_minimal(16)\rplotly::ggplotly(p)\r## `geom_smooth()` using formula \u0026#39;y ~ x\u0026#39;\r## Warning: `group_by_()` is deprecated as of dplyr 0.7.0.\r## Please use `group_by()` instead.\r## See vignette(\u0026#39;programming\u0026#39;) for more help\r## This warning is displayed once every 8 hours.\r## Call `lifecycle::last_warnings()` to see where this warning was generated.\r\r{\"x\":{\"data\":[{\"x\":[16744,17535,16074,17463,16136,17287,17241,16037,16865,17263,17127,16723,16226,16431,17555,16843,17101,17437,16818,17020,17462,16104,17006,17212,16751,16949,17296,16294,16098,16087,17424,17038,16912,17454,17326,17122,17164,16314,16353,17394,16836,17303,17340,17142,17500,17181,16800,16968,16296,17208,16131,16463,17189,17407,17401,16713,16900,16060,17492,16765,16072,16035,16884,16733,17031,17524,17402,16449,17447,16097,17459,17024,17481,16374,16847,17060,16112,16995,17051,17042,16558,16162,16919,17110,16009,16821,16042,16539,17444,16625,16535,16478,16090,17332,17415,16875,17285,16804,16839,17410,16391,16896,17071,17471,17472,16965,17454,16857,16170,16605,17452,16997,16042,17107,17373,16108,17513,17138,17129,15960,17370,16058,16622,16560,17080,15989,17017,17187,16577,17439,16259,17508,17423,17193,17081,17435,16506,16458,17246,16337,16095,16074,16100,16469,17475,16345,16185,17255,16204,16702,16734,17336,15988,16079,16282,17284,16317,16675,17352,16632,16371,16927,17154,16974,17091,16522,16122,16518,16380,17088,16961,17416,16580,17199,17010,16247,16177,16950,17446,17501,16759,16393,16031,17215,16402,16993,17533,16274,16597,16910,17359,15995,17384,17436,16493,17235,17120,17179,16055,17218,17485,17204,17222,17451,17210,17509,16306,16796,16569,17430,16971,16220,17177,15896,16327,16695,16882,17544,17144,16660,17172,16906,17184,16003,16201,17317,16110,16142,17036,16080,16140,16688,16772,16163,16555,16219,15943,16413,16553,17547,17428,17013,16917,16978,17092,16471,17540,17297,16255,16187,17543,17391,16618,17381,16150,16252,16414,16050,16218,16455,16360,17346,17294,17073,16088,17489,17115,17479,16673,16106,16770,16351,16825,17521,17308,16828,16856,16302,17457,16805,17516,17098,16665,15940,17169,17274,17498,16709,17259,16716,16114,17312,17382,16270,17417,16587,16726,16983,17248,17323,15995,16985,17030,16653,17206,16678,16408,17135,17494,17305,16399,16117,17151,16898,16475,16129,17065,17174,16727,17197,16339,16650,16481,17117,16209,16807,17045,16788,17514,16809,16486,16740,17133,17079,17247,17460,16583,16423,15921,15965,16981,17106,15946,16903,15933,16397,17551,16332,17539,15910,16021,15966,16015,17465,17561,16590,16511,16148,16201,16265,17560,16852,16958,16126,17421,17396,16863,16232,17388,17270,16527,16768,17276,16548,17534,16233,17505,16134,16954,15974,16442,15951,15882,16939,16211,16880],\"y\":[6.4,8.6,9,7,7.1,5.7,8.5,8.1,8.2,3.4,9.4,6.2,7.2,6.7,9.3,6.8,5.1,10,7.8,7,6.9,6.9,5,5.9,7.2,3.6,6.3,7,5.6,7.3,4.9,9.4,5.2,6.6,3.8,7.4,9.1,7.9,4.1,6.8,9.1,3.8,8.2,10,6.3,3.5,7.4,4.6,4.6,8.8,7.3,7.1,7.8,6.6,4.4,7.5,6.9,5.5,6.8,6.8,8.5,7,6.6,7.6,4.7,7,10,9.3,10,8.5,8.2,8.6,7,9.7,8.4,6.5,4.4,6.6,5.6,6.7,6.4,8.5,9.2,8.6,8.6,9,6.5,4.7,6.1,7,7,2.5,8.4,7.3,7.8,3.9,9.4,8.4,9.5,4.6,3.9,7.6,7.5,5.3,7.6,8.1,8.1,0,5.1,8.6,7.9,7.6,7.6,7.4,8.8,8.6,6,4.1,10,8,8.6,7.4,7.8,6.8,7,5.7,6,6.3,8.8,7.8,8.3,7.6,7.4,8.8,6.7,7.7,6.4,8.1,7.1,8.2,3.6,8,7.5,7.1,6.1,9.2,7.9,6.1,7.1,7.5,6.9,8.6,8.8,4.8,9.1,7.3,6.3,4.1,7.7,7.9,7.1,8,6.9,4.8,3.3,7.8,8.1,4.4,7.7,9,8,8.2,7.6,7.4,6.8,5.9,7.6,5.7,8.3,4,7.6,7.5,7.7,7.5,7.5,7.8,6.7,4,5.8,7.7,7.3,6.9,8.6,5.5,5.5,6.6,8.9,9.4,5.7,8.2,6.9,7.4,9.1,7.6,8,9.2,6.1,8.3,10,9.2,5.8,5.6,9.3,5.9,5.5,5.4,7.6,8.6,7.6,8.1,8.7,8.6,10,8.5,2.3,7.8,8.2,4.7,6.4,8,8,7.1,7.9,9,6.9,8,6.4,9.1,8.1,7.7,5.2,6.9,4.1,4.6,7.3,4.6,7.8,8.2,7.2,6.7,7.4,7.4,4.5,6.9,7.4,8.7,7.5,6.5,8.1,7.6,6.3,8.1,9.2,4.6,8.6,6.5,7.3,8.4,8.8,6.1,8.3,7.1,9.9,7.2,6.4,9.4,5.6,4.6,8.3,9.3,9.2,7.2,7,5,4.8,9.1,7,7.9,8.1,3.6,7.9,4.7,9.3,9.1,5,4.9,8,2.1,4.8,8.1,7.7,7.6,7.1,3.8,7.9,9,5.3,8.4,8,4.9,10,6.8,8.1,7.5,8.8,6.3,6.7,7.8,8.1,8.7,6.9,8.2,7.2,6,8.4,10,7.4,9.1,9.2,8.5,7.7,7.5,8.2,8.2,7.4,7.9,5.6,8.3,5,8.1,5.6,10,5,8,4,7.4,7.9,7.2,7.6,6.9,7.7,7.1,7.4,8.1,7.2,6.6,8,7.1,4.2,2.5,9.9,7.5,5.6,7.1,9.2,8.1,6.4,4.4,5,6.4,6.4,4.4,7.2,8.9,8.4,7.1,7,8,6.4,6.3,9.5,5.3,6.8,6.9,6.9,8.9],\"text\":[\"data: 2015-11-05\nnota: 6.4\nnm: 007 CONTRA SPECTRE (2015)\",\"data: 2018-01-04\nnota: 8.6\nnm: 120 BATIMENTOS POR MINUTO (2017)\",\"data: 2014-01-04\nnota: 9.0\nnm: 12 YEARS A SLAVE (12 Anos de Escravid√£o, 2013)\",\"data: 2017-10-24\nnota: 7.0\nnm: 1922 (Netflix, 2017)\",\"data: 2014-03-07\nnota: 7.1\nnm: 300 - A ASCENS√ÉO DO IMP√âRIO (2014)\",\"data: 2017-05-01\nnota: 5.7\nnm: A AUT√ìPSIA (The Autopsy of Jane Doe, 2016)\",\"data: 2017-03-16\nnota: 8.5\nnm: A BELA E A FERA (Beauty and the Beast, 2017)\",\"data: 2013-11-28\nnota: 8.1\nnm: ABOUT TIME (Quest√£o de Tempo, 2013)\",\"data: 2016-03-05\nnota: 8.2\nnm: A BRUXA (The Witch, 2016)\",\"data: 2017-04-07\nnota: 3.4\nnm: A CABANA (The Shack, 2017)\",\"data: 2016-11-22\nnota: 9.4\nnm: A CHEGADA (Arrival, 2016)\",\"data: 2015-10-15\nnota: 6.2\nnm: A COLINA ESCARLATE (Crimson Peak, 2015)\",\"data: 2014-06-05\nnota: 7.2\nnm: A CULPA √â DAS ESTRELAS (The Fault in Our Stars, 2014)\",\"data: 2014-12-27\nnota: 6.7\nnm: A ENTREVISTA (The Interview, 2014)\",\"data: 2018-01-24\nnota: 9.3\nnm: A FORMA DA √ÅGUA (The Shape of Water, 2017)\",\"data: 2016-02-12\nnota: 6.8\nnm: A GAROTA DINAMARQUESA (The Danish Girl, 2015)\",\"data: 2016-10-27\nnota: 5.1\nnm: A GAROTA NO TREM (The Girl on the Train, 2016)\",\"data: 2017-09-28\nnota: 10.0\nnm: A GHOST STORY (2017)\",\"data: 2016-01-18\nnota: 7.8\nnm: A GRANDE APOSTA (The Big Short, 2015)\",\"data: 2016-08-07\nnota: 7.0\nnm: √ÅGUAS RASAS (The Shallows, 2016)\",\"data: 2017-10-23\nnota: 6.9\nnm: A GUERRA DOS SEXOS (Battle of the Sexes, 2017)\",\"data: 2014-02-03\nnota: 6.9\nnm: √ÅLBUM DE FAM√çLIA (August - Osage County, 2013)\",\"data: 2016-07-24\nnota: 5.0\nnm: A LENDA DE TARZAN (The Legend of Tarzan, 2016)\",\"data: 2017-02-15\nnota: 5.9\nnm: ALIADOS (Allied, 2016)\",\"data: 2015-11-12\nnota: 7.2\nnm: ALIAN√áA DO CRIME (Black Mass, 2015)\",\"data: 2016-05-28\nnota: 3.6\nnm: ALICE ATRAV√âS DO ESPELHO (2016)\",\"data: 2017-05-10\nnota: 6.3\nnm: ALIEN - COVENANT (2017)\",\"data: 2014-08-12\nnota: 7.0\nnm: AMANTES ETERNOS (Only Lovers Left alive, 2014)\",\"data: 2014-01-28\nnota: 5.6\nnm: A MENINA QUE ROUBAVA LIVROS\",\"data: 2014-01-17\nnota: 7.3\nnm: AMERICAN HUSTLE (Trapa√ßa, 2013)\",\"data: 2017-09-15\nnota: 4.9\nnm: AMITYVILLE - O DESPERTAR (Amityville - The Awakening, 2017)\",\"data: 2016-08-25\nnota: 9.4\nnm: AMOR \u0026 AMIZADE (Love \u0026 Friendship, 2016)\",\"data: 2016-04-21\nnota: 5.2\nnm: AMOR POR DIREITO (Freeheld, 2015)\",\"data: 2017-10-15\nnota: 6.6\nnm: A MORTE TE D√Å PARAB√âNS! (Happy Death Day, 2017)\",\"data: 2017-06-09\nnota: 3.8\nnm: A M√öMIA (The Mummy, 2017)\",\"data: 2016-11-17\nnota: 7.4\nnm: ANIMAIS FANT√ÅSTICOS E ONDE HABITAM (2016)\",\"data: 2016-12-29\nnota: 9.1\nnm: ANIMAIS NOTURNOS (Nocturnal Animals, 2016)\",\"data: 2014-09-01\nnota: 7.9\nnm: ANJOS DA LEI 2 (22 Jump Street, 2014)\",\"data: 2014-10-10\nnota: 4.1\nnm: ANNABELLE (2014)\",\"data: 2017-08-16\nnota: 6.8\nnm: ANNABELLE 2 - A CRIA√á√ÉO DO MAL (Annabelle - Creation, 2017)\",\"data: 2016-02-05\nnota: 9.1\nnm: ANOMALISA (2015)\",\"data: 2017-05-17\nnota: 3.8\nnm: ANTES QUE EU V√Å (Before I Fall, 2017)\",\"data: 2017-06-23\nnota: 8.2\nnm: AO CAIR DA NOITE (It Comes at Night, 2017)\",\"data: 2016-12-07\nnota: 10.0\nnm: A QUALQUER CUSTO (Hell or High Water, 2016)\",\"data: 2017-11-30\nnota: 6.3\nnm: ASSASSINATO NO EXPRESSO DO ORIENTE (2017)\",\"data: 2017-01-15\nnota: 3.5\nnm: ASSASSINS CREED (2016)\",\"data: 2015-12-31\nnota: 7.4\nnm: AS SUFRAGISTAS (Suffragette, 2015)\",\"data: 2016-06-16\nnota: 4.6\nnm: AS TARTARUGAS NINJA - FORA DAS SOMBRAS (2016)\",\"data: 2014-08-14\nnota: 4.6\nnm: AS TARTARUGAS NINJA (Teenage Mutant Ninja Turtles, 2014)\",\"data: 2017-02-11\nnota: 8.8\nnm: A TARTARUGA VERMELHA (La tortue rouge, 2016)\",\"data: 2014-03-02\nnota: 7.3\nnm: AT√â O FIM (All Is Lost, 2014)\",\"data: 2015-01-28\nnota: 7.1\nnm: A TEORIA DE TUDO (The Theory of Everything, 2014)\",\"data: 2017-01-23\nnota: 7.8\nnm: AT√â O √öLTIMO HOMEM (Hacksaw Ridge, 2016)\",\"data: 2017-08-29\nnota: 6.6\nnm: AT√îMICA (Atomic Blonde, 2017)\",\"data: 2017-08-23\nnota: 4.4\nnm: A TORRE NEGRA (The Dark Tower, 2017)\",\"data: 2015-10-05\nnota: 7.5\nnm: A TRAVESSIA (The Walk, 2015)\",\"data: 2016-04-09\nnota: 6.9\nnm: AVE, C√âSAR! (Hail, Caesar! 2016)\",\"data: 2013-12-21\nnota: 5.5\nnm: A VIDA SECRETA DE WALTER MITTY (2013)\",\"data: 2017-11-22\nnota: 6.8\nnm: A VIL√É (Ak-Nyeo, 2017)\",\"data: 2015-11-26\nnota: 6.8\nnm: A VISITA (The Visit, 2015)\",\"data: 2014-01-02\nnota: 8.5\nnm: Azul √© a Cor Mais Quente (La vie dAd√®le, 2013)\",\"data: 2013-11-26\nnota: 7.0\nnm: BAD GRANDPA (Vov√¥ Sem Vergonha, 2013)\",\"data: 2016-03-24\nnota: 6.6\nnm: BATMAN VS SUPERMAN - A ORIGEM DA JUSTI√áA (2016)\",\"data: 2015-10-25\nnota: 7.6\nnm: BEASTS OF NO NATION (2015)\",\"data: 2016-08-18\nnota: 4.7\nnm: BEN-HUR (2016)\",\"data: 2017-12-24\nnota: 7.0\nnm: BETTER WATCH OUT (2016)\",\"data: 2017-08-24\nnota: 10.0\nnm: BINGO - O REI DAS MANH√ÉS (2017)\",\"data: 2015-01-14\nnota: 9.3\nnm: BIRDMAN (2014)\",\"data: 2017-10-08\nnota: 10.0\nnm: BLADE RUNNER 2049 (2017)\",\"data: 2014-01-27\nnota: 8.5\nnm: BLUE JASMINE (2013)\",\"data: 2017-10-20\nnota: 8.2\nnm: BOM COMPORTAMENTO (Good Time, 2017)\",\"data: 2016-08-11\nnota: 8.6\nnm: BONE TOMAHAWK (2015)\",\"data: 2017-11-11\nnota: 7.0\nnm: BORG VS MCENROE (2017)\",\"data: 2014-10-31\nnota: 9.7\nnm: BOYHOOD (2014)\",\"data: 2016-02-16\nnota: 8.4\nnm: BROOKLYN (2015)\",\"data: 2016-09-16\nnota: 6.5\nnm: BRUXA DE BLAIR (Blair Witch, 2016)\",\"data: 2014-02-11\nnota: 4.4\nnm: CA√áADORES DE OBRAS-PRIMAS (2014)\",\"data: 2016-07-13\nnota: 6.6\nnm: CA√áA-FANTASMAS (Ghostbusters, 2016)\",\"data: 2016-09-07\nnota: 5.6\nnm: C√ÉES DE GUERRA (War Dogs, 2016)\",\"data: 2016-08-29\nnota: 6.7\nnm: CAF√â SOCIETY (2016)\",\"data: 2015-05-03\nnota: 6.4\nnm: CAKE (Uma Raz√£o para Viver, 2014)\",\"data: 2014-04-02\nnota: 8.5\nnm: CAPIT√ÉO AM√âRICA 2 - O SOLDADO INVERNAL (2014)\",\"data: 2016-04-28\nnota: 9.2\nnm: CAPIT√ÉO AMERICA - GUERRA CIVIL (2016)\",\"data: 2016-11-05\nnota: 8.6\nnm: CAPIT√ÉO FANT√ÅSTICO (Captain Fantastic, 2016)\",\"data: 2013-10-31\nnota: 8.6\nnm: CAPIT√ÉO PHILLIPS (2013)\",\"data: 2016-01-21\nnota: 9.0\nnm: CAROL (2015)\",\"data: 2013-12-03\nnota: 6.5\nnm: CARRIE, A ESTRANHA (1976 e 2013)\",\"data: 2015-04-14\nnota: 4.7\nnm: CHAPPIE (2015)\",\"data: 2017-10-05\nnota: 6.1\nnm: CHURCHILL (2017)\",\"data: 2015-07-09\nnota: 7.0\nnm: CIDADES DE PAPEL (Paper Towns, 2015)\",\"data: 2015-04-10\nnota: 7.0\nnm: CINDERELA (2015)\",\"data: 2015-02-12\nnota: 2.5\nnm: CINQUENTA TONS DE CINZA (2015)\",\"data: 2014-01-20\nnota: 8.4\nnm: CLUBE DE COMPRAS DALLAS (2013)\",\"data: 2017-06-15\nnota: 7.3\nnm: COLOSSAL (2017)\",\"data: 2017-09-06\nnota: 7.8\nnm: COMO NOSSOS PAIS (2017)\",\"data: 2016-03-15\nnota: 3.9\nnm: CONVERGENTE (Allegiant, 2016)\",\"data: 2017-04-29\nnota: 9.4\nnm: CORRA! (Get Out, 2017)\",\"data: 2016-01-04\nnota: 8.4\nnm: CREED (Nascido para Lutar, 2015)\",\"data: 2016-02-08\nnota: 9.5\nnm: DEADPOOL (2016)\",\"data: 2017-09-01\nnota: 4.6\nnm: DEATH NOTE (Netflix, 2017)\",\"data: 2014-11-17\nnota: 3.9\nnm: DEBI \u0026 L√ìIDE 2 (Dumb and Dumber To, 2014)\",\"data: 2016-04-05\nnota: 7.6\nnm: DECIS√ÉO DE RISCO (Eye in the Sky, 2015)\",\"data: 2016-09-27\nnota: 7.5\nnm: DEM√îNIO DE NEON (The Neon Demon, 2016)\",\"data: 2017-11-01\nnota: 5.3\nnm: DEPOIS DAQUELA MONTANHA (The Mountain Between Us, 2017)\",\"data: 2017-11-02\nnota: 7.6\nnm: DESERTO (Desierto, 2015)\",\"data: 2016-06-13\nnota: 8.1\nnm: DESTINO ESPECIAL (Midnight Special, 2016)\",\"data: 2017-10-15\nnota: 8.1\nnm: DETROIT EM REBELI√ÉO (2017)\",\"data: 2016-02-26\nnota: 0.0\nnm: DEUSES DO EGITO (Gods of Egypt, 2016)\",\"data: 2014-04-10\nnota: 5.1\nnm: DIVERGENTE (2014)\",\"data: 2015-06-19\nnota: 8.6\nnm: DIVERTIDA MENTE (Inside Out, 2015)\",\"data: 2017-10-13\nnota: 7.9\nnm: DOENTES DE AMOR (The Big Sick, 2017)\",\"data: 2016-07-15\nnota: 7.6\nnm: DOIS CARAS LEGAIS (The Nice Guys, 2016)\",\"data: 2013-12-03\nnota: 7.6\nnm: DON JON (Como N√£o Perder Essa Mulher, 2013)\",\"data: 2016-11-02\nnota: 7.4\nnm: DOUTOR ESTRANHO (2016)\",\"data: 2017-07-26\nnota: 8.8\nnm: DUNKIRK (2017)\",\"data: 2014-02-07\nnota: 8.6\nnm: ELA (Her, 2013)\",\"data: 2017-12-13\nnota: 6.0\nnm: EL CAMINO CHRISTMAS (Netflix, 2017)\",\"data: 2016-12-03\nnota: 4.1\nnm: ELIS (2016)\",\"data: 2016-11-24\nnota: 10.0\nnm: ELLE (2016)\",\"data: 2013-09-12\nnota: 8.0\nnm: ELYSIUM (2013)\",\"data: 2017-07-23\nnota: 8.6\nnm: EM RITMO DE FUGA (Baby Driver, 2017)\",\"data: 2013-12-19\nnota: 7.4\nnm: ENDERS GAME (2013)\",\"data: 2015-07-06\nnota: 7.8\nnm: ENQUANTO SOMOS JOVENS (2015)\",\"data: 2015-05-05\nnota: 6.8\nnm: ENTRE ABELHAS (2015)\",\"data: 2016-10-06\nnota: 7.0\nnm: ERA DOS GIGANTES (2016)\",\"data: 2013-10-11\nnota: 5.7\nnm: ESCAPE PLAN (Rota de Fuga, 2013)\",\"data: 2016-08-04\nnota: 6.0\nnm: ESQUADR√ÉO SUICIDA (Suicide Squad, 2016)\",\"data: 2017-01-21\nnota: 6.3\nnm: ESTRELAS AL√âM DO TEMPO (Hidden Figures, 2016)\",\"data: 2015-05-22\nnota: 8.8\nnm: EX MACHINA (2015)\",\"data: 2017-09-30\nnota: 7.8\nnm: EXODUS - DE ONDE EU VIM N√ÉO EXISTE MAIS (2017)\",\"data: 2014-07-08\nnota: 8.3\nnm: EXPRESSO DO AMANH√É (Snowpiercer, 2013)\",\"data: 2017-12-08\nnota: 7.6\nnm: EXTRAORDIN√ÅRIO (Wonder, 2017)\",\"data: 2017-09-14\nnota: 7.4\nnm: FEITO NA AM√âRICA (American Made, 2017)\",\"data: 2017-01-27\nnota: 8.8\nnm: FENCES (2016)\",\"data: 2016-10-07\nnota: 6.7\nnm: FESTA DA SALSICHA (Sausage Party, 2016)\",\"data: 2017-09-26\nnota: 7.7\nnm: FIRST THEY KILLED MY FATHER (Netflix, 2017)\",\"data: 2015-03-12\nnota: 6.4\nnm: FOCUS (Golpe Duplo, 2015)\",\"data: 2015-01-23\nnota: 8.1\nnm: FOXCATCHER (2014)\",\"data: 2017-03-21\nnota: 7.1\nnm: FRAGMENTADO (Split, 2017)\",\"data: 2014-09-24\nnota: 8.2\nnm: FRANK (2014)\",\"data: 2014-01-25\nnota: 3.6\nnm: FRANKENSTEIN - ENTRE ANJOS E DEM√îNIOS (2014)\",\"data: 2014-01-04\nnota: 8.0\nnm: FROZEN (2013)\",\"data: 2014-01-30\nnota: 7.5\nnm: FRUITVALE STATION - A √öLTIMA PARADA (2013)\",\"data: 2015-02-03\nnota: 7.1\nnm: FURY (Cora√ß√µes de Ferro, 2014)\",\"data: 2017-11-05\nnota: 6.1\nnm: GABRIEL E A MONTANHA (2017)\",\"data: 2014-10-02\nnota: 9.2\nnm: GAROTA EXEMPLAR (Gone Girl, 2014)\",\"data: 2014-04-25\nnota: 7.9\nnm: GET√öLIO (2014)\",\"data: 2017-03-30\nnota: 6.1\nnm: GHOST IN THE SHELL (2017)\",\"data: 2014-05-14\nnota: 7.1\nnm: GODZILLA (2014)\",\"data: 2015-09-24\nnota: 7.5\nnm: GOODNIGHT MOMMY (Ich seh, Ich seh, 2015)\",\"data: 2015-10-26\nnota: 6.9\nnm: GOOSEBUMPS - MONSTROS E ARREPIOS (2015)\",\"data: 2017-06-19\nnota: 8.6\nnm: GRAVE (Raw, 2016)\",\"data: 2013-10-10\nnota: 8.8\nnm: GRAVITY (Gravidade, 2013)\",\"data: 2014-01-09\nnota: 4.8\nnm: GRUDGE MATCH (Ajuste de Contas, 2014)\",\"data: 2014-07-31\nnota: 9.1\nnm: GUARDI√ïES DA GALAXIA (2014)\",\"data: 2017-04-28\nnota: 7.3\nnm: GUARDI√ïES DA GAL√ÅXIA VOL. 2 (Guardians of the Galaxy Vol. 2, 2017)\",\"data: 2014-09-04\nnota: 6.3\nnm: H√âRCULES (2014)\",\"data: 2015-08-28\nnota: 4.1\nnm: HITMAN - AGENTE 47 (2015)\",\"data: 2017-07-05\nnota: 7.7\nnm: HOMEM-ARANHA - DE VOLTA AO LAR (Spider-Man- Homecoming, 2017)\",\"data: 2015-07-16\nnota: 7.9\nnm: HOMEM-FORMIGA (2015)\",\"data: 2014-10-28\nnota: 7.1\nnm: HORNS (O Pacto, 2014)\",\"data: 2016-05-06\nnota: 8.0\nnm: HUSH - A MORTE OUVE (2016)\",\"data: 2016-12-19\nnota: 6.9\nnm: IMPERIUM (2016)\",\"data: 2016-06-22\nnota: 4.8\nnm: INDEPENDENCE DAY - O RESSURGIMENTO (2016)\",\"data: 2016-10-17\nnota: 3.3\nnm: INFERNO (2016)\",\"data: 2015-03-28\nnota: 7.8\nnm: INHERENT VICE (V√≠cio Inerente, 2014)\",\"data: 2014-02-21\nnota: 8.1\nnm: INSIDE LLEWYN DAVIS (2013)\",\"data: 2015-03-24\nnota: 4.4\nnm: INSURGENTE (2015)\",\"data: 2014-11-06\nnota: 7.7\nnm: INTERESTELAR (Interstellar, 2014)\",\"data: 2016-10-14\nnota: 9.0\nnm: INVAS√ÉO ZUMBI (Busanhaeng, 2016)\",\"data: 2016-06-09\nnota: 8.0\nnm: INVOCA√á√ÉO DO MAL 2 (The Conjuring 2, 2016)\",\"data: 2017-09-07\nnota: 8.2\nnm: IT - A COISA (2017)\",\"data: 2015-05-25\nnota: 7.6\nnm: IT FOLLOWS (Corrente do Mal, 2015)\",\"data: 2017-02-02\nnota: 7.4\nnm: JACKIE (2016)\",\"data: 2016-07-28\nnota: 6.8\nnm: JASON BOURNE (2016)\",\"data: 2014-06-26\nnota: 5.9\nnm: JERSEY BOYS - EM BUSCA DA M√öSICA\",\"data: 2014-04-17\nnota: 7.6\nnm: JOE (2014)\",\"data: 2016-05-29\nnota: 5.7\nnm: JOGO DO DINHEIRO (Money Monster, 2016)\",\"data: 2017-10-07\nnota: 8.3\nnm: JOGO PERIGOSO (Geralds Game, Netflix, 2017)\",\"data: 2017-12-01\nnota: 4.0\nnm: JOGOS MORTAIS - JIGSAW (2017)\",\"data: 2015-11-20\nnota: 7.6\nnm: JOGOS VORAZES - A ESPERAN√áA - O FINAL (2015)\",\"data: 2014-11-19\nnota: 7.5\nnm: JOGOS VORAZES - A ESPERAN√áA - PARTE 1 (2014)\",\"data: 2013-11-22\nnota: 7.7\nnm: JOGOS VORAZES - EM CHAMAS (2013)\",\"data: 2017-02-18\nnota: 7.5\nnm: JOHN WICK - CHAPTER 2 (2017)\",\"data: 2014-11-28\nnota: 7.5\nnm: JOHN WICK (De Volta ao Jogo, 2014)\",\"data: 2016-07-11\nnota: 7.8\nnm: JULIETA (2016)\",\"data: 2018-01-02\nnota: 6.7\nnm: JUMANJI - BEM-VINDO √Ä SELVA (2017)\",\"data: 2014-07-23\nnota: 4.0\nnm: JUNTOS E MISTURADOS (Blended, 2014)\",\"data: 2015-06-11\nnota: 5.8\nnm: JURASSIC WORLD - O Mundo dos Dinossauros (2015)\",\"data: 2016-04-19\nnota: 7.7\nnm: JUVENTUDE (Youth, 2015)\",\"data: 2017-07-12\nnota: 7.3\nnm: KEDI (Gatos, 2017)\",\"data: 2013-10-17\nnota: 6.9\nnm: KICK-ASS 2 (2013)\",\"data: 2017-08-06\nnota: 8.6\nnm: KIMI NO NA WA. (Your Name., 2016)\",\"data: 2017-09-27\nnota: 5.5\nnm: KINGSMAN - O C√çRCULO DOURADO (Kingsman - The Golden Circle, 2017)\",\"data: 2015-02-27\nnota: 5.5\nnm: KINGSMAN - SERVI√áO SECRETO (2015)\",\"data: 2017-03-10\nnota: 6.6\nnm: KONG - A ILHA DA CAVEIRA (Kong - Skull Island, 2017)\",\"data: 2016-11-15\nnota: 8.9\nnm: KUBO E AS CORDAS M√ÅGICAS (Kubo and the Two Strings, 2016)\",\"data: 2017-01-13\nnota: 9.4\nnm: LA LA LAND (2016)\",\"data: 2013-12-16\nnota: 5.7\nnm: LAST VEGAS (√öltima Viagem a Vegas, 2013)\",\"data: 2017-02-21\nnota: 8.2\nnm: LEGO BATMAN - O FILME (The LEGO Batman Movie, 2017)\",\"data: 2017-11-15\nnota: 6.9\nnm: LIGA DA JUSTI√áA (Justice League, 2017)\",\"data: 2017-02-07\nnota: 7.4\nnm: LION (2016)\",\"data: 2017-02-25\nnota: 9.1\nnm: LOGAN (2017)\",\"data: 2017-10-12\nnota: 7.6\nnm: LOGAN LUCKY - ROUBO EM FAM√çLIA (2017)\",\"data: 2017-02-13\nnota: 8.0\nnm: LOVING (2016)\",\"data: 2017-12-09\nnota: 9.2\nnm: LUCKY (2017)\",\"data: 2014-08-24\nnota: 6.1\nnm: LUCY (2014)\",\"data: 2015-12-27\nnota: 8.3\nnm: MACBETH - AMBI√á√ÉO E GUERRA (2015)\",\"data: 2015-05-14\nnota: 10.0\nnm: MAD MAX - ESTRADA DA F√öRIA (2015)\",\"data: 2017-09-21\nnota: 9.2\nnm: M√ÉE! (Mother!, 2017)\",\"data: 2016-06-19\nnota: 5.8\nnm: MAIS FORTE QUE O MUNDO - A HIST√ìRIA DE JOS√â ALDO (2016)\",\"data: 2014-05-30\nnota: 5.6\nnm: MAL√âVOLA (Maleficent, 2014)\",\"data: 2017-01-11\nnota: 9.3\nnm: MANCHESTER √Ä BEIRA-MAR (Manchester by the Sea, 2016)\",\"data: 2013-07-10\nnota: 5.9\nnm: MAN OF STEEL (Homem de A√ßo, 2013)\",\"data: 2014-09-14\nnota: 5.5\nnm: MAZE RUNNER - CORRER OU MORRER (The Maze Runner, 2014)\",\"data: 2015-09-17\nnota: 5.4\nnm: MAZE RUNNER - PROVA DE FOGO (2015)\",\"data: 2016-03-22\nnota: 7.6\nnm: ME AND EARL AND THE DYING GIRL (2015)\",\"data: 2018-01-13\nnota: 8.6\nnm: ME CHAME PELO SEU NOME (Call Me by Your Name, 2017)\",\"data: 2016-12-09\nnota: 7.6\nnm: MICHELLE E OBAMA (Southside with You, 2016)\",\"data: 2015-08-13\nnota: 8.1\nnm: MISS√ÉO - IMPOSS√çVEL - NA√á√ÉO SECRETA (2015)\",\"data: 2017-01-06\nnota: 8.7\nnm: MOANA (2016)\",\"data: 2016-04-15\nnota: 8.6\nnm: MOGLI - O MENINO LOBO (The Jungle Book, 2016)\",\"data: 2017-01-18\nnota: 10.0\nnm: MOONLIGHT (2016)\",\"data: 2013-10-25\nnota: 8.5\nnm: MUD (Amor Bandido, 2013) - Cr√≠tica-y2q5pDUgrm0\",\"data: 2014-05-11\nnota: 2.3\nnm: MULHERES AO ATAQUE (The Other Woman, 2014)\",\"data: 2017-05-31\nnota: 7.8\nnm: MULHER-MARAVILHA (Wonder Woman, 2017)\",\"data: 2014-02-09\nnota: 8.2\nnm: NEBRASKA (2013)\",\"data: 2014-03-13\nnota: 4.7\nnm: NEED FOR SPEED - O FILME (2014)\",\"data: 2016-08-23\nnota: 6.4\nnm: NERVE - UM JOGO SEM REGRAS (2016)\",\"data: 2014-01-10\nnota: 8.0\nnm: NINFOMAN√çACA - Volume 1 (2014)\",\"data: 2014-03-11\nnota: 8.0\nnm: NINFOMAN√çACA - Volume 2 (2014)\",\"data: 2015-09-10\nnota: 7.1\nnm: NOCAUTE (Southpaw, 2015)\",\"data: 2015-12-03\nnota: 7.9\nnm: NO CORA√á√ÉO DO MAR (In the Heart of the Sea, 2015)\",\"data: 2014-04-03\nnota: 9.0\nnm: NO√â (Noah, 2014)\",\"data: 2015-04-30\nnota: 6.9\nnm: NOITE SEM FIM (Run All Night, 2015)\",\"data: 2014-05-29\nnota: 8.0\nnm: NO LIMITE DO AMANH√É (Edge of Tomorrow, 2014)\",\"data: 2013-08-26\nnota: 6.4\nnm: NOW YOU SEE ME (Truque de Mestre, 2013)\",\"data: 2014-12-09\nnota: 9.1\nnm: O ABUTRE (Nightcrawler, 2014)\",\"data: 2015-04-28\nnota: 8.1\nnm: O ANO MAIS VIOLENTO (A Most Violent Year, 2014)\",\"data: 2018-01-16\nnota: 7.7\nnm: O ARTISTA DO DESASTRE (The Disaster Artist, 2017)\",\"data: 2017-09-19\nnota: 5.2\nnm: O ASSASSINO - O PRIMEIRO ALVO (American Assassin, 2017)\",\"data: 2016-07-31\nnota: 6.9\nnm: O BOM GIGANTE AMIGO (The BFG, 2016)\",\"data: 2016-04-26\nnota: 4.1\nnm: O CA√áADOR E A RAINHA DO GELO (2016)\",\"data: 2016-06-26\nnota: 4.6\nnm: O CASEIRO (2016)\",\"data: 2016-10-18\nnota: 7.3\nnm: O CONTADOR (The Accountant, 2016)\",\"data: 2015-02-05\nnota: 4.6\nnm: O DESTINO DE J√öPITER (Jupiter Ascending, 2015)\",\"data: 2018-01-09\nnota: 7.8\nnm: O DESTINO DE UMA NA√á√ÉO (Darkest Hour, 2017)\",\"data: 2017-05-11\nnota: 8.2\nnm: O DIA DO ATENTADO (Patriots Day, 2016)\",\"data: 2014-07-04\nnota: 7.2\nnm: O ESPELHO (Oculus, 2014)\",\"data: 2014-04-27\nnota: 6.7\nnm: O ESPETACULAR HOMEM-ARANHA 2 - A AMEA√áA DE ELECTRO (2014)\",\"data: 2018-01-12\nnota: 7.4\nnm: O ESTRANGEIRO (The Foreigner, 2017)\",\"data: 2017-08-13\nnota: 7.4\nnm: O ESTRANHO QUE N√ìS AMAMOS (The Beguiled, 2017)\",\"data: 2015-07-02\nnota: 4.5\nnm: O EXTERMINADOR DO FUTURO - G√äNESIS (2015)\",\"data: 2017-08-03\nnota: 6.9\nnm: O FILME DA MINHA VIDA (2017)\",\"data: 2014-03-21\nnota: 7.4\nnm: O GRANDE HER√ìI (Lone Survivor, 2013)\",\"data: 2014-07-01\nnota: 8.7\nnm: O GRANDE HOTEL BUDAPESTE (2014)\",\"data: 2014-12-10\nnota: 7.5\nnm: O HOBBIT - A BATALHA DOS CINCO EX√âRCITOS (2014)\",\"data: 2013-12-11\nnota: 6.5\nnm: O HOBBIT - A DESOLA√á√ÉO DE SMAUG (2013)\",\"data: 2014-05-28\nnota: 8.1\nnm: O HOMEM DUPLICADO (2014)\",\"data: 2015-01-20\nnota: 7.6\nnm: O JOGO DA IMITA√á√ÉO (The Imitation Game, 2014)\",\"data: 2014-10-17\nnota: 6.3\nnm: O JUIZ (The Judge, 2014)\",\"data: 2017-06-29\nnota: 8.1\nnm: OKJA (Netflix, 2017)\",\"data: 2017-05-08\nnota: 9.2\nnm: O LAMENTO (Goksung, 2016)\",\"data: 2016-09-29\nnota: 4.6\nnm: O LAR DAS CRIAN√áAS PECULIARES (2016)\",\"data: 2014-01-18\nnota: 8.6\nnm: O LOBO DE WALL STREET (2013)\",\"data: 2017-11-19\nnota: 6.5\nnm: O MATADOR (Netflix, 2017)\",\"data: 2016-11-10\nnota: 7.3\nnm: O NASCIMENTO DE UMA NA√á√ÉO (The Birth of a Nation, 2016)\",\"data: 2017-11-09\nnota: 8.4\nnm: ONE OF US (Netflix, 2017)\",\"data: 2015-08-26\nnota: 8.8\nnm: O PEQUENO PR√çNCIPE (2015)\",\"data: 2014-02-05\nnota: 6.1\nnm: OPERA√á√ÉO SOMBRA - JACK RYAN (2014)\",\"data: 2015-12-01\nnota: 8.3\nnm: O PRESENTE (The Gift, 2015)\",\"data: 2014-10-08\nnota: 7.1\nnm: O PROTETOR (The Equalizer, 2014)\",\"data: 2016-01-25\nnota: 9.9\nnm: O QUARTO DE JACK (Room, 2015)\",\"data: 2017-12-21\nnota: 7.2\nnm: O QUE TE FAZ MAIS FORTE (Stronger, 2017)\",\"data: 2017-05-22\nnota: 6.4\nnm: O RASTRO (2017)\",\"data: 2016-01-28\nnota: 9.4\nnm: O REGRESSO (The Revenant, 2015)\",\"data: 2016-02-25\nnota: 5.6\nnm: ORGULHO E PRECONCEITO E ZUMBIS (2016)\",\"data: 2014-08-20\nnota: 4.6\nnm: OS MERCEN√ÅRIOS 3 (The Expendables 3, 2014)\",\"data: 2017-10-18\nnota: 8.3\nnm: OS MEYEROWITZ - FAM√çLIA N√ÉO SE ESCOLHE (Netflix, 2017)\",\"data: 2016-01-05\nnota: 9.3\nnm: OS OITO ODIADOS (The Hateful Eight, 2015)\",\"data: 2017-12-16\nnota: 9.2\nnm: OS √öLTIMOS JEDI (2017) - COMENT√ÅRIOS COM SPOILERS!-GTQj4SL_xcE\",\"data: 2016-10-24\nnota: 7.2\nnm: OUIJA - ORIGEM DO MAL (Ouija - Origin of Evil, 2016)\",\"data: 2015-08-18\nnota: 7.0\nnm: O √öLTIMO CINE DRIVE-IN (2014)\",\"data: 2013-08-23\nnota: 5.0\nnm: PAIN \u0026 GAIN (Sem Dor, Sem Ganho, 2013)\",\"data: 2017-01-03\nnota: 4.8\nnm: PASSAGEIROS (Passengers, 2016)\",\"data: 2017-04-18\nnota: 9.1\nnm: PATERSON (2016)\",\"data: 2017-11-28\nnota: 7.0\nnm: PATTI CAKE$ (2017)\",\"data: 2015-10-01\nnota: 7.9\nnm: PERDIDO EM MARTE (The Martian, 2015)\",\"data: 2017-04-03\nnota: 8.1\nnm: PERSONAL SHOPPER (2016)\",\"data: 2015-10-08\nnota: 3.6\nnm: PETER PAN (Pan, 2015)\",\"data: 2014-02-13\nnota: 7.9\nnm: PHILOMENA (2013)\",\"data: 2017-05-26\nnota: 4.7\nnm: PIRATAS DO CARIBE - A VINGAN√áA DE SALAZAR (2017)\",\"data: 2017-08-04\nnota: 9.3\nnm: PLANETA DOS MACACOS - A GUERRA (War for the Planet of the Apes, 2017)\",\"data: 2014-07-19\nnota: 9.1\nnm: PLANETA DOS MACACOS - O CONFRONTO (2014)\",\"data: 2017-09-08\nnota: 5.0\nnm: POL√çCIA FEDERAL - A LEI √â PARA TODOS (2017)\",\"data: 2015-06-01\nnota: 4.9\nnm: POLTERGEIST - O FEN√îMENO (1982 e 2015)\",\"data: 2015-10-18\nnota: 8.0\nnm: PONTE DOS ESPI√ïES (Bridge of Spies, 2015)\",\"data: 2016-07-01\nnota: 2.1\nnm: PORTA DOS FUNDOS - CONTRATO VITAL√çCIO (2016)\",\"data: 2017-03-23\nnota: 4.8\nnm: POWER RANGERS (2017)\",\"data: 2017-06-06\nnota: 8.1\nnm: PREVENGE (2017)\",\"data: 2013-10-17\nnota: 7.7\nnm: PRISONERS (Os Suspeitos, 2013)\",\"data: 2016-07-03\nnota: 7.6\nnm: PROCURANDO DORY (Finding Dory, 2016)\",\"data: 2016-08-17\nnota: 7.1\nnm: QUANDO AS LUZES SE APAGAM (Lights Out, 2016)\",\"data: 2015-08-06\nnota: 3.8\nnm: QUARTETO FANT√ÅSTICO (2015)\",\"data: 2017-02-09\nnota: 7.9\nnm: QUASE 18 (The Edge of Seventeen, 2016)\",\"data: 2015-08-31\nnota: 9.0\nnm: QUE HORAS ELA VOLTA (2015)\",\"data: 2014-12-04\nnota: 5.3\nnm: QUERO MATAR MEU CHEFE 2 (Horrible Bosses 2, 2014)\",\"data: 2016-11-30\nnota: 8.4\nnm: RAINHA DE KATWE (Queen of Katwe, 2016)\",\"data: 2017-11-24\nnota: 8.0\nnm: RAINHA DO MUNDO (Queen of Earth, 2015)\",\"data: 2017-05-19\nnota: 4.9\nnm: REI ARTHUR - A LENDA DA ESPADA (King Arthur - Legend of the Sword, 2017)\",\"data: 2014-11-25\nnota: 10.0\nnm: RELATOS SELVAGENS (Relatos salvajes, 2014)\",\"data: 2014-02-16\nnota: 6.8\nnm: ROBOCOP (2014)\",\"data: 2016-12-16\nnota: 8.1\nnm: ROGUE ONE - UMA HIST√ìRIA STAR WARS (2016)\",\"data: 2016-04-07\nnota: 7.5\nnm: RUA CLOVERFIELD, 10 (10 Cloverfield Lane, 2016)\",\"data: 2015-02-09\nnota: 8.8\nnm: SELMA (Uma Luta pela Igualdade, 2014)\",\"data: 2014-02-28\nnota: 6.3\nnm: SEM ESCALAS (Non-Stop, 2014)\",\"data: 2016-09-21\nnota: 6.7\nnm: SETE HOMENS E UM DESTINO (The Magnificent Seven, 2016)\",\"data: 2017-01-08\nnota: 7.8\nnm: SETE MINUTOS DEPOIS DA MEIA-NOITE (A Monster Calls, 2016)\",\"data: 2015-10-19\nnota: 8.1\nnm: SICARIO - TERRA DE NINGU√âM (2015)\",\"data: 2017-01-31\nnota: 8.7\nnm: SIL√äNCIO (Silence, 2016)\",\"data: 2014-09-26\nnota: 6.9\nnm: SIN CITY - A DAMA FATAL (A Dame to Kill For, 2014)\",\"data: 2015-08-03\nnota: 8.2\nnm: SLOW WEST (2015)\",\"data: 2015-02-15\nnota: 7.2\nnm: SNIPER AMERICANO (American Sniper, 2014)\",\"data: 2016-11-12\nnota: 6.0\nnm: SNOWDEN - HER√ìI OU TRAIDOR (Snowden, 2016)\",\"data: 2014-05-19\nnota: 8.4\nnm: SOB A PELE (Under the Skin, 2014)\",\"data: 2016-01-07\nnota: 10.0\nnm: SPOTLIGHT (Segredos Revelados, 2015)\",\"data: 2016-09-01\nnota: 7.4\nnm: STAR TREK - SEM FRONTEIRAS (Star Trek Beyond, 2016)\",\"data: 2015-12-19\nnota: 9.1\nnm: STAR WARS - O DESPERTAR DA FOR√áA (2015)\",\"data: 2017-12-14\nnota: 9.2\nnm: STAR WARS - OS √öLTIMOS JEDI (2017)\",\"data: 2016-01-09\nnota: 8.5\nnm: STEVE JOBS (2015)\",\"data: 2015-02-20\nnota: 7.7\nnm: STILL ALICE (Para Sempre Alice, 2014)\",\"data: 2015-11-01\nnota: 7.5\nnm: STRAIGHT OUTTA COMPTON - A HIST√ìRIA DO N.W.A. (2015)\",\"data: 2016-11-28\nnota: 8.2\nnm: SULLY - O HER√ìI DO RIO HUDSON (Sully, 2016)\",\"data: 2016-10-05\nnota: 8.2\nnm: SWISS ARMY MAN (2016)\",\"data: 2017-03-22\nnota: 7.4\nnm: T2 TRAINSPOTTING (2017)\",\"data: 2017-10-21\nnota: 7.9\nnm: TERRA SELVAGEM (Wind River, 2017)\",\"data: 2015-05-28\nnota: 5.6\nnm: TERREMOTO - A FALHA DE SAN ANDREAS (2015)\",\"data: 2014-12-19\nnota: 8.3\nnm: THE BABADOOK (2014)\",\"data: 2013-08-04\nnota: 5.0\nnm: THE BLING RING (A Gangue de Hollywood, 2013)\",\"data: 2013-09-17\nnota: 8.1\nnm: THE CONJURING (Invoca√ß√£o do Mal, 2013)\",\"data: 2016-06-29\nnota: 5.6\nnm: THE FUNDAMENTALS OF CARING (2016)\",\"data: 2016-11-01\nnota: 10.0\nnm: THE HANDMAIDEN (Ah-ga-ssi, 2016)\",\"data: 2013-08-29\nnota: 5.0\nnm: THE INTERNSHIP (Os Estagi√°rios, 2013)\",\"data: 2016-04-12\nnota: 8.0\nnm: THE LOBSTER (2015)\",\"data: 2013-08-16\nnota: 4.0\nnm: The Mortal Instruments - City of Bones (2013)\",\"data: 2014-11-23\nnota: 7.4\nnm: THE ONE I LOVE (2014)\",\"data: 2018-01-20\nnota: 7.9\nnm: THE POST (2017)\",\"data: 2014-09-19\nnota: 7.2\nnm: THE ROVER - A CA√áADA (2014)\",\"data: 2018-01-08\nnota: 7.6\nnm: THE SQUARE (2017)\",\"data: 2013-07-24\nnota: 6.9\nnm: THE WOLVERINE (Wolverine - Imortal, 2013)\",\"data: 2013-11-12\nnota: 7.7\nnm: THE WORLDS END (Her√≥is de Ressaca, 2013)\",\"data: 2013-09-18\nnota: 7.1\nnm: THIS IS THE END (√â o Fim, 2013)\",\"data: 2013-11-06\nnota: 7.4\nnm: THOR - O MUNDO SOMBRIO (2013)\",\"data: 2017-10-26\nnota: 8.1\nnm: THOR - RAGNAROK (2017)\",\"data: 2018-01-30\nnota: 7.2\nnm: TODO O DINHEIRO DO MUNDO (All the Money in the World, 2017)\",\"data: 2015-06-04\nnota: 6.6\nnm: TOMORROWLAND (2015)\",\"data: 2015-03-17\nnota: 8.0\nnm: TOP FIVE (2014)\",\"data: 2014-03-19\nnota: 7.1\nnm: TOQUE DE MESTRE (Grand Piano, 2014)\",\"data: 2014-05-11\nnota: 4.2\nnm: TRANSCENDENCE - A REVOLU√á√ÉO (2014)\",\"data: 2014-07-14\nnota: 2.5\nnm: TRANSFORMERS - A ERA DA EXTIN√á√ÉO (2014)\",\"data: 2018-01-29\nnota: 9.9\nnm: TR√äS AN√öNCIOS PARA UM CRIME (Three Billboards Outside Ebbing, Missouri, 2017)\",\"data: 2016-02-21\nnota: 7.5\nnm: TRUMBO (Lista Negra, 2015)\",\"data: 2016-06-06\nnota: 5.6\nnm: TRUQUE DE MESTRE - O 2¬∫ ATO (Now You See Me 2, 2016)\",\"data: 2014-02-25\nnota: 7.1\nnm: TUDO POR UM FURO (2013)\",\"data: 2017-09-12\nnota: 9.2\nnm: UMA MULHER FANT√ÅSTICA (Una Mujer Fant√°stica, 2017)\",\"data: 2017-08-18\nnota: 8.1\nnm: UM CONTRATEMPO (Contratiempo, 2016)\",\"data: 2016-03-03\nnota: 6.4\nnm: UM HOMEM ENTRE GIGANTES (Concussion, 2015)\",\"data: 2014-06-11\nnota: 4.4\nnm: UM MILH√ÉO DE MANEIRAS DE PEGAR NA PISTOLA (2014)\",\"data: 2017-08-10\nnota: 5.0\nnm: VALERIAN E A CIDADE DOS MIL PLANETAS (2017)\",\"data: 2017-04-14\nnota: 6.4\nnm: VELOZES E FURIOSOS 8 (The Fate of the Furious, 2017)\",\"data: 2015-04-02\nnota: 6.4\nnm: VELOZES \u0026 FURIOSOS 7 (Furious 7, 2015)\",\"data: 2015-11-29\nnota: 4.4\nnm: VICTOR FRANKENSTEIN (2015)\",\"data: 2017-04-20\nnota: 7.2\nnm: VIDA (Life, 2017)\",\"data: 2015-04-23\nnota: 8.9\nnm: VINGADORES - ERA DE ULTRON (2015)\",\"data: 2018-01-03\nnota: 8.4\nnm: VIVA - A VIDA √â UMA FESTA (Coco, 2017)\",\"data: 2014-06-12\nnota: 7.1\nnm: VIZINHOS (Neighbors, 2014)\",\"data: 2017-12-05\nnota: 7.0\nnm: VOYEUR (Netflix, 2017)\",\"data: 2014-03-05\nnota: 8.0\nnm: WALT NOS BASTIDORES DE MARY POPPINS (2013)\",\"data: 2016-06-02\nnota: 6.4\nnm: WARCRAFT - O PRIMEIRO ENCONTRO DE DOIS MUNDOS (2016)\",\"data: 2013-09-26\nnota: 6.3\nnm: WERE THE MILLERS (Fam√≠lia do Bagulho, 2013)\",\"data: 2015-01-07\nnota: 9.5\nnm: WHIPLASH - EM BUSCA DA PERFEI√á√ÉO (2014)\",\"data: 2013-09-03\nnota: 5.3\nnm: WHITE HOUSE DOWN (O Ataque, 2013)\",\"data: 2013-06-26\nnota: 6.8\nnm: WORLD WAR Z (Guerra Mundial Z, 2013)\",\"data: 2016-05-18\nnota: 6.9\nnm: X-MEN - APOCALIPSE (2016)\",\"data: 2014-05-21\nnota: 6.9\nnm: X-MEN - DIAS DE UM FUTURO ESQUECIDO (2014)\",\"data: 2016-03-20\nnota: 8.9\nnm: ZOOTOPIA (2016)\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(0,0,0,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,0,0,1)\"}},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"x\":[15882,15903.253164557,15924.5063291139,15945.7594936709,15967.0126582278,15988.2658227848,16009.5189873418,16030.7721518987,16052.0253164557,16073.2784810127,16094.5316455696,16115.7848101266,16137.0379746835,16158.2911392405,16179.5443037975,16200.7974683544,16222.0506329114,16243.3037974684,16264.5569620253,16285.8101265823,16307.0632911392,16328.3164556962,16349.5696202532,16370.8227848101,16392.0759493671,16413.3291139241,16434.582278481,16455.835443038,16477.0886075949,16498.3417721519,16519.5949367089,16540.8481012658,16562.1012658228,16583.3544303797,16604.6075949367,16625.8607594937,16647.1139240506,16668.3670886076,16689.6202531646,16710.8734177215,16732.1265822785,16753.3797468354,16774.6329113924,16795.8860759494,16817.1392405063,16838.3924050633,16859.6455696203,16880.8987341772,16902.1518987342,16923.4050632911,16944.6582278481,16965.9113924051,16987.164556962,17008.417721519,17029.6708860759,17050.9240506329,17072.1772151899,17093.4303797468,17114.6835443038,17135.9367088608,17157.1898734177,17178.4430379747,17199.6962025316,17220.9493670886,17242.2025316456,17263.4556962025,17284.7088607595,17305.9620253165,17327.2151898734,17348.4683544304,17369.7215189873,17390.9746835443,17412.2278481013,17433.4810126582,17454.7341772152,17475.9873417722,17497.2405063291,17518.4936708861,17539.746835443,17561],\"y\":[6.78502595646802,6.7928853159743,6.80074467548059,6.80860403498688,6.81646339449317,6.82432275399946,6.83218211350575,6.84004147301203,6.84790083251832,6.85576019202461,6.8636195515309,6.87147891103719,6.87933827054347,6.88719763004976,6.89505698955605,6.90291634906234,6.91077570856863,6.91863506807492,6.9264944275812,6.93435378708749,6.94221314659378,6.95007250610007,6.95793186560636,6.96579122511265,6.97365058461893,6.98150994412522,6.98936930363151,6.9972286631378,7.00508802264409,7.01294738215037,7.02080674165666,7.02866610116295,7.03652546066924,7.04438482017553,7.05224417968181,7.0601035391881,7.06796289869439,7.07582225820068,7.08368161770697,7.09154097721326,7.09940033671954,7.10725969622583,7.11511905573212,7.12297841523841,7.1308377747447,7.13869713425099,7.14655649375727,7.15441585326356,7.16227521276985,7.17013457227614,7.17799393178242,7.18585329128871,7.193712650795,7.20157201030129,7.20943136980758,7.21729072931387,7.22515008882015,7.23300944832644,7.24086880783273,7.24872816733902,7.25658752684531,7.2644468863516,7.27230624585788,7.28016560536417,7.28802496487046,7.29588432437675,7.30374368388304,7.31160304338932,7.31946240289561,7.3273217624019,7.33518112190819,7.34304048141448,7.35089984092077,7.35875920042705,7.36661855993334,7.37447791943963,7.38233727894592,7.39019663845221,7.39805599795849,7.40591535746478],\"text\":[\"data: 15882.00\nnota: 6.785026\nnm: 1\",\"data: 15903.25\nnota: 6.792885\nnm: 1\",\"data: 15924.51\nnota: 6.800745\nnm: 1\",\"data: 15945.76\nnota: 6.808604\nnm: 1\",\"data: 15967.01\nnota: 6.816463\nnm: 1\",\"data: 15988.27\nnota: 6.824323\nnm: 1\",\"data: 16009.52\nnota: 6.832182\nnm: 1\",\"data: 16030.77\nnota: 6.840041\nnm: 1\",\"data: 16052.03\nnota: 6.847901\nnm: 1\",\"data: 16073.28\nnota: 6.855760\nnm: 1\",\"data: 16094.53\nnota: 6.863620\nnm: 1\",\"data: 16115.78\nnota: 6.871479\nnm: 1\",\"data: 16137.04\nnota: 6.879338\nnm: 1\",\"data: 16158.29\nnota: 6.887198\nnm: 1\",\"data: 16179.54\nnota: 6.895057\nnm: 1\",\"data: 16200.80\nnota: 6.902916\nnm: 1\",\"data: 16222.05\nnota: 6.910776\nnm: 1\",\"data: 16243.30\nnota: 6.918635\nnm: 1\",\"data: 16264.56\nnota: 6.926494\nnm: 1\",\"data: 16285.81\nnota: 6.934354\nnm: 1\",\"data: 16307.06\nnota: 6.942213\nnm: 1\",\"data: 16328.32\nnota: 6.950073\nnm: 1\",\"data: 16349.57\nnota: 6.957932\nnm: 1\",\"data: 16370.82\nnota: 6.965791\nnm: 1\",\"data: 16392.08\nnota: 6.973651\nnm: 1\",\"data: 16413.33\nnota: 6.981510\nnm: 1\",\"data: 16434.58\nnota: 6.989369\nnm: 1\",\"data: 16455.84\nnota: 6.997229\nnm: 1\",\"data: 16477.09\nnota: 7.005088\nnm: 1\",\"data: 16498.34\nnota: 7.012947\nnm: 1\",\"data: 16519.59\nnota: 7.020807\nnm: 1\",\"data: 16540.85\nnota: 7.028666\nnm: 1\",\"data: 16562.10\nnota: 7.036525\nnm: 1\",\"data: 16583.35\nnota: 7.044385\nnm: 1\",\"data: 16604.61\nnota: 7.052244\nnm: 1\",\"data: 16625.86\nnota: 7.060104\nnm: 1\",\"data: 16647.11\nnota: 7.067963\nnm: 1\",\"data: 16668.37\nnota: 7.075822\nnm: 1\",\"data: 16689.62\nnota: 7.083682\nnm: 1\",\"data: 16710.87\nnota: 7.091541\nnm: 1\",\"data: 16732.13\nnota: 7.099400\nnm: 1\",\"data: 16753.38\nnota: 7.107260\nnm: 1\",\"data: 16774.63\nnota: 7.115119\nnm: 1\",\"data: 16795.89\nnota: 7.122978\nnm: 1\",\"data: 16817.14\nnota: 7.130838\nnm: 1\",\"data: 16838.39\nnota: 7.138697\nnm: 1\",\"data: 16859.65\nnota: 7.146556\nnm: 1\",\"data: 16880.90\nnota: 7.154416\nnm: 1\",\"data: 16902.15\nnota: 7.162275\nnm: 1\",\"data: 16923.41\nnota: 7.170135\nnm: 1\",\"data: 16944.66\nnota: 7.177994\nnm: 1\",\"data: 16965.91\nnota: 7.185853\nnm: 1\",\"data: 16987.16\nnota: 7.193713\nnm: 1\",\"data: 17008.42\nnota: 7.201572\nnm: 1\",\"data: 17029.67\nnota: 7.209431\nnm: 1\",\"data: 17050.92\nnota: 7.217291\nnm: 1\",\"data: 17072.18\nnota: 7.225150\nnm: 1\",\"data: 17093.43\nnota: 7.233009\nnm: 1\",\"data: 17114.68\nnota: 7.240869\nnm: 1\",\"data: 17135.94\nnota: 7.248728\nnm: 1\",\"data: 17157.19\nnota: 7.256588\nnm: 1\",\"data: 17178.44\nnota: 7.264447\nnm: 1\",\"data: 17199.70\nnota: 7.272306\nnm: 1\",\"data: 17220.95\nnota: 7.280166\nnm: 1\",\"data: 17242.20\nnota: 7.288025\nnm: 1\",\"data: 17263.46\nnota: 7.295884\nnm: 1\",\"data: 17284.71\nnota: 7.303744\nnm: 1\",\"data: 17305.96\nnota: 7.311603\nnm: 1\",\"data: 17327.22\nnota: 7.319462\nnm: 1\",\"data: 17348.47\nnota: 7.327322\nnm: 1\",\"data: 17369.72\nnota: 7.335181\nnm: 1\",\"data: 17390.97\nnota: 7.343040\nnm: 1\",\"data: 17412.23\nnota: 7.350900\nnm: 1\",\"data: 17433.48\nnota: 7.358759\nnm: 1\",\"data: 17454.73\nnota: 7.366619\nnm: 1\",\"data: 17475.99\nnota: 7.374478\nnm: 1\",\"data: 17497.24\nnota: 7.382337\nnm: 1\",\"data: 17518.49\nnota: 7.390197\nnm: 1\",\"data: 17539.75\nnota: 7.398056\nnm: 1\",\"data: 17561.00\nnota: 7.405915\nnm: 1\"],\"type\":\"scatter\",\"mode\":\"lines\",\"name\":\"fitted values\",\"line\":{\"width\":3.77952755905512,\"color\":\"rgba(51,102,255,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":33.0029057700291,\"r\":10.6268161062682,\"b\":60.5728518057285,\"l\":71.1996679119967},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":21.2536322125363},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[15798.05,17644.95],\"tickmode\":\"array\",\"ticktext\":[\"2014\",\"2015\",\"2016\",\"2017\",\"2018\"],\"tickvals\":[16071,16436,16801,17167,17532],\"categoryorder\":\"array\",\"categoryarray\":[\"2014\",\"2015\",\"2016\",\"2017\",\"2018\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":5.31340805313408,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":17.0029057700291},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.966074191478924,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"data\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":21.2536322125363}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-0.5,10.5],\"tickmode\":\"array\",\"ticktext\":[\"0.0\",\"2.5\",\"5.0\",\"7.5\",\"10.0\"],\"tickvals\":[0,2.5,5,7.5,10],\"categoryorder\":\"array\",\"categoryarray\":[\"0.0\",\"2.5\",\"5.0\",\"7.5\",\"10.0\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":5.31340805313408,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":17.0029057700291},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.966074191478924,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"nota\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":21.2536322125363}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.0029057700291}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"447a5573207a\":{\"x\":{},\"y\":{},\"type\":\"scatter\"},\"447a79595569\":{\"x\":{},\"y\":{}}},\"cur_data\":\"447a5573207a\",\"visdat\":{\"447a5573207a\":[\"function (y) \",\"x\"],\"447a79595569\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\rParece que a nota m√©dia do Tiago Belotti subiu um pouquinho ao longo dos anos, mas nada muito significativo. Ou seja, minha hip√≥tese de que o Tiago Belotti ficou mais bonzinho n√£o se verifica. Ele √© super consistente!\nOutras investiga√ß√µes que eu gostaria de fazer:\nQual a rela√ß√£o das notas do Tiago com o Rotten Tomatoes ou o IMDb?\rSer√° que √© poss√≠vel prever a nota do Tiago com base em outras notas e caracter√≠sticas do filme?\rO Tiago avalia diferente filmes de g√™neros diferentes?\r\rPara essas investiga√ß√µes, seria necess√°rio cruzar essa base com a base do Rotten Tomatoes e do IMDb. Quem sabe num pr√≥ximo post!\n√â isso pessoal. Um abra√ßo, e at√© a pr√≥xima.\n\rAgradecimentos\rSillas pelas ideias de visualiza√ß√£o, que acabei n√£o postando. E tamb√©m para os amigos que brincaram comigo na datathon sobre isso: Bruna Wunderwald, Luciana Keiko, William, Caio Lente, Guilherme e quem mais eu tiver esquecido.\n\rCursos R b√°sico e Web Scraping\rN√£o perca a oportunidade de se inscrever nos nossos cursos!\n\rWeb Scraping - 10 de mar√ßo de 2018\rR b√°sico - 17 e 24 de mar√ßo de 2018\r\r\r\r","permalink":"https://blog.curso-r.com/posts/2018-02-21-2cents/","tags":["sf","tidyverse"],"title":"Meus 2 Centavos: an√°lise das notas"},{"author":["Caio"],"categories":["conceitos"],"contents":"\r\rWeb scraping (ou raspagem web) n√£o √© nada mais que o ato de coletar dados da\rinternet. Hoje em dia √© muito comum termos acesso r√°pido e f√°cil a qualquer\rconjunto de informa√ß√µes pela web, mas raramente esses dados est√£o estruturados\re em uma forma de f√°cil obten√ß√£o pelo usu√°rio.\nIsso faz com que precisemos aprender a coletar esses dados por conta pr√≥pria.\rNeste post vou descrever o fluxo do web scraping, um passo a passo para\rexplicar aos iniciantes como funciona a cria√ß√£o de um raspador.\nO fluxo\rCaso voc√™ j√° tenha visto o\rfluxo da ci√™ncia de dados\rdescrito por Hadley Wickham, o fluxo do web scraping vai ser bastante simples\rde entender. Todos os itens a seguir v√£o se basear neste diagrama:\nCada verbo indica um fase do processo de raspar dados da internet. A caixa\razulada no meio do diagrama denominada reprodu√ß√£o indica um procedimento\riterativo que devemos repetir at√© que a coleta funcione, mas, de resto, o fluxo\r√© um processo linear.\nNas pr√≥ximas se√ß√µes, vamos explorar um exemplo bem simples para entender como\resses passos se dariam no mundo real: extrair os t√≠tulos de artigos da Wikip√©dia.\nIdentificar\rO primeiro passo do fluxo se chama identificar porque nele identificamos\ra informa√ß√£o que vamos coletar. Aqui precisamos entender bem qual √© a estrutura\rdas p√°ginas que queremos raspar e tra√ßar um plano para extrair tudo que\rprecisamos.\nNo nosso exemplo, precisar√≠amos entrar em algumas p√°ginas da Wikip√©dia para\rentender se os t√≠tulos se comportam da mesma forma em todas. Como a Wikip√©dia\r√© um site organizado, todos os t√≠tulos s√£o criados da mesma forma em\rabsolutamente todos os artigos.\n\rNavegar\rAgora precisamos entender de onde vem o dado que queremos extrair. Esse passo\rpode ser extremamente simples, mas de vez em quando ele se tornara algo\rbastante complexo.\nUsando as ferramentas de desenvolvedor do nosso navegador, vamos navegar\rpara encontrar a fonte dos dados. Sem entrar em muitos detalhes, poder√≠amos\ranalisar o networking do navegador para entender as chamadas HTTP que s√£o\rfeitas, poder√≠amos estudar os resultados das fun√ß√µes JavaScript invocadas\rpela p√°gina e assim por diante.\nNo nosso caso, como escolhi um exemplo simples, precisamos apenas inspecionar\ro elemento do t√≠tulo e ver qual √© o seu\rXPath (basicamente o endere√ßo do elemento\rno HTML da p√°gina): //*[@id=\"firstHeading\"].\n\rReplicar\rSe tiv√©ssemos que fazer v√°rias requests HTTP para chegar at√© a informa√ß√£o que\rqueremos, seria aqui em que tentar√≠amos replicar essas chamadas. Neste\rpasso √© importante compreender absolutamente tudo que a p√°gina est√° fazendo\rpara trazer o conte√∫do at√© voc√™, ent√£o √© necess√°rio analisar o seu networking\ra fim de entender tais requests e seus respectivos queries.\nNo nosso caso, basta fazer uma chamada GET para obter a p√°gina do artigo\rdesejado. Tamb√©m se faz necess√°rio salvar a p√°gina localmente para que\rpossamos dar continuidade ao fluxo.\nurl \u0026lt;- \u0026quot;https://en.wikipedia.org/wiki/R_(programming_language)\u0026quot;\rhttr::GET(url, httr::write_disk(\u0026quot;~/Desktop/wiki.html\u0026quot;))\r\rParsear\rO anglicismo parsear vem do verbo to parse, que quer dizer algo como\ranalisar ou estudar, mas que, no contexto do web scraping, significa extrair\ros dados desejados de um arquivo HTML.\nAqui vamos usar a informa√ß√£o obtida no passo 2 para retirar do arquivo que\rchamei de wiki.html o t√≠tulo do artigo.\n\u0026quot;~/Desktop/wiki.html\u0026quot; %\u0026gt;%\rxml2::read_html() %\u0026gt;%\rrvest::html_node(xpath = \u0026quot;//*[@id=\u0026#39;firstHeading\u0026#39;]\u0026quot;) %\u0026gt;%\rrvest::html_text()\r#\u0026gt; [1] \u0026quot;R (programming language)\u0026quot;\r\rValidar\rSe tivermos feito tudo certo at√© agora, validar os resultados ser√° uma\rtarefa simples. Precisamos apenas reproduzir o procedimento descrito at√©\ragora para algumas outras p√°ginas de modo verificar se estamos de fato\rextraindo corretamente tudo o que queremos.\nCaso encontremos algo de errado precisamos voltar ao passo 3, tentar replicar\rcorretamente o comportamento do site e parsear os dados certos nas p√°ginas.\n\rIterar\rO √∫ltimo passo consiste em colocar o nosso scraper em produ√ß√£o. Aqui, ele j√°\rdeve estar funcionando corretamente para todos os casos desejados e estar\rpronto para raspar todos os dados dos quais precisamos.\nNa maior parte dos casos isso consiste em encapsular o scraper em uma fun√ß√£o\rque recebe uma s√©rie de links e aplica o mesmo procedimento em cada um. Se\rquisermos aumentar a efici√™ncia desse processo, podemos\rparalelizar ou distribuir\ro nosso raspador.\nscraper \u0026lt;- function(url, path) {\rhttr::GET(url, httr::write_disk(path))\rpath %\u0026gt;%\rxml2::read_html() %\u0026gt;%\rrvest::html_node(xpath = \u0026quot;//*[@id=\u0026#39;firstHeading\u0026#39;]\u0026quot;) %\u0026gt;%\rrvest::html_text()\r}\rpurrr::map2_chr(links, paths, scraper)\r\r\rConclus√£o\rFazer um scraper n√£o √© uma tarefa f√°cil, mas, se toda vez seguirmos um\rm√©todo consistente e robusto, podemos melhorar um pouco o nosso trabalho.\rO fluxo do web scraping tenta ser este m√©todo, englobando em passos simples\re razoavelmente bem definidos essa arte que √© fazer raspadores web.\n\r","permalink":"https://blog.curso-r.com/posts/2018-02-18-fluxo-scraping/","tags":["web-scraping"],"title":"O Fluxo do Web Scraping"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rCaso voc√™ j√° tenha se aventurado no mundo do web scraping, √© prov√°vel que\rtenha se deparado com um grande problema: volume. Muitas vezes, antes fazer uma\ran√°lise, precisamos scrapear um n√∫mero colossal de p√°ginas at√© que tenhamos\rdados o suficiente para a nossa tarefa, n√∫mero esse que chega a ser proibitivo\ra ponto de n√£o conseguirmos fazer aquilo que queremos.\nNeste post vou explicar duas t√©cnicas para aumentar em dezenas de vezes a\rvelocidade dos seus scrapers de forma que voc√™ nunca mais precise de preocupar\rcom a quantidade de dados necess√°ria para uma an√°lise.\nScrapers sequenciais\rUm scraper sequencial √© qualquer scraper que baixe uma p√°gina por vez, ou seja,\rque varra as p√°ginas em sequ√™ncia baixando uma a uma. Como veremos na se√ß√£o a\rseguir isso n√£o √© muito eficiente, mas √© mesmo assim o que a maioria de n√≥s faz.\nNota: Nos exemplos que darei daqui em diante estarei baixando uma lista de\r1441 artigos da Wikip√©dia obtida com o pacote WikipediR. Se voc√™ quiser\rreproduzir os meus achados, disponibilizei um arquivo com o c√≥digo completo em\rum Gist\nVeja mais ou menos como funcionaria para baixar um link da Wikip√©dia por vez:\n# Fun√ß√£o para baixar uma p√°gina da Wikip√©dia\rdownload_wiki \u0026lt;- function(url, path) {\r# Converter um URL em um nome de arquivo\rfile \u0026lt;- url %\u0026gt;%\rutils::URLdecode() %\u0026gt;%\rstringr::str_extract(\u0026quot;(?\u0026lt;=/)[^/]+$\u0026quot;) %\u0026gt;%\rstringr::str_replace_all(\u0026quot;[:punct:]\u0026quot;, \u0026quot;\u0026quot;) %\u0026gt;%\rstringr::str_to_lower() %\u0026gt;%\rstringr::str_c(normalizePath(path), \u0026quot;/\u0026quot;, ., \u0026quot;.html\u0026quot;)\r# Salvar a p√°gina no disco\rhttr::GET(url, httr::write_disk(file, TRUE))\rreturn(file)\r}\r# Baixar arquivos sequencialmente\rfiles \u0026lt;- purrr::map_chr(links, download_wiki, \u0026quot;~/Desktop/Wiki\u0026quot;)\rNada muito complexo at√© a√≠. Com a purrr::map_chr() itero com facilidade nos\rlinks e os baixo sequencialmente (se voc√™ quiser saber mais sobre a fun√ß√£o\rmap() veja este post). O c√≥digo acima\rdemorou mais ou menos 5 minutos para executar na minha m√°quina.\n\rScrapers em paralelo\rUma das formas mais simples de aumentar a efici√™ncia de um web scraper √© atrav√©s\rde paraleliza√ß√£o. Um fato que nem todos sabem √© que praticamente qualquer scraper\rpassa a maior parte do tempo esperando respostas do servidor; seja para carregar\ruma nova p√°gina ou seja para baixar a p√°gina em quest√£o, ficar esperando √© o que\ro seu scraper provavelmente mais faz.\nIsso quer dizer que seu computador poderia ter, em qualquer dado momento, m√∫ltiplos\rscrapers rodando simultaneamente sem perder efici√™ncia! Enquanto o processador est√°\rsalvando no disco os resultados de um scraper, √© perfeitamente poss√≠vel ter muitos\routros ativos e esperando uma resposta do servidor.\nNo exemplo de c√≥digo abaixo uso uma fun√ß√£o muito simples para paralelizar a\rexecu√ß√£o do scraper. parallel::mcmapply() (multicore mapply()) √© an√°loga a\rmap(), com a diferen√ßa de que ela instancia as chamadas para a fun√ß√£o\rdownload_wiki() em m√∫ltiplos threads de execu√ß√£o, tirando vantagem do fato\rde que cada inst√¢ncia fica parada a maior parte do tempo.\n# Criar uma vers√£o empacotada de download_wiki()\rdownload_wiki_ \u0026lt;- purrr::partial(\rdownload_wiki, path = \u0026quot;~/Desktop/Wiki\u0026quot;, .first = FALSE)\r# Baixar arquivos em paralelo\rfiles \u0026lt;- parallel::mcmapply(\rdownload_wiki_, links, SIMPLIFY = TRUE, mc.cores = 4)\rNo c√≥digo acima, crio uma vers√£o pr√©-preenchida de download_wiki() para n√£o\rprecisar lidar com argumentos constantes na chamada para parallel::mcmapply(),\rmas depois disso a √∫nica coisa que preciso fazer √© especificar o n√∫mero de\rcores dispon√≠veis no meu computador para que o pacote parallel fa√ßa a sua\rmagia. Desta forma, com uma chamada marginalmente mais complexa, consegui\rbaixar os mesmos arquivos em meros 1.2 minutos.\n\rScrapers distribu√≠dos\rPara o nosso grand finale temos um pequeno salto de dificuldade. Agora que\rsomos capazes de usar todo o potencial do nosso computador, a √∫nica forma de\rfazer scraping mais r√°pido √© usando mais computadores.\nIsso parece loucura, mas usando m√°quinas virtuais da\rAmazon ou da\rGoogle essa √© na verdade uma tarefa\rbastante simples! Podemos criar algumas inst√¢ncias virtuais e enviar os\rlinks para que elas os baixem, distribuindo o download entre v√°rias\rm√°quinas.\nPara permitir que uma m√°quina virtual receba o comando de download, criei\rum pequeno servidor HTTP em cada uma, assim elas ficar√£o esperando por\ruma chamada POST contendo os URLs a serem baixados.\n# Trecho do c√≥digo em python do servidor que lida com POSTs\rdef do_POST(self):\rcontent_length = int(self.headers[\u0026#39;Content-Length\u0026#39;])\rpost_data = self.rfile.read(content_length)\rcall([\u0026quot;Rscript\u0026quot;, \u0026quot;~/script.R\u0026quot;, post_data])\rComo pode-se ver no c√≥digo acima, a √∫nica coisa que o servidor faz √©\rcoletar os dados enviados pelo post e redirecion√°-los para o script\rscript.R. L√° o R coleta os links vindos de post_data e os baixa\r(usando, √© claro, parallel::mcmapply).\n#!/usr/bin/env Rscript\rargs = commandArgs(trailingOnly=TRUE)\r# Tratar o pacote de dados enviado no POST\rlinks \u0026lt;- stringr::str_split(args[1], \u0026quot; \u0026quot;)[[1]]\rAcima temos a √∫nica diferen√ßa no c√≥digo em R (que agora se encontra nas m√°quinas\rvirtuais): o tratamento necess√°rio em script.R dos dados trazidos pela chamada\rPOST.\nO √∫ltimo passo √©, em nossa m√°quina local, quebrar a lista de links em um pacote\rpara cada m√°quina serva; assim que as m√°quinas receberem esses links via HTTP\relas come√ßar√£o, distribuidamente, a baix√°-los em paralelo.\n# Quebrar os links de acordo com o n√∫mero de servos\rnum_workers \u0026lt;- 3\rlinks_split \u0026lt;- links %\u0026gt;%\rsplit(., ceiling(seq_along(.)/(length(.)/num_workers))) %\u0026gt;%\rpurrr::map(stringr::str_c, collapse = \u0026quot; \u0026quot;)\r# Dados do endpoint\rworkers \u0026lt;- \u0026quot;localhost\u0026quot; # AQUI V√ÉO OS IPS DOS SERVOS\rendpoints \u0026lt;- stringr::str_c(\u0026quot;http://\u0026quot;, workers, \u0026quot;:8000\u0026quot;)\r# Chamar todos os servos mas n√£o esperar por eles\rfor (i in seq_len(num_workers)) {\rcommand \u0026lt;- paste0(\u0026quot;curl -d \u0026#39;\u0026quot;, links_split[[i]], \u0026quot;\u0026#39; \u0026quot;, endpoints[i])\rsystem(command, wait = FALSE)\r}\rUsando 3 m√°quinas virtuais de 4 cores cada no Google Cloud Platform, o download\rdas 1400 p√°ginas demorou meros 34 segundos. Isso √© uma melhora de aproximadamente\r10 vezes na performance em rela√ß√£o √† execu√ß√£o sequencial!\n\rConclus√£o\rComo vimos nos exemplos acima, scrapers s√£o por padr√£o processos lentos e\rineficientes. Usando uma arquitetura razoavelmente simples distribu√≠da e paralela\rpodemos aumentar em at√© uma ordem de grandeza a efici√™ncia de um scraper sem nem\rpensar sobre o seu c√≥digo! Na pr√°tica, podemos aumentar e diminuir o quanto\rquisermos o n√∫mero de servos ou de cores em cada servo, permitindo que qualquer\rscraper possa virar uma m√°quina incr√≠vel de coleta de dados.\nCaso voc√™ tenha se interessado pelo conte√∫do abordado nesse post, eu e o pessoal\rda Curso-R vamos dar no dia 10/03/2018 um workshop\rem S√£o Paulos sobre web scraping com R.\rL√° voc√™ vai ter a oportunidade de aprender, do zero, como fazer bons web scrapers\rem R al√©m de muitas dicas como a desse post para tornar seus scrapers ainda melhores.\n\r","permalink":"https://blog.curso-r.com/posts/2018-02-17-scraper-distribuido/","tags":["web-scraping"],"title":"Web Scraper Distribu√≠do"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rEu precisava escrever esse post porque estou morrendo de tes√£o por essa linguagem maravilhosa. O R √© incr√≠vel. O tidyverse √© incr√≠vel. Estat√≠stica √© incr√≠vel. N√£o me aguento!!\nHoje mais uma vez fui salvo por uma feature pensada no universo tidy. Dessa vez, o grande her√≥i foi o pacote sf, um pacote ainda em est√°gio de desenvolvimento, mas que j√° considero pacas.\nO sf, a.k.a. Simple Features, √© um pacote para trabalhar com mapas. Com ele √© poss√≠vel fazer proje√ß√µes, gr√°ficos, leitura/grava√ß√£o de diversos formatos de mapas, entre muitas outras coisas. Esse √© um dos pacotes patrocinados pelo R Consortium, uma iniciativa criada por v√°rias empresas e pela R Foundation para injetar dinheiro em projetos de R que tenham alta relev√¢ncia.\nO pacote sf √© t√£o sensacional que merece um post s√≥ para ele. Hoje, eu falarei de apenas de uma de suas vantagens, que √© sua integra√ß√£o perfeita com o tidyverse.\nContexto\rEu fa√ßo parte da Associa√ß√£o Brasileira de Jurimetria (ABJ), uma entidade sem fins lucrativos que faz pesquisa aplicada na √°rea do Direito. Na ABJ produzimos diversas solu√ß√µes tecnol√≥gicas para problemas do Direito, especialmente em quest√µes relacionadas √† elabora√ß√£o de pol√≠ticas p√∫blicas e administra√ß√£o dos tribunais.\nNum projeto recente, eu precisava levantar uma tabela de munic√≠pios, comarcas, circunscri√ß√µes e regi√µes administrativas do Tribunal de Justi√ßa de S√£o Paulo. Minha tarefa era visualizar essas informa√ß√µes em mapas. Fazendo curta uma hist√≥ria longa, podemos dizer que:\n\ruma comarca √© o conjunto de um ou mais munic√≠pios cont√≠guos\r\r(cont√≠guos = munic√≠pios que se tocam);\r\ruma circunscri√ß√£o √© um conjunto de uma ou mais comarcas cont√≠guas;\re uma regi√£o √©‚Ä¶ adivinha?\r\rNo Estado de S√£o Paulo, temos no total:\n\r645 munic√≠pios\r319 comarcas\r57 circunscri√ß√µes\r10 regi√µes administrativas\r\rO problema √© que n√£o existe uma base de dados p√∫blica que relacione todos os 645 munic√≠pios com as respectivas regi√µes que as cont√™m. Ent√£o partimos para a obten√ß√£o via robizinhos.\n\rP.S.: N√£o se esque√ßa do ciclo da ci√™ncia de dados! Vou falar disso sem parar para explicar. Na d√∫vida, leia o http://r4ds.had.co.nz/\n\r\nAs partes de import e tidy desse projeto processo foram sofr√≠veis. Precisei fazer v√°rios web scrapers e diversos c√≥digos para lidar com nomes zoados dos munic√≠pios de S√£o Paulo, como Moji/Mogi, Estrela D‚ÄôOeste/Doeste, Brodowski/Brodosqui etc. Quem quiser pode dar uma olhada nos c√≥digos do github da ABJ.\n\rO problema\rAp√≥s passar o dia todo pegando esses dados, finalmente cheguei na parte de transform e visualize. Nossos objetivos nessa parte s√£o:\nCarregar um mapa dos munic√≠pios de S√£o Paulo no R.\rAgrupar as formas dos munic√≠pios em comarcas, circunscri√ß√µes e regi√µes.\rFazer mapas dos resultados obtidos.\r\rEm experi√™ncias anteriores j√° passei por maus bocados tentando completar a parte (2). Antigamente, a √∫nica fun√ß√£o conhecida que fazia a uni√£o de pol√≠gonos era a maptools::unionSpatialPolygons(), que √© contraintuitiva, mal documentada e dif√≠cil de usar na pr√°tica. Na verdade, tudo era dif√≠cil: desde ler o arquivo .shp baixado da internet at√© a parte de fazer o gr√°fico. Era R raiz mesmo. Mas hoje, para a felicidade de todos, temos a solu√ß√£o nutella ;)\n\rCuriosamente, o Edzer Pebesma, autor do sf, tamb√©m √© contributor do maptools e mantenedor do sp, os pacotes mais importantes de an√°lise espacial pr√©-tidyverse. Ou seja, ele n√£o s√≥ manja do assunto como sabia que os pacotes dele precisavam melhorar. E, olha, ele mandou bem dessa vez.\n\r\rSolu√ß√£o\rVamos utilizar o tidyverse e o pacote sf. Para instalar o tidyverse, rode\ninstall.packages(\u0026quot;tidyverse\u0026quot;)\r\rPara quem n√£o sabe: o tidyverse √© um pacote que instala muitos outros pacotes por tr√°s, como httr, ggplot2 e dplyr. Isso significa que pode demorar bastante tempo para instalar!\n\rA instala√ß√£o do sf pode ser um tanto trabalhosa. Se voc√™ usa Windows, basta instalar o Rtools e depois rodar\ninstall.packages(\u0026quot;sf\u0026quot;)\rSe voc√™ usa Mac ou Linux, recomendo ler a primeira p√°gina da documenta√ß√£o oficial do pacote. L√° voc√™ pode checar todos os requerimentos do pacote em detalhe. Eu recomendo que voc√™ instale logo a vers√£o de desenvolvimento:\ndevtools::install_github(\u0026quot;r-spatial/sf\u0026quot;)\rPara rodar as fun√ß√µes gr√°ficas, tamb√©m recomendo que voc√™ instale a vers√£o de desenvolvimento do ggplot2, rodando\ndevtools::install_github(\u0026quot;tidyverse/ggplot2\u0026quot;)\rOutros pacotes que usaremos no meio do c√≥digo s√£o\ndevtools::install_github(\u0026quot;abjur/abjutils\u0026quot;) # principalmente para remover acentos\rinstalled.packages(\u0026quot;janitor\u0026quot;) # para arrumar nomes das colunas da base de dados\rParte 1: baixando os dados\rPrimeiro, vamos baixar da internet! Obviamente, o melhor lugar para baixar esses arquivos √© no FTP do Instituto Brasileiro de Geografia e Estat√≠stica.\n# Cria uma pasta onde os arquivos ser√£o salvos\rdir.create(\u0026quot;shp\u0026quot;, showWarnings = FALSE)\r# URL de download\ru_ibge \u0026lt;- paste0(\r\u0026quot;ftp://geoftp.ibge.gov.br/organizacao_do_territorio/\u0026quot;,\r\u0026quot;malhas_territoriais/malhas_municipais/\u0026quot;,\r\u0026quot;municipio_2015/UFs/SP/sp_municipios.zip\u0026quot;,\rcollapse = \u0026quot;\u0026quot;)\rUtilizamos o pacote httr para baixar o arquivo zipado.\n# Salva o arquivo em disco. httr::progress()\r# serve para mostrar o andamento do download\rhttr::GET(u_ibge,\rhttr::write_disk(\u0026quot;shp/sp.zip\u0026quot;),\rhttr::progress())\r\rE usamos unzip() para dezipar os dados.\n# dezipa os arquivoe\runzip(\u0026quot;shp/sp.zip\u0026quot;, exdir = \u0026quot;shp/\u0026quot;)\rNo final, voc√™ ter√° esses arquivos na pasta:\ndir(\u0026quot;shp\u0026quot;)\r# \u0026quot;35MUE250GC_SIR.cpg\u0026quot;\r# \u0026quot;35MUE250GC_SIR.dbf\u0026quot;\r# \u0026quot;35MUE250GC_SIR.prj\u0026quot;\r# \u0026quot;35MUE250GC_SIR.shp\u0026quot;\r# \u0026quot;35MUE250GC_SIR.shx\u0026quot;\r# \u0026quot;sp.zip\u0026quot;\rPara ler esses arquivos estranhos num objeto do R, utilizamos a fun√ß√£o sf::st_read(), simples assim:\nlibrary(tidyverse)\rd_sf_municipio \u0026lt;- sf::st_read(\u0026quot;shp/35MUE250GC_SIR.shp\u0026quot;, quiet = TRUE)\rdplyr::glimpse(d_sf_municipio)\r# Observations: 645\r# Variables: 3\r# $ NM_MUNICIP \u0026lt;fctr\u0026gt; CAIU√Å, CASTILHO, DRACENA, ESTRELA DO NORTE, EUCLIDES D...\r# $ CD_GEOCMU \u0026lt;fctr\u0026gt; 3509106, 3511003, 3514403, 3515301, 3515350, 3528700, ...\r# $ geometry \u0026lt;simple_feature\u0026gt; MULTIPOLYGON (((-51.8600105..., MULTIPOLYGON...\rObserve que temos tr√™s colunas na base de dados, nome do munic√≠pio, c√≥digo do munic√≠pio e geometry. Essa terceira √© do tipo simple_feature e carrega objetos do tipo MULTIPOLYGON. Ou seja, um objeto lido pelo sf nada mais √© do que um data.frame que tem uma coluna especial, capaz de guardar objetos mais complexos, como pol√≠gonos.\n\rChamamos esse tipo de coluna especial de list-column. Quem faz nossos cursos avan√ßados acaba aprendendo esses conceitos a partir do aninhamento de objetos e utiliza√ß√£o de algoritmos mais complexos usando o pacote purrr.\n\rAgora, queremos juntar essa base com nossos dados de comarcas, circunscri√ß√µes e regi√µes.\nmuni_comarcas_completo \u0026lt;- readRDS(\u0026quot;muni_comarcas_completo.rds\u0026quot;)\rdplyr::glimpse(muni_comarcas_completo)\r# Observations: 645\r# Variables: 9\r# $ cod_municipio \u0026lt;int\u0026gt; 6504, 6829, 6506, 6508, 6808, 6511, 6915, 6515...\r# $ comarca \u0026lt;chr\u0026gt; \u0026quot;ADAMANTINA\u0026quot;, \u0026quot;ADAMANTINA\u0026quot;, \u0026quot;AGUAI\u0026quot;, \u0026quot;AGUAS DE...\r# $ municipio \u0026lt;chr\u0026gt; \u0026quot;ADAMANTINA\u0026quot;, \u0026quot;MARIAPOLIS\u0026quot;, \u0026quot;AGUAI\u0026quot;, \u0026quot;AGUAS DE...\r# $ tipo \u0026lt;chr\u0026gt; \u0026quot;comarca\u0026quot;, \u0026quot;municipio\u0026quot;, \u0026quot;comarca\u0026quot;, \u0026quot;comarca\u0026quot;, ...\r# $ circunscricao \u0026lt;chr\u0026gt; \u0026quot;Tup√£\u0026quot;, \u0026quot;Tup√£\u0026quot;, \u0026quot;S√£o Jo√£o da Boa Vista\u0026quot;, \u0026quot;Ampa...\r# $ entrancia \u0026lt;chr\u0026gt; \u0026quot;Entr√¢ncia Inicial\u0026quot;, \u0026quot;Entr√¢ncia Inicial\u0026quot;, \u0026quot;Ent...\r# $ num_circunscricao \u0026lt;chr\u0026gt; \u0026quot;30¬™ CJ\u0026quot;, \u0026quot;30¬™ CJ\u0026quot;, \u0026quot;50¬™ CJ\u0026quot;, \u0026quot;54¬™ CJ\u0026quot;, \u0026quot;54¬™ C...\r# $ num_regiao \u0026lt;chr\u0026gt; \u0026quot;5¬™ RAJ\u0026quot;, \u0026quot;5¬™ RAJ\u0026quot;, \u0026quot;4¬™ RAJ\u0026quot;, \u0026quot;4¬™ RAJ\u0026quot;, \u0026quot;4¬™ RA...\r# $ regiao \u0026lt;chr\u0026gt; \u0026quot;Presidente Prudente\u0026quot;, \u0026quot;Presidente Prudente\u0026quot;, ...\rPara isso, vamos primeiro arrumar os nomes de d_sf_municipio e depois usar dplyr::inner_join(), assim:\nd_sf_municipio \u0026lt;- d_sf_municipio %\u0026gt;%\r# deixa os nomes das colunas minusculos\rjanitor::clean_names() %\u0026gt;%\r# tira os acentos\rdplyr::mutate(municipio = abjutils::rm_accent(nm_municip)) %\u0026gt;%\r# bases unidas jamais ser√£o vencidas!\rdplyr::inner_join(muni_comarcas_completo, \u0026quot;municipio\u0026quot;)\rdplyr::glimpse(d_sf_municipio)\r# Observations: 645\r# Variables: 12\r# $ nm_municip \u0026lt;fctr\u0026gt; CAIU√Å, CASTILHO, DRACENA, ESTRELA DO NORTE, E...\r# $ cd_geocmu \u0026lt;fctr\u0026gt; 3509106, 3511003, 3514403, 3515301, 3515350, ...\r# $ municipio \u0026lt;chr\u0026gt; \u0026quot;CAIUA\u0026quot;, \u0026quot;CASTILHO\u0026quot;, \u0026quot;DRACENA\u0026quot;, \u0026quot;ESTRELA DO NO...\r# $ cod_municipio \u0026lt;int\u0026gt; 6606, 6629, 6663, 6678, 6679, 6826, 6843, 6857...\r# $ comarca \u0026lt;chr\u0026gt; \u0026quot;PRESIDENTE EPITACIO\u0026quot;, \u0026quot;ANDRADINA\u0026quot;, \u0026quot;DRACENA\u0026quot;,...\r# $ tipo \u0026lt;chr\u0026gt; \u0026quot;municipio\u0026quot;, \u0026quot;municipio\u0026quot;, \u0026quot;comarca\u0026quot;, \u0026quot;municipi...\r# $ circunscricao \u0026lt;chr\u0026gt; \u0026quot;Presidente Venceslau\u0026quot;, \u0026quot;Andradina\u0026quot;, \u0026quot;Dracena\u0026quot;...\r# $ entrancia \u0026lt;chr\u0026gt; \u0026quot;Entr√¢ncia Inicial\u0026quot;, \u0026quot;Entr√¢ncia Final\u0026quot;, \u0026quot;Entr√¢...\r# $ num_circunscricao \u0026lt;chr\u0026gt; \u0026quot;28¬™ CJ\u0026quot;, \u0026quot;37¬™ CJ\u0026quot;, \u0026quot;29¬™ CJ\u0026quot;, \u0026quot;27¬™ CJ\u0026quot;, \u0026quot;28¬™ C...\r# $ num_regiao \u0026lt;chr\u0026gt; \u0026quot;5¬™ RAJ\u0026quot;, \u0026quot;2¬™ RAJ\u0026quot;, \u0026quot;5¬™ RAJ\u0026quot;, \u0026quot;5¬™ RAJ\u0026quot;, \u0026quot;5¬™ RA...\r# $ regiao \u0026lt;chr\u0026gt; \u0026quot;Presidente Prudente\u0026quot;, \u0026quot;Ara√ßatuba\u0026quot;, \u0026quot;President...\r# $ geometry \u0026lt;simple_feature\u0026gt; MULTIPOLYGON (((-51.8600105..., MUL...\rSe voc√™ quiser fazer um gr√°fico feinho s√≥ pra saber o que est√° rolando, use plot():\nplot(d_sf_municipio[, c(\u0026quot;num_regiao\u0026quot;, \u0026quot;geometry\u0026quot;)])\r\rParte 2: agrupando os munic√≠pios\rAqui √© onde a m√°gica acontece! Para unir os pol√≠gonos do mapa, por incr√≠vel que pare√ßa, utilizaremos o pacote dplyr. O autor do pacote sf, Edzer Pebesma, teve a incr√≠vel ideia de criar um m√©todo S3 para objetos do tipo sf (como √© nosso caso), j√° fazendo algumas opera√ß√µes para n√≥s. Na pr√°tica, o pacote estende e reimplementa mais de 20 fun√ß√µes provenientes do dplyr. Veja ?sf::dplyr para detalhes.\nNo nosso caso, vamos usar group_by() (ou sf::group_by.sf()) e summarise() (ousf::summarise.sf()):\nd_sf_comarca \u0026lt;- d_sf_municipio %\u0026gt;%\rdplyr::group_by(comarca) %\u0026gt;%\rdplyr::summarise() %\u0026gt;%\rdplyr::ungroup()\rdplyr::glimpse(d_sf_comarca)\r# Observations: 319\r# Variables: 2\r# $ comarca \u0026lt;chr\u0026gt; \u0026quot;ADAMANTINA\u0026quot;, \u0026quot;AGUAI\u0026quot;, \u0026quot;AGUAS DE LINDOIA\u0026quot;, \u0026quot;AGUDOS\u0026quot;, \u0026quot;...\r# $ geometry \u0026lt;simple_feature\u0026gt; MULTIPOLYGON (((-50.9930145..., MULTIPOLYGO...\rSimples assim! Note que agora temos 319 objetos, que √© exatamente o n√∫mero de comarcas. Se quiser adicionar mais vari√°veis, basta inclu√≠-las no summarise():\nd_sf_comarca \u0026lt;- d_sf_municipio %\u0026gt;%\rdplyr::group_by(comarca) %\u0026gt;%\r# a entrancia identifica o qu√£o grande/relevante √© uma comarca\rdplyr::summarise(entrancia = dplyr::first(entrancia)) %\u0026gt;%\rdplyr::ungroup()\rPara criar d_sf_circunscricao e d_sf_regiao utilizamos o mesmo procedimento.\n\rParte 3: montando os gr√°ficos\rAgora digamos que voc√™ tenha essa lista de mapas\nmapas \u0026lt;- list(\rd_sf_municipio,\rd_sf_comarca,\rd_sf_circunscricao,\rd_sf_regiao)\rE voc√™ quer desenhar mapas com esses t√≠tulos\ntitulos \u0026lt;- c(\r\u0026quot;Munic√≠pios\u0026quot;,\r\u0026quot;Comarcas\u0026quot;,\r\u0026quot;Circunscri√ß√µes judici√°rias\u0026quot;,\r\u0026quot;Regi√µes Admnistrativas\u0026quot;)\rVamos usar o purrr::map2() para montar nossos gr√°ficos em ggplot2 e guardar numa lista. Internamente, utilizaremos o geom_sf(), uma extens√£o do ggplot2 criada para tratar objetos do pacote sf. Um c√≥digo minimalista seria\ngraficos \u0026lt;- purrr::map2(mapas, titulos, ~{\rggplot(.x) + # cria o ggplot\rgeom_sf() + # desenha o mapa\rggtitle(.y) + # adiciona o t√≠tulo\rtheme_minimal() # deixa o fundo mais bonitinho\r})\rVoc√™ pode usar a fun√ß√£o gridExtra::grid.arrange() para juntar essa lista de gr√°ficos em um gr√°fico s√≥, rodando\ngridExtra::grid.arrange(grobs = graficos)\rO resultado final √© o gr√°fico abaixo.\nCoisa mais linda!\n\r\rWrap-up\r\rO pacote sf coloca a an√°lise espacial no tidyverse\rUse st_read() para ler shapefiles (arquivos SHP)\r\rO objeto resultante √© um data.frame com uma coluna geometry especial que guarda os pol√≠gonos.\r\rV√°rias fun√ß√µes do dplyr foram reimplementadas para funcionar com o sf. summarise, por exemplo, faz a uni√£o de pol√≠gonos, o que resolve nosso problema.\rVoc√™ pode usar geom_sf() para fazer gr√°ficos com sf usando o poderoso ggplot2.\r\r√â isso pessoal. Espero que seja t√£o life saver para voc√™s como foi para mim. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-11-23-union-sf/","tags":["sf","tidyverse"],"title":"Unindo mapas: the tidy way"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rO que fazer quando precisamos que o nosso script rode mais r√°pido? Geralmente a primeira ideia que temos √© otimizar o c√≥digo: reduzir a quantidade de la√ßos, diminuir o tamanho das estruturas, utilizar programa√ß√£o paralela, etc‚Ä¶ Mas quando se trata de R, temos a possibilidade de aumentar a velocidade do c√≥digo sem alterar praticamente nada da sua estrutura.\nNeste post darei uma introdu√ß√£o b√°sica ao pacote Rcpp, uma ferramenta que nos permite rodar c√≥digo em C++ de dentro do R.\nO b√°sico\rC++ √© uma linguagem de programa√ß√£o muito famosa e vers√°til. Ela t√™m elementos de programa√ß√£o gen√©rica, imperativa e orientada a objeto e tamb√©m fornece uma interface para manipula√ß√£o de mem√≥ria de baixo n√≠vel.\nUma caracter√≠stica interessante do C++ √© que ele √© extremamente veloz. Diferentemente do R, ela √© uma linguagem compilada, com tipagem est√°tica e que n√£o fornece tantas abstra√ß√µes de opera√ß√µes, permitindo que seu c√≥digo execute com efici√™ncia incr√≠vel.\nPara explorar os benef√≠cios que o C++ pode trazer para o seu c√≥digo R, instale e carregue o pacote Rcpp com os comandos abaixo:\ninstall.packages(\u0026quot;Rcpp\u0026quot;)\rlibrary(Rcpp)\rVejamos agora um exemplo simples de como chamar c√≥digo C++ do R. O jeito mais f√°cil de fazer isso √© atrav√©s da fun√ß√£o cppFunction(): ela recebe uma string que ser√° interpretada como uma fun√ß√£o em C++.\nadicao_r \u0026lt;- function(x, y, z) {\rsum = x + y + z\rreturn(sum)\r}\rcppFunction(\r\u0026quot;int adicao_c(int x, int y, int z) {\rint sum = x + y + z;\rreturn sum;\r}\u0026quot;)\radicao_r(1, 2, 3)\r#\u0026gt; [1] 6\radicao_c(1, 2, 3)\r#\u0026gt; [1] 6\rComo podemos observar no exemplo acima, ambas as fun√ß√µes t√™m o mesmo comportamento apesar de algumas diferen√ßas superficiais. Note como temos sempre que declarar os tipos das vari√°veis em C++! Usando a palavra-chave int deixamos claro para o compilador que uma vari√°vel ter√° o tipo inteiro e at√© mesmo que uma fun√ß√£o deve retornar um valor de tipo inteiro. Outra coisa que √© importante lembrar √© que precisamos colocar um ponto-e-v√≠rgula ap√≥s cada comando C++.\n\rVetores\rNormalmente o C++ teria diferen√ßas enormes em rela√ß√£o ao R no seu tratamento de vetores, mas para a nossa sorte o Rcpp nos disponibiliza uma biblioteca de estruturas que abstraem o comportamento do R. No exemplo a seguir temos uma fun√ß√£o que recebe um n√∫mero e vetor num√©rico, computa a dist√¢ncia euclidiana entre o valor e o vetor e retorna um vetor num√©rico como sa√≠da.\ndist_r \u0026lt;- function(x, ys) {\rsqrt((x - ys) ^ 2)\r}\rcppFunction(\r\u0026quot;NumericVector dist_c(double x, NumericVector ys) {\rint n = ys.size();\rNumericVector out(n);\rfor(int i = 0; i \u0026lt; n; i++) {\rout[i] = sqrt(pow(ys[i] - x, 2.0));\r}\rreturn out;\r}\u0026quot;)\rdist_r(10, 20:25)\r#\u0026gt; [1] 10 11 12 13 14 15\rdist_c(10, 20:25)\r#\u0026gt; [1] 10 11 12 13 14 15\rA estrutura NumericVector abstrai um vetor num√©rico do R, nos permitindo trabalhar com ele de uma maneira mais familiar. Com o m√©todo .size() obtemos o seu comprimento (equivalente a length()) e podemos declarar um novo com o construtor NumericVector nome(comprimento);. O √∫nico ponto de diferen√ßa fundamental entre o C++ e o R √© que o primeiro n√£o possui opera√ß√µes vetorizadas propriamente ditas, fazendo com que precisemos usar la√ßos para toda e qualquer itera√ß√£o.\n\rVelocidade m√°xima\rCertos aspectos da filosofia do R o tornam uma linguagem extremamente vers√°til, mas isso vem com certas desvantagens. Alguns pontos em que a performance do R deixa a desejar s√£o la√ßo n√£o vetoriz√°veis (por uma itera√ß√£o depender da anterior), fun√ß√µes recursivas e estruturas de dados complexas.\nNestas e em muitas outras situa√ß√µes, usar C++ pode ser extremamente vantajoso. No exemplo a seguir veremos a diferen√ßa entre a performance de um la√ßo em C++ e um em R; note que esta nem √© uma das 3 situa√ß√µes listadas no par√°grafo anterior e que mesmo assim o c√≥digo em C++ √© 6 vezes mais r√°pido.\nsoma_r \u0026lt;- function(v) {\rtotal \u0026lt;- 0\rfor (e in v) {\rif (e \u0026lt; 0) { total = total - e }\relse if (e \u0026gt; 0.75) { total = total + e/2 }\relse { total = total + e }\r}\rreturn(total)\r}\rcppFunction(\r\u0026quot;double soma_c(NumericVector v) {\rdouble total = 0;\rfor (int i = 0; i \u0026lt; v.size(); i++) {\rif (v[i] \u0026lt; 0) { total -= v[i]; }\relse if (v[i] \u0026gt; 0.75) { total += v[i]/2; }\relse { total += v[i]; }\r}\rreturn(total);\r}\u0026quot;)\rv \u0026lt;- runif(100000, -1, 1)\rmicrobenchmark::microbenchmark(soma_r(v), soma_c(v))\r#\u0026gt; Unit: milliseconds\r#\u0026gt; expr min lq mean median uq max neval\r#\u0026gt; soma_r(v) 6.105048 6.436608 6.911819 6.718456 7.183266 11.610624 100\r#\u0026gt; soma_c(v) 1.045805 1.063956 1.161585 1.097920 1.210052 1.955702 100\rObs.: Os s√≠mbolos += e -= s√£o equivalentes a a = a +/- b, j√° o s√≠mbolo ++ √© equivalente a a = a + 1.\n\rConclus√£o\rCom o pacote Rcpp, podemos rodar c√≥digo em C++ de dentro do pr√≥prio R. Atrav√©s dessa t√©cnica conseguimos otimizar nosso c√≥digo ou mesmo ter acesso a estruturas de dados complexas disponibilizadas pelo C++.\nPara saber mais sobre o assunto, d√™ uma olhada no tutorial escrito por Hadley Wickham no livro Advanced R. Tamb√©m recomendo a pr√≥pria p√°gina do Rcpp e sua extensa galeria de exemplos.\nP.S.: Se voc√™ quiser o c√≥digo completo deste tutorial, disponibilizei ele em um Gist. Al√©m disso, tamb√©m escrevi uma vers√£o em ingl√™s deste post no meu blog pessoal. Abra√ßos!\n\r","permalink":"https://blog.curso-r.com/posts/2017-11-23-introducao-rcpp/","tags":["rcpp"],"title":"Fazendo o R Voar: uma Introdu√ß√£o ao Rcpp"},{"author":["Gabriela Lima Borges"],"categories":["Tutoriais"],"contents":"\r\rSe voc√™ tamb√©m quiser escrever um post como convidada, entre em contato a gente em contato@curso-r.com!\n\rPacote Reticulate\rImagine se voc√™ pudesse aproveitar da quantidade e da variedade enorme de m√≥dulos e bibliotecas do Python no ambiente amig√°vel do RStudio? Gra√ßas ao pacote reticulate isso √© poss√≠vel de uma maneira familiar para quem quem j√° √© usu√°rio do R.\nO reticulate √© um pacote que proporciona a integra√ß√£o Python \u0026amp; R via R e pode ser bastante √∫til se voc√™ quiser fazer todas as an√°lises no ambiente do Rstudio. Os m√≥dulos, classes e fun√ß√µes do Python importados podem ser utilizados como se fossem fun√ß√µes nativas do R.\nPara utilizar o pacote s√£o necess√°rias a instala√ß√£o do Python com vers√£o superior a 2.7, a instala√ß√£o dos m√≥dulos do Python que ser√£o utilizados durante a an√°lise e a instala√ß√£o do pacote via install.packages().\n# install.packages(\u0026quot;reticulate\u0026quot;)\rlibrary(reticulate)\rQuando for utilizada uma fun√ß√£o do Python em um objeto do R, ele ser√° convertido para seu formato equivalente do Python e vice-versa. Os tipos de convers√µes de objetos s√£o explicitadas neste link.\n## Data frame do R √© convertido em Dict do Python\ra \u0026lt;- r_to_py(mtcars)\rclass(a)\r## Dict do Python √© convertido em List do R\rclass(py_to_r(a))\r\rImportando m√≥dulos\rA importa√ß√£o de m√≥dulos do Python para o R √© bem simples. Basta usar a fun√ß√£o import() do pacote reticulate e o nome do m√≥dulo que voc√™ quer importar, em seguida guardar isso em um objeto no R.\nnp \u0026lt;- import(\u0026quot;numpy\u0026quot;)\rpandas \u0026lt;- import(\u0026quot;pandas\u0026quot;)\ros \u0026lt;- import(\u0026quot;os\u0026quot;)\rUse a fun√ß√£o py_module_available() pra checar se um m√≥dulo do Python est√° dispon√≠vel no seu computador.\npy_module_available(\u0026quot;matplotlib\u0026quot;)\rAs fun√ß√µes que est√£o dentro de m√≥dulos ou classes do Python podem ser acessadas utilizando o operador $:\nos$getcwd()\rnp$abs(-1)\rE podemos misturar fun√ß√µes do R e do python:\nlibrary(magrittr)\rrnorm(10) %\u0026gt;%\rnp$abs() %\u0026gt;%\rnp$cumproduct() %\u0026gt;%\rplot()\r\rExemplo\rPara ilustrar a integra√ß√£o Python \u0026amp; R via R, vamos usar o Astropy, que √© uma biblioteca do Python desenvolvida para a astronomia. Vamos tentar reproduzir esse exemplo que foi implementado no python. Primeiro, precisamos instalar o m√≥dulo:\npip install astropy\rNo ambiente do RStudio, vamos importar os m√≥dulos do Astropy que usaremos.\ndown \u0026lt;- import(\u0026quot;astropy.utils.data\u0026quot;)\rfits \u0026lt;- import(\u0026quot;astropy.io.fits\u0026quot;)\rEm seguida, vamos baixar a imagem em arquivo FITS e verificar se est√° tudo ok usando a fun√ß√£o info do Python que est√° no pacote Astropy.io.fits.\nurl \u0026lt;- \u0026quot;https://astropy.stsci.edu/data/tutorials/FITS-images/HorseHead.fits\u0026quot;\rim.file \u0026lt;- down$download_file(url, cache=TRUE)\rfits$info(im.file)\rFilename: ~/.astropy/cache/download/py2/2c9202ae878ecfcb60878ceb63837f5f\rNo. Name Ver Type Cards Dimensions Format\r0 PRIMARY 1 PrimaryHDU 161 (891, 893) int16\r1 er.mask 1 TableHDU 25 1600R x 4C [F6.2, F6.2, F6.2, F6.2]\rAgora vamos transformar nossa imagem em uma matriz de pixels e plotar com a fun√ß√£o image do R.\nim.data \u0026lt;- fits$getdata(im.file)\rim.data %\u0026gt;%\rt() %\u0026gt;%\rimage(col = gray(seq(0, 1, length = 256)))\r\r","permalink":"https://blog.curso-r.com/posts/2017-11-20-reticulate/","tags":["reticulate","python"],"title":"Pacote reticulate"},{"author":["Daniel"],"categories":["Tutoriais"],"contents":"\rMatrizes esparsas s√£o matrizes em que a maior parte dos elementos √© igual a zero.\rMatrizes dessa forma surgem em diversos problemas relacionados a Machine Learning e an√°lise de dados.\nPor exemplo, √© comum em text mining representar os documentos usando o chamado Bag of Words. Bag of Words nada mais √© do que listar as palavras que aparecem em todos os documentos e em seguida criar uma matriz em que cada linha √© um documento e cada coluna √© uma palavra que foi listada anteriormente. Cada elemento \\((i,j)\\) desssa matriz √© 1 se a palavra \\(j\\) aparace no documento \\(i\\) e 0 caso contr√°rio. Naturalmente, o n√∫mero de palavras que podem aparecer √© muito maior do que o n√∫mero de palavras que de fato aparecem em um documento, por isso a maioria dos elementos dessa matriz ser√° 0.\nMatrizes esparsas tamb√©m aparecem muito em problemas de recomenda√ß√£o. Nesse tipo de aplcia√ß√£o representamos as transa√ß√µes em uma matriz em que cada linha √© um cliente e cada coluna um produto que ele poderia ter comprado. Para recomendar filmes no Netflix, por exemplo, cada linha seria um cliente e cada coluna um filme que est√° no cat√°logo do Netflix. Em seguida marcar√≠amos cada elemento \\((i,j)\\) dessa matriz com 1 se o cliente \\(i\\) assistiu o filme \\(j\\) e 0 caso contr√°rio. Como o cat√°logo de filmes √© muito grande, a mairoia dos elementos dessa matriz ser√° 0.\nEssa pergunta do Quora tem mais algumas aplica√ß√µes importantes de matrizes esparsas.\nNote que nos problemas que eu mencionei, encontramos dimens√µes muito altas. O n√∫mero de palavras distintas em um conjunto de documentos pode facilmente passar de 20.000. O n√∫mero de filmes no cat√°logo do netflix pode passar de 100.000. Agora vamos definir uma matriz como esta no R da forma usual. Vou preench√™-la aleatoriamente com 0‚Äôs e 1‚Äôs, sendo 1‚Äôs aproximadamente 1%. Considere que essa matriz seria utilizada em um problema de classifica√ß√£o de textos com 1 milh√£o de documentos com apenas 500 palavras distintas. Veja que aqui estou reduzindo bastante o n√∫mero de palavras poss√≠veis, na pr√°tica esse n√∫mero √© muito maior.\nnrow \u0026lt;- 1e6\rncol \u0026lt;- 500\rx \u0026lt;- matrix(sample(c(0,1), size = nrow*ncol, replace = TRUE,prob = c(0.99, 0.1)), nrow = nrow, ncol = ncol)\rSe voc√™ tiver um computador com bastante RAM, talvez consiga rodar isso, mas provavelmente voc√™\rter√° um erro do tipo Error: cannot allocate vector of size 74.5 Gb.\nDe fato, essa matriz ocupa bastante mem√≥ria:\npryr::object_size(x)\r#\u0026gt; 4 GB\rSer√° que existe uma forma mais eficiente de representar essa matriz na mem√≥ria do computador?\rA resposta √© sim! E no R vamos usar o pacote Matrix.\nExistem diversas formas de transformar a matriz x em uma matriz esparsa, a forma mais simples √©:\nlibrary(Matrix)\rx_s \u0026lt;- Matrix(x)\rpryr::object_size(x_s)\r#\u0026gt; 550 MB\rOu seja, a matriz esparsa ocupa quase 1/8 menos mem√≥ria do que a matriz densa. A maioria dos m√©todos\rpara matrizes no R est√£o tamb√©m implementados para matrizes esparsas. Isso quer dizer que voc√™ pode fazer\rx*y, x+y, x/y, x%*%y, x[1,1], etc. como se fossem matrizes normais. Na pr√°tica o pacote Matrix\rrepresenta as matrizes esparsas internamente de uma forma muito mais inteligente, sem gastar mem√≥ria com os valores nulos.\nUma outra grande vantagem √© que muitos pacotes possuem implementa√ß√µes mais eficientes (tanto em tempo de execu√ß√£o quanto em mem√≥ria utilizada) para matrizes esparsas,\rpor exemplo o glmnet muito usado para fazer regress√£o do\rtipo LASSO. O recommenderlab que implementa alguns\ralgoritmos de recomenda√ß√£o tamb√©m √© inteiramente baseado em matrizes esparsas.\rO pacote text2vec que implementa algoritmos como GloVe tamb√©m usa muito esse tipo de matrizes.\nVale lembrar que na maioria das vezes voc√™ possui uma base transacional que precisa ser representada como uma matriz.\rAlgo mais ou menos assim:\nbd \u0026lt;- data.frame(\rcliente = c(1,1,1,2,2,3,3,4,5,6,7,7,8,8,8,8,9,9,9,9),\ritens = sample(1:50, 20)\r)\r\r\rcliente\ritens\r\r\r\r1\r17\r\r1\r30\r\r1\r7\r\r2\r14\r\r2\r42\r\r3\r49\r\r3\r4\r\r4\r24\r\r5\r16\r\r6\r10\r\r7\r9\r\r7\r41\r\r8\r6\r\r8\r47\r\r8\r38\r\r8\r21\r\r9\r37\r\r9\r35\r\r9\r11\r\r9\r31\r\r\r\rNesse caso, faz mais sentido criar a matriz esparsa usando a fun√ß√£o sparseMatrix. Assim, voc√™ s√≥ especifica as coordenadas da matriz que t√™m algum 1.\nlibrary(Matrix)\rsparseMatrix(bd$cliente, bd$itens)\r## 9 x 49 sparse Matrix of class \u0026quot;ngCMatrix\u0026quot;\r## ## [1,] . . . . . . | . . . . . . . . . | . . . . . . . . . . . . | . . . . . . .\r## [2,] . . . . . . . . . . . . . | . . . . . . . . . . . . . . . . . . . . . . .\r## [3,] . . . | . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .\r## [4,] . . . . . . . . . . . . . . . . . . . . . . . | . . . . . . . . . . . . .\r## [5,] . . . . . . . . . . . . . . . | . . . . . . . . . . . . . . . . . . . . .\r## [6,] . . . . . . . . . | . . . . . . . . . . . . . . . . . . . . . . . . . . .\r## [7,] . . . . . . . . | . . . . . . . . . . . . . . . . . . . . . . . . . . . .\r## [8,] . . . . . | . . . . . . . . . . . . . . | . . . . . . . . . . . . . . . .\r## [9,] . . . . . . . . . . | . . . . . . . . . . . . . . . . . . . | . . . | . |\r## ## [1,] . . . . . . . . . . . .\r## [2,] . . . . | . . . . . . .\r## [3,] . . . . . . . . . . . |\r## [4,] . . . . . . . . . . . .\r## [5,] . . . . . . . . . . . .\r## [6,] . . . . . . . . . . . .\r## [7,] . . . | . . . . . . . .\r## [8,] | . . . . . . . . | . .\r## [9,] . . . . . . . . . . . .\rOutra fun√ß√£o importante √© a sparse.model.matrix. Ela √© equivalente √† fun√ß√£o model.matrix mas cria uma matriz de modelo esparsa o que pode ser √∫til quando voc√™ tem um fator que possui muitos n√≠veis no seu modelo. A vignette\rSparse Model Matrices fala sobre isso.\nTamb√©m √© poss√≠vel programar em Rcpp usando matrizes esparsas usando o RcppArmadillo, veja esse exemplo para mais detalhes.\nPara saber mais leia as vignettes do pacote Matrix.\rEm especial, vale a pena ler as seguintes 2nd Introduction to the Matrix Package.\nPS: a inspira√ß√£o para esse texto foi esse post de 2011 do John Myles White\n","permalink":"https://blog.curso-r.com/posts/2017-11-16-matrizes-esparsas/","tags":["estat√≠stica"],"title":"Matrizes Esparsas no R"},{"author":["Caio"],"categories":["Tutoriais"],"contents":"\r\rNem sempre os dados que precisamos para uma an√°lise podem ser encontrados em\ruma base consolidada. Muitas vezes as informa√ß√µes que queremos n√£o est√£o\rimediatamente dispon√≠veis e precisam ser coletadas com o tempo atrav√©s de um\rprocesso lento e mon√≥tono.\nImagine, por exemplo, que quis√©ssemos baixar os dados meteorol√≥gicos das\rmaiores cidades do mundo a cada 12 horas para uma an√°lise sobre previs√µes do\rtempo. Um programador desavisado talvez criasse alarmes em seu rel√≥gio e\rpara baixar as tabelas necess√°rias quando eles tocassem.\nMas isso n√£o parece uma boa estrat√©gia, certo?\nDarkSky\rPara demonstrar uma alternativa a este m√©todo, vamos usar um servi√ßo de\rprevis√µes do tempo chamado DarkSky. Esta plataforma\rficou conhecida recentemente pela sua precis√£o incr√≠vel e pelo seu\raplicativo\rextremamente bem feito, mas uma coisa que poucos sabem √© que a DarkSky tamb√©m\rdisponibiliza uma API para qualquer um interessado em dados meteorol√≥gicos.\nPara a nossa sorte, o hrbrmstr j√° criou uma\rinterface em R para essa API que pode ser\rinstalada facilmente com o comando abaixo:\n# install.packages(\u0026quot;devtools\u0026quot;)\rdevtools::install_github(\u0026quot;hrbrmstr/darksky\u0026quot;)\rDepois de instalado o pacote, v√° para o portal do desenvolvedor\rda DarkSky, crie uma conta e obtenha uma chave secreta para acessar a API.\nSys.setenv(DARKSKY_API_KEY = \u0026quot;SUA CHAVE SECRETA\u0026quot;)\r\rBaixando os dados\rO primeiro passo da nossa an√°lise √© determinar as latitudes e longitudes das\rmaiores cidades do mundo para que possamos pedir as previs√µes do tempo\rdestas coordenadas.\nCom o pacote maps podemos fazer isso de uma maneira bastante simples:\nforecasts \u0026lt;- maps::world.cities %\u0026gt;%\rdplyr::as_tibble() %\u0026gt;%\rdplyr::filter(pop \u0026gt; 2000000) %\u0026gt;%\rdplyr::rename(country = country.etc) %\u0026gt;%\rdplyr::select(name, country, lat, long) %\u0026gt;%\rdplyr::mutate(\rcurrently = list(\u0026quot;\u0026quot;),\rhourly = list(\u0026quot;\u0026quot;),\rdaily = list(\u0026quot;\u0026quot;))\rNo trecho de c√≥digo acima pegamos todas as cidades com mais de 2 milh√µes de\rhabitantes (juntamente com suas localiza√ß√µes) da base maps::world.cities.\rAs √∫ltimas 4 linhas s√£o uma prepara√ß√£o para a obten√ß√£o das previs√µes do tempo\rque faremos logo a seguir:\nfor (i in 1:nrow(forecasts)) {\rforecast \u0026lt;- darksky::get_current_forecast(forecasts$lat[i], forecasts$long[i])\rforecasts$currently[i] \u0026lt;- forecast$currently %\u0026gt;% dplyr::as_tibble() %\u0026gt;% list()\rforecasts$hourly[i] \u0026lt;- forecast$hourly %\u0026gt;% dplyr::as_tibble() %\u0026gt;% list()\rforecasts$daily[i] \u0026lt;- forecast$daily %\u0026gt;% dplyr::as_tibble() %\u0026gt;% list()\r}\rNa coluna currently guardamos o estado meteorol√≥gico atual da cidade, enquanto\rem hourly e daily colocamos as previs√µes do tempo para as pr√≥ximas 48 horas\re para os pr√≥ximos 7 dias respectivamente. Agora s√≥ resta salvar isso tudo em um\rarquivo RDS:\nfile \u0026lt;- lubridate::now() %\u0026gt;%\rlubridate::ymd_hms() %\u0026gt;%\ras.character() %\u0026gt;%\rstringr::str_replace_all(\u0026quot;[-: ]\u0026quot;, \u0026quot;_\u0026quot;) %\u0026gt;%\rstringr::str_c(\u0026quot;.rds\u0026quot;)¬†readr::write_rds(forecasts, stringr::str_c(\u0026quot;DIRET√ìRIO DOS ARQUIVOS\u0026quot;, file))\r\rcronR\rPerceba que o script descrito na se√ß√£o anterior n√£o depende de nenhum input do\rprogramador e pode ser rodado automaticamente. Agora s√≥ nos resta automatizar\ressa execu√ß√£o, tarefa que realizaremos com o pacote cronR. Ele funciona nas\rplataformas Mac e Linux e pode ser instalado com o comando a seguir:\ninstall.packages(\u0026quot;cronR\u0026quot;)\rEsse pacote nos permite agendar a\rexecu√ß√£o de qualquer comando para que ela ocorra a cada tantos minutos/horas/dias/‚Ä¶\rCertifique-se de que voc√™ est√° em uma m√°quina ou servidor que n√£o ser√° desligado,\rverifique se o cron daemon est√° ativo e\ragende a execu√ß√£o do nosso script:\ncmd \u0026lt;- cronR::cron_rscript(\u0026quot;CAMINHO PARA SCRIPT\u0026quot;)\rcronR::cron_add(cmd, \u0026quot;daily\u0026quot;, \u0026quot;12AM\u0026quot;)\rcronR::cron_add(cmd, \u0026quot;daily\u0026quot;, \u0026quot;12PM\u0026quot;)\rE isso √© tudo! No meu caso, agendei o script para executar diariamente √†s 00:00\re √†s 12:00, mas a frequ√™ncia das chamadas fica a seu crit√©rio (lembrando apenas\rque o plano gratuito da API do DarkSky s√≥ permite 1000 chamadas por dia). Para\rsaber mais sobre como mudar a frequ√™ncia das execu√ß√µes, consulte a\rdocumenta√ß√£o do cronR.\n\rConclus√£o\rComo vimos, n√£o √© dif√≠cil agendar a execu√ß√£o de um script. A maior parte do\rnosso trabalho √© criar um c√≥digo que funcione independentemente do programador\r(por exemplo nomeando os arquivos gerados automaticamente), mas depois disso\r√© s√≥ chamar cronR::cron_rscript() e cronR::cron_add().\nNo meu pr√≥ximo post usarei os dados baixados com esse tutorial para uma an√°lise\rsobre previs√µes meteorol√≥gicas, ent√£o fique ligado na parte dois!\nP.S.: Se voc√™ quiser o c√≥digo completo do meu arquivo get_forecasts.R,\rdisponibilizei ele como um Gist.\rAl√©m disso, tamb√©m disponibilizei uma vers√£o em ingl√™s deste post no\rmeu blog pessoal. Abra√ßos!\n\r","permalink":"https://blog.curso-r.com/posts/2017-11-13-tutorial-cronr/","tags":["cron"],"title":"Usando o cronR para Agendar Scripts"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\rVoltando aos saudosos captchas. Demorei para fazer esse post pois estava esperando o lan√ßamento do curso de redes neurais convolucionais do Andrew Ng. O curso foi muito bom, valeu √† pena! E, como prometido, vamos agora trabalhar com modelagem dos captchas.\nObjetivo\rNosso objetivo √© aprender a aplicar a opera√ß√£o da convolu√ß√£o em imagens, replicando o modelo j√° ajustado dos captchas. O jeito que fazemos para ajustar o modelo ficar√° para um pr√≥ximo post.\nPr√©-requisitos\rNa nossa jornada, utilizaremos o pacote decryptr e teremos como o base o captcha da Receita Federal. Para baixar um captcha e plotar na sua tela, rode o c√≥digo abaixo. Utilizaremos o caminho do arquivo em arq v√°rias vezes no decorrer do post. Instale tamb√©m o pacote decryptrModels para carregar o modelo ajustado do captcha da receita.\n# devtools::install_github(\u0026quot;decryptr/decryptr\u0026quot;)\r# devtools::install_github(\u0026quot;decryptr/decryptrModels\u0026quot;)\rlibrary(decryptr)\rarq \u0026lt;- captcha_download_rfb(dest = \u0026quot;img\u0026quot;)\rarq %\u0026gt;%\rread_captcha() %\u0026gt;%\rpurrr::pluck(1) %\u0026gt;%\rplot()\rTamb√©m precisaremos do keras, um pacote maravilhoso feito pela turma do RStudio, com contribui√ß√µes do Daniel Falbel. N√£o esque√ßa de fazer o tensorflow funcionar na sua m√°quina! Esse post do Athos Damiani pode ajudar.\n# install.packages(\u0026quot;keras\u0026quot;)\rlibrary(keras)\rPara os retoques finais nas imagens, vamos usar o pacote magick. Meu intuito inicial era usar a fun√ß√£o image_convolve() desse pacote, mas infelizmente essa opera√ß√£o √© limitada. Acabei usando apenas fun√ß√µes para juntar imagens e fazer gifs. Se quiser mais detalhes sobre o magick, veja o excelente post A kind of magick, feito pelo William Amorim.\n# install.packages(\u0026quot;magick\u0026quot;)\rlibrary(magick)\r\r\rO que √© convolu√ß√£o, afinal?\rConvolu√ß√£o √© uma t√©cnica usada h√° muito tempo na √°rea de vis√£o computacional para aplicar filtros em imagens e detectar padr√µes. Basicamente, o que ela faz √© calcular um novo valor para um pixel da imagem com base nos pixels da vizinhan√ßa. Por exemplo, voc√™ pode fazer com que o pixel \\((i,j)\\) da sua imagem seja atualizado pela soma ponderada dos valores dos pixels na vizinhan√ßa.\n\rSe voc√™ n√£o est√° entendendo nada, Veja o v√≠deo abaixo para entender o que s√£o pixels. No nosso caso, teremos uma matriz com valores entre zero e um, sendo zero = preto e um = branco.\n\r\rUma forma esperta de fazer essa soma ponderada √© criando uma matriz de pesos: dessa forma, voc√™ n√£o precisa ficar procurando os pontos da vizinhan√ßa. Para cada ponto \\((i,j)\\), voc√™ pega o subset da matriz de vizinhan√ßa, multiplica pontualmente pela matriz de pesos e soma todos os valores. Isso √© exatamente o que a convolu√ß√£o faz.\nDaqui em diante, chamaremos essa matriz de pesos de kernel. Considere esse exemplo 3x3:\nkern_horizontal \u0026lt;- rbind(c(-1,-1,-1),\rc( 0, 0, 0),\rc( 1, 1, 1))\rkern_horizontal\rE considere essa imagem super complexa:\nNa pr√°tica, essa imagem √© isso aqui (tirei algumas linhas e colunas):\nemoji \u0026lt;- load_image(\u0026quot;../../staticimages/posts/conteudo/captcha-conv/emoji3.webp\u0026quot;)[,,1]\rround(emoji, 1)[1:10, 1:12]\rTome por exemplo o ponto \\((i,j) = (12,16)\\). A vizinhan√ßa 3x3 em torno desse ponto √© dada por\nemoji[12 + (-1):1, 16 + (-1):1]\rA opera√ß√£o de convolu√ß√£o √© feita da seguinte forma:\nsum(emoji[12 + (-1):1, 16 + (-1):1] * kern_horizontal)\rPronto, esse √© o valor a ser colocado no ponto \\((i,j)\\). Fazemos isso para todos os outros pontos. Algumas d√∫vidas que podem rolar nesse ponto:\nQ: Mas os n√∫meros n√£o devem variar de 0 a 1?\nR: N√£o! Para visualizar a imagem, voc√™ poderia normalizar essas quantidades (por exemplo, dividindo pelo m√°ximo). Mas quem disse que o resultado da sua opera√ß√£o precisa ser visualiz√°vel? O resultado pode at√© ser negativo. Sem problemas.\n\rPara visualiza√ß√£o, por padr√£o os valores menores que zero s√£o substitu√≠dos por zero (preto) e valores maiores que um s√£o substitu√≠dos por um (branco).\n\rQ: Mas e no canto da imagem, o que fazemos?\nR: Nos cantos, voc√™ tem duas op√ß√µes: 1) considerar apenas os pixels v√°lidos, ou seja, pixels em que voc√™ consegue encaixar a matriz kernel inteira, resultando numa matriz de tamanho menor; ou 2) criar uma borda na imagem, preenchendo com zeros, para que toda a imagem fique com pixels v√°lidos. Por isso que o keras disponibiliza as op√ß√µes valid (apenas os v√°lidos) e same (mant√©m a mesma dimens√£o).\nQ: E se a imagem for colorida?\nR: Boa pergunta! Se a imagem for colorida, voc√™ pode considerar um kernel diferente para cada cor, e depois voc√™ soma todos os valores. Mais pra frente, chamaremos as cores de canais, pois teremos muito mais do que 3 kernels.\nCom base nisso, montei um algoritmo que faz a conta para todos os pixels, j√° criando uma borda na imagem:\nconvolve \u0026lt;- function(img, kern) {\r# monta a bordinha na imagem. A borda deve ter (tamanho kernel) / 2,\r# de tamanho, arredondando para baixo\rpad \u0026lt;- floor(dim(kern)[1] / 2)\rimg_pad \u0026lt;- matrix(0, nrow = nrow(img) + 2 * pad, ncol = ncol(img) + 2 * pad)\rimg_pad[pad + 1:nrow(img), pad + 1:ncol(img)] \u0026lt;- img[,,1]\r# aplica a convolu√ß√£o nos pontos da imagem\rfor (i in seq_len(nrow(img))) {\rfor (j in seq_len(ncol(img))) {\rimg[i, j, 1] \u0026lt;- sum(img_pad[i + 0:(2 * pad), j + 0:(2 * pad)] * kern)\r}\r}\rimg[,,2] \u0026lt;- img[,,3] \u0026lt;- img[,,1]\rimg\r}\r(desculpe aos amigos por usar for. Shame on me‚Ä¶)\nVoltando para nossa imagem agora. No nosso caso, o resultado fica assim:\n\u0026quot;../../staticimages/posts/conteudo/captcha-conv/emoji3.webp\u0026quot; %\u0026gt;%\rload_image() %\u0026gt;%\rconvolve(kern_horizontal) %\u0026gt;%\rimage_read() %\u0026gt;%\rplot()\rFicou um pouco assustador, n√£o? Essa matriz n√£o foi escolhida por acaso. Ela serve para destacar padr√µes horizontais da imagem. Como a primeira linha √© formada -1s e a √∫ltima √© formada por 1s, a matriz fica com valor alto se a parte de cima do pixel for preta e a parte de baixo for branca (grande * 1 + pequeno * (-1)). A parte destacada da imagem acabou sendo os olhos (pois temos maior concentra√ß√£o de pixels pretos ali), al√©m das extremidades superior e inferior do rosto.\nCom esse kernel aqui (vertical), a parte destacada do rosto s√£o as extremidades dos lados:\nkern_vertical \u0026lt;- rbind(c(-1, 0, 1),\rc(-1, 0, 1),\rc(-1, 0, 1))\rkern_vertical\r\u0026quot;../../staticimages/posts/conteudo/captcha-conv/emoji3.webp\u0026quot; %\u0026gt;%\rload_image() %\u0026gt;%\rconvolve(kern_vertical) %\u0026gt;%\rimage_read() %\u0026gt;%\rplot()\r\rAplicando nos captchas\rN√£o tem segredo! Basta reaplicar o que j√° vimos. Vou apenas introduzir uma nova fun√ß√£o chamada add_bias(), que simplesmente adiciona uma constante num√©rica para a matriz. Isso pode auxiliar na visualiza√ß√£o, pois controlamos melhor os valores que ficam dentro do intervalo [0,1]. L√° na frente voc√™ entender√° o porqu√™ do ‚Äúbias‚Äù.\nadd_bias \u0026lt;- function (x, b) x + b\rEsse √© o resultado de adicionar o kernel vertical e bias de 0.8.\narq %\u0026gt;%\rload_image() %\u0026gt;%\rconvolve(kern_vertical) %\u0026gt;%\radd_bias(.8) %\u0026gt;%\rimage_read() %\u0026gt;%\rplot()\rAgora o kernel na horizontal. Note que identificamos padr√µes das linhas horizontais que tentam atrapalhar a vis√£o das letras.\narq %\u0026gt;%\rload_image() %\u0026gt;%\rconvolve(kern_horizontal) %\u0026gt;%\radd_bias(.8) %\u0026gt;%\rimage_read() %\u0026gt;%\rplot()\rColocando um ap√≥s o outro, temos um resultado bem esquisito:\narq %\u0026gt;%\rload_image() %\u0026gt;%\rconvolve(kern_horizontal) %\u0026gt;%\rconvolve(kern_vertical) %\u0026gt;%\radd_bias(.7) %\u0026gt;%\rimage_read() %\u0026gt;%\rplot()\rTamb√©m vou introduzir uma fun√ß√£o chamada relu() aqui. ReLu significa Restricted Linear Unit e √© uma fun√ß√£o bem simples que zera tudo aquilo que √© negativo e mant√©m tudo aquilo que √© positivo. Assim, temos:\nrelu \u0026lt;- function(x) (x + abs(x)) / 2\rrelu(-1)\rrelu( 3)\rPara visualiza√ß√£o, essa fun√ß√£o n√£o serve para muita coisa, pois j√° fazemos a substitui√ß√£o de valores negativos por zero. No entanto, podemos fazer combos com a aplica√ß√£o de v√°rias convolu√ß√µes. O resultado dos combos n√£o seria poss√≠vel somente com somas e multiplica√ß√µes. Na pr√°tica, o que estou afirmando √© que com a aplica√ß√£o de convolu√ß√µes, bias e ReLu, podemos montar opera√ß√µes n√£o lineares para extrair componentes da imagem.\nOlhe o exemplo abaixo. Parece que consegui identificar bem as coisas que s√£o in√∫teis na imagem. Isso pode ser √∫til‚Ä¶ ou n√£o.\narq %\u0026gt;%\rload_image() %\u0026gt;%\r# primeira convolucao\rconvolve(kern_horizontal) %\u0026gt;%\radd_bias(-.25) %\u0026gt;%\rrelu() %\u0026gt;%\r# segunda convolucao\rconvolve(kern_vertical) %\u0026gt;%\radd_bias(.1) %\u0026gt;%\rimage_read() %\u0026gt;%\rplot()\rIsso tudo nos leva a pensar: ser√° que eu consigo pensar em kernels que me ajudem a identificar as letras de uma forma razo√°vel?\n\rE se pudermos usar kernels treinados?\rA revolu√ß√£o da convolu√ß√£o aparece quando conseguimos obter kernels √∫teis por m√©todos estat√≠sticos. Podemos pensar na matriz abaixo\n\\[\rW = \\left[\\begin{array}{ccccc}\rw_{11} \u0026amp; w_{12} \u0026amp; w_{13} \u0026amp; w_{14} \u0026amp; w_{15} \\\\\rw_{21} \u0026amp; w_{22} \u0026amp; w_{23} \u0026amp; w_{24} \u0026amp; w_{25} \\\\\rw_{31} \u0026amp; w_{32} \u0026amp; w_{33} \u0026amp; w_{34} \u0026amp; w_{35} \\\\\rw_{41} \u0026amp; w_{42} \u0026amp; w_{43} \u0026amp; w_{44} \u0026amp; w_{45} \\\\\rw_{51} \u0026amp; w_{52} \u0026amp; w_{53} \u0026amp; w_{54} \u0026amp; w_{55}\r\\end{array}\\right]\r\\]\ne tentar encontrar os valores de \\(W\\) que minimizem alguma fun√ß√£o de interesse. Podemos pensar que esses s√£o os \\(\\beta\\)‚Äôs de uma regress√£o log√≠stica, e queremos encontrar os valores que minimizam uma Loss ou maximizam uma verossimilhan√ßa. Para ver mais sobre isso, recomendo o excelente post do Athos sobre a menor deep learning do mundo. N√≥s tamb√©m podemos fazer v√°rios \\(W\\) como esse, sendo que cada um extrai alguma coisa de importante da imagem.\nNosso super modelo de magia negra nada mais √© do que isso: a aplica√ß√£o consecutiva de convolve(), add_bias() e relu(), mas com pesos escolhidos a dedo (ou por um moedor de carne super-poderoso como o keras).\nAgora podemos ver nosso modelo atual da Receita Federal:\nm \u0026lt;- decryptrModels::read_model(\u0026quot;rfb\u0026quot;)\rm$model\rModel\r____________________________________________________________________________________________________\rLayer (type) Output Shape Param #\r====================================================================================================\rconv2d_4 (Conv2D) (None, 50, 180, 12) 312\r____________________________________________________________________________________________________\rmax_pooling2d_4 (MaxPooling2D) (None, 25, 90, 12) 0\r____________________________________________________________________________________________________\rconv2d_5 (Conv2D) (None, 25, 90, 48) 14448\r____________________________________________________________________________________________________\rmax_pooling2d_5 (MaxPooling2D) (None, 12, 45, 48) 0\r____________________________________________________________________________________________________\rconv2d_6 (Conv2D) (None, 12, 45, 96) 115296\r____________________________________________________________________________________________________\rmax_pooling2d_6 (MaxPooling2D) (None, 6, 22, 96) 0\r____________________________________________________________________________________________________\rflatten_2 (Flatten) (None, 12672) 0\r____________________________________________________________________________________________________\rdense_3 (Dense) (None, 32) 405536\r____________________________________________________________________________________________________\rdropout_2 (Dropout) (None, 32) 0\r____________________________________________________________________________________________________\rdense_4 (Dense) (None, 210) 6930\r____________________________________________________________________________________________________\rreshape_2 (Reshape) (None, 6, 35) 0\r____________________________________________________________________________________________________\ractivation_2 (Activation) (None, 6, 35) 0\r====================================================================================================\rTotal params: 542,522\rTrainable params: 542,522\rNon-trainable params: 0\r____________________________________________________________________________________________________\rO modelo aplica convolu√ß√£o 3 vezes consecutivas e faz algumas contas que n√£o entendemos. Explico agora:\nconv2d_: s√£o as convolu√ß√µes. As aplica√ß√µes de add_bias() e relu() est√£o escondidas a√≠ dentro.\rmax_pooling2d_: serve para simplificar a imagem. Isso ajuda a fazer computa√ß√µes mais r√°pido e ajuda a pegar mais rela√ß√µes entre partes da imagem, sem precisar mudar o tamanho dos kernels.\rdropout_: √© utilizado para regulariza√ß√£o. Serve para evitar que seu modelo quebre apenas o captcha que voc√™ tem na base, e n√£o novos captchas que chegam. Na pr√°tica, o dropout joga fora uma parte dos \\(W\\) obtidos. Se voc√™ consegue prever coisas bem sem esses \\(W\\), isso significa que eles n√£o s√£o t√£o √∫teis assim.\rflatten_ e reshape_: n√£o fazem nada demais, s√≥ reorganizam os par√¢metros de matriz para um vetor ou de vetor para matriz. Isso √© √∫til pois i) depois de aplicar os kernels, n√≥s misturamos todos os par√¢metros resultantes e ii) no final, precisamos prever 6 letras, ent√£o precisamos deixar as probabilidades numa matriz, como vimos no post anterior sobre captchas.\rdense_: s√£o camadas de redes neurais comuns como as do post do Athos.\r\rN√ÉO ME ABANDONE AQUI!!! Se voc√™ n√£o estiver entendendo direito, saiba apenas que a execu√ß√£o de um modelo de deep learning envolve somente\nPegar o input (imagem).\rMultiplicar (convoluir) por alguns pesos \\(W\\).\rAdicionar um vi√©s (ou bias, ou intercepto) \\(b\\).\rAplicar uma fun√ß√£o n√£o linear, por exemplo ReLu.\rVoltar para 2 v√°rias vezes (o deep vem da√≠).\rPegar os pesos finais e normalizar (usando, por exemplo, softmax) para obter probabilidades dos resultados.\r\rNo nosso caso, repetimos o passo 2 tr√™s vezes, aplicando tr√™s convolu√ß√µes seguidas.\nPrimeira convolu√ß√£o\rPara obter os valores de kernels ajustados pelo modelo, podemos usar a fun√ß√£o get_weights() do keras. Nessa primeira parte, utilizamos 12 kernels 5x5.\nw \u0026lt;- keras::get_weights(m$model$layers[[1]])[[1]]\rw_list \u0026lt;- purrr::map(seq_len(dim(w)[4]), ~w[,,1,.x])\rbias \u0026lt;- keras::get_weights(m$model$layers[[1]])[[2]]\rw_list[[1]]\r [,1] [,2] [,3] [,4] [,5]\r[1,] -0.00889198 0.04569587 0.11906113 0.08591988 -0.09028889\r[2,] -0.05898214 0.20692091 -0.13479255 -0.15641896 -0.10511240\r[3,] 0.02517573 -0.63352644 -3.81658459 -4.39883375 -1.05918467\r[4,] -0.22003661 -1.80763698 -3.13373542 -1.73096466 -0.01640752\r[5,] -0.02915078 -0.11879896 -0.07475707 0.06014036 0.15733875\rOs doze valores de bias estimados pelo modelo (um para cada matriz) s√£o dados por\nround(bias, 3)\r[1] 0.150 0.013 0.181 -0.275 0.179 0.040 -0.128 -0.036 0.030 0.042 0.201 0.043\rPara cada um dos doze kernels, calculamos uma matriz convolu√≠da. Esses os resultados que o modelo entende serem √∫teis para prever o captcha.\nO c√≥digo abaixo aplica convolve(), add_bias() e relu() para todos os kernels. Para isso usamos o purrr. Se voc√™ n√£o entende purrr, leia este maravilhoso post do Caio Lente.\nconv1 \u0026lt;- purrr::map2(w_list, bias, ~{\rarq %\u0026gt;%\rload_image() %\u0026gt;%\rconvolve(.x) %\u0026gt;%\radd_bias(.y) %\u0026gt;%\rrelu()\r})\rE como ser√° que ficam essas imagens? Abaixo, temos o resultado da aplica√ß√£o dos doze kernels. A maioria parece estar extraindo partes das letras. A s√©tima (posi√ß√£o (2,3)) parece estar pegando o ru√≠do e a quarta parece guardar a imagem original.\nO gif animado abaixo mostra a aplica√ß√£o do oitavo kernel da nossa lista. Com esse kernel d√° pra pegar bem o padr√£o das letras, n√£o √©?\nNo pr√≥ximo n√≠vel, vamos convoluir mais 48 kernels. Essa opera√ß√£o ser√° feita com todos os doze filtros atuais, ou seja, √© uma contaiada que n√£o acaba mais. Para simplificar as contas e para permitir a obten√ß√£o de padr√µes diferentes, faz sentido simplificar a imagem. Para isso, usamos o max pooling.\nAplicando max pooling\rO max pooling simplesmente pega o pixel de maior valor dentro de uma janela. No caso, estamos usando uma janela 2x2 e aplicamos ela igualzinho convolu√ß√£o, s√≥ que ao inv√©s de pegar a soma ponderada dos pixels, pegamos o pixel m√°ximo. Outra diferen√ßa √© que ao inv√©s de andar o pixel de 1 em 1, andamos de 2 em 2. Assim cada janelinha √© considerada apenas uma vez (esse √© o conceito de strides, que n√£o vou discutir aqui).\nMontei esse algoritmo que faz max pooling:\nmax_pool \u0026lt;- function(img) {\r# monta a matriz com metade da resolu√ß√£o\rx_new \u0026lt;- matrix(0.0, nrow = floor(nrow(img) / 2), ncol = floor(ncol(img) / 2))\r# adiciona uma bordinha para o caso da matriz ter um n√∫mero √≠mpar de pixels\r# por exemplo, se ela √© 51x181, daria bug se n√£o adicionar a bordinha\rimg \u0026lt;- cbind(rbind(img[,,1], 0), 0)\r# percorre a matrix pegando o m√°ximo das janelinhas\rfor (i in 1:nrow(x_new)) {\rfor (j in 1:ncol(x_new)) {\rx_new[i, j] \u0026lt;- max(img[i * 2 - 1 + 0:1, j * 2 - 1 + 0:1])\r}\r}\rarray(x_new, c(dim(x_new), 3))\r}\rA aplica√ß√£o da primeira convolu√ß√£o com max pooling √© feita igual anteriormente:\nresult_conv1 \u0026lt;- purrr::map2(w_list, bias, ~{\rarq %\u0026gt;%\rload_image() %\u0026gt;%\rconvolve(.x) %\u0026gt;%\radd_bias(.y) %\u0026gt;%\rrelu() %\u0026gt;%\rmax_pool()\r})\rNo final, temos essas imagens com resolu√ß√£o 25x90 (as originais s√£o 50x180).\nFicou bem parecido com o anterior!\nAo final da convolu√ß√£o, √© como se tiv√©ssemos uma nova imagem, menor e alterada, mas com 12 cores. Como n√£o faz muito sentido pensar em 12 cores prim√°rias, vamos cham√°-las de canais.\n\r\rSegunda convolu√ß√£o\rOs par√¢metros da segunda convolu√ß√£o s√£o obtidos novamente pelo keras. Sugiro que voc√™ d√™ uma olhada nesses √≠ndices para entender o que exatamente estamos pegando.\nw2 \u0026lt;- keras::get_weights(m$model$layers[[3]])[[1]]\rbias2 \u0026lt;- keras::get_weights(m$model$layers[[3]])[[2]]\rdim(w2)\r[1] 5 5 12 48\rAgora temos 12 * 48 kernels 5x5 a serem aplicados. Precisamos seguir essas opera√ß√µes:\nPara cada uma das 48 matrizes:\rFa√ßa a convolu√ß√£o das 12 matrizes obtidos na convolu√ß√£o anterior pelos 12 kernels atuais e some os valores obtidos.\rAdicione o bias.\rFa√ßa a ativa√ß√£o com ReLu.\rAplique o max pooling.\r\r\rLogo, temos 2 la√ßos. O c√≥digo para fazer isso fica assim:\nresult_conv2 \u0026lt;- purrr::map(1:dim(w2)[4], ~{\rkern \u0026lt;- w2[,,,.x] %\u0026gt;%\rplyr::alply(3, identity) %\u0026gt;%\rpurrr::map(as.matrix)\ractual_bias \u0026lt;- bias2[[.x]]\rpurrr::map2(result_conv1, kern, convolve) %\u0026gt;%\rpurrr::reduce(magrittr::add) %\u0026gt;%\radd_bias(actual_bias) %\u0026gt;%\rrelu() %\u0026gt;%\rmax_pool()\r})\rPlotamos os 48 resultados abaixo. Alguns resultados foram completamente zerados (eles devem ser √∫teis em outros captchas mais esquisitos), enquanto os demais pegam peda√ßos da imagem anterior que mal lembram o captcha original. A imagem da posi√ß√£o (4,1) √© uma das √∫nicas que mostra o captcha claramente. Isso mostra uma coisa comum do deep learning: quanto mais profundo vamos, menos entendemos o que de fato o modelo est√° fazendo. Recomendo fortemente a leitura desse blog do distill, que discute o assunto detalhadamente\nAgora temos 48 canais de uma imagem com dimens√µes 12x45. Vamos em frente.\n\rTerceira convolu√ß√£o\rA terceira convolu√ß√£o √© feita de forma id√™ntica √† segunda. A √∫nica diferen√ßa √© que teremos no final 96 canais, pois estamos ajustando essa quantidade de kernels para cada canal.\nw3 \u0026lt;- keras::get_weights(m$model$layers[[5]])[[1]]\rbias3 \u0026lt;- keras::get_weights(m$model$layers[[5]])[[2]]\rdim(w3)\r[1] 5 5 48 96\rRevisando o algoritmo:\nresult_conv3 \u0026lt;- purrr::map(1:dim(w3)[4], ~{\rkern \u0026lt;- w3[,,,.x] %\u0026gt;%\rplyr::alply(3, identity) %\u0026gt;%\rpurrr::map(as.matrix)\ractual_bias \u0026lt;- bias3[[.x]]\rpurrr::map2(result_conv2, kern, convolve) %\u0026gt;%\rpurrr::reduce(magrittr::add) %\u0026gt;%\radd_bias(actual_bias) %\u0026gt;%\rrelu() %\u0026gt;%\rmax_pool()\r})\rPlotando os resultados, temos\nNo final, ficamos com 96 imagens com resolu√ß√£o 6x22 cada. V√°rias imagens ficaram zeradas e as que n√£o ficaram parecem apenas feixes de luz no meio do breu. Pode ser que a posi√ß√£o dessas luzes tenha a ver com a posi√ß√£o de peda√ßos importantes do captcha original, que por sua vez seriam importantes para determinar o valor do captcha.\nVerificando se funcionou mesmo\rQuando eu montei o post, n√£o estava 100% seguro das contas que estava fazendo. Pode ser que tenha alguma coisa diferente dentro do keras, que √© um canh√£o que usa tensorflow por tr√°s, fazendo alguma otimiza√ß√£o esquisita. Por isso, tamb√©m aprendi a plotar os resultados parciais do modelo quebrador de captchas diretamente do keras.\nPodemos montar um modelo parcial do keras escolhendo qual o layer final do modelo.\nm2 \u0026lt;- keras::keras_model(\rinputs = m$model$input,\routputs = keras::get_layer(m$model, \u0026quot;max_pooling2d_6\u0026quot;)$output\r)\rm2\rModel\r____________________________________________________________________________________________________\rLayer (type) Output Shape Param #\r====================================================================================================\rconv2d_4_input (InputLayer) (None, 50, 180, 1) 0\r____________________________________________________________________________________________________\rconv2d_4 (Conv2D) (None, 50, 180, 12) 312\r____________________________________________________________________________________________________\rmax_pooling2d_4 (MaxPooling2D) (None, 25, 90, 12) 0\r____________________________________________________________________________________________________\rconv2d_5 (Conv2D) (None, 25, 90, 48) 14448\r____________________________________________________________________________________________________\rmax_pooling2d_5 (MaxPooling2D) (None, 12, 45, 48) 0\r____________________________________________________________________________________________________\rconv2d_6 (Conv2D) (None, 12, 45, 96) 115296\r____________________________________________________________________________________________________\rmax_pooling2d_6 (MaxPooling2D) (None, 6, 22, 96) 0\r====================================================================================================\rTotal params: 130,056\rTrainable params: 130,056\rNon-trainable params: 0\r____________________________________________________________________________________________________\rEsse modelo √© id√™ntico ao inicial, mas acaba no √∫ltimo max pooling. Para obter as imagens, utilizamos a fun√ß√£o predict a partir da base de dados X montada com o arq, utilizando a fun√ß√£o prepare do decryptr:\nX \u0026lt;- prepare(read_captcha(arq))$x\rres \u0026lt;- predict(m2, X)\rdim(res)\r[1] 1 6 22 96\rO resultado pode ser plotado da seguinte forma:\npar(mfrow = c(12, 8), mar = c(.1,.1,.1,.1))\rpurrr::walk(seq_len(dim(res)[4]), ~{\rarray(res[,,,.x], c(dim(res)[2:3], 3)) %\u0026gt;%\rimage_read() %\u0026gt;%\rplot()\r})\rUfa, ficou igualzinho!\nApenas um check final: quero ver se os pesos obtidos s√£o todos iguais. Para isso, ordeno todos os pesos obtidos diretamente pelo keras ou aplicando as minhas fun√ß√µes feitas no bra√ßo:\nw_calculado \u0026lt;- unlist(purrr::map(result_conv3, ~.x[,,1]))\rall.equal(sort(res), sort(w_calculado), tolerance = 1e-6)\r[1] TRUE\rUHUL!\n\rVisualizando na imagem original\rAqui fiz um esfor√ßo para tentar entender de qual parte da imagem original esses resultados est√£o pegando informa√ß√µes. Para isso, re-escalei essas imagens de resolu√ß√£o mais baixa na √∫ltima convolu√ß√£o para o tamanho original do captcha (50x180) e depois multipliquei os valores das matrizes pelos valores da imagem original.\nO resultado foi esse gif. Cada imagem √© um dos canais obtidos.\nParece que os filtros s√£o capazes de pegar as curvas que as letras fazem no captcha. Mas n√£o tenho opini√£o formada sobre isso. Digam a√≠ nos coment√°rios o que voc√™s acham!\n\r\r\rPassos finais\rPara acabar a predi√ß√£o do captcha, n√≥s pegamos os resultados das imagens anteriores e juntamos todos os pixels num vetorz√£o que junta tudo. Em estatistiqu√™s, esse vetor nada mais √© do que uma linha de um data.frame, que podemos usar numa regress√£o log√≠stica, por exemplo. Ou seja, essas convolucionais funcionam como um grande gerador autom√°tico de features importantes para prever os resultados do captcha. A vantagem √© que essas features s√£o obtidas de forma autom√°tica e s√£o otimizadas dentro do processo de estima√ß√£o. Por essas e outras que deep learning √© realmente sensacional!\nComo j√° estamos no framework do keras, acabamos fazendo tudo l√° dentro. Ap√≥s jogar tudo no vetorz√£o, aplicamos mais dois layers de redes neurais comuns, que funcionam como a regress√£o log√≠stica. O √∫nico detalhe sens√≠vel √© que, como estamos prevendo 6 letras ao mesmo tempo, precisamos novamente transformar esse vetor em uma matriz 35x6, sendo 35 o total de letras poss√≠veis por posi√ß√£o e 6 a quantidade de posi√ß√µes.\nAbaixo, montei uma tabelinha com as probabilidades de cada letra nas posi√ß√µes correspondentes. Substitu√≠ valores muito pequenos por . para ver melhor.\nres2 \u0026lt;- keras::predict_proba(m$model, X)\rprobabilidades \u0026lt;- res2[1,,] %\u0026gt;%\rtibble::as_tibble() %\u0026gt;%\rpurrr::set_names(m$labs) %\u0026gt;%\rtidyr::gather(letra, prob) %\u0026gt;%\rdplyr::group_by(letra) %\u0026gt;%\rdplyr::mutate(pos = 1:n()) %\u0026gt;%\rdplyr::ungroup() %\u0026gt;%\rdplyr::mutate(prob = dplyr::if_else(prob \u0026lt; 5e-5, \u0026quot;.\u0026quot;, as.character(round(prob, 6))) ) %\u0026gt;%\rtidyr::spread(pos, prob, sep = \u0026quot;\u0026quot;)\rFicamos ent√£o com ‚Äúo‚Äù na primeira posi√ß√£o, ‚Äúg‚Äù na segunda posi√ß√£o, ‚Äú7‚Äù na terceira posi√ß√£o, ‚Äúv‚Äù na quarta posi√ß√£o, ‚Äú5‚Äù na quinta posi√ß√£o e ‚Äúq‚Äù na sexta posi√ß√£o. Ou seja, ‚Äúog7v5q‚Äù.\nVamos ver a imagem novamente:\narq %\u0026gt;%\rread_captcha() %\u0026gt;%\rpurrr::pluck(1) %\u0026gt;%\rplot()\rParece que funcionou!\n\rWrap-up\rEssa jornada foi longa, mas acho que aprendemos bastante coisa. Resumindo:\n\rConvolu√ß√µes s√£o somas ponderadas dos valores da vizinhan√ßa de um pixel. Esses pesos s√£o dados por uma matriz chamada kernel.\rAplicar redes neurais convolucionais consiste em i) aplicar convolu√ß√£o; ii) adicionar um bias; iii) aplicar uma fun√ß√£o n√£o linear (geralmente ReLu).\rmax pooling serve para simplificar a resolu√ß√£o da imagem.\rNa pr√°tica, aplicamos v√°rios kernels. O n√∫mero de kernels de uma convolucional igual ao n√∫mero de canais da opera√ß√£o anterior (input), multiplicado pelo n√∫mero de canais que queremos de output.\rPara a convolu√ß√£o inicial, os canais s√£o as cores: partimos de 1 canal se a imagem for preto e branco ou 3 canais se for colorida.\rNo nosso caso, aplicamos tr√™s convolucionais com kernels 5x5, sendo 1*12 no primeiro n√≠vel, 12*48 no segundo n√≠vel e 48*96 no terceiro n√≠vel.\rDepois, pegamos as imagens resultantes e aplicamos o flatten, para trabalhar com esses n√∫meros como se fossem a matriz X de uma regress√£o log√≠stica usual.\rComo vimos, √© poss√≠vel implementar todas essas opera√ß√µes na m√£o sem muita dificuldade.\r\rConseguimos! Mas resta uma d√∫vida‚Ä¶\nComo √© que, de fato, conseguimos esses valores m√°gicos de \\(W\\)? Na pr√≥xima vez provavelmente resolverei esse problema, mostrando como se faz o back-propagation em um modelo de deep learning.\n√â isso. Happy coding :)\n\r","permalink":"https://blog.curso-r.com/posts/2017-11-10-captcha-conv/","tags":["captcha"],"title":"Quebrando Captchas - Parte V: Fazendo redes convolucionais na m√£o"},{"author":["William"],"categories":["discuss√µes"],"contents":"\rVolta e meia eu escuto as famosas frases\npaste(\u0026quot;Eu sou de\u0026quot;, c(\u0026quot;Humanas\u0026quot;, \u0026quot;Exatas\u0026quot;, \u0026quot;Biol√≥gicas\u0026quot;))\r## [1] \u0026quot;Eu sou de Humanas\u0026quot; \u0026quot;Eu sou de Exatas\u0026quot; \u0026quot;Eu sou de Biol√≥gicas\u0026quot;\rde algu√©m tentando justificar por que n√£o vai fazer alguma coisa.\nMuitas vezes, n√£o passa de uma brincadeira na hora de dividir a conta do bar. Muitas outras, me soa como uma desculpa pronta para n√£o encarar problemas complicados. Para mim, todo aprendizado √© dif√≠cil, n√£o acho que existe conhecimento de gra√ßa, ent√£o realmente importa se ele √© de Humanas, Exatas ou Biol√≥gicas?\nA divis√£o do conhecimento nessas tr√™s grandes √°reas tem a sua import√¢ncia organizacional, mas acaba motivando muita gente a criar limita√ß√µes que n√£o existem de verdade. Por que algu√©m de Exatas n√£o conseguiria assimilar as ideias de um texto filos√≥fico? Ou por que algu√©m de Biol√≥gicas n√£o conseguiria aprender C√°lculo?\nAcredito que cada um de n√≥s tem afinidade por uma das √°reas e maior facilidade em estudar um t√≥pico ou outro. Normal. Mas fico triste quando vejo pessoas inteligentes se diminuindo ao se declararem incapazes de aprender outras compet√™ncias que n√£o a delas. Sei que essa incapacidade n√£o existe e enxergo apenas como uma forma sofisticada de dizer ‚ÄúEstou com pregui√ßa‚Äù.\nUma das belezas da Estat√≠stica √© nos fazer perder esse preconceito. Por mais que tenhamos nossos gostos, descobrimos que n√£o estamos presos ao dom√≠nio de apenas uma √°rea. N√≥s trabalhamos com pessoas que pensam e aprendem de formas diferentes de nossa e constru√≠mos juntos pontes para trocarmos conhecimento. Ser estat√≠stico √© n√£o ter medo de estudar, seja l√° o que for.\nTrazendo a reflex√£o aqui para o nosso mundinho, j√° ouvi muitas vezes colegas dizendo, principalmente na Gradua√ß√£o, que n√£o usam o R porque ele √© dif√≠cil ou porque n√£o gostam de programar. A minha opini√£o sobre a primeira desculpa est√° nos par√°grafos acima. Sobre a segunda, vou discutir no pr√≥ximo e √∫ltimo post desta s√©rie: a rela√ß√£o entre Estat√≠stica e programa√ß√£o.\nResumindo a √≥pera: sempre vamos apanhar aprendendo, e vamos apanhar mais ainda quando n√£o gostamos do que estamos estudando, mas cedo ou tarde, com a quantidade certa de esfor√ßo, o conhecimento d√° as caras.\nE no bar, na hora de dividir a conta, o problema n√£o √© voc√™ ser de Humanas. O problema √© a sua pregui√ßa. :D\n","permalink":"https://blog.curso-r.com/posts/2017-11-11-preconceitos-no-aprendizado/","tags":["estat√≠stica"],"title":"Aprendendo assuntos dif√≠ceis"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\r\r\rPara quem est√° esperando posts sobre captchas, esperem mais um pouquinho. Em novembro voltarei a postar sobre esse assunto.\n\rEm setembro de 2017, participei do 16th Symposium on Computer Music, organizado pelo prof. Marcelo Queiroz do IME-USP. O evento foi muito legal! Estou estudando m√∫sica nos √∫ltimos meses e acho que farei meu doutorado em solu√ß√µes que ligam estat√≠stica e m√∫sica. √â uma √°rea realmente apaixonante.\nUma das formas que usarei para aprender os m√©todos e estudar os conceitos ser√° esse blog! Assim voc√™s poder√£o acompanhar meus avan√ßos e propor ideias para colaborar com meus trabalhos. Pretendo desenvolver tanto modelos estat√≠sticos e programa√ß√£o quanto teoria musical.\nAt√© o momento, tenho tr√™s posts planejados ou prontos:\n\rpacote music21: esse post! Veja abaixo.\rpacote chordgen: pacote que criei para gerar sequ√™ncias aleat√≥rias de acordes com o R\rartigo deepbach: um modelo de redes neurais capaz de imitar corais de Bach.\r\rComputa√ß√£o musical numa casca de noz\rApesar da minha falta de conhecimento sobre o tema, acredito que a √°rea de computa√ß√£o musical pode ser resumida em tr√™s frentes:\nLeitura: extrair dados estruturados dos √°udios. Envolve Music Information Retrieval - MIR\nComposi√ß√£o: Criar ou completar m√∫sicas automaticamente\nEdi√ß√£o: Adicionar efeitos na m√∫sica para produ√ß√£o\nMeu foco ser√° na parte de composi√ß√£o, com foco em harmoniza√ß√£o, que significa criar e completar harmonias das m√∫sicas dado algum estilo (e.g.¬†Bach ou Beatles). Tamb√©m tentarei criar solu√ß√µes de improviso, apesar de n√£o garantir nada.\n\rmusic21\rO objetivo do pacote music21 √© funcionar como um port pipe√°vel (%\u0026gt;%-able) da biblioteca music21, em python. Ele usa o excelente pacote reticulate do RStudio como backend.\nAtualmente, o music21 √© mais limitado que a bibloteca em python. No entanto, gra√ßas ao reticulate √© f√°cil rodar qualquer fun√ß√£o do music21 no R.\nInstala√ß√£o\rComo o music21 utiliza bibliotecas python, √© necess√°rio instalar algumas depend√™ncias antes. No Ubuntu, basta rodar\nsudo apt-get install python-pip\rsudo pip install pip --upgrade\rsudo pip install music21\rEm outros sistemas opetacionais, veja a documenta√ß√£o oficial da biblioteca.\nEu tenho o p√©ssimo h√°bito de n√£o subir meus pacotes para o CRAN. Mas prometo que esse vou subir e manter. Por enquanto, para instalar o pacote music21 √© necess√°rio rodar\ndevtools::install_github(\u0026quot;jtrecenti/music21\u0026quot;)\rVoc√™ pode carregar o pacote rodando\nlibrary(music21)\rPara usar a fun√ß√£o de plotar uma partitura, voc√™ tamb√©m precisara do lilypond:\nsudo apt-get install lilypond\r\rO objeto music21\rlibrary(music21)\rmusic21\rO objeto music21 √© um m√≥dulo do python. Com ele √© poss√≠vel rodar qualquer fun√ß√£o do pacote usando $, tratando o objeto como uma Reference Class.\nnote \u0026lt;- music21$note$Note(\u0026quot;C#\u0026quot;)\rnote\rnote %\u0026gt;% plot()\r\rExemplo\rCorais do Bach\rget_composer(\u0026quot;bach\u0026quot;) %\u0026gt;% head()\rVamos pegar uma delas e guardar numa vari√°vel\nbach_music \u0026lt;- get_composer(\u0026quot;bach\u0026quot;)[61] %\u0026gt;% read_music()\r\rPlotando a m√∫sica bwv165.6\rBasta rodar plot()!!\nbach_music %\u0026gt;% plot()\rNo RStudio, voc√™ pode usar a fun√ß√£o view() para visualizar a m√∫sica em melhor resolu√ß√£o no Viewer Pane.\n\rImprimindo bwv165.6 (s√≥ o soprano)\rPara visualizar as notas de uma m√∫sica basta rodar o objeto no console. A m√∫sica √© organizada por Measures (compassos) e cada compasso vai mostrar seus componentes. No primeiro compasso, podemos ver a clave de sol (TrebleClef), as defini√ß√µes do tom (sol maior) e do tempo (4/4). Nos demais, observamos as notas e os temos associados a cada nota. Por exemplo, temos uma nota F# no primeiro tempo.\nbach_music[[1]]\rVoc√™ pode tratar esse objeto como uma lista. Se voc√™ entrar numa nota, voc√™ poder√° ver algumas caracter√≠sticas dela\n# Nota F#\rbach_music[[1]][[2]][[3]]\r# dura√ß√£o da nota\rbach_music[[1]][[2]][[3]]$duration\r# som exato\rbach_music[[1]][[2]][[3]]$pitch\rPor enquanto vou acabar por aqui. Convido voc√™s a usarem o music21 e experimentar suas funcionalidades. Adicionem issues em https://github.com/jtrecenti/music21/issues e mandem pergundas nos coment√°rios.\n√â isso! Happy coding ;)\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-11-03-music01/","tags":["m√∫sica"],"title":"Estat√≠stica e M√∫sica"},{"author":["Daniel"],"categories":["conceitos"],"contents":"\rO que teste t-pareado, modelos mistos e tidy data podem ter a ver? Veja neste post como a estrutura dos seus dados pode afetar a forma que voc√™ far√° a sua an√°lise.\nPara come√ßar, vamos relemebrar o que √© tidy data para depois seguir ao ponto do post.\nTidy Data\rTidy data √© um conceito introduzido pelo Hadley Wickham neste paper.\nEsse paper √©, para mim, o melhor artigo do Hadley. A primeira frase da defini√ß√£o cita Tolst√≥i e diz:\n\rLike families, tidy datasets are all alike but every messy dataset is messy in its own way.\n\rEssa frase resume a vida de qualquer um que trabalha ou j√° trabalhou com an√°lise de dados. O ponto mais importante do que significa tidy data tamb√©m est√° neste primeiro par√°grafo: s√£o datasets em que a estrutura dos dados est√° ligada padronizadamente com o seu significado. A forma padronizada √©:\nCada vari√°vel √© uma coluna de uma tabela\rCada observa√ß√£o √© uma linha de uma tabela\rCada tipo de unidade observacional forma uma tabela\r\rO exemplo c√°ssico √© o seguinte. Primeiro vamos ver um banco de dados desarrumado.\n\r\rPais\rIdh2015\rIdh2014\r\r\r\rBrasil\r0.754\r0.755\r\rArgentina\r0.827\r0.836\r\rChile\r0.847\r0.832\r\r\r\rEsse dataset est√° desarrumado pois existem duas colunas Idh2015 e Idh2014 que representam a mesma vari√°vel: IDH e uma vari√°vel impl√≠cita ANO, que tamb√©m aparece nesta duas colunas. A forma tidy de representar este dataset seria:\n\r\rPais\rano\ridh\r\r\r\rBrasil\r2015\r0.754\r\rArgentina\r2015\r0.827\r\rChile\r2015\r0.847\r\rBrasil\r2014\r0.755\r\rArgentina\r2014\r0.836\r\rChile\r2014\r0.832\r\r\r\rO que isso tem a ver com ‚Ä¶\r‚Ä¶ teste t-pareado ou com modelos mistos?\nSuponha que queremos inferir se houve alguma mudan√ßa na m√©dia do IDH de um ano para o outro.\rOu seja testar se a m√©dia do IDH de 2015 √© diferente da m√©dia do IDH de 2014.\rVamos considerar um banco de dados simulado:\nset.seed(10201)\rlibrary(tidyverse)\rdf \u0026lt;- data_frame(\rPais = paste0(\u0026quot;pais\u0026quot;, 1:50),\rIdh2014 = runif(50),\rIdh2015 = Idh2014 + rnorm(50, mean = 0.1, sd = 0.025)\r)\rUma forma de fazer isso √© usar o teste t pareado que √© ensinado nos cursos introdut√≥rios de estat√≠stica. Basicamente o que ele faz √© testar se a m√©dia da diferen√ßa entre o IDH2015 e o IDH 2014 √© diferente de zero. Isso √© diferente de um teste T usual, pois o teste t pareado ajusta o seu c√°lculo da vari√¢ncia para considerar que existem duas fontes de incerteza.\nNo R a forma mais natural de fazer isso √©:\nteste \u0026lt;- t.test(df$Idh2015, df$Idh2014, paired=TRUE)\rNote que o nosso banco de dados est√° desarrumado e mesmo assim foi muito simples fazer\resse teste no R. Agora vamos arrumar o banco de dados.\ndf \u0026lt;- df %\u0026gt;%\rgather(ano, idh, -Pais) %\u0026gt;%\rmutate(ano = parse_number(ano))\rAgora para fazer o mesmo teste, poder√≠amos filtrar o banco de dados duas vezes, por exemplo:\nt.test(df$idh[df$ano == 2015], df$idh[df$ano == 2014], paired = TRUE)\rPaired t-test\rdata: df$idh[df$ano == 2015] and df$idh[df$ano == 2014]\rt = 27.355, df = 49, p-value \u0026lt; 2.2e-16\ralternative hypothesis: true mean difference is not equal to 0\r95 percent confidence interval:\r0.09000554 0.10427822\rsample estimates:\rmean difference 0.09714188 \rMas a√≠ estamos voltando para a forma desarrumada para fazer o teste.\rOutra forma de fazer √© considerar essa compara√ß√£o de m√©dias como um problema de regress√£o em que a suposi√ß√£o independ√™ncia das observa√ß√µes n√£o √© v√°lida, uma vez que dado um pais, com certeza existe rela√ß√£o entre o idh de 2014 e de 2015.\nVamos ajustar um modelo com efeitos aleat√≥rios para esse problema e comparar os resultados.\nlibrary(nlme)\rmodel \u0026lt;- lme(idh ~ as.factor(ano), random = ~1|Pais, data = df)\rsummary(model)\rLinear mixed-effects model fit by REML\rData: df AIC BIC logLik\r-184.7518 -174.4119 96.37588\rRandom effects:\rFormula: ~1 | Pais\r(Intercept) Residual\rStdDev: 0.3009017 0.01775584\rFixed effects: idh ~ as.factor(ano) Value Std.Error DF t-value p-value\r(Intercept) 0.4840132 0.04262795 49 11.35436 0\ras.factor(ano)2015 0.0971419 0.00355117 49 27.35491 0\rCorrelation: (Intr)\ras.factor(ano)2015 -0.042\rStandardized Within-Group Residuals:\rMin Q1 Med Q3 Max -1.88877771 -0.44544521 -0.01239249 0.39934207 1.84475543 Number of Observations: 100\rNumber of Groups: 50 \rEstamos interessados em comparar a signific√¢ncia do efeito fixo da vari√°vel ano nesse\rmodelo com a do teste t-pareado. Veja que no caso a estat√≠stica T do testes √© id√™ntica: 27.35.\nVimos que a forma como os dados est√£o estruturados no seu banco de dados pode influenciar\ra t√©cnica utilizada para a sua an√°lise. Se ele estivesse na forma desarrumada o mais natural\rseria aplicar um teste t pareado, se ele estivesse em formado tidy o natural seria usar um\rmodelo misto. No seu paper, Hadley argumenta que a maioria dos\rsoftwares esperam que o seu banco de dados esteja arrumado no sentido de que\rcada vari√°vel √© uma coluna e cada observa√ß√£o √© uma linha.\n\r\r","permalink":"https://blog.curso-r.com/posts/2017-10-27-tidy-data-mixed-models/","tags":["estat√≠stica","tidy"],"title":"Tidy Data, Teste T Pareado e Modelos Mistos"},{"author":["Daniel"],"categories":["Tutoriais"],"contents":"\r\rNas √∫ltimas semanas sumimos um pouco aqui do blog, pois est√°vamos ocupados na\raMostra de Estat√≠stica no IME-USP.\nO evento teve a organiza√ß√£o impec√°vel gra√ßas aos alunos do bacharelado em estat√≠stica\rLucas Hamaguchi, Beatriz Vianna, Gabriela Uhrigshardt, Milene Farhat, Lu√≠za Baratojo,\rRodrigo Marcel Araujo Oliveira e do Prof.¬†Victor Fossaluza. Parabens a todos!\nA Curso-R participou do evento ministrando 3 oficinas abordando t√≥picos bem\rdistintos sobre programa√ß√£o em R. Gra√ßas √† fant√°stica organiza√ß√£o, todas as\rpalestras foram gravadas e agora podem ser revistas pelo YouTube da aMostra.\nNo dia 02/10, o Fernando ministrou a oficina WebScraping e Conex√µes!\rVeja o v√≠deo neste link.\nNo dia 04/10 foi a vez do Julio ministrar a oficina sobre API‚Äôs no R.\rO v√≠deo est√° dispon√≠vel neste link.\nNo dia 05/10 o AThos e eu ministramos a oficina de Introdu√ß√£o ao Machine Learning.\rVeja o v√≠deo neste link.\nClaro que n√£o fomos os √∫nicos palestrantes e tem muita gente boa que participou\rda aMostra. Vale muito a pena ver os demais v√≠deos do canal da aMostra.\nAproveitem!\n","permalink":"https://blog.curso-r.com/posts/2017-10-19-cursor-amostra/","tags":["curso-r"],"title":"Curso-R na aMostra de Estat√≠stica 2017"},{"author":["Daniel"],"categories":["Tutoriais"],"contents":"\r\rFiltro de Bloom √© um algoritmo muito\rinteressante para testar se um elemento pertence a um conjunto. Ele √© considerado\ruma estrutura de dados probabil√≠stica, ou seja, o resultado pode n√£o estar correto\rcom alguma probabilidade. Especificamente para o filtro de bloom, existe a possibilidade\rde falsos positivos mas n√£o de falsos negativos: o algoritmo pode dizer que o elemento\rpertence ao conjunto, mas na verdade n√£o pertencer, mas nunca dir√° que ele n√£o pertence\rsendo que ele pertence.\nBloom Filters s√£o √∫teis em diversas situa√ß√µes, geralmente relacionadas ao ganho\rde velocidade e de espa√ßo que o seu uso pode trazer. Muitos sistemas de bancos de\rdados usam bloom filters para reduzir o n√∫mero de buscas no disco (ex. Cassandra). O Medium usa para evitar recomendar uma pa«µina que voc√™ j√° leu.\rRecentemente, encontraram at√© aplica√ß√µes para bloom filters em machine learning.\nNesse post vamos implementar uma vers√£o simplificada, nada otimizada dos filtros de\rBloom em R. Mas antes disso, vale a pena ler o verbete da Wikipedia sobre o assunto.\nEssencialmente, um filtro de bloom √© um vetor de TRUEs e FALSES de tamanho \\(m\\).\rInicializamos esse vetor com FALSES. Em seguida para cada elemento do conjunto\rque voc√™ deseja representar pelo filtro, repetimos o seguinte processo: Hasheamos\ro elemento usando \\(k\\) fun√ß√µes de hash diferentes. Cada uma dessas fun√ß√µes indicar√°\rum elemento do vetor que deve ser marcado como TRUE. Armazenamos ent√£o esse vetor\rde bits. S√£o os valores de \\(m\\) e de \\(k\\) que controlam a probabilidade de falsos\rpositivos.\nVeja como podemos criar uma fun√ß√£o em R para fazer essas opera√ß√µes. Essa fun√ß√£o\rinicializa o vetor de bits de tamanho \\(m\\) com FALSES e em seguida, para cada\ruma das \\(k\\) fun√ß√µes de hash (no caso apenas variamos a semente do hash MurMur32)\re para cada elemento de x calculamos o elemento do vetor vec que deve se tornar\rTRUE. No final, ela retorna o vetor vec, onde armazenamos como atributos\ros par√¢metros usados na sua constru√ß√£o.\nlibrary(digest)\rlibrary(magrittr)\rcriar_vetor_de_bits \u0026lt;- function(x, m = 1000, k = 7){\rvec \u0026lt;- rep(FALSE, m)\rfor (i in 1:k) {\rfor (j in 1:length(x)) {\rhash \u0026lt;- digest(x[j], algo = \u0026quot;murmur32\u0026quot;, serialize = FALSE, seed = i) %\u0026gt;%\rRmpfr::mpfr(base = 16) %% m %\u0026gt;% as.integer()\rvec[hash + 1] \u0026lt;- TRUE\r}\r}\r# armazenamos os par√¢metros usados na constru√ß√£o\rattributes(vec) \u0026lt;- list(m = m, k= k)\rreturn(vec)\r}\rDado um conjunto de strings, podemos criar o vetor de bits que o representa.\nvect \u0026lt;- criar_vetor_de_bits(c(\u0026quot;eu\u0026quot;, \u0026quot;pertenco\u0026quot;, \u0026quot;ao\u0026quot;, \u0026quot;conjunto\u0026quot;, \u0026quot;de\u0026quot;,\r\u0026quot;strings\u0026quot;), m = 1000, k = 7)\rAgora vamos definir uma fun√ß√£o que verifica se uma string pertence ao conjunto, dada\rapenas a representa√ß√£o dos bits desse conjunto. Hasheamos o elemento que desejamos\rverificar a presen√ßa no conjunto com a primeira fun√ß√£o de hash. Se ela indicar um\relemento do vetor que j√° est√° marcado com TRUE ent√£o continuamos, se n√£o, retorna\rFALSE indicando que o elemento n√£o pertence ao conjunto. Continuamos at√© acabarem\ras fun√ß√µes de hash ou at√© 1 FALSE ter sido retornado.\nverificar_presenca \u0026lt;- function(x, vetor_de_bits){\rk \u0026lt;- attr(vetor_de_bits, \u0026quot;k\u0026quot;)\rm \u0026lt;- attr(vetor_de_bits, \u0026quot;m\u0026quot;)\rfor(i in 1:k){\rhash \u0026lt;- digest(x, algo = \u0026quot;murmur32\u0026quot;, serialize = FALSE, seed = i) %\u0026gt;%\rRmpfr::mpfr(base = 16) %% m %\u0026gt;% as.integer()\rif(!vetor_de_bits[hash + 1]) {\rreturn(FALSE)\r}\r}\rreturn(TRUE)\r}\rverificar_presenca(\u0026quot;nao\u0026quot;, vect)\rverificar_presenca(\u0026quot;eu\u0026quot;, vect)\rverificar_presenca(\u0026quot;abc\u0026quot;, vect)\rCom m = 1000 e k = 7 n√£o consegui encontrar nenhum falso positivo, mas basta\rdiminuir o tamanho de m e de k que encontraremos. No verbete da Wikipedia a\rconta est√° bonitinha mas de fato a probabilidade de falsos positivos pode ser estimada\rem fun√ß√£o dos par√¢metros \\(k\\) e \\(m\\) e \\(n\\) (tamanho do conjunto representado) √© dada por\n\\[(1 - e^{-kn/m})^k\\]\nNo caso apresentado, a probabilidade de colis√£o √© de 1.991256e-10.\n","permalink":"https://blog.curso-r.com/posts/2017-09-18-bloom-filter/","tags":["algoritmos"],"title":"Filtros de Bloom em R"},{"author":["Fernando"],"categories":["Tutoriais"],"contents":"\r\r\rEm maio deste ano, escrevi um post sobre web scraping dos dados da secretaria de seguran√ßa p√∫blica de S√£o Paulo. Como o t√≠tulo indica, o foco do texto √© mostrar como se raspa a p√°gina de estat√≠sticas da SSP, mas, mais do que isso, o texto tamb√©m sugere um roteiro de constru√ß√£o de web scrapers.\nNeste post, venho divulgar uma expans√£o do conte√∫do do post passado. Agora √© poss√≠vel acessar os dados da SSP diretamente no R usando o pacote brcrimR, mas a ideia √© que no futuro todas as informa√ß√µes divulgadas por alguma Secretaria de Seguran√ßa fiquem dispon√≠veis diretamente no R!\ndevtools::install_github(\u0026quot;abjur/brcrimR\u0026quot;)\rO brmcrimR se prop√µe a resolver tr√™s problemas:\nObter informa√ß√µes criminais brasileiras diretamente no R - Muitas an√°lises interessantes seriam viabilizadas se fosse f√°cil e r√°pido carregar informa√ß√µes criminais hist√≥ricas num data_frame. Fazer isso √© a motiva√ß√£o principal do brmcrimR.\rConsolidar tabelas em bases hist√≥ricas - Assim como em S√£o Paulo, muitas Secretarias de Seguran√ßa disponibilizam as informa√ß√µes filtradas por m√™s ou localidade. A segunda motiva√ß√£o principal do brcrimR √© iterar por essas p√°ginas.\rPadroniza√ß√£o - O objetivo menos direto do brcrimR √© padronizar as informa√ß√µes disponibilizadas. Esse n√£o √© um problema simplesmente computacional, mas algumas rotinas de pr√©-processamento podem ajudar no processo.\r\rPara ilustrar o funcionamento do brcrimR, vamos olhar o que j√° est√° implementado em S√£o Paulo.\nInforma√ß√µes agregadas\rAs tabelas de informa√ß√µes agregadas podem ser obtidas seguindo os passos que descrevi aqui, mas a fun√ß√£o brmcrimR::get_summarized_table_sp faz todo o trabalho por n√≥s.\nbrcrimR::get_summarized_table_sp(year = \u0026#39;2016\u0026#39;, city = \u0026#39;1\u0026#39;) %\u0026gt;% knitr::kable(caption = \u0026quot;Contagem de boletins de ocorr√™ncia na cidade de Amparo.\u0026quot;) %\u0026gt;% kableExtra::kable_styling(font_size = 8)\rTabela 1: Contagem de boletins de ocorr√™ncia na cidade de Amparo.\r\r\r\rNatureza\r\rJan\r\rFev\r\rMar\r\rAbr\r\rMai\r\rJun\r\rJul\r\rAgo\r\rSet\r\rOut\r\rNov\r\rDez\r\rTotal\r\rmunicipio\r\rano\r\r\r\r\r\rHOMIC√çDIO DOLOSO (2)\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r0\r\r0\r\r1\r\r1\r\r2016\r\r\r\rN¬∫ DE V√çTIMAS EM HOMIC√çDIO DOLOSO (3)\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r0\r\r0\r\r1\r\r1\r\r2016\r\r\r\rHOMIC√çDIO DOLOSO POR ACIDENTE DE TR√ÇNSITO\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rN¬∫ DE V√çTIMAS EM HOMIC√çDIO DOLOSO POR ACIDENTE DE TR√ÇNSITO\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rHOMIC√çDIO CULPOSO POR ACIDENTE DE TR√ÇNSITO\r\r0\r\r0\r\r0\r\r1\r\r0\r\r0\r\r1\r\r0\r\r0\r\r0\r\r0\r\r0\r\r2\r\r1\r\r2016\r\r\r\rHOMIC√çDIO CULPOSO OUTROS\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rTENTATIVA DE HOMIC√çDIO\r\r0\r\r0\r\r1\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r0\r\r3\r\r5\r\r1\r\r2016\r\r\r\rLES√ÉO CORPORAL SEGUIDA DE MORTE\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rLES√ÉO CORPORAL DOLOSA\r\r4\r\r19\r\r13\r\r13\r\r12\r\r15\r\r15\r\r8\r\r16\r\r23\r\r23\r\r10\r\r171\r\r1\r\r2016\r\r\r\rLES√ÉO CORPORAL CULPOSA POR ACIDENTE DE TR√ÇNSITO\r\r10\r\r18\r\r21\r\r22\r\r13\r\r15\r\r18\r\r10\r\r17\r\r15\r\r15\r\r17\r\r191\r\r1\r\r2016\r\r\r\rLES√ÉO CORPORAL CULPOSA - OUTRAS\r\r1\r\r1\r\r2\r\r1\r\r0\r\r3\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r9\r\r1\r\r2016\r\r\r\rLATROC√çNIO\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rN¬∫ DE V√çTIMAS EM LATROC√çNIO\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rTOTAL DE ESTUPRO (4)\r\r2\r\r0\r\r0\r\r1\r\r0\r\r1\r\r0\r\r1\r\r0\r\r1\r\r0\r\r0\r\r6\r\r1\r\r2016\r\r\r\rESTUPRO DE VULNER√ÅVEL\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r0\r\r0\r\r1\r\r1\r\r2016\r\r\r\rTOTAL DE ROUBO - OUTROS (1)\r\r1\r\r0\r\r0\r\r0\r\r1\r\r0\r\r0\r\r1\r\r0\r\r0\r\r0\r\r1\r\r4\r\r1\r\r2016\r\r\r\rROUBO DE VE√çCULO\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rROUBO A BANCO\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rROUBO DE CARGA\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r0\r\r1\r\r2016\r\r\r\rFURTO - OUTROS\r\r17\r\r19\r\r20\r\r22\r\r13\r\r11\r\r11\r\r12\r\r23\r\r27\r\r17\r\r30\r\r222\r\r1\r\r2016\r\r\r\rFURTO DE VE√çCULO\r\r0\r\r1\r\r1\r\r1\r\r5\r\r1\r\r2\r\r1\r\r0\r\r1\r\r2\r\r1\r\r16\r\r1\r\r2016\r\r\r\r\rPara obter os dados hist√≥ricos, basta usar a fun√ß√£o brcrimR::get_historical_summarized_table_sp. Ela funciona da mesma maneira que brcrimR::get_summarized_table_sp, mas pode receber vetores como input. Nesse caso, ela organiza os par√¢metros num grid e retorna uma tabela com todas as requisi√ß√µes empilhadas.\nbrcrimR::get_historical_summarized_table_sp(\ry = c(\u0026#39;2016\u0026#39;, \u0026#39;2017\u0026#39;), c = \u0026#39;1\u0026#39;, ty = \u0026#39;ctl00$conteudo$btnMensal\u0026#39;) %\u0026gt;% filter(Natureza == \u0026quot;LES√ÉO CORPORAL CULPOSA POR ACIDENTE DE TR√ÇNSITO\u0026quot;) %\u0026gt;% set_names(c(\u0026#39;Natureza\u0026#39;, 1:12, \u0026quot;Total\u0026quot;, \u0026quot;municipio\u0026quot;, \u0026quot;ano\u0026quot;)) %\u0026gt;% gather(mes, valor, -municipio, -ano, -Natureza, -Total) %\u0026gt;% filter(!is.na(valor)) %\u0026gt;% mutate(data_bo = lubridate::dmy(paste(\u0026quot;01\u0026quot;, mes, ano, sep = \u0026quot;-\u0026quot;))) %\u0026gt;% ggplot(aes(x = data_bo, y = valor)) +\rgeom_bar(stat = \u0026#39;identity\u0026#39;, fill = \u0026#39;royalblue\u0026#39;) +\rtheme_minimal(15) +\rlabs(x = \u0026#39;M√™s\u0026#39;, y = \u0026quot;N√∫mero de BO\u0026#39;s\u0026quot;)\r\rInforma√ß√µes desagregadas\rAl√©m dos dados agregados, a partir do ano passado a SSP de S√£o Paulo tamb√©m passou a divulgar informa√ß√µes detalhadas sobre os BO‚Äôs da capital no portal da traspar√™ncia. O Jos√© de Jesus come√ßou o scraping desses conte√∫dos e eu s√≥ encapsulei tudo dentro de um pacote. Vejam s√≥:\nbrcrimR::get_detailed_table_sp(folder = \u0026#39;btnHomicicio\u0026#39;, year = \u0026#39;2017\u0026#39;, month = \u0026#39;1\u0026#39;, department = \u0026#39;0\u0026#39;) %\u0026gt;%\rselect(NUM_BO, BO_INICIADO, DATAOCORRENCIA, BO_AUTORIA, FLAGRANTE, LATITUDE, LONGITUDE) %\u0026gt;% distinct(NUM_BO, .keep_all = T) %\u0026gt;% head(10) %\u0026gt;% knitr::kable(caption = \u0026quot;Algumas colunas de dez BO\u0026#39;s da tabela de boletins de ocorr√™ncia de homic√≠dio de janeiro de 2017.\u0026quot;) %\u0026gt;% kableExtra::kable_styling(font_size = 8)\rTabela 2: Algumas colunas de dez BO‚Äôs da tabela de boletins de ocorr√™ncia de homic√≠dio de janeiro de 2017.\r\r\r\rNUM_BO\r\rBO_INICIADO\r\rDATAOCORRENCIA\r\rBO_AUTORIA\r\rFLAGRANTE\r\rLATITUDE\r\rLONGITUDE\r\r\r\r\r\r11589\r\r31/12/2016 22:02:52\r\r31/12/2016\r\rConhecida\r\rN√£o\r\r-23,6027829499999\r\r-46,516050348\r\r\r\r1761\r\r31/12/2016 21:02:50\r\r31/12/2016\r\rConhecida\r\rN√£o\r\r-22,7974702349999\r\r-45,1786399879999\r\r\r\r2915\r\r31/12/2016 23:33:16\r\r31/12/2016\r\rConhecida\r\rSim\r\r\r\r\r\r3\r\r01/01/2017 03:45:42\r\r31/12/2016\r\rConhecida\r\rN√£o\r\r-23,4663377281984\r\r-47,4644919148778\r\r\r\r2\r\r01/01/2017 03:40:13\r\r01/01/2017\r\rDesconhecida\r\rN√£o\r\r-23,7062770598301\r\r-46,5997084663396\r\r\r\r6\r\r01/01/2017 04:25:12\r\r01/01/2017\r\rDesconhecida\r\rN√£o\r\r-23,435339469\r\r-45,0776321386071\r\r\r\r1\r\r01/01/2017 02:30:11\r\r31/12/2016\r\rConhecida\r\rSim\r\r-23,838385412\r\r-46,5778088709999\r\r\r\r4\r\r01/01/2017 04:53:21\r\r01/01/2017\r\rDesconhecida\r\rN√£o\r\r-23,6528390081698\r\r-46,4471844195849\r\r\r\r859\r\r31/12/2016 21:35:30\r\r31/12/2016\r\rConhecida\r\rN√£o\r\r-23,6027829499999\r\r-46,516050348\r\r\r\r13933\r\r31/12/2016 21:09:59\r\r31/12/2016\r\rConhecida\r\rSim\r\r-23,6221113323333\r\r-46,4778365256666\r\r\r\r\r√â fant√°stico que a gente tenha acesso a informa√ß√µes t√£o detalhadas como latitude e longitude de um crime, mas o formato n√£o √© l√° essas coisas. Como os dados da SSP provavelmente est√£o armazenados em um banco de dados relacional, a tabela que baixamos parece ser um inner_join de v√°rias tabelas do banco, pois existem repeti√ß√µes da chave prim√°ria NUM_BO. √â claro que quem tem um pouco de experi√™ncia com esse tipo de coisa vai tirar de letra, mas esse certamente n√£o √© o melhor formato para a popula√ß√£o em geral.\nDe toda forma, mesmo nesse formato, √© interessante loopar por todas as p√°ginas rapidamente. Por isso, tamb√©m implementamos a fun√ß√£o get_detailed_table_sp, que funciona mais ou menos da mesma forma que a get_historical_summarized_table_sp.\nbrcrimR::get_historical_detailed_table_sp(f = \u0026#39;btnHomicicio\u0026#39;, y = \u0026#39;2017\u0026#39;, m = 1:8, d = \u0026#39;0\u0026#39;)\r\rPr√≥ximos passos\rEncerro aqui a apresenta√ß√£o do pacote, com os seus objetivos e funcionalidades b√°sicas. Ele est√° longe de ser ideal e tem uma listinha de coisas que queremos implementar no futuro, mas como se trata de dados abertos, n√£o vejo porque n√£o contar com a comunidade para isso! Seguem abaixo algumas ideias:\n\rHelper functions para os par√¢metros das fun√ß√µes de get de S√£o Paulo. Precisa existir uma fun√ß√£o que pegue uma especifica√ß√£o de par√¢metro do tipo ‚ÄúHomic√≠dio‚Äù e transforme em ‚ÄúbtnHomicicio‚Äù, que √© o par√¢metro que precisamos passar pro site do tribunal.\rUm ‚Äúdesacoplador‚Äù de tabelas do portal da transpar√™ncia.\rImplementa√ß√µes de fun√ß√µes parecidas para outros estados.\r\rPor hoje √© isso, pessoal. Happy coding!\n\r","permalink":"https://blog.curso-r.com/posts/2017-09-13-brcrimr/","tags":["web scraping","tidyverse","banco de dados","dados abertos","api"],"title":"brcrimR"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rNesse post vou mostrar como fazer um pacote em R muito, muito r√°pido. Tirei v√°rias coisas que costumo fazer nos pacotes, com dor no cora√ß√£o, tudo pela velocidade, mantendo s√≥ o essencial.\nDuas restri√ß√µes que usei s√£o\nO pacote precisa ficar dispon√≠vel no GitHub.\rO pacote precisa ter pelo menos uma fun√ß√£o.\r\rEssa √© a solu√ß√£o que eu acho mais segura e r√°pida. Voc√™ tamb√©m pode usar o pr√≥prio RStudio para criar pacotes ou clonar coisas do github, mas isso pode dar alguns bugs.\nPasso 1: Crie um reposit√≥rio no Github\rClique no link: https://github.com/new\n\rEscreva o nome do seu pacote. O nome do pacote n√£o pode ter espa√ßos, underline (_) nem h√≠fen (-) nem come√ßar com n√∫meros.\rTique a op√ß√£o Initialize this repository with a README.\rClique em Create repository.\r\r\rPasso 2: Clonar o reposit√≥rio\rRecomendo clonar reposit√≥rios abrindo um terminal e digitando\n$ git clone https://github.com/usuario/nomeDoPacote\rVoc√™ pode clonar de outras formas, inclusive dentro do RStudio. Se voc√™ usar o RStudio, saia do projeto e delete o arquivo .RProj criado automaticamente, pois ele ter√° metadados inapropriados para criar pacotes.\n\rPasso 3: usar devtools::setup()\rAbra uma nova sess√£o R em qualquer lugar.\rRode devtools::setup(\"caminho/da/pasta/clonada/nomeDoPacote\").\r\r\rPasso 4: Crie sua fun√ß√£o\rExemplo:\n#\u0026#39; Soma 2\r#\u0026#39;\r#\u0026#39; Recebe um vetor de n√∫meros e retorna um vetor de n√∫meros somando dois\r#\u0026#39;\r#\u0026#39; @param x vetor de n√∫meros.\r#\u0026#39;\r#\u0026#39; @export\rsoma_2 \u0026lt;- function(x) {\rx + 2\r}\rCrie a fun√ß√£o dentro de um arquivo com extens√£o .R na pasta R\rAs informa√ß√µes que come√ßam com #' acima da fun√ß√£o servem para documentar. Nesse caso,\r\ra primeira linha √© o t√≠tulo\ra segunda linha √© a descri√ß√£o\ra parte que come√ßa com @param descreve o que √© o par√¢metro de entrada\ra parte que come√ßa com @export diz para o pacote que essa fun√ß√£o deve estar dispon√≠vel para o usu√°rio quando ele rodar library(nomeDoPacote).\r\r\r\rPasso 5: document, commit e push!\rRode devtools::document().\rCommite suas altera√ß√µes.\rD√™ um push!\r\rSe n√£o saba o que √© commitar e pushar, veja o artigo do Athos sobre o uso do git e do GitHub.\n\rPasso 6: Instalar o pacote em outra m√°quina\rMande o nome do seu usu√°rio do GitHub e o nome do seu pacote para sua migue.\rPe√ßa para ela rodar:\r\rdevtools::install_github(\u0026#39;usuario/nomeDoPacote\u0026#39;)\rAgora ela poder√° usar sua fun√ß√£o!\r\rlibrary(nomeDoPacote)\rsoma_2(1:10)\r# [1] 3 4 5 6 7 8 9 10 11 12\rVoc√™ tamb√©m pode ver o help da fun√ß√£o com ?soma_2:\nFIM!\n\rConclus√µes\r\rAgora voc√™ n√£o tem desculpa para n√£o empacotar suas solu√ß√µes em R.\rEsse tutorial √© incompleto! Para acessar mais detalhes, veja http://r-pkgs.had.co.nz, elaborado por voc√™ sabe quem.\r\r\rOutras pequenas dicas pr√°ticas\r\rUse sempre devtools::check() para checar se seu pacote est√° 100% bem constru√≠do.\rUse devtools::use_package() para usar fun√ß√µes de outros pacotes.\rSempre use os :: para chamar as fun√ß√µes e nunca rode library() ou require() dentro de um pacote.\rUse devtools::use_mit_license() para adicionar um arquivo LICENSE ao seu pacote.\rUse abjutils::use_pipe() para poder usar o %\u0026gt;% nos seus pacotes.\rUse devtools::use_data() para adicionar dados ao seu pacote.\rUse devtools::use_vignettes() para escrever um tutorial sobre seu pacote, igual a esse do dplyr, por exemplo.\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-09-07-pacote-miojo/","tags":["miojo"],"title":"Pacotes miojo - como fazer um pacote no R em 3 minutos"},{"author":["Fernando"],"categories":["conceitos"],"contents":"\r\rManter-se atualizado na parte mais computacional √© muito importante para um estat√≠stico. Essa convic√ß√£o √© bastante razo√°vel, mas costuma gerar pol√™mica em alguns ciclos acad√™micos. Quem nunca se questionou se ‚Äú(eu) deveria implementar esse Newton-Raphson ou usar um pacote de proced√™ncia duvidosa?‚Äù ou ‚Äúescrever a matriz de delineamento √© mesmo importante? O R j√° solta pra mim!‚Äù que atire a primeira pedra.\nNa minha opini√£o, esse tipo de discuss√£o nasce morta. Ao mesmo tempo em que √© importante conhecer bem a teoria que se aplica, o mundo √© vasto e grandioso demais pra gastar tempo estudando detalhes t√©cnicos de implementa√ß√£o de todas as coisas. Isso √© √≥bvio, mas por outro lado ‚Äúum pouco‚Äù de conhecimento sobre a parte suja do trabalho tamb√©m √© essencial em algumas situa√ß√µes. Se a sua base ficou grande demais para o R, todo o seu conhecimento de estat√≠stica pode ser in√∫til, porque o que te separa do sucesso √© um bom gerenciamento dos recursos computacionais.\nPrecisa existir um equil√≠brio entre ‚Äúapertar bot√µes‚Äù e ‚Äúreinventar a roda‚Äù. Isso √© √≥bvio, mas a parte triste da discuss√£o √© que esse equil√≠brio pode ser dif√≠cil de alcan√ßar.\nExistem muitas vers√µes da discuss√£o entre estat√≠sticos-computeiros e estat√≠sticos-papel-e-caneta. Uma delas, que ser√° tema deste post, parte da quest√£o ‚ÄúEu deveria implementar todas as minhas fun√ß√µes ou usar as guloseimas tecnol√≥gicas dispon√≠veis no CRAN?‚Äù. De um lado, os ap√≥stolos do tidyverse, como a pr√≥pria Curso-R, defendem e divulgam os avan√ßos proporcionados por ferramentas que computam em alt√≠ssimo n√≠vel. Os estat√≠sticos mais caxias gostam de implementar todas as contas e fun√ß√µes que foram utilizar, o que provoca alguns h√°bitos estranhos. Os tipos mais radicais invertem matrizes em Fortran, n√£o acreditam na fun√ß√£o quantile e n√£o raramente s√£o afeitos √† teorias da conspira√ß√£o.\nComo sempre, nenhum dos dois lados est√° 100% correto, mas na √∫ltima semana me deparei com um problema que me fez sentir mais pr√≥ximo do mais radical dos xiitas.\nO problema\rConsidere que voc√™ precisa carregar um vetor de datas que vieram do Excel. Pulando a parte de leitura e as solu√ß√µes que poderiam vir do bom uso de pacotes como readxl e openxlsx, considere que o problema pr√°tico consiste em converter, j√° no R, o seguinte vetor de textos num vetor de datas.\nexemplo_1 \u0026lt;- c(\u0026quot;22/08/2016\u0026quot;,\u0026quot;29/08/2016\u0026quot;, \u0026quot;05/09/2016\u0026quot;,\u0026quot;12/09/2016\u0026quot;)\rQuem usa o tidyverse faria isso usando a fun√ß√£o dmy do pacote lubridate:\nlubridate::dmy(exemplo_1)\r## [1] \u0026quot;2016-08-22\u0026quot; \u0026quot;2016-08-29\u0026quot; \u0026quot;2016-09-05\u0026quot; \u0026quot;2016-09-12\u0026quot;\re o resultado seria exatamente o que a gente quer. O que aconteceu comigo, entretanto, foi um comportamento inesperado num exemplo muito parecido com esse.\nPor conta da formata√ß√£o irregular de um arquivo de Excel, me deparei com um vetor parecido com esse o_que_observei:\nrepeticoes \u0026lt;- 800\ro_que_observei \u0026lt;- c(rep(\u0026quot;39419\u0026quot;, repeticoes), \u0026quot;22/08/2016\u0026quot;,\u0026quot;29/08/2016\u0026quot;, \u0026quot;05/09/2016\u0026quot;,\u0026quot;12/09/2016\u0026quot;)\rEu imaginava que, quando repeticoes valesse 800, o resultado fosse o mesmo que acontece quando repeticoes vale 1, mas esse n√£o √© o caso.\nPrimeiro, vamos o que acontece quando repeticoes vale 1:\nexemplo_2 \u0026lt;- c(\u0026quot;39419\u0026quot;, \u0026quot;22/08/2016\u0026quot;,\u0026quot;29/08/2016\u0026quot;, \u0026quot;05/09/2016\u0026quot;,\u0026quot;12/09/2016\u0026quot;)\rO lubridate n√£o √© esperto o suficiente para perceber que a primeira entrada representa uma data com origem no dia ‚Äú30/12/1899‚Äù (a data padr√£o em Excel‚Äôs de Windows), mas tudo aquilo que ele n√£o sabe como converter vira um NA.\nlubridate::dmy(exemplo_2)\r## Warning: 1 failed to parse.\r## [1] NA \u0026quot;2016-08-22\u0026quot; \u0026quot;2016-08-29\u0026quot; \u0026quot;2016-09-05\u0026quot; \u0026quot;2016-09-12\u0026quot;\rAgora, veja s√≥ o que acontece quando fazemos a mesma coisa no meu exemplo:\nlubridate::dmy(o_que_observei)\r## Warning: All formats failed to parse. No formats found.\r## [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [26] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [51] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [76] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [101] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [126] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [151] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [176] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [201] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [226] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [251] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [276] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [301] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [326] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [351] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [376] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [401] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [426] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [451] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [476] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [501] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [526] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [551] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [576] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [601] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [626] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [651] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [676] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [701] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [726] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [751] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [776] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\r## [801] NA NA NA NA\rO resultado √© bastante estranho. Embora as √∫ltimas entradas do vetor sejam datas num formato conhecido, n√£o √© isso que a fun√ß√£o retorna.\n\rA investiga√ß√£o\rMe perguntando sobre o que aconteceu, eu resolvi criar uma issue no pacote lubridate.\n\rConsider the following vectors:\ndates_vector_1 \u0026lt;- c(\u0026quot;22/08/2016\u0026quot;,\u0026quot;29/08/2016\u0026quot;,\u0026quot;05/09/2016\u0026quot;,\u0026quot;12/09/2016\u0026quot;)\rdates_vector_2 \u0026lt;- c(rep(\u0026quot;1\u0026quot;, 500), dates_vector_1)\rdates_vector_3 \u0026lt;- c(rep(\u0026quot;1\u0026quot;, 800), dates_vector_1)\rdmy fails to detect formats on the third, even though it‚Äôs capable of finding it on the second.\nlibrary(lubridate)\rdmy(dates_vector_1)\rdmy(dates_vector_2)\rdmy(dates_vector_3)\rIs this supposed to happen? If it is, why?\n\rA resposta do vspinu, pricipal contribuidor do lubridate hoje, me respondeu muito rapidamente!\n\rThis is a consequence of guessing formats based on a deterministic sub-sample of the original vector. This issue was aleviated somewhat recently, but it‚Äôs impossible to solve efficiently without dropping format guesser to C level. Not something which I would consider in the future.\nSee #307 #308. You can disable guesser with parse_date_time and train=FALSE.\n\rCase solved! O problema √© a parse_date_time, que √© usada por tr√°s do dmy. Antes de converter, o lubridate adivinha quais s√£o os formatos, que usa apenas um peda√ßo do vetor.\n\rA solu√ß√£o\rA solu√ß√£o proposta pelo vspinu n√£o funcionou no meu caso.\nparse_date_time(o_que_observei, train = T, orders = \u0026#39;dmy\u0026#39;)\rO parse_date_time continua n√£o reconhecendo as √∫ltimas entradas do meu vetor como datas, mesmo com o train = FALSE.\nPara n√£o gastar muito tempo, terminei fazendo um gato pra resolver o meu problema.\nnovo \u0026lt;- c(\u0026quot;01/01/2001\u0026quot;, o_que_observei)\rsolucao \u0026lt;- dmy(novo)[-1]\r## Warning: 800 failed to parse.\rsolucao\r## [1] NA NA NA NA NA ## [6] NA NA NA NA NA ## [11] NA NA NA NA NA ## [16] NA NA NA NA NA ## [21] NA NA NA NA NA ## [26] NA NA NA NA NA ## [31] NA NA NA NA NA ## [36] NA NA NA NA NA ## [41] NA NA NA NA NA ## [46] NA NA NA NA NA ## [51] NA NA NA NA NA ## [56] NA NA NA NA NA ## [61] NA NA NA NA NA ## [66] NA NA NA NA NA ## [71] NA NA NA NA NA ## [76] NA NA NA NA NA ## [81] NA NA NA NA NA ## [86] NA NA NA NA NA ## [91] NA NA NA NA NA ## [96] NA NA NA NA NA ## [101] NA NA NA NA NA ## [106] NA NA NA NA NA ## [111] NA NA NA NA NA ## [116] NA NA NA NA NA ## [121] NA NA NA NA NA ## [126] NA NA NA NA NA ## [131] NA NA NA NA NA ## [136] NA NA NA NA NA ## [141] NA NA NA NA NA ## [146] NA NA NA NA NA ## [151] NA NA NA NA NA ## [156] NA NA NA NA NA ## [161] NA NA NA NA NA ## [166] NA NA NA NA NA ## [171] NA NA NA NA NA ## [176] NA NA NA NA NA ## [181] NA NA NA NA NA ## [186] NA NA NA NA NA ## [191] NA NA NA NA NA ## [196] NA NA NA NA NA ## [201] NA NA NA NA NA ## [206] NA NA NA NA NA ## [211] NA NA NA NA NA ## [216] NA NA NA NA NA ## [221] NA NA NA NA NA ## [226] NA NA NA NA NA ## [231] NA NA NA NA NA ## [236] NA NA NA NA NA ## [241] NA NA NA NA NA ## [246] NA NA NA NA NA ## [251] NA NA NA NA NA ## [256] NA NA NA NA NA ## [261] NA NA NA NA NA ## [266] NA NA NA NA NA ## [271] NA NA NA NA NA ## [276] NA NA NA NA NA ## [281] NA NA NA NA NA ## [286] NA NA NA NA NA ## [291] NA NA NA NA NA ## [296] NA NA NA NA NA ## [301] NA NA NA NA NA ## [306] NA NA NA NA NA ## [311] NA NA NA NA NA ## [316] NA NA NA NA NA ## [321] NA NA NA NA NA ## [326] NA NA NA NA NA ## [331] NA NA NA NA NA ## [336] NA NA NA NA NA ## [341] NA NA NA NA NA ## [346] NA NA NA NA NA ## [351] NA NA NA NA NA ## [356] NA NA NA NA NA ## [361] NA NA NA NA NA ## [366] NA NA NA NA NA ## [371] NA NA NA NA NA ## [376] NA NA NA NA NA ## [381] NA NA NA NA NA ## [386] NA NA NA NA NA ## [391] NA NA NA NA NA ## [396] NA NA NA NA NA ## [401] NA NA NA NA NA ## [406] NA NA NA NA NA ## [411] NA NA NA NA NA ## [416] NA NA NA NA NA ## [421] NA NA NA NA NA ## [426] NA NA NA NA NA ## [431] NA NA NA NA NA ## [436] NA NA NA NA NA ## [441] NA NA NA NA NA ## [446] NA NA NA NA NA ## [451] NA NA NA NA NA ## [456] NA NA NA NA NA ## [461] NA NA NA NA NA ## [466] NA NA NA NA NA ## [471] NA NA NA NA NA ## [476] NA NA NA NA NA ## [481] NA NA NA NA NA ## [486] NA NA NA NA NA ## [491] NA NA NA NA NA ## [496] NA NA NA NA NA ## [501] NA NA NA NA NA ## [506] NA NA NA NA NA ## [511] NA NA NA NA NA ## [516] NA NA NA NA NA ## [521] NA NA NA NA NA ## [526] NA NA NA NA NA ## [531] NA NA NA NA NA ## [536] NA NA NA NA NA ## [541] NA NA NA NA NA ## [546] NA NA NA NA NA ## [551] NA NA NA NA NA ## [556] NA NA NA NA NA ## [561] NA NA NA NA NA ## [566] NA NA NA NA NA ## [571] NA NA NA NA NA ## [576] NA NA NA NA NA ## [581] NA NA NA NA NA ## [586] NA NA NA NA NA ## [591] NA NA NA NA NA ## [596] NA NA NA NA NA ## [601] NA NA NA NA NA ## [606] NA NA NA NA NA ## [611] NA NA NA NA NA ## [616] NA NA NA NA NA ## [621] NA NA NA NA NA ## [626] NA NA NA NA NA ## [631] NA NA NA NA NA ## [636] NA NA NA NA NA ## [641] NA NA NA NA NA ## [646] NA NA NA NA NA ## [651] NA NA NA NA NA ## [656] NA NA NA NA NA ## [661] NA NA NA NA NA ## [666] NA NA NA NA NA ## [671] NA NA NA NA NA ## [676] NA NA NA NA NA ## [681] NA NA NA NA NA ## [686] NA NA NA NA NA ## [691] NA NA NA NA NA ## [696] NA NA NA NA NA ## [701] NA NA NA NA NA ## [706] NA NA NA NA NA ## [711] NA NA NA NA NA ## [716] NA NA NA NA NA ## [721] NA NA NA NA NA ## [726] NA NA NA NA NA ## [731] NA NA NA NA NA ## [736] NA NA NA NA NA ## [741] NA NA NA NA NA ## [746] NA NA NA NA NA ## [751] NA NA NA NA NA ## [756] NA NA NA NA NA ## [761] NA NA NA NA NA ## [766] NA NA NA NA NA ## [771] NA NA NA NA NA ## [776] NA NA NA NA NA ## [781] NA NA NA NA NA ## [786] NA NA NA NA NA ## [791] NA NA NA NA NA ## [796] NA NA NA NA NA ## [801] \u0026quot;2016-08-22\u0026quot; \u0026quot;2016-08-29\u0026quot; \u0026quot;2016-09-05\u0026quot; \u0026quot;2016-09-12\u0026quot;\r\rConclus√£o\rA eterna disputa entre os que sabem exatamente o que acontece por tr√°s dos programas e aqueles que n√£o sabem vai continuar eternamente. Como disseram numa das issues que mencionei neste texto\n\rObviously there is no mathematical solution without inspecting the full vector that won‚Äôt run into edge cases.\n\rMas isso n√£o deve ser motivo para se isolar numa caverna. Sempre podemos olhar com cuidado para as solu√ß√µes que implementamos e entrar em contato com os desenvolvedores das nossas ferramentas.\nPor hoje, espero que esse problema espec√≠fico sobre o lubridate esteja esclarecido e que ningu√©m fique com medo de usar a infinitude de pacotes de R. Como vimos aqui, mesmo que a princ√≠pios as coisas sejam obscuras, sempre podemos buscar mais informa√ß√µes sobre a implementa√ß√£o de uma fun√ß√£o.\n\r","permalink":"https://blog.curso-r.com/posts/2017-07-29-comportamentos-estranhos-lubridate/","tags":["tidyverse","strings"],"title":"Comportamentos imprevis√≠veis do lubridate"},{"author":["William"],"categories":["discuss√µes"],"contents":"\rEscolher uma profiss√£o, para quem tem esse privil√©gio, √© uma das decis√µes mais importantes das nossas vidas. Aos 17, 18 anos, a imaturidade, o pouco auto-conhecimento e a falta de informa√ß√£o sobre as alternativas podem nos desviar da op√ß√£o que nos vestiria melhor, um erro que muitas vezes nunca ser√° reparado.\n√Äs vezes, eu me pergunto o que levou amigos e conhecido a escolherem suas profiss√µes na hora do vestibular. No meu caso, eu quase segui um caminho da ‚Äúprofiss√µes da moda‚Äù. O que me impediu de prestar Administra√ß√£o foi descobrir, na hora da inscri√ß√£o, que era uma carreira da √°rea de Humanas, n√£o Exatas.\nSim, eu era bem perdido.\nNa √©poca, a segunda fase da FUVEST era diferente para cada √°rea, e eu n√£o tinha perspectiva nenhuma de ir bem se tivesse que fazer uma prova dissertativa de Hist√≥ria e Geografia em vez de Matem√°tica e F√≠sica, disciplinas que eu dominava muito mais. Por isso, ap√≥s uma (muito breve) pesquisa na internet, fui convencido a prestar Estat√≠stica, e o que me convenceu foi a frase ‚Äú[‚Ä¶] envolve bastante matem√°tica e o mercado de trabalho √© muito bom‚Äù. Foi baseado nisso que eu tomei uma das decis√µes mais importantes da minha vida e era basicamente tudo o que eu sabia sobre a carreira quando comecei a gradua√ß√£o.\nPrestar vestibular para Estat√≠stica foi um tiro no escuro t√£o certeiro que √†s vezes me pego pensando em destino e esoterismos desse tipo. Durante a gradua√ß√£o, conheci pessoas que n√£o tiveram a mesma sorte e acabaram desistindo nos primeiros semestres, que s√£o bem pesados na matem√°tica. A primeira parte da informa√ß√£o que eu tinha sobre realmente estava certa, e o curso de Estat√≠stica pode assustar quem n√£o estiver na pegada de provar v√°rios teoremas. Mas, neste post, n√£o quero falar sobre as dificuldades da escalada, mas sim sobre a vista ao se chegar ao topo.\nConforme fui conhecendo a Estat√≠stica, eu descobri que ela √© a profiss√£o mais nerd que existe1. Eu sustento essa opini√£o porque a melhor defini√ß√£o de nerd que j√° escutei √© ‚Äúpessoa ama aprender‚Äù e, gra√ßas √† Estat√≠stica, tenho a oportunidade de estudar muita coisa diferente.\nNesses dez anos como estat√≠stico, j√° fiz an√°lises na √°rea de engenharia, finan√ßas, educa√ß√£o, jornalismo, zoologia, farm√°cia, fisioterapia, medicina, psicologia, odontologia, educa√ß√£o f√≠sica‚Ä¶ e essas s√£o apenas as que eu lembrei de cabe√ßa. Estat√≠stica √© parte essencial do m√©todo cient√≠fico e est√° presente em todas as ci√™ncias. Pegar trabalhos novos para um estat√≠stico nerd √© extremamente motivante, porque n√£o √© apenas uma troca de tempo por dinheiro, √© uma √≥tima chance para aprender coisas novas. A Estat√≠stica te estimula a ser curioso e criativo, e isso √© o que eu mais amo nela.\nOutra coisa para se amar √© o mercado de trabalho.\nA segunda parte da informa√ß√£o que eu tinha tamb√©m estava correta: o mercado de trabalho para o estat√≠stico √© excelente! N√£o s√≥ pelo n√∫mero de oportunidades, mas pela gama de lugares diferentes onde somos necess√°rios. N√£o vou listar aqui porque √© praticamente qualquer √°rea. E sobre sal√°rios, como diria um professor do IME, d√° para alimentar fam√≠lias.\nApesar de ter sido um dos poucos dos meus colegas a n√£o mergulhar de cabe√ßa no mercado, j√° tive duas experi√™ncias. A primeira foi como estagi√°rio em um banco, onde aprendi bastante sobre o que eu n√£o queria fazer na vida. Tudo o que eu fazia era rodar modelos pr√©-estabelecidos para gerar relat√≥rios pr√©-formatados. Tinha aprendido tanta coisa legal na gradua√ß√£o e n√£o podia usar nada, o que me fazia sentir como um p√°ssaro engaiolado.\nA segunda foi no Instituto Butantan, onde eu era o √∫nico estat√≠stico ao lado de v√°rios bi√≥logos, farmac√™uticos e veterin√°rios. Foi uma √≥tima experi√™ncia, na qual conheci muita gente bacana e aprendi muita coisa de biologia, farm√¢cia e controle de qualidade. Trabalhar com pessoas diferentes de voc√™, com outras formas de pensar, √© outra parte legal de ser estat√≠stico. O pessoal do Butantan me ensinou bastante, principalmente sobre como a ci√™ncia e a pesquisa funcionam na pr√°tica. Al√©m disso, foi l√° que nasceu o meu interesse em ensinar Estat√≠stica.\nBom, essa foi uma parte da hist√≥ria de como eu me apaixonei pela Estat√≠stica. Talvez eu n√£o tenha acrescentado nada se voc√™ j√° compartilha desse sentimento, mas espero que esse texto chegue a pessoas que ainda estejam escolhendo sua profiss√£o e jogue luz sobre essa alternativa. Essa √© a hora de mudarmos gr√°ficos como esse.\nResumindo:\n\rEstat√≠stica √© a profiss√£o para quem gosta de aprender.\rUm bom estat√≠stico no mercado √© uma crian√ßa com cart√£o de cr√©dito numa loja de brinquedos.\r\rNo pr√≥ximo post desta s√©rie, vou levantar um pouco de pol√™mica desabafando sobre alguns preconceitos de aprendizagem. At√© breve!\n\rSe voc√™ ainda v√™ alguma conota√ß√£o negativa na palavra nerd, mande as minha lembran√ßas aos anos 90. :D‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-08-31-por-que-amar-estatistica/","tags":["estat√≠stica"],"title":"Por que amar Estat√≠stica?"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\rNesse final de semana decidi assistir a alguns v√≠deos do YouTube do Siraj Raval e ao curso do Andrew Ng sobre deep learning. Ap√≥s assistir alguns v√≠deos, fiquei com uma vontade insana de implementar um modelo pra gerar m√∫sicas aleat√≥rias do Wesley Safad√£o!\nNa minha opini√£o, o resultado ficou bem mais ou menos. Acho que tem muito o que melhorar ainda. Vejam o que acham!\nInstru√ß√µes de uso:\nAperte o bot√£o.\rESPERE UM POUCO. Meu c√≥digo √© lento e botei num servi√ßo gratuito do OpenCPU, ent√£o tenham paci√™ncia, por favor.\rVeja o texto que aparece. O texto at√© o | √© original, e o resto √© gerado automaticamente. Quando o tamanho do texto fica grande demais, adicionamos um \u0026lt;truncated\u0026gt;\r\r\r$(document).ready(function() {\r$('#MyButton').click(function() {\r$('#safadao').css('background-color' , '#DEDEDE');\r$.post('http://jtrecenti.ocpu.io/safadao/R/gen/json', { rand : Math.random() }, function(data) {\r$(\"#safadao\").val(data);\r});\r$('#safadao').css('background-color' , '#FFFFFF');\r});\r});\r\r\r#comofas\rO trabalho foi feito em 3 passos: download, modelagem e implanta√ß√£o. Descrevemos cada um dos passos a seguir.\nDownload\rAs letras foram baixadas do letras.mus.br. Primeiro, rodamos um script que lista os links de todas as m√∫sicas a partir da p√°gina do Wesley Safad√£o. O CSS path esquisito abaixo foi a forma mais compacta que encontrei de acessar os links diretamente.\nlibrary(magrittr)\rlink_base \u0026lt;- \u0026#39;https://www.letras.mus.br\u0026#39;\r# listando os links\rws_links \u0026lt;- paste0(link_base, \u0026#39;/wesley-safadao/\u0026#39;) %\u0026gt;%\rrvest::html_session() %\u0026gt;%\rrvest::html_nodes(\u0026#39;.cnt-list--alp \u0026gt; ul \u0026gt; li \u0026gt; a\u0026#39;) %\u0026gt;%\rrvest::html_attr(\u0026#39;href\u0026#39;)\rEm seguida, criamos uma fun√ß√£o que pega a letra a partir de uma p√°gina.\npegar_letra \u0026lt;- function(link) {\r# do link at√© a parte que tem o conte√∫do\rresult \u0026lt;- paste0(link_base, link) %\u0026gt;%\rrvest::html_session() %\u0026gt;%\rrvest::html_nodes(\u0026#39;.cnt-letra \u0026gt; article \u0026gt; p\u0026#39;) %\u0026gt;%\r# Peguei o texto com as tags html para pegar os \\n\ras.character() %\u0026gt;%\rstringr::str_replace_all(\u0026#39;\u0026lt;[brp/]+\u0026gt;\u0026#39;, \u0026#39;\\n\u0026#39;) %\u0026gt;%\rpaste(collapse = \u0026#39;\\n\\n\u0026#39;) %\u0026gt;%\r# Limpeza do texto\rlimpar_musica() %\u0026gt;%\rtokenizers::tokenize_characters(strip_non_alphanum = FALSE, simplify = TRUE)\rc(result, \u0026#39;@\u0026#39;) # Adicionando @ no final\r}\rE usamos o maravilhoso combo purrr::map com progress::progress, que j√° tem um post dedicado no nosso blog.\n# baixando todas as listas\rp \u0026lt;- progress::progress_bar$new(total = length(ws_links))\rws_letras \u0026lt;- unlist(purrr::map(ws_links, ~{\rp$tick()\rpegar_letra(.x)\r}))\rNote que eu escondi de voc√™s a fun√ß√£o limpar_musica(). Essa fun√ß√£o aplica uma s√©rie de express√µes regulares para limpar os textos.\nlimpar_musica \u0026lt;- function(txt) {\rtxt %\u0026gt;%\rstringr::str_trim() %\u0026gt;%\rstringr::str_to_lower() %\u0026gt;%\rstringr::str_replace_all(\u0026#39;[^a-z0-9√™√¢√¥√°√©√≠√≥√∫√£√µ√†√ß;,!?: \\n-]\u0026#39;, \u0026#39;\u0026#39;) %\u0026gt;%\rstringr::str_replace_all(\u0026#39;[0-9]+x| bis\u0026#39;, \u0026#39;\u0026#39;) %\u0026gt;%\rstringr::str_replace_all(\u0026#39;([ ,?!])+\u0026#39;, \u0026#39;\\\\1\u0026#39;) %\u0026gt;%\rstringr::str_replace_all(\u0026#39; ([;,!?:-])\u0026#39;, \u0026#39;\\\\1\u0026#39;) %\u0026gt;%\rstringr::str_replace_all(\u0026#39;\\n{3,}\u0026#39;, \u0026#39;\\n\\n\u0026#39;)\r}\rO resultado √© o objeto ws_letras: um vetor tamanho 557459 em que cada elemento √© um caractere, que pode ser uma letra, n√∫mero, espa√ßo e at√© uma pulada de linha. Cada m√∫sica √© separada pelo caractere @. Aqui est√° a primeira delas:\ncat(head(ws_letras, which(ws_letras == \u0026#39;@\u0026#39;)[1] - 1), sep = \u0026#39;\u0026#39;)\r## assim √© o nosso amor\r## io io io io io iooo\r## 100 amor\r## io io io io io iooo\r## ## s√≥ a gente se olhar que cora√ß√£o dispara\r## e as bocas calam\r## e o desejo fala por n√≥s dois\r## ## canalisando o nosso amor,\r## nada se compara\r## √© fogo √© tara,\r## no antes durante e depois\r## ## coisa rara bonito de ver\r## o mundo p√°ra pra eu e voc√™\r## √© um conto de fadas a nossa paix√£o\r## duas vidas em um s√≥ cora√ß√£o\r\rModelagem\rN√£o vou entrar em detalhes na parte estat√≠stica, mas basicamente utilizei uma rede LSTM (Long Short-Term Memory) e apenas uma camada oculta, copiada covardemente de um c√≥digo feito pelo Daniel Falbel nos tutoriais do Keras para o R. O modelo serve para classificar caracteres (n√£o palavras) e considera uma janela de passado m√°ximo de 40 caracteres para realizar suas predi√ß√µes. Por esse motivo as letras geradas podem ter erros gramaticais feios (e.g.¬†palavras iniciadas em √ß).\nPor simplicidade, omiti o c√≥digo que faz a prepara√ß√£o dos dados para ajustar no keras. Assim que eu tiver mais dom√≠nio sobre LSTM e Recurrent Neural Networks (RNNs) em geral farei um post dedicado.\nA especifica√ß√£o do modelo √© simples: i) adicionamos apenas uma camada LSTM com 128 unidades, ii) adicionamos uma camada oculta com o n√∫mero de unidades igual ao total de caracteres distintos presentes no texto e iii) aplicamos uma ativa√ß√£o softmax, que d√° as probabilidades de cada candidato a pr√≥ximo caractere.\nConsideramos como fun√ß√£o de custo a Categorical Cross Entropy, a mesma da regress√£o log√≠stica. Como otimizador usamos o Adam, que faz basicamente uma descida de gradiente, mas aplica m√©dias m√≥veis com o passo anterior e com a derivada obtida via back propagation, realizando atualiza√ß√µes mais suaves.\nNo final, ajustamos o modelo com mini-batches de 256 observa√ß√µes e cinco √©pocas. Isso significa que fazemos 5 passos gigantes da descida de gradiente usando toda a base de dados, separados em diversos passinhos com 256 observa√ß√µes cada.\nNa pr√°tica, eu rodei o fit algumas vezes, reduzindo manualmente a taxa de aprendizado lr para fazer um ajuste mais fino. Cada √©poca demorava aproximadamente 6 minutos no meu notebook, que n√£o tem GPU.\nlibrary(keras)\rmodel \u0026lt;- keras_model_sequential()\rmodel %\u0026gt;%\rlayer_lstm(128, input_shape = c(maxlen, length(chars))) %\u0026gt;%\rlayer_dense(length(chars)) %\u0026gt;%\rlayer_activation(\u0026quot;softmax\u0026quot;)\r# custo e otimizador\rmodel %\u0026gt;% compile(\rloss = \u0026quot;categorical_crossentropy\u0026quot;,\roptimizer = optimizer_adam(lr = 0.0001)\r)\r# ajuste\rmodel %\u0026gt;% fit(\rkeras_data$X, keras_data$y,\rbatch_size = 256, epochs = 5\r)\rTamb√©m temos duas fun√ß√µes interessantes a serem discutidas. A primeira √© a sample_mod(), uma fun√ß√£o que recebe as probabilidades de cada letra e gera uma nova letra com essas probabilidades. O par√¢metro diversity= aumenta ou diminui manualmente todas essas probabilidades, fazendo o modelo alterar um pouco seu comportamento. Quando maior esse par√¢metro, maior a chance de sa√≠rem caracteres inesperados e, quanto menor, maior a chance de sair um texto completamente repetitivo.\nsample_mod \u0026lt;- function(preds, diversity = 1) {\rpreds \u0026lt;- log(preds) / diversity\rexp_preds \u0026lt;- exp(preds)\rpreds \u0026lt;- exp_preds / sum(exp_preds)\rwhich.max(as.integer(rmultinom(1, 1, preds)))\r}\rA outra fun√ß√£o √© gerar_txt(), nosso gerador de textos. Essa fun√ß√£o recebe o modelo do Wesley Safad√£o e retorna um novo texto. O algoritmo funciona assim:\nPosicionamento. Escolhemos aleatoriamente uma posi√ß√£o do texto de entrada que tenha um @ (start_index). Lembre-se, o @ delimita o final ou in√≠cio de uma letra.\rInicializa√ß√£o. Pegamos os 40 caracteres seguintes, indicados por maxlen= e guardamos no vetor sentence.\rGera√ß√£o de caracteres. Em seguida, entramos no seguinte la√ßo: enquanto o modelo n√£o gera um @ (final da can√ß√£o), criamos um novo caractere com sample_mod() e adicionamos √† nossa senten√ßa final. Para garantir que o c√≥digo termina de rodar num tempo finito, paramos o la√ßo se criarmos mais de limit= sem aparecer um @.\rImpress√£o. Na hora de imprimir o texto, adicionamos um | como separador para indicar qual parte foi extra√≠da da base real e qual parte √© gerada automaticamente. Tamb√©m adicionamos um \u0026lt;truncated\u0026gt; no final caso a fase anterior tenha passado do limit=.\r\rgerar_txt \u0026lt;- function(model, txt, diversity = 1.0, limit = 1000, maxlen = 40) {\r# parte 1 - posicionamento\rchars \u0026lt;- sort(unique(txt))\rtxt_index \u0026lt;- which(txt[-length(txt)] == \u0026#39;@\u0026#39;)\rstart_index \u0026lt;- sample(txt_index, size = 1) + 1L\rid_txt \u0026lt;- which(txt_index == start_index)\r# parte 2 - inicializa√ß√£o\rsentence \u0026lt;- txt[start_index:(start_index + maxlen - 1)]\rgenerated \u0026lt;- paste0(c(sentence, \u0026#39;|\u0026#39;), collapse = \u0026quot;\u0026quot;)\rnext_char \u0026lt;- \u0026quot;\u0026quot;\rtotal_chars \u0026lt;- 0\r# parte 3 - gera√ß√£o de caracteres\rwhile (next_char != \u0026#39;@\u0026#39; \u0026amp;\u0026amp; total_chars \u0026lt; limit) {\rx \u0026lt;- sapply(chars, function(x) {as.integer(x == sentence)})\rdim(x) \u0026lt;- c(1, dim(x))\rnext_index \u0026lt;- sample_mod(predict(model, x), diversity)\rnext_char \u0026lt;- chars[next_index]\rgenerated \u0026lt;- paste0(generated, next_char, collapse = \u0026quot;\u0026quot;)\rsentence \u0026lt;- c(sentence[-1], next_char)\rtotal_chars \u0026lt;- total_chars + 1\r}\r# parte 4 - impress√£o\rs_final \u0026lt;- stringr::str_sub(generated, 1, -2)\rif (total_chars == limit) s_final \u0026lt;- paste0(s_final, \u0026#39;\\n\u0026lt;truncated\u0026gt;\u0026#39;)\rs_final\r}\r\rImplanta√ß√£o\rPara deixar o modelo acess√≠vel pela internet, utilizei o maravilhoso OpenCPU. Trata-se de um pacote em R e tamb√©m um software para transformar c√≥digos R em API. Basicamente, o que fazemos √©:\nCriar um pacote do R com as fun√ß√µes que temos interesse. No nosso caso, temos o pacote safadao, que foi criado para guardar o modelo ajustado e a fun√ß√£o que gera as letras, definida acima.\rInstalar o OpenCPU em um servidor na nuvem.\rInformar ao OpenCPU que queremos servir um pacote espec√≠fico.\r\rFelizmente, s√≥ precisei realizar de fato o primeiro passo dessa lista. O Jeroen Ooms, autor dessa solu√ß√£o, nos d√° uma vantagem a mais: ele mant√©m um servidor na nuvem onde qualquer usu√°rio pode subir seu pr√≥prio pacote, totalmente de gra√ßa. Ou seja, podemos criar APIs com nossos modelos preferidos, de gra√ßa e sem esfor√ßo. Acesse esse link para instru√ß√µes mais detalhadas de como fazer a implanta√ß√£o.\nNo nosso caso, a API √© acess√≠vel pelo link abaixo.\nhttp://jtrecenti.ocpu.io/safadao/R/gen/json\rBasta fazer uma requisi√ß√£o POST para esse link e ele retornar√° uma letra do Wesley Safad√£o.\n\rWrap-up\r\rVimos aqui mais uma aplica√ß√£o da estat√≠stica que parece um pouco fora da caixa mas que na verdade √© bem p√© no ch√£o.\rPara trabalhar com esse tipo de dados, usualmente usamos redes neurais LSTM, adequada para dados em sequ√™ncia.\rO modelo ainda tem muito a melhorar, tanto com ajustes na modelagem quanto na melhoria ao tratamento dos dados.\rAgora voc√™ pode criar o gerador de m√∫sicas do seu artista preferido. Tente replicar para outro artista!\r\r√â isso. Happy coding ;)\nPS: Tamb√©m montei um gerador de salmos (da b√≠blia) aleat√≥rio, usando a mesma t√©cnica, mas ainda n√£o estou feliz com o resultado. Quando estiver, posto aqui tamb√©m :P\n\r\r","permalink":"https://blog.curso-r.com/posts/2017-08-27-safadao/","tags":["m√∫sica"],"title":"Aquele 1% √© Deep Learning - Gerando letras do Wesley Safad√£o"},{"author":["Athos"],"categories":["Tutoriais"],"contents":"\rO ponto m√°ximo da hist√≥ria √© o R mandando mensagem pro Telegram. S√≥ para motivar, vou contar o que fiz de divertido usando telegram e pre√ßos de bitcoin.\nHer√≥i do dia: Luca Biglia, autor do pacote telegram do R.\nO que faremos\rComo mencionei, Vou construir um Acompanhador de bitcoin pra ilustrar e ao fim do post teremos feito o R mandar um telegram quando o pre√ßo da bitcoin atingir um dado patamar.\nIngredientes\rNa arte de hoje vamos precisar de:\n\rUm bot do telegram\rO pacote do R library(telegram)\rA API da BlinkTrade\rBarbante e um tubo de cola\r\rOs passos que precisamos seguir para alcan√ßar isso s√£o:\nCriar um .Rproj (projeto do RStudio).\rinstalar e carregar o pacote telegram do R.\rCriar um bot do telegram com a ajuda do BotFather.\rConectar o R com o bot.\rConsultar e guardar os pre√ßos da bitcoin de 30 em 30 segundos.\rcriar um loop infinito no R para acompanhar os pre√ßos sem parar.\rFazer o R mandar mensagem pra gente quando o pre√ßo da bitcoin for maior que X, por exemplo.\r(extra) Pensar em ideias mirabolantes do que fazer com telegram + R.\r\r\rIntrodu√ß√£o aos componentes\rAntes de mais nada, uma breve introdu√ß√£o √†s coisas que aparecer√£o por aqui:\n\rtelegram: √© igual ao Whatsapp, mas melhorado.\rBotFather: um contato do seu celular (no telegram) que te ajuda a criar um bot do telegram.\rbitcoin: moeda digital de sucesso.\rBlinkTrade: dentre outras coisas, fornece API para valores da bitcoin em tempo real.\r\r\rAcompanhador de bitcoin\rJ√° crie o seu .Rproj, rode install.packages(\"telegram\");library(telegram) e vamos direto ao terceiro passo.\nPasso 3: Bot do telegram - Criar um bot\rBot √© como se fosse uma pessoa a mais na sua lista de contato do telegram, mas que s√£o m√°quinas em vez de humanos e respondem a comandos espec√≠ficos. A gra√ßa √© que voc√™ pode customizar esses comandos do jeito que quiser! Basta ter um prop√≥sito e saber program√°-lo.\nO README que t√° no github do pacote √© muito bom! Vou resumir com pequenas mudan√ßas o que est√° l√°:\nV√° ao seu telegram e procure pelo BotFather como se estivesse procurando uma pessoa da sua lista de contato. Abra uma conversa com ele!\rEnvie o texto ‚Äú/start‚Äù e em seguida ‚Äú/newbot‚Äù. D√™ um nome ao seu bot (pode ser um nome fofo) e depois um nome de usu√°rio para o seu bot que necessariamente termina em bot.\rAgora copie e cole o token que o BotFather te enviou no .Renviron. O meu bot tem o username AthosDamianiBot, ent√£o eu devo colocar o nome da vari√°vel assim:\r\rSe voc√™ usar essa conven√ß√£o de nome voc√™ poder√° usar a fun√ß√£o bot_token() pra pegar o seu token. Caso contr√°rio vai ter que apelar para a Sys.getenv().\nOBS: Reinicie o R para o .Renviron ficar configurado.\n\rPasso 4: Bot do telegram - Conectar ao R\rCarregue o pacote e crie um objeto TGBot para o seu bot criando anteriormente:\r\rlibrary(telegram)\rbot \u0026lt;- TGBot$new(token = bot_token(\u0026#39;AthosDamianiBot\u0026#39;))\rbot$getMe()\rAgora precisamos do chat_id. Para isso, no seu telegram, procure o seu bot como se fosse um contato (que nem voc√™ fez com o BotFather) e comece uma conversa com ele.\n\rNo R, chame o m√©todo bot$getUpdates() para pegar no R as mensagens que voc√™ enviou a ele e, finalmente, encontre o chat_id escondido no msgs.\n\r\rmsgs \u0026lt;- bot$getUpdates()\rmsgs$message$chat$id[1]\r[1] 135717340\rCom o chat_id em m√£os, configure ele como chat_id padr√£o.\r\rbot$set_default_chat_id(135717340)\rNeste momento j√° estamos prontos para interagir com o nosso bot!\n\rPasso 5: Consultar pre√ßos da bitcoin\rOs pre√ßos da bitcoin s√£o fornecidos pela API da BlinkTrade que √© bem simples usar: basta pegar o json que a url do c√≥digo abaixo solta. Aproveito e dou um tapinha para deixar em forma de data.frame e com a data de consulta junto.\nlibrary(jsonlite)\rlibrary(tidyverse)\rsafe_fromJSON \u0026lt;- safely(fromJSON, as.numeric(NA))\rnova_consulta_list \u0026lt;- safe_fromJSON(\u0026quot;https://api.blinktrade.com/api/v1/BRL/ticker?crypto_currency=BTC\u0026quot;)\rnova_consulta \u0026lt;- nova_consulta_list$result %\u0026gt;%\ras.tibble %\u0026gt;%\rmutate(timestamp = lubridate::now())\rnova_consulta\r# A tibble: 1 x 9\rhigh vol buy last low pair sell vol_brl timestamp\r\u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dttm\u0026gt;\r1 14438.21 511.5911 14077.01 14200 13801.04 BTCBRL 14200 7257317 2017-08-18 17:09:44\rOBS: Usei o adv√©rbio safely() porque a API pode engasgar a qualquer momento, fazendo assim o R retornar um erro que interromperia o acompanhamento do pre√ßo.\n\rPasso 6: Loop infinito para acompanhar os pre√ßos\rO esqueleto do acompanhador √© composto por um loop infinito (while(TRUE)), um data.frame historico.RData, um tempo entre uma consulta e outra (30 segundos por padr√£o) e a consulta propriamente dita.\n# inicializa o historico.RData\r# historico \u0026lt;- nova_consulta\r# save(historico, file = \u0026quot;historico.RData\u0026quot;)\racompanhar_bitcoin \u0026lt;- function(frequencia = 30) {\rload(\u0026quot;historico.RData\u0026quot;)\r# loop infinito\rwhile(TRUE) {\r# pega a cota√ß√£o do bitcoin brasil (BTCBRL) da API do blinktrade\rnova_consulta_list \u0026lt;- safe_fromJSON(\u0026quot;https://api.blinktrade.com/api/v1/BRL/ticker?crypto_currency=BTC\u0026quot;)\r# verifica se a API retornou uma lista\rif(\u0026quot;list\u0026quot; %in% class(nova_consulta_list$result)) {\rnova_consulta \u0026lt;- nova_consulta_list$result %\u0026gt;%\ras.tibble %\u0026gt;%\rmutate(timestamp = lubridate::now())\r# ---------------------\r#\r# espa√ßo reservado para as regras!\r#\r# ---------------------\r# guarda a consulta\rhistorico \u0026lt;- bind_rows(historico, nova_consulta)\rsave(historico, file = \u0026quot;historico.RData\u0026quot;)\r}\r}\rSys.sleep(frequencia)\r}\r\rPasso 7: Regras para mensagens de telegram\rAgora √© a hora de decidir o que o bot deve nos avisar! Deixei dois exemplos simples abaixo usando o m√©todo bot$sendMessage(), que como o nome sugere faz o bot enviar mensagem pra gente. Agora, toda vez que o pre√ßo da bitcoin valer menos que R$13.600 ou valer mais que R$14.600 eu vou ficar sabendo na hora!\n# caso o valor da cota√ß√£o atinja algum crit√©rio, envia uma mensagem via telegram.\rif(nova_consulta$buy \u0026lt; 13600 \u0026amp; nova_consulta$last \u0026gt; 13900) {\rbot$sendMessage(\u0026#39;baixa!\u0026#39;)\rbot$sendMessage(nova_consulta$buy)\r}\r# ...\rif(nova_consulta$buy \u0026gt; 14600 \u0026amp; nova_consulta$last \u0026lt; 14500) {\rbot$sendMessage(\u0026#39;alta!\u0026#39;)\rbot$sendMessage(nova_consulta$buy)\r}\r\rPasso Extra: Ideias mirabolantes do que fazer com telegram + R\rAqui reina a criatividade. D√° pra mandar gr√°ficos, sons, stickers e qualquer tipo de m√≠dia. Eu fiz um ggplot para ficar vendo a tend√™ncia, da√≠ poderia pedir para ver o gr√°fico ao meu bot a qualquer momento.\n# ... isso vai dentro da funcao acompanhar_bitcoin()\rp \u0026lt;- ggplot(historico %\u0026gt;%\rgather(indicador, valor, high, low, buy, sell, last)) +\rgeom_line(aes(x = timestamp, y = valor, colour = indicador))\rprint(p)\rTamb√©m √© poss√≠vel programar comandos para serem passados ao Bot para que ele construa algo para a gente, por exemplo, vc poderia criar um comando para comprar ou vender bitcoins em tempo real!\nO Julio uma vez criou um bot que era praticamente o pr√≥prio R, vc enviava c√≥digo como mensagem e ele retornava o output do R! Depois vou pedir pra ele postar algo sobre isso.\nEnfim, d√° pra ser engenhoso a√≠. Basta ter aquela ideia de chuveiro genial.\nExerc√≠cio para casa:\r- Enviar o gemid√£o do zap para 3 amigos via linha de c√≥digo.\nabs!\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-08-19-r-telegram-bitcoin/","tags":["telegram","bitcoin"],"title":"Como fazer o R avisar pelo telegram que bitcoin t√° barato"},{"author":["William"],"categories":["discuss√µes"],"contents":"\r\r‚Äî N√£o sabia que nessa cidade a cada 20 minutos atropelam um homem? ‚Äî Nossa! E como est√° o coitado?\n\rO epis√≥dio ‚ÄúEstat√≠sticas‚Äù do Chaves foi o meu primeiro contato com o conceito de Estat√≠stica (pelo menos que eu possa me lembrar). Claro que naquela √©poca, com 5 ou 6 anos, eu nunca imaginaria que seria essa a minha profiss√£o. Assim como o Quico e o Chaves, eu n√£o fazia muita ideia do que as ‚Äúsenhoras estat√≠sticas‚Äù‚Äù eram e continuei sem saber de fato at√© entrar na gradua√ß√£o, em 2007.\nReassistindo o epis√≥dio, depois de mais de dez anos estudando a disciplina, me identifiquei bastante com a dificuldade que a Dona Florinda e o Professor Girafales t√™m para explicar o que s√£o estat√≠sticas, o que antes via apenas como uma escada para as piadas que constroem a cena.\nQuando saio da minha bolha de colegas de faculdade e trabalho, percebo o quanto conceitos b√°sicos de probabilidade e estat√≠stica s√£o desconhecidos pela popula√ß√£o, mesmo aqueles presentes no dia a dia.\nRecentemente, lendo um coment√°rio de um radialista sobre a derrota do S√£o Paulo para o Coritiba, na rodada 18 do Campeonato Brasileiro, uma frase me chamou aten√ß√£o.\n\r‚ÄúAo iniciar o jogo dessa quinta √† noite, o Tricolor, de acordo com as estat√≠sticas, tinha 1,78% de chances de vencer o Coritiba.‚Äù\n\rA tese do radialista √© que a probabilidade dos quatro grandes times de S√£o Paulo vencerem na mesma rodada do campeonato √© de 1,78%, a frequ√™ncia relativa desse evento na era de pontos corridos do Campeonato Brasileiro. Como o S√£o Paulo foi o √∫ltimo grande a jogar e os outros tr√™s j√° haviam vencido, o pobre tricolor paulista teve suas chances reduzidas pelas estat√≠sticas e acabou perdendo o jogo.\nEssa interpreta√ß√£o com certeza pode ser refutada por v√°rios motivos, mas o que mais me incomodou foi o desconhecimento de probabilidade condicional, ou simplesmente como novas informa√ß√µes modificam as probabilidades dos eventos.\nEncucado, eu deixei uma resposta, cuja parte central √© essa:\n\rMesmo se consider√°ssemos que a probabilidade dos 4 grandes de SP ganharem numa rodada n√£o dependesse de fatores como a fase dos times, os advers√°rios, o momento do campeonato etc., esse n√∫mero, 1,78%, seria a probabilidade dos quatro ganharem antes da rodada come√ßar. Dado que j√° sabemos que os outros tr√™s ganharam, e considerando que o resultado desses jogos n√£o influenciam o jogo do SP, a probabilidade do evento em quest√£o ocorrer passa a ser apenas a probabilidade do SP ganhar o jogo dele.\n\rEm seguida, recebi alguns coment√°rios de outros torcedores dizendo (jocosamente) que n√£o tinham entendido nada do que escrevi. Comecei ent√£o a refletir sobre o assunto, pensando no quanto a minha explica√ß√£o poderia estar confusa e de que forma poderia ter explicado melhor, no quanto as pessoas n√£o costumam se esfor√ßar para entender temas que elas n√£o dominam e no quanto a falta de uma base matem√°tica adequada atrapalha nessas horas.\nEu acredito que a Probabilidade e a Estat√≠stica s√£o v√≠timas da onda do ‚Äú√© legal odiar Matem√°tica‚Äù, que muitas pessoas se orgulham de surfar. Crian√ßas saem da escola com um conhecimento superficial dessas disciplinas (quando muito!), achando que √© tudo uma quest√£o de jogar dados, calcular m√©dias e fazer gr√°ficos. Comunicadores sofrem para interpretar os n√∫meros de uma pesquisa e pesquisadores encaram a an√°lise estat√≠stica como o grande vil√£o que os separa da publica√ß√£o.\nFelizmente, esse comportamento vem mudando, mesmo que a passos lentos. Profissionais est√£o buscando cursos de data science e programa√ß√£o, empresas est√£o promovendo cursos para qualificarem seus funcion√°rios e o mercado para estat√≠sticos continua um c√©u estrelado, tanto para analistas e programadores quanto para educadores.\nEu vejo essa mudan√ßa, e as pessoas ao meu redor tamb√©m a veem. Mas o exemplo que citei acima me faz acreditar que preciso espiar fora da minha bolha.\nPor isso, vou come√ßar uma pequena s√©rie de posts, dando a minha opini√£o sobre algumas coisas que orbitam a educa√ß√£o estat√≠stica e a programa√ß√£o, com o objetivo de gerar reflex√£o e discuss√£o sobre o assunto. A Estat√≠stica vem crescendo como carreira, o estat√≠stico vem se tornando cada vez mais protagonista, e vejo esse momento como o ideal para melhorarmos a educa√ß√£o da nossa disciplina.\nA minha ideia inicial era fazer um √∫nico post, mas na era dos text√µes, n√£o quero colocar mais um na fila de voc√™s. Assim, dividirei nos seguintes t√≥picos:\n\rPor que amar a Estat√≠stica?\rPreconceitos no aprendizado\rEstat√≠stica e programa√ß√£o\r\rEspero que esses posts possam contribuir para mostrarmos para mais gente a import√¢ncia da Estat√≠stica e da Computa√ß√£o e por que amamos tanto trabalhar com essas ci√™ncias.\nAt√© breve!\n","permalink":"https://blog.curso-r.com/posts/2017-08-17-eu-a-estatistica-e-o-r/","tags":["estat√≠stica"],"title":"Eu, a Estat√≠stica e a programa√ß√£o"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\r\rS√£o Paulo √© a minha cidade preferida. N√£o s√≥ porque moro aqui, mas tamb√©m porque √© uma cidade cheia de diversidade, boa gastronomia e oportunidades. Para sentir um pouco dessa vibe, recomendo passear na avenida Paulista aos domingos. √â sensacional!\nMas a cidade da diversidade s√≥ √© o que √© porque temos muita, muita gente nela. O munic√≠pio tem 12 milh√µes de habitantes. Esse n√∫mero √© t√£o grande que temos um paulistano para cada 17 brasileiros! Se S√£o Paulo fosse um pa√≠s, seria o 77 do mundo, ganhando de pa√≠ses como a B√©lgica, Gr√©cia, Portugal, Bol√≠via e muitas outras.\nOutro dia eu estava pensando na seguinte problem√°tica: qual √© a √°rea do Brasil ocupada pela popula√ß√£o de S√£o Paulo? Ou seja, se pegarmos os munic√≠pios com grandes √°reas, quanto do pa√≠s conseguir√≠amos preencher com 12 milh√µes de habitantes?\nO interessante √© que essa quest√£o recai exatamente no problema da mochila, que √© um famoso desafio de programa√ß√£o inteira. Depois de estudar profundamente no wikipedia (üòÑ), vi que o problema n√£o √© t√£o trivial como parece.\nO problema da mochila\rConsidere o seguinte contexto: voc√™ tem uma mochila com capacidade de 15kg e precisa carregar a combina√ß√£o de itens com maior valor, com cada item possuindo valores e pesos diferentes.\nOutra forma de pensar nesse problema √© com um card√°pio de restaurante:\nEm linguagem matem√°tica, o que temos √© a task:\n\\[\r\\begin{aligned}\r\u0026amp; \\text{maximizar } \\sum_{i=1}^n v_i x_i \\\\ \u0026amp; \\text{sujeito √† } \\sum_{i=1}^n w_i x_i \\leq W, \\text{ com } x_i \\in\\{0,1\\}\\\\ \\end{aligned}\r\\]\nNo nosso caso essas letras significam isso aqui:\n\r\\(n\\) √© o n√∫mero de munic√≠pios no Brasil (5570).\r\\(v_i\\) √© a √°rea do munic√≠pio \\(i\\).\r\\(w_i\\) √© a popula√ß√£o do munic√≠pio \\(i\\).\r\\(W\\) √© a popula√ß√£o de S√£o Paulo (12 milh√µes).\r\\(x=(x_1,\\dots,x_n)^\\top\\) √© o vetor que seleciona os munic√≠pios. Se o munic√≠pio \\(i\\) faz parte da solu√ß√£o \\(x_i=1\\) e, caso contr√°rio, \\(x_i=0\\).\r\rOu seja, queremos escolher munic√≠pios para colocar na mochila tentando maximizar a √°rea, mas o m√°ximo de popula√ß√£o que podemos contemplar √© 12 milh√µes.\nO problema da mochila √© muito interessante pois trata-se de um problema NP-dif√≠cil, ou seja, n√£o existe um algoritmo de polinomial capaz de resolv√™-lo. Se \\(w_i \u0026gt; 0, \\forall i\\in1,\\dots,n\\) ent√£o a solu√ß√£o pode ser encontrada com um algoritmo pseudo-polinomial.\nForma ad-hoc\rSe \\(x_i\\) pudesse assumir valores entre zero e um (ou seja, se pud√©ssemos selecionar apenas peda√ßos de munic√≠pios), a solu√ß√£o seria trivial. Bastaria colocar os munic√≠pios em ordem decrescente pela raz√£o \\(v_i/w_i\\) e escolher os munic√≠pios ou parte deles at√© obter \\(W\\).\nIsso indica uma forma sub-√≥tima de resolver o problema. Chamamos essa solu√ß√£o de ad-hoc. A solu√ß√£o √© encontrada assim:\nColocar os munic√≠pios em ordem decrescente pela raz√£o \\(v_i/w_i\\),\rEscolher os munic√≠pios de maior raz√£o at√© que a popula√ß√£o do pr√≥ximo munic√≠pio estoure \\(W\\).\rEscolher outros munic√≠pios com maior raz√£o na ordem at√© n√£o ser poss√≠vel incluir mais nenhum munic√≠pio.\r\r\rSolu√ß√£o √≥tima\rA solu√ß√£o √≥tima pode ser encontrada usando a fun√ß√£o mknapsack() do pacote adagio. Por exemplo, considere os vetores de pesos w, valores p e m√°ximo cap abaixo.\np \u0026lt;- c(15, 100, 90, 60, 40, 15, 10, 1)\rw \u0026lt;- c( 2, 20, 20, 30, 40, 30, 60, 10)\rcap \u0026lt;- 102\rO vetor-solu√ß√£o √© dado por\nis \u0026lt;- adagio::mknapsack(p, w, cap)\ris$ksack\r[1] 1 1 1 1 0 1 0 0\r\r\rDados\rAs √°reas e estimativas das popula√ß√µes dos munic√≠pios do Brasil em 2010 foram obtidas dos pacotes {geobr} e {abjData}. A leitura √© realizada usando pacotes do {tidyverse}.\nPacotes:\nlibrary(magrittr)\rlibrary(sf)\rda_sf \u0026lt;- geobr::read_municipality(year = 2010)\rdados \u0026lt;- da_sf %\u0026gt;% dplyr::mutate(area = as.numeric(sf::st_area(geom)) / 1e6) %\u0026gt;% tibble::as_tibble() %\u0026gt;% dplyr::select(-geom) %\u0026gt;% dplyr::mutate(muni_id = as.character(code_muni)) %\u0026gt;% dplyr::inner_join(\rdplyr::filter(abjData::pnud_min, ano == \u0026quot;2010\u0026quot;), \u0026quot;muni_id\u0026quot;\r) %\u0026gt;% dplyr::select(muni_id, area, pop) %\u0026gt;% dplyr::mutate(razao = area / pop) %\u0026gt;% dplyr::filter(area \u0026gt; 0)\r\rResultados\rA solu√ß√£o ad-hoc e √≥tima s√£o computadas com esse c√≥digo:\nd_solucao \u0026lt;- dados %\u0026gt;% dplyr::arrange(dplyr::desc(razao)) %\u0026gt;% # ordena para solucao adhoc funcionar\rdplyr::mutate(\rarea2 = as.integer(area * 1000), # necessario para mknapsack funcionar\rs_knapsack = adagio::mknapsack(area2, pop, max(pop))$ksack,\racu = cumsum(pop),\rs_adhoc0 = dplyr::if_else(acu \u0026lt; max(pop), 1, 0),\rs_adhoc = s_adhoc0\r) \rAgora, vamos melhorar a solu√ß√£o ad-hoc incluindo os melhores munic√≠pios.\nid_melhor \u0026lt;- 0\rpop_faltam \u0026lt;- with(d_solucao, max(pop) - sum(s_adhoc0 * pop))\rwhile (is.na(id_melhor)) {\r# pega id do melhor municipio a ser incluido\rid_melhor \u0026lt;- with(d_solucao, which(pop \u0026lt;= pop_faltam \u0026amp; s_adhoc == 0)[1])\rif (is.na(id_melhor)) {\rd_solucao$s_adhoc[id_melhor] \u0026lt;- 1\rpop_faltam \u0026lt;- with(d_solucao, max(pop) - sum(s_adhoc * pop))\r}\r}\rA Tabela abaixo mostra os munic√≠pios que foram classificados diferentemente nos dois m√©todos. Note que a solu√ß√£o √≥tima trocou apenas um munic√≠pio da solu√ß√£o adhoc (Nova Aurora - GO) pelo munic√≠pio de Monte Alegre de Minas - MG.\nd_solucao %\u0026gt;% dplyr::filter(s_adhoc != s_knapsack) %\u0026gt;% dplyr::inner_join(abjData::muni, \u0026quot;muni_id\u0026quot;) %\u0026gt;% select(uf_nm, muni_nm, area, pop, s_adhoc, s_knapsack) %\u0026gt;% knitr::kable(caption = \u0026#39;Munic√≠pios diferentes nas duas solu√ß√µes.\u0026#39;)\r\r\ruf_nm\rmuni_nm\rarea\rpop\rs_adhoc\rs_knapsack\r\r\r\rPiau√≠\rCol√¥nia Do Piau√≠\r949.0047\r7387\r0\r1\r\rTocantins\rRiachinho\r517.6699\r4030\r0\r1\r\rSanta Catarina\rPalmeira\r289.4767\r2291\r0\r1\r\r\r\rA Tabela abaixo mostra a diferen√ßa dos resultados dos dois m√©todos. A solu√ß√£o √≥tima fica com apenas 92 pessoas a menos que S√£o Paulo.\n\r\rM√©todo\r√Årea total\rPopula√ß√£o total\rDiferen√ßa para sp\r\r\r\radhoc\r5669732.52073351\r11152637\r13906\r\rknapsack\r5671488.67201654\r11166345\r198\r\rS√£o Paulo\r-\r11166543\r0\r\r\r\r\rMapa final\rVisualmente, a solu√ß√£o √≥tima e a solu√ß√£o adhoc s√£o id√™nticas. Por isso vou mostrar apenas como fica o mapa para a solu√ß√£o √≥tima.\nO resultado aparece na Figura 1. √â realmente impressionante ver que aquela regi√£ozinha vermelha tem a mesma popula√ß√£o que toda a regi√£o azul do mapa.\nda_sf %\u0026gt;% dplyr::mutate(muni_id = as.character(code_muni)) %\u0026gt;% dplyr::inner_join(d_solucao, \u0026quot;muni_id\u0026quot;) %\u0026gt;% ggplot2::ggplot() +\rggplot2::geom_sf(\rggplot2::aes(fill = as.factor(s_knapsack)),\rsize = 0\r) +\rggplot2::geom_sf(\rfill = \u0026quot;red\u0026quot;,\rsize = 0,\rcolour = \u0026quot;black\u0026quot;,\rdata = dplyr::filter(da_sf, code_muni == \u0026quot;3550308\u0026quot;)\r) +\rggplot2::scale_fill_manual(\rvalues = c(\u0026quot;gray90\u0026quot;, viridis::viridis(1, 1, .2, .8))\r) +\rggplot2::theme_void() +\rggplot2::theme(legend.position = \u0026quot;bottom\u0026quot;) +\rggplot2::labs(fill = \u0026quot;Solu√ß√£o\u0026quot;)\r\rFigura 1: Resultado final da an√°lise. A √°rea em azul tem a mesma popula√ß√£o da √°rea em vermelho!\r\r√â isso! Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-04-10-sao-paulo/","tags":["mapas"],"title":"S√£o Paulo e o problema da mochila"},{"author":["Fernando"],"categories":["conceitos"],"contents":"\r\rA caracter√≠stica mais importante de um modelo estat√≠stico √© a sua flexibilidade. Esse termo pode ser entendido de v√°rias formas, mas neste texto vou considerar que um modelo √© flex√≠vel se ele explica coerentemente uma ampla gama de fen√¥menos reais.\nPensando assim, a regress√£o linear pode ser considerada um modelo flex√≠vel, j√° que muitas rela√ß√µes funcionais cotidianas s√£o do tipo \\(y = \\beta x\\). √â justamente por causa dessa flexibilidade que a boa e velha regress√£o de m√≠nimos quadrados √© t√£o usada, at√© mesmo aonde n√£o deveria. O seu uso √© t√£o indiscriminado que uma vez, em aula, um professor extraordinariamente admir√°vel me disse que ‚Äú90% dos problemas do mundo podem ser resolvidos com uma regress√£o linear‚Äù.\nSendo bastante honesto, √© prov√°vel que o meu professor esteja certo, mas este post n√£o √© sobre isso. Este √© um post sobre o que fazer quando a regress√£o linear simples n√£o basta. No que segue, vamos discutir uma pequena (e poderosa) extens√£o do modelo de regress√£o linear simples, mas antes de prosseguir para o problema propriamente dito (e sua implementa√ß√£o em R), vamos discutir da teoria que existe por tr√°s dele.\nRegress√£o linear √© programa√ß√£o quadr√°tica\rEmbora seja pouco enfatizado nos bacharelados de estat√≠stica, uma regress√£o linear pode ser formulada como um problema de programa√ß√£o quadr√°tica. Entrando nos detalhes, essa afirma√ß√£o deve-se a dois fatos:\nExiste uma teoria, que chama-se programa√ß√£o quadr√°tica, que soluciona problemas da forma\r\r\\[\\min_x \\frac{1}{2}x\u0026#39; Q x + c\u0026#39; x,\\]\nonde \\(x \\in \\mathbb{R}^p\\) e \\(Q\\) e \\(c\\) tem dimens√µes que fazem a conta acima ter sentido. A teoria ocupa-se desenvolvendo algoritmos exatos e aproximados para obter solu√ß√µes desses problemas, inclusive com generaliza√ß√µes:\n\\[\\min_x \\frac{1}{2}x\u0026#39; Q x + c\u0026#39; x, \\text{ sujeito a }Ax \\geq 0.\\]\nUma regress√£o linear consiste em resolver\r\r\\[\\min_\\beta (Y - \\beta X)\u0026#39;(Y-\\beta X),\\]\nque, com um pouco de √°lgebra, √© equivalente √†\n\\[ \\min_\\beta -2Y\u0026#39;X\\beta + \\beta\u0026#39;X\u0026#39;X\\beta.\\]\nLogo, tomando \\(Q = 2X\u0026#39;X\\) e \\(c = \\frac{1}{2}X\u0026#39;Y\\) tem-se que esse √© um problema de programa√ß√£o quadr√°tica, que por sua vez √© um problema convexo, que, segundo a teoria, tem uma √∫nica solu√ß√£o no ponto \\(\\beta = (X\u0026#39;X)^{-1}X\u0026#39;Y\\).\n\rUma regress√£o linear simples mais flex√≠vel\rTalvez o jeito mais simples de flexibilizar uma regress√£o linear no sentido mencionado no come√ßo desse texto √© restringir os seus par√¢metros. Em muitos contextos, esse √© o √∫nico jeito de colocar conhecimentos pr√©vios na modelagem1.\nUm caso bastante emblem√°tico aparece nas curvas de cr√©dito divulgadas pela ANBIMA2. L√°, ajusta-se um conjunto de curvas que depende de 6 par√¢metros e cada curva representa uma classifica√ß√£o de risco (que nem aquela em que o Brasil pode tomar downgrade3). Como os n√≠veis de risco est√£o ordenados, √© natural exigir que tamb√©m exista uma ordena√ß√£o entre as curvas. Sem entrar em detalhes, a ideia pode ser expressa assim:\n\\[\\beta_{AAA} \u0026lt; \\beta_{AA} \u0026lt; \\beta_{A} \u0026lt; \\beta_{BBB} \u0026lt; ...\\]\nO que √© que isso tem a ver com programa√ß√£o quadr√°tica? A resposta √© que a inequa√ß√£o acima pode ser escrita como \\(A\\beta \\geq 0\\), de tal forma j√° existe uma teoria para resolver uma regress√£o linear simples com restri√ß√µes desse tipo! Basta que ela seja vista como um problema de programa√ß√£o quadr√°tica.\n\rO pacote quadprog\rExiste um pacote de R para quase tudo, ent√£o, como n√£o poderia deixar de ser, existe um pacote em R para resolver problemas do tipo:\n\\[\\min_x \\frac{1}{2}x\u0026#39; Q x + c\u0026#39; x, \\text{ sujeito a }Ax \\geq 0.\\]\nPara ilustrar o seu uso, vamos considerar um exemplo. Vamos simular um conjunto de dados em que \\(\\beta_5 = 0.31, \\beta_4 = 0.43, \\beta_3 = 1.31, \\beta_2 = 2.19, \\beta_1 = 2.29\\) s√£o os valores reais que precisamos estimar, considere que vale\n\\[Y \\approx \\beta_1X_1 + \\beta_2X_2+\\beta_3X_3+\\beta_4X_4+\\beta_5X_5\\]\ne que o erro de regress√£o tem distribui√ß√£o normal.\nset.seed(11071995)\rN \u0026lt;- 30\rbetas \u0026lt;- c(2.29, 2.19, 1.31, 0.43, 0.31)\rX \u0026lt;- matrix(rnorm(5*N), byrow = T, ncol = length(betas), nrow = N)\rY \u0026lt;- X %*% betas + rnorm(N, sd = 3)\rSe soubermos a priori que valem as seguintes afirma√ß√µes\n\\[ \\beta_1,\\beta_2,\\beta_3,\\beta_4,\\beta_5 \u0026gt; 0 \\text{ e } \\beta_1 \u0026gt; \\beta_2 \u0026gt; \\beta_3 \u0026gt; \\beta_4 \u0026gt; \\beta_5,\\]\na minimiza√ß√£o de \\((Y-\\beta X)\u0026#39;(Y-\\beta X)\\) pode ser resolvida usando a fun√ß√£o solve.QP. Tudo que precisamos fazer √© escrever o conjunto de inequa√ß√µes na forma \\(A\\beta \\geq 0\\). Mas isso √© bem f√°cil! Basta notar que as restri√ß√µes s√£o equivalentes √†\n\\[ \\left(\\begin{array}{cccc}\r1 \u0026amp; 0 \u0026amp; 0 \u0026amp; 0 \u0026amp; 0 \\\\\r0 \u0026amp; 1 \u0026amp; 0 \u0026amp; 0 \u0026amp; 0 \\\\\r0 \u0026amp; 0 \u0026amp; 1 \u0026amp; 0 \u0026amp; 0 \\\\\r0 \u0026amp; 0 \u0026amp; 0 \u0026amp; 1 \u0026amp; 0 \\\\\r0 \u0026amp; 0 \u0026amp; 0 \u0026amp; 0 \u0026amp; 1 \\\\\r1 \u0026amp; -1 \u0026amp; 0 \u0026amp; 0 \u0026amp; 0 \\\\\r0 \u0026amp; 1 \u0026amp; -1 \u0026amp; 0 \u0026amp; 0 \\\\\r0 \u0026amp; 0 \u0026amp; 1 \u0026amp; -1 \u0026amp; 0 \\\\\r0 \u0026amp; 0 \u0026amp; 0 \u0026amp; 1 \u0026amp; -1 \\\\\r\\end{array}\\right) \\times \\left(\\begin{array}{c}\\beta_1 \\\\ \\beta_2 \\\\ \\beta_3 \\\\ \\beta_4 \\\\ \\beta_5 \\end{array}\\right) \\geq 0.\\]\nDessa forma, o problema est√° prontinho pra passar no moedor de carne, com uma √∫ltima ressalva. O problema resolvido no solve.QP √©\n\\[\\min_x \\frac{1}{2}x\u0026#39; Q x + c\u0026#39; x, \\text{ sujeito a }A\u0026#39;x \\geq 0,\\]\nent√£o vamos ter que tomar o cuidado de passar as nossas restri√ß√µes atrav√©s do transposto da matriz que obtivemos acima. Isso resultar√° na matriz \\(A\\).\nlibrary(tidyverse)\rlibrary(quadprog)\rQ \u0026lt;- t(X) %*% X\rc \u0026lt;- t(Y) %*% X\rA \u0026lt;- cbind(c(1,0,0,0,0),c(0,1,0,0,0),c(0,0,1,0,0),\rc(0,0,0,1,0),c(0,0,0,0,1),c(1,-1,0,0,0),\rc(0,1,-1,0,0),c(0,0,1,-1,0),c(0,0,0,1,-1))\rsolucao \u0026lt;- solve.QP(Q, # X\u0026#39;X\rc, # Y\u0026#39;X\rA, # A transposta\rc(0,0,0,0,0,0,0,0,0)) # vetor de compara√ß√£o\rPara checar como valeu a pena todo esse esfor√ßo, d√° uma olhada na diferen√ßa entre as estimativas! Os pontinhos vermelhos s√£o as estimativas do modelo irrestrito, enquanto as barras s√£o as estimativas do modelo com restri√ß√µes.\n\rConclus√µes\r\rRegress√£o linear simples √© um problema de programa√ß√£o quadr√°tica.\rAlgumas restri√ß√µes interessantes podem ser escritas na forma \\(B\\beta \\geq 0\\).\rPrograma√ß√£o quadr√°tica resolve regress√£o linear simples com restri√ß√µes lineares.\rSe em algum dia voc√™ topar com um bicho desses, o quadprog pode resolver o problema pra voc√™.\r\r\r\rA menos que voc√™ seja uma pessoa razo√°vel bayesiano.‚Ü©Ô∏é\n\rhttp://www.anbima.com.br/data/files/05/43/3E/84/E12D7510E7FCF875262C16A8/metodologia-curvas_20credito_20131104_v2_1_.pdf‚Ü©Ô∏é\n\rhttp://economia.estadao.com.br/noticias/geral,agravamento-da-crise-politica-eleva-risco-de-rebaixamento-do-brasil-diz-sep,70001824274‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-08-07-minimos-quadrados-restrito/","tags":["conceitos","regress√£o"],"title":"M√≠nimos quadrados com restri√ß√µes lineares"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\r\r\rEsse post assume uma vers√£o mais antiga do decryptr para instalar a vers√£o usada use: devtools::install_github(\"decryptr/decryptr@05bfd48\")\n\rNo √∫ltimo post sobre CAPTCHAs n√≥s vimos que a segmenta√ß√£o das imagens (separar uma imagem em v√°rias imagens, uma para cada caractere) √© um problema complicado. Definir uma largura fixa ou utilizar outros m√©todos ad-hoc para segmentar as imagens pode dar bons frutos, mas n√£o √© o suficiente para quebrar CAPTCHAs mais complexos, como o da Receita Federal.\nAlguns meses atr√°s, tentamos resolver esse problema de v√°rias formas. Uma delas foi utilizar algoritmos de agrupamento (\\(k\\)-m√©dias) ou de identifica√ß√£o de conjuntos conectados. Esses algoritmos se mostraram inst√°veis e n√£o aumentaram muito o poder preditivo. Outra ideia que tentamos foi criar v√°rios crit√©rios de corte fixos e incluir todas as colunas geradas na base de dados. Mas isso deixou nos deixou com uma dimens√£o muito grande pra tratar, e parecia que os modelos precisavam de muito mais dados pra come√ßarem a funcionar.\nFoi a√≠ que o Daniel nos disse que estava trabalhando no pacote do Keras e que existia uma forma de trabalhar com a imagem completa, sem segmentar. A tarefa de segmenta√ß√£o seria ‚Äúparametrizada‚Äù num model√£o complexo de deep learning e conseguir√≠amos resolver o problema sem pr√©-processamento.\nInicialmente, eu e o Athos ficamos perplexos com a ideia. Foi s√≥ quando o Daniel mostrou um modelo que acertava 100% dos CAPTCHAs do TJMG que fomos convencidos, e passamos a chamar esse modelo de ‚Äúmagia negra‚Äù.\nNesse post, vamos discutir como montar a base para fazer a magia negra.\nResposta\rNossa resposta n√£o √© mais uma categoria, e sim uma matriz. A matriz tem \\(k\\) linhas (n√∫mero de letras em um CAPTCHA) \\(p\\) colunas (n√∫mero de valores poss√≠veis de um caractere). O elemento \\((i,j)\\) vale 1 se na posi√ß√£o \\(i\\) aparece a letra relativa √† posi√ß√£o \\(j\\).\nAssim,\na49f36\rvira isso: (substitu√≠ 0 por '.' para ficar mais f√°cil de ver)\nIsso para uma imagem. Vamos precisar de uma terceira dimens√£o, que s√£o as ‚Äúlinhas‚Äù de nossa resposta (uma para cada CAPTCHA).\nNosso y final √© um array de dimens√µes \\(n \\times k \\times p\\). Achou estranho? Estamos s√≥ come√ßando!\n\rExplicativas\rUma imagem nada mais √© do que uma matriz de pixels. Cada elemento da matriz √© um n√∫mero entre zero e um indicando o quanto de cor h√° nesse pixel. Assim, zero significa preto (aus√™ncia de cor), e um significa branco (todas as cores). Valores intermedi√°rios d√£o escala de cinza. Para representar imagens com cores, √© necess√°ria uma terceira dimens√£o de tamanho 3, indicando os pesos de R (red) G (green) e B (blue).\nAssim, nossa base de dados de explicativas √© um array de dimens√µes \\(n \\times h \\times w \\times 3\\), em que \\(h\\) e \\(w\\) s√£o a altura e a largura da imagem, respectivamente.\n\rFun√ß√£o prepare\rPara facilitar a vida, criamos uma fun√ß√£o prepare que prepara os arquivos de imagem num formato adequado para ajuste dos modelos usando o Keras.\nVeja um exemplo com 30 CAPTCHAs do TJMG. Aqui temos apenas cinco n√∫meros por imagem, ent√£o \\(k=5\\) e \\(p=10\\).\nlibrary(decryptr)\rarqs \u0026lt;- dir(\u0026#39;../../static/data/captcha-dados/tjmg\u0026#39;, full.names = TRUE)\rd_captcha \u0026lt;- arqs %\u0026gt;% read_captcha(ans_in_path = TRUE) %\u0026gt;%\rjoin_captchas()\rstr(d_captcha)\r\rWrap-up\r\rSegmentar as imagens √© complicado\rVamos trabalhar com a imagem completa, mas precisamos de uma estrutura de dados adequada.\rNossa resposta ser√° um array de dimens√£o #captchas x #caracteres x #categorias, preenchidas sempre com zeros e uns.\rNossa explicativa ser√° um array de dimens√£o #captchas x altura x largura x 3, preenchidas com n√∫meros entre zero e um, com os pesos de vermelho, verde e azul.\rUse a fun√ß√£o decryptr::prepare() num vetor de caminhos de arquivos classificados para montar a base de forma adequada.\r\r\rNext\rNo pr√≥ximo post sobre esse tema, vamos falar um pouco das redes neurais profundas que vamos ajustar.\n√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-29-captcha-dados/","tags":["captcha"],"title":"Quebrando CAPTCHAs - Parte IV: Trabalhando com a imagem completa"},{"author":["Athos"],"categories":["conceitos"],"contents":"\r\rObjetivos\rA finalidade do post √©:\n\raprender a fazer uma regress√£o log√≠stica com o keras\raprender a fazer um PCA com o keras\raproximar o Deep Learning do que j√° havia de conhecido pela maioria dos analistas de dados.\rinstigar a todos que vieram antes do deep learning a estudar e a ficar √† vontade com as novidades em torno dela.\rmostrar que muitos profissionais inseridos na √°rea de machine learning j√° conheciam grande parte do que o deep learning usa.\rlevantar discuss√£o sobre alguns mitos que n√£o s√£o construtivos para a comunidade dos analistas de dados.\r\r\rMotiva√ß√£o\rLi estat√≠sticos, cientistas da computa√ß√£o, engenheiros de dados a afins questionando o futuro do Machine Learning e se tudo que conhec√≠amos antes sobre modelagem estat√≠stica havia ficado obsoleto (como essa pergunta no Quora: Should I Quit Machine Learning?).\nE em conversas com pessoas pr√≥ximas percebia certa ufania pela novidade e frustra√ß√£o pela ‚Äúobsol√™ncia‚Äù do que se havia investido tempo estudando antes.\nPara piorar, aproveitadores pegaram jacar√© nessa onda para fazer marketing malicioso com o intuito de desvalorizar e dividir a comunidade dos analistas de dados. Algo bem similar com o que aconteceu com outras palavras da moda como data science, big data, Python versus R e a pr√≥pria machine learning. Antes havia a cl√°ssica propaganda de que a empresa X utilizava MACHINE LEARNING em vez de modelos preditivos. Agora a coisa evoluiu e apelam para o uso da palavra Deep Learning.\nO que realmente importa:\nDeep Learning √© uma grande novidade e colocou a Intelig√™ncia Artificial em evid√™ncia.\rQuem manjava Machine Learning antes vai conseguir aplicar 95% do seu conhecimento nas aplica√ß√µes de Deep Learning (incluindo baysianismo, bootstrap, infer√™ncia, probabilidade e a boiada toda).\rDeep Learning tem que ser visto como uma ferramenta a mais na caixa do analista de dados e n√£o um substituto.\r\rE para abordar essa quest√£o resolvi ajustar uma regress√£o log√≠stica usando deep learning para que todos que j√° fizeram uma regress√£o log√≠stica antes possam dizer que j√° fizeram uma rede neural tamb√©m! Confesso ter uma leve motiva√ß√£o provocativa, mas qual gra√ßa teria se assim n√£o fosse? =P\n\rO que faremos\r\rRegress√£o log√≠stica para \\(Y_1\\) (com glm)\rDeep Learning para \\(Y_1\\) (com keras)\rMostrar que regress√£o log√≠stica n√£o √© o melhor para \\(Y_2\\) e que Deep Learning vai al√©m da limita√ß√£o dos modelos lineares (com glm)\rDeep Learning para \\(Y_2\\) (com keras)\r\rM√£os √† obra.\nPacotes\rlibrary(keras)\rlibrary(dplyr)\rlibrary(tidyr)\rlibrary(forcats)\rlibrary(ggplot2)\r\r\rRegress√£o log√≠stica versus Deep Learning\rHora de ajustar modelos para os mesmos dados de duas maneiras diferentes: regress√£o log√≠stica com glm e deep learning com o keras.\nDados simulados\rlogit \u0026lt;- function(p) log(p) - log(1 - p)\rlogistic \u0026lt;- function(x) 1/(1 + exp(-x))\rn \u0026lt;- 100000\rset.seed(19880923)\rdf \u0026lt;- data_frame(x = runif(n, -2, 2.5)) %\u0026gt;% mutate(y_1 = rbinom(n, 1, prob = logistic(-1 + 2 * x)), # y_1\ry_2 = rbinom(n, 1, prob = logistic(-1 + 2 * tanh(-1 + 2 * x)))) # y_2\rO c√≥digo acima criou duas vari√°veis respostas (targets). Em representa√ß√£o matem√°tica, elas possuem as seguintes defini√ß√µes:\nResposta y_1\n\\[E[Y_1|x] = \\text{logistic}{(-1 + 2x)} = \\frac{1}{1 + e^{{-(-1 + 2x)}}}\\]\nResposta y_2\n\\[E[Y_2|x] = \\text{logistic}{(-1 + 2\\tanh(-1 + 2x))} = \\frac{1}{1 + e^{{-(-1 + 2\\tanh(-1 + 2x))}}}\\]\n\\(x\\) √© linear no logito de y_1, ent√£o a regress√£o log√≠stica vai cair bem para descobrir os par√¢metros \\(-1\\) e \\(2\\).\rPor√©m, \\(x\\) n√£o √© linhar no logito de y_2 e por isso a regress√£o log√≠stica n√£o conseguir√° representar fielmente o gerador de y_2.\nOBS 1: A forma \\(\\text{logistic}{(\\beta_0 + \\beta_1\\tanh(\\beta_2 + \\beta_3X))}\\) tem par√¢metros dentro do fun√ß√£o tanh, o que significa que a nossa hip√≥tese para \\(E[Y_2|x]\\) n√£o √© mais linear nos par√¢metros. Por isso que modelos lineares (como o nome sugere) n√£o s√£o mais indicados. E a n√£o linearidade √© uma das generaliza√ß√µes que as redes neurais nos fornece! (sim, isso √© muito relevante)\nOBS 2: √© claro que nesse caso bem simples de uma vari√°vel conseguir√≠amos inspecionar os dados para chegar em boas transforma√ß√µes de \\(x\\) de tal forma que o ajuste da log√≠stica ficasse t√£o bom quanto o de uma rede neural, mas se acrescent√°ssemos muitas outras vari√°veis a√≠ a coisa complicaria!\nEm representa√ß√£o de redes neurais, as f√≥rmulas acima ficam assim:\nResposta y_1\nResposta y_2\nO que era fun√ß√£o de liga√ß√£o no GLM, em redes neurais virou fun√ß√£o de ativa√ß√£o (no final eu falo mais sobre vocabul√°rios que mudaram).\n\rOlhada nos dados\r# skimr::skim(df) %\u0026gt;% skim_print %\u0026gt;% with(numeric) %\u0026gt;% mutate_if(is.numeric, round, 2) %\u0026gt;% DT::datatable()\rdf %\u0026gt;% gather(y_id, y_val, y_1, y_2) %\u0026gt;%\rmutate(x_cat = cut_number(x, n = 70)) %\u0026gt;%\rgroup_by(x_cat, y_id) %\u0026gt;%\rsummarise(p = mean(y_val),\rn = n()) %\u0026gt;%\rmutate(logit_p = logit(p)) %\u0026gt;%\rgather(transformacao, p, p, logit_p) %\u0026gt;%\rmutate(transformacao = transformacao %\u0026gt;% fct_inorder %\u0026gt;% fct_recode(\u0026quot;logit(p)\u0026quot; = \u0026quot;logit_p\u0026quot;)) %\u0026gt;%\rggplot() +\rgeom_point(aes(x = x_cat, y = p, colour = y_id)) +\rtheme_minimal(20) +\rtheme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +\rfacet_wrap(~forcats::fct_inorder(transformacao), nrow = 1, scales = \u0026quot;free_y\u0026quot;) +\rlabs(x = \u0026quot;x\u0026quot;, colour = \u0026quot;resposta\u0026quot;) +\rtheme(axis.text.x = element_blank(),panel.grid.major.x = element_blank(), panel.grid.minor.y = element_blank())\r## `summarise()` regrouping output by \u0026#39;x_cat\u0026#39; (override with `.groups` argument)\rO gr√°fico da direita mostra que x √© proporcional ao logito das probabilidades de y_1 (em vermelho) como era pra ser por termos constru√≠do assim.\rJ√° com o y_2 (em azul) ainda ficou parecendo uma sigmoide mesmo depois da transforma√ß√£o.\n\rAjuste de modelos\rRegress√£o log√≠stica para \\(Y_1\\) (com glm)\r# modelo glm 1 ------------------------------------------------------\rmodelo_glm_1 \u0026lt;- glm(y_1 ~ x, data = df, family = binomial)\r# coefficients\rcoef(modelo_glm_1)\r# (Intercept) x # -1.018434 2.011647 # accuracy\rconf_matrix_glm_1 \u0026lt;- table(modelo_glm_1$fitted.values \u0026gt; 0.5, df$y_1)\rsum(diag(conf_matrix_glm_1))/sum(conf_matrix_glm_1)\r# [1] 0.85061\rAs estimativas ficaram bem pr√≥ximas dos verdadeiros valores \\(\\beta_0 = -1\\) e \\(\\beta_1 = 2\\).\nA acur√°cia foi de 85%.\n\rDeep Learning para \\(Y_1\\) (com keras)\rVamos montar nossa hip√≥tese para \\(E[Y_1|x]\\).\n# modelo keras 1 -------------------------------------------------------\r# input: 1 vari√°vel: o x.\rinput_keras_1 \u0026lt;- layer_input(1, name = \u0026quot;modelo_keras_1\u0026quot;)\r# output: n√£o h√° camadas escondidas, apenas a fun√ß√£o de liga√ß√£o logit diretamente.\routput_keras_1 \u0026lt;- input_keras_1 %\u0026gt;% layer_dense(units = 1, name = \u0026quot;camada_unica\u0026quot;) %\u0026gt;%\rlayer_activation(\u0026quot;sigmoid\u0026quot;, input_shape = 1, name = \u0026quot;link_logistic\u0026quot;) # sigmoid no tensorflow √© a logistic\r# keras_model √© o que constr√≥i a nossa hip√≥tese f(x) (da E[y] = f(x))\rmodelo_keras_1 \u0026lt;- keras_model(input_keras_1, output_keras_1)\r# summary(modelo_keras_1)\rModel\r_____________________________________________________________\rLayer (type) Output Shape Param # =============================================================\rmodelo_keras_1 (InputLayer) (None, 1) 0 _____________________________________________________________\rcamada_unica (Dense) (None, 1) 2 _____________________________________________________________\rlink_logistic (Activation) (None, 1) 0 =============================================================\rTotal params: 2\rTrainable params: 2\rNon-trainable params: 0\r_____________________________________________________________\rA hip√≥tese constru√≠da tem 2 par√¢metros. Parece que est√° certo! \\(\\beta_0\\) e \\(\\beta_1\\).\nAgora √© a vez da fun√ß√£o de perda.\nComo nosso objetivo √© construir uma regress√£o log√≠stica, n√≥s vamos escolher a fun√ß√£o de perda binary_crossentropy que √© sin√¥nimo de deviance da log√≠stica, termo mais comum no mundo da estat√≠stica.\nA m√©trica 'accuracy' n√£o entra no otimizador da fun√ß√£o de perda, a gente usa ela para comparar os modelos que criamos. No caso vamos comparar com o modelo glm ajustado acima (mas, por exemplo, em caso de eventos raros a 'accuracy' n√£o vai ser muito informativa, da√≠ poder√≠amos usar 'auc', 'gini', etc.).\nmodelo_keras_1 %\u0026gt;% compile(\rloss = \u0026#39;binary_crossentropy\u0026#39;,\roptimizer = optimizer_sgd(lr = 0.4),\rmetrics = c(\u0026#39;accuracy\u0026#39;)\r)\rmodelo_keras_1_fit \u0026lt;- modelo_keras_1 %\u0026gt;% fit(\rx = df$x, y = df$y_1, epochs = 20, batch_size = 1000,\rverbose = 0\r)\r# coefficients\rmodelo_keras_1 %\u0026gt;% get_layer(\u0026quot;camada_unica\u0026quot;) %\u0026gt;% get_weights\r# [[1]]\r# [,1]\r# [1,] 2.000054\r# # [[2]]\r# [1] -1.015561\r# accuracy\rloss_and_metrics_1 \u0026lt;- modelo_keras_1 %\u0026gt;% evaluate(df$x, df$y_1, batch = 100000, verbose = 0)\rloss_and_metrics_1[[2]]\r# [1] 0.85053\rResultados id√™nticos! Era para assim ser porque constru√≠mos a mesma hip√≥tese e a memsa fun√ß√£o de perda do glm.\n\rRegress√£o log√≠stica para \\(Y_2\\) (com glm)\rPara modelar \\(Y_2\\) vamos pisar em terrenos que os modelos lineares n√£o pisam.\rPrimeiro tento ajustar uma curva uasndo x e a transforma√ß√£o tanh(x). Esse preditor eu suponho que escolhi depois de uma minuciosa e demorada inspe√ß√£o dos dados (tentei simular mais ou menos o que eu faria numa modelagem onde eu que teria que construir as features na m√£o).\n# modelo glm 2 ------------------------------------------------------\rmodelo_glm_2 \u0026lt;- glm(y_2 ~ x + tanh(x), data = df, family = binomial)\r# coefficients\rcoef(modelo_glm_2)\r# (Intercept) x tanh(x) # -1.6698641 0.3043212 2.0936353\r# accuracy\rconf_matrix_glm_2 \u0026lt;- table(modelo_glm_2$fitted.values \u0026gt; 0.5, df$y_2)\rsum(diag(conf_matrix_glm_2))/sum(conf_matrix_glm_2)\r# [1] 0.82204\rAcur√°cia de 82%, nada mal. Mas a hip√≥tese e par√¢metros foram distintos do verdadeiro gerador dos dados. Vamos usar redes neurais para resolver o problema de n√£o linearidade.\n\rDeep Learning para \\(Y_2\\) (com keras)\rHip√≥tese para \\(E[Y_2|x]\\).\n# modelo keras 2 -------------------------------------------------------\rinput_keras_2 \u0026lt;- layer_input(1, name = \u0026quot;modelo_keras_2\u0026quot;)\routput_keras_2 \u0026lt;- input_keras_2 %\u0026gt;%\rlayer_dense(units = 1, name = \u0026quot;camada_um\u0026quot;) %\u0026gt;% layer_activation(\u0026quot;tanh\u0026quot;, input_shape = 1, name = \u0026quot;tanh_de_dentro\u0026quot;) %\u0026gt;%\rlayer_dense(units = 1, input_shape = 1, name = \u0026quot;camada_dois\u0026quot;) %\u0026gt;% layer_activation(\u0026quot;sigmoid\u0026quot;, input_shape = 1, name = \u0026quot;link_logistic\u0026quot;)\rmodelo_keras_2 \u0026lt;- keras_model(input_keras_2, output_keras_2)\rsummary(modelo_keras_2)\rModel\r_____________________________________________________________\rLayer (type) Output Shape Param # =============================================================\rmodelo_keras_2 (InputLayer) (None, 1) 0 _____________________________________________________________\rcamada_um (Dense) (None, 1) 2 _____________________________________________________________\rtanh_de_dentro (Activation) (None, 1) 0 _____________________________________________________________\rcamada_dois (Dense) (None, 1) 2 _____________________________________________________________\rlink_logistic (Activation) (None, 1) 0 =============================================================\rTotal params: 4.0\rTrainable params: 4.0\rNon-trainable params: 0.0\r_____________________________________________________________\r\rQuatro par√¢metros ‚Äòtrein√°veis‚Äô, √© isso a√≠! Dois par√¢metros de dentro do tanh e os dois par√¢metros de fora. Precisamos que o keras nos devolva -1, 2, -1 e 2 do jeito que geramos os dados.\nFun√ß√£o de custo\nmodelo_keras_2 %\u0026gt;% compile(\rloss = \u0026#39;binary_crossentropy\u0026#39;,\roptimizer = optimizer_sgd(lr = 0.1),\rmetrics = c(\u0026#39;accuracy\u0026#39;)\r)\rmodelo_keras_2_fit \u0026lt;- modelo_keras_2 %\u0026gt;% fit(\rx = df$x, y = df$y_2, epochs = 20, batch_size = 100,\rverbose = 0\r)\r# coefficients\rmodelo_keras_2 %\u0026gt;% get_layer(\u0026quot;camada_um\u0026quot;) %\u0026gt;% get_weights\r# [[1]]\r# [,1]\r# [1,] 2.012015\r# # [[2]]\r# [1] -1.058052\rmodelo_keras_2 %\u0026gt;% get_layer(\u0026quot;camada_dois\u0026quot;) %\u0026gt;% get_weights\r# [[1]]\r# [,1]\r# [1,] 1.981977\r# # [[2]]\r# [1] -1.006567\r# accuracy\rloss_and_metrics_2 \u0026lt;- modelo_keras_2 %\u0026gt;% evaluate(df$x, df$y_2, batch_size = 100000)\rloss_and_metrics_2[[2]]\r# [1] 0.82221\rPrecis√£o de 82% tamb√©m, mas agora os par√¢metros est√£o bem pr√≥ximos daqueles que geraram os dados! Acabamos de ver um conjunto de par√¢metros sendo encontrados mesmo com rela√ß√£o n√£o linear entre eles e a m√©dia.\nA precis√£o entre os dois modelos at√© que se equiparou, mas o gr√°fico das hip√≥teses encontradas (abaixo) mostra que a curva do glm est√° pior do que a curva do keras.\ndf %\u0026gt;% select(x, y_2) %\u0026gt;%\rmutate(x_cat = cut_number(x, n = 50)) %\u0026gt;%\rgroup_by(x_cat) %\u0026gt;%\rsummarise(p = mean(y_2),\rx = mean(x),\rkeras = logistic(-1.006567 + 1.981977 * tanh(-1.058052 + 2.012015 * x)), glm = logistic(-1.6698641 + 0.3043212*x + 2.0936353 * tanh(x)),\rn = n()) %\u0026gt;%\rmutate(logit_p = logit(p)) %\u0026gt;% gather(Modelo, estimativa, keras, glm) %\u0026gt;%\rggplot() +\rgeom_point(aes(x = x_cat, y = p)) +\rgeom_line(aes(x = x_cat, y = estimativa, colour = Modelo, group = Modelo)) +\rtheme_minimal() +\rtheme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +\rlabs(x = \u0026quot;x\u0026quot;, colour = \u0026quot;resposta\u0026quot;)\r## `summarise()` ungrouping output (override with `.groups` argument)\r\r(B√¥nus) PCA com autoencoer\rPCA e autoencodes servem na pr√°tica para reduzir a dimensionalidade dos dados. PCA √© um caso particular de autoencoder com apenas uma camada e fun√ß√µes de ativa√ß√£o lineares. O post Construindo Autoencoders ensina a fazer e recomendo a leitura.\nResumo: autoencoder √© uma t√©cnica incr√≠vel que generaliza o PCA.\n\r\r\rDiscuss√£o\rNa minha opini√£o aconteceu de que muita coisa antiga e consagrada teve seu nome mudado e apresentado como novo e isso acabou ofuscando as grandes contribui√ß√µes realmente relevantes das pesquisas em torno das redes neurais e do deep learning.\nPercebe-se que o Deep Learning generalizou bastante coisa e por isso eu declaro o post bem sucedido se o escrito acima despertou curiosidade em aprender mais sobre deep learning para agregar ao trabalho que j√° havia sendo feito.\rVale mais a pena trazer todos os praticantes de estat√≠stica e machine learning juntos nessa novidade do que nos dividirmos.\nAcredito que mais do que nunca a fundamenta√ß√£o te√≥rica e interpreta√ß√µes ter√£o seu valor potencializado com a dissemina√ß√£o do deep learning. Com o mito de que deep learning seja uma panaceia e com a facilidade que ela nos trouxe para fazer um modelo preditivo, h√° o risco de sermos soterrados por caixas pretas feitas por pessoas negligentes com aspectos importantes como interpretabilidade, causalidade e generaliza√ß√£o. Talvez o bayesianismo se desponte (mais uma vez) como a solu√ß√£o para problemas qualitativos num mundo cada vez mais obscuro trazendo √† luz os excessos dos modelos complexos e os benef√≠cios dos modelos simples.\nPuxando o gancho do bayesianismo (e infer√™ncias em geral), os resultados j√° obtidos em cima de modelos lineares ainda se aplicam em deep learning. E tamb√©m temos a vantagem de que todas as demais ferramentas que se usam em deep learning e que n√£o afetam a linearidade dos par√¢metros podem ser utilizadas, como convolucional, recorrente, max pooling, drop out, autoencoder e tantas outras.\nPara finalizar, na pr√°tica sugiro aplicar deep learning com o Keras, um pacote incr√≠vel que usa o tensorflow ou o theano por tr√°s. Acredito que voc√™s ver√£o muitos posts sobre o assunto por aqui! (podem encher o saco do Dan Falbel, um dos s√≥cios da curso-r.com, que est√° envolvido no desenvolvimento desse pacote em R =]).\n\rCuriosidades\rN-√©simo menor deep learning\rVimos acima o menor e o segundo menor Deep Learnings (que de profundo n√£o t√™m nada =P). Mas podemos ir o t√£o profundo quanto quisermos!\rA representa√ß√£o de redes neurais sai f√°cil:\nJ√° a representa√ß√£o matem√°tica fica esquisita:\n\\[E[Y|x] = \\frac{1}{1 + \\exp{\\left(\\beta_{p-1} + \\beta_p\\frac{1}{\\frac{\\vdots}{1 + \\exp{\\left(\\beta_{6} + \\beta_{7}\\frac{1}{1 + \\exp{\\left(\\beta_4 + \\beta_5\\frac{1}{1 + \\exp{\\left(\\beta_2 + \\beta_3\\frac{1}{1 + \\exp{\\left(\\beta_0 + \\beta_1x\\right)}}\\right)}}\\right)}}\\right)}}}\\right)}}\\]\n\rVocabul√°rio\rOs jarg√µes e termos do deep learning foram herdados de um outro contexto diferente do da modelagem preditiva estudada na estat√≠stica e por isso acabaram surgindo in√∫meros sin√¥nimos. Alguns deles s√£o:\n\rfun√ß√£o de ativa√ß√£o = fun√ß√£o de liga√ß√£o\rSoftmax = verossimilhan√ßa da multinomial\rsigmoide = fun√ß√£o com formato de S (no tensorflow o padr√£o √© a logistic)\rpesos = par√¢metros/betas/coeficientes\rbinary crossentropy = deviance da distribui√ß√£o binomial (regress√£o log√≠stica)\r\r√â isso a√≠, temos que nos manter curiosos, questionar e dialogar. Abs!\n\r\r","permalink":"https://blog.curso-r.com/posts/2017-07-29-segundo-menor-dl/","tags":["deep learning","redes neurais","regress√£o log√≠stica","keras","glm"],"title":"Regress√£o Log√≠stica em: a menor deep learning do mundo"},{"author":["William"],"categories":["Tutoriais"],"contents":"\rNo primeiro post sobre arruma√ß√£o de base de dados, a gente viu como usar as fun√ß√µes do stringr para arrumar o nome das vari√°veis. Seguindo a dica do Julio, o quebrador de captchas, vamos falar do pacote janitor, que traz algumas fun√ß√µes para dar aquele trato nas BDs.\nAntes de mais nada, instale e carregue o pacote:\ninstall.packages(\u0026quot;janitor\u0026quot;)\rdevtools::install_github(\u0026quot;sfirke/janitor\u0026quot;) # Vers√£o de desenvolvimento\rlibrary(tidyverse)\rlibrary(janitor)\rArrumando o nome das vari√°veis\rAssim como no post passado, utilizaremos a base com informa√ß√µes de pacientes com arritmia card√≠aca, cujas vari√°veis selecionadas foram:\ndados %\u0026gt;% names\r## [1] \u0026quot;ID\u0026quot; \u0026quot;Sexo\u0026quot; \u0026quot;Nascimento\u0026quot; ## [4] \u0026quot;Idade\u0026quot; \u0026quot;Inclus√£o\u0026quot; \u0026quot;Cor\u0026quot; ## [7] \u0026quot;Peso\u0026quot; \u0026quot;Altura\u0026quot; \u0026quot;cintura\u0026quot; ## [10] \u0026quot;IMC\u0026quot; \u0026quot;Superf√≠cie corporal\u0026quot; \u0026quot;Tabagismo\u0026quot; ## [13] \u0026quot;cg.tabag (cig/dia)\u0026quot; \u0026quot;Alcool (dose/semana)\u0026quot; \u0026quot;Drogas il√≠citas\u0026quot; ## [16] \u0026quot;Cafe√≠na/dia\u0026quot; \u0026quot;Refrig/dia\u0026quot; \u0026quot;Sedentario\u0026quot; ## [19] \u0026quot;ativ. Fisica\u0026quot;\rOs nomes t√™m letras mai√∫sculas, acentos, par√™nteses, pontos e barras, o que atrapalha na hora da programa√ß√£o. Para resolver esse problema, usamos a fun√ß√£o clean_names().\ndados %\u0026gt;%\rclean_names() %\u0026gt;%\rnames\r## [1] \u0026quot;id\u0026quot; \u0026quot;sexo\u0026quot; \u0026quot;nascimento\u0026quot; ## [4] \u0026quot;idade\u0026quot; \u0026quot;inclusao\u0026quot; \u0026quot;cor\u0026quot; ## [7] \u0026quot;peso\u0026quot; \u0026quot;altura\u0026quot; \u0026quot;cintura\u0026quot; ## [10] \u0026quot;imc\u0026quot; \u0026quot;superficie_corporal\u0026quot; \u0026quot;tabagismo\u0026quot; ## [13] \u0026quot;cg_tabag_cig_dia\u0026quot; \u0026quot;alcool_dose_semana\u0026quot; \u0026quot;drogas_ilicitas\u0026quot; ## [16] \u0026quot;cafeina_dia\u0026quot; \u0026quot;refrig_dia\u0026quot; \u0026quot;sedentario\u0026quot; ## [19] \u0026quot;ativ_fisica\u0026quot;\rVeja que a fun√ß√£o removeu os par√™nteses, pontos e barras e substituiu os espa√ßos por _. No entanto, ela n√£o remove os acentos. Assim, podemos adicionar mais uma linha ao pipeline para chegar onde queremos.\ndados %\u0026gt;%\rclean_names() %\u0026gt;%\rnames %\u0026gt;%\rabjutils::rm_accent()\r## [1] \u0026quot;id\u0026quot; \u0026quot;sexo\u0026quot; \u0026quot;nascimento\u0026quot; ## [4] \u0026quot;idade\u0026quot; \u0026quot;inclusao\u0026quot; \u0026quot;cor\u0026quot; ## [7] \u0026quot;peso\u0026quot; \u0026quot;altura\u0026quot; \u0026quot;cintura\u0026quot; ## [10] \u0026quot;imc\u0026quot; \u0026quot;superficie_corporal\u0026quot; \u0026quot;tabagismo\u0026quot; ## [13] \u0026quot;cg_tabag_cig_dia\u0026quot; \u0026quot;alcool_dose_semana\u0026quot; \u0026quot;drogas_ilicitas\u0026quot; ## [16] \u0026quot;cafeina_dia\u0026quot; \u0026quot;refrig_dia\u0026quot; \u0026quot;sedentario\u0026quot; ## [19] \u0026quot;ativ_fisica\u0026quot;\rE para substituir na base.\nnomes \u0026lt;- dados %\u0026gt;%\rclean_names() %\u0026gt;%\rnames %\u0026gt;%\rabjutils::rm_accent()\rnames(dados) \u0026lt;- nomes\r\rRemovendo linhas e colunas vazias\rEsse banco de dados tamb√©m tinha outro problema: linhas vazias. Na verdade, elas n√£o eram completamente vazias, pois havia algumas informa√ß√µes de identifica√ß√£o do paciente, mas nenhuma outra vari√°vel tinha sido computada.\ndados[3,]\r## # A tibble: 1 √ó 19\r## id sexo nascimento idade inclusao cor peso altura\r## \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dttm\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dttm\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 3 \u0026lt;NA\u0026gt; NA NA NA \u0026lt;NA\u0026gt; NA NA\r## # ‚Ä¶ with 11 more variables: cintura \u0026lt;chr\u0026gt;, imc \u0026lt;dbl\u0026gt;,\r## # superficie_corporal \u0026lt;chr\u0026gt;, tabagismo \u0026lt;chr\u0026gt;, cg_tabag_cig_dia \u0026lt;dbl\u0026gt;,\r## # alcool_dose_semana \u0026lt;dbl\u0026gt;, drogas_ilicitas \u0026lt;chr\u0026gt;, cafeina_dia \u0026lt;dbl\u0026gt;,\r## # refrig_dia \u0026lt;dbl\u0026gt;, sedentario \u0026lt;chr\u0026gt;, ativ_fisica \u0026lt;chr\u0026gt;\rEssa foi a solu√ß√£o que eu pensei para resolver o problema utilizando a fun√ß√£o remove_empty().\ndados %\u0026lt;\u0026gt;%\ras.data.frame %\u0026gt;%\r`row.names\u0026lt;-`(dados$id) %\u0026gt;%\rselect(-id) %\u0026gt;%\rremove_empty(which = c(\u0026quot;rows\u0026quot;)) %\u0026gt;%\rmutate(id = row.names(.)) %\u0026gt;%\rselect(id, everything())\rdados %\u0026gt;% as_tibble()\r## # A tibble: 4 √ó 19\r## id sexo nascimento idade inclusao cor peso altura\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dttm\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dttm\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 F 1964-01-31 00:00:00 41 2006-02-17 00:00:00 branca 75 1.63\r## 2 2 M 1959-01-28 00:00:00 45 2005-11-29 00:00:00 negra 71 1.7 ## 3 4 M 1957-09-13 00:00:00 50 2008-02-13 00:00:00 NT 80 1.64\r## 4 5 F 1938-02-06 00:00:00 71 2009-06-25 00:00:00 parda 56 1.51\r## # ‚Ä¶ with 11 more variables: cintura \u0026lt;chr\u0026gt;, imc \u0026lt;dbl\u0026gt;,\r## # superficie_corporal \u0026lt;chr\u0026gt;, tabagismo \u0026lt;chr\u0026gt;, cg_tabag_cig_dia \u0026lt;dbl\u0026gt;,\r## # alcool_dose_semana \u0026lt;dbl\u0026gt;, drogas_ilicitas \u0026lt;chr\u0026gt;, cafeina_dia \u0026lt;dbl\u0026gt;,\r## # refrig_dia \u0026lt;dbl\u0026gt;, sedentario \u0026lt;chr\u0026gt;, ativ_fisica \u0026lt;chr\u0026gt;\rEu precisei converter para data.frame primeiro porque n√£o √© poss√≠vel definir os nomes das linhas de uma tibble. Se a linha estivesse completamente vazia, bastaria usar diretamente a fun√ß√£o remove_empty_rows().\nEquivalentemente para colunas, existe a fun√ß√£o remove_empty_cols().\n\rIdentificando linhas duplicadas\rO pacote janitor possui uma fun√ß√£o para identificar entradas duplicadas numa base de dados: get_dupes(). Vamos criar uma base gen√©rica para test√°-la.\n\rp_nome \u0026lt;- c(\u0026quot;Athos\u0026quot;, \u0026quot;Daniel\u0026quot;, \u0026quot;Fernando\u0026quot;, \u0026quot;Julio\u0026quot;, \u0026quot;William\u0026quot;)\rsobrenome \u0026lt;- c(\u0026quot;Damiani\u0026quot;, \u0026quot;Falbel\u0026quot;, \u0026quot;Corr√™a\u0026quot;, \u0026quot;Trecenti\u0026quot;, \u0026quot;Amorim\u0026quot;)\rbase_qualquer \u0026lt;- tibble(nome = sample(p_nome, 25, replace = T),\rsobrenome = sample(sobrenome, 25, replace = T),\rvariavel_importante = rnorm(25))\rget_dupes(base_qualquer, nome, sobrenome)\r## # A tibble: 15 √ó 4\r## nome sobrenome dupe_count variavel_importante\r## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 Athos Trecenti 2 -2.47 ## 2 Athos Trecenti 2 1.07 ## 3 Daniel Amorim 2 1.42 ## 4 Daniel Amorim 2 -0.134 ## 5 Daniel Corr√™a 2 0.469 ## 6 Daniel Corr√™a 2 0.0716\r## 7 Daniel Damiani 2 1.66 ## 8 Daniel Damiani 2 0.721 ## 9 Fernando Amorim 2 0.485 ## 10 Fernando Amorim 2 0.317 ## 11 Fernando Damiani 3 0.0695\r## 12 Fernando Damiani 3 0.112 ## 13 Fernando Damiani 3 -0.0940\r## 14 William Corr√™a 2 0.575 ## 15 William Corr√™a 2 -0.462\rTodas as linhas na tibble resultante representam uma combina√ß√£o de nome-sobrenome repetida.\n\rOutras fun√ß√µes\rPor fim, o janitor tamb√©m tem fun√ß√µes equivalentes √† table() para produzir tabelas de frequ√™ncia:\n\rtabyl() - similar a table(), mas pipe-√°vel e com mais recursos.\radorn_totals() - acrescenta o total das linhas ou colunas.\radorn_crosstab() - deixa tabelas de conting√™ncia mais bonitas.\r\rmtcars %\u0026gt;%\rtabyl(cyl)\r## cyl n percent\r## 4 11 0.34375\r## 6 7 0.21875\r## 8 14 0.43750\rmtcars %\u0026gt;%\rtabyl(cyl) %\u0026gt;%\radorn_totals\r## cyl n percent\r## 4 11 0.34375\r## 6 7 0.21875\r## 8 14 0.43750\r## Total 32 1.00000\r√â isso! Espero que essas dicas e o pacote janitor ajudem a agilizar as suas an√°lises. D√∫vidas, cr√≠ticas ou sugest√µes, deixe um coment√°rio ou nos envie uma mensagem. :)\n\r","permalink":"https://blog.curso-r.com/posts/2017-07-24-janitor/","tags":["base de dados","pacotes","janitor"],"title":"Arrumando BDs: o pacote janitor"},{"author":["Julio"],"categories":["an√°lises"],"contents":"\r\rNesse post vamos discutir um pouco sobre modelar CAPTCHAs. Vou assumir que voc√™ j√° viu o post de introdu√ß√£o e o post sobre download, leitura e classifica√ß√£o manual de CAPTCHAs.\nDigamos que voc√™ tenha uma base de dados de treino composta por \\(N\\) imagens com os textos classificados. Nossa resposta nesse caso √© uma palavra de \\(k\\) caracteres (vamos considerar \\(k\\) fixado), sendo que cada caractere \\(c\\) pode ter \\(p\\) valores.\nO problema de modelar o CAPTCHA diretamente √© que a vari√°vel resposta tem um n√∫mero exponencial de combina√ß√µes de acordo com o n√∫mero de caracteres:\n\\[\r\\Omega = p^k.\r\\]\nPor exemplo, um CAPTCHA com \\(k=6\\) e \\(p=36\\) (26 letras e 10 n√∫meros), que √© muito comum, possui um total de 2.176.782.336 (\u0026gt; 2 bilh√µes) combina√ß√µes! E n√£o preciso dizer que √© completamente invi√°vel baixar e modelar tudo isso de CAPTCHAs.\nA alternativa imediata que aparece √© tentar separar a imagem em um peda√ßo para cada caractere e fazer um modelo para prever caracteres. Assim nossa resposta √© reduzida para \\(p\\) categorias, que √© bem mais f√°cil de tratar.\nVamos usar como exemplo o CAPTCHA dos TRTs. Primeiro, o download:\nlibrary(decryptr)\rlibrary(tidyverse)\rarq_captcha \u0026lt;- decryptr::download_trt(dest = \u0026#39;img\u0026#39;, n = 1)\rVisualizando a imagem:\n\u0026quot;../../static/data/captcha-segment/captcha705f7bad4a3d.jpeg\u0026quot; %\u0026gt;% read_captcha() %\u0026gt;% purrr::pluck(1) %\u0026gt;%\rplot()\rInfelizmente, segmentar a imagem nos lugares corretos √© uma tarefa dif√≠cil. Pior at√© do que predizer as letras. Para simplificar, vamos fazer um corte fixado das letras:\narq_captcha %\u0026gt;% read_captcha() %\u0026gt;% purrr::pluck(1) %\u0026gt;% plot()\rabline(v = 30 + 15 * 0:5, col = \u0026#39;red\u0026#39;)\rPodemos tamb√©m limitar os eixos x (tirar os espa√ßos vazios √† esquerda e √† direita) e y (superiores e inferiores).\n\u0026quot;../../static/data/captcha-segment/captcha705f7bad4a3d.jpeg\u0026quot; %\u0026gt;%\rdecryptr:::load_image() %\u0026gt;%\rmagrittr::extract(-c(1:9, 31:dim(.)[1]), -c(1:15, 106:dim(.)[2]), TRUE) %\u0026gt;% grDevices::as.raster() %\u0026gt;% graphics::plot()\rabline(v = 15 * 1:5, col = \u0026#39;red\u0026#39;)\rabline(v = 15 * c(0, 6), col = \u0026#39;black\u0026#39;)\rabline(h = c(0, 21), col = \u0026#39;blue\u0026#39;)\rAgora temos uma imagem de tamanho dimens√µes 21x15 por caractere. Nosso pr√≥ximo desafio √© transformar isso em algo trat√°vel por modelos de regress√£o. Para isso, colocamos cada pixel em uma coluna da nossa base de dados.\nNo caso do TRT, cada CAPTCHA gerar√° uma tabela de 6 linhas e 315 (21 * 15) colunas. Podemos usar esse c√≥digo para montar:\narq_captcha %\u0026gt;% decryptr:::load_image() %\u0026gt;% magrittr::extract(-c(1:9, 31:dim(.)[1]), -c(1:15, 106:dim(.)[2]), 1) %\u0026gt;% as_tibble() %\u0026gt;% rownames_to_column(\u0026#39;y\u0026#39;) %\u0026gt;% gather(x, value, -y) %\u0026gt;% mutate_at(vars(x, y), funs(parse_number)) %\u0026gt;% mutate(letra = (x - 1) %/% 15 + 1,\rx = x - (letra - 1) * 15) %\u0026gt;% mutate_at(vars(x, y), funs(sprintf(\u0026#39;%02d\u0026#39;, .))) %\u0026gt;% unite(xy, x, y) %\u0026gt;% spread(xy, value, sep = \u0026#39;\u0026#39;) %\u0026gt;% mutate(y = c(\u0026#39;a\u0026#39;, \u0026#39;f\u0026#39;, \u0026#39;3\u0026#39;, \u0026#39;d\u0026#39;, \u0026#39;w\u0026#39;, \u0026#39;x\u0026#39;)) %\u0026gt;% select(y, everything(), -letra)\rMuito bem! Agora basta rodar o mesmo para toda a base de treino e rodar um modelo. Para esse post, vamos usar uma base de 2300 CAPTCHAs classificados. Essa base fica com 13800 linhas e 315 colunas. Vamos usar 11000 linhas para treino e as 2800 restantes para teste. O modelo utilizado ser√° um randomForest padr√£o.\nlibrary(randomForest)\rdados \u0026lt;- readRDS(\u0026#39;../../static/data/captcha-segment/d_segment_captcha.rds\u0026#39;) %\u0026gt;% mutate(y = factor(y))\r# monta bases de treino e teste\rset.seed(4747) # reprodutibilidade\rids_treino \u0026lt;- sample(seq_len(nrow(dados)), 11000, replace = FALSE)\rd_train \u0026lt;- dados[ids_treino, ]\rd_test \u0026lt;- dados[-ids_treino, ]\rmodel \u0026lt;- randomForest(y ~ . - captcha_id, data = d_train) \rO resultado do modelo pode ser verificado na tabela de observados versus preditos na base de teste. O acerto foi de 99.4% em cada caractere! O maior erro ocorreu no confundimento da letra n com a letra h. Assumindo que o erro n√£o depende da posi√ß√£o do caractere no CAPTCHA, teremos um acerto de aproximadamente 96.7% para a imagem.\nd_test %\u0026gt;% mutate(pred = predict(model, newdata = .)) %\u0026gt;% count(y, pred) %\u0026gt;% spread(pred, n, fill = \u0026#39;.\u0026#39;) %\u0026gt;% remove_rownames() %\u0026gt;% knitr::kable(caption = \u0026#39;Tabela de acertos e erros.\u0026#39;)\r\r\ry\r2\r3\r4\r5\r6\r7\r8\r9\ra\rb\rd\re\rf\rh\rj\rk\rm\rn\rr\rs\rt\ru\rv\rw\rx\ry\r\r\r\r2\r109\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\r3\r.\r105\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\r4\r.\r.\r116\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\r5\r.\r.\r.\r97\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\r6\r.\r.\r.\r.\r108\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\r7\r.\r.\r.\r.\r.\r111\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\r8\r.\r.\r.\r.\r.\r.\r120\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\r9\r.\r.\r.\r.\r.\r.\r.\r51\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\ra\r.\r.\r.\r.\r.\r.\r.\r.\r63\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\rb\r.\r.\r.\r.\r.\r.\r.\r.\r.\r110\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\rd\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r108\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r\re\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r110\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\rf\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r116\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\rh\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r116\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r\rj\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r115\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\rk\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r126\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\rm\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r122\r2\r.\r.\r.\r.\r.\r.\r.\r.\r\rn\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r3\r.\r.\r1\r132\r.\r.\r.\r.\r.\r.\r.\r.\r\rr\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r91\r.\r.\r.\r.\r.\r.\r.\r\rs\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r113\r.\r.\r.\r.\r.\r.\r\rt\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r106\r.\r.\r.\r.\r.\r\ru\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r99\r.\r.\r.\r.\r\rv\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r99\r.\r.\r2\r\rw\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r107\r.\r.\r\rx\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r132\r.\r\ry\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r102\r\r\r\rNem tudo s√£o rosas\rO resultado para o CAPTCHA do TRT √© bastante satisfat√≥rio, mas infelizmente n√£o generaliza para outros CAPTCHAs. Tome por exemplo o CAPTCHA da Receita Federal abaixo. Nesse caso, a posi√ß√£o dos caracteres muda significativamente de imagem para imagem, e assim fica dif√≠cil cortar em peda√ßos.\nO mesmo modelo aplicado ao CAPTCHA da Receita possui acerto de 78.8% do caractere, o que equivale a apenas 23.8% de acerto para toda a imagem. Veja os resultados na tabela abaixo.\nmodel \u0026lt;- randomForest(y ~ . - captcha_id, data = d_train) \r\r\ry\r1\r2\r3\r4\r5\r6\r7\r8\r9\ra\rb\rc\rd\re\rf\rg\rh\ri\rj\rk\rl\rm\rn\ro\rp\rq\rr\rs\rt\ru\rv\rw\rx\ry\rz\r\r\r\r1\r28\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r2\r.\r.\r2\r4\r.\r3\r.\r.\r.\r.\r.\r.\r.\r10\r.\r.\r.\r.\r.\r.\r\r2\r.\r28\r.\r.\r.\r.\r.\r.\r.\r.\r.\r2\r.\r1\r1\r.\r.\r.\r2\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r8\r\r3\r1\r.\r29\r.\r3\r.\r.\r1\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r6\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r\r4\r.\r.\r.\r35\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r1\r.\r.\r.\r.\r1\r.\r.\r.\r.\r1\r.\r.\r.\r\r5\r.\r.\r.\r.\r30\r.\r.\r.\r.\r.\r1\r.\r.\r1\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r2\r.\r1\r.\r.\r.\r.\r.\r.\r.\r\r6\r.\r.\r.\r1\r.\r38\r.\r.\r.\r.\r3\r.\r.\r2\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r1\r1\r.\r1\r.\r\r7\r1\r.\r.\r.\r.\r.\r38\r.\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r2\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r2\r.\r.\r.\r.\r\r8\r.\r.\r.\r.\r.\r2\r.\r31\r.\r.\r3\r.\r.\r.\r.\r.\r5\r1\r.\r2\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r.\r1\r.\r.\r\r9\r.\r.\r.\r1\r.\r.\r1\r.\r41\r.\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r1\r.\r1\r.\r2\r\ra\r.\r1\r.\r.\r.\r.\r.\r.\r.\r79\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r1\r.\r.\r.\r.\r1\r.\r1\r\rb\r.\r.\r.\r.\r.\r.\r.\r1\r.\r1\r60\r.\r.\r1\r.\r.\r4\r.\r.\r1\r.\r.\r.\r3\r2\r2\r2\r2\r1\r.\r.\r.\r1\r.\r.\r\rc\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r2\r62\r1\r5\r1\r2\r.\r.\r1\r.\r.\r.\r.\r6\r1\r1\r.\r1\r1\r.\r1\r.\r.\r.\r.\r\rd\r.\r.\r1\r.\r.\r.\r.\r.\r.\r3\r3\r.\r35\r3\r.\r4\r1\r.\r1\r1\r2\r1\r1\r8\r2\r2\r.\r.\r.\r12\r.\r1\r1\r.\r.\r\re\r.\r.\r.\r1\r.\r1\r.\r.\r.\r4\r1\r1\r.\r83\r2\r.\r.\r.\r.\r.\r.\r.\r.\r.\r2\r.\r1\r1\r.\r.\r.\r3\r.\r.\r.\r\rf\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r3\r79\r.\r.\r.\r.\r1\r.\r1\r.\r.\r2\r.\r.\r.\r4\r.\r.\r.\r.\r1\r.\r\rg\r.\r.\r.\r.\r.\r.\r.\r.\r2\r1\r.\r1\r.\r.\r.\r64\r.\r.\r2\r.\r.\r.\r.\r3\r.\r17\r.\r2\r1\r.\r.\r.\r.\r.\r.\r\rh\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r3\r.\r.\r1\r.\r.\r87\r.\r.\r2\r1\r2\r2\r.\r.\r.\r3\r.\r2\r.\r.\r.\r.\r.\r.\r\ri\r2\r.\r.\r.\r.\r.\r.\r.\r.\r2\r.\r.\r.\r.\r1\r.\r.\r36\r2\r.\r1\r.\r.\r.\r.\r.\r1\r.\r4\r.\r.\r1\r2\r2\r.\r\rj\r.\r.\r.\r.\r.\r.\r.\r.\r2\r.\r1\r.\r1\r.\r.\r.\r.\r4\r70\r.\r.\r.\r.\r1\r.\r1\r.\r1\r1\r1\r2\r.\r.\r.\r.\r\rk\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r79\r.\r.\r1\r.\r.\r.\r1\r.\r1\r.\r1\r1\r1\r.\r.\r\rl\r3\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r2\r1\r.\r1\r.\r.\r.\r38\r.\r.\r.\r.\r.\r.\r.\r12\r.\r.\r1\r.\r.\r.\r\rm\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r2\r.\r.\r.\r.\r101\r3\r.\r1\r.\r2\r.\r.\r.\r1\r.\r1\r.\r.\r\rn\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r1\r1\r1\r.\r8\r.\r.\r.\r.\r2\r67\r.\r.\r.\r4\r.\r.\r2\r.\r2\r1\r.\r.\r\ro\r.\r.\r1\r.\r1\r.\r.\r.\r.\r2\r1\r15\r4\r3\r.\r1\r.\r.\r2\r.\r.\r.\r.\r62\r2\r9\r.\r2\r.\r1\r1\r.\r.\r.\r.\r\rp\r2\r.\r.\r1\r.\r.\r.\r.\r.\r.\r2\r.\r.\r2\r2\r3\r1\r.\r.\r.\r.\r.\r1\r1\r75\r.\r4\r.\r3\r.\r.\r2\r.\r.\r.\r\rq\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r1\r.\r3\r.\r7\r.\r.\r.\r.\r.\r1\r.\r2\r1\r79\r.\r.\r.\r.\r1\r.\r.\r.\r1\r\rr\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r2\r.\r.\r.\r4\r.\r.\r.\r.\r8\r.\r.\r1\r.\r3\r.\r65\r.\r4\r.\r1\r.\r1\r.\r1\r\rs\r.\r.\r.\r.\r.\r.\r.\r1\r.\r3\r2\r1\r.\r2\r.\r.\r.\r.\r2\r.\r.\r.\r.\r.\r.\r.\r1\r87\r.\r.\r1\r2\r.\r.\r.\r\rt\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r2\r1\r.\r1\r2\r2\r.\r.\r1\r1\r.\r.\r.\r.\r.\r1\r1\r1\r78\r.\r1\r1\r1\r.\r1\r\ru\r.\r.\r.\r.\r.\r.\r.\r.\r1\r2\r1\r.\r2\r.\r1\r.\r1\r1\r3\r.\r.\r.\r1\r.\r.\r1\r.\r.\r.\r80\r2\r2\r.\r.\r.\r\rv\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r2\r93\r3\r.\r5\r.\r\rw\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r1\r100\r.\r.\r.\r\rx\r.\r.\r.\r.\r.\r2\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r3\r91\r1\r.\r\ry\r.\r.\r1\r1\r1\r.\r.\r.\r.\r2\r.\r.\r.\r.\r1\r1\r.\r.\r2\r.\r.\r1\r.\r2\r1\r.\r.\r.\r2\r1\r15\r1\r1\r75\r.\r\rz\r.\r.\r.\r.\r.\r.\r.\r.\r1\r1\r.\r.\r.\r2\r.\r.\r1\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r.\r85\r\r\r\rClaro que seria poss√≠vel melhorar o poder preditivo com uma modelagem mais cuidadosa: n√≥s usamos todos os par√¢metros padr√£o da randomForest e n√£o consideramos outros poss√≠veis modelos. Mas acreditamos que o problema essencial est√° na segmenta√ß√£o, e n√£o na modelagem ap√≥s a segmenta√ß√£o.\nNos pr√≥ximos posts, vamos mostrar como resolver o CAPTCHA da Receita com maior acur√°cia utilizando t√©cnicas de Deep Learning que consideram a etapa de segmenta√ß√£o dentro da modelagem.\n\rWrap-up\r\rN√£o d√° para considerar todas as combina√ß√µes de valores de um CAPTCHA diretamente num modelo de regress√£o.\rUma forma de resolver um CAPTCHA √© segmentando a imagem em peda√ßos de mesma largura.\rPara montar a base de treino, criamos uma coluna para cada pixel. Um CAPTCHA corresponde a uma base com \\(k\\) linhas e n√∫mero de colunas igual ao n√∫mero de pixels.\rNo CAPTCHA do TRT os resultados s√£o satisfat√≥rios.\rJ√° para CAPTCHA da Receita essa estrat√©gia pode ser ineficaz.\rVamos evoluir essa an√°lise para t√©cnicas que consideram a etapa de segmenta√ß√£o dentro da modelagem.\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-29-captcha-segment/","tags":["captcha"],"title":"Quebrando CAPTCHAs - Parte III: Segmenta√ß√£o de imagens"},{"author":["Daniel"],"categories":["tutoriais"],"contents":"\rSalvar data.frames para ler depois √© uma tarefa muito comum para quem trabalha com R,\rprincipalmente quando o seu processo possui algumas etapas mais demoradas e voc√™ n√£o\rquer ter que rodar tudo de novo.\nVeja aqui 3 formas f√°ceis, e r√°pidas para salvar o seu banco de dados e n√£o perder\rtempo lendo novamente.\nsaveRDS\rTalvez a fun√ß√£o mais conhecida para salvar objetos do R. Ela salva em um formato bin√°rio\rque s√≥ pode ser lido pelo R. Por padr√£o comprime o arquivo ap√≥s salvar, o que economiza\respa√ßo no disco, mas pode faz√™-la levar mais tempo para rodar.\nConsidere um data.frame gerado pelo c√≥digo abaixo:\nnrOfRows \u0026lt;- 1e7\rx \u0026lt;- data.frame(\rIntegers = 1:nrOfRows, # integer\rLogicals = sample(c(TRUE, FALSE, NA), nrOfRows, replace = TRUE), # logical\rText = factor(sample(state.name, nrOfRows, replace = TRUE)), # text\rNumericals = runif(nrOfRows, 0.0, 100), # numericals\rstringsAsFactors = FALSE)\rAgora veja o tempo que demoramos para salv√°-lo com o saveRDS.\nsystem.time({\rsaveRDS(x, \u0026quot;~/Desktop/saveRDS.rds\u0026quot;)\r})\r# user system elapsed\r# 19.300 0.112 19.386\rO espa√ßo ocupado pelo arquivo √© de 95MB. Indicando para a fun√ß√£o que voc√™ n√£o deseja\rcomprimir:\nsystem.time({\rsaveRDS(x, \u0026quot;~/Desktop/saveRDS2.rds\u0026quot;, compress = FALSE)\r})\r# user system elapsed\r# 0.260 0.116 0.377\rO tempo vai para menos de 1s. Mas agora o arquivo ficou com 200MB.\rO pacote readr tem uma fun√ß√£o chamada write_rds que √© um wrapper de saveRDS\rque por padr√£o n√£o comprime os arquivos, j√° que o Hadley diz que armazenamento √©,\rem geral, muito mais barato do que tempo de processamento.\n√â importante tamb√©m verificar o tempo que demoramos para ler o arquivo novamente para\ro R. No caso ler o arquivo comprimido demora 2x mais do que o arquivo n√£o comprimido.\nsystem.time({\ra \u0026lt;- readRDS(\u0026quot;~/Desktop/saveRDS.rds\u0026quot;)\r})\r# user system elapsed\r# 1.068 0.040 1.105\rsystem.time({\ra \u0026lt;- readRDS(\u0026quot;~/Desktop/saveRDS2.rds\u0026quot;)\r})\r# user system elapsed\r# 0.380 0.068 0.447\rPara salvar data.frames do R no disco, saveRDS √© sempre a minha primeira op√ß√£o:\r√© relativamente r√°pido para ler e escrever e n√£o exige instala√ß√£o de nenhum pacote.\nAl√©m disso, o saveRDS serve para praticamente qualquer tipo de objeto do R, ou seja,\rvoc√™ pode us√°-lo para salvar os modelos que voc√™ ajustou ou qualquer outra coisa.\nAs principais desvantagens dessa fun√ß√£o para as outras que mostrarei a seguir s√£o:\n\rs√≥ pode ser lido pelo R\rn√£o permite que voc√™ leia apenas um subset das linhas/ colunas.\r\r\rfeather\rfeather √© um formato de arquivo desenvolvido por duas pessoas muito fodas. Wes McKinney,\rautor do Pandas (principal biblioteca de manipula√ß√£o de dados do python) e Hadley Wickham,\rprincipal desenvolvedor do tidyverse.\nO feather √© bem r√°pido para salvar data.frames no disco, tempo compar√°vel a\rsalvar o arquivo sem comprimir usando o saveRDS. Mas s√≥ isso n√£o √© o suficiente para\rser necess√°rio us√°-lo, j√° que neste caso o saveRDS r√°pido o suficiente.\nA principal vantagem do feather √© que ele foi criado para ser um formato de\rcompartilhamento de data.frames entre diversas linguagens de programa√ß√£o. Existem\rpacotes para ler arquivos .feather escritos em R, python, Julia: as tr√™s principais\rlinguagens para an√°lise de dados.\nO feather tamb√©m permite que voc√™ leia apenas algumas linhas ou colunas do dataset, o\rque muitas vezes √© √∫til para fazer consultas mais r√°pidas na base sem ter que ler tudo para\ra RAM de uma vez s√≥.\nlibrary(feather)\rsystem.time({\rwrite_feather(x, \u0026quot;~/Desktop/feather.feather\u0026quot;)\r})\r# user system elapsed\r# 0.172 0.084 0.253\rO arquivo produzido pesa 162MB. Para ler o arquivo salvo:\nsystem.time({\ra \u0026lt;- read_feather(\u0026quot;~/Desktop/feather.feather\u0026quot;)\r})\r# user system elapsed\r# 0.112 0.020 0.131\rUsando o feather para ler apenas algumas linhas e colunas.\na \u0026lt;- feather(\u0026quot;~/Desktop/feather.feather\u0026quot;)\rb \u0026lt;- a[5000:6000, 1:3]\r\rfst\rfst √© um pacote para ler e escrever data.frames de forma muito r√°pida.\nA imagem (retirada daqui) acima mostra a sua velocidade. O fst √© mais ou menos 3 vezes mais r√°pido\rpara ler os arquivos salvos e cerca de 2x mais r√°pido para escrev√™-los. O arquivo\rsalvo pelo fst √© tamb√©m um pouco menor: 130MB.\nLer e escrever √©, assim como as outras op√ß√µes, t√£o simples como usar uma fun√ß√£o:\nlibrary(fst)\r# salvar\rwrite.fst(x, \u0026quot;/home/daniel/Desktop/dataset.fst\u0026quot;)\r# ler\ra \u0026lt;- read.fst(\u0026quot;~/Desktop/dataset.fst\u0026quot;)\r# ler apenas algumas linhas e colunas\rb \u0026lt;- read.fst(\u0026quot;~/Desktop/dataset.fst\u0026quot;, c(\u0026quot;Logicals\u0026quot;, \u0026quot;Text\u0026quot;), 2000, 4990)\rNote Como o Sillas mencionou nos coment√°rios, a vers√£o do CRAN do fst salva\rdatas como numericos no arquivo. Os n√∫meros podedm sser convertidos para data novamente\rusando a fun√ß√£o as.Date do pacote zoo, mas tem que tomar cuidado!\n\rConclus√£o\r\rUse sempre saveRDS e readRDS, se precisar de velocidade, salve com o argumento\rcompress = FALSE para n√£o comprimir o arquivo.\n\rSe voc√™ for ler a base em python ou Julia e quiser um formato padronizado,\ruse o feather.\n\rSe voc√™ for realmente ler e escrever os seus dados muitas vezes e voc√™ precisar\rde velocidade, use o fst.\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-07-20-escrevendo-data-frames/","tags":["base de dados"],"title":"Salvando data.frames: uma compara√ß√£o"},{"author":["Athos"],"categories":["Tutoriais"],"contents":"\rVersionamento de c√≥digo √© uma ferramenta que veio para ficar. N√£o d√° para calcular o quanto de dor de cabe√ßa, horas perdidas e frustra√ß√µes ela economiza e j√° economizou na hist√≥ria da humanidade.\nUm dos programas que faz isso para a gente se chama Git. E n√£o confundir com Github (que vamos usar para exemplificar mais para frente) que √© um servi√ßo que hospeda reposit√≥rios ‚Äúcontrolados‚Äù pelo Git.\nAo final do post voc√™ estar√° apto(a) a trabalhar com Github no seu RStudio.\nMotivos para usar Github nos seus projetos de R\r1) Deixa seu c√≥digo atualizado e acess√≠vel de qualquer computador.\nCasa -\u0026gt; Trabalho, Trabalho -\u0026gt; Casa, por exemplo. N√£o h√° necessidade de carregar o laptop pra l√° e pra c√° caso voc√™ tenha v√°rios Quart√©is Generais.\n2) Colaboradores conseguir√£o contribuir sempre a partir da vers√£o mais atualizada.\nSeu colega n√£o vai mais precisar te pedir aquele versao_final_20170711.zip por email. Ele pode acessar o seu reposit√≥rio quando quiser, mexer no c√≥digo e depois pedir autoriza√ß√£o para atualizar o projeto.\n3) Recupere uma vers√£o funcional em caso de imprevistos.\nArrumar um bugzinho singelo, salvar o c√≥digo, dormir, acordar no dia seguinte, perceber que o programa n√£o funciona mais. Uma hist√≥ria de terror, por√©m corriqueira. O Github consegue recuperar o seu c√≥digo a partir de uma atualiza√ß√£o anterior.\n4) Seu projeto no ar.\nGithub √©, al√©m de tudo, uma rede social e √© pr√°tica comum pessoas acessarem Githubs de projetos alheios para consum√≠-los. Al√©m disso te fornece uma p√°gina em branco para voc√™ documentar e deixar seu trabalho para a posteridade. Existem pacotes de R que nem est√£o no CRAN, mas j√° est√£o no Github! A fun√ß√£o devtools::install_github() existe para isso.\n\rPr√©-requisitos\rVoc√™ precisa ter instalado na sua m√°quina‚Ä¶\n\rR/RStudio (vers√µes recentes para que tudo funcione direitinho)\rGit\rUma conta no Github\r\r\rPrepara√ß√£o de um Projeto com RStudio e Github\rA vida com Github + RStudio segue a seguinte rotina (escreva esse fluxo num peda√ßo de papel e guarde na sua carteira):\nPasso 1 - Reposit√≥rio: Criar reposit√≥rio do projeto no Github\rV√° √† sua conta do Github e crie um reposit√≥rio com o nome do seu projeto.\nNo exemplo acima eu poderia acessar o conte√∫do do meu projeto no link https://github.com/athospd/projecao_de_precos. Mas de modo geral, voc√™ acessaria o seu projeto no link https://github.com/\u0026lt;nome-do-usuario\u0026gt;/\u0026lt;nome-do-projeto\u0026gt;.\nBoas pr√°ticas:\n\rNomes sem espa√ßo e sem caracteres estranhos. Deixe o nome bem simples!\n\rRUIM: proje√ß√£o de pre√ßos\rBOM: projecao_de_precos\r\rColoque uma descri√ß√£o sucinta e direta sobre o seu projeto. Um link para um site com maiores detalhes tamb√©m pode colocar a√≠.\n\rCrie um README.md. Logo mais volto a tocar nesse assunto, mas no momento da cria√ß√£o do seu reposit√≥rio, j√° deixe um engatilhado!\n\r\rOBS: Incluir uma licen√ßa open-source √© opcional, mas √© f√°cil colocar, deixa claro que as outras pessoas podem usar e deixa seu projeto parecendo profissa rs.\n\rPasso 2 - .Rproj: Cria√ß√£o do Projeto no RStudio\rAgora precisamos criar um .Rproj que esteja atrelado ao seu reposit√≥rio no Github. Por sorte, o RStudio j√° pensou em tudo e fez disso uma tarefa f√°cil.\nO caminho √©:\n\rNew Project \u0026gt; Version Control \u0026gt; Git \u0026gt; Copia e cola URL do reposit√≥rio \u0026gt; Create Project\n\rAo final do processo voc√™ ter√° todos os arquivos do prjeto no seu computador local.\n\rPasso 3 - Commit: Editando e ‚ÄúCommitando‚Äù as mudan√ßas no c√≥digo\rDar ‚Äòcommit‚Äô √© o que se faz quando voc√™ resolve aceitar as mudan√ßas que voc√™ fez no seu c√≥digo/projeto.\nVamos montar uma hist√≥ria simulando duas mudan√ßas no c√≥digo, resultando em dois commits.\nMudan√ßa 1 Implementei a fun√ß√£o soma e depois dei commit porque achei que j√° estava muito boa.\nMudan√ßa 2 Implementei a fun√ß√£o subtrai e apesar de estar ainda com muitos bugs eu resolvi commitar porque precisava ir embora do Trabalho. Chegando em casa eu arrumo.\nAgora tem dois commits prontos para serem guardados no nosso reposit√≥rio central do Github. Lembre-se que √© no Github que todos os colaboradores v√£o continuar o projeto. Hora do PUSH!\n\rPasso 4 - Push: Subindo os commits para o Github\rPush √© t√£o f√°cil quanto apertar um bot√£o.\nOBS: Nesse momento pode ser que seja pedido login e senha para autorizar o PUSH. Mas provavelmente s√≥ ser√° solicitado na primeira vez porque ele vai colocar o seu computador como origem conhecida (e confi√°vel). Caso continue solicitando √© aconselh√°vel configurar o SSH (segue um tutorialzinho bacana).\nNo site do Github j√° vai estar as mudan√ßas prontas para quem quiser ver.\n\rPasso 5 - Pull: Baixando o estado atual do projeto\rSuponha que entre o trajeto do meu trabalho para a minha casa meu colega tenha aprimorado a fun√ß√£o soma.\nPara eu continuar da onde ele parou eu devo dar um PULL, ou seja, puxar pra minha m√°quina o c√≥digo que est√° l√° no Github.\nEnt√£o, toda vez que abrir seu projeto, d√™ um PULL para voltar a ficar de onde parou.\n\rPasso extra - Issues: Documentando e delegando problemas\rIssues s√£o quest√µes em aberto sobre seu projeto. Geralmente se descreve um bug a ser consertado ou uma ideia a ser implementada no futuro. O Github permite delegar essas tarefas a algu√©m e tamb√©m classific√°-las se quiser.\n\r\rIndo al√©m\rO fluxo mostrado acima representa o dia a dia de um programador solit√°rio com eventuais parceiros colaboradores, mas o mundo da programa√ß√£o colaborativa com Git e RStudio √© vasto! Para voc√™ saber, algumas coisas que n√£o cobrimos aqui, mas que s√£o bem comuns:\n\rFork\rPull request\rBranches\rGist\r\r\rProgramas similares\rEm rela√ß√£o a programas de versionamento, o RStudio tamb√©m trabalha bem com o SVN.\nJ√° servi√ßos de hospedagem de reposit√≥rios, qualquer um funciona. O Bitbucket √© muito bom!\n\rResum√£o\r\rPasso 1 - Reposit√≥rio: Criar reposit√≥rio do projeto no Github\rPasso 2 - .Rproj: Cria√ß√£o do Projeto no RStudio\rPasso 3 - Commit: Editando e ‚ÄúCommitando‚Äù as mudan√ßas no c√≥digo\rPasso 4 - Push: Subindo os commits para o Github\rPasso 5 - Pull: Baixando o estado atual do projeto\rPasso extra - Issues: Documentando e delegando problemas\r\rEssa √© uma pr√°tica que facilita a vida do analista e que n√≥s incentivamos nos cursos que ministramos. Se houver d√∫vida o Curso-R.com est√° sempre a disposi√ß√£o!\n\r","permalink":"https://blog.curso-r.com/posts/2017-07-17-rstudio-e-github/","tags":["github","rstudio","git"],"title":"RStudio e Github no dia a dia"},{"author":["Fernando"],"categories":["top 10"],"contents":"\rOs criadores do Markdown, segundo suas pr√≥prias palavras, criaram a linguagem com o objetivo de construir um ‚Äúformato de texto f√°cil de ler, f√°cil de escrever e opcionalmente convers√≠vel para HTML‚Äù1. Com o passar do tempo, esse objetivo foi expandido pela comunidade, pois a simplicidade tamb√©m √© √∫til para outros formatos.\nAs extens√µes andam em dois sentidos. Um deles √© construir tradutores universais entre todas as linguagens de marca√ß√£o, como o pandoc, permitindo que seja f√°cil construir documentos a partir de textos em Markdown. A outra classe de extens√µes incorpora as vantagens obtidas a outras ferramentas, como o Rmarkdown, que adiciona o resultado de c√≥digos em R aos textos escritos em Markdown.\nEssa segunda classe de extens√µes √© particularmente importante para os estat√≠sticos, j√° que a comunica√ß√£o √© uma parte muito importante do seu trabalho. Usando Rmarkdown, √© f√°cil construir relat√≥rios reprodut√≠veis, concisos e, por √∫ltimo mas n√£o menos importante, bonitos.\nNeste post, vou listar pra voc√™s os meus 3 pacotes favoritos para formatar e organizar documentos em Rmarkdown, descrevendo brevemente o que eu mais gosto neles. Os tr√™s pacotes, assim como o pr√≥prio pacote rmarkdown, est√£o sendo desenvolvidos pela comunidade e pelo Rstudio, de tal forma que n√£o vou mencionar explicitamente nenhuma das pessoas envolvidas nos projetos, mas antes de come√ßar a lista quero deixar registrado que muito do que a gente tem hoje foi culpa do Yihui Xie. Muito obrigado, Yihui!\nPrimeira posi√ß√£o: rticles\rO pacote rticles cont√©m v√°rios templates para documentos em rmarkdown. Os modelos s√£o todos baseados nos padr√µes de artigos acad√™micos, mas eles s√£o bonitos e flex√≠veis o suficiente para garantir sua aplicabilidade em v√°rios outros contextos.\nPra aplica√ß√µes mais gerais, acho o template da Statistic in Medicine bastante adequado.\n\rSegunda posi√ß√£o: tufte\rNa nossa segunda posi√ß√£o, vem o pacote tufte. Ele cont√©m templates para documentos em rmarkdown e ferramentas gr√°ficas que se baseiam nas pr√°ticas de visualiza√ß√£o do Edward Tufte 2, sujeito que est√° no banner desse post. A ideia aqui √© construir relat√≥rios fluidos e que incorporem formas de informa√ß√£o quantitativas (gr√°ficos e tabelas) de maneira mais fluida.\nVendo alguns exemplos no site do Rstudio d√° pra ver como a coisa √© elegante e pr√°tica. A grande sacada √© usar a margem com mais liberdade: algumas notas de rodap√©, por exemplo, na verdade s√£o pequenos coment√°rios, ent√£o voc√™ pode inseri-los na margem da p√°gina pra sugerir essa rela√ß√£o mais √≠ntima com o que voc√™ escreveu.\n\rTerceira posi√ß√£o: bookdown\rNa terceira posi√ß√£o vem um pacote um pouco mais jovem do que os anteriores. Dessa vez o objetivo √© construir documentos mais longos, como uma apostila ou um relat√≥rio. A estrutura de arquivos √© bastante simples e √© poss√≠vel criar cap√≠tulos, se√ß√µes, sum√°rios etc como se voc√™ estivesse rascunhando alguma coisa em rmarkdown.\nAl√©m de estruturar a escrita de um documento grande, esse pacote tamb√©m se comunica bem com o tufte e j√° prev√™ alguma maneiras de publicar o seu trabalho. √â poss√≠vel compilar os books em um html, mais ou menos como os livros do Hadley, ou num pdf, sugerindo uma maneira bem legal de escrever uma disserta√ß√£o ou uma tese. Se voc√™ integrar o bookdown com Travis, ent√£o, o c√©u √© o limite.\n\r\rhttps://web.archive.org/web/20040402182332/http://daringfireball.net/projects/markdown/‚Ü©Ô∏é\n\rhttps://www.edwardtufte.com/tufte/‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-07-15-top-3-rmarkdown/","tags":["r-markdown","rstudio"],"title":"Top 3 pacotes pra usar com rmarkdown"},{"author":["William"],"categories":["Tutoriais"],"contents":"\rArrumar base de dados √© uma tarefa chata, perigosa e pode consumir uma grande parcela do tempo total do projeto.\nA tarefa √© chata porque √© um grande retrabalho que muitas vezes cai na m√£o dos estat√≠sticos. Mandar de volta para o respons√°vel corrigir √© uma op√ß√£o, mas j√° passei por situa√ß√µes em que o tempo perdido no vai-e-vem da bd foi bem maior do que o tempo que eu gastaria para arrumar eu mesmo (e no fim, o banco ainda continha erros). Bds apropriadas para a an√°lise poderiam (e deveriam) ser montados pelo pesquisador ou respons√°vel desde o in√≠cio, pois, em geral, s√£o bem mais simples do que as que costumamos receber. Por isso, sempre vale espalhar as boas pr√°ticas de constru√ß√£o de bds na hora de pegar um trabalho.\n√â uma tarefa perigosa porque mexer nos dados √© sempre uma fonte de erro, principalmente quando fazemos altera√ß√µes diretamente na planilha e/ou n√£o temos conhecimento t√©cnico sobre as vari√°veis.\nPor fim, se a base √© muito grande e tem muitos erros, precisamos encontrar formas eficientes para corrigi-la, pois mexer em vari√°vel por vari√°vel, se n√£o for invi√°vel, pode demandar muito tempo.\nSendo assim, vamos come√ßar aqui uma pequena s√©rie de posts para ajudar nessa tarefa, utilizando sempre as ferramentas do tidyverse, em especial do pacote stringr. Neste post, come√ßarei mostrando uma forma r√°pida para padronizar os nomes das vari√°veis da bd, deixando-os mais adequados para o restante da an√°lise.\nPara isso, vou utilizar como exemplo algumas vari√°veis de uma base com que trabalhei alguns anos atr√°s. A bd original (que continha informa√ß√µes de pacientes do Instituto do Cora√ß√£o) tinha cerca 170 vari√°veis, ent√£o selecionei apenas algumas.\nlibrary(tidyverse)\rdados %\u0026gt;% names\r## [1] \u0026quot;Sexo\u0026quot; \u0026quot;Nascimento\u0026quot; \u0026quot;Idade\u0026quot; ## [4] \u0026quot;Inclus√£o\u0026quot; \u0026quot;Cor\u0026quot; \u0026quot;Peso\u0026quot; ## [7] \u0026quot;Altura\u0026quot; \u0026quot;cintura\u0026quot; \u0026quot;IMC\u0026quot; ## [10] \u0026quot;Superf√≠cie corporal\u0026quot; \u0026quot;Tabagismo\u0026quot; \u0026quot;cg.tabag (cig/dia)\u0026quot; ## [13] \u0026quot;Alcool (dose/semana)\u0026quot; \u0026quot;Drogas il√≠citas\u0026quot; \u0026quot;Cafe√≠na/dia\u0026quot; ## [16] \u0026quot;Refrig/dia\u0026quot; \u0026quot;Sedentario\u0026quot; \u0026quot;ativ. Fisica\u0026quot;\rVejam que os nomes t√™m letras mai√∫sculas, acentos, par√™nteses, pontos e barras. N√£o √© imposs√≠vel fazer a an√°lise com esses nomes, mas geralmente atrapalha bastante quando precisamos selecionar algumas dessas colunas. O ideal seria ter os nomes padronizados, at√© para ficar mais f√°cil de lembrarmos deles.\nPara deixar o exemplo reprodut√≠vel sem a necessidade de baixar a bd, gerei o c√≥digo para criar um vetor com o nome das vari√°veis.\ndados %\u0026gt;%\rnames %\u0026gt;%\rpaste0(\u0026quot;\u0026#39;\u0026quot;, ., \u0026quot;\u0026#39;\u0026quot;, collapse = \u0026quot;, \u0026quot;) %\u0026gt;%\rpaste0(\u0026quot;c(\u0026quot;, ., \u0026quot;)\u0026quot;)\r## [1] \u0026quot;c(\u0026#39;Sexo\u0026#39;, \u0026#39;Nascimento\u0026#39;, \u0026#39;Idade\u0026#39;, \u0026#39;Inclus√£o\u0026#39;, \u0026#39;Cor\u0026#39;, \u0026#39;Peso\u0026#39;, \u0026#39;Altura\u0026#39;, \u0026#39;cintura\u0026#39;, \u0026#39;IMC\u0026#39;, \u0026#39;Superf√≠cie corporal\u0026#39;, \u0026#39;Tabagismo\u0026#39;, \u0026#39;cg.tabag (cig/dia)\u0026#39;, \u0026#39;Alcool (dose/semana)\u0026#39;, \u0026#39;Drogas il√≠citas\u0026#39;, \u0026#39;Cafe√≠na/dia\u0026#39;, \u0026#39;Refrig/dia\u0026#39;, \u0026#39;Sedentario\u0026#39;, \u0026#39;ativ. Fisica\u0026#39;)\u0026quot;\rPara padronizar os nomes (todos ao mesmo tempo), utilizei o c√≥digo abaixo. Se voc√™ n√£o est√° familiarizado com as express√µes regulares (regex), temos um pequeno tuturial no material do nosso curso. Veja o que cada linha faz.\n\rstringr::str_trim(): remove espa√ßos do come√ßo e do final. N√£o tinha nenhum caso neste exemplo, mas √© sempre bom garantir.\rstringr::str_to_lower(): transforma letras mai√∫sculas em min√∫sculas.\rabjutils::rm_accent(): remove os acentos das palavras.\rstringr::str_replace_all(\"[/' '.()]\", \"_\"): substitui barras, espa√ßos e par√™nteses por subtra√ßo _.\rstringr::str_replace_all(\"_+\", \"_\"): substitui um ou mais subtra√ßos juntos por apenas um subtra√ßo.\rstringr::str_replace(\"_$\", \"\"): remove os subtra√ßos no final dos nomes.\r\rnomes \u0026lt;- dados %\u0026gt;%\rnames %\u0026gt;%\rstringr::str_trim() %\u0026gt;%\rstringr::str_to_lower() %\u0026gt;%\rabjutils::rm_accent() %\u0026gt;%\rstringr::str_replace_all(\u0026quot;[/\u0026#39; \u0026#39;.()]\u0026quot;, \u0026quot;_\u0026quot;) %\u0026gt;%\rstringr::str_replace_all(\u0026quot;_+\u0026quot;, \u0026quot;_\u0026quot;) %\u0026gt;%\rstringr::str_replace(\u0026quot;_$\u0026quot;, \u0026quot;\u0026quot;)\rnomes\r## [1] \u0026quot;sexo\u0026quot; \u0026quot;nascimento\u0026quot; \u0026quot;idade\u0026quot; ## [4] \u0026quot;inclusao\u0026quot; \u0026quot;cor\u0026quot; \u0026quot;peso\u0026quot; ## [7] \u0026quot;altura\u0026quot; \u0026quot;cintura\u0026quot; \u0026quot;imc\u0026quot; ## [10] \u0026quot;superficie_corporal\u0026quot; \u0026quot;tabagismo\u0026quot; \u0026quot;cg_tabag_cig_dia\u0026quot; ## [13] \u0026quot;alcool_dose_semana\u0026quot; \u0026quot;drogas_ilicitas\u0026quot; \u0026quot;cafeina_dia\u0026quot; ## [16] \u0026quot;refrig_dia\u0026quot; \u0026quot;sedentario\u0026quot; \u0026quot;ativ_fisica\u0026quot;\rAgora basta atribuir os nomes de volta aos dados.\nnames(dados) \u0026lt;- nomes\rClaro que o c√≥digo utilizado funciona bem para esse exemplo. Se os nomes tivessem outros problemas, precisar√≠amos acrescentar mais linhas contendo outras mudan√ßas. No entanto, essas altera√ß√µes j√° resolvem a maioria dos casos mais comuns e √© bem f√°cil modificar o c√≥digo para lidar com outros problemas.\nD√∫vidas, cr√≠ticas ou sugest√µes, deixe um coment√°rio ou nos envie uma mensagem. :)\n","permalink":"https://blog.curso-r.com/posts/2017-07-13-bds_nomes_variaveis/","tags":["base de dados","tidyverse"],"title":"Arrumando BDs: nome das vari√°veis"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rNo meu √∫ltimo post anunciei que come√ßar√≠amos uma s√©rie sobre CAPTCHAs. Uma da nossas iniciativas principais nesse tema √© a cria√ß√£o do pacote decryptr. Hoje veremos como usar algumas das fun√ß√µes principais desse pacote.\nSuposi√ß√µes do decryptr\rAo criar o decryptr reduzimos um pouco o escopo de CAPTCHAs que gostar√≠amos de incluir. Fizemos isso para n√£o ficarmos malucos, pois existem diversos tipos de testes dispon√≠veis na web!\nAs suposi√ß√µes s√£o:\nApenas imagens jpg ou png.\rUma imagem possui apenas n√∫meros e letras.\rA quantidade de caracteres de um CAPTCHA √© fixa.\rDois CAPTCHAs de mesma origem t√™m sempre as mesmas dimens√µes.\rN√£o conseguimos nem queremos quebrar o reCAPTCHA.\r\r\rInstala√ß√£o\rO decryptr ainda n√£o est√° no CRAN. Isso significa que para instal√°-lo voc√™ precisar√° do devtools:\nif (!require(devtools)) install.packages(\u0026#39;devtools\u0026#39;)\rdevtools::install_github(\u0026#39;decryptr/decryptr\u0026#39;)\rAs fun√ß√µes principais do decryptr s√£o\n\rdownload(): baixar imagens da web.\rread_captcha(): adiciona metadados √∫teis a uma string com o caminho do CAPTCHA.\rload_captcha(): carrega a imagem na mem√≥ria.\rplot.captcha(): m√©todo S3 para desenhar o CAPTCHA na tela.\rclassify.captcha(): m√©todo S3 para classificar CAPTCHAs manualmente.\rprepare.captcha(): m√©todo S3 para carregar CAPTCHAs em um formato adequado para modelagem usando o Keras.\rmodel.captcha(): m√©todo S3 para modelar os CAPTCHAs.\rpredict.captcha(): m√©todo S3 para classificar um CAPTCHA a partir de um modelo ajustado e um caminho de imagem.\r\rFluxo de utiliza√ß√£o\rO modo de uso planejado do decryptr est√° descrito na Figura ??.\nComo ainda n√£o temos a teoria completa para ajuste de modelos, nesse post vamos ficar com a utiliza√ß√£o das fun√ß√µes de download, visualiza√ß√£o e classifica√ß√£o.\n\r\rDownload\rA fun√ß√£o download() tem cinco par√¢metros:\n\rurl= o link do CAPTCHA que queremos baixar.\rdest= a pasta que queremos salvar a imagem.\rn= a quantidade de CAPTCHAs a serem baixados.\rsecure= se TRUE, far√° o download com a op√ß√£o ssl_verifypeer = FALSE (veja esse post)\rtype= extens√£o do arquivo (jpg/jpeg ou png).\r\rEssa n√£o √© uma das fun√ß√µes mais seguras do mundo, j√° que dependemos de uma boa conex√£o com o servidor de onde os CAPTCHAs ser√£o baixados. A fun√ß√£o tamb√©m n√£o trata de problemas com bloqueio de IP.\nPara facilitar a utiliza√ß√£o do decryptr, adicionamos algumas fun√ß√µes do tipo download_*(), que j√° cont√™m os padr√µes para download de alguns sites espec√≠ficos:\n\rdownload_rfb: Consulta de CNPJ da Receita federal.\rdownload_saj: Sistema SAJ (v√°rios Tribunais Estaduais).\rdownload_tjmg: Tribunal de Justi√ßa de Minas Gerais.\rdownload_tjrj: Tribunal de Justi√ßa do Rio de Janeiro.\rdownload_tjrs: Tribunal de Justi√ßa do Rio Grande do Sul.\rdownload_trt: Tribunais Regionais do Trabalho.\r\rNesses casos, os √∫nicos par√¢metros s√£o dest= e n=. Exemplo:\nlibrary(decryptr)\rdownload_tjmg(\u0026#39;img/tjmg\u0026#39;, n = 5) # salva arquivo em ./img/tjmg/captcha\u0026lt;id\u0026gt;.jpeg\r\rVisualiza√ß√£o\rPara plotar um CAPTCHA basta ler o arquivo com read_captcha() e depois usar a fun√ß√£o plot(). Exemplo:\nlibrary(decryptr)\r\u0026#39;../../static/data/captcha-dados/tjmg/captcha4d2f1097adba_73301.jpeg\u0026#39; %\u0026gt;% read_captcha() %\u0026gt;% purrr::pluck(1) %\u0026gt;%\rplot()\rVale mencionar que esse n√£o √© um ggplot() ent√£o nem tente somar layers nesse gr√°fico üòÑ.\n\rClassifica√ß√£o\rA classifica√ß√£o manual de CAPTCHAs √© importante para possibilitar o treino de modelos preditivos. Para classificar um CAPTCHA voc√™ pode utilizar a fun√ß√£o classify(), assim:\n\u0026#39;img/tjmg/captcha4d2f795d4e4_92522.jpeg\u0026#39; %\u0026gt;% read_captcha() %\u0026gt;% classify()\rEssa fun√ß√£o far√° duas coisas:\n\rPlota o CAPTCHA na tela.\rAbre um console para o usu√°rio digitar o valor do CAPTCHA manualmente.\r\rAo escrever o valor o CAPTCHA, pressione \u0026lt;enter\u0026gt;. Ap√≥s isso, a fun√ß√£o classify() ir√° adicionar sua classifica√ß√£o ap√≥s o nome da imagem, como no exemplo acima: _92522. A fun√ß√£o classify() gera uma c√≥pia para que seja imposs√≠vel de perder a imagem original.\nAlgumas op√ß√µes do classify():\n\rdest= colocar uma pasta para classificar os CAPTCHAs. Por padr√£o √© a pasta onde os originais est√£o.\ranswer= adicionar uma resposta ao inv√©s de esperar abrir o console. Essa op√ß√£o √© √∫til quando as classfica√ß√µes s√£o feitas automaticamente (e.g., por um quebrador de CAPTCHAs que usa o √°udio no lugar da imagem.)\r\r\rWrap-up\r\rBaixar com download() ou download_*().\rVisualizar com read_captcha() pipe plot().\rClassificar com read_captcha() pipe classify().\r\rCaso encontre problemas, adicione issues no reposit√≥rio do pacote.\n√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-29-captcha-decryptr/","tags":["captcha","decryptr"],"title":"Quebrando CAPTCHAs - Parte II: O pacote decryptr"},{"author":["Daniel"],"categories":["Tutoriais"],"contents":"\rEstou bem longe de ter experi√™ncia em modelagem bayesiana usando linguagens de\rprograma√ß√£o probabil√≠stica como Stan ou BUGS, mas vi esse pacote chamado greta\rque me chamou a aten√ß√£o.\nO greta √© um pacote feito totalmente em R, mas que usa o TensorFlow como backend\rpara fazer os seus c√°lculos. Isso tudo por interm√©dio do reticulate. A vantagem de\rusar o TensorFlow como backend √© a escalabilidade: o greta pode ser r√°pido at√©\rmesmo em bases de dados grandes e tamb√©m pode ser acelerada usando clusters de CPU‚Äôs\rou GPU‚Äôs.\nO greta j√° est√° dispon√≠vel no CRAN e pode ser instalado com:\ninstall.packages(\u0026quot;greta\u0026quot;)\rVou mostrar um exemplo simples copiado da p√°gina de in√≠cio do site do pr√≥prio\rgreta e depois vou implementar um modelo que o Fernando implementou aqui no blog\rem um outro post sobre estimar um modelo heteroced√°stico no R.\nExemplo simples\rVamos implementar o modelo de regress√£o linear mais simples poss√≠vel. Temos duas\rvari√°veis cont√≠nuas \\(x\\) e \\(y\\) e queremos estimar um modelo da forma:\n\\[y = a + b*x + \\epsilon\\]\nem que \\(\\epsilon\\) possui distribui√ß√£o normal com m√©dia zero e desvio padr√£o \\(\\sigma\\).\rNo greta isso pode ser feito da seguinte forma:\nlibrary(greta)\r# define as vari√°veis x e y\rx \u0026lt;- iris$Petal.Length\ry \u0026lt;- iris$Sepal.Length\r# define a distribui√ß√£o priori dos par√¢metros\ra = normal(0, 5)\rb = normal(0, 3)\rsd = lognormal(0, 3)\r# define o modelo\rmean \u0026lt;- a + b * x\rdistribution(y) = normal(mean, sd)\rm \u0026lt;- model(a, b, sd)\r# retira amostras usando mcmc\rdraws \u0026lt;- mcmc(m, n_samples = 1000)\rVoc√™ pode fazer um gr√°fico para visualizar as estimativas dos par√¢metros usando o\rbayesplot:\nbayesplot::mcmc_trace(draws, facet_args = list(ncol = 1))\rPodemos obter as estimativas pontuais dos par√¢metros pegando, por exemplo, a mediana\rdessa amostra do MCMC.\napply(draws[[1]], 2, median)\r## a b sd\r## 4.2805710 0.4219092 0.3697692\rEsse resultado √© muito similar ao que pode ser obtido por uma regress√£o linear simples:\nlm(y ~ x)\r##\r## Call:\r## lm(formula = y ~ x)\r##\r## Coefficients:\r## (Intercept) x\r## 4.3066 0.4089\r\rModelo linear heteroced√°stico\rNeste post\ro Fernando simulou um banco de dados que √© heteroced√°stico e depois ajustou um modelo\rdeste tipo de diversas maneiras, vou acrescentar mais uma aqui, desta vez usando o greta.\nVou simular o banco de dados da mesma forma que o Fernando:\nlibrary(ggplot2)\rN \u0026lt;- 1000\rset.seed(11071995)\rX \u0026lt;- sample((N/100):(N*3), N)\rY \u0026lt;- rnorm(N,X,4*sqrt(X))\rqplot(X,Y) +\rtheme_bw(15) +\rgeom_point(color = \u0026#39;darkorange\u0026#39;)\r\rX2 \u0026lt;- sqrt(X)\rdataset \u0026lt;- data.frame(Y,X,X2)\rAgora o c√≥digo em greta para ajustar esse modelo:\n# definir os vetores\ry \u0026lt;- dataset$Y\rx \u0026lt;- dataset$X\rx2 \u0026lt;- dataset$X2\r# definir prioris dos par√¢metros\ralpha \u0026lt;- gamma(1, 1)\rbeta \u0026lt;- normal(0, 10)\r# definir liga√ß√µes\rmean \u0026lt;- beta * x\rsd \u0026lt;- alpha * x2\r# definir o modelo\rdistribution(y) = normal(mean, sd)\rm \u0026lt;- model(alpha, beta)\r# ajustar\rdraws \u0026lt;- mcmc(m, n_samples = 1000)\rAgora as estimativas pontuais:\napply(draws[[1]], 2, median)\r## alpha beta\r## 4.077689 1.002791\rComo esperado, chegamos em estimativas bem pr√≥ximas do que foi simulado.\nPor hoje √© isso!! Abra√ßos!\n\r","permalink":"https://blog.curso-r.com/posts/2017-07-09-greta/","tags":["tensorflow","bayes"],"title":"Greta"},{"author":["Athos"],"categories":["Tutoriais"],"contents":"\rWoE (weight of evidence) √© uma ferramenta bastante usada em aplica√ß√µes de regress√£o log√≠stica, principalmente na √°rea de score de cr√©dito. Simploriamente falando, ele transforma categorias em n√∫meros que refletem a diferen√ßa entre elas pelo crit√©rio de separa√ß√£o do Y = 1 e Y = 0.\nSe voc√™ ainda n√£o sabe o que √© ou quer ler mais sobre o assunto, um texto que eu gostei de ler:\n\rData Exploration with Weight of Evidence and Information Value in R\r\rO autor desse texto √© o Kim Larsen, criador do pacote Information que √© completo e cheio de ferramentas sofisticadas em torno do WoE. Por√©m, no dia a dia do meu trabalho volta e meia eu tinha que construir rotinas pr√≥prias para fazer as vers√µes em WoE das minhas vari√°veis, mesmo com v√°rios pacotes completos dispon√≠veis. A principal motiva√ß√£o era que eles n√£o eram muito pr√°ticos e n√£o se encaixavam na filosofia do tidyverse. Da√≠ acabei juntando essas rotinas num pacote chamado tidywoe e deixando no ar. A ideia √© que ela fa√ßa o analista ganhar em tempo, legibilidade e reprodutibilidade. Abaixo segue como usar.\nInstala√ß√£o\rPara instalar, basta rodar abaixo.\n# install.packages(\u0026quot;devtools\u0026quot;)\rdevtools::install_github(\u0026quot;athospd/tidywoe\u0026quot;)\r\rDados e pacotes para os exemplos\rlibrary(forcats)\rlibrary(ggplot2)\rlibrary(dplyr)\rlibrary(tidywoe)\r# install.packages(\u0026quot;FactoMineR\u0026quot;)\rdata(tea, package = \u0026quot;FactoMineR\u0026quot;)\rtea_mini \u0026lt;- tea %\u0026gt;% select(breakfast, how, where, price)\r\rComo usar\rTem duas fun√ß√µes que importam:\r- add_woe() - adiciona os woe‚Äôs num data frame.\r- woe_dictionary() - cria dicion√°rio que mapeia as categorias com os woe‚Äôs.\nadd_woe()\rA fun√ß√£o add_woe() serve para adicionar as vers√µes WoE‚Äôs das vari√°veis em sua amostra de dados.\ntea_mini %\u0026gt;% add_woe(breakfast)\r\r\r\rbreakfast\rhow\rwhere\rprice\rhow_woe\rwhere_woe\rprice_woe\r\r\r\rbreakfast\rtea bag\rchain store\rp_unknown\r-0.0377403\r-0.0451204\r-0.2564295\r\rbreakfast\rtea bag\rchain store\rp_variable\r-0.0377403\r-0.0451204\r0.1872882\r\rNot.breakfast\rtea bag\rchain store\rp_variable\r-0.0377403\r-0.0451204\r0.1872882\r\rNot.breakfast\rtea bag\rchain store\rp_variable\r-0.0377403\r-0.0451204\r0.1872882\r\r\r\rVoc√™ pode selecionar as vari√°veis que vc quiser selecionando-as como se fosse no dplyr::select().\ntea_mini %\u0026gt;% add_woe(breakfast, where:price)\r\rwoe_dictionary()\rA fun√ß√£o woe_dictionary() √© uma das duas partes necess√°rias para fazer o add_woe() funcionar (a outra parte s√£o os dados). Ele constr√≥i o dicion√°rio de categorias e seus respectivos woe‚Äôs.\ntea_mini %\u0026gt;% woe_dictionary(breakfast)\r\r\r\r\rvariable\rexplanatory\rn_tot\rn_breakfast\rn_Not.breakfast\rp_breakfast\rp_Not.breakfast\rwoe\r\r\r\rhow\rtea bag\r170\r80\r90\r0.5555556\r0.5769231\r-0.0377403\r\rhow\rtea bag+unpackaged\r94\r50\r44\r0.3472222\r0.2820513\r0.2078761\r\rhow\runpackaged\r36\r14\r22\r0.0972222\r0.1410256\r-0.3719424\r\rwhere\rchain store\r192\r90\r102\r0.6250000\r0.6538462\r-0.0451204\r\r\r\r\rUsando um dicion√°rio customizado\rMuitas vezes h√° o interesse em ajustar na m√£o alguns valores de woe para consertar a ordem dos efeitos de uma dada vari√°vel ordinal. Esse √© o motivo de o add_woe() poder receber um dicion√°rio passado pelo usu√°rio. Isso se faz por meio do argumento .woe_dictionary.\nA maneira mais f√°cil de se fazer isso √© montar um dicion√°rio inicial com o woe_dictionary() e depois alterar os valores nele para alcan√ßar os ajustes desejados. Exemplo:\n# Construa um dicion√°rio inicial\rtea_mini_woe_dic \u0026lt;- tea_mini %\u0026gt;% woe_dictionary(breakfast)\r# Mexa um pouquinho nos woes\rtea_mini_woe_dic_arrumado \u0026lt;- tea_mini_woe_dic %\u0026gt;% mutate(woe = if_else(explanatory == \u0026quot;p_unknown\u0026quot;, 0, woe))\r# Passe esse dicion√°rio para o add_woe()\rtea_mini %\u0026gt;% add_woe(breakfast, .woe_dictionary = tea_mini_woe_dic_arrumado)\r\r\r\r\rbreakfast\rhow\rwhere\rprice\rhow_woe\rwhere_woe\rprice_woe\r\r\r\rbreakfast\rtea bag\rchain store\rp_unknown\r-0.0377403\r-0.0451204\r0.0000000\r\rbreakfast\rtea bag\rchain store\rp_variable\r-0.0377403\r-0.0451204\r0.1872882\r\rNot.breakfast\rtea bag\rchain store\rp_variable\r-0.0377403\r-0.0451204\r0.1872882\r\rNot.breakfast\rtea bag\rchain store\rp_variable\r-0.0377403\r-0.0451204\r0.1872882\r\r\r\r\r\rExemplo de explora√ß√£o\rO woe_dictionary() devolve uma tabela arrumada, bem conveniente para explorar mais. Por exemplo, a tabela est√° pronta para o ggplot.\ntea_mini_woe_dic_arrumado %\u0026gt;%\rmutate(explanatory = explanatory %\u0026gt;% as.factor %\u0026gt;% fct_reorder(woe)) %\u0026gt;%\rfilter(variable %in% c(\u0026quot;price\u0026quot;, \u0026quot;how\u0026quot;)) %\u0026gt;%\rggplot() +\rgeom_bar(aes(x = explanatory, y = woe), stat = \u0026quot;identity\u0026quot;) +\rfacet_wrap(~variable, scales = \u0026quot;free_x\u0026quot;) +\rtheme(axis.text.x = element_text(angle = 30))\rAqui est√° o github do pacote para contribui√ß√µes. Pretendo colocar bastante coisa nova no pacote ainda.\nAbs\n\r","permalink":"https://blog.curso-r.com/posts/2017-07-06-tidywoe/","tags":["woe"],"title":"WoE em R com tidywoe"},{"author":["William"],"categories":["Tutoriais"],"contents":"\rSe voc√™ ainda n√£o √© adepta ou adepto do tidyverse, provavelmente precisa setar stringsAsFactors = FALSE em algum momento ou sempre trabalha com fatores em vez de strings.\nStrings s√£o sequ√™ncias de caracteres que podem ser acessados pela sua posi√ß√£o. Assim, podemos usar express√µes regulares para modificar partes da sequ√™ncia que correspondam a um determinado padr√£o. Fatores s√£o inteiros com categorias (ou labels) formadas por strings guardadas apenas uma vez no atributo levels. Por facilitarem a ordena√ß√£o de valores de texto, eles s√£o importantes para a cria√ß√£o de vari√°veis dummies e a defini√ß√£o de contrastes em fun√ß√µes de modelagem estat√≠stica, como a lm(), e a organiza√ß√£o de atributos gr√°ficos, como no pacote ggplot2.\nH√° motivos hist√≥ricos para fun√ß√µes como read.table() e data.frame() fazerem, por default, a coer√ß√£o de caracteres para fatores. Voc√™ pode ler sobre isso nos posts stringsAsFactors: An unauthorized biography, do Roger Peng, e stringsAsFactors = , do Thomas Lumley. O que mudou √© que, de um tempo para c√°, nem toda vari√°vel n√£o-num√©rica √©, de fato, uma vari√°vel categ√≥rica. E, quando este √© o caso, queremos trabalh√°-las como strings.\nAl√©m de n√£o transformar strings em fatores, o tidyverse tamb√©m disp√µe de um pacote s√≥ para manipular fatores: o forcats (for categorial variables). Para come√ßar a us√°-lo, instale e carregue o pacote.\ninstall.packages(\u0026quot;forcats\u0026quot;)\rlibrary(forcats)\rlibrary(tidyverse)\rO forcats √© um pacote bastante simples. Basicamente, ele √© composto por fun√ß√µes de apenas dois tipos:\n\rFun√ß√µes que come√ßam com fct_, que recebem uma lista de fatores e devolvem um fator.\rFun√ß√µes que come√ßam com lvl_, que modificam os n√≠veis de um fator.\r\rVeja a seguir exemplos de como utilizar as principais fun√ß√µes.\nfct_recode\rAltera categorias espec√≠ficas de um fator.\nfator \u0026lt;- factor(c(\u0026quot;Scorsese\u0026quot;, \u0026quot;DiCaprio\u0026quot;, \u0026quot;Patty Jenkins\u0026quot;, \u0026quot;Gal Gadot\u0026quot;))\r# Alterando apenas uma\rfct_recode(fator, direcao = \u0026quot;Scorsese\u0026quot;)\r## [1] direcao DiCaprio Patty Jenkins Gal Gadot ## Levels: DiCaprio Gal Gadot Patty Jenkins direcao\r# Alterando todas\rfct_recode(fator,\rdirecao = \u0026quot;Scorsese\u0026quot;,\rdirecao = \u0026quot;Patty Jenkins\u0026quot;,\relenco = \u0026quot;DiCaprio\u0026quot;,\relenco = \u0026quot;Gal Gadot\u0026quot;)\r## [1] direcao elenco direcao elenco ## Levels: elenco direcao\r\rfct_collapse\rJunta categorias em grupos manualmente definidos.\n# Objeto simulando uma amostra do personagem\r# de s√©rie favorito de 100 pessoas\rnomes \u0026lt;- c(\u0026quot;Sheldon\u0026quot;, \u0026quot;Leonard\u0026quot;, \u0026quot;Penny\u0026quot;, \u0026quot;Howard\u0026quot;, \u0026quot;Rajesh\u0026quot;,\r\u0026quot;Ted\u0026quot;, \u0026quot;Marshall\u0026quot;, \u0026quot;Robin\u0026quot;, \u0026quot;Lily\u0026quot;, \u0026quot;Barney\u0026quot;,\r\u0026quot;Michael\u0026quot;, \u0026quot;Jim\u0026quot;, \u0026quot;Pam\u0026quot;, \u0026quot;Dwight\u0026quot;, \u0026quot;Andy\u0026quot;)\rper_fav\u0026lt;- sample(x = nomes, size = 100, replace = T) %\u0026gt;%\ras.factor\rhead(per_fav)\r## [1] Sheldon Robin Lily Sheldon Jim Pam ## 15 Levels: Andy Barney Dwight Howard Jim Leonard Lily Marshall Michael ... Ted\r# Conta o n√∫mero de observa√ß√µes em cada categoria\rfct_count(per_fav)\r## # A tibble: 15 √ó 2\r## f n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 Andy 5\r## 2 Barney 11\r## 3 Dwight 5\r## 4 Howard 7\r## 5 Jim 6\r## 6 Leonard 10\r## 7 Lily 5\r## 8 Marshall 4\r## 9 Michael 6\r## 10 Pam 9\r## 11 Penny 9\r## 12 Rajesh 4\r## 13 Robin 5\r## 14 Sheldon 6\r## 15 Ted 8\r# Junta as categorias\rper_fav2 \u0026lt;- fct_collapse(per_fav,\rTBBT = c(\u0026quot;Sheldon\u0026quot;, \u0026quot;Leonard\u0026quot;, \u0026quot;Penny\u0026quot;, \u0026quot;Howard\u0026quot;, \u0026quot;Rajesh\u0026quot;),\rHIMYM = c(\u0026quot;Ted\u0026quot;, \u0026quot;Marshall\u0026quot;, \u0026quot;Robin\u0026quot;, \u0026quot;Lily\u0026quot;, \u0026quot;Barney\u0026quot;),\rTheOffice = c(\u0026quot;Michael\u0026quot;, \u0026quot;Jim\u0026quot;, \u0026quot;Pam\u0026quot;, \u0026quot;Dwight\u0026quot;, \u0026quot;Andy\u0026quot;))\rhead(per_fav2)\r## [1] TBBT HIMYM HIMYM TBBT TheOffice TheOffice\r## Levels: TheOffice HIMYM TBBT\rfct_count(per_fav2)\r## # A tibble: 3 √ó 2\r## f n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 TheOffice 31\r## 2 HIMYM 33\r## 3 TBBT 36\r\rfct_reorder\rOrdena as categorias de um fator segundo uma fun√ß√£o. No exemplo abaixo, ordenamos os fatores da vari√°vel carb (n√∫mero de carburadores) segundo a mediana da vari√°vel mpg (milhas por gal√£o de combust√≠vel).\nmtcars %\u0026gt;%\rggplot(aes(x = as.factor(carb), y = mpg)) +\rgeom_boxplot()\rmtcars %\u0026gt;%\rmutate(carb = fct_reorder(.f = as.factor(carb),\r.x = mpg,\r.fun = median)) %\u0026gt;%\rggplot(aes(x = carb, y = mpg)) +\rgeom_boxplot()\r\rfct_lump\rAgrupa as categorias menos (ou mais) comuns.\nletras \u0026lt;- factor(letters[rpois(100, 5)])\rfct_count(letras)\r## # A tibble: 10 √ó 2\r## f n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 b 10\r## 2 c 13\r## 3 d 12\r## 4 e 25\r## 5 f 16\r## 6 g 6\r## 7 h 9\r## 8 i 2\r## 9 j 4\r## 10 l 2\r# Por default, a categoria \u0026quot;Other\u0026quot; sempre ser√° menor\r# que as outras categorias.\rletras %\u0026gt;%\rfct_lump(other_level = \u0026quot;Outros\u0026quot;) %\u0026gt;%\rfct_count\r## # A tibble: 10 √ó 2\r## f n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 b 10\r## 2 c 13\r## 3 d 12\r## 4 e 25\r## 5 f 16\r## 6 g 6\r## 7 h 9\r## 8 i 2\r## 9 j 4\r## 10 l 2\r# Espeficicando o argumento \u0026quot;n = 4\u0026quot;, preservamos os\r# 4 valores mais comuns\rletras %\u0026gt;%\rfct_lump(n = 4, other_level = \u0026quot;Outros\u0026quot;) %\u0026gt;%\rfct_count\r## # A tibble: 5 √ó 2\r## f n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 c 13\r## 2 d 12\r## 3 e 25\r## 4 f 16\r## 5 Outros 33\r# Espeficicando o argumento \u0026quot;n = -4\u0026quot;, preservamos\r# apenas os 4 valores que menos aparecem\rletras %\u0026gt;%\rfct_lump(n = -4, other_level = \u0026quot;Principais\u0026quot;) %\u0026gt;%\rfct_count\r## # A tibble: 5 √ó 2\r## f n\r## \u0026lt;fct\u0026gt; \u0026lt;int\u0026gt;\r## 1 g 6\r## 2 i 2\r## 3 j 4\r## 4 l 2\r## 5 Principais 85\r\rlvls_reorder\rTroca a ordem das categorias de um fator.\nfator \u0026lt;- factor(c(\u0026quot;casado\u0026quot;, \u0026quot;viuvo\u0026quot;, \u0026quot;solteiro\u0026quot;, \u0026quot;divorciado\u0026quot;))\rfator\r## [1] casado viuvo solteiro divorciado\r## Levels: casado divorciado solteiro viuvo\rlvls_reorder(fator, c(3, 1, 2, 4))\r## [1] casado viuvo solteiro divorciado\r## Levels: solteiro casado divorciado viuvo\rO pacote forcats ainda tem outras fun√ß√µes √∫teis para tratar com fatores, como fct_expand(), fct_explicit_na(), fct_infreq(), fct_reorder2(), lvls_revalue(), entre outras. No RStudio, √© sempre √∫til navegar entre as fun√ß√µes de um pacote digitando, por exemplo, forcats:: e pressionando TAB.\nD√∫vidas, cr√≠ticas ou sugest√µes, deixe um coment√°rio ou nos envie uma mensagem. :)\n\r","permalink":"https://blog.curso-r.com/posts/2017-07-01-forcats/","tags":["pacotes","fatores","forcats"],"title":"Forcats"},{"author":["Julio"],"categories":["discuss√µes"],"contents":"\r\rCAPTCHAs? SIM, CAPTCHAs\rSabe aquelas imagens chatas que aparecem quando voc√™ est√° preenchendo um formul√°rio ou quer acessar uma p√°gina espec√≠fica, pedindo para voc√™ decifrar o texto? Isso √© o que chamamos de CAPTCHA (Completely Automated Public Turing test to tell Computers and Humans Apart). Captchas foram criados para impedir que rob√¥s acessem determinadas p√°ginas na web de forma irrestrita. Algumas empresas como a Google tamb√©m usam essas coisinhas para utilizar o conhecimento de seres humanos para dominar o mundo.\nExistem captchas de todo tipo: dif√≠ceis, f√°ceis, que fazem sentido e que n√£o fazem sentido. Um exemplo de CAPTCHA que faz sentido s√£o os presentes em formul√°rios para cria√ß√£o de emails. Imagine se algu√©m fizesse um programa que criasse bilh√µes de contas de e-mail do gmail! Morte horr√≠vel.\nUm exemplo de CAPTCHA que n√£o faz sentido s√£o os sites de servi√ßos p√∫blicos, como a Receita Federal ou de alguns Tribunais de Justi√ßa. Algumas justificativas para isso s√£o: i) n√£o onerar os sistemas (me poupe, basta fazer uma API) ou ii) a falsa ideia de que assim est√£o protegendo as pessoas (de acessar dados p√∫blicos?). Se uma informa√ß√£o √© p√∫blica ela deve ser acess√≠vel, ponto. O que √© errado n√£o √© acessar a informa√ß√£o, e sim fazer mau uso dela.\nPensando nisso, fiquei imaginando:\n\rSer√° que √© poss√≠vel quebrar CAPTCHAs usando modelos estat√≠sticos?\n\rTornando curta uma hist√≥ria longa, sim, √© poss√≠vel! O resultado dessa brincadeira est√° na organiza√ß√£o decryptr. Claro que n√£o s√£o todos os CAPTCHAs que conseguimos quebrar, mas estamos fazendo pesquisa, brincando nas Rackathons (hackathons com R) e discutindo v√°rias ideias para tornar isso vi√°vel. √â um esfor√ßo da comunidade para tornar os servi√ßos p√∫blicos mais acess√≠veis.\n\rS√©rie de posts\rComo esse tema √© extenso e envolve v√°rias t√©cnicas estat√≠sticas e computacionais avan√ßadas, decidimos montar uma s√©rie de posts. O plano de posts segue abaixo, mas pode mudar conforme os trabalhos forem realizados.\nIntrodu√ß√£o - feito! üòÑ\rO pacote decryptr: baixar, visualizar e classificar CAPTCHAs.\rResolvendo CAPTCHAs com segmenta√ß√£o manual.\rTrabalhando com as imagens completas.\rArquitetura do pacote decryptr.\rEstendendo o decryptr para quebrar seus pr√≥prios CAPTCHAs.\rRedes neurais aplicadas a CAPTCHAs.\rUtilizando o Keras para quebrar CAPTCHAs.\rQuebrando CAPTCHAs usando o √°udio - case da Receita Federal.\rT√≥picos e opini√µes sobre o tema.\r\r√â isso! Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-29-captcha-intro/","tags":["captcha"],"title":"Quebrando CAPTCHAs - Introdu√ß√£o"},{"author":["Daniel"],"categories":["conceitos"],"contents":"\rAutoencoders s√£o redes neurais treinadas\rcom o objetivo de copiar o seu input para o seu output. Esse interesse pode parecer\rmeio estranho, mas na pr√°tica o objetivo √© aprender representa√ß√µes (encodings) dos\rdados, que podem ser usadas para redu√ß√£o de dimensionalidade ou at√© mesmo compress√£o de arquivos.\nBasicamente, um autoencoder √© dividido em duas partes:\n\rum encoder que √© uma fun√ß√£o \\(f(x)\\) que transforma o input para uma representa√ß√£o \\(h\\)\rum decoder que √© uma fun√ß√£o \\(g(x)\\) que transforma a representa√ß√£o \\(h\\) em sua reconstru√ß√£o \\(r\\)\r\rImagem do blog do Keras\nConstruindo o seu primeiro autoencoder\rNesse pequeno tutorial, vou usar o keras para definir e treinar os nossos autoencoders.\rComo base de dados vou usar algumas simula√ß√µes e o banco de dados mnist (famoso para\rtodos que j√° mexeram um pouco com deep learning). O mnist √© um banco de dados de\rimagens de tamanho 28x28 de d√≠gitos escritos √† m√£o. Esse dataset promoveu grandes avan√ßos\rna √°rea de reconhecimento de imagens.\nlibrary(keras)\rencoding_dim \u0026lt;- 32\r# definindo o input\rinput \u0026lt;- layer_input(shape = 784)\r# definindo o encoder\rencoded \u0026lt;- layer_dense(input, encoding_dim, activation = \u0026quot;relu\u0026quot;)\r# definindo o decoder\rdecoded \u0026lt;- layer_dense(encoded, 784, activation = \u0026quot;sigmoid\u0026quot;)\rautoencoder \u0026lt;- keras_model(input, decoded)\rencoder \u0026lt;- keras_model(input, encoded)\r# definindo o decoder\rencoded_input \u0026lt;- layer_input(shape = encoding_dim)\rdecoder_layer \u0026lt;- autoencoder$get_layer(index = -1L) # √∫ltima camada do autoencoder\rdecoder \u0026lt;- keras_model(encoded_input, decoder_layer(encoded_input))\rCom esse c√≥digo definimos um modelo da seguinte forma:\n\\[ X = (X*W_1 + b_1)*W_2 + b_2 \\]\nEm que:\n\r\\(X\\) √© o nosso input com dimens√£o (?, 784)\r\\(W_1\\) √© uma matriz de pesos com dimens√µes (784, 32)\r\\(b_1\\) √© uma matriz de forma (?, 32)\r\\(W_2\\) √© uma matriz de pesos com dimens√µes (32, 784)\r\\(b_2\\) √© uma matriz de forma (?, 784)\r\rNote que ? aqui √© o n√∫mero de observa√ß√£oes da base de dados.\rAgora vamos estimar \\(W_1\\), \\(W_2\\), \\(b_1\\) e \\(b_2\\) de modo a minimizar alguma fun√ß√£o de perda.\nInicialmente vamos usar a binary crossentropy por pixel que √© definida por:\n\\[-\\sum_{i=1}y_i*log(\\hat{y}_i)\\]\nIsso √© definido no keras usando:\nautoencoder %\u0026gt;% compile(optimizer=\u0026#39;adadelta\u0026#39;, loss=\u0026#39;binary_crossentropy\u0026#39;)\rN√£o vou entrar em detalhes do que √© o adadelta, mas √© uma varia√ß√£o do m√©todo\rde otimiza√ß√£o conhecido como gradient descent.\nAgora vamos carregar a base de dados e em seguida treinar o nosso autoencoder`.\nmnist \u0026lt;- dataset_mnist()\r# o mnist √© um banco de imagens 28x28, vamos transformar cada imagem em um vetor\r# de tamanho 784, cada elemento representado um pixel.\rx_train \u0026lt;- mnist$train$x %\u0026gt;% apply(1, as.numeric) %\u0026gt;% t()\rx_test \u0026lt;- mnist$test$x %\u0026gt;% apply(1, as.numeric) %\u0026gt;% t()\r# vamos transformar as imagens p/ o intervalo 0-1 para que\r# a fun√ß√£o de perda funcione corretamente.\rx_train \u0026lt;- x_train/255\rx_test \u0026lt;- x_test/255\rEstimamos os par√¢metros desse modelo no keras fazendo:\nautoencoder %\u0026gt;% fit(\rx_train, x_train,\repochs = 50,\rbatch_size = 256,\rshuffle = TRUE,\rvalidation_data = list(x_test, x_test)\r)\rDepois de rodar todas as itera√ß√µes, voc√™ poder√° usar o seu encoder e o seu decoder\rpara entender o que eles fazem com as imagens.\nVeja o exemplo a seguir em que vamos obter os encodings para as 10 primeiras imagens\rda base de teste e depois reconstruir a imagem usando o decoder.\nencoded_imgs \u0026lt;- predict(encoder, x_test[1:10,])\rdim(encoded_imgs)\rencoded_imgs[1,] # representa√ß√£o vetorial de uma imagem.\r## [1] 10 32\r## [1] 0.0000000 10.1513205 3.5742311 2.6635208 6.3097358 3.4840517\r## [7] 9.1041250 6.6329145 1.6385922 9.8017225 9.5529270 1.6670935\r## [13] 5.7208562 4.8035479 3.9149191 0.6408147 1.2716029 3.1215091\r## [19] 13.7575903 0.0000000 1.8692881 3.2142215 0.7444992 5.0728440\r## [25] 8.2932110 9.9866810 2.7651572 11.1291723 5.2460670 5.6875997\r## [31] 10.6097431 3.6338394\rO encoder transforma a matriz de (10, 784) para uma matriz com dimensao (10, 2).\rPodemos reconstruir a imagem, a pardir da imagem que foi comprimida usando o\rnosso decoder.\npredict(decoder, encoded_imgs) %\u0026gt;% split(1:10) %\u0026gt;%\rlapply(matrix, ncol = 28) %\u0026gt;% Reduce(cbind, .) %\u0026gt;%\ras.raster() %\u0026gt;%\rplot()\rCompare as reconstru√ß√µes com as imagens originais abaixo:\nx_test[1:10,] %\u0026gt;%\rsplit(1:10) %\u0026gt;%\rlapply(matrix, ncol = 28) %\u0026gt;% Reduce(cbind, .) %\u0026gt;%\ras.raster() %\u0026gt;%\rplot()\rUm ponto interessante √© que esse modelo faz uma aproxima√ß√£o da solu√ß√£o por componentes\rprincipais! Na verdade, a defini√ß√£o do quanto\rs√£o parecidos √© quase-equivalente. Isso quer dizer que os pesos \\(W\\) encontrados pelo\rPCA e pelo autoencoder ser√£o diferentes, mas o sub-espa√ßo criado pelos mesmos ser√° equivalente.\nSe s√£o equivalentes, qual a vantagem de usar autoencoders ao inv√©s de PCA? O PCA para por\raqui, voc√™ define que ser√£o apenas rela√ß√µes lineares, e voc√™ reduz dimens√£o apenas reduzindo o\rtamanho da matriz. Em autoencoders voc√™ tem diversas outras sa√≠das para aprimorar o m√©todo.\nA primeira delas √© simplesmente adicionar uma condi√ß√£o de esparsidade nos pesos. Isso\rvai reduzir o tamanho do vetor latente (como √© chamada a camada do meio do autoencoder)\rtamb√©m, pois ele ter√° mais zeros.\nIsso pode ser feito rapidamente com o keras. Basta adicionar um activity_regularizer\rem nossa camada de encoding. Isso vai adicionar na fun√ß√£o de perda um termo que\rtoma conta do valor dos outputs da camada intermedi√°ria.\n# definindo o input\rinput \u0026lt;- layer_input(shape = 784)\r# definindo o encoder\rencoded \u0026lt;- layer_dense(input, encoding_dim, activation = \u0026quot;relu\u0026quot;, activity_regularizer = regularizer_l1(l = 10e-5))\r# definindo o decoder\rdecoded \u0026lt;- layer_dense(encoded, 784, activation = \u0026quot;sigmoid\u0026quot;)\rautoencoder \u0026lt;- keras_model(input, decoded)\rautoencoder %\u0026gt;% compile(optimizer=\u0026#39;adadelta\u0026#39;, loss=\u0026#39;binary_crossentropy\u0026#39;)\rautoencoder %\u0026gt;% fit(\rx_train, x_train,\repochs = 50,\rbatch_size = 256,\rshuffle = TRUE,\rvalidation_data = list(x_test, x_test)\r)\rOutra forma de melhorar o seu autoencoder √© permitir que o encoder e o decoder\rsejam redes neurais profundas. Com isso, ao inv√©s de tentar encontrar transforma√ß√µes\rlineares, voc√™ permitir√° que o autoencoder encontre transforma√ß√µes n√£o lineares.\nMais uma vez fazemos isso com o keras:\ninput \u0026lt;- layer_input(shape = 784)\rencoded \u0026lt;- layer_dense(input, 128, activation = \u0026quot;relu\u0026quot;) %\u0026gt;%\rlayer_dense(64, activation = \u0026quot;relu\u0026quot;) %\u0026gt;%\rlayer_dense(32, activation = \u0026quot;relu\u0026quot;)\rdecoded \u0026lt;- layer_dense(encoded, 64, activation = \u0026quot;relu\u0026quot;) %\u0026gt;%\rlayer_dense(128, activation = \u0026quot;relu\u0026quot;) %\u0026gt;%\rlayer_dense(784, activation = \u0026quot;sigmoid\u0026quot;)\rautoencoder \u0026lt;- keras_model(input, decoded)\rautoencoder %\u0026gt;% compile(optimizer=\u0026#39;adadelta\u0026#39;, loss=\u0026#39;binary_crossentropy\u0026#39;)\rautoencoder %\u0026gt;% fit(\rx_train, x_train,\repochs = 50,\rbatch_size = 256,\rshuffle = TRUE,\rvalidation_data = list(x_test, x_test)\r)\rExistem formas ainda mais inteligentes de construir esses autoencoders, mas o post\riria ficar muito longo e n√£o ia sobrar asssunto para o pr√≥ximo. Se voc√™ quiser saber\rmais, recomendo fortemente a leitura deste artigo do blog do Keras\re desse cap√≠tulo.\nUma fam√≠lia bem moderna de autoencoders s√£o os VAE (Variational Autoencoders). Esses\rautoencoders aprendem modelos de vari√°veis latentes.\rIsso √© interessante porque permite que voc√™ gere novos dados, parecidos com os que\rvoc√™ usou para treinar o seu autoencoder. Voc√™ pode encontrar uma implementa√ß√£o desse\rmodelo aqui.\n√â isso! Abra√ßos\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-26-construindo-autoencoders/","tags":["autoencoders","keras","deep-learning"],"title":"Construindo Autoencoders"},{"author":["Athos"],"categories":["conceitos"],"contents":"\r\r\r\r\r\r\r\rComponentes principais s√£o bastante utilizados em modelagem estat√≠stica, mas a sua defini√ß√£o matem√°tica rigorosa faz com que a ACP pare√ßa um conceito mais abstrato do que somos capazes de compreender, em particular quando falam ‚Äúmaximizar a vari√¢ncia total‚Äù e ‚Äúdiminuir a dimensionalidade‚Äù. A primeira rea√ß√£o √© um grande ‚ÄúHEIN?‚Äù.\nAbaixo tem alguns gr√°ficos em 3 dimens√µes que d√£o uma boa ilustra√ß√£o sobre o que essas duas afirmativas querem dizer e, mesmo sendo um exemplo simples, ir√£o ajudar a extrapolar a ideia para problemas mais complexos.\nO primeiro gr√°fico √© a representa√ß√£o com 100% da informa√ß√£o em tr√™s dimens√µes.\rO segundo gr√°fico √© como fica a representa√ß√£o do mesmo conjunto de dados, mas com uma dimens√£o a menos (redu√ß√£o de dimensionalidade).\rAo diminuir uma dimens√£o, perdemos informa√ß√£o (n√£o √© mais 100% da vari√¢ncia total) e essa perda √© mensurada pela vari√¢ncia explicada pelas dimens√µes que deixamos para tr√°s.\rAs duas primeiras dimens√µes projetam os dados de forma que apresentam a m√°xima a vari√¢ncia total poss√≠vel em apenas duas dimens√µes.\r\rpacotes para os exemplos\nlibrary(magrittr)\rlibrary(tidyr)\rlibrary(dplyr)\rObserva√ß√£o: n√£o esque√ßa de girar os gr√°ficos! =)\nExemplo 1 - Tetraedro\ra \u0026lt;- 1\rtetraedro \u0026lt;- data.frame( x = c(a * sqrt(3)/3, - a * sqrt(3)/6, - a * sqrt(3)/6, 0),\ry = c(0, - a/2, a/2, 0),\rz = c(0, 0, 0, a * sqrt(6)/3),\rcor = c(\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;, \u0026quot;c\u0026quot;, \u0026quot;d\u0026quot;),\rid = 1:4)\rtetraedro_linhas \u0026lt;- combn(x = tetraedro$id, m = 2) %\u0026gt;%\rt %\u0026gt;%\ras.data.frame.matrix %\u0026gt;%\rset_names(c(\u0026quot;id1\u0026quot;, \u0026quot;id2\u0026quot;)) %\u0026gt;%\rmutate(id_par = 1:n()) %\u0026gt;%\rgather(id_ordem, id, id1, id2) %\u0026gt;%\rleft_join(tetraedro, by = \u0026quot;id\u0026quot;) %\u0026gt;%\rarrange(id_ordem)\rContribui√ß√£o dos componentes na vari√¢ncia total\ntetraedro_pc \u0026lt;- prcomp(tetraedro %\u0026gt;% dplyr::select(x, y, z)) # PCA acontece aqui\rknitr::kable(summary(tetraedro_pc)$importance)\r\r\r\rPC1\rPC2\rPC3\r\r\r\rStandard deviation\r0.4082483\r0.4082483\r0.4082483\r\rProportion of Variance\r0.3333300\r0.3333300\r0.3333300\r\rCumulative Proportion\r0.3333300\r0.6666700\r1.0000000\r\r\r\r3 dimens√µes (100% da vari√¢ncia)\nlibrary(plotly)\rplot_ly(tetraedro_linhas, x = ~x, y = ~y, z = ~z) %\u0026gt;%\radd_lines() %\u0026gt;%\radd_markers()\r\r{\"x\":{\"visdat\":{\"17bbd6ca9e179\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"17bbd6ca9e179\",\"attrs\":{\"17bbd6ca9e179\":{\"x\":{},\"y\":{},\"z\":{},\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter3d\",\"mode\":\"lines\",\"inherit\":true},\"17bbd6ca9e179.1\":{\"x\":{},\"y\":{},\"z\":{},\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter3d\",\"mode\":\"markers\",\"inherit\":true}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"scene\":{\"xaxis\":{\"title\":\"x\"},\"yaxis\":{\"title\":\"y\"},\"zaxis\":{\"title\":\"z\"}},\"hovermode\":\"closest\",\"showlegend\":true},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"x\":[-0.288675134594813,-0.288675134594813,-0.288675134594813,-0.288675134594813,-0.288675134594813,-0.288675134594813,0,0,0,0.577350269189626,0.577350269189626,0.577350269189626],\"y\":[-0.5,-0.5,0.5,-0.5,0.5,0.5,0,0,0,0,0,0],\"z\":[0,0,0,0,0,0,0.816496580927726,0.816496580927726,0.816496580927726,0,0,0],\"type\":\"scatter3d\",\"mode\":\"lines\",\"marker\":{\"color\":\"rgba(31,119,180,1)\",\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"line\":{\"color\":\"rgba(31,119,180,1)\"},\"frame\":null},{\"x\":[0.577350269189626,0.577350269189626,0.577350269189626,-0.288675134594813,-0.288675134594813,-0.288675134594813,-0.288675134594813,-0.288675134594813,0,-0.288675134594813,0,0],\"y\":[0,0,0,-0.5,-0.5,0.5,-0.5,0.5,0,0.5,0,0],\"z\":[0,0,0,0,0,0,0,0,0.816496580927726,0,0.816496580927726,0.816496580927726],\"type\":\"scatter3d\",\"mode\":\"markers\",\"marker\":{\"color\":\"rgba(255,127,14,1)\",\"line\":{\"color\":\"rgba(255,127,14,1)\"}},\"error_y\":{\"color\":\"rgba(255,127,14,1)\"},\"error_x\":{\"color\":\"rgba(255,127,14,1)\"},\"line\":{\"color\":\"rgba(255,127,14,1)\"},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\r2 dimens√µes (67% da vari√¢ncia)\ntetraedro_pc_pred \u0026lt;- tetraedro_pc %\u0026gt;% predict %\u0026gt;% as.data.frame\rplot_ly(tetraedro_pc_pred, x = ~PC2, y = ~PC3, z = ~PC3) %\u0026gt;%\radd_lines() %\u0026gt;%\radd_markers()\r\r{\"x\":{\"visdat\":{\"17bbd15d872ef\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"17bbd15d872ef\",\"attrs\":{\"17bbd15d872ef\":{\"x\":{},\"y\":{},\"z\":{},\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter3d\",\"mode\":\"lines\",\"inherit\":true},\"17bbd15d872ef.1\":{\"x\":{},\"y\":{},\"z\":{},\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter3d\",\"mode\":\"markers\",\"inherit\":true}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"scene\":{\"xaxis\":{\"title\":\"PC2\"},\"yaxis\":{\"title\":\"PC3\"},\"zaxis\":{\"title\":\"PC3\"}},\"hovermode\":\"closest\",\"showlegend\":true},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"x\":[-0.5,0,0,0.5],\"y\":[0.288675134594813,-0.577350269189626,0,0.288675134594813],\"z\":[0.288675134594813,-0.577350269189626,0,0.288675134594813],\"type\":\"scatter3d\",\"mode\":\"lines\",\"marker\":{\"color\":\"rgba(31,119,180,1)\",\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"line\":{\"color\":\"rgba(31,119,180,1)\"},\"frame\":null},{\"x\":[0,0.5,-0.5,0],\"y\":[-0.577350269189626,0.288675134594813,0.288675134594813,0],\"z\":[-0.577350269189626,0.288675134594813,0.288675134594813,0],\"type\":\"scatter3d\",\"mode\":\"markers\",\"marker\":{\"color\":\"rgba(255,127,14,1)\",\"line\":{\"color\":\"rgba(255,127,14,1)\"}},\"error_y\":{\"color\":\"rgba(255,127,14,1)\"},\"error_x\":{\"color\":\"rgba(255,127,14,1)\"},\"line\":{\"color\":\"rgba(255,127,14,1)\"},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\r\rExemplo 2 - Uma forma legal\rx \u0026lt;- c()\ry \u0026lt;- c()\rz \u0026lt;- c()\rc \u0026lt;- c()\rfor (i in 1:62) {\rr \u0026lt;- 20 * cos(i / 20)\rx \u0026lt;- c(x, r * cos(i))\ry \u0026lt;- c(y, r * sin(i))\rz \u0026lt;- c(z, i)\rc \u0026lt;- c(c, i)\r} forma_legal \u0026lt;- data.frame(x, y, z, c)\rContribui√ß√£o dos componentes na vari√¢ncia total\nforma_legal_pc \u0026lt;- prcomp(forma_legal %\u0026gt;% dplyr::select(x, y, z)) # PCA acontece aqui\rknitr::kable(summary(forma_legal_pc)$importance)\r\r\r\rPC1\rPC2\rPC3\r\r\r\rStandard deviation\r18.04936\r10.13750\r9.854732\r\rProportion of Variance\r0.61975\r0.19550\r0.184750\r\rCumulative Proportion\r0.61975\r0.81525\r1.000000\r\r\r\r3 dimens√µes (100% da vari√¢ncia)\nplot_ly(forma_legal, x = ~x, y = ~y, z = ~z, type = \u0026quot;scatter3d\u0026quot;, mode = \u0026quot;markers+lines\u0026quot;,\rline = list(width = 6, color = ~c, colorscale = \u0026#39;Viridis\u0026#39;),\rmarker = list(size = 3.5, color = ~c, colorscale = \u0026#39;Greens\u0026#39;, cmin = -20, cmax = 50))\r\r{\"x\":{\"visdat\":{\"17bbd88221e0\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"17bbd88221e0\",\"attrs\":{\"17bbd88221e0\":{\"x\":{},\"y\":{},\"z\":{},\"mode\":\"markers+lines\",\"line\":{\"width\":6,\"color\":{},\"colorscale\":\"Viridis\"},\"marker\":{\"size\":3.5,\"color\":{},\"colorscale\":\"Greens\",\"cmin\":-20,\"cmax\":50},\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter3d\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"scene\":{\"xaxis\":{\"title\":\"x\"},\"yaxis\":{\"title\":\"y\"},\"zaxis\":{\"title\":\"z\"}},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"x\":[10.7925413735561,-8.28135671463361,-19.5775189602443,-12.8122853325512,5.49687630129817,18.3457142122257,14.1639041176845,-2.6802881153443,-16.4084920835979,-14.7270908419237,0.0754603212408542,13.929254518489,14.4480736151597,2.09164786114552,-11.1171037931357,-13.3441557042244,-3.63206330959012,8.20918896120384,11.5022551374806,4.40975357962401,-5.45068443941499,-9.07156704860245,-4.35311193789132,3.07409105189557,6.25096824499247,3.46100321875046,-1.2796070534421,-3.27222737672657,-1.80286007947271,0.218226318364672,0.3804381962948,-0.487178472387319,0.021009360815016,2.18667215857674,3.22159142157506,0.581472366560048,-4.21881294997136,-6.17530689413596,-1.97412204749893,5.55088329058944,9.104703559797,4.03862056338032,-6.07691041594751,-11.768178084389,-6.59986833623095,5.75899603205442,13.9465422143715,9.44076825927779,-4.63051543849863,-15.4615274589227,-12.3205542950987,2.79329933933327,16.1908351021222,14.995118339848,-0.409036268886929,-16.0784609400788,-17.2376192473698,-2.31437851275331,15.1394230716785,18.8576340855174,5.14039515288954,-13.4584935967661],\"y\":[16.8083873038339,18.0950945433629,2.79070764975396,-14.8343366335631,-18.5822728240197,-5.33871642113288,12.3431056708568,18.2251858011977,7.42181791723828,-9.54846880433479,-17.0503234580765,-8.85705478443539,6.68976341404107,15.1531659333954,9.51616748413922,-4.01168344727705,-12.690122822732,-9.3364231727483,1.74362076713945,9.86532848199009,8.32591245581815,-0.0802983912733076,-6.91340814650946,-6.56286683518769,-0.83466933015956,4.07966984522148,4.18905447390804,0.920901656676521,-1.5993944178737,-1.3978118449505,-0.168037865209201,-0.322027913528848,-1.58227830200163,-1.36338782267305,1.52643743870318,4.50668465949168,3.54705666025684,-1.91625738885819,-7.13557154694357,-6.20152969206249,1.46273161638288,9.25404666494079,9.10556562661285,-0.208352054042127,-10.6903029918829,-12.0167990461591,-1.73672898581625,11.3301231839068,14.6922020357175,4.20399877849927,-11.1265219365316,-16.9086017476596,-6.98081126601483,10.1037122466191,18.4815216957097,9.82834011928828,-8.35506072093668,-19.2807560922275,-12.5017420868267,6.03520455550632,19.2413623571894,14.7708283285146],\"z\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62],\"mode\":\"markers+lines\",\"line\":{\"color\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62],\"width\":6,\"colorscale\":\"Viridis\"},\"marker\":{\"color\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62],\"size\":3.5,\"colorscale\":\"Greens\",\"cmin\":-20,\"cmax\":50,\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"type\":\"scatter3d\",\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\r2 dimens√µes (82% da vari√¢ncia)\nforma_legal_pc_pred \u0026lt;- forma_legal_pc %\u0026gt;% predict %\u0026gt;% as.data.frame\rplot_ly(forma_legal_pc_pred, x = ~PC1, y = ~PC2, z = 1, type = \u0026#39;scatter3d\u0026#39;, mode = \u0026#39;lines+markers\u0026#39;,\rline = list(width = 6, color = ~c, colorscale = \u0026#39;Viridis\u0026#39;),\rmarker = list(size = 3.5, color = ~c, colorscale = \u0026#39;Greens\u0026#39;, cmin = -20, cmax = 50))\r\r{\"x\":{\"visdat\":{\"17bbd4449e73\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"17bbd4449e73\",\"attrs\":{\"17bbd4449e73\":{\"x\":{},\"y\":{},\"z\":1,\"mode\":\"lines+markers\",\"line\":{\"width\":6,\"color\":{},\"colorscale\":\"Viridis\"},\"marker\":{\"size\":3.5,\"color\":{},\"colorscale\":\"Greens\",\"cmin\":-20,\"cmax\":50},\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"scatter3d\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"scene\":{\"xaxis\":{\"title\":\"PC1\"},\"yaxis\":{\"title\":\"PC2\"},\"zaxis\":{\"title\":[]}},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"x\":[-30.0560632480448,-29.7172981904782,-29.1563368355555,-27.9730568822924,-26.3469107712921,-24.8610624207884,-23.9554093581521,-23.5254806628719,-23.0360158210153,-22.0278984757301,-20.5349232683411,-19.0289013333612,-17.9657811330962,-17.3719486310612,-16.8492166019924,-15.9671326757468,-14.6549293454084,-13.2332237361277,-12.0865863818568,-11.3103986877055,-10.6590004185354,-9.81042621766366,-8.66674714200298,-7.40761642813446,-6.28074408134178,-5.36410546204099,-4.52952545725588,-3.60914394606108,-2.56597435680985,-1.49559283041171,-0.486941950267667,0.481772862457908,1.49516222313851,2.5706306228081,3.61455598120033,4.53073398149756,5.36009574744552,6.27528870368411,7.40568920186056,8.6699403503148,9.81562879421556,10.661432568735,11.308030187195,12.0818206563519,13.2304533093028,14.6564437218674,15.971221472385,16.852036213462,17.3711528961713,17.9624614717593,19.0262360212267,20.5351056440464,22.0303287913728,23.0382424925972,23.5256618227377,23.9538228230044,24.8594319363272,26.3465556884237,27.9738234711092,29.1571700377393,29.7175301732499,30.0559328837563],\"y\":[-15.2252758184645,-18.1097296683915,-3.80836728317971,14.3226900042064,19.5954326335053,7.47804908748958,-10.492565139294,-17.7688433959038,-8.15689324378827,8.89465554602008,17.6134765359535,10.612950750339,-4.83533160178189,-14.3068152312201,-9.7993369169381,3.49361581742055,12.9572408246939,10.6101152021512,-0.154131804078682,-8.84293459242217,-8.13728153377523,-0.0649539466763163,7.14037554196823,7.41499278994868,1.9739150000717,-3.1574232938763,-3.66465394689427,-0.575441734376186,2.05937999030694,2.02829084599509,0.816490578818352,0.897052915928348,2.19553926468394,2.15934847248189,-0.633323977647957,-3.82481887170373,-3.27182844132168,2.00782069653458,7.5616056851551,7.26300069589436,-0.0756326741730305,-8.26498214927999,-8.96677661438292,-0.163872455106262,10.7151907585378,13.0751998611792,3.51925791466611,-9.87991306438808,-14.4121602719605,-4.87088332916903,10.6693061675309,17.7005819238834,8.93333742401023,-8.19124390362874,-17.8334602205116,-10.5271677097949,7.49458724131268,19.6352854082219,14.3464325705234,-3.81264560895282,-18.1244351789567,-15.2320945273935],\"z\":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],\"mode\":\"lines+markers\",\"line\":{\"color\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62],\"width\":6,\"colorscale\":\"Viridis\"},\"marker\":{\"color\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62],\"size\":3.5,\"colorscale\":\"Greens\",\"cmin\":-20,\"cmax\":50,\"line\":{\"color\":\"rgba(31,119,180,1)\"}},\"type\":\"scatter3d\",\"error_y\":{\"color\":\"rgba(31,119,180,1)\"},\"error_x\":{\"color\":\"rgba(31,119,180,1)\"},\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\r\rPara saber mais\rMeu livro predileto sobre esse assunto (e para muitos outros) √© o An Introduction to Statistical Learning.\nabs\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-24-componentes-principais-intuicao/","tags":["pca","componentes principais","plotly"],"title":"Componentes Principais: Intui√ß√£o"},{"author":["Daniel"],"categories":["divulga√ß√£o"],"contents":"\rEst√° no ar o bR Bloggers! bR Bloggers √© um agregador\rde blogs sobre R escritos em l√≠ngua portuguesa.\nAtualmente uma das melhores formas de aprender R e de ficar a par da comunidade R √©\rler o R-Bloggers. O R-Bloggers √© um agregador que\rconta com mais de 700 blogs, que escrevem aproximadamente 300 posts por m√™s. Lendo\rtudo isso, n√£o tem como voc√™ n√£o aprender muito R!\nNo entanto, para muitas pessoas, uma barreira para ler os posts do R-Bloggers pode\rser o fato de que todos os posts est√£o em ingl√™s. Por isso, a cria√ß√£o do bR Bloggers.\nA ideia de um agregador de blogs para o portugu√™s n√£o √© original, hoje mesmo descobri\resse link: https://www.r-bloggers.com/lang/-/portuguese: Uma vers√£o do R-Bloggers\rem portugu√™s mantida pelo pr√≥prio criador do R-Bloggers. No entanto, a √∫ltima postagem\rdata de 2012: 5 anos atr√°s. Ainda n√£o existia nem o dplyr(que √© de Jan/2014).\rN√£o se falava em tidyverse e nem nada disso tamb√©m. Pelo menos o ggplot2 j√° tinha\rseus 5 anos. Ou seja, tudo no R era diferente, menos a melhor forma de fazer os\rseus gr√°ficos.\nRecentemente o Sillas Gonzaga autor do Paix√£o por Dados criou o\rR-Bloggers BR um bot do twitter\rque ‚Äútwita‚Äù toda vez que algum blog da lista tem um novo post. Tamb√©m temos uma lista de blogs de R em\rportugu√™s mantida pelo Marcos Vital do\rCantinho do R.\nEsses foram bons avan√ßos para a comunidade R brasileira, mas ainda assim, dado o sucesso\rdo R-Bloggers, sent√≠amos falta de um agregador no mesmo estilo para blogs em portugu√™s.\rPor isso surgiu o bR Bloggers.\nEsperamos que o bR Bloggers incentive a comunidade a escrever bastante conte√∫do\rsobre R em portugu√™s! Que ele seja uma vitrine para que todos possam mostrar os\rseus trabalhos e que ajude muitas pessoas a aprender R.\nComo funciona?\rO br Bloggers foi feito em R. E todo o c√≥digo fonte est√° dispon√≠vel em uma organiza√ß√£o\rdo Github: https://github.com/brbloggers. S√£o dois reposit√≥rios:\n\rbrbloggers: armazena o c√≥digo front-end do site. Basicamente √© um tema do Hugo.\rbrloggers-backend: armazena o c√≥digo respons√°vel por atualizar os posts.\r\rDentro do brbloggers-backend o principal arquivo √© o main.R, que cont√©m toda a\rl√≥gica para obter os novos posts e salv√°-los no seu diret√≥rio content.\nEsse script main.R √© chamado pelo script run.sh que controla o processo de atualiza√ß√£o\rdo site:\n\rfaz pull do reposit√≥rio brbloggers-backend\rroda o main.R\rfaz commits e push desse reposit√≥rio\ratualiza o repo brbloggers\r\rO run.sh √© por sua vez chamado de 30 em 30 minutos por meio de um cronjob que foi\rdefinido em um servidor na Google Cloud Platform. Esse servidor √© uma inst√¢ncia\rmicro do GCP com R instalado para rodar esses c√≥digos. Ou seja, o backend do brbloggers\rcusta U$5,00 por m√™s para ficar no ar.\nJ√° o reposit√≥rio brbloggers est√° linkado com um servi√ßo chamado Netlify.\rBasicamente o Netlify recebe o c√≥digo do front-end a cada novo commit no reposit√≥rio do site e builda\ro site est√°tico usando o Hugo. O Netlify tamb√©m hospeda o site est√°tico.\n\rO logo do bR Bloggers\rO logo do bR Bloggers foio criado pelo Julio usando\ro R. O c√≥digo est√° dispon√≠vel abaixo:\nlibrary(tidyverse)\rlibrary(ggforce)\r# https://pt.wikipedia.org/wiki/Bandeira_do_Brasil#Cores\rcores_br \u0026lt;- list(verde = \u0026#39;#009C3B\u0026#39;,\ramarelo = \u0026#39;#FFDF00\u0026#39;,\razul = \u0026#39;#002776\u0026#39;,\rbranco = \u0026quot;#FFFFFF\u0026quot;)\rp \u0026lt;- tibble(x = 1, y = 1, lab1 = \u0026#39;b\u0026#39;, lab2 = \u0026#39;R\u0026#39;) %\u0026gt;%\rggplot(aes(x0 = x, y0 = y, r = y)) +\rgeom_circle(size = 5,\rn = 5.5,\rfill = \u0026#39;transparent\u0026#39;,\rcolor = cores_br$verde,\rlinetype = 1) +\rgeom_circle(size = 4,\rn = 5.5,\rfill = \u0026#39;transparent\u0026#39;,\rcolor = cores_br$amarelo,\rlinetype = 2) +\rgeom_text(aes(x, y, label = lab1),\rfamily = \u0026quot;Ubuntu\u0026quot;,\rsize = 45,\rnudge_x = -.3,\rnudge_y = -.1,\rcolour = cores_br$azul) +\rgeom_text(aes(x, y, label = lab2),\rfamily = \u0026quot;Century\u0026quot;,\rsize = 60,\rnudge_x = .3,\rcolour = cores_br$azul,\rfontface = \u0026#39;bold\u0026#39;) +\rcoord_equal() +\rtheme_minimal(0)\rp\r\r","permalink":"https://blog.curso-r.com/posts/2017-06-19-brbloggers/","tags":["curso-R"],"title":"bR Bloggers est√° no ar"},{"author":["William"],"categories":["conceitos"],"contents":"\rSe voc√™ utiliza o R regularmente, com certeza j√° se deparou com o termo environment. Ele aparece como um painel do RStudio, quando acessamos o c√≥digo de uma fun√ß√£o e (implicitamente) quando carregamos pacotes. Neste post, vamos tentar responder as tr√™s perguntas b√°sicas sobre qualquer coisa no R: 1. o que √©? 2. para que serve? e 3. como N√ÉO usar?\nO que √©?\rDefinindo de uma maneira bem simples, environments s√£o locais onde objetos s√£o armazenados, isto √©, conjuntos de liga√ß√µes entre s√≠mbolos e valores. Por exemplo, quando fazemos a atribui√ß√£o abaixo,\na \u0026lt;- 4\restamos criando uma associa√ß√£o do s√≠mbolo a ao valor 4, que, por padr√£o, √© guardada dentro do global environment.\nls(globalenv())\r## [1] \u0026quot;a\u0026quot;\rAssim, quando rodarmos o s√≠mbolo a, o R, por padr√£o, vai procurar dentro desse environment um valor para devolver. No caso, o valor 4.\na\r## [1] 4\rMais formalmente, environments podem ser definidos como a jun√ß√£o de duas coisas: um conjunto de pares (s√≠mbolo, valor); e um ponteiro para um outro environment. Quando o R n√£o encontra um valor para um s√≠mbolo no environment em que est√° procurando, ele passa a procurar no pr√≥ximo, o environment para qual o primeiro est√° apontando, chamado de environment pai. Assim, os environments se estruturam como uma √°rvore, cuja raiz √© um environment vazio.\nemptyenv()\r## \u0026lt;environment: R_EmptyEnv\u0026gt;\r\rO que faz?\r√â poss√≠vel criar novos environments com a fun√ß√£o new.env()\nmagrathea \u0026lt;- new.env()\re criar objetos dentro desse environments com a fun√ß√£o assign()\nassign(\u0026quot;a\u0026quot;, 8, envir = magrathea)\rls(magrathea)\r## [1] \u0026quot;a\u0026quot;\rAgora temos um objeto chamado a no global environment e no magrathea, que n√≥s criamos. Note que o R inicia a busca no global environment.\na\r## [1] 4\rVamos agora criar outro objeto dentro de magrathea.\nassign(\u0026quot;b\u0026quot;, 15, envir = magrathea)\rObserve que se procurarmos simplesmente por b, o R n√£o vai encontrar um valor para associar.\nb\rAcontece que magrathea √© um environment ‚Äúabaixo‚Äù do global na hierarquia, e o R s√≥ estende a sua busca para environments acima (sim, estou pensando numa √°rvore de ponta-cabe√ßa).\nparent.env(magrathea)\r## \u0026lt;environment: R_GlobalEnv\u0026gt;\rSe criarmos agora um objeto no global\nc \u0026lt;- 16\re usarmos a fun√ß√£o get() para procur√°-lo no environment que criamos, o R ir√° encontr√°-lo porque o global √© o environment pai de magrathea.\nget(\u0026quot;c\u0026quot;, envir = magrathea)\r## [1] 16\rEssa estrutura √© muito √∫til na hora de utilizar fun√ß√µes. Sempre que uma fun√ß√£o √© chamada, um novo environment √© criado, o environment de avalia√ß√£o, que cont√©m os objetos usados como argumento da fun√ß√£o, os objetos criados dentro da fun√ß√£o e aponta para o environment onde a fun√ß√£o foi criada (geralmente o global).\nf \u0026lt;- function(a, b) {\rc \u0026lt;- a + b\rreturn(c)\r}\renvironment(f)\r## \u0026lt;environment: R_GlobalEnv\u0026gt;\rEsse comportamento nos permite fazer duas coisas. Primeiro, os c√°lculos realizados dentro das fun√ß√µes n√£o modificam os objetos do global.\nf(23, 42)\r## [1] 65\rc\r## [1] 16\rSegundo, podemos utilizar objetos dentro da fun√ß√£o sem defini-los l√° dentro.\nf \u0026lt;- function(b) {\rreturn(a + b)\r}\rf(108)\r## [1] 112\rNeste caso, como o R n√£o encontrou o s√≠mbolo a dentro do environment de avalia√ß√£o, ele foi buscar no pai, o global.\n\rComo n√£o usar?\rAgora que temos uma vis√£o ao menos superficial da estrutura de environments, podemos entender melhor porque usar a fun√ß√£o attach() √© uma pr√°tica n√£o recomendada ao programar em R.\nSe utilizarmos a fun√ß√£o search(), ela nos devolver√° o ‚Äúcaminho‚Äù de environments, come√ßando do global (magrathea n√£o ser√° exibido).\nsearch()\r## [1] \u0026quot;.GlobalEnv\u0026quot; \u0026quot;package:stats\u0026quot; \u0026quot;package:graphics\u0026quot; ## [4] \u0026quot;package:grDevices\u0026quot; \u0026quot;package:utils\u0026quot; \u0026quot;package:datasets\u0026quot; ## [7] \u0026quot;package:methods\u0026quot; \u0026quot;Autoloads\u0026quot; \u0026quot;package:base\u0026quot;\rRepare que os pacotes carregados geram um novo environment na √°rvore.\nlibrary(ggplot2)\rsearch()\r## [1] \u0026quot;.GlobalEnv\u0026quot; \u0026quot;package:ggplot2\u0026quot; \u0026quot;package:stats\u0026quot; ## [4] \u0026quot;package:graphics\u0026quot; \u0026quot;package:grDevices\u0026quot; \u0026quot;package:utils\u0026quot; ## [7] \u0026quot;package:datasets\u0026quot; \u0026quot;package:methods\u0026quot; \u0026quot;Autoloads\u0026quot; ## [10] \u0026quot;package:base\u0026quot;\r√â por isso que, ao carregar um pacote, podemos utilizar as suas fun√ß√µes sem a necessidade de escrever coisas do tipo ggplot2::geom_point(). Agora, veja o que acontece quando usamos a fun√ß√£o attach()\nmighty \u0026lt;- list(\u0026quot;Jason\u0026quot; = \u0026quot;vermelho\u0026quot;, \u0026quot;Zach\u0026quot; = \u0026quot;Preto\u0026quot;, \u0026quot;Billy\u0026quot; = \u0026quot;Azul\u0026quot;,\r\u0026quot;Trini\u0026quot; = \u0026quot;Amarela\u0026quot;, \u0026quot;Kimberly\u0026quot; = \u0026quot;Rosa\u0026quot;, \u0026quot;Thomas\u0026quot; = \u0026quot;Verde\u0026quot;)\rattach(mighty)\rsearch()\r## [1] \u0026quot;.GlobalEnv\u0026quot; \u0026quot;mighty\u0026quot; \u0026quot;package:ggplot2\u0026quot; ## [4] \u0026quot;package:stats\u0026quot; \u0026quot;package:graphics\u0026quot; \u0026quot;package:grDevices\u0026quot;\r## [7] \u0026quot;package:utils\u0026quot; \u0026quot;package:datasets\u0026quot; \u0026quot;package:methods\u0026quot; ## [10] \u0026quot;Autoloads\u0026quot; \u0026quot;package:base\u0026quot;\rUm novo environment mighty √© criado acima do global! Isso quer dizer que se voc√™ n√£o tiver total conhecimento dos objetos que est√£o sendo anexados, voc√™ estar√° criando uma lista de objetos ‚Äúinvis√≠veis‚Äù que podem ser avaliados mesmo dentro de fun√ß√µes. E veja o que acontece quando carregamos mais pacotes\nlibrary(dplyr)\r## ## Attaching package: \u0026#39;dplyr\u0026#39;\r## The following objects are masked from \u0026#39;package:stats\u0026#39;:\r## ## filter, lag\r## The following objects are masked from \u0026#39;package:base\u0026#39;:\r## ## intersect, setdiff, setequal, union\rsearch()\r## [1] \u0026quot;.GlobalEnv\u0026quot; \u0026quot;package:dplyr\u0026quot; \u0026quot;mighty\u0026quot; ## [4] \u0026quot;package:ggplot2\u0026quot; \u0026quot;package:stats\u0026quot; \u0026quot;package:graphics\u0026quot; ## [7] \u0026quot;package:grDevices\u0026quot; \u0026quot;package:utils\u0026quot; \u0026quot;package:datasets\u0026quot; ## [10] \u0026quot;package:methods\u0026quot; \u0026quot;Autoloads\u0026quot; \u0026quot;package:base\u0026quot;\rO environment do pacote dplyr aparece antes do mighty. Isso quer dizer que os objetos do mighty podem ser mascarados por todos os pacotes que voc√™ carregar a seguir. Veja um simples exemplo de como as coisas podem dar errado.\ndados \u0026lt;- tibble::tibble(paciente = 1:30,\rcancer = rbinom(30, size = 1, prob = 0.5))\rattach(dados)\rcancer\r## [1] 1 0 0 1 0 0 1 1 1 0 0 1 1 0 1 1 1 0 1 0 0 0 1 0 1 1 0 1 0 1\rCom o c√≥digo acima, criamos um banco de dados representando 30 pacientes com (1) ou sem (0) um certo tipo de c√¢ncer. As vari√°veis paciente e cancer foram anexadas ao rodarmos attach(dados).\nAgora, imagine se esse banco de dados tiver informa√ß√µes de tempo at√© a remiss√£o do c√¢ncer e quisermos rodar modelos de sobreviv√™ncia. Um passo natural seria carregar a biblioteca survival.\nlibrary(survival)\r## ## Attaching package: \u0026#39;survival\u0026#39;\r## The following object is masked from \u0026#39;dados\u0026#39;:\r## ## cancer\rsearch()\r## [1] \u0026quot;.GlobalEnv\u0026quot; \u0026quot;package:survival\u0026quot; \u0026quot;dados\u0026quot; ## [4] \u0026quot;package:dplyr\u0026quot; \u0026quot;mighty\u0026quot; \u0026quot;package:ggplot2\u0026quot; ## [7] \u0026quot;package:stats\u0026quot; \u0026quot;package:graphics\u0026quot; \u0026quot;package:grDevices\u0026quot;\r## [10] \u0026quot;package:utils\u0026quot; \u0026quot;package:datasets\u0026quot; \u0026quot;package:methods\u0026quot; ## [13] \u0026quot;Autoloads\u0026quot; \u0026quot;package:base\u0026quot;\rO pacote survival tamb√©m tem um objeto chamado cancer. Assim, ao carreg√°-lo, o environment survival ficar√° na frente do environment dados na √°rvore e, se n√£o prestarmos aten√ß√£o com o warning, esse ser√° o nosso novo objeto cancer.\nhead(cancer)\r## inst time status age sex ph.ecog ph.karno pat.karno meal.cal wt.loss\r## 1 3 306 2 74 1 1 90 100 1175 NA\r## 2 3 455 2 68 1 0 90 90 1225 15\r## 3 3 1010 1 56 1 0 90 90 NA 15\r## 4 5 210 2 57 1 1 90 60 1150 11\r## 5 1 883 2 60 1 0 100 90 NA 0\r## 6 12 1022 1 74 1 1 50 80 513 0\rAssim, se for utilizar a fun√ß√£o attach() √© preciso ter muito cuidado com o que se est√° fazendo. E a melhor dica √© n√£o use.\nEsse post foi apenas uma introdu√ß√£o sobre como os environments funcionam. Ainda existe muito mais coisa por tr√°s, como o conceito de namespaces. Se voc√™ quiser saber mais, recomendo como primeira parada esse post, do qual tirei boa parte das informa√ß√µes passadas aqui. Tamb√©m vale a pena dar uma olhada nas defini√ß√µes nesse link.\nSugest√µes, d√∫vidas e cr√≠ticas, deixe um coment√°rio!\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-19-environments/","tags":["environments"],"title":"Environments"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rEntre os dias 25 e 27 de maio aconteceu a ROpenSci Unconf 2017. O encontro reuniu v√°rios pop stars da comunidade R como Hadley Wickham, Joe Cheng (criador do shiny), Jeroen Ooms (criador do OpenCPU e autor de v√°rios pacotes bacanas), Jenny Bryan (autora de v√°rios pacotes bacanas como googlesheets), v√°rias pessoas do #R-Ladies e muito mais.\nUma coisa muito legal dessa confer√™ncia √© que ela funcionou como uma hackathon. Foi criada uma nova organiza√ß√£o no github chamada ROpenSci Labs, e os presentes simplesmente come√ßaram a subir pacotes fant√°sticos l√° dentro. Recomendo muito dar uma olhada.\nDentre os pacotes que olhei, o que mais me chamou aten√ß√£o foi o skimr e por isso estou fazendo esse post! O prop√≥sito do skimr √© simples: fazer algumas estat√≠sticas b√°sicas univariadas de uma base de dados.\nO skimr ainda n√£o est√° no CRAN, ent√£o para instalar recomendamos utilizar o devtools para instalar direto do GitHub, conforme c√≥digo abaixo. Note que tamb√©m ser√° necess√°rio instalar o pacote colformat do Hadley.\ndevtools::install_github(\u0026quot;hadley/colformat\u0026quot;)\rdevtools::install_github(\u0026quot;ropenscilabs/skimr\u0026quot;)\rA fun√ß√£o skim() calcula estat√≠sticas b√°sicas das vari√°veis e imprime no seu console. Note que a fun√ß√£o separa estat√≠sticas para vari√°veis num√©ricas ou fatores.\nlibrary(tidyverse)\rlibrary(skimr)\rskim(iris)\rE tem mais! O mais legal do skimr √© que ele usa a fun√ß√£o colformat::spark_bar() para desenhar histogramas direto no seu console!\nskim(iris) %\u0026gt;% filter(stat == \u0026#39;hist\u0026#39;) %\u0026gt;% knitr::kable(caption = \u0026#39;HISTOGRAMA NA TABELA PORQUE SIM!\u0026#39;)\rO skimr tamb√©m possui padr√µes de estat√≠sticas b√°sicas para cada tipo de vari√°vel. Voc√™ pode checar esses tipos com show_skimmers():\nshow_skimmers() %\u0026gt;% map_df(enframe, .id = \u0026#39;tipo\u0026#39;) %\u0026gt;% group_by(tipo) %\u0026gt;% summarise(stats = glue::collapse(value, sep = \u0026#39;, \u0026#39;)) %\u0026gt;% knitr::kable(caption = \u0026#39;Estat√≠sticas b√°sicas para cada tipo de vari√°vel.\u0026#39;)\rCriando suas pr√≥prias fun√ß√µes\rVoc√™ tamb√©m pode usar fun√ß√µes pr√≥prias com o skimr. Por exemplo, digamos que voc√™ queira calcular o coeficiente de varia√ß√£o. Primeiro, adicione sua fun√ß√£o dentro de uma lista:\nfuns \u0026lt;- list(cv = function(x) sd(x, na.rm = TRUE) / mean(x, na.rm = TRUE))\re depois aplique a fun√ß√£o skim_with():\n# append adiciona as suas funcoes nas existentes\rskim_with(numeric = funs, append = TRUE)\rE pronto! Agora voc√™ pode rodar skim() novamente:\nskim(iris) %\u0026gt;% filter(stat %in% c(\u0026#39;hist\u0026#39;, \u0026#39;cv\u0026#39;)) %\u0026gt;% knitr::kable(caption = \u0026#39;Histograma e coeficiente de varia√ß√£o.\u0026#39;)\rPara retornar ao skim() padr√£o, rode skim_with_defaults().\n\rWrap up\r\rInstale usando devtools::install_github()\rRode a fun√ß√£o skim(). Use dplyr::filter() para filtrar as estat√≠sticas de interesse.\rVoc√™ pode adicionar suas pr√≥prias estat√≠sticas com skim_with().\rAcompanhe a evolu√ß√£o do skimr nesta p√°gina.\r\rO pacote ainda vai evoluir muito e n√£o duvido nada que seja um bom candidado a entrar no tidyverse. O que voc√™s acham? Escrevam nos coment√°rios!\n√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-17-skimr/","tags":["pacotes","skimr"],"title":"Skimr: estat√≠sticas b√°sicas com ‚ù§Ô∏è"},{"author":["Athos"],"categories":["Tutoriais"],"contents":"\r\rCompilei um passo a passo mais simplificado dos posts que usei pra conseguir usar o Keras num servidor Ubuntu.\nEsse tutorial ensinar√° como instalar o Anaconda com Python 3.5 em um servidor Ubuntu 16.04 + Keras para R. Ent√£o ao final desse post voc√™ ter√° o Keras direto do seu R pronto para abalar os profundos mares da aprendizagem de m√°quinas.\nPr√©-requisitos\rO tutorial sup√µe que voc√™ possui um servidor Ubuntu 16.04 com R 3.4.0 ou vers√£o superior instalado.\n\rInstalando Anaconda com Python 3.5\rO Keras s√≥ funciona com o Python 2.7 ou 3.5, por isso temos que instalar o Anaconda 4.2.0 que √© a vers√£o que vem com o Python 3.5.\nPasso 1) Primeiro, sugiro que v√° ao diret√≥rio /tmp para baixar o arquivo bash do Anaconda.\ncd /tmp\rPasso 2) Agora fa√ßa o download do bash do Anaconda 4.2.0.\ncurl -O https://repo.continuum.io/archive/Anaconda3-4.2.0-Linux-x86_64.sh\rPasso 3) Execute o bash.\nbash Anaconda3-4.2.0-Linux-x86_64.sh\rPasso 4) Voc√™ ver√° a seguinte sa√≠da. Aperta ENTER para continuar.\nWelcome to Anaconda3 4.2.0 (by Continuum Analytics, Inc.)\rIn order to continue the installation process, please review the license\ragreement.\rPlease, press ENTER to continue\rPasso 5) Da√≠ vai apertando mais ENTER para ir at√© o final dos termos de uso. Quando chegar l√° embaixo, vai perguntar se vc aceita o termos.\nDo you approve the license terms? [yes|no]\rPasso 6) Escreva yes para aceitar os termos. Deve aparecer um prompt como o mostrado abaixo: hora de escolha o local de instala√ß√£o. Solte um ENTER caso goste do local padr√£o oferecido.\nAnaconda3 will now be installed into this location:\r/home/athos/anaconda3\r- Press ENTER to confirm the location\r- Press CTRL-C to abort the installation\r- Or specify a different location below\r[/home/athos/anaconda3] \u0026gt;\u0026gt;\u0026gt; \rPasso 7) Da√≠ a pergunta seguinte √© para saber se voc√™ gostaria de fazer o comando conda funcionar quando for chamado no terminal. Pode aceitar.\n...\rinstallation finished.\rDo you wish the installer to prepend the Anaconda3 install location\rto PATH in your /home/athos/.bashrc ? [yes|no]\r[no] \u0026gt;\u0026gt;\u0026gt; \rNeste momento voc√™ ter√° o Anaconda 4.2.0 pronto para rodar.\nAgora, ao R!\n\rinstala√ß√£o do Keras no R\rPasso 8) Essa parte √© f√°cil. Rode os c√≥digos abaixo para para instalar o pacote Keras e o Tensorflow.\ndevtools::install_github(\u0026quot;rstudio/keras\u0026quot;) # instalar o pacote do Keras para R\rkeras::install_tensorflow() # instalar o Tensorflow\rPronto! Agora √© s√≥ ser impressionante e destruir no DeepLearning. No github do Keras tem a documenta√ß√£o completa pra voc√™ aprender mais sobre como us√°-lo.\nAquele ax√©.\n\r","permalink":"https://blog.curso-r.com/posts/2017-06-08-keras-no-ubuntu/","tags":["deep learning","tensorflow","keras"],"title":"Instalando Anaconda + TensorFlow + Keras para R no Ubuntu 16.04 Server"},{"author":["Julio"],"categories":["divulga√ß√£o"],"contents":"\rEsse √© o Daniel Falbel, um dos s√≥cios da Curso-R e autor de diversos posts no nosso blog. Boa pinta, n√£o?\nMas esse n√£o √© s√≥ um rostinho bonito. Recente, o Dani fez uma contribui√ß√£o PROFUNDA para a comunidade R: ele √© um dos respons√°veis pelo pacote keras, que faz uma interface com a biblioteca de mesmo nome utilizada para ajustar modelos de deep learning usando TensorFlow.\nVeja o arquivo DESCRIPTION (metadados) desse pacote:\nPackage: keras\rType: Package\rTitle: R Interface to Keras\rVersion: 0.3.6\rAuthors@R: c(\rperson(\u0026quot;JJ\u0026quot;, \u0026quot;Allaire\u0026quot;, role = c(\u0026quot;aut\u0026quot;, \u0026quot;cre\u0026quot;), email = \u0026quot;jj@rstudio.com\u0026quot;),\rperson(\u0026quot;Fran√ßois\u0026quot;, \u0026quot;Chollet\u0026quot;, role = c(\u0026quot;aut\u0026quot;, \u0026quot;cph\u0026quot;)),\rperson(\u0026quot;RStudio\u0026quot;, role = c(\u0026quot;cph\u0026quot;, \u0026quot;fnd\u0026quot;)),\rperson(family = \u0026quot;Google\u0026quot;, role = c(\u0026quot;ctb\u0026quot;, \u0026quot;cph\u0026quot;, \u0026quot;fnd\u0026quot;)),\rperson(\u0026quot;Yuan\u0026quot;, \u0026quot;Tang\u0026quot;, role = c(\u0026quot;ctb\u0026quot;, \u0026quot;cph\u0026quot;)),\rperson(\u0026quot;Daniel\u0026quot;, \u0026quot;Falbel\u0026quot;, role = c(\u0026quot;ctb\u0026quot;, \u0026quot;cph\u0026quot;))\r)\rDescription: Interface to \u0026#39;Keras\u0026#39;, a high-level neural networks API which\rruns on top of TensorFlow. \u0026#39;Keras\u0026#39; was developed with a focus on enabling\rfast experimentation, supports both convolutional networks and recurrent\rnetworks (as well as combinations of the two), and seamlessly on both CPUs\rand GPUs.\r...\rAl√©m do Daniel, temos como autores desse pacote nada menos que JJ Allaire (CEO do RStudio), Yuan Tang (um dos principais desenvolvedores do TensorFlow) e Fran√ßois Chollet, o pr√≥prio RStudio e a Google (essa n√£o precisa de link).\nMuito orgulho de ter esse cara como amigo e s√≥cio na Curso-R. Parab√©ns!\nNo futuro, postaremos tutoriais sobre o keras e mostraremos como estamos utilizando o pacote para quebrar CAPTCHAs usando m√©todos bastante inovadores. Enquanto isso, voc√™ pode olhar um tutorial para o pacote keras nesse link.\n√â isso. Happy coding ;)\n","permalink":"https://blog.curso-r.com/posts/2017-06-05-keras/","tags":["deep learning","keras"],"title":"Keras: colocando deep learning no pipeline"},{"author":["William"],"categories":["Tutoriais"],"contents":"\rJ√° vimos como o Rstudio se torna uma ferramenta poderosa quando combinado com certos pacotes, como o knitr e shiny, ou outros recursos, como o markdown e o git. Hoje, veremos como transformar o Rstudio num elegante e interativo editor de imagens utilizando o pacote magick.\nEste post √© um breve resumo das funcionalidades do magick. Para uma apresenta√ß√£o completa, visite o vignette do pacote.\nJ√° usamos o magick em outros posts do blog (√†s vezes por tr√°s das cortinas) para tratar imagens. Esse pacote √© um wrapper da biblioteca ImageMagick, provavelmente a biblioteca open-source para processamento de imagens mais amig√°vel dispon√≠vel hoje em dia.\nInstala√ß√£o\rNo Windows ou OS-X, instale via CRAN:\ninstall.packages(\u0026quot;magick\u0026quot;)\rNo Linux, consulte o vignette do Magick para mais informa√ß√µes.\n\rLendo e escrevendo imagens\rPara come√ßar a usar as fun√ß√µes do magick, carregue o pacote.\nlibrary(magick)\r## Linking to ImageMagick 6.9.12.3\r## Enabled features: cairo, fontconfig, freetype, heic, lcms, pango, raw, rsvg, webp\r## Disabled features: fftw, ghostscript, x11\rlibrary(magrittr)\rVamos utilizar a seguinte imagem como exemplo neste post:\nA fun√ß√£o image_read() l√™ imagens de arquivos, como .jpg ou png. Diversas outras extens√µes s√£o suportadas. Utilize str(magick::magick_config()) para verificar quais formatos est√£o dispon√≠veis na sua vers√£o do ImageMagick.\n## format width height colorspace matte filesize density\r## 1 JPEG 2745 1780 sRGB FALSE 662239 300x300\rA fun√ß√£o image_write() exporta imagens em qualquer um dos formatos suportados.\nimage_write(freddie, path = \u0026quot;freddie_png.png\u0026quot;, format = \u0026quot;png\u0026quot;)\rDica: no Rstudio, pasta rodar o objeto freddie para visualizar a imagem no painel Viewer.\n\rConvertendo\rAo ler uma imagem com o magick, ela √© guardada em mem√≥ria em seu formato original. Para converter essa imagem, utilizamos a fun√ß√£o image_convert().\nfreddie_png \u0026lt;- image_convert(freddie, \u0026quot;png\u0026quot;)\rimage_info(freddie_png)\r## format width height colorspace matte filesize density\r## 1 PNG 2745 1780 sRGB FALSE 0 300x300\rNeste ponto voc√™ j√° deve ter reparado que as (principais) fun√ß√µes do pacote magick utilizam o prefixo image_.\n\rCortando e editando\rA maioria das transforma√ß√µes que voc√™ pode fazer com as imagens utilizar√° um par√¢metro geometry. Esse par√¢metro requer uma sintaxe especial, da forma AXB+C+D, sendo que cada elemento (A, B, C e D) √© opcional. Veja alguns exemplos:\n\rimage_crop(image, \"100x150+50+20\"): recorta uma regi√£o de tamanho 100px x 150px, come√ßando +50px da esquerda para a direita e +20px de cima para baixo;\rimage_scale(image, \"200\"): redimensiona proporcionalmente ao comprimento: 200px;\rimage_scale(image, \"x200\"): redimensiona proporcionalmente √† altura: 200px;\rimage_border(frink, \"red\", \"20x10\"): adiciona uma borda de 20px (esquerda/direita) e 10px (cima/baixo)\r\rPara mais detalhes sobre essa sintaxe, consulte este link.\nVamos testar essas fun√ß√µes na nossa imagem!\nCome√ßaremos a redimensionando para facilitar o uso e a visualiza√ß√£o de algumas fun√ß√µes.\nfreddie_resized \u0026lt;- image_scale(freddie, \u0026quot;500\u0026quot;)\rimage_info(freddie_resized)\r## format width height colorspace matte filesize density\r## 1 JPEG 500 324 sRGB FALSE 0 300x300\rAgora, vamos recortar um peda√ßo.\nimage_crop(freddie_resized, \u0026quot;100x150+280+30\u0026quot;)\rColocar uma borda.\nimage_border(freddie_resized, \u0026quot;purple\u0026quot;, \u0026quot;20x10\u0026quot;)\rGir√°-la de ponta-cabe√ßa.\nimage_flip(freddie_resized)\rE inverter a dire√ß√£o.\nimage_flop(freddie_resized)\rCom o pipe, fica f√°cil aplicar todas as fun√ß√µes ao mesmo tempo.\nfreddie_resized %\u0026gt;%\rimage_crop(\u0026quot;100x150+280+30\u0026quot;) %\u0026gt;%\rimage_border(\u0026quot;purple\u0026quot;, \u0026quot;20x10\u0026quot;) %\u0026gt;%\rimage_flip %\u0026gt;%\rimage_flop\r\rFiltros e efeitos\rAgora vamos aplicar alguns filtros e efeitos.\nimage_blur(freddie_resized, 10, 5)\rimage_noise(freddie_resized)\rimage_annotate(freddie_resized, \u0026quot;Farrokh Bulsara\u0026quot;, size = 30, color = \u0026quot;red\u0026quot;,\rboxcolor = \u0026quot;white\u0026quot;, degrees = 9, location = \u0026quot;+60+30\u0026quot;)\r\rO que mais d√° para fazer?\rRealmente recomendamos uma leitura do Vignette do magick para ter uma boa ideia de tudo o que ele permite fazer. Al√©m de v√°rias outras ferramentas de edi√ß√£o para imagens est√°ticas, ainda √© poss√≠vel mexer com GIFs e anima√ß√µes! Ou fazer coisas como:\nlibrary(ggplot2)\rlibrary(grid)\rqplot(speed, dist, data = cars, geom = c(\u0026quot;point\u0026quot;, \u0026quot;smooth\u0026quot;))\rgrid.raster(freddie_cropped, width = 0.15, height = 0.3,\rhjust = -2, vjust = 1)\r## `geom_smooth()` using method = \u0026#39;loess\u0026#39; and formula \u0026#39;y ~ x\u0026#39;\r\r","permalink":"https://blog.curso-r.com/posts/2017-06-01-a-kind-of-magick/","tags":["imagens","pacotes","magick"],"title":"A kind of magick"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rJ√° precisou extrair dados de arquivos pdf? Bom, eu j√°. Eu trabalho com jurimetria e preciso extrair dados de di√°rios oficiais, peti√ß√µes, senten√ßas, ent√£o j√° viu n√©‚Ä¶\nA primeira pergunta que voc√™ precisa fazer antes de ler um pdf √©: o arquivo √© digital ou digitalizado?\n\rSe for digital, significa que ele pode ser transcrito diretamente para v√°rios formatos: texto, html, xml e at√© mesmo data.frames diretamente.\r\rVamos usar esse exemplo de PDF digital\nSe estiver no desktop, √© poss√≠vel ver o documento abaixo:\n\r\rSe for digitalizado, voc√™ precisar√° passar um algoritmo de OCR (Optical Character Recognition) para extrair os dados. Provavelmente seu output nesse caso ser√° sempre texto.\r\rVamos usar esse exemplo de PDF digitalizado\nSe estiver no desktop, √© poss√≠vel ver o documento abaixo:\n\rObs: √© poss√≠vel que seu arquivo seja digitalizado, mas j√° com uma OCR passada no pr√≥prio arquivo. Nesse caso, voc√™ pode tratar o documento como digital.\nOs cr√©ditos dos pacotes abaixo v√£o todos para o Jeroen Ooms, um dos maiores autores de pacotes da comunidade R nos √∫ltimos dez anos. Sou f√£ desse cara!\nPacote pdftools para PDFs digitais\rPara instalar o pdftools no Windows e no Mac, basta rodar\ninstall.packages(\u0026quot;pdftools\u0026quot;)\rPara instalar no Linux, siga as instru√ß√µes desse link.\nPDF para texto\rlibrary(tidyverse)\rlibrary(stringr)\rlibrary(pdftools)\rpdf \u0026lt;- \u0026#39;../../static/data/ocr/pdf_digital.pdf\u0026#39;\rtxt \u0026lt;- pdf_text(pdf)\r# imprimindo s√≥ os 500 primeiros caracteres da primeira p√°gina\rcat(str_trunc(txt[1], 500))\r## TJ/SP - Comarca de S√£o Paulo\r## Movimento Judici√°rio\r## ## Refer√™ncia: Janeiro de 2011\r## Foro: ADAMANTINA\r## Unidade: 02 CUMULATIVA\r## Planilha: CIVEL\r## ## ## Dados da Unidade\r## 1. Total de feitos em andamento 2756\r## 2. Precat√≥rias 6\r## 3. Processos\r## 3.1 Processos c√≠veis 2078\r## 3.1.1 De Conhecimento 1111\r## 3.1.2 De...\r\rPDF para HTML ou XML\rMuitas vezes queremos pegar estruturas no texto que dependem da posi√ß√£o dos elementos. Por exemplo, o texto em um PDF pode estar dividido em v√°rias colunas. Para isso, o ideal seria transformar o arquivo em dados semi-estruturados como HTML ou XML, que separam os elementos do conte√∫do do PDF em tags.\nInfelizmente, o pdftools ainda n√£o transforma em HTML nem XML. Para soltar um HTML, vamos montar uma fun√ß√£o que chama pdftohtml do poppler por command line.\npdf_html \u0026lt;- function(pdf) {\rinfos \u0026lt;- pdf_info(pdf) # pega infos do pdf\rhtml \u0026lt;- tempfile(fileext = \u0026#39;.html\u0026#39;) # cria arquivo tempor√°rio\r# monta comando a ser executado.\r# n√£o sei se funciona em Windows ;)\rcommand \u0026lt;- sprintf(\u0026#39;pdftohtml -f 1 -l %s -q -i -s -noframes %s %s\u0026#39;,\rinfos$pages,\rnormalizePath(pdf),\rhtml)\rsystem(command) # roda comando e salva\rtxt \u0026lt;- readr::read_file(html) # l√™ arquivo salvo\rfile.remove(html) # remove arquivo tempor√°rio\rtxt\r}\rVoc√™ pode brincar com o HTML usando o pacote rvest:\nlibrary(rvest)\rhtml \u0026lt;- pdf_html(pdf)\rhtml %\u0026gt;%\rread_html() %\u0026gt;%\rhtml_nodes(\u0026#39;div\u0026#39;) %\u0026gt;%\rhead()\r## {xml_nodeset (6)}\r## [1] \u0026lt;div id=\u0026quot;page1-div\u0026quot; style=\u0026quot;position:relative;width:1263px;height:892px;\u0026quot;\u0026gt; ...\r## [2] \u0026lt;div id=\u0026quot;page2-div\u0026quot; style=\u0026quot;position:relative;width:1263px;height:892px;\u0026quot;\u0026gt; ...\r## [3] \u0026lt;div id=\u0026quot;page3-div\u0026quot; style=\u0026quot;position:relative;width:1263px;height:892px;\u0026quot;\u0026gt; ...\r## [4] \u0026lt;div id=\u0026quot;page4-div\u0026quot; style=\u0026quot;position:relative;width:1263px;height:892px;\u0026quot;\u0026gt; ...\r## [5] \u0026lt;div id=\u0026quot;page5-div\u0026quot; style=\u0026quot;position:relative;width:1263px;height:892px;\u0026quot;\u0026gt; ...\r## [6] \u0026lt;div id=\u0026quot;page6-div\u0026quot; style=\u0026quot;position:relative;width:1263px;height:892px;\u0026quot;\u0026gt; ...\r\rPDF para tabelas\rUse o tabulizer! Apesar de depender do odiado rJava (que √© um pacote chato de instalar e configurar) o tabulizer √© capaz de extrair os dados diretamente para tabelas, de forma simples e intuitiva.\nPara instalar o tabulizer, siga as instru√ß√µes dessa p√°gina. J√° adianto que pode n√£o ser uma tarefa f√°cil, principalmente por conta do rJava.\nExemplo: Uma vez montei esse c√≥digo para estruturar um pdf contendo gastos em obras p√∫blicas. Al√©m de usar o tabulizer, usei os pacotes usuais do tidyverse e a fun√ß√£o abjutils::rm_accent() para tirar os acentos do texto.\nlibrary(tabulizer)\rVamos usar esse pdf de exemplo.\nSe estiver no desktop, √© poss√≠vel ver o documento abaixo:\n\r# No meu pc demorou 40 segundos.\rtab \u0026lt;- extract_tables(\u0026#39;../../static/data/ocr/pdf_compras.pdf\u0026#39;)\rEssa fun√ß√£o serve para arrumar os nomes zoados que v√™m no arquivo:\narrumar_nomes \u0026lt;- function(x) {\rx %\u0026gt;%\rtolower() %\u0026gt;%\rstr_trim() %\u0026gt;%\rstr_replace_all(\u0026#39;[[:space:]]+\u0026#39;, \u0026#39;_\u0026#39;) %\u0026gt;%\rstr_replace_all(\u0026#39;%\u0026#39;, \u0026#39;p\u0026#39;) %\u0026gt;%\rstr_replace_all(\u0026#39;r\\\\$\u0026#39;, \u0026#39;\u0026#39;) %\u0026gt;%\rabjutils::rm_accent()\r}\rAgora veja a magia do tidyverse posta em pr√°tica:\ntab_tidy \u0026lt;- tab %\u0026gt;%\r# transforma matrizes em tibbles\rmap(as_tibble) %\u0026gt;%\r# empilha\rbind_rows() %\u0026gt;%\r# arruma nomes a partir da primeira linha\rset_names(arrumar_nomes(.[1,])) %\u0026gt;%\r# tira primeira linha\rslice(-1) %\u0026gt;%\r# tira espa√ßos extras\rmutate_all(funs(str_replace_all(., \u0026#39;[[:space:]]+\u0026#39;, \u0026#39; \u0026#39;))) %\u0026gt;%\r# tira espa√ßos nas bordas\rmutate_all(str_trim)\rA Tabela 1 mostra as primeiras cinco linhas do resultado.\n\rTabela 1: Base arrumada a partir de arquivo pdf, usando o pacote tabulizer.\r\r\r\ruf\rmunicipios_atendidos\rtipo\rsubtipo\rnome_do_empreendimento\rp_de_execucao\rtotal_pac__milhoes\rorgao\r\r\r\rBA\rILH√âUS/BA\rAeroporto\rTerminal de Passageiros\rAeroporto de Ilh√©us - PROJETO DE INFRAESTRUTURA E IMPLANTA√á√ÉO DO MOP\rMenor que 50%\r2,1\rEmpresa Brasileira de Infraestrutura Aeroportu√°ria\r\rPR\rLONDRINA/PR\rAeroporto\rTerminal de Passageiros\rAeroporto de Londrina - IMPLANTA√á√ÉO DO M√ìDULO OPERACIONAL - MOP NO PROCESSAMENTO DE EMBARQUE\rMaior que 50%\r4,0\rEmpresa Brasileira de Infraestrutura Aeroportu√°ria\r\rPA\rMARAB√Å/PA\rAeroporto\rTerminal de Passageiros\rAeroporto de Marab√° - REFORMA COM AMPLIA√á√ÉO DO TPS EXISTENTE\rMaior que 50%\r7,1\rEmpresa Brasileira de Infraestrutura Aeroportu√°ria\r\rCE\rACOPIARA/CE\rCentro de Artes e Esportes Unificados\rModelo 3000m¬≤\rPra√ßas - Acopiara - CE - Modelo 3000m¬≤\rMenor que 50%\r2,0\rMinist√©rio da Cultura\r\rSP\rAMERICANA/SP\rCentro de Artes e Esportes Unificados\rModelo 3000m¬≤\rPra√ßas - Americana - SP - Modelo 3000m¬≤\rMenor que 50%\r2,4\rMinist√©rio da Cultura\r\r\r\r\r\rPacote tesseract para PDFs digitalizados\rO tesseract √© uma biblioteca escrita em C e √© uma das mais famosas ferramentas abertas para extra√ß√£o de textos a partir de imagens. O pacote em R de mesmo nome serve para usar essa biblioteca pelo R sem causar dores de cabe√ßa.\nPara instalar o tesseract no Windows, basta rodar\ninstall.packages(\u0026#39;tesseract\u0026#39;)\rPara Mac e Linux, siga as instru√ß√µes dessa p√°gina.\nA principal fun√ß√£o do pacote tesseract √© a ocr(). Seu input √© o caminho de uma imagem (pdf, jpeg, tiff, entre outras) e seu output √© um texto. Logo, nosso primeiro passo √© transformar o pdf em imagem.\npdf \u0026lt;- \u0026#39;../../static/data/ocr/pdf_digitalizado.pdf\u0026#39;\rimg \u0026lt;- pdf_render_page(\rpdf = pdf, # caminho do arquivo\rpage = 1, # √≠ndice da p√°gina\rdpi = 300 # resolu√ß√£o (pontos por polegada)\r)\r# salvando imagem num arquivo png\rpng::writePNG(img, \u0026#39;../../static/data/ocr/pdf_digitalizado_img.png\u0026#39;)\rSe o PDF tiver mais p√°ginas, voc√™ pode fazer um loop para salvar v√°rias imagens. Agora, usamos a fun√ß√£o ocr() no arquivo salvo.\nlibrary(tesseract)\rtxt \u0026lt;- ocr(\u0026#39;../../static/data/ocr/pdf_digitalizado_img.png\u0026#39;)\r# imprimindo s√≥ os 300 primeiros caracteres do resultado\rcat(str_trunc(txt, 300))\r## This is a sample document to test the PDF Image+Text OCR Engine.\r## This is a sample document to test the PDF Image+Text OCR Engine.\r## This is a sample document to test the PDF Image+Text OCR Engine.\r## This is a sample document to test the PDF Image+Text OCR Engine.\r## This is a sample document to test the...\r\rWrap-up\r\rSe seu pdf for digital, use pdftools::pdf_text().\rSe seu pdf for digitalizado, use pdftools::pdf_render_page(), depois png::writePNG() e por fim tesseract::ocr().\r\r√â isso. Happy coding ;)\n\r","permalink":"https://blog.curso-r.com/posts/2017-05-27-ocr/","tags":["pdf","pacotes","ocr"],"title":"PDF e OCR"},{"author":["Fernando"],"categories":["an√°lises"],"contents":"\rQuando eu trabalhei no N√∫cleo de Estudos da Viol√™ncia da USP, obter informa√ß√µes da Secretaria de Seguran√ßa P√∫blica de S√£o Paulo (SSP) era uma tarefa meio esot√©rica. Colet√°vamos os dados de todos os DP‚Äôs de S√£o Paulo, que s√£o aproximadamente 100, e, como fazer isso manualmente era demorado, aplic√°vamos uma solu√ß√£o autom√°tica em dois passos. Primeiro rasp√°vamos o site da SSP em Pythone depois rod√°vamos uma macro em VBA chamada ‚ÄúMestre Dos Magos‚Äù, que era respons√°vel por consolidar as s√©ries hist√≥ricas em excel. Eu achava o procedimento um pouco herm√©tico porque nenhum deles tinha sido feito por mim ou pela minha equipe, era uma heran√ßa que a gente n√£o sabia como consertar se desse algum problema. Para dar um exemplo, no final da minha breve estadia no NEV o script n√£o funcionava mais, ent√£o era necess√°rio baixar tudo manualmente.\nDepois dessa √©poca eu nunca mais mexi com esses dados. Eu sempre tive vontade de implementar uma solu√ß√£o em R, mas sempre faltou motiva√ß√£o. Felizmente, na ultima semana minha namorada precisou dos dados da SSP para um trabalho que est√° fazendo, s√≥ que dessa vez o interesse era em todos os 645 munic√≠pios do estado de S√£o Paulo nos anos entre 2013 a 2016. Como n√£o h√° como baixar todas essas informa√ß√µes de uma vez e downloads individuais tomam muito tempo, eu me senti motivado o suficiente para atacar o problema.Pra ser sincero, foi bem mais f√°cil do que eu achei que seria. A constru√ß√£o do programa foi t√£o simples que cabe at√© mesmo neste post de blog, mas n√£o √© s√≥ por isso que ela est√° aqui. Esse √© um exemplo minimal de todas as fases de constru√ß√£o de um scraper.Os quatro passos para construir um scraper\rEm um esquema aproximado, eu acredito que raspar (ou scrappear) um site pode ser feito em 4 passos:\nDefina a p√°gina que voc√™ quer raspar;\rIdentifique exatamente as requisi√ß√µes que produzem o que voc√™ quer;\rConstrua um programa que imite as requisi√ß√µes que voc√™ faria manualmente;\rRepita o passo 3. quantas vezes quiser.\r\rMesmo que existam scrapers mais complicados, √© verdade que seguir esses passos pelo menos te ajuda a chegar mais perto do que voc√™ realmente precisar√° fazer depois.\n\rDefina o que voc√™ quer\rTanto o NEV quanto a minha namorada tinham interesse nas tabelas que apareciam numa URL espec√≠fica do site: http://www.ssp.sp.gov.br/Estatistica/Pesquisa.aspx. A l√≥gica por tr√°s da divulga√ß√£o dessas informa√ß√µes √© a seguinte: voc√™ escolhe um ano, uma localidade geogr√°fica/administrativa e um tipo de informa√ß√£o e ele te devolve uma tabela. Os anos dispon√≠veis s√£o os anos de 2001 a 2017, as localidades s√£o os cruzamentos entre Munic√≠pios, Regi√µes e Delegacias (notando que voc√™ sempre pode escolher ‚ÄúTodos‚Äù) e os tipos de informa√ß√£o s√£o taxas de delito, ocorr√™ncias registradas por ano, ocorr√™ncias registradas por m√™s e produtividade policial. Nesta aplica√ß√£o vamos procurar contagens de ocorr√™ncias registradas por m√™s.\n\rIdentifique o que o site faz por tr√°s\rIdentificar o que o site faz por tr√°s provavelmente √© a fase mais complicada da constru√ß√£o de um scraper. A dificuldade √© que n√£o existe um algoritmo que fa√ßa isso pra voc√™. Normalmente eu sigo alguns passos, mas eles exigem uma dose de insight para funcionar, o que implica que talvez n√£o seja poss√≠vel seguir todos os passos em sequ√™ncia.\nEntre na p√°gina imediatamente anterior √† p√°gina que voc√™ quer acessar.\rAbra as ferramentas de desenvolvedor dos seu navegador (isso normalmente √© equivalente √† ‚Äúaperte F12‚Äù).\rSelecione a aba ‚ÄúNetwork‚Äù (ou ‚ÄúRede‚Äù) na caixa de ferramentas do desenvolvedor.\rV√° para a p√°gina que voc√™ quer.\rNa lista de requisi√ß√µes que o site fez ao servidor, identifique aquela(s) que √©(s√£o) relevante(s) a sua pesquisa.\r\rParece muito louco n√©? No geral, √© muito louco sim, mas quando voc√™ d√° sorte √© f√°cil. Vou mostrar o que acontece no nosso exemplo:\nA p√°gina imediatamente anterior\rEu quero a url http://www.ssp.sp.gov.br/Estatistica/Pesquisa.aspx com alguma sele√ß√£o, ent√£o pra realizar o primeiro passo basta entrar em http://www.ssp.sp.gov.br/Estatistica/Pesquisa.aspx.\n\rFerramentas do desenvolvedor e aba ‚ÄúNetwork‚Äù\rEm qualquer navegador, as ferramentas do desenvolvedor mostram o background do que aparece na tela. Se estiver nessa aba, quando voc√™ entrar em http://www.ssp.sp.gov.br/Estatistica/Pesquisa.aspx e apertar F5, vai encontrar uma tela mais ou menos parecida com a tela abaixo:\nCada linha representa uma requisi√ß√£o, que √© essencialmente o envio de um arquivo .html ao servidor. O conte√∫do que visualizamos na tela √© o resultado de todas essas requisi√ß√µes e, se destrincharmos cada uma delas, podemos identificar aquelas que s√£o relevantes para o nosso problema.\n\rA requisi√ß√£o\rO pr√≥ximo passo √© identificar o que √© que o navegador pede ao servidor quando te devolve o que voc√™ quer. Se voc√™ escolher o ano de 2017 na caixa de sele√ß√£o de anos, por exemplo, vai encontrar uma tela parecida com essa aqui.\nAntes de prosseguir, √© necess√°rio fazer uma inspe√ß√£o meticulosa de todas as requisi√ß√µes que aparecem, mas vou encurtar a discuss√£o afirmando que a primeira delas √© a mais importante. Existem muitas maneiras de deduzir que ela √© uma boa candidata, como por exemplo olhando que ela √© a √∫nica requisi√ß√£o relevante que recebe html, mas vou pular essa parte.\nSegundo o nosso dedo duro, a requisi√ß√£o utiliza o m√©todo ‚ÄúPOST‚Äù e, quando clicamos nela, temos informa√ß√µes sobre ela no painel ao lado. Como eu falei acima, uma requisi√ß√£o √© um arquivo .html que ‚Äúpede‚Äù alguma ao servidor com base no seu conte√∫do. No geral, um bom lugar para procurar o que a requisi√ß√£o est√° pedindo √© o seu conjunto de par√¢metros, na aba ‚ÄúParams‚Äù do painel de detalhamento da requisi√ß√£o.\nQuando inspecionamos essa requisi√ß√£o ‚ÄúPOST‚Äù, identificamos que as coisas que s√£o relevantes para o conte√∫do da p√°gina est√£o nesses par√¢metros. De fato, pensando ingenuamente, clicar apenas em ‚Äú2017‚Äù deve mexer nos par√¢metros que tem a ver com isso mas deve deixar os demais par√¢metros fixos. Por sorte, os par√¢metros observados batem com essa expectativa: ‚Äú__EVENTTARGET‚Äù √© ctl00$conteudo$$ddlAnos √© um placeholder que tem a ver com a caixa de sele√ß√£o em que mexemos, os dois pr√≥ximos par√¢metros est√£o zerados, ‚Äú__VIEWSTATE‚Äù e ‚Äú__EVENTVALIDATION‚Äù s√£o par√¢metros da sess√£o, e, por fim, temos os par√¢metros da consulta, que est√£o todos zerados com exce√ß√£o de ctl00$conteudo$$ddlAnos.\nParece que os par√¢metros tem tudo a ver com a sa√≠da. Ser√° que mexer apenas neles basta para copiar a requisi√ß√£o do navegador?\n\r\rCrie um rob√¥ que imita o que um humano faria\rAgora que sabemos um pouco mais sobre como as requisi√ß√µes funcionam, vamos tentar fazer o POST mais simples de todos: ele s√≥ tem os par√¢metros da √∫ltima imagem. Em R, o jeito mais f√°cil de fazer requisi√ß√µes √© usando o pacote httr. Ele √© bem intuitivo e flex√≠vel, de tal forma que fazer um POST √© feito simplesmente chamando a fun√ß√£o httr::POST:\nurl \u0026lt;- \u0026#39;http://www.ssp.sp.gov.br/Estatistica/Pesquisa.aspx\u0026#39;\r#c√≥digo para dar um POST vazio no site\rhttr::POST(url)\r#o resultado √© simplesmente o resultado original da p√°gina\rPara colocar par√¢metros num POST, basta usar o par√¢metro body. Antes de complicar, vamos tentar o conjunto de par√¢metros mais simples de todos: vamos ignorar tudo que a gente n√£o sabe exatamente o que √© e preencher s√≥ o que sabemos:\nparams \u0026lt;- list(`__EVENTTARGET` = \u0026quot;ctl00$conteudo$$ddlAnos\u0026quot;,\r`__EVENTARGUMENT` = \u0026quot;\u0026quot;,\r`__LASTFOCUS` = \u0026quot;\u0026quot;,\r`__VIEWSTATE` = \u0026quot;\u0026quot;,\r`__EVENTVALIDATION` = \u0026quot;\u0026quot;,\r`ctl00$conteudo$ddlAnos` = \u0026quot;2015\u0026quot;,\r`ctl00$conteudo$ddlRegioes` = \u0026quot;0\u0026quot;,\r`ctl00$conteudo$ddlMunicipios` = \u0026quot;0\u0026quot;,\r`ctl00$conteudo$ddlDelegacias` = \u0026quot;0\u0026quot;)\rAgora vamos fazer a requisi√ß√£o. O passo seguinte √© apenas pra traduzir o resultado pra um formato mais f√°cil de mexer.\nresposta \u0026lt;- httr::POST(url,\rbody = params,\rencode = \u0026#39;form\u0026#39;) %\u0026gt;%\rxml2::read_html()\r# traduz o resultado\rComo vamos saber se deu certo? Existem v√°rios jeitos, mas, por simplicidade, aqui vamos apenas checar se alguma tabela contida em resposta √© igual √† tabela que extra√≠mos manualmente do site. Vamos fazer isso usando a fun√ß√£o rvest::html_table().\nresposta %\u0026gt;%\rrvest::html_table()\r# extrai todas as tabelas de um c√≥digo em html.\rComo se v√™ acima, nada que se parece com uma tabela na resposta da nossa requisi√ß√£o √© a tabelinha que identificamos no site. Muita coisa pode ter dado errado, mas vamos come√ßar pelo que √© mais evidente: n√≥s ignoramos os par√¢metros __VIEWSTATE e __EVENTVALIDATION. Em √∫ltima inst√¢ncia, nos vamos precisar entender o que esses par√¢metros significam, mas primeiro vamos tentar simplesmente obter uma c√≥pia desses valores diretamente do site. Dando um ctrl+f no painel de ferramentas de desenvolvedor identificamos que o valores dessa vari√°veis sai de umas tags input nomeadas de acordo com o par√¢metro que representam.\nview_state \u0026lt;- httr::POST(url) %\u0026gt;%\rxml2::read_html() %\u0026gt;%\rrvest::html_nodes(\u0026quot;input[name=\u0026#39;__VIEWSTATE\u0026#39;]\u0026quot;) %\u0026gt;%\rrvest::html_attr(\u0026quot;value\u0026quot;)\revent_validation \u0026lt;- httr::POST(url) %\u0026gt;%\rxml2::read_html() %\u0026gt;%\rrvest::html_nodes(\u0026quot;input[name=\u0026#39;__EVENTVALIDATION\u0026#39;]\u0026quot;) %\u0026gt;%\rrvest::html_attr(\u0026quot;value\u0026quot;)\rCom os nossos embustes em m√£os, basta pular para a pr√≥xima etapa: tentar simular um clique no site. Nosso novo conjunto de par√¢metros fica:\nparams \u0026lt;- list(`__EVENTTARGET` = \u0026quot;ctl00$conteudo$$ddlAnos\u0026quot;,\r`__EVENTARGUMENT` = \u0026quot;\u0026quot;,\r`__LASTFOCUS` = \u0026quot;\u0026quot;,\r`__VIEWSTATE` = view_state,\r`__EVENTVALIDATION` = event_validation,\r`ctl00$conteudo$ddlAnos` = \u0026quot;2015\u0026quot;,\r`ctl00$conteudo$ddlRegioes` = \u0026quot;0\u0026quot;,\r`ctl00$conteudo$ddlMunicipios` = \u0026quot;0\u0026quot;,\r`ctl00$conteudo$ddlDelegacias` = \u0026quot;0\u0026quot;)\rE o c√≥digo da requisi√ß√£o fica:\nresposta \u0026lt;- httr::POST(url,\rbody = params,\rencode = \u0026#39;form\u0026#39;) %\u0026gt;%\rxml2::read_html() %\u0026gt;%\rrvest::html_table()\rExatamente a tabelinha que quer√≠amos! Entretanto, nem tudo s√£o flores. Como eu mencionei ali em cima, tanto a minha namorada quanto o NEV tinham interesse no n√∫mero de BO‚Äôs, que n√£o √© o que obtivemos fazendo a requisi√ß√£o via R. Fu√ßando um pouco, √© f√°cil ver que o que obtivemos s√£o os n√∫meros de produtividade policial. Ser√° que √© f√°cil mexer nos par√¢metros pra obter os n√∫meros de BO‚Äôs?\nFelizmente, a resposta √© sim, mas n√£o √© t√£o simples quanto parece. Se de outra tela qualquer voc√™ clicar em ‚ÄúOcorr√™ncias Registradas por M√™s‚Äù voc√™ vai perceber que o ‚Äú__EVENTTARGET‚Äù mudou para ctl00$conteudo$$btnMes, mas, a despeito do que se poderia imaginar, os outros par√¢metros permaneceram com os nomes intactos.\nComo essa requisi√ß√£o sugere, voc√™ consegue variar os tipos de informa√ß√£o simplesmente variando o ‚Äú__EVENTTARGET‚Äù. Com isso, uma requisi√ß√£o para obter as ‚ÄúOcorr√™ncias Registradas por M√™s‚Äù ficaria:\nparams \u0026lt;- list(`__EVENTTARGET` = \u0026quot;ctl00$conteudo$$ddlAnos\u0026quot;,\r`__EVENTARGUMENT` = \u0026quot;\u0026quot;,\r`__LASTFOCUS` = \u0026quot;\u0026quot;,\r`__VIEWSTATE` = view_state,\r`__EVENTVALIDATION` = event_validation,\r`ctl00$conteudo$ddlAnos` = \u0026quot;2015\u0026quot;,\r`ctl00$conteudo$ddlRegioes` = \u0026quot;0\u0026quot;,\r`ctl00$conteudo$ddlMunicipios` = \u0026quot;0\u0026quot;,\r`ctl00$conteudo$ddlDelegacias` = \u0026quot;0\u0026quot;)\rresposta \u0026lt;- httr::POST(url,\rbody = params,\rencode = \u0026#39;form\u0026#39;) %\u0026gt;%\rxml2::read_html()\r√â importante notar que cada vez que vamos um POST desse, √© como se estivessemos entrando na p√°gina novamente, de tal forma que as informa√ß√µes que a p√°gina tem quando damos v√°rios cliques seguidos s√£o diferentes das informa√ß√µes de quando acessamos a p√°gina pelo R. Por exemplo, quando estamos navegando pela p√°gina pelos links, o ‚Äú__EVENTTARGET‚Äù volta para ctl00$conteudo$$ddlAnos se voc√™ trocar de p√°gina saindo de uma p√°gina de ‚ÄúOcorr√™ncias Registradas por M√™s‚Äù, mas o tipo de informa√ß√£o v√™m corretamente. Isso acontece porque, se voc√™ acessar v√°rias p√°ginas em sequ√™ncia, a p√°gina sabe de onde voc√™ veio.\n\rRepita quantas vezes quiser\rAgora vem a repeti√ß√£o, o passo final da raspagem. Antes de qualquer coisa precisamos de duas pequenas generaliza√ß√µes: queremos baixar v√°rios anos e v√°rios munic√≠pios. Isso √© f√°cil de fazer pois os √≠ndices dos munic√≠pios s√£o as suas posi√ß√µes em ordem alfab√©tica. Dessa forma, √© poss√≠vel fazer uma fun√ß√£o que baixa as ‚ÄúOcorr√™ncias Registradas por M√™s‚Äù de um munic√≠pio em um determinado ano:\nbaixa_bo_municipio_ano \u0026lt;- function(ano, municipio){\rpivot \u0026lt;- httr::GET(url)\r#serve apenas para pegarmos um view_state e um event_validation valido\rview_state \u0026lt;- pivot %\u0026gt;%\rxml2::read_html() %\u0026gt;%\rrvest::html_nodes(\u0026quot;input[name=\u0026#39;__VIEWSTATE\u0026#39;]\u0026quot;) %\u0026gt;%\rrvest::html_attr(\u0026quot;value\u0026quot;)\revent_validation \u0026lt;- pivot %\u0026gt;%\rxml2::read_html() %\u0026gt;%\rrvest::html_nodes(\u0026quot;input[name=\u0026#39;__EVENTVALIDATION\u0026#39;]\u0026quot;) %\u0026gt;%\rrvest::html_attr(\u0026quot;value\u0026quot;)\rparams \u0026lt;- list(`__EVENTTARGET` = \u0026quot;ctl00$conteudo$$btnMes\u0026quot;,\r`__EVENTARGUMENT` = \u0026quot;\u0026quot;,\r`__LASTFOCUS` = \u0026quot;\u0026quot;,\r`__VIEWSTATE` = view_state,\r`__EVENTVALIDATION` = event_validation,\r`ctl00$conteudo$ddlAnos` = \u0026quot;2015\u0026quot;,\r`ctl00$conteudo$ddlRegioes` = \u0026quot;0\u0026quot;,\r`ctl00$conteudo$ddlMunicipios` = municipio,\r`ctl00$conteudo$ddlDelegacias` = \u0026quot;0\u0026quot;)\rhttr::POST(url, body = params, encode = \u0026#39;form\u0026#39;) %\u0026gt;%\rxml2::read_html() %\u0026gt;%\rrvest::html_table() %\u0026gt;%\rdplyr::first() %\u0026gt;%\r#\u0026#39; serve pra pegar apenas a primeira tabela da p√°gina,\r#\u0026#39; se houver mais do que uma. Estou assumindo que a\r#\u0026#39; tabela que eu quero √© sempre a primeira.\rdplyr::mutate(municipio = municipio,\rano = ano)\r}\rPra ilustar um grande loop, vamos baixar os BO‚Äôs de todos os munic√≠pios, no ano de 2016. A fun√ß√£o demora um pouco pra rodar, ent√£o quem quiser ver como fica o resultado final pode clicar neste link.\nGRID \u0026lt;- expand.grid(municipio = 1:645, ano = \u0026#39;2016\u0026#39;, stringsAsFactors = F)\rD \u0026lt;- purrr::by_row(GRID, baixa_bo_municipio_ano, .to = \u0026quot;ocorrencias\u0026quot;) %\u0026gt;%\rtidyr::unnest(ocorrencias)\r\rResultados\rCom esses dados d√° pra fazer muitas coisas legais. √â poss√≠vel, por exemplo, fazer mapas como esse, que representa o n√∫mero de homic√≠dios em 2016, por munic√≠pio. Ele foi feito em R, mas como faz√™-lo √© assunto pra outro post!\n\r","permalink":"https://blog.curso-r.com/posts/2017-05-19-scrapper-ssp/","tags":["web scraping","dados abertos"],"title":"Web scraping do site da Secretaria de Seguran√ßa P√∫blica de S√£o Paulo"},{"author":["Fernando"],"categories":["Tutoriais"],"contents":"\r\rDe todas as visualiza√ß√µes, mapas s√£o aquelas que impressionam mais. √â muito mais f√°cil algu√©m se maravilhar com o mapa mais simples do que com o ggplot2 mais complicado. Felizmente, considerando essa compara√ß√£o, o R disponibiliza muitos recursos para construir mapas.\nDentro do tidyverse √© poss√≠vel construir mapas usando a fun√ß√£o geom_map, do pacote ggplot2, mas est√° fora do escopo deste post explicar como ela funciona. Aqui vamos apenas descobrir como us√°-la para agilizar a constru√ß√£o de um gr√°fico simples.\nNa Associa√ß√£o Brasileira de Jurimetria, n√≥s temos um tipo favorito de mapa. Tipicamente temos interesse em diferenciar as unidades da federa√ß√£o por alguma vari√°vel quantitativa, seja ela categorizada ou n√£o, e a ferramenta certa para isso √© um mapa tem√°tico dos estados. Essa necessidade √© t√£o frequente que as ferramentas mais importantes para constru√ß√£o desses gr√°ficos est√£o num pacote chamado abjData.\nAs coisas est√£o dispostas de tal forma que, a partir de uma tabela que relaciona uma variavel e os estados brasileiros, construir um gr√°fico similar ao mapa abaixo pode ser feito chamando apenas uma fun√ß√£o1.\ndataset %\u0026gt;% constroi_mapa_tematico()\rNeste post, vamos construir a fun√ß√£o constroi_mapa_tematico e aprender a implementar alguns tweaks.\nA fun√ß√£o\rO geom_map √© uma fun√ß√£o do ggplot2 que renderiza coordenadas de mapas. Ela pega um data_frame especial que diz quais coordenadas usar (e como us√°-las) e plota no gr√°fico. Esse mapa normalmente √© obtido aplicando a fun√ß√£o fortify em um conjunto de dados geospaciais.\nPara os gr√°ficos que vamos construir aqui, n√£o vai ser necess√°rio aplicar a fun√ß√£o fortify, pois o resultado desse passo j√° est√° dispon√≠vel no pacote abjData e ele √© o data_frame br_uf_map. Tudo que vamos precisar fazer √© pedir que o geom_map use esse cara.\ndevtools::install_github(\u0026#39;abjur/abjData\u0026#39;)\r#instala o pacote\rconstroi_mapa_tematico \u0026lt;- function(dataset){\rdataset %\u0026gt;% inner_join(abjData::br_uf_map) %\u0026gt;% {\rggplot(.) +\rgeom_map(aes(x = long, y = lat,\rmap_id = id, fill = variavel),\rcolor = \u0026#39;gray30\u0026#39;, map = ., data = .) + theme_void() +\rcoord_equal()\r}\r}\rO input da fun√ß√£o √© uma tabela dataset com duas colunas\n\rid, que representa as unidades da federa√ß√£o abreviada;\rvariavel, vari√°vel num√©rica (ou fator) que vai colorir o gr√°fico.\r\rNo exemplo acima essa tabela era:\ndataset %\u0026gt;% head(10)\r\rOs tweaks\rA fun√ß√£o constroi_mapa_tematico devolve um ggplot2, ent√£o ainda d√° pra mexer em alguns par√¢metros est√©ticos ap√≥s a constru√ß√£o do mapa. As tr√™s coisas que vamos aprender a fazer s√£o\nAdicionar labels e t√≠tulos\r\rdataset %\u0026gt;% constroi_mapa_tematico() +\rggtitle(\u0026quot;Roubos de carros no Brasil em 2014\u0026quot;) +\rscale_fill_continuous(name = \u0026quot;Taxa/100 mil hab.\u0026quot;)\rAlterar as cores da escala\r\rdataset %\u0026gt;% constroi_mapa_tematico() +\rggtitle(\u0026quot;Roubos de carros no Brasil em 2014\u0026quot;) +\rscale_fill_continuous(name = \u0026quot;Taxa/100 mil hab.\u0026quot;, low = \u0026#39;white\u0026#39;, high = \u0026#39;red\u0026#39;,\rna.value = \u0026#39;white\u0026#39;)\rAlterar valores\r\rdataset %\u0026gt;% constroi_mapa_tematico() +\rggtitle(\u0026quot;Roubos de carros no Brasil em 2014\u0026quot;) +\rscale_fill_continuous(name = \u0026quot;Taxa/100 mil hab.\u0026quot;, low = \u0026#39;green\u0026#39;, high = \u0026#39;red\u0026#39;,\rna.value = \u0026#39;white\u0026#39;, breaks = seq(0,300,50))\r\r\rOs dados foram levantados pelo F√≥rum Brasileiro de Seguran√ßa P√∫blica e obtidos via download no seu site http://www.forumseguranca.org.br/estatisticas/introducao/.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-05-04-mapas-tematicos-3-minutos/","tags":["mapas","gr√°ficos","ggplot2"],"title":"Gr√°ficos miojo: Mapas tem√°ticos do Brasil em 3 minutos ou menos"},{"author":["William"],"categories":["an√°lises"],"contents":"\rA cor √© uma diferen√ßa not√°vel entre os filmes da Marvel e da DC. Enquanto a Disney/Marvel Studios costuma lan√ßar filmes com tons mais claros e alegres, a Warner tem optado por cen√°rios escuros, com um aspecto mais sombrios. Essas escolhas s√£o um reflexo do clima das hist√≥rias de cada universo: aventuras engra√ßaralhas com um drama superficial vs seja l√° o que passa na cabe√ßa do Zack Snyder.\nPara estudar melhor a paleta de cores utilizadas nos filmes, vamos aplicar a an√°lise introduzida pelo Dani neste post, com pequenas altera√ß√µes. Como amostra, selecionei 10 imagens de Batman vs Superman e 10 do Capit√£o Am√©rica: guerra civil. Tentando deixar a an√°lise o menos subjetiva poss√≠vel, escolhi imagens de cenas emblem√°ticas e dos principais personagens. Abaixo as imagens que peguei de cada filme.\nSeguindo a an√°lise do Dani, vamos utilizar as seguintes bibliotecas para a an√°lise.\nlibrary(jpeg)\rlibrary(tidyverse)\rlibrary(glue)\rEu salvei as imagens em arquivos do tipo ‚Äúbvs_n.jpg‚Äù e ‚Äúcw_n.jpg‚Äù, com n variando de 1 a 10. Isso facilitou a leitura desses arquivos. O c√≥digo abaixo mostra como criar um vetor com o caminho das 10 imagens de cada filme. Se voc√™ quiser saber mais sobre a fun√ß√£o glue(), visite este post.\narquivos_bvs \u0026lt;- glue(\u0026quot;images/bvs_{n}.jpg\u0026quot;, n = 1:10)\rarquivos_cw \u0026lt;- glue(\u0026quot;images/cw_{n}.jpg\u0026quot;, n = 1:10)\rComo vamos trabalhar com mais de uma imagem, eu criei a fun√ß√£o ler_imagem() para ler os arquivos.\nler_imagem \u0026lt;- function(caminho) {\rimg \u0026lt;- readJPEG(caminho) %\u0026gt;%\rapply(3, as.numeric)\r}\rPodemos ent√£o usar a fun√ß√£o map() para aplic√°-la a todos os 10 arquivos. A fun√ß√£o reduce(rbind) transforma as 10 matrizes de pixels em uma matriz s√≥, como se as imagens estivessem coladas uma embaixo da outra.\nimg_bvs \u0026lt;- map(arquivos_bvs, ler_imagem) %\u0026gt;% reduce(rbind)\rimg_cw \u0026lt;- map(arquivos_cw, ler_imagem) %\u0026gt;% reduce(rbind)\rAbaixo est√£o as fun√ß√µes cria_paleta() e exibir() do post do Dani. A √∫nica diferen√ßa aqui √© que a fun√ß√£o cria_paleta() j√° recebe a matriz representando a imagem.\ncriar_paleta \u0026lt;- function(img_matrix, num_cores){\rkm \u0026lt;- kmeans(img_matrix, centers = num_cores)\rimg_df \u0026lt;- tibble(\rr = img_matrix[,1],\rg = img_matrix[,2],\rb = img_matrix[,3],\rcluster = km$cluster\r)\rcentroides \u0026lt;- img_df %\u0026gt;%\rgroup_by(cluster) %\u0026gt;%\rsummarise_all(mean)\rcentroides \u0026lt;- centroides %\u0026gt;%\rmutate(cor = rgb(r, g, b))\rsort(centroides$cor)\r}\rexibir \u0026lt;- function(x) {\rn \u0026lt;- length(x)\rold \u0026lt;- par(mar = c(0.5, 0.5, 0.5, 0.5))\ron.exit(par(old))\rimage(1:n, 1, as.matrix(1:n), col = x,\rylab = \u0026quot;\u0026quot;, xaxt = \u0026quot;n\u0026quot;, yaxt = \u0026quot;n\u0026quot;, bty = \u0026quot;n\u0026quot;)\r}\r\rAssim, basta aplicar essas fun√ß√µes aos objetos img_bvs e img_cw para obter as paletas. Primeiro para o Batman vs Superman:\npaleta_bvs \u0026lt;- criar_paleta(img_bvs, 10)\rexibir(paleta_bvs)\rE agora para o Capit√£o Am√©rica:\npaleta_cw \u0026lt;- criar_paleta(img_cw, 10)\rexibir(paleta_cw)\rObserve que o filme da DC tem cores mais escuras e fortes, com v√°rios tons de azul, indicando as cenas noturnas e de chuva. J√° a paleta da Marvel apresenta cores mais claras, com v√°rios tons representando o c√©u p√°lido das cenas externas.\nPodemos fazer a an√°lise agora para o p√¥ster de cada filme (o que aparece no IMDB):\nimg_bvs \u0026lt;- ler_imagem(\u0026quot;images/bvs_poster.jpg\u0026quot;)\rpaleta_bvs \u0026lt;- criar_paleta(img_bvs, 10)\rexibir(paleta_bvs)\rimg_cw \u0026lt;- ler_imagem(\u0026quot;images/cw_poster.jpg\u0026quot;)\rpaleta_cw \u0026lt;- criar_paleta(img_cw, 10)\rexibir(paleta_cw)\rVeja que os diferentes tons de azul se repete no p√¥ster do Batman vs Superman. J√° o p√¥ster do Capit√£o Am√©rica √© bem cinzento, com metade da paleta representando tons de cinza.\nFica ent√£o o desafio de repetir a an√°lise para outros filmes e compartilhar o resultado com a gente. Coment√°rios? Sugest√µes? Cr√≠ticas? Mande a sua opini√£o!\n","permalink":"https://blog.curso-r.com/posts/2017-05-01-as-paletas-de-cores-da-marvel-vs-dc/","tags":["imagens","cinema","kmeans"],"title":"As cores da Marvel vs DC"},{"author":["Fernando"],"categories":["tutoriais"],"contents":"\r\rDiagramas de Venn s√£o como slides de PowerPoint. Se eles tem poucos elementos concisos em uma ordem inteligente, um leitor consegue conectar as ideias expostas e aprender alguma coisa. Em caso contr√°rio, o excesso de informa√ß√£o se transforma em um obst√°culo para a comunica√ß√£o.\nBons diagramas de Venn s√£o capazes de te fazer perceber cruzamentos que n√£o est√£o no seu radar. No blog do Andrew Gelman tem um exemplo interessante. Ele considera uma ora√ß√£o, em ingl√™s, que pede:\n\rGod give me the serenity to accept things which cannot be changed;\rGive me courage to change things which must be changed;\rAnd the wisdom to distinguish one from the other.\n\rPelo jeito em que ela foi escrita, parece que s√≥ existem dois tipos de coisas: aquelas que n√£o podem ser modificadas e aquelas que n√≥s devemos mudar. Entretanto, esse n√£o √© o caso:\n\rSe uma coisa pode ser modificada e eu n√£o devo mud√°-la, ela n√£o √© importante.\rSe uma coisa coisa n√£o pode ser modificada e eu devo mud√°-la, eu preciso aceit√°-la.\r\rConsiderando esse diagrama, O Gelman at√© sugere uma prece mais cuidadosa:\n\rLord, grant me the serenity to accept things that cannot be changed,\rcourage to change things that must be changed;\rdiscernment to ignore things that don‚Äôt need changing;\racceptance that some things I need to change, i can‚Äôt;\rAnd the wisdom to understand Venn Diagrams.\n\rA despeito da utilidade de Diagramas de Venn bem feitos, o R oferece poucas maneiras de constru√≠-los. No CRAN, existem apenas tr√™s pacotes especializados em construir esses gr√°ficos, mas duas delas s√£o um pouco insatisfat√≥rias. Neste post, vamos descobrir como fazer diagramas de Venn usando o pacote VennDiagram.\nO Dataset\rPara n√£o nos distrairmos com bases de dados complicadas, vamos usar uma tabela artifical inspirada nesse link. Cada linha dessa base representa as prefer√™ncias por animais de estima√ß√£o de uma pessoa hipot√©tica. No total temos 34 pessoas na base e as op√ß√µes poss√≠veis s√£o ‚ÄúC√£es‚Äù,‚ÄúGatos‚Äù,‚ÄúLagartos‚Äù e ‚ÄúSerpentes‚Äù.\nO data.frame est√° dispon√≠vel no c√≥digo fonte desse post.\n\rPacotes\rCodificar os gr√°ficos no pacote VennDiagram √© um pouco chato, por isso vamos precisar de outros pacotes pra ajudar. No geral, apenas as coisas do tidyverse j√° v√£o servir.\nO comando abaixo chama os pacotes que vamos usar neste post.\nlibrary(VennDiagram)\rlibrary(tidyverse)\r\rDiagramas de Venn usando o pacote VennDiagram\rComo eu j√° disse antes, esse pacote √© bem chato, pois em todos os gr√°ficos voc√™ precisa escrever diretamente o n√∫mero de elementos em cada peda√ßo dos conjuntos e os par√¢metros gr√°ficos detalhados demais. Pra funcionar bem, voc√™ tem que dizer exatamente o que quer fazer.\nVamos come√ßar fazendo um diagrama simples. Ele vai representar o conjunto de pessoas que gostam de cachorros.\nnumero_de_pessoas_que_gostam_de_cachorros \u0026lt;- dataset %\u0026gt;% dplyr::filter(Dog == 1) %\u0026gt;% nrow()\rgrid.newpage()\rinvisible(draw.single.venn(numero_de_pessoas_que_gostam_de_cachorros,\r#N√∫mero de elementos do conjunto\rcategory = \u0026quot;Pessoas que gostam de cachorros\u0026quot;,\r#Nome do conjunto\rlty = \u0026quot;blank\u0026quot;,\r#Grossura da borda dos conjuntos.\u0026quot;blank\u0026quot; quer dizer que n√£o vai ter borda\rfill = \u0026quot;light blue\u0026quot;,\r#Cor do conjunto\ralpha = 0.5\r#Transpar√™ncia do conjunto. Varia de 0 a 1\r))\rComplicando um pouco mais, dessa vez vamos fazer um diagrama que represente as pessoas que gostam de gatos ou de cachorros.\nnumero_de_pessoas_que_gostam_de_cachorros \u0026lt;- dataset %\u0026gt;% dplyr::filter(Dog == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_gatos \u0026lt;- dataset %\u0026gt;% dplyr::filter(Cat == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_gatos_e_de_cachorros \u0026lt;- dataset %\u0026gt;% dplyr::filter(Dog == 1 \u0026amp; Cat == 1) %\u0026gt;% nrow()\rgrid.newpage()\rinvisible(draw.pairwise.venn(area1 = numero_de_pessoas_que_gostam_de_cachorros,\r#N√∫mero de elementos da primeira categoria\rarea2 = numero_de_pessoas_que_gostam_de_gatos,\r#N√∫mero de elementos da segunda categoria\rcross.area = numero_de_pessoas_que_gostam_de_gatos_e_de_cachorros,\r#N√∫mero de elementos na intersec√ß√£o\rcategory = c(\u0026quot;Pessoas que gostam\\nde cachorros\u0026quot;,\r\u0026quot;Pessoas que gostam\\nde gatos\u0026quot;),\r#Nome das categorias\rlty = c(\u0026quot;blank\u0026quot;, \u0026quot;blank\u0026quot;),\r#Grossura das bordas\rfill = c(\u0026quot;light blue\u0026quot;, \u0026quot;pink\u0026quot;),\r#Cores das bordas\ralpha = c(0.5, 0.5),\r#Transpar√™ncia das bordas\rcat.pos = c(0, 0),\r#Posi√ß√£o dos t√≠tulos com rela√ß√£o aos c√≠rculos. 0 quer dizer \u0026quot;em cima\u0026quot;\rscaled = F\r#Constr√≥i as √°reas sem escala\r))\rA falta de escalas deixou esse gr√°fico sim√©trico e esteticamente agrad√°vel. Entretanto, em algumas situa√ß√µes √© mais legal representar os conjuntos em escala.\nnumero_de_pessoas_que_gostam_de_cachorros \u0026lt;- dataset %\u0026gt;% dplyr::filter(Dog == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_serpentes \u0026lt;- dataset %\u0026gt;% dplyr::filter(Snake == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_cachorros_e_de_serpentes \u0026lt;- dataset %\u0026gt;% dplyr::filter(Dog == 1 \u0026amp; Snake == 1) %\u0026gt;% nrow()\rgrid.newpage()\rinvisible(draw.pairwise.venn(area1 = numero_de_pessoas_que_gostam_de_cachorros,\r#N√∫mero de elementos da primeira categoria\rarea2 = numero_de_pessoas_que_gostam_de_serpentes,\r#N√∫mero de elementos da segunda categoria\rcross.area = numero_de_pessoas_que_gostam_de_cachorros_e_de_serpentes,\r#N√∫mero de elementos na intersec√ß√£o\rcategory = c(\u0026quot;Pessoas que gostam\\nde cachorros\u0026quot;,\r\u0026quot;Pessoas que gostam\\nde serpentes\u0026quot;),\r#Nome das categorias\rlty = c(\u0026quot;blank\u0026quot;, \u0026quot;blank\u0026quot;),\r#Grossura das bordas\rfill = c(\u0026quot;light blue\u0026quot;, \u0026quot;light green\u0026quot;),\r#Cores das bordas\ralpha = c(0.5, 0.5),\r#Transpar√™ncia das bordas\rcat.pos = c(0, 0),\r#Posi√ß√£o dos t√≠tulos com rela√ß√£o aos c√≠rculos. 0 quer dizer \u0026quot;em cima\u0026quot;\rscaled = T\r#Constr√≥i as √°reas sem escala\r))\rAt√© aqui tudo vai mais ou menos bem, mas a coisa fica bem mais chata quando voc√™ precisa representar um diagrama com tr√™s conjuntos. Voc√™ vai precisar passar pra fun√ß√£o o tamanho de todos os pedacinhos.\n\rnumero_de_pessoas_que_gostam_de_gatos \u0026lt;- dataset %\u0026gt;% dplyr::filter(Cat == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_serpentes \u0026lt;- dataset %\u0026gt;% dplyr::filter(Snake == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_lagartos \u0026lt;- dataset %\u0026gt;% dplyr::filter(Lizard == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_gatos_e_de_serpentes \u0026lt;- dataset %\u0026gt;% dplyr::filter(Cat == 1 \u0026amp; Snake == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_gatos_e_de_lagartos \u0026lt;- dataset %\u0026gt;% dplyr::filter(Cat == 1 \u0026amp; Lizard == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_serpentes_e_de_lagartos \u0026lt;- dataset %\u0026gt;% dplyr::filter(Lizard == 1 \u0026amp; Snake == 1) %\u0026gt;% nrow()\rnumero_de_pessoas_que_gostam_de_serpentes_e_lagartos_e_gatos \u0026lt;- dataset %\u0026gt;% dplyr::filter(Lizard == 1 \u0026amp; Snake == 1 \u0026amp; Cat == 1) %\u0026gt;% nrow()\rgrid.newpage()\rinvisible(draw.triple.venn(area1 = numero_de_pessoas_que_gostam_de_gatos,\rarea2 = numero_de_pessoas_que_gostam_de_serpentes,\rarea3 = numero_de_pessoas_que_gostam_de_lagartos,\rn12 = numero_de_pessoas_que_gostam_de_gatos_e_de_serpentes,\rn23 = numero_de_pessoas_que_gostam_de_serpentes_e_de_lagartos,\rn13 = numero_de_pessoas_que_gostam_de_gatos_e_de_lagartos, n123 = numero_de_pessoas_que_gostam_de_serpentes_e_lagartos_e_gatos,\rcategory = c(\u0026quot;Gatos\u0026quot;,\r\u0026quot;Serpentes\u0026quot;,\r\u0026quot;Lagartos\u0026quot;),\rlty = \u0026quot;blank\u0026quot;, fill = c(\u0026quot;light blue\u0026quot;, \u0026quot;green\u0026quot;, \u0026quot;light green\u0026quot;),\rcat.pos = c(45,45,45),\rscaled = T))\r\r","permalink":"https://blog.curso-r.com/posts/2017-04-29-diagramas-de-venn/","tags":["gr√°ficos","pacotes"],"title":"Diagramas de Venn em R"},{"author":["Fernando"],"categories":["an√°lises"],"contents":"\r\r\r\r\r\r\r\r√Äs vezes a venda de uma empresa √© um sinal de que algo n√£o vai bem. At√© pode ser verdade que nada ruim estivesse acontecendo e, por qualquer motivo que seja, algu√©m achou melhor parar enquanto estava ganhando, mas eu custo a acreditar que o Porta Dos Fundos estava nessa situa√ß√£o. Principalmente considerando o futuro sombrio que pode esper√°-los.\nA √∫ltima aquisi√ß√£o da Viacom no Brasil foi a finada MTV. Depois de 20 anos de presen√ßa relevante no cen√°rio musical brasileiro, o peso dos anos culminou na venda da MTV para a gigante americana. Hoje, a MTV se limita a produzir vers√µes brasileiras p√©ssimas de s√©ries americanas ruins, dar emprego a subcelebridades ligadas ao Supla e reprisar lixos enlatados estadunidenses. Talvez esse n√£o seja o destino que aguarda os integrantes do Porta, at√© porque alguns deles j√° tiveram rela√ß√µes diretas com a Viacom e o resultado n√£o foi desastroso, mas, se eu fosse um deles, o triste fim da MTV Brasil soaria o meu alarme de cilada.\nInconformados com a venda e buscando entender com mais afinco os motivos que levaram √† venda, neste post revisitamos a an√°lise sobre a decad√™ncia do Porta dos Fundos.\nSetup\rVamos proceder de uma maneira muito parecida com a que fizemos na √∫ltima vez. O dataset do Willy era composto por informa√ß√µes sobre todos os v√≠deos do Porta e as suas colunas eram:\nO t√≠tulo do v√≠deo.\rA data de publica√ß√£o.\rA contagem de visualiza√ß√µes.\rA contagem de Likes.\rAcontagem de Dislikes.\rO n√∫mero de coment√°rios.\r\rNeste post vamos usar o mesmo dataset, mas atualizado-o at√© a data da publica√ß√£o deste post. Isso pode ser feito rodando o c√≥digo abaixo, que tamb√©m carrega os pactoes necess√°rios para a an√°lise.\nlibrary(tuber)\ryt_oauth(\u0026quot;seus\u0026quot;,\r\u0026quot;dados\u0026quot;)\rlibrary(dplyr) # Manipula√ß√£o de dados\rlibrary(tidyr) # Manipula√ß√£o de dados\rlibrary(tibble) # Cria√ß√£o de dataframes\rlibrary(lubridate) # Manipula√ß√£o de datas\rlibrary(purrr) # Funcionais\rlibrary(ggplot2) # Gr√°ficos\rget_videos_porta \u0026lt;- function(dates) {\ryt_search(term = \u0026quot;\u0026quot;, type = \u0026quot;video\u0026quot;,\rchannel_id = \u0026quot;UCEWHPFNilsT0IfQfutVzsag\u0026quot;,\rpublished_after = dates$start,\rpublished_before = dates$end)\r}\rdates \u0026lt;- tibble(start = seq(ymd(\u0026quot;2012-01-01\u0026quot;), ymd(\u0026quot;2017-01-01\u0026quot;), by = \u0026quot;years\u0026quot;),\rend = seq(ymd(\u0026quot;2012-12-31\u0026quot;), ymd(\u0026quot;2017-12-31\u0026quot;), by = \u0026quot;years\u0026quot;)) %\u0026gt;% mutate(start = paste(start, \u0026quot;T0:00:00Z\u0026quot;, sep = \u0026quot;\u0026quot;),\rend = paste(end, \u0026quot;T0:00:00Z\u0026quot;, sep = \u0026quot;\u0026quot;))\rvideos \u0026lt;- by_row(.d = dates, ..f = get_videos_porta, .to = \u0026quot;videos_info\u0026quot;)\rget_videos_stats \u0026lt;- function(df_row) {\rget_stats(video_id = df_row$video_id)\r}\rdados \u0026lt;- bind_rows(videos$videos_info) %\u0026gt;% select(title, publishedAt, video_id) %\u0026gt;%\rby_row(..f = get_videos_stats, .to = \u0026quot;videos_stats\u0026quot;)\rNas subse√ß√µes seguintes, vamos revisitar as an√°lises anteriores colocando algumas novas ideias no caldeir√£o.\n\rV√≠deos velhos X V√≠deos novos\rMenos do que a compra pela Viacom, a s√©rie temporal de visualiza√ß√µes foi o que realmente me motivou a escrever esse texto.\ndados %\u0026gt;% mutate(views = map(videos_stats, .f = \u0026#39;viewCount\u0026#39;)) %\u0026gt;% unnest(views) %\u0026gt;% mutate(views = as.numeric(views),\rpublishedAt = as_date(publishedAt)) %\u0026gt;% ggplot(aes(x = publishedAt, y = views)) + geom_line() + labs(x = \u0026quot;Data de publica√ß√£o\u0026quot;, y = \u0026quot;Visualiza√ß√µes\u0026quot;) + theme_bw()\rO n√∫mero de visualiza√ß√µes est√° em uma queda cont√≠nua, isso quer dizer que o porta dos fundos est√° recebendo menos views? Depende de como voc√™ interpreta esse dado. A resposta ser√° ‚Äúsim‚Äù se voc√™ assumir que o n√∫mero de visualiza√ß√µes de longo prazo √© negligenci√°vel e que o grosso do n√∫mero de views de um v√≠deo vem dos seus primeiros dias de vida. Pensando assim, interpretamos que o que a gente observa √© aproximadamente igual √† quantidade de views no come√ßo da vida de cada um dos v√≠deos do PDF, de tal forma que se esse n√∫mero desce, quer dizer que a quantidade de visualiza√ß√µes de um v√≠deo logo que ele sai tamb√©m deve estar caindo.\nPara analisar esses dados de outra forma, eu vou abandonar a suposi√ß√£o de que a quantidade de views √© negligenci√°vel no longo prazo. Dessa vez, eu vou supor que quanto mais velho for o v√≠deo, mais visualiza√ß√µes ele tem, afinal as pessoas provavelmente voltam nele de tempos em tempos. Pra simplificar as coisas, tamb√©m vou admitir que a quantidade de pessoas que fica voltando nele √© mais ou menos constante. Juntando tudo isso, o que eu quero dizer √© que o n√∫mero esperado de pessoas que assistem a um v√≠deo velho em um certo dia muito distante da sua publica√ß√£o n√£o √© negligenci√°vel, mas √© pequeno e contante.\nEm termos um pouco mais precisos, podemos entender toda essa conversa atrav√©s da equa√ß√£o\n\\[\\text{N√∫mero de Views de um v√≠deo} = \\]\r\\[\\text{Views no come√ßo da vida do v√≠deo} + \\text{Idade do v√≠deo} \\times \\text{Taxa} + \\text{Erro aleat√≥rio},\\]\nonde \\(Taxa\\) √© o n√∫mero de esperado de views de um v√≠deo velho em um dia qualquer. Nesses termos, a diferen√ßa entre o ponto que quero defender e o ponto que o Willy defendeu no post anterior √© que ele assume que a Taxa √© pequena demais para importar, enquanto eu n√£o acho que ela seja negligenci√°vel.\nPodemos dar uma olhada no que esse modelo diz sobre os dados considerando que, se um v√≠deo for muito velho, podemos obter uma estimativa razo√°vel da quantidade de pessoas que ainda assistem um v√≠deo se dividirmos o n√∫mero de visualiza√ß√µes pelo n√∫mero de dias desde a sua publica√ß√£o.\ndados %\u0026gt;% mutate(views = map(videos_stats, .f = \u0026#39;viewCount\u0026#39;)) %\u0026gt;% unnest(views) %\u0026gt;% mutate(views = as.numeric(views),\rpublishedAt = as_date(publishedAt),\ridade = as.numeric(Sys.Date() - publishedAt)) %\u0026gt;% filter(publishedAt \u0026lt; as.Date(\u0026quot;2017-01-01\u0026quot;)) %\u0026gt;% ggplot(aes(x = publishedAt, y = (views)/idade)) + geom_line() + labs(x = \u0026quot;Data de publica√ß√£o\u0026quot;, y = \u0026quot;Visualiza√ß√µes/Idade\u0026quot;) + theme_bw() +\rgeom_smooth(alpha = 0)\rO gr√°fico acima suporta parcialmente a nossa teoria: a estabilidade na raz√£o entre o n√∫mero de visualiza√ß√µes e a idade n√£o seria identificada a menos que todos os v√≠deos antigos do Porta estivessem sujeitos √† mesma audi√™ncia recorrente (mais ou menos), mesmo com uma variabilidade grande. Al√©m disso, se os v√≠deos antigos fossem simplesmente abandonados (caso em que a Taxa √© igual a \\(0\\)), ent√£o dever√≠amos observar raz√µes de Visualiza√ß√£o por Idade muito menores para v√≠deos mais velhos.\nEntretanto, nosso modelo tem uma defici√™ncia s√©ria: sempre vamos observar um aumento na raz√£o de views por idade no final da amostra, pois a idade desses v√≠deos vai ficando cada vez menor, dando mais peso ao n√∫mero de views na inf√¢ncia do v√≠deo, o que pode distorcer as nossas interpreta√ß√µes.\nDe toda a forma, a establidade do come√ßo do gr√°fico me convenceu de que a taxa √© constante. Disso decorre que, como a curva est√° subindo, n√£o ficando est√°vel, devo assumir alguma das duas hip√≥teses: ou o porta dos fundos est√° sendo mais assitido de 2016 pra c√° ou o meu modelo est√° se comportando exatamente do jeito que deveria. Como em nenhuma dessas Porta Dos Fundos est√° perdendo views, sou obrigado a concluir que, no m√≠nimo, tudo est√° est√°vel.\n\rLikes e Dislikes\rO Willy nos contou que a propor√ß√£o de Likes por Dislike √© muit√≠ssimo grande nos v√≠deos do PDF: eles devem ter uma m√©dia de 26 likes por cada dislike, o que significa que o v√≠deo m√©dio do PDF tem 96% de likes.\ndados %\u0026gt;% mutate(likes = map(videos_stats, .f = ~as.numeric(.x[[\u0026#39;likeCount\u0026#39;]])),\rdislikes = map(videos_stats, .f = ~as.numeric(.x[[\u0026#39;dislikeCount\u0026#39;]]))) %\u0026gt;% unnest(likes, dislikes) %\u0026gt;%\rmutate(likes = as.numeric(likes),\rdislikes = as.numeric(dislikes),\rpublishedAt = lubridate::as_date(publishedAt),\rprop = likes/dislikes) %\u0026gt;% ggplot(aes(x = publishedAt)) +\rgeom_line(aes(y = prop)) +\rlabs(x = \u0026quot;Data de publica√ß√£o\u0026quot;, y = \u0026quot;Likes/Dislikes\u0026quot;) +\rtheme_bw()\rA despeito disso, tamb√©m √© verdade que existe uma classe de v√≠deos do PDF que √© fuzilada pelo p√∫blico. Pra se ter uma ideia, um v√≠deo de 2016, o ‚ÄúDela√ß√£o‚Äù, chegou a ter apenas 40% de likes! Isso √© o mesmo que dizer que para cada duas pessoas que gostaram do v√≠deos existem outras que n√£o gostaram.\ng \u0026lt;- dados %\u0026gt;% mutate(likes = map(videos_stats, .f = ~as.numeric(.x[[\u0026#39;likeCount\u0026#39;]])),\rdislikes = map(videos_stats, .f = ~as.numeric(.x[[\u0026#39;dislikeCount\u0026#39;]]))) %\u0026gt;% unnest(likes, dislikes) %\u0026gt;% mutate(likes = as.numeric(likes),\rdislikes = as.numeric(dislikes),\rpublishedAt = lubridate::as_date(publishedAt),\rprop = likes/(likes+dislikes)) %\u0026gt;% ggplot(aes(x = publishedAt, label = title, y = prop)) +\rgeom_line(color = \u0026#39;black\u0026#39;) +\rlabs(x = \u0026quot;Data de publica√ß√£o\u0026quot;, y = \u0026quot;Propor√ß√£o de Likes\u0026quot;) +\rtheme_bw() + scale_y_continuous(labels = scales::percent)\rplotly::ggplotly(g)\r\r{\"x\":{\"data\":[{\"x\":[15561,15575,15579,15586,15589,15590,15591,15592,15593,15596,15600,15603,15607,15610,15614,15617,15619,15620,15621,15624,15628,15631,15635,15638,15642,15645,15649,15652,15656,15659,15661,15662,15663,15666,15670,15673,15677,15680,15684,15687,15691,15694,15698,15701,15708,15712,15715,15719,15722,15726,15729,15733,15736,15740,15743,15747,15750,15754,15757,15761,15764,15768,15771,15775,15778,15782,15785,15789,15792,15796,15799,15803,15806,15810,15813,15817,15820,15827,15831,15834,15838,15841,15845,15852,15855,15859,15862,15866,15869,15873,15876,15880,15883,15887,15890,15894,15897,15901,15904,15908,15911,15915,15918,15922,15925,15929,15932,15936,15939,15943,15946,15950,15951,15953,15957,15960,15964,15967,15971,15974,15978,15981,15985,15988,15992,15995,15999,16002,16006,16009,16013,16016,16020,16023,16027,16030,16034,16037,16041,16044,16048,16051,16055,16058,16062,16065,16069,16072,16079,16083,16086,16090,16093,16097,16100,16104,16107,16111,16114,16118,16121,16125,16128,16132,16135,16142,16146,16149,16153,16156,16158,16160,16163,16165,16167,16170,16172,16174,16177,16179,16181,16184,16186,16188,16191,16193,16195,16198,16200,16202,16205,16207,16209,16212,16214,16216,16219,16221,16223,16226,16228,16230,16231,16233,16235,16237,16240,16242,16244,16247,16249,16251,16254,16256,16258,16261,16263,16265,16268,16270,16272,16275,16277,16279,16282,16284,16286,16289,16291,16293,16296,16298,16300,16303,16305,16307,16310,16312,16314,16317,16319,16321,16324,16326,16328,16331,16333,16335,16338,16340,16345,16349,16350,16352,16353,16354,16356,16357,16359,16361,16363,16364,16366,16368,16370,16373,16375,16377,16378,16380,16382,16384,16387,16389,16391,16394,16396,16398,16401,16403,16405,16408,16410,16412,16413,16415,16418,16419,16422,16424,16426,16428,16431,16433,16436,16438,16440,16443,16445,16450,16452,16454,16457,16459,16461,16464,16466,16468,16471,16473,16475,16478,16480,16482,16485,16487,16489,16492,16496,16499,16501,16503,16506,16508,16510,16513,16515,16517,16520,16522,16524,16527,16529,16531,16534,16536,16538,16541,16543,16545,16548,16550,16552,16555,16557,16559,16562,16564,16566,16569,16571,16573,16576,16578,16580,16585,16587,16590,16592,16594,16597,16599,16601,16604,16606,16608,16611,16613,16615,16618,16620,16622,16625,16627,16629,16632,16634,16636,16639,16641,16643,16646,16647,16648,16650,16653,16655,16657,16660,16662,16664,16667,16669,16671,16674,16676,16678,16681,16683,16685,16688,16690,16692,16695,16697,16699,16702,16704,16706,16709,16711,16713,16716,16718,16720,16723,16724,16725,16727,16730,16732,16734,16737,16739,16741,16744,16746,16748,16751,16753,16755,16758,16762,16765,16767,16769,16772,16774,16776,16779,16781,16783,16786,16788,16790,16793,16795,16797,16802,16804,16809,16811,16814,16816,16818,16821,16823,16825,16828,16830,16832,16835,16836,16836,16836,16836,16836,16836,16836,16836,16836,16836,16837,16839,16842,16844,16846,16849,16851,16853,16856,16858,16860,16863,16865,16867,16870,16872,16874,16877,16879,16881,16884,16886,16888,16891,16893,16895,16898,16900,16902,16905,16907,16909,16912,16914,16916,16919,16921,16923,16926,16928,16930,16933,16935,16937,16940,16942,16944,16947,16949,16951,16954,16956,16958,16961,16963,16965,16968,16970,16972,16975,16977,16979,16982,16982,16982,16984,16986,16989,16991,16993,16996,16998,17000,17003,17005,17007,17010,17012,17014,17017,17019,17021,17024,17026,17028,17031,17033,17035,17038,17040,17042,17045,17047,17049,17052,17054,17056,17059,17061,17063,17066,17068,17070,17073,17075,17077,17080,17082,17084,17089,17091,17094,17096,17098,17101,17103,17105,17108,17110,17112,17115,17117,17119,17122,17124,17126,17129,17131,17133,17136,17138,17140,17143,17145,17147,17150,17152,17154,17157,17159,17161,17164,17168,17171,17173,17175,17178,17180,17182,17185,17187,17189,17192,17194,17196,17199,17201,17203,17206,17208,17210,17213,17215,17217,17220,17222,17224,17227,17229,17231,17234,17236,17238,17241,17243,17245,17248,17250,17252,17255,17257,17259,17262,17264,17266,17269,17271,17273,17276,17278,17280,17283],\"y\":[0.968422792074151,0.964904159132007,0.974707146041912,0.968713660778559,0.970405097464331,0.985798543609345,0.971646874712326,0.9848990742146,0.95999414355415,0.969043025707748,0.859303909351726,0.969969694186794,0.965125934126765,0.946036585365854,0.975211176088369,0.989398846670353,0.953035695028578,0.978823308447199,0.892077221601,0.960669456066946,0.948769733077519,0.91572755213325,0.844892777679193,0.984480326069917,0.922040346130147,0.961145741967018,0.981035088886144,0.94613653218147,0.97298180407213,0.970833230950684,0.979325690786694,0.968381997096306,0.97812568989624,0.972119435794102,0.965450349510017,0.920703302861546,0.956534021013113,0.978241052673299,0.964503249497275,0.986521329648443,0.978804329944395,0.960685880778014,0.97379807485527,0.980325698397988,0.980490981311454,0.952363746730066,0.924618742466761,0.979622595270187,0.982010655794857,0.978292845592333,0.961459472946776,0.97412896150277,0.913346135381661,0.952225147618926,0.870088820410568,0.965785401771422,0.950841809891266,0.952476010848466,0.937903330309706,0.950845172664109,0.932194473265041,0.983366375327197,0.98471431389309,0.987974491736896,0.967824004788985,0.970469681037504,0.9012979432064,0.967370441458733,0.971685624478477,0.968711448182217,0.917429249751998,0.971380435478024,0.906855190835773,0.769943392498053,0.967165375534666,0.935055495210016,0.909806014079901,0.935154072776495,0.867671443282774,0.978201801518448,0.932270296780985,0.946260370532094,0.933381924941257,0.918596821257175,0.94501006548349,0.769422015163563,0.921502855033761,0.956232891458801,0.84200782208234,0.985122121423587,0.969149722017029,0.979744490881459,0.977463756143902,0.956090966332086,0.904412110385031,0.951974959952786,0.955835371803612,0.965828424279024,0.963751902820772,0.975226540852243,0.971500804412779,0.946805401297714,0.978612319020494,0.966235240690282,0.977874834246715,0.972605294237788,0.976576405534328,0.799626990579121,0.933359030006452,0.964660596288217,0.937377292656379,0.969098907275105,0.955020387359837,0.964826313558265,0.931898528215369,0.924715288043139,0.904665754430464,0.971611796421861,0.955667460624892,0.949281117024429,0.975847528207106,0.978509597290177,0.926315585334872,0.944032965856791,0.977123472731844,0.98284439733926,0.929086839204442,0.916178999734525,0.908410462022708,0.940930455260561,0.963735572240085,0.945418956561018,0.948625724217845,0.963290931023138,0.982576763424036,0.971108380803455,0.968469045636065,0.960307882498381,0.973681297157359,0.817954294908083,0.96730790512376,0.956007987805599,0.988646636125454,0.971293931436383,0.803353388020997,0.976712253253619,0.96717122711689,0.864299128021722,0.948910796629035,0.954573013271057,0.963621789098245,0.93740755523208,0.95046167375055,0.971800063614712,0.980798681561293,0.9610715835141,0.98309473606333,0.916975676510837,0.916189695516868,0.965755807212152,0.980843056078284,0.964557601325005,0.857297500823646,0.740297760268158,0.967433683941742,0.926989965776546,0.952382298350245,0.846325994382532,0.974060539198786,0.970848160939162,0.98551290054099,0.950993055892779,0.968763955155475,0.982818765689695,0.969759870338513,0.916521330829085,0.990069183542564,0.95490456479803,0.987011040955748,0.990263614987416,0.959501644461787,0.976150545159124,0.98566578280481,0.97393616530177,0.978871032333328,0.962680466824287,0.9843044733903,0.967623873873874,0.981697445325577,0.985580938162845,0.932613605211284,0.954463958060288,0.952351432599059,0.980497046695643,0.98075205640423,0.968874509163874,0.976705862637209,0.961621734879173,0.981406195833727,0.980697367697972,0.982922592552383,0.946940104166667,0.985884122530445,0.967753395458148,0.932274085480894,0.850515257762195,0.979117675876935,0.955307617125522,0.954257093308659,0.938621706878546,0.935886530637343,0.967204987192317,0.84870885653498,0.979316935349842,0.965981704239051,0.981006466040415,0.95609756097561,0.961756489191462,0.938170331848044,0.919033689731693,0.974193131104068,0.984555004667942,0.770879233334537,0.956830245910519,0.98148043874862,0.966352922916597,0.935665388565997,0.927033655811418,0.966460234680574,0.980161487805685,0.980929731959294,0.969462754151749,0.981803928801992,0.983814164415284,0.859508758687927,0.959636174636175,0.979177761674859,0.938016341695489,0.94588312393123,0.890411898528689,0.922492856170908,0.919554770318021,0.886478598018724,0.980374765341095,0.961991428403687,0.972176184018884,0.971714160603611,0.895023887033357,0.975962928581212,0.968295020263015,0.969780417381655,0.922844344904815,0.984035476718404,0.949457788804996,0.987458745874587,0.977689477101951,0.978614008941878,0.966337575829666,0.963164077796632,0.799047819577017,0.95941824277654,0.975866448920341,0.971275781560311,0.971451676474985,0.98084024482381,0.90220438394141,0.957911602039716,0.951466182478439,0.987661649353403,0.968946375493696,0.988780437686222,0.970067196090409,0.96756804748738,0.988926721378267,0.976575650725588,0.926066671683347,0.983119467508406,0.968067351555836,0.96947844290613,0.986175616835994,0.965491281066787,0.986583430137181,0.977753310609031,0.969814396621992,0.984515737273555,0.981172067247048,0.974049275304212,0.969911459842064,0.986901234567901,0.981386297776932,0.947505932350534,0.904845802559621,0.961414955761282,0.95559183806089,0.916451130342388,0.944045085204075,0.966305970463957,0.94942957237661,0.957747394774918,0.97852117482101,0.99286950238634,0.976134579206766,0.984734037352107,0.975927432322506,0.980821964182945,0.986509853024476,0.981778235017176,0.991882212495026,0.985041078524586,0.934999523718804,0.982012635120282,0.974417587660014,0.912550628243119,0.740057857864836,0.982873953997067,0.968777717014168,0.978057185004206,0.98251805705386,0.947085536059319,0.963769532079768,0.981031461058391,0.982789438050102,0.947589955252243,0.978566456716975,0.97957584691181,0.988301519335174,0.902129906706566,0.982079340826565,0.978172371913094,0.972000561392253,0.975595988022972,0.961429719766056,0.981522898206079,0.985683756455666,0.989342920424999,0.971403428842469,0.973951221061323,0.966193592765307,0.967228978162628,0.956805766095587,0.968014906596406,0.963884550564276,0.982964086851486,0.979339756341746,0.872067689053411,0.976332572238406,0.972415525962179,0.933792327349739,0.946840020459871,0.975312790306959,0.970304256416359,0.983098742450013,0.945053309663772,0.97099758900335,0.975186864354858,0.928742985015172,0.930494008750316,0.906167960996314,0.873081486957029,0.982848777878654,0.976748316811584,0.970630666200969,0.968562548254905,0.918522526893257,0.96158800625887,0.875309278893229,0.982697260175978,0.957017298326149,0.981133058841924,0.976045002163566,0.972993215261256,0.944619942385754,0.989313480154242,0.962951322044553,0.969490438199094,0.965536000555591,0.951866084213961,0.931744910804753,0.919745880386832,0.982739784384727,0.957958166753578,0.89166980834481,0.95566257057456,0.984070138150903,0.960625987170809,0.956404509721385,0.9502170716641,0.854274764150943,0.984708752305587,0.982457156569878,0.927014109914262,0.987443626099088,0.973693028051033,0.977795639505677,0.977963986234308,0.991034817710614,0.978173498503723,0.980565162378743,0.93160996219702,0.981609169502092,0.964953778047828,0.983298837228869,0.969646702531597,0.984783100197584,0.944501164351347,0.981968074271808,0.954523722473774,0.983648140598813,0.983991017584527,0.968061215384158,0.962540568412751,0.855004517141363,0.982297693073449,0.957570195255769,0.987814762218143,0.964104111793971,0.989578772221736,0.974853792216541,0.93694087847562,0.986430094149903,0.96848974110056,0.976732465350693,0.987562900495474,0.98030826398702,0.953126227739958,0.919452690379347,0.965987256840575,0.979787994783999,0.958316105272268,0.973594033460996,0.983290164906099,0.982529734202089,0.964996709227327,0.969286853920077,0.977036263244292,0.983172647956748,0.985774238196393,0.984222640320131,0.979646302503199,0.968343666724694,0.983986310648462,0.981431695902819,0.969553481773544,0.960276436618385,0.918213984557134,0.824814868593001,0.986500219940237,0.979332883378921,0.962397168987545,0.972327239840472,0.956487420727448,0.980127528298659,0.956408824538623,0.924282643389897,0.974255585294097,0.984051293247079,0.965812546727384,0.966496205872649,0.979261433948094,0.965113237668323,0.984469779296991,0.987551784576163,0.968571476157959,0.981023289599128,0.982645944313252,0.984522128060264,0.979364127174565,0.974674274555274,0.983756345177665,0.98540404040404,0.952933434924153,0.985097513057645,0.975938000992099,0.885657283581159,0.963231043972635,0.973106136719849,0.956499689010095,0.940255285938736,0.985376226702601,0.924528592556076,0.957669439344832,0.973732760031542,0.693368190290852,0.979383057256574,0.971895798004244,0.984209091481018,0.825113420166837,0.927202874461287,0.971231022792748,0.97667306867553,0.951007295361756,0.954892119157812,0.960173916941213,0.916994062234921,0.953933894641029,0.921779971887963,0.409015160627397,0.852930717929738,0.922740782308684,0.836205575725277,0.801171950630647,0.965977814430322,0.924561641973631,0.923078559198562,0.97683424976395,0.966220545312166,0.932349349842548,0.953115363476553,0.971235424889978,0.96080473040776,0.980403476828545,0.98499228734245,0.973397672815461,0.976668872212451,0.958419870300513,0.972996646700229,0.979531724888372,0.947391598285668,0.910300825180182,0.97332221434194,0.979051730386669,0.97296291304878,0.979483309978082,0.817384927488554,0.951605616495293,0.843291691821855,0.961069046577739,0.966105861817467,0.977352174082292,0.942425056259898,0.966561264141027,0.982889270828259,0.969409039905631,0.984233935503267,0.933301115973546,0.951013298751494,0.932390757697965,0.965646573930963,0.986907941283328,0.937049100701439,0.978931993545772,0.984043243243243,0.955439756207592,0.798885243274286,0.971012713722052,0.968802186692627,0.96582208540532,0.964037765315539,0.891343552750225,0.982220544349764,0.975031480073964,0.984341308905973,0.920527437400107,0.97261500504059,0.981477311113613,0.975034279996541,0.971577305462183,0.974382192039238,0.965848149279387,0.954066456270178,0.979207937556086,0.976009750048109,0.971165905732463,0.96263096948812,0.976547293946996,0.936524385765926,0.971779688464382,0.95669258353162,0.980919080352943,0.945173465886433,0.956867161187677,0.962102054005451,0.9711245191787,0.969326604636493,0.972763672583592,0.968494067164466,0.96786426691544,0.973679448584448,0.972636140126869,0.730411228943878,0.951370203556387,0.9695942835043,0.968962792020991,0.953297210762884,0.96810032569324,0.983172766299588,0.82081033333549,0.975285605764479,0.978737293667817,0.952674345151046,0.957654431512981,0.966506948153936,0.970699847444699,0.904764965407058,0.937070145495716,0.972044530012732,0.957969264769077,0.941688079046129,0.967265245043023,0.846439988375472,0.957709767169424,0.969899635202091,0.984241560234414,0.971112602142292,0.976696599324744,0.905024848150193,0.982492943453828,0.952018943170489,0.977918237799419,0.893976518631955,0.875998853904683,0.858672907049183,0.918058750600191,0.953931203931204,0.93862170833201,0.942096502813308,0.969917545447873,0.968096507184455,0.968671339141175,0.963769949572541,0.981642829744096,0.889663661339137,0.97917335330409,0.964841865756542,0.957523687168781,0.899017538161741,0.936280620112093,0.975842953771042,0.964888501629716,0.972829449847154,0.964220467410077,0.974949369322431,0.962509571397719,0.96854764107308,0.84408293686171,0.950735115367135,0.961258649710118,0.973680463261819,0.902904849039341,0.980617514341855,0.953521689878057,0.95661120256262,0.963289896380466,0.948573808036644,0.750377918046596,0.97036027494667,0.973744875713228,0.949686559438683,0.981559621667445,0.976631616817386,0.972475625616854,0.942473084028795,0.975996685115577,0.939882486341614,0.959525546136095,0.950345014206467,0.911552556570298,0.908710512026064,0.854938717957988,0.957128551194031,0.954233752399552,0.93791282517422,0.961356218894684,0.907592834859616],\"text\":[\"publishedAt: 2012-08-09\nprop: 0.9684228\ntitle: BATMAN: THE DARK KNIGHT ERECTS\",\"publishedAt: 2012-08-23\nprop: 0.9649042\ntitle: MEIAS PALAVRAS\",\"publishedAt: 2012-08-27\nprop: 0.9747071\ntitle: KKKKKK\",\"publishedAt: 2012-09-03\nprop: 0.9687137\ntitle: PORTA DOS FUNDOS N¬∞2\",\"publishedAt: 2012-09-06\nprop: 0.9704051\ntitle: M√âDICO VIDENTE\",\"publishedAt: 2012-09-07\nprop: 0.9857985\ntitle: COMERCIAL DE PASTA DE DENTE - Porta dos fundos N¬∞2\",\"publishedAt: 2012-09-08\nprop: 0.9716469\ntitle: GAL√É GLOBAL - Porta dos Fundos N¬∞ 2\",\"publishedAt: 2012-09-09\nprop: 0.9848991\ntitle: MINUTO DA MARMOTA - Porta dos Fundos N¬∞2\",\"publishedAt: 2012-09-10\nprop: 0.9599941\ntitle: SOBRE A MESA\",\"publishedAt: 2012-09-13\nprop: 0.9690430\ntitle: SETOR DE RH - SUPERG√äMEOS\",\"publishedAt: 2012-09-17\nprop: 0.8593039\ntitle: FILME PORN√î\",\"publishedAt: 2012-09-20\nprop: 0.9699697\ntitle: ENCONTRO\",\"publishedAt: 2012-09-24\nprop: 0.9651259\ntitle: PROGRAMA POL√çTICO\",\"publishedAt: 2012-09-27\nprop: 0.9460366\ntitle: MEU PR√çNCIPE\",\"publishedAt: 2012-10-01\nprop: 0.9752112\ntitle: PORTA DOS FUNDOS N¬∫ 3\",\"publishedAt: 2012-10-04\nprop: 0.9893988\ntitle: CANCELAMENTO\",\"publishedAt: 2012-10-06\nprop: 0.9530357\ntitle: PODE SER? - Porta dos Fundos N¬∫ 3\",\"publishedAt: 2012-10-07\nprop: 0.9788233\ntitle: ASSEMBLEIA GERAL - Porta dos Fundos N¬∫ 3\",\"publishedAt: 2012-10-08\nprop: 0.8920772\ntitle: SETOR DE RH - JESUS\",\"publishedAt: 2012-10-11\nprop: 0.9606695\ntitle: SEX SHOP\",\"publishedAt: 2012-10-15\nprop: 0.9487697\ntitle: COMA\",\"publishedAt: 2012-10-18\nprop: 0.9157276\ntitle: LINHA DA VIDA\",\"publishedAt: 2012-10-22\nprop: 0.8448928\ntitle: BRAINSTORM\",\"publishedAt: 2012-10-25\nprop: 0.9844803\ntitle: PONTO DE VISTA\",\"publishedAt: 2012-10-29\nprop: 0.9220403\ntitle: PREPARADORA DE ELENCO\",\"publishedAt: 2012-11-01\nprop: 0.9611457\ntitle: T√âRMINO DE NAMORO\",\"publishedAt: 2012-11-05\nprop: 0.9810351\ntitle: CICLO DA VIDA\",\"publishedAt: 2012-11-08\nprop: 0.9461365\ntitle: NOME DO BEB√ä\",\"publishedAt: 2012-11-12\nprop: 0.9729818\ntitle: PORTA DOS FUNDOS N¬∞4\",\"publishedAt: 2012-11-15\nprop: 0.9708332\ntitle: TESTE PRA SACI\",\"publishedAt: 2012-11-17\nprop: 0.9793257\ntitle: TRAGO A PESSOA - Porta dos Fundos N¬∫ 4\",\"publishedAt: 2012-11-18\nprop: 0.9683820\ntitle: MESA REDONDA - Porta Dos Fundos N¬∫ 4\",\"publishedAt: 2012-11-19\nprop: 0.9781257\ntitle: TIPO...\",\"publishedAt: 2012-11-22\nprop: 0.9721194\ntitle: VAN\",\"publishedAt: 2012-11-26\nprop: 0.9654503\ntitle: TROCA DE PRESENTE\",\"publishedAt: 2012-11-29\nprop: 0.9207033\ntitle: TEQUILA - \\\"Quem t√° dentro?\\\"\",\"publishedAt: 2012-12-03\nprop: 0.9565340\ntitle: BARATA NO BANHEIRO\",\"publishedAt: 2012-12-06\nprop: 0.9782411\ntitle: TROCADO\",\"publishedAt: 2012-12-10\nprop: 0.9645032\ntitle: DR\",\"publishedAt: 2012-12-13\nprop: 0.9865213\ntitle: COM QUEM SER√Å?\",\"publishedAt: 2012-12-17\nprop: 0.9788043\ntitle: CLARICE FALC√ÉO - OITAVO ANDAR\",\"publishedAt: 2012-12-20\nprop: 0.9606859\ntitle: TAXISTA\",\"publishedAt: 2012-12-24\nprop: 0.9737981\ntitle: DEPOIS DO FIM DO MUNDO\",\"publishedAt: 2012-12-27\nprop: 0.9803257\ntitle: CORTE DE GASTOS\",\"publishedAt: 2013-01-03\nprop: 0.9804910\ntitle: GERENTE J√öNIOR\",\"publishedAt: 2013-01-07\nprop: 0.9523637\ntitle: EXORCISMO\",\"publishedAt: 2013-01-10\nprop: 0.9246187\ntitle: ROLA\",\"publishedAt: 2013-01-14\nprop: 0.9796226\ntitle: DE B√äBADO\",\"publishedAt: 2013-01-17\nprop: 0.9820107\ntitle: NA LATA\",\"publishedAt: 2013-01-21\nprop: 0.9782928\ntitle: O HOMEM QUE N√ÉO SABIA MENTIR\",\"publishedAt: 2013-01-24\nprop: 0.9614595\ntitle: ENTREVISTA\",\"publishedAt: 2013-01-28\nprop: 0.9741290\ntitle: VILLAGE PEOPLE\",\"publishedAt: 2013-01-31\nprop: 0.9133461\ntitle: POLTERGEIST\",\"publishedAt: 2013-02-04\nprop: 0.9522251\ntitle: FUNDO VERDE\",\"publishedAt: 2013-02-07\nprop: 0.8700888\ntitle: 10 MANDAMENTOS\",\"publishedAt: 2013-02-11\nprop: 0.9657854\ntitle: TORCEDORES\",\"publishedAt: 2013-02-14\nprop: 0.9508418\ntitle: MEC√ÇNICA\",\"publishedAt: 2013-02-18\nprop: 0.9524760\ntitle: BATALHA\",\"publishedAt: 2013-02-21\nprop: 0.9379033\ntitle: VOYEUR\",\"publishedAt: 2013-02-25\nprop: 0.9508452\ntitle: CONFESSION√ÅRIO\",\"publishedAt: 2013-02-28\nprop: 0.9321945\ntitle: MAIT√äNDO FUNDO\",\"publishedAt: 2013-03-04\nprop: 0.9833664\ntitle: CASAMENTO\",\"publishedAt: 2013-03-07\nprop: 0.9847143\ntitle: ESSA √â PRA VOC√ä\",\"publishedAt: 2013-03-11\nprop: 0.9879745\ntitle: LOG OUT\",\"publishedAt: 2013-03-14\nprop: 0.9678240\ntitle: AMANTE\",\"publishedAt: 2013-03-18\nprop: 0.9704697\ntitle: PREVIS√ÉO DO TEMPO\",\"publishedAt: 2013-03-21\nprop: 0.9012979\ntitle: DEUS\",\"publishedAt: 2013-03-25\nprop: 0.9673704\ntitle: QUEM MANDA\",\"publishedAt: 2013-03-28\nprop: 0.9716856\ntitle: MULHERES\",\"publishedAt: 2013-04-01\nprop: 0.9687114\ntitle: HOMENS\",\"publishedAt: 2013-04-04\nprop: 0.9174292\ntitle: HAPPY HOUR\",\"publishedAt: 2013-04-08\nprop: 0.9713804\ntitle: ENTREVISTA DE EMPREGO\",\"publishedAt: 2013-04-11\nprop: 0.9068552\ntitle: ARCA DE NO√â\",\"publishedAt: 2013-04-15\nprop: 0.7699434\ntitle: DR√âBITO\",\"publishedAt: 2013-04-18\nprop: 0.9671654\ntitle: A VIDA COMO ELA √â\",\"publishedAt: 2013-04-22\nprop: 0.9350555\ntitle: VOZINHA\",\"publishedAt: 2013-04-25\nprop: 0.9098060\ntitle: BOLA FORA\",\"publishedAt: 2013-05-02\nprop: 0.9351541\ntitle: SINAL\",\"publishedAt: 2013-05-06\nprop: 0.8676714\ntitle: A REGRA √â CLARA\",\"publishedAt: 2013-05-09\nprop: 0.9782018\ntitle: PARAB√âNS\",\"publishedAt: 2013-05-13\nprop: 0.9322703\ntitle: MICHELANGELO\",\"publishedAt: 2013-05-16\nprop: 0.9462604\ntitle: DESPEDIDA DE SOLTEIRO\",\"publishedAt: 2013-05-20\nprop: 0.9333819\ntitle: DEM√îNIO\",\"publishedAt: 2013-05-27\nprop: 0.9185968\ntitle: AULA DE SEGUNDA\",\"publishedAt: 2013-05-30\nprop: 0.9450101\ntitle: AULA DE QUINTA\",\"publishedAt: 2013-06-03\nprop: 0.7694220\ntitle: SORTE GRANDE\",\"publishedAt: 2013-06-06\nprop: 0.9215029\ntitle: MENINO MENINA\",\"publishedAt: 2013-06-10\nprop: 0.9562329\ntitle: O PLANO\",\"publishedAt: 2013-06-13\nprop: 0.8420078\ntitle: MINIST√âRIO\",\"publishedAt: 2013-06-17\nprop: 0.9851221\ntitle: REUNI√ÉO DE TRAFICANTE\",\"publishedAt: 2013-06-20\nprop: 0.9691497\ntitle: PORTA DOS FUNDOS NA TV\",\"publishedAt: 2013-06-24\nprop: 0.9797445\ntitle: SHEILA\",\"publishedAt: 2013-06-27\nprop: 0.9774638\ntitle: REUNI√ÉO DE EMERG√äNCIA\",\"publishedAt: 2013-07-01\nprop: 0.9560910\ntitle: TIROS DA VINGAN√áA - CENAS EXCLU√çDAS\",\"publishedAt: 2013-07-04\nprop: 0.9044121\ntitle: EITCHA LEL√ä\",\"publishedAt: 2013-07-08\nprop: 0.9519750\ntitle: PORN√î MODERNO\",\"publishedAt: 2013-07-11\nprop: 0.9558354\ntitle: DEPOIMENTO\",\"publishedAt: 2013-07-15\nprop: 0.9658284\ntitle: COMPADRE\",\"publishedAt: 2013-07-18\nprop: 0.9637519\ntitle: √â PAU √â PEDRA\",\"publishedAt: 2013-07-22\nprop: 0.9752265\ntitle: SEGUNDA OPINI√ÉO\",\"publishedAt: 2013-07-25\nprop: 0.9715008\ntitle: PRINCESA\",\"publishedAt: 2013-07-29\nprop: 0.9468054\ntitle: JUIZ\",\"publishedAt: 2013-08-01\nprop: 0.9786123\ntitle: CASAL NORMAL\",\"publishedAt: 2013-08-05\nprop: 0.9662352\ntitle: ARTE MODERNA\",\"publishedAt: 2013-08-08\nprop: 0.9778748\ntitle: BANCO\",\"publishedAt: 2013-08-12\nprop: 0.9726053\ntitle: QUINTA MALUCA\",\"publishedAt: 2013-08-15\nprop: 0.9765764\ntitle: BAFO\",\"publishedAt: 2013-08-19\nprop: 0.7996270\ntitle: OH, MEU DEUS!\",\"publishedAt: 2013-08-22\nprop: 0.9333590\ntitle: ESPINHA\",\"publishedAt: 2013-08-26\nprop: 0.9646606\ntitle: DEPUTADO\",\"publishedAt: 2013-08-29\nprop: 0.9373773\ntitle: OCUPADA\",\"publishedAt: 2013-09-02\nprop: 0.9690989\ntitle: CABE√áA DO GREGORIO\",\"publishedAt: 2013-09-03\nprop: 0.9550204\ntitle: CAMISETAS DO PORTA\",\"publishedAt: 2013-09-05\nprop: 0.9648263\ntitle: COMPRA COLETIVA\",\"publishedAt: 2013-09-09\nprop: 0.9318985\ntitle: CURA\",\"publishedAt: 2013-09-12\nprop: 0.9247153\ntitle: SEXO POR TELEFONE\",\"publishedAt: 2013-09-16\nprop: 0.9046658\ntitle: SETOR DE RH - MOSQUETEIROS\",\"publishedAt: 2013-09-19\nprop: 0.9716118\ntitle: M√çMICA\",\"publishedAt: 2013-09-23\nprop: 0.9556675\ntitle: ARR√Å!\",\"publishedAt: 2013-09-26\nprop: 0.9492811\ntitle: VIDA PRIVADA\",\"publishedAt: 2013-09-30\nprop: 0.9758475\ntitle: GAR√áOM VEGETARIANO\",\"publishedAt: 2013-10-03\nprop: 0.9785096\ntitle: SEQUESTRO\",\"publishedAt: 2013-10-07\nprop: 0.9263156\ntitle: DEBATE\",\"publishedAt: 2013-10-10\nprop: 0.9440330\ntitle: SESS√ÉO DE TERAPIA\",\"publishedAt: 2013-10-14\nprop: 0.9771235\ntitle: GOSTOSA\",\"publishedAt: 2013-10-17\nprop: 0.9828444\ntitle: SUBORNO\",\"publishedAt: 2013-10-21\nprop: 0.9290868\ntitle: FIDELIDADE\",\"publishedAt: 2013-10-24\nprop: 0.9161790\ntitle: XUXUXU XAXAXA\",\"publishedAt: 2013-10-28\nprop: 0.9084105\ntitle: METEOROLOGIA\",\"publishedAt: 2013-10-31\nprop: 0.9409305\ntitle: EXERC√çCIO\",\"publishedAt: 2013-11-04\nprop: 0.9637356\ntitle: LEICONHA\",\"publishedAt: 2013-11-07\nprop: 0.9454190\ntitle: CAS√ìRIO\",\"publishedAt: 2013-11-11\nprop: 0.9486257\ntitle: EST√ÅTUAS\",\"publishedAt: 2013-11-14\nprop: 0.9632909\ntitle: CABE√áA DO FABIO\",\"publishedAt: 2013-11-18\nprop: 0.9825768\ntitle: BOM DIA\",\"publishedAt: 2013-11-21\nprop: 0.9711084\ntitle: TERAPIA DE CASAL\",\"publishedAt: 2013-11-25\nprop: 0.9684690\ntitle: DELAY\",\"publishedAt: 2013-11-28\nprop: 0.9603079\ntitle: MACEDO\",\"publishedAt: 2013-12-02\nprop: 0.9736813\ntitle: BALA DE BORRACHA\",\"publishedAt: 2013-12-05\nprop: 0.8179543\ntitle: AD√ÉO\",\"publishedAt: 2013-12-09\nprop: 0.9673079\ntitle: A BOA DE SEGUNDA\",\"publishedAt: 2013-12-12\nprop: 0.9560080\ntitle: XING√ì KAIAPU\",\"publishedAt: 2013-12-16\nprop: 0.9886466\ntitle: AMIGOS\",\"publishedAt: 2013-12-19\nprop: 0.9712939\ntitle: MODA\",\"publishedAt: 2013-12-23\nprop: 0.8033534\ntitle: ESPECIAL DE NATAL - PORTA DOS FUNDOS\",\"publishedAt: 2013-12-26\nprop: 0.9767123\ntitle: CI√öMES\",\"publishedAt: 2013-12-30\nprop: 0.9671712\ntitle: F√É\",\"publishedAt: 2014-01-02\nprop: 0.8642991\ntitle: T√ÅXI\",\"publishedAt: 2014-01-09\nprop: 0.9489108\ntitle: EMPREGADA\",\"publishedAt: 2014-01-13\nprop: 0.9545730\ntitle: BIOGRAFIA\",\"publishedAt: 2014-01-16\nprop: 0.9636218\ntitle: CARECA\",\"publishedAt: 2014-01-20\nprop: 0.9374076\ntitle: N√öMERO DE EMERG√äNCIA\",\"publishedAt: 2014-01-23\nprop: 0.9504617\ntitle: ARM√ÅRIO\",\"publishedAt: 2014-01-27\nprop: 0.9718001\ntitle: HITLER\",\"publishedAt: 2014-01-30\nprop: 0.9807987\ntitle: INDIRETAS\",\"publishedAt: 2014-02-03\nprop: 0.9610716\ntitle: DURA\",\"publishedAt: 2014-02-06\nprop: 0.9830947\ntitle: SINAIS\",\"publishedAt: 2014-02-10\nprop: 0.9169757\ntitle: DESPACHA\",\"publishedAt: 2014-02-13\nprop: 0.9161897\ntitle: POBRE\",\"publishedAt: 2014-02-17\nprop: 0.9657558\ntitle: PRA MIM CHEGA\",\"publishedAt: 2014-02-20\nprop: 0.9808431\ntitle: TATUAGEM\",\"publishedAt: 2014-02-24\nprop: 0.9645576\ntitle: COMANDANTE\",\"publishedAt: 2014-02-27\nprop: 0.8572975\ntitle: FOI DEUS QUE ME DEU\",\"publishedAt: 2014-03-03\nprop: 0.7402978\ntitle: TRADU√á√ÉO SIMULT√ÇNEA\",\"publishedAt: 2014-03-06\nprop: 0.9674337\ntitle: MASSAGEM\",\"publishedAt: 2014-03-13\nprop: 0.9269900\ntitle: ALALA\",\"publishedAt: 2014-03-17\nprop: 0.9523823\ntitle: PESSOA RUIM\",\"publishedAt: 2014-03-20\nprop: 0.8463260\ntitle: ANUNCIA√á√ÉO\",\"publishedAt: 2014-03-24\nprop: 0.9740605\ntitle: TEMPO\",\"publishedAt: 2014-03-27\nprop: 0.9708482\ntitle: REF√âM\",\"publishedAt: 2014-03-29\nprop: 0.9855129\ntitle: TRAILER -- VIRAL\",\"publishedAt: 2014-03-31\nprop: 0.9509931\ntitle: √ÅRIES\",\"publishedAt: 2014-04-03\nprop: 0.9687640\ntitle: CONFISS√ÉO\",\"publishedAt: 2014-04-05\nprop: 0.9828188\ntitle: VIRAL - EPIS√ìDIO 1\",\"publishedAt: 2014-04-07\nprop: 0.9697599\ntitle: PROBLEMAS DOM√âSTICOS\",\"publishedAt: 2014-04-10\nprop: 0.9165213\ntitle: CHURRASCARIA\",\"publishedAt: 2014-04-12\nprop: 0.9900692\ntitle: VIRAL - EPIS√ìDIO 2\",\"publishedAt: 2014-04-14\nprop: 0.9549046\ntitle: OK OK\",\"publishedAt: 2014-04-17\nprop: 0.9870110\ntitle: INTIMIDADE\",\"publishedAt: 2014-04-19\nprop: 0.9902636\ntitle: VIRAL - EPIS√ìDIO 3\",\"publishedAt: 2014-04-21\nprop: 0.9595016\ntitle: ADO√á√ÉO\",\"publishedAt: 2014-04-24\nprop: 0.9761505\ntitle: M√âNAGE\",\"publishedAt: 2014-04-26\nprop: 0.9856658\ntitle: VIRAL - EPIS√ìDIO 4 (FINAL)\",\"publishedAt: 2014-04-28\nprop: 0.9739362\ntitle: OPERA√á√ÉO\",\"publishedAt: 2014-05-01\nprop: 0.9788710\ntitle: VIADO\",\"publishedAt: 2014-05-03\nprop: 0.9626805\ntitle: ACADEMIA\",\"publishedAt: 2014-05-05\nprop: 0.9843045\ntitle: PIPOCA\",\"publishedAt: 2014-05-08\nprop: 0.9676239\ntitle: T√ÅXIS\",\"publishedAt: 2014-05-10\nprop: 0.9816974\ntitle: MORANDO SOZINHO\",\"publishedAt: 2014-05-12\nprop: 0.9855809\ntitle: T√î INDO\",\"publishedAt: 2014-05-15\nprop: 0.9326136\ntitle: SHOW\",\"publishedAt: 2014-05-17\nprop: 0.9544640\ntitle: TRIBUNAL\",\"publishedAt: 2014-05-19\nprop: 0.9523514\ntitle: DE FRENTE\",\"publishedAt: 2014-05-22\nprop: 0.9804970\ntitle: CONCEP√á√ÉO\",\"publishedAt: 2014-05-24\nprop: 0.9807521\ntitle: RESTAURANTE MODERNO\",\"publishedAt: 2014-05-26\nprop: 0.9688745\ntitle: BARBEIRO\",\"publishedAt: 2014-05-29\nprop: 0.9767059\ntitle: FOFOCA\",\"publishedAt: 2014-05-31\nprop: 0.9616217\ntitle: PREPARADO\",\"publishedAt: 2014-06-02\nprop: 0.9814062\ntitle: SONO\",\"publishedAt: 2014-06-05\nprop: 0.9806974\ntitle: CANTADA\",\"publishedAt: 2014-06-07\nprop: 0.9829226\ntitle: ATENDIMENTO\",\"publishedAt: 2014-06-09\nprop: 0.9469401\ntitle: QUEM\",\"publishedAt: 2014-06-10\nprop: 0.9858841\ntitle: TEASER COPA\",\"publishedAt: 2014-06-12\nprop: 0.9677534\ntitle: BANHEIRO FEMININO\",\"publishedAt: 2014-06-14\nprop: 0.9322741\ntitle: COMEMORA√á√ÉO\",\"publishedAt: 2014-06-16\nprop: 0.8505153\ntitle: HOMEM BOMBA\",\"publishedAt: 2014-06-19\nprop: 0.9791177\ntitle: TRAJE A RIGOR\",\"publishedAt: 2014-06-21\nprop: 0.9553076\ntitle: MESA REDONDA\",\"publishedAt: 2014-06-23\nprop: 0.9542571\ntitle: INFERNO\",\"publishedAt: 2014-06-26\nprop: 0.9386217\ntitle: LEMBRA DE MIM\",\"publishedAt: 2014-06-28\nprop: 0.9358865\ntitle: PAGODE\",\"publishedAt: 2014-06-30\nprop: 0.9672050\ntitle: COISA NOSSA\",\"publishedAt: 2014-07-03\nprop: 0.8487089\ntitle: DEFESA PESSOAL\",\"publishedAt: 2014-07-05\nprop: 0.9793169\ntitle: CHUTEIRA\",\"publishedAt: 2014-07-07\nprop: 0.9659817\ntitle: BATE-BOLA\",\"publishedAt: 2014-07-10\nprop: 0.9810065\ntitle: LI√á√ÉO\",\"publishedAt: 2014-07-12\nprop: 0.9560976\ntitle: REP√ìRTER\",\"publishedAt: 2014-07-14\nprop: 0.9617565\ntitle: AUMENTO\",\"publishedAt: 2014-07-17\nprop: 0.9381703\ntitle: SUSPEITO\",\"publishedAt: 2014-07-19\nprop: 0.9190337\ntitle: AULA DE S√ÅBADO\",\"publishedAt: 2014-07-21\nprop: 0.9741931\ntitle: TORCIDA ORGANIZADA\",\"publishedAt: 2014-07-24\nprop: 0.9845550\ntitle: LOUCOS\",\"publishedAt: 2014-07-26\nprop: 0.7708792\ntitle: ADIVINHA\",\"publishedAt: 2014-07-28\nprop: 0.9568302\ntitle: P√ÉO NOSSO\",\"publishedAt: 2014-07-31\nprop: 0.9814804\ntitle: PIRATARIA\",\"publishedAt: 2014-08-02\nprop: 0.9663529\ntitle: PAPAI\",\"publishedAt: 2014-08-04\nprop: 0.9356654\ntitle: NEGRO\",\"publishedAt: 2014-08-07\nprop: 0.9270337\ntitle: AQUI √ì\",\"publishedAt: 2014-08-09\nprop: 0.9664602\ntitle: QUEM NUNCA?\",\"publishedAt: 2014-08-11\nprop: 0.9801615\ntitle: TORTURA\",\"publishedAt: 2014-08-14\nprop: 0.9809297\ntitle: TRAI√á√ÉO\",\"publishedAt: 2014-08-16\nprop: 0.9694628\ntitle: VOTE EM MIM\",\"publishedAt: 2014-08-18\nprop: 0.9818039\ntitle: CORRERIA\",\"publishedAt: 2014-08-21\nprop: 0.9838142\ntitle: CALMA\",\"publishedAt: 2014-08-23\nprop: 0.8595088\ntitle: CRIAN√áAS\",\"publishedAt: 2014-08-25\nprop: 0.9596362\ntitle: FILHO\",\"publishedAt: 2014-08-28\nprop: 0.9791778\ntitle: COMO √â QUE FALA\",\"publishedAt: 2014-08-30\nprop: 0.9380163\ntitle: REGRESS√ÉO\",\"publishedAt: 2014-09-01\nprop: 0.9458831\ntitle: NUTRICIONISTA\",\"publishedAt: 2014-09-04\nprop: 0.8904119\ntitle: CHAMADO\",\"publishedAt: 2014-09-06\nprop: 0.9224929\ntitle: FESTA\",\"publishedAt: 2014-09-08\nprop: 0.9195548\ntitle: ATENDENDO A PEDIDOS\",\"publishedAt: 2014-09-11\nprop: 0.8864786\ntitle: PARADOXO\",\"publishedAt: 2014-09-13\nprop: 0.9803748\ntitle: LOJA\",\"publishedAt: 2014-09-15\nprop: 0.9619914\ntitle: MOTIVO DE SEGURAN√áA\",\"publishedAt: 2014-09-18\nprop: 0.9721762\ntitle: √çDOLO\",\"publishedAt: 2014-09-20\nprop: 0.9717142\ntitle: NAMORADA\",\"publishedAt: 2014-09-22\nprop: 0.8950239\ntitle: SANTO ANT√îNIO\",\"publishedAt: 2014-09-25\nprop: 0.9759629\ntitle: SENHA\",\"publishedAt: 2014-09-27\nprop: 0.9682950\ntitle: FINANCIAMENTO\",\"publishedAt: 2014-10-02\nprop: 0.9697804\ntitle: ZONA ELEITORAL\",\"publishedAt: 2014-10-06\nprop: 0.9228443\ntitle: DEU MOLE\",\"publishedAt: 2014-10-07\nprop: 0.9840355\ntitle: PORTA NA FOX 1\",\"publishedAt: 2014-10-09\nprop: 0.9494578\ntitle: MUNDO DOS NEG√ìCIOS\",\"publishedAt: 2014-10-10\nprop: 0.9874587\ntitle: PORTA NA FOX 2\",\"publishedAt: 2014-10-11\nprop: 0.9776895\ntitle: CR√çTICA\",\"publishedAt: 2014-10-13\nprop: 0.9786140\ntitle: BOAS VINDAS\",\"publishedAt: 2014-10-14\nprop: 0.9663376\ntitle: PORTA NA FOX 3\",\"publishedAt: 2014-10-16\nprop: 0.9631641\ntitle: AEROPORTO\",\"publishedAt: 2014-10-18\nprop: 0.7990478\ntitle: PAPA\",\"publishedAt: 2014-10-20\nprop: 0.9594182\ntitle: TROCADILHO\",\"publishedAt: 2014-10-21\nprop: 0.9758664\ntitle: PORTA NA FOX 4\",\"publishedAt: 2014-10-23\nprop: 0.9712758\ntitle: AGONIA\",\"publishedAt: 2014-10-25\nprop: 0.9714517\ntitle: CARLA\",\"publishedAt: 2014-10-27\nprop: 0.9808402\ntitle: JUSTIFICANDO\",\"publishedAt: 2014-10-30\nprop: 0.9022044\ntitle: DIRE√á√ÉO\",\"publishedAt: 2014-11-01\nprop: 0.9579116\ntitle: ENTREVISTA COLETIVA\",\"publishedAt: 2014-11-03\nprop: 0.9514662\ntitle: FLAGRA\",\"publishedAt: 2014-11-04\nprop: 0.9876616\ntitle: REF√âM - TRAILER\",\"publishedAt: 2014-11-06\nprop: 0.9689464\ntitle: ALIAN√áAS\",\"publishedAt: 2014-11-08\nprop: 0.9887804\ntitle: REF√âM - EPIS√ìDIO 1 DE 5\",\"publishedAt: 2014-11-10\nprop: 0.9700672\ntitle: ROMANOS\",\"publishedAt: 2014-11-13\nprop: 0.9675680\ntitle: BARULHO\",\"publishedAt: 2014-11-15\nprop: 0.9889267\ntitle: REF√âM - EPIS√ìDIO 2 DE 5\",\"publishedAt: 2014-11-17\nprop: 0.9765757\ntitle: PEDIDO\",\"publishedAt: 2014-11-20\nprop: 0.9260667\ntitle: POSSESSIVO\",\"publishedAt: 2014-11-22\nprop: 0.9831195\ntitle: REFEÃÅM - EPISOÃÅDIO 3 DE 5\",\"publishedAt: 2014-11-24\nprop: 0.9680674\ntitle: SONHO\",\"publishedAt: 2014-11-27\nprop: 0.9694784\ntitle: MERENDA\",\"publishedAt: 2014-11-29\nprop: 0.9861756\ntitle: REFEÃÅM - EPISOÃÅDIO 4 DE 5\",\"publishedAt: 2014-12-01\nprop: 0.9654913\ntitle: EU VOU EMBORA\",\"publishedAt: 2014-12-04\nprop: 0.9865834\ntitle: TARIFA\",\"publishedAt: 2014-12-06\nprop: 0.9777533\ntitle: REFEÃÅM - EPISOÃÅDIO 5 DE 5\",\"publishedAt: 2014-12-08\nprop: 0.9698144\ntitle: CONTA\",\"publishedAt: 2014-12-09\nprop: 0.9845157\ntitle: TEASER FILME PORTA\",\"publishedAt: 2014-12-11\nprop: 0.9811721\ntitle: PEDREIRO\",\"publishedAt: 2014-12-14\nprop: 0.9740493\ntitle: TENHO QUE IR\",\"publishedAt: 2014-12-15\nprop: 0.9699115\ntitle: PAPAI E MAM√ÉE\",\"publishedAt: 2014-12-18\nprop: 0.9869012\ntitle: INSTRU√á√ÉO DE SEGURAN√áA\",\"publishedAt: 2014-12-20\nprop: 0.9813863\ntitle: CURR√çCULO\",\"publishedAt: 2014-12-22\nprop: 0.9475059\ntitle: PRIMEIRO ENCONTRO\",\"publishedAt: 2014-12-24\nprop: 0.9048458\ntitle: ESPECIAL DE NATAL - O VELHO TESTAMENTO\",\"publishedAt: 2014-12-27\nprop: 0.9614150\ntitle: PAPAI NOEL\",\"publishedAt: 2014-12-29\nprop: 0.9555918\ntitle: TESTEMUNHA DE DARWIN\",\"publishedAt: 2015-01-01\nprop: 0.9164511\ntitle: AJUDA\",\"publishedAt: 2015-01-03\nprop: 0.9440451\ntitle: ENTREVISTADOR\",\"publishedAt: 2015-01-05\nprop: 0.9663060\ntitle: SEGUNDA GRAVIDEZ\",\"publishedAt: 2015-01-08\nprop: 0.9494296\ntitle: TOBO√ÅGUA\",\"publishedAt: 2015-01-10\nprop: 0.9577474\ntitle: CORRESPONDENTE\",\"publishedAt: 2015-01-15\nprop: 0.9785212\ntitle: FILMANDO\",\"publishedAt: 2015-01-17\nprop: 0.9928695\ntitle: SEM BATERIA\",\"publishedAt: 2015-01-19\nprop: 0.9761346\ntitle: INVEJA\",\"publishedAt: 2015-01-22\nprop: 0.9847340\ntitle: VIAGEM\",\"publishedAt: 2015-01-24\nprop: 0.9759274\ntitle: DIETAS\",\"publishedAt: 2015-01-26\nprop: 0.9808220\ntitle: IMIGRACÃßAÃÉO\",\"publishedAt: 2015-01-29\nprop: 0.9865099\ntitle: SORVETE\",\"publishedAt: 2015-01-31\nprop: 0.9817782\ntitle: PRESO\",\"publishedAt: 2015-02-02\nprop: 0.9918822\ntitle: TAÃÅ PICOTANDO\",\"publishedAt: 2015-02-05\nprop: 0.9850411\ntitle: NA LATA 2\",\"publishedAt: 2015-02-07\nprop: 0.9349995\ntitle: FANTASMA\",\"publishedAt: 2015-02-09\nprop: 0.9820126\ntitle: CLAQUE\",\"publishedAt: 2015-02-12\nprop: 0.9744176\ntitle: TAMANHO\",\"publishedAt: 2015-02-14\nprop: 0.9125506\ntitle: CARNAVAL\",\"publishedAt: 2015-02-16\nprop: 0.7400579\ntitle: MARCHINHA\",\"publishedAt: 2015-02-19\nprop: 0.9828740\ntitle: UFCLGBT\",\"publishedAt: 2015-02-21\nprop: 0.9687777\ntitle: GAMEPLAY\",\"publishedAt: 2015-02-23\nprop: 0.9780572\ntitle: ESQUECIMENTO\",\"publishedAt: 2015-02-26\nprop: 0.9825181\ntitle: PIRANHO\",\"publishedAt: 2015-03-02\nprop: 0.9470855\ntitle: CARONA\",\"publishedAt: 2015-03-05\nprop: 0.9637695\ntitle: GR√ÅVIDA\",\"publishedAt: 2015-03-07\nprop: 0.9810315\ntitle: CONVEN√á√ÉO\",\"publishedAt: 2015-03-09\nprop: 0.9827894\ntitle: DESAPARECIMENTO\",\"publishedAt: 2015-03-12\nprop: 0.9475900\ntitle: GEÃÇNIO\",\"publishedAt: 2015-03-14\nprop: 0.9785665\ntitle: PRIVACIDADE\",\"publishedAt: 2015-03-16\nprop: 0.9795758\ntitle: GPS\",\"publishedAt: 2015-03-19\nprop: 0.9883015\ntitle: COLATERAL\",\"publishedAt: 2015-03-21\nprop: 0.9021299\ntitle: AGRADECIMENTO\",\"publishedAt: 2015-03-23\nprop: 0.9820793\ntitle: WI-FI\",\"publishedAt: 2015-03-26\nprop: 0.9781724\ntitle: PROMO√á√ÉO\",\"publishedAt: 2015-03-28\nprop: 0.9720006\ntitle: CASA DE MASSAGEM\",\"publishedAt: 2015-03-30\nprop: 0.9755960\ntitle: TENSO\",\"publishedAt: 2015-04-02\nprop: 0.9614297\ntitle: REUNIAÃÉO\",\"publishedAt: 2015-04-04\nprop: 0.9815229\ntitle: √îNIBUS\",\"publishedAt: 2015-04-06\nprop: 0.9856838\ntitle: REALITY SHOW\",\"publishedAt: 2015-04-09\nprop: 0.9893429\ntitle: AJUDANTE DE DR\",\"publishedAt: 2015-04-11\nprop: 0.9714034\ntitle: 50 TONS\",\"publishedAt: 2015-04-13\nprop: 0.9739512\ntitle: VENDEDORA\",\"publishedAt: 2015-04-16\nprop: 0.9661936\ntitle: SEXO CONJUGAL\",\"publishedAt: 2015-04-18\nprop: 0.9672290\ntitle: ANIVERSAÃÅRIO\",\"publishedAt: 2015-04-20\nprop: 0.9568058\ntitle: POSICÃßAÃÉO\",\"publishedAt: 2015-04-23\nprop: 0.9680149\ntitle: OGUM\",\"publishedAt: 2015-04-25\nprop: 0.9638846\ntitle: OPCÃßOÃÉES\",\"publishedAt: 2015-04-27\nprop: 0.9829641\ntitle: BERCÃßAÃÅRIO\",\"publishedAt: 2015-04-30\nprop: 0.9793398\ntitle: CONVERSA\",\"publishedAt: 2015-05-02\nprop: 0.8720677\ntitle: BIÃÅBLIA\",\"publishedAt: 2015-05-04\nprop: 0.9763326\ntitle: PROBLEMAS LINGUIÃÅSTICOS\",\"publishedAt: 2015-05-07\nprop: 0.9724155\ntitle: PERDEU, PERDEU\",\"publishedAt: 2015-05-09\nprop: 0.9337923\ntitle: MAÃÉE\",\"publishedAt: 2015-05-11\nprop: 0.9468400\ntitle: LIVRO\",\"publishedAt: 2015-05-14\nprop: 0.9753128\ntitle: PORRADA\",\"publishedAt: 2015-05-16\nprop: 0.9703043\ntitle: SOLDADO\",\"publishedAt: 2015-05-18\nprop: 0.9830987\ntitle: RIO 2025\",\"publishedAt: 2015-05-21\nprop: 0.9450533\ntitle: COR\",\"publishedAt: 2015-05-23\nprop: 0.9709976\ntitle: JAMES BOND\",\"publishedAt: 2015-05-25\nprop: 0.9751869\ntitle: BRINDE\",\"publishedAt: 2015-05-30\nprop: 0.9287430\ntitle: NASCIMENTO\",\"publishedAt: 2015-06-01\nprop: 0.9304940\ntitle: TRANSFORMA√á√ÉO\",\"publishedAt: 2015-06-04\nprop: 0.9061680\ntitle: CEIA\",\"publishedAt: 2015-06-06\nprop: 0.8730815\ntitle: RESSURREICÃßAÃÉO\",\"publishedAt: 2015-06-08\nprop: 0.9828488\ntitle: MENDIGO\",\"publishedAt: 2015-06-11\nprop: 0.9767483\ntitle: AMOR\",\"publishedAt: 2015-06-13\nprop: 0.9706307\ntitle: CULIN√ÅRIA\",\"publishedAt: 2015-06-15\nprop: 0.9685625\ntitle: MANJANDO\",\"publishedAt: 2015-06-18\nprop: 0.9185225\ntitle: ENCOSTO\",\"publishedAt: 2015-06-20\nprop: 0.9615880\ntitle: GAGO\",\"publishedAt: 2015-06-22\nprop: 0.8753093\ntitle: PALAVRA\",\"publishedAt: 2015-06-25\nprop: 0.9826973\ntitle: RETROÃÇ\",\"publishedAt: 2015-06-27\nprop: 0.9570173\ntitle: PARA SEMPRE\",\"publishedAt: 2015-06-29\nprop: 0.9811331\ntitle: VINHO\",\"publishedAt: 2015-07-02\nprop: 0.9760450\ntitle: CAMA\",\"publishedAt: 2015-07-04\nprop: 0.9729932\ntitle: EXAME DE SANGUE\",\"publishedAt: 2015-07-06\nprop: 0.9446199\ntitle: HUMANIDADE\",\"publishedAt: 2015-07-09\nprop: 0.9893135\ntitle: VIDA REAL\",\"publishedAt: 2015-07-11\nprop: 0.9629513\ntitle: COÃÅDIGO DE GUERRA\",\"publishedAt: 2015-07-13\nprop: 0.9694904\ntitle: MEIA\",\"publishedAt: 2015-07-16\nprop: 0.9655360\ntitle: TRAVESTI\",\"publishedAt: 2015-07-18\nprop: 0.9518661\ntitle: NAÃÉO SOUBE?\",\"publishedAt: 2015-07-20\nprop: 0.9317449\ntitle: PALAVRA DA SALVACÃßAÃÉO\",\"publishedAt: 2015-07-23\nprop: 0.9197459\ntitle: NOTICIAÃÅRIO\",\"publishedAt: 2015-07-25\nprop: 0.9827398\ntitle: PASSIVA AGRESSIVA\",\"publishedAt: 2015-07-27\nprop: 0.9579582\ntitle: NOVELA BIÃÅBLICA\",\"publishedAt: 2015-07-30\nprop: 0.8916698\ntitle: REDUCÃßAÃÉO\",\"publishedAt: 2015-07-31\nprop: 0.9556626\ntitle: TEASER - O GRANDE GONZALEZ\",\"publishedAt: 2015-08-01\nprop: 0.9840701\ntitle: ARTISTA\",\"publishedAt: 2015-08-03\nprop: 0.9606260\ntitle: TRUCO\",\"publishedAt: 2015-08-06\nprop: 0.9564045\ntitle: SOTAQUES\",\"publishedAt: 2015-08-08\nprop: 0.9502171\ntitle: PESO\",\"publishedAt: 2015-08-10\nprop: 0.8542748\ntitle: OLHEIRO\",\"publishedAt: 2015-08-13\nprop: 0.9847088\ntitle: TATUADOR\",\"publishedAt: 2015-08-15\nprop: 0.9824572\ntitle: ANTES DE DORMIR\",\"publishedAt: 2015-08-17\nprop: 0.9270141\ntitle: ME LIGA\",\"publishedAt: 2015-08-20\nprop: 0.9874436\ntitle: GRUPO DE APOIO\",\"publishedAt: 2015-08-22\nprop: 0.9736930\ntitle: EMBORA\",\"publishedAt: 2015-08-24\nprop: 0.9777956\ntitle: PEIDO\",\"publishedAt: 2015-08-27\nprop: 0.9779640\ntitle: ALIEN\",\"publishedAt: 2015-08-29\nprop: 0.9910348\ntitle: EXCEÃÇNTRICO\",\"publishedAt: 2015-08-31\nprop: 0.9781735\ntitle: QUESTAÃÉO DE ORDEM\",\"publishedAt: 2015-09-03\nprop: 0.9805652\ntitle: FOFOQUEIRO\",\"publishedAt: 2015-09-05\nprop: 0.9316100\ntitle: BARZINHO\",\"publishedAt: 2015-09-07\nprop: 0.9816092\ntitle: PENA\",\"publishedAt: 2015-09-10\nprop: 0.9649538\ntitle: AMEACÃßA\",\"publishedAt: 2015-09-12\nprop: 0.9832988\ntitle: TREINO\",\"publishedAt: 2015-09-14\nprop: 0.9696467\ntitle: MESTRE CUCA\",\"publishedAt: 2015-09-17\nprop: 0.9847831\ntitle: LETRA\",\"publishedAt: 2015-09-19\nprop: 0.9445012\ntitle: NAÃÉO OLHE AGORA\",\"publishedAt: 2015-09-21\nprop: 0.9819681\ntitle: DISCURSO\",\"publishedAt: 2015-09-24\nprop: 0.9545237\ntitle: COMO FOI?\",\"publishedAt: 2015-09-26\nprop: 0.9836481\ntitle: RH BOM RH MAU\",\"publishedAt: 2015-09-28\nprop: 0.9839910\ntitle: DESVIO\",\"publishedAt: 2015-10-01\nprop: 0.9680612\ntitle: JUIÃÅZA\",\"publishedAt: 2015-10-03\nprop: 0.9625406\ntitle: AMIGUINHO\",\"publishedAt: 2015-10-05\nprop: 0.8550045\ntitle: THANK YOU\",\"publishedAt: 2015-10-08\nprop: 0.9822977\ntitle: S√ÉO LONGUINHO\",\"publishedAt: 2015-10-10\nprop: 0.9575702\ntitle: MAQUININHA\",\"publishedAt: 2015-10-12\nprop: 0.9878148\ntitle: VENDAS\",\"publishedAt: 2015-10-15\nprop: 0.9641041\ntitle: LIMAÃÉO\",\"publishedAt: 2015-10-16\nprop: 0.9895788\ntitle: TRAILER - O GRANDE GONZALEZ\",\"publishedAt: 2015-10-17\nprop: 0.9748538\ntitle: MEDO\",\"publishedAt: 2015-10-19\nprop: 0.9369409\ntitle: REMEÃÅDIO\",\"publishedAt: 2015-10-22\nprop: 0.9864301\ntitle: SIGNO\",\"publishedAt: 2015-10-24\nprop: 0.9684897\ntitle: TANANAÃÉ\",\"publishedAt: 2015-10-26\nprop: 0.9767325\ntitle: SABE COM QUEM TAÃÅ FALANDO?\",\"publishedAt: 2015-10-29\nprop: 0.9875629\ntitle: EMOTICON\",\"publishedAt: 2015-10-31\nprop: 0.9803083\ntitle: LIKES\",\"publishedAt: 2015-11-02\nprop: 0.9531262\ntitle: VELOÃÅRIO\",\"publishedAt: 2015-11-05\nprop: 0.9194527\ntitle: STAND UP\",\"publishedAt: 2015-11-07\nprop: 0.9659873\ntitle: REUNIAÃÉO DE CRIACÃßAÃÉO\",\"publishedAt: 2015-11-09\nprop: 0.9797880\ntitle: BIBLIOTECA\",\"publishedAt: 2015-11-12\nprop: 0.9583161\ntitle: SUCESSO\",\"publishedAt: 2015-11-14\nprop: 0.9735940\ntitle: GARCÃßONS\",\"publishedAt: 2015-11-16\nprop: 0.9832902\ntitle: PRA ONDE?\",\"publishedAt: 2015-11-19\nprop: 0.9825297\ntitle: MERDA\",\"publishedAt: 2015-11-23\nprop: 0.9649967\ntitle: SUPERMERCADO\",\"publishedAt: 2015-11-26\nprop: 0.9692869\ntitle: BAR\",\"publishedAt: 2015-11-28\nprop: 0.9770363\ntitle: FADA\",\"publishedAt: 2015-11-30\nprop: 0.9831726\ntitle: O QUE VOC√ä FARIA?\",\"publishedAt: 2015-12-03\nprop: 0.9857742\ntitle: JAMES\",\"publishedAt: 2015-12-05\nprop: 0.9842226\ntitle: PAPO MERDA\",\"publishedAt: 2015-12-07\nprop: 0.9796463\ntitle: ATRASO\",\"publishedAt: 2015-12-10\nprop: 0.9683437\ntitle: FLANELINHA\",\"publishedAt: 2015-12-12\nprop: 0.9839863\ntitle: ESCUTA\",\"publishedAt: 2015-12-14\nprop: 0.9814317\ntitle: AMIGO SECRETO\",\"publishedAt: 2015-12-17\nprop: 0.9695535\ntitle: COMPRAS DE NATAL\",\"publishedAt: 2015-12-19\nprop: 0.9602764\ntitle: AMIGO SECRETO 2\",\"publishedAt: 2015-12-21\nprop: 0.9182140\ntitle: CAIXINHA\",\"publishedAt: 2015-12-24\nprop: 0.8248149\ntitle: ESPECIAL DE NATAL - JESUS CRISTO\",\"publishedAt: 2015-12-26\nprop: 0.9865002\ntitle: ASSALTO EM SP\",\"publishedAt: 2015-12-28\nprop: 0.9793329\ntitle: VAGA\",\"publishedAt: 2016-01-02\nprop: 0.9623972\ntitle: ACIDENTE\",\"publishedAt: 2016-01-04\nprop: 0.9723272\ntitle: SANTA\",\"publishedAt: 2016-01-09\nprop: 0.9564874\ntitle: LUIZ\",\"publishedAt: 2016-01-11\nprop: 0.9801275\ntitle: WOODY ALLEN\",\"publishedAt: 2016-01-14\nprop: 0.9564088\ntitle: GARCÃßOM DE ESQUERDA\",\"publishedAt: 2016-01-16\nprop: 0.9242826\ntitle: CONTA PRA GENTE\",\"publishedAt: 2016-01-18\nprop: 0.9742556\ntitle: DESCOBRIMENTO\",\"publishedAt: 2016-01-21\nprop: 0.9840513\ntitle: CHIP\",\"publishedAt: 2016-01-23\nprop: 0.9658125\ntitle: TERRORISTA\",\"publishedAt: 2016-01-25\nprop: 0.9664962\ntitle: TEÃÅCNICO\",\"publishedAt: 2016-01-28\nprop: 0.9792614\ntitle: POSSO AJUDAR?\",\"publishedAt: 2016-01-30\nprop: 0.9651132\ntitle: BALADA\",\"publishedAt: 2016-02-01\nprop: 0.9844698\ntitle: MUDANCÃßA\",\"publishedAt: 2016-02-04\nprop: 0.9875518\ntitle: RESGATE\",\"publishedAt: 2016-02-05\nprop: 0.9685715\ntitle: O GRANDE GONZALEZ - EP01: O PALHA√áO\",\"publishedAt: 2016-02-05\nprop: 0.9810233\ntitle: O GRANDE GONZALEZ - EP04: O CAMERAMAN\",\"publishedAt: 2016-02-05\nprop: 0.9826459\ntitle: O GRANDE GONZALEZ - EP09: A VOLTA DO PALHA√áO\",\"publishedAt: 2016-02-05\nprop: 0.9845221\ntitle: O GRANDE GONZALEZ - EP08: O PAI\",\"publishedAt: 2016-02-05\nprop: 0.9793641\ntitle: O GRANDE GONZALEZ - EP03: O DONO DA CASA DE FESTAS\",\"publishedAt: 2016-02-05\nprop: 0.9746743\ntitle: O GRANDE GONZALEZ - EP02: O OUTRO M√ÅGICO\",\"publishedAt: 2016-02-05\nprop: 0.9837563\ntitle: O GRANDE GONZALEZ - EP07: GONZALEZ\",\"publishedAt: 2016-02-05\nprop: 0.9854040\ntitle: O GRANDE GONZALEZ - EP06: A MADRASTA\",\"publishedAt: 2016-02-05\nprop: 0.9529334\ntitle: O GRANDE GONZALEZ - EP10: A RECONSTITUI√á√ÉO\",\"publishedAt: 2016-02-05\nprop: 0.9850975\ntitle: O GRANDE GONZALEZ - EP05: A ASSISTENTE DE PALCO\",\"publishedAt: 2016-02-06\nprop: 0.9759380\ntitle: TRADUTOR\",\"publishedAt: 2016-02-08\nprop: 0.8856573\ntitle: BEIJA-FLOR\",\"publishedAt: 2016-02-11\nprop: 0.9632310\ntitle: CERIM√îNIA\",\"publishedAt: 2016-02-13\nprop: 0.9731061\ntitle: INSEGURAN√áA\",\"publishedAt: 2016-02-15\nprop: 0.9564997\ntitle: A TR√äS\",\"publishedAt: 2016-02-18\nprop: 0.9402553\ntitle: PORTEIRO\",\"publishedAt: 2016-02-20\nprop: 0.9853762\ntitle: BROMANCE\",\"publishedAt: 2016-02-22\nprop: 0.9245286\ntitle: ACERTO DE CONTAS\",\"publishedAt: 2016-02-25\nprop: 0.9576694\ntitle: BALA PERDIDA\",\"publishedAt: 2016-02-27\nprop: 0.9737328\ntitle: PALAVRAS\",\"publishedAt: 2016-02-29\nprop: 0.6933682\ntitle: JESUS TE AMA\",\"publishedAt: 2016-03-03\nprop: 0.9793831\ntitle: REFORMA\",\"publishedAt: 2016-03-05\nprop: 0.9718958\ntitle: JULGAMENTO\",\"publishedAt: 2016-03-07\nprop: 0.9842091\ntitle: ASSALTO\",\"publishedAt: 2016-03-10\nprop: 0.8251134\ntitle: PE√áANHA\",\"publishedAt: 2016-03-12\nprop: 0.9272029\ntitle: MAJESTADE\",\"publishedAt: 2016-03-14\nprop: 0.9712310\ntitle: ROUBO\",\"publishedAt: 2016-03-17\nprop: 0.9766731\ntitle: POST PAGO\",\"publishedAt: 2016-03-19\nprop: 0.9510073\ntitle: PAGAMENTO\",\"publishedAt: 2016-03-21\nprop: 0.9548921\ntitle: REUNI√ÉO DE EMERG√äNCIA 2\",\"publishedAt: 2016-03-24\nprop: 0.9601739\ntitle: NARRADOR\",\"publishedAt: 2016-03-26\nprop: 0.9169941\ntitle: MESA REDONDA 2\",\"publishedAt: 2016-03-28\nprop: 0.9539339\ntitle: PROMOVIDO\",\"publishedAt: 2016-03-31\nprop: 0.9217800\ntitle: T√î SEM NADA\",\"publishedAt: 2016-04-02\nprop: 0.4090152\ntitle: DELA√á√ÉO\",\"publishedAt: 2016-04-04\nprop: 0.8529307\ntitle: LEMBRA?\",\"publishedAt: 2016-04-07\nprop: 0.9227408\ntitle: AVALIA√á√ÉO F√çSICA\",\"publishedAt: 2016-04-09\nprop: 0.8362056\ntitle: MILAGRE\",\"publishedAt: 2016-04-11\nprop: 0.8011720\ntitle: REUNI√ÉO DE EMERG√äNCIA 3, A DELA√á√ÉO 2\",\"publishedAt: 2016-04-14\nprop: 0.9659778\ntitle: TIO\",\"publishedAt: 2016-04-16\nprop: 0.9245616\ntitle: MOTO\",\"publishedAt: 2016-04-18\nprop: 0.9230786\ntitle: HOSPITAL\",\"publishedAt: 2016-04-21\nprop: 0.9768342\ntitle: COLONIZADO\",\"publishedAt: 2016-04-23\nprop: 0.9662205\ntitle: ROMEU E JULIETA\",\"publishedAt: 2016-04-25\nprop: 0.9323493\ntitle: PORTA DOS FUNDOS - CONTRATO VITAL√çCIO - TRAILER 1\",\"publishedAt: 2016-04-28\nprop: 0.9531154\ntitle: ENSINO\",\"publishedAt: 2016-04-30\nprop: 0.9712354\ntitle: INDIGNADO\",\"publishedAt: 2016-05-02\nprop: 0.9608047\ntitle: NEG√ÉO\",\"publishedAt: 2016-05-05\nprop: 0.9804035\ntitle: BLOQUEIO\",\"publishedAt: 2016-05-07\nprop: 0.9849923\ntitle: XUXA MENEGHEL\",\"publishedAt: 2016-05-09\nprop: 0.9733977\ntitle: TRAVADO\",\"publishedAt: 2016-05-12\nprop: 0.9766689\ntitle: PERFIL\",\"publishedAt: 2016-05-14\nprop: 0.9584199\ntitle: ANIMAL\",\"publishedAt: 2016-05-16\nprop: 0.9729966\ntitle: JORNALISTA\",\"publishedAt: 2016-05-19\nprop: 0.9795317\ntitle: EU VOS DECLARO\",\"publishedAt: 2016-05-21\nprop: 0.9473916\ntitle: IGREJA\",\"publishedAt: 2016-05-23\nprop: 0.9103008\ntitle: FORA DE √âPOCA\",\"publishedAt: 2016-05-26\nprop: 0.9733222\ntitle: SEGREDO\",\"publishedAt: 2016-05-28\nprop: 0.9790517\ntitle: OPINI√ÉO SINCERA\",\"publishedAt: 2016-05-30\nprop: 0.9729629\ntitle: MAPA ASTRAL\",\"publishedAt: 2016-06-02\nprop: 0.9794833\ntitle: HOMENAGEM\",\"publishedAt: 2016-06-04\nprop: 0.8173849\ntitle: VATICANO\",\"publishedAt: 2016-06-06\nprop: 0.9516056\ntitle: VIRALIZA\",\"publishedAt: 2016-06-09\nprop: 0.8432917\ntitle: PING PONG\",\"publishedAt: 2016-06-11\nprop: 0.9610690\ntitle: SA√öDE\",\"publishedAt: 2016-06-13\nprop: 0.9661059\ntitle: HIST√ìRIA\",\"publishedAt: 2016-06-16\nprop: 0.9773522\ntitle: PERDIDOS\",\"publishedAt: 2016-06-18\nprop: 0.9424251\ntitle: UM MINUTINHO S√ì\",\"publishedAt: 2016-06-20\nprop: 0.9665613\ntitle: T√âDIO\",\"publishedAt: 2016-06-23\nprop: 0.9828893\ntitle: BANHEIRO\",\"publishedAt: 2016-06-25\nprop: 0.9694090\ntitle: SUBLIMINAR\",\"publishedAt: 2016-06-27\nprop: 0.9842339\ntitle: SEPARA√á√ÉO\",\"publishedAt: 2016-06-30\nprop: 0.9333011\ntitle: CR√çTICO\",\"publishedAt: 2016-06-30\nprop: 0.9510133\ntitle: 10 MANDAMENTOS VITAL√çCIOS\",\"publishedAt: 2016-06-30\nprop: 0.9323908\ntitle: LIVE 'PORTA DOS FUNDOS - CONTRATO VITAL√çCIO' PR√â-ESTREIA\",\"publishedAt: 2016-07-02\nprop: 0.9656466\ntitle: MURPHY\",\"publishedAt: 2016-07-04\nprop: 0.9869079\ntitle: FARM√ÅCIA\",\"publishedAt: 2016-07-07\nprop: 0.9370491\ntitle: ZOEIRA\",\"publishedAt: 2016-07-09\nprop: 0.9789320\ntitle: HIST√âRICA\",\"publishedAt: 2016-07-11\nprop: 0.9840432\ntitle: BRINCO\",\"publishedAt: 2016-07-14\nprop: 0.9554398\ntitle: SOMMELIER\",\"publishedAt: 2016-07-16\nprop: 0.7988852\ntitle: OBRIGADO, JESUS!\",\"publishedAt: 2016-07-18\nprop: 0.9710127\ntitle: EMPR√âSTIMO\",\"publishedAt: 2016-07-21\nprop: 0.9688022\ntitle: COTIDIANO\",\"publishedAt: 2016-07-23\nprop: 0.9658221\ntitle: PRA ONTEM\",\"publishedAt: 2016-07-25\nprop: 0.9640378\ntitle: IMAGINA\",\"publishedAt: 2016-07-28\nprop: 0.8913436\ntitle: SATAN√ÅS\",\"publishedAt: 2016-07-30\nprop: 0.9822205\ntitle: ELES S√ì PENSAM NISSO\",\"publishedAt: 2016-08-01\nprop: 0.9750315\ntitle: POSTO IPIRANGA\",\"publishedAt: 2016-08-04\nprop: 0.9843413\ntitle: BELIZE\",\"publishedAt: 2016-08-06\nprop: 0.9205274\ntitle: BOA SORTE\",\"publishedAt: 2016-08-08\nprop: 0.9726150\ntitle: PONTUAL\",\"publishedAt: 2016-08-11\nprop: 0.9814773\ntitle: ANTIDOPING\",\"publishedAt: 2016-08-13\nprop: 0.9750343\ntitle: NATA√á√ÉO\",\"publishedAt: 2016-08-15\nprop: 0.9715773\ntitle: HIPISMO\",\"publishedAt: 2016-08-18\nprop: 0.9743822\ntitle: BADMINTON\",\"publishedAt: 2016-08-20\nprop: 0.9658481\ntitle: ANABOLIZANTE\",\"publishedAt: 2016-08-22\nprop: 0.9540665\ntitle: OPINI√ÉO\",\"publishedAt: 2016-08-25\nprop: 0.9792079\ntitle: RECORD\",\"publishedAt: 2016-08-27\nprop: 0.9760098\ntitle: FIM DE FESTA\",\"publishedAt: 2016-08-29\nprop: 0.9711659\ntitle: WHATSAPP\",\"publishedAt: 2016-09-01\nprop: 0.9626310\ntitle: TERRORISMO\",\"publishedAt: 2016-09-03\nprop: 0.9765473\ntitle: JAVALI\",\"publishedAt: 2016-09-05\nprop: 0.9365244\ntitle: O MUNDO T√Å CHATO\",\"publishedAt: 2016-09-08\nprop: 0.9717797\ntitle: PROGRAMA\",\"publishedAt: 2016-09-10\nprop: 0.9566926\ntitle: PERO VAZ\",\"publishedAt: 2016-09-12\nprop: 0.9809191\ntitle: BUS√ÉO\",\"publishedAt: 2016-09-15\nprop: 0.9451735\ntitle: FINESSE\",\"publishedAt: 2016-09-17\nprop: 0.9568672\ntitle: PESSOA AMADA\",\"publishedAt: 2016-09-19\nprop: 0.9621021\ntitle: DESCULPA\",\"publishedAt: 2016-09-22\nprop: 0.9711245\ntitle: MILK SHAKE\",\"publishedAt: 2016-09-24\nprop: 0.9693266\ntitle: TEATRO\",\"publishedAt: 2016-09-26\nprop: 0.9727637\ntitle: O POVO FALA\",\"publishedAt: 2016-09-29\nprop: 0.9684941\ntitle: MERCHAN\",\"publishedAt: 2016-10-01\nprop: 0.9678643\ntitle: CAMPANHA POL√çTICA\",\"publishedAt: 2016-10-03\nprop: 0.9736794\ntitle: TESTE DE ELENCO\",\"publishedAt: 2016-10-06\nprop: 0.9726361\ntitle: CPI\",\"publishedAt: 2016-10-08\nprop: 0.7304112\ntitle: C√âU CAT√ìLICO\",\"publishedAt: 2016-10-10\nprop: 0.9513702\ntitle: MAM√ÉE\",\"publishedAt: 2016-10-15\nprop: 0.9695943\ntitle: CANCELAMENTO DO PLANO\",\"publishedAt: 2016-10-17\nprop: 0.9689628\ntitle: CHAPEUZINHO\",\"publishedAt: 2016-10-20\nprop: 0.9532972\ntitle: ARTE CUBISTA\",\"publishedAt: 2016-10-22\nprop: 0.9681003\ntitle: VOC√ä SABE DO QUE EU T√î FALANDO\",\"publishedAt: 2016-10-24\nprop: 0.9831728\ntitle: PERA√ç\",\"publishedAt: 2016-10-27\nprop: 0.8208103\ntitle: MISSA\",\"publishedAt: 2016-10-29\nprop: 0.9752856\ntitle: CART√ÉO\",\"publishedAt: 2016-10-31\nprop: 0.9787373\ntitle: NULO\",\"publishedAt: 2016-11-03\nprop: 0.9526743\ntitle: V√çCIO\",\"publishedAt: 2016-11-05\nprop: 0.9576544\ntitle: ACODE\",\"publishedAt: 2016-11-07\nprop: 0.9665069\ntitle: BAGAGEM\",\"publishedAt: 2016-11-10\nprop: 0.9706998\ntitle: NOVAS MEDIDAS\",\"publishedAt: 2016-11-12\nprop: 0.9047650\ntitle: CRIA√á√ÉO\",\"publishedAt: 2016-11-14\nprop: 0.9370701\ntitle: T√ÅTICA DE VENDA\",\"publishedAt: 2016-11-17\nprop: 0.9720445\ntitle: NECESSIDADES B√ÅSICAS\",\"publishedAt: 2016-11-19\nprop: 0.9579693\ntitle: PENSADOR\",\"publishedAt: 2016-11-21\nprop: 0.9416881\ntitle: N√ÉO ACREDITO\",\"publishedAt: 2016-11-24\nprop: 0.9672652\ntitle: UMA SA√çDA PARA A CRISE\",\"publishedAt: 2016-11-26\nprop: 0.8464400\ntitle: DETALHES\",\"publishedAt: 2016-11-28\nprop: 0.9577098\ntitle: NOVO PORN√î\",\"publishedAt: 2016-12-01\nprop: 0.9698996\ntitle: FUTURO\",\"publishedAt: 2016-12-03\nprop: 0.9842416\ntitle: AMIGO SECRETO NA CADEIA\",\"publishedAt: 2016-12-05\nprop: 0.9711126\ntitle: JURA\",\"publishedAt: 2016-12-08\nprop: 0.9766966\ntitle: ODEBRECHT\",\"publishedAt: 2016-12-10\nprop: 0.9050248\ntitle: CONFERE\",\"publishedAt: 2016-12-12\nprop: 0.9824929\ntitle: APROVA√á√ÉO\",\"publishedAt: 2016-12-15\nprop: 0.9520189\ntitle: NECESSIDADES\",\"publishedAt: 2016-12-17\nprop: 0.9779182\ntitle: DISCUTINDO A RELA√á√ÉO\",\"publishedAt: 2016-12-19\nprop: 0.8939765\ntitle: REIS MAGIA\",\"publishedAt: 2016-12-22\nprop: 0.8759989\ntitle: DE ONDE V√äM OS BEB√äS\",\"publishedAt: 2016-12-24\nprop: 0.8586729\ntitle: ANIVERS√ÅRIO DE JESUS\",\"publishedAt: 2016-12-26\nprop: 0.9180588\ntitle: DISSE JESUS\",\"publishedAt: 2016-12-29\nprop: 0.9539312\ntitle: LAVA JATO\",\"publishedAt: 2017-01-02\nprop: 0.9386217\ntitle: N√ÉO POSSO TE BEIJAR\",\"publishedAt: 2017-01-05\nprop: 0.9420965\ntitle: FILA\",\"publishedAt: 2017-01-07\nprop: 0.9699175\ntitle: HATER\",\"publishedAt: 2017-01-09\nprop: 0.9680965\ntitle: DEU MERDA\",\"publishedAt: 2017-01-12\nprop: 0.9686713\ntitle: MENSAGEIRO\",\"publishedAt: 2017-01-14\nprop: 0.9637699\ntitle: INGRESSO\",\"publishedAt: 2017-01-16\nprop: 0.9816428\ntitle: HER√ìI\",\"publishedAt: 2017-01-19\nprop: 0.8896637\ntitle: MONSTRO\",\"publishedAt: 2017-01-21\nprop: 0.9791734\ntitle: DESCULPAS\",\"publishedAt: 2017-01-23\nprop: 0.9648419\ntitle: PARTO\",\"publishedAt: 2017-01-26\nprop: 0.9575237\ntitle: AMANTE NO ARM√ÅRIO\",\"publishedAt: 2017-01-28\nprop: 0.8990175\ntitle: ESCOLHIDO\",\"publishedAt: 2017-01-30\nprop: 0.9362806\ntitle: FILA DO BANHEIRO\",\"publishedAt: 2017-02-02\nprop: 0.9758430\ntitle: LISTA\",\"publishedAt: 2017-02-04\nprop: 0.9648885\ntitle: ATEN√á√ÉO\",\"publishedAt: 2017-02-06\nprop: 0.9728294\ntitle: MEME\",\"publishedAt: 2017-02-09\nprop: 0.9642205\ntitle: BARBA, CARECA E BIGODE\",\"publishedAt: 2017-02-11\nprop: 0.9749494\ntitle: EMERG√äNCIA\",\"publishedAt: 2017-02-13\nprop: 0.9625096\ntitle: PE√áA\",\"publishedAt: 2017-02-16\nprop: 0.9685476\ntitle: MINHA CASA, SUA CASA\",\"publishedAt: 2017-02-18\nprop: 0.8440829\ntitle: PADRE\",\"publishedAt: 2017-02-20\nprop: 0.9507351\ntitle: NOMES\",\"publishedAt: 2017-02-23\nprop: 0.9612586\ntitle: RECIFE\",\"publishedAt: 2017-02-25\nprop: 0.9736805\ntitle: APOCALIPSE ZUMBI\",\"publishedAt: 2017-02-27\nprop: 0.9029048\ntitle: CARLOS\",\"publishedAt: 2017-03-02\nprop: 0.9806175\ntitle: MANIFESTASHOW\",\"publishedAt: 2017-03-04\nprop: 0.9535217\ntitle: TELEMARKETING\",\"publishedAt: 2017-03-06\nprop: 0.9566112\ntitle: COMIDA INTELIGENTE\",\"publishedAt: 2017-03-09\nprop: 0.9632899\ntitle: MEUS FAVORITOS\",\"publishedAt: 2017-03-11\nprop: 0.9485738\ntitle: MINISTRA\",\"publishedAt: 2017-03-13\nprop: 0.7503779\ntitle: ESQUERDA T√öNICA\",\"publishedAt: 2017-03-16\nprop: 0.9703603\ntitle: PUNHETA\",\"publishedAt: 2017-03-18\nprop: 0.9737449\ntitle: FANTASIA\",\"publishedAt: 2017-03-20\nprop: 0.9496866\ntitle: FASHION WEEK\",\"publishedAt: 2017-03-23\nprop: 0.9815596\ntitle: FURAC√ÉO\",\"publishedAt: 2017-03-25\nprop: 0.9766316\ntitle: JAPA\",\"publishedAt: 2017-03-27\nprop: 0.9724756\ntitle: PLANO DE CARREIRA\",\"publishedAt: 2017-03-30\nprop: 0.9424731\ntitle: CABELEIREIRO\",\"publishedAt: 2017-04-01\nprop: 0.9759967\ntitle: MORTO\",\"publishedAt: 2017-04-03\nprop: 0.9398825\ntitle: PRECISO TE CONTAR UMA COISA\",\"publishedAt: 2017-04-06\nprop: 0.9595255\ntitle: LUZ AUTOM√ÅTICA\",\"publishedAt: 2017-04-08\nprop: 0.9503450\ntitle: SPOILER\",\"publishedAt: 2017-04-10\nprop: 0.9115526\ntitle: REUNI√ÉO DE AG√äNCIA\",\"publishedAt: 2017-04-13\nprop: 0.9087105\ntitle: CAETANO\",\"publishedAt: 2017-04-15\nprop: 0.8549387\ntitle: VOLTEI\",\"publishedAt: 2017-04-17\nprop: 0.9571286\ntitle: EU TE AMO\",\"publishedAt: 2017-04-20\nprop: 0.9542338\ntitle: PORTA DOS FUNDOS FOI VENDIDO\",\"publishedAt: 2017-04-22\nprop: 0.9379128\ntitle: S√ì NO BRASIL\",\"publishedAt: 2017-04-24\nprop: 0.9613562\ntitle: IDENTIDADE\",\"publishedAt: 2017-04-27\nprop: 0.9075928\ntitle: A √öLTIMA MODA\"],\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.2283105022831,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":48.9497716894977},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[15474.9,17369.1],\"tickmode\":\"array\",\"ticktext\":[\"2013\",\"2014\",\"2015\",\"2016\",\"2017\"],\"tickvals\":[15706,16071,16436,16801,17167],\"categoryorder\":\"array\",\"categoryarray\":[\"2013\",\"2014\",\"2015\",\"2016\",\"2017\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"Data de publica√ß√£o\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.37982244353945,1.02206221947429],\"tickmode\":\"array\",\"ticktext\":[\"40%\",\"60%\",\"80%\",\"100%\"],\"tickvals\":[0.4,0.6,0.8,1],\"categoryorder\":\"array\",\"categoryarray\":[\"40%\",\"60%\",\"80%\",\"100%\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.65296803652968,\"tickwidth\":0.66417600664176,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Propor√ß√£o de Likes\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"rgba(51,51,51,1)\",\"width\":0.66417600664176,\"linetype\":\"solid\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.88976377952756,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"297b24dff47a\":{\"x\":{},\"y\":{},\"label\":{},\"type\":\"scatter\"}},\"cur_data\":\"297b24dff47a\",\"visdat\":{\"297b24dff47a\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}\r\nO comportamento geral desse gr√°fico d√° a entender que nada muito importante aconteceu com a propor√ß√£o de likes dos v√≠deos do PDF: quase todo mundo que clicou em alguma das m√£ozinhas embaixo do v√≠deo terminou escolhendo um j√≥inha. Existe um ex√©rcito de excess√µes, que est√£o quase sempre relacionadas √† religi√£o, mas a estabilidade do gr√°fico j√° √© suficiente para os nossos prop√≥sitos.\n\rConclus√£o\rAs minhas an√°lises n√£o foram 100% conclusivas, mas indicam que o Porta navegava por √°guas mais ou menos tranquilas antes da aquisi√ß√£o. √â verdade que o n√∫mero de views √© bastante dif√≠cil de interpretar, mas identificamos um padr√£o esquisito no come√ßo de 2016. Sob uma certa perspectiva, pode-se dizer que os v√≠deos come√ßaram a ficar um pouco mais populares do que os seus antecessores. A propor√ß√£o de likes, por outro lado, √© um pouco mais f√°cil de interpretar: ela ficou est√°vel, ainda que o PDF costume enraivecer o seu p√∫blico de tempos em tempos.\nConsiderando essas coisas, talvez a aquisi√ß√£o n√£o seja t√£o terr√≠vel quanto parece. O Porta n√£o estava t√£o ruim e √© verdade que eles venderam apenas metade da empresa. Seguindo o prov√©rbio que diz que ‚ÄúEm time que est√° ganhando n√£o se mexe‚Äù, tudo indica que o canal do Youtube vai continuar nos mesmos moldes que vive hoje e √© poss√≠vel que as coisas que eles fa√ßam na TV fiquem razoavelmente boas. Pra finalizar, s√≥ tor√ßo para que dessa vez eles fa√ßam algo melhor do que o Show do Kibe, os programas do Danili Gentili e qualquer coisa do Hermes e Renato na TV paga.\nE que n√£o chamem o Supla pra nada.\n\r","permalink":"https://blog.curso-r.com/posts/2017-04-28-porta-dos-fundos-decadencia-revisited/","tags":["Porta dos Fundos","API","YouTube"],"title":"O Porta dos Fundos est√° em decad√™ncia? (REVISITED)"},{"author":["Julio"],"categories":["divulga√ß√£o"],"contents":"\r\rA vers√£o 3.4 do R (You Stupid Darkness) foi lan√ßada nesse final de semana! A atualiza√ß√£o tem foco principal na performance. Principais mudan√ßas:\nAgora temos um compilador JIT (Just In Time) como padr√£o! Isso significa que voc√™ n√£o precisar√° mais usar a fun√ß√£o compiler::cmpfun() para acelerar suas fun√ß√µes na maioria dos casos. Mais sobre isso abaixo.\rO for ficou mais eficiente. Agora a aloca√ß√£o din√¢mica de vetores est√° mais r√°pida, diminuindo ainda mais a diferen√ßa entre utilizar for e funcionais como sapply(), que trabalham com um vetor pr√© alocado. Mais sobre isso abaixo.\rOtimiza√ß√µes em opera√ß√µes com matrizes. N√£o vou entrar em detalhes, mas talvez voc√™s notem algumas melhorias.\rAgora o m√©todo padr√£o para ordenar vetores √© radix, o que pode aumentar a velocidade de ordena√ß√µes para vetores com mais de mil entradas.\r\rPara uma lista completa de mudan√ßas, veja esse post.\n\rFigura 1: R mais r√°pido! Imagem emprestada do time do Rcpp.\r\rMais sobre o JIT compiler\rVeja esse exemplo extra√≠do do livro Efficient R. Observe a exist√™ncia de um \u0026lt;bytecode ...\u0026gt; na parte de baixo de uma das fun√ß√µes. Isso significa que o pacote compiler converteu essa fun√ß√£o em um c√≥digo que pode ser interpretado mais r√°pido.\nmean_r = function(x) {\rm = 0\rn = length(x)\rfor(i in seq_len(n))\rm = m + x[i] / n\rm\r}\rcmp_mean_r \u0026lt;- compiler::cmpfun(mean_r)\rmean_r\r## function(x) {\r## m = 0\r## n = length(x)\r## for(i in seq_len(n))\r## m = m + x[i] / n\r## m\r## }\rcmp_mean_r\r## function(x) {\r## m = 0\r## n = length(x)\r## for(i in seq_len(n))\r## m = m + x[i] / n\r## m\r## }\r## \u0026lt;bytecode: 0x7fb86252dfd8\u0026gt;\rPara mostrar a mudan√ßa, vamos comparar o desempenho das fun√ß√µes usando microbenchmark(). Essa fun√ß√£o calcula o tempo de execu√ß√£o de uma express√£o cem vezes e calcula estat√≠sticas b√°sicas dos tempos obtidos.\nNo meu servidor, que ainda est√° com o R 3.3.2, o resultado foi esse. Observe que o tempo da fun√ß√£o compilada √© quase dez vezes o tempo da fun√ß√£o sem compilar.\nset.seed(1)\rx \u0026lt;- rnorm(5000)\rmicrobenchmark::microbenchmark(mean_r(x), cmp_mean_r(x), mean(x))\r# Unit: microseconds\r# expr min lq mean median uq max neval\r# mean_r(x) 1931.835 2010.295 2302.82298 2102.5995 2357.6715 6186.706 100\r# cmp_mean_r(x) 308.847 311.045 333.26221 314.8935 334.7330 569.117 100\r# mean(x) 14.593 15.443 19.94897 19.0410 21.0405 51.375 100\rNo meu computador com o R 3.4, o resultado foi esse. Agora, a diferen√ßa entre a fun√ß√£o sem compilar e compilada √© praticamente impoercept√≠vel. Esse √© o efeito do JIT compiler.\nset.seed(1)\rx \u0026lt;- rnorm(5000)\rmicrobenchmark::microbenchmark(mean_r(x), cmp_mean_r(x), mean(x))\r# Unit: microseconds\r# expr min lq mean median uq max neval\r# mean_r(x) 332.322 332.7220 336.2287 333.0125 334.3785 395.954 100\r# cmp_mean_r(x) 332.305 332.7345 337.0889 333.1460 337.0930 381.306 100\r# mean(x) 13.807 14.0960 14.7349 14.3060 14.5540 30.313 100\r\rMais sobre o for\rVeja esse c√≥digo que calcula a m√©dia de mil valores em 100 entradas de uma lista.\nset.seed(1)\rinput \u0026lt;- lapply(1:100, function(x) runif(1000))\rmean_for \u0026lt;- function(x) {\rvet \u0026lt;- c()\rfor(i in seq_along(x)) {\rvet[i] \u0026lt;- mean(x[[i]])\r}\r}\rmean_sapply \u0026lt;- function(x) {\rsapply(x, mean)\r}\rNo meu servidor, que ainda est√° com o R 3.3.2, o resultado foi esse. Veja como o desempenho do for √© assustadoramente inferior.\nmicrobenchmark::microbenchmark(mean_for(x), mean_sapply(x))\r# Unit: milliseconds\r# expr min lq mean median uq max neval\r# mean_for(x) 41.28675 43.22318 47.39574 44.02713 45.59184 84.80818 100\r# mean_sapply(x) 14.78590 15.46421 16.36619 16.23018 17.28495 19.70854 100\rNo meu computador com o R 3.4, o resultado foi esse. Agora o for est√° praticamente empatado!\nmicrobenchmark::microbenchmark(mean_for(x), mean_sapply(x))\r# Unit: milliseconds\r# expr min lq mean median uq max neval\r# mean_for(x) 15.16583 15.45924 16.71064 16.14545 17.51002 25.61860 100\r# mean_sapply(x) 14.43704 14.90485 16.20864 15.53319 16.56801 27.36536 100 \rMas cuidado! o for continua sendo uma ideia ruim no R, n√£o s√≥ por desempenho, mas por quest√µes de design. Utilizar funcionais ajuda na performance do computador e torna a vida do cientista de dados mais f√°cil (veja esse e esse posts que discutem um pouco sobre isso.)\nInstala√ß√£o\rSe voc√™ usa Windows, uma dica √© usar o pacote installr. Basta rodar isso aqui e ser feliz:\ninstall.packages(\u0026quot;installr\u0026quot;)\rinstallr::updateR()\r√â isso! Happy coding ;)\nOBS: Se voc√™ ficou curiosa sobre o nome da vers√£o, encontrei essa tirinha de 1965 do Peanuts. Acho que foi isso que deu origem ao nome!\n\rFigura 2: You Stupid Darknes! http://www.gocomics.com/peanuts/1965/09/09.\r\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-04-24-r34/","tags":["update"],"title":"R 3.4 dispon√≠vel!"},{"author":["Daniel"],"categories":["an√°lises"],"contents":"\rUma aplica√ß√£o interessante de algoritmos de clusteriza√ß√£o √© a obten√ß√£o de\rpaletas de cores a partir de imagens. Veja como isso pode ser feito usando\ro R.\nEm primeiro lugar, vamos ler a imagem como uma matriz para o R.\rExistem diversas bibliotecas para carregar as imagens, vamos usar aqui\ra jpeg. Para esse caso ela\r√© melhor porque j√° l√™ a imagem no formato que precisamos.\nlibrary(jpeg)\rlibrary(magrittr)\rimg \u0026lt;- readJPEG(\u0026quot;img/david-bowie.jpg\u0026quot;)\rA imagem lida pelo pacote jpeg √© representada por um array com dimens√µes:\rc(altura, largura, n_bandas) que no nosso caso √© c(1100, 727, 3). O n√∫mero de bandas √© 3: R, G e B.\nPodemos exibir a imagem no R, convertendo o array, primeiro em um obheto do tipo\rraster e depois simplesmente usando a fun√ß√£o plot.\nplot(as.raster(img))\rO problema de obter a paleta de cores de uma imagem pode ser formulado como um\rproblema de clusteriza√ß√£o: ‚Äúobter grupos de individuos que possuem a menor diferen√ßa dentro de cada um e a maior diferen√ßa poss√≠vel entre os grupos de\racordo com algumas caracter√≠sticas das unidades amostrais‚Äù.\nNesse caso, os indiv√≠duos s√£o os pixels da imagem e as caracter√≠sticas que\restamos interessados s√£o os valores de R, de G e de B (valores que representam a\rcor do pixel). Para o algortimos de\rclusteriza√ß√£o, precisamos de uma matriz com as 3 colunas R, G e B e largura*altura (numero de pixels) linhas representado os indiv√≠duos. √â exatamente essa convers√£o\rque o trecho de c√≥digo a seguir realiza.\nimg_matrix \u0026lt;- apply(img, 3, as.numeric)\rAgora temos uma matriz com 3 colunas e 799.700 linhas.\rVamos aplicar agora o algoritmo k-means, para organizar cada um desses pixels em\rum grupo. O K-means pede o n√∫mero de grupos como input, vamos come√ßar\rcom 6.\nkm \u0026lt;- kmeans(img_matrix, centers = 6)\rO objeto gerado pela fun√ß√£o kmeans armazena\rum vetor chamado cluster (do tamanho do n√∫mero de linhas da matriz) com um\ridentificador do grupo de cada observa√ß√£o da matriz.\nA cor que representa cada um dos grupos √© representada pelo vetor\rc(r, g, b) com a m√©dia de todas as observa√ß√µes de cada um dos grupos.\rPodemos obter isso com algumas manipula√ß√µes usando o dplyr.\nlibrary(tibble)\rlibrary(dplyr)\rimg_df \u0026lt;- tibble(\rr = img_matrix[,1],\rg = img_matrix[,2],\rb = img_matrix[,3],\rcluster = km$cluster\r)\rcentroides \u0026lt;- img_df %\u0026gt;%\rgroup_by(cluster) %\u0026gt;%\rsummarise_all(mean)\rcentroides\r## # A tibble: 6 √ó 4\r## cluster r g b\r## \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 1 0.221 0.273 0.441\r## 2 2 0.501 0.183 0.159\r## 3 3 0.877 0.762 0.645\r## 4 4 0.702 0.467 0.324\r## 5 5 0.354 0.462 0.549\r## 6 6 0.124 0.0433 0.216\rTamb√©m transformamos uma cor r, g e b em uma representa√ß√£o hexadecimal.\rAssim conseguimos um vetor de caracteres que representa a a paleta de cores.\ncentroides \u0026lt;- centroides %\u0026gt;%\rmutate(cor = rgb(r, g, b))\rcentroides$cor\r## [1] \u0026quot;#384670\u0026quot; \u0026quot;#802F28\u0026quot; \u0026quot;#E0C2A5\u0026quot; \u0026quot;#B37753\u0026quot; \u0026quot;#5A768C\u0026quot; \u0026quot;#200B37\u0026quot;\rPara exibir a paleta vamos usar a seguinte fun√ß√£o que foi copiada\re levemente modificada daqui\nexibir \u0026lt;- function(x) {\rn \u0026lt;- length(x)\rold \u0026lt;- par(mar = c(0.5, 0.5, 0.5, 0.5))\ron.exit(par(old))\rimage(1:n, 1, as.matrix(1:n), col = x,\rylab = \u0026quot;\u0026quot;, xaxt = \u0026quot;n\u0026quot;, yaxt = \u0026quot;n\u0026quot;, bty = \u0026quot;n\u0026quot;)\r}\rexibir(sort(centroides$cor))\rAssim obtivemos uma paleta de cores da imagem que mostramos anteriormente.\rVamos colocar todo o c√≥digo que fizemos passo a passo aqui em uma √∫nica fun√ß√£o para podermos facilmente criar a paleta de cores para outras imagens.\ncriar_paleta \u0026lt;- function(img, num_cores){\r# transforma a imagem em uma matriz\rimg_matrix \u0026lt;- apply(img, 3, as.numeric)\r# treina o algoritmo de k m√©dias\rkm \u0026lt;- kmeans(img_matrix, centers = num_cores)\rimg_df \u0026lt;- tibble(\rr = img_matrix[,1],\rg = img_matrix[,2],\rb = img_matrix[,3],\rcluster = km$cluster\r)\r# calcula os centroides dos grupos\rcentroides \u0026lt;- img_df %\u0026gt;%\rgroup_by(cluster) %\u0026gt;%\rsummarise_all(mean)\r# transforma a cor em hexadecimal\rcentroides \u0026lt;- centroides %\u0026gt;%\rmutate(cor = rgb(r, g, b))\r# vetor de cores\rsort(centroides$cor)\r}\rVejamos agora o que acontece com essa bela imagem do filme Moonrise Kingdom do\rWes Anderson, que √© famoso por fazer filmes com belas paletas de cores.\nmoonrise \u0026lt;- readJPEG(\u0026quot;img/moonrise-kingdom.jpg\u0026quot;)\rplot(as.raster(moonrise))\rpaleta \u0026lt;- criar_paleta(moonrise, 6)\rexibir(paleta)\r√â isso. Se voc√™ gostou, tente fazer com outras imagens e compartilhe com a gente os resultados.\n","permalink":"https://blog.curso-r.com/posts/2017-04-21-paleta-de-cores/","tags":["imagens","cluster","kmeans"],"title":"K-means e paleta de cores"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rTratar erros no R √© importante para identificar problemas nos c√≥digos e evitar retrabalho. Quem nunca rodou um algoritmo pesad√≠ssimo que deu errado na √∫ltima itera√ß√£o? Nesse artigo, veremos como trabalhar com erros no R e a vers√£o tidy dessas solu√ß√µes.\nUsando try() e tryCatch()\rA forma tradicional de tratar erros no R √© com a fun√ß√£o tryCatch(). Essa fun√ß√£o tem como primeiro argumento uma express√£o a ser avaliada e argumentos diversos para trabalhar com os erros. A vers√£o mais compacta do tryCatch() √© escrita assim:\ntryCatch(sqrt(1), error = function(e) e)\r## [1] 1\rtryCatch(sqrt(\u0026#39;a\u0026#39;), error = function(e) e)\r## \u0026lt;simpleError in sqrt(\u0026quot;a\u0026quot;): non-numeric argument to mathematical function\u0026gt;\rO try() √© uma simplifica√ß√£o de tryCatch() que assume que n√£o estamos interessados no erro, mas sim no resultado da fun√ß√£o quando ela d√° certo. O c√≥digo abaixo n√£o trava:\ntry(sqrt(1))\r## [1] 1\rtry(sqrt(\u0026#39;a\u0026#39;))\r## Error in sqrt(\u0026quot;a\u0026quot;) : non-numeric argument to mathematical function\r## Error in sqrt(\u0026quot;a\u0026quot;) : non-numeric argument to mathematical function\rExiste at√© mesmo uma vers√£o quieta do try(), usando o par√¢metro silent =. Quando a express√£o d√° um erro, o try() retorna a mensagem de erro de forma invis√≠vel, ou seja, sem mostrar explicitamente para o usu√°rio.\nx \u0026lt;- try(sqrt(\u0026#39;a\u0026#39;), silent = TRUE)\rx\r## [1] \u0026quot;Error in sqrt(\\\u0026quot;a\\\u0026quot;) : non-numeric argument to mathematical function\\n\u0026quot;\r## attr(,\u0026quot;class\u0026quot;)\r## [1] \u0026quot;try-error\u0026quot;\r## attr(,\u0026quot;condition\u0026quot;)\r## \u0026lt;simpleError in sqrt(\u0026quot;a\u0026quot;): non-numeric argument to mathematical function\u0026gt;\r\rUsando adv√©rbios do purrr\rHoje em dia, o jeito mais arrumado de tratar erros √© usando as fun√ß√µes purrr::possibly() e suas amigas, quietly() e safely(). Note que todas essas palavras s√£o adv√©rbios: o objetivo delas √© alterar o comportamento de outros verbos (outras fun√ß√µes). Essa forma de pensar nos nomes das fun√ß√µes (fun√ß√µes s√£o verbos, modificadores de fun√ß√µes s√£o adv√©rbios) faz parte do princ√≠pio tidy.\n\rsafely() retorna uma lista com elementos result e error. Quando a fun√ß√£o n√£o d√° erro, error fica igual a NULL. Quando a fun√ß√£o d√° erro, error guarda a mensagem de erro e result guarda o valor do par√¢metro otherwise =, que por padr√£o √© NULL.\rpossibly() √© uma vers√£o mais otimista do safely(), que exige a defini√ß√£o de otherwise = e n√£o guarda as mensagens de erro.\rquietly() n√£o trata erros (ou seja, ela trava quando d√° erro), mas guarda informa√ß√µes sobre warnings e messages.\r\r\rFigura 1: Admita, voc√™ n√£o imaginava que teria de pensar em gram√°tica para programar em R.\r\rVamos ver as tr√™s fun√ß√µes colocadas em pr√°tica. Como exemplo usaremos a fun√ß√£o log, que i) retorna um n√∫mero quando a entrada √© um n√∫mero positivo, ii) d√° um warning quando a entrada √© um n√∫mero menor ou igual a zero, e iii) d√° um erro se a entrada n√£o √© um n√∫mero.\nlog(10)\r## [1] 2.302585\rlog(-1)\r## Warning in log(-1): NaNs produced\r## [1] NaN\rlog(\u0026#39;a\u0026#39;)\r## Error in log(\u0026quot;a\u0026quot;): non-numeric argument to mathematical function\rVamos fazer as vers√µes modificadas de log:\nlibrary(purrr)\rsafe_log \u0026lt;- safely(log) # outra forma fancy de escrever isso: log %\u0026gt;% safely()\rpossible_log \u0026lt;- possibly(log, otherwise = \u0026#39;putz\u0026#39;)\rquiet_log \u0026lt;- quietly(log)\rVamos mapear os seguintes elementos nessas fun√ß√µes:\nentradas \u0026lt;- list(10, -1, \u0026#39;a\u0026#39;)\rAgora, os resultados:\n## Esse c√≥digo vai travar\rmap(entradas, log)\r## Warning in .Primitive(\u0026quot;log\u0026quot;)(x, base): NaNs produced\r## Error in .Primitive(\u0026quot;log\u0026quot;)(x, base): non-numeric argument to mathematical function\r\rsafely():\r\r## Retorna uma lista com erros e resultados NULL\rmap(entradas, safe_log)\r## Warning in .Primitive(\u0026quot;log\u0026quot;)(x, base): NaNs produced\r## [[1]]\r## [[1]]$result\r## [1] 2.302585\r## ## [[1]]$error\r## NULL\r## ## ## [[2]]\r## [[2]]$result\r## [1] NaN\r## ## [[2]]$error\r## NULL\r## ## ## [[3]]\r## [[3]]$result\r## NULL\r## ## [[3]]$error\r## \u0026lt;simpleError in .Primitive(\u0026quot;log\u0026quot;)(x, base): non-numeric argument to mathematical function\u0026gt;\r\rpossibly():\r\r## Retorna uma lista com os resultados que deram certo\rmap(entradas, possible_log)\r## Warning in .Primitive(\u0026quot;log\u0026quot;)(x, base): NaNs produced\r## [[1]]\r## [1] 2.302585\r## ## [[2]]\r## [1] NaN\r## ## [[3]]\r## [1] \u0026quot;putz\u0026quot;\r\rquietly():\r\r## Tamb√©m trava, mesmo problema de log\rmap(entradas, quiet_log)\r## Error in .Primitive(\u0026quot;log\u0026quot;)(x, base): non-numeric argument to mathematical function\r## Quando funciona, retorna todos os warnings e messages\rmap(entradas[1:2], quiet_log)\r## [[1]]\r## [[1]]$result\r## [1] 2.302585\r## ## [[1]]$output\r## [1] \u0026quot;\u0026quot;\r## ## [[1]]$warnings\r## character(0)\r## ## [[1]]$messages\r## character(0)\r## ## ## [[2]]\r## [[2]]$result\r## [1] NaN\r## ## [[2]]$output\r## [1] \u0026quot;\u0026quot;\r## ## [[2]]$warnings\r## [1] \u0026quot;NaNs produced\u0026quot;\r## ## [[2]]$messages\r## character(0)\r\rCombo com purrr e tibble\rUm combo que eu gosto bastante de usar √© adicionar erros do c√≥digo retornado por safely() dentro de uma tibble. Uma forma de fazer isso √© com o c√≥digo abaixo:\nlibrary(tibble)\r# adiciona um resultado default caso d√™ erro. No caso, NA.\rsafe_log2 \u0026lt;- log %\u0026gt;% safely(otherwise = NA_real_)\rd_result \u0026lt;- entradas %\u0026gt;%\rmap(safe_log2) %\u0026gt;%\r# ao inv√©s de uma lista de tamanho 3 com 2 elementos (result e error),\r# temos uma lista de tamanho 2 (result e error) com 3 elementos.\rtranspose() %\u0026gt;%\r# simplifica o vetor de resultados\rsimplify_all() %\u0026gt;%\r# converte para data frame\ras_tibble()\rd_result\r## # A tibble: 3 √ó 2\r## result error ## \u0026lt;dbl\u0026gt; \u0026lt;list\u0026gt; ## 1 2.30 \u0026lt;NULL\u0026gt; ## 2 NaN \u0026lt;NULL\u0026gt; ## 3 NA \u0026lt;smplErrr\u0026gt;\rAssim, √© poss√≠vel guardar as informa√ß√µes dos erros de forma concisa, sem perder a informa√ß√£o dos erros.\nE √© isso. Happy coding ;)\nPS: At√© pouco tempo atr√°s eu usava a fun√ß√£o dplyr::failwith() para fazer o mesmo que possibly(). Por√©m, descobri que essa fun√ß√£o ser√° retirada do dplyr no futuro. Ent√£o se voc√™ √© um usu√°rio de failwith(), est√° na hora de mudar!\n\r","permalink":"https://blog.curso-r.com/posts/2017-04-09-try/","tags":["coding","pacotes","purrr"],"title":"Tratando erros: the tidy way"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rUma tarefa muito comum no R √© colar textos. As fun√ß√µes mais importantes para isso s√£o paste() e sprintf(), que v√™m com o pacote base. Nesse artigo, vamos falar dessas duas fun√ß√µes e de um novo pacote do tidyverse, o glue.\npaste()\rA fun√ß√£o paste() recebe um conjunto indeterminado de objetos como argumento atrav√©s do ... e vai colando os objetos passados elemento a elemento. Isso significa que se voc√™ passar dois vetores de tamanho n, a fun√ß√£o paste() retornar√° um vetor de tamanho n sendo cada posi√ß√£o a colagem dos dois vetores nessa posi√ß√£o. Por padr√£o, a colagem √© feita com um separador de espa√ßo simples (\" \"). Exemplo:\npaste(c(1, 2, 3), c(4, 5, 6))\r## [1] \u0026quot;1 4\u0026quot; \u0026quot;2 5\u0026quot; \u0026quot;3 6\u0026quot;\r√â poss√≠vel alterar o separador pelo argumento sep =. Um atalho √∫til para o separador vazio (\"\") √© a fun√ß√£o paste0:\npaste0(c(1, 2, 3), c(4, 5, 6))\r## [1] \u0026quot;14\u0026quot; \u0026quot;25\u0026quot; \u0026quot;36\u0026quot;\rAlgumas vezes nosso interesse n√£o √© juntar vetores elemento a elemento, mas sim passar um vetor e colar todos seus elementos. Isso √© feito com o par√¢metro collapse =:\npaste(c(1, 2, 3, 4, 5, 6), collapse = \u0026#39;@\u0026#39;)\r## [1] \u0026quot;1@2@3@4@5@6\u0026quot;\rSe voc√™ passar mais de um vetor e mandar colapsar os elementos, o paste() vai primeiro colar e depois colapsar:\npaste(c(1, 2, 3), c(4, 5, 6), collapse = \u0026#39;@\u0026#39;)\r## [1] \u0026quot;1 4@2 5@3 6\u0026quot;\rCuidado\rTenha muito cuidado ao passar vetores com comprimentos diferentes no paste()! Assim como muitas fun√ß√µes do R, o paste() faz reciclagem, ou seja, ele copia os elementos do menor vetor at√© ele ficar com o comprimento do maior vetor1. O problema √© que o paste() faz isso silenciosamente e n√£o avisa se voc√™ inserir um vetor com comprimento que n√£o √© m√∫ltiplo dos demais. Veja que resultado bizarro:\npaste(5:9, 1:3, 4:5)\r## [1] \u0026quot;5 1 4\u0026quot; \u0026quot;6 2 5\u0026quot; \u0026quot;7 3 4\u0026quot; \u0026quot;8 1 5\u0026quot; \u0026quot;9 2 4\u0026quot;\rPor essas e outras que dizemos que √†s vezes o R funciona bem demais‚Ä¶\n\r\rsprintf()\rO sprintf() √© similar ao printf do C. Primeiro escrevemos um texto com %s no lugar das coisas que queremos substituir. Depois colocamos esses objetos nos outros argumentos da fun√ß√£o, na ordem em que eles aparecem no texto.\nsprintf(\u0026#39;Aba%ste\u0026#39;, \u0026#39;ca\u0026#39;)\r## [1] \u0026quot;Abacate\u0026quot;\rQuando o argumento √© um vetor, a fun√ß√£o retorna um vetor com as substitui√ß√µes ponto a ponto.\nsprintf(\u0026#39;Aba%ste\u0026#39;, c(\u0026#39;ca\u0026#39;, \u0026#39;ixas\u0026#39;))\r## [1] \u0026quot;Abacate\u0026quot; \u0026quot;Abaixaste\u0026quot;\rSe o texto cont√©m mais de um %s e os objetos correspondentes s√£o vetores, o sprintf() tenta reciclar os vetores para ficarem do mesmo tamanho. Isso s√≥ funciona quando todos os objetos t√™m comprimentos que s√£o m√∫ltiplos do comprimento do maior objeto.\nIsso funciona:\nsprintf(\u0026#39;Aba%s%s\u0026#39;, c(\u0026#39;ca\u0026#39;), c(\u0026#39;xi\u0026#39;, \u0026#39;te\u0026#39;)) # ca foi reciclado\r## [1] \u0026quot;Abacaxi\u0026quot; \u0026quot;Abacate\u0026quot;\rIsso n√£o funciona:\nsprintf(\u0026#39;Aba%s%s\u0026#39;, c(\u0026#39;ca\u0026#39;, \u0026#39;ixaste\u0026#39;), c(\u0026#39;xi\u0026#39;, \u0026#39;te\u0026#39;, \u0026#39;.\u0026#39;))\r## Error in sprintf(\u0026quot;Aba%s%s\u0026quot;, c(\u0026quot;ca\u0026quot;, \u0026quot;ixaste\u0026quot;), c(\u0026quot;xi\u0026quot;, \u0026quot;te\u0026quot;, \u0026quot;.\u0026quot;)): arguments cannot be recycled to the same length\rNem sempre queremos substituir peda√ßos do nosso texto por outros textos. No lugar do %s, √© poss√≠vel colocar padr√µes para n√∫meros, por exemplo. Eu uso bastante o %d, que recebe inteiros. Uma funcionalidade legal do %d √© a possibilidade de adicionar zeros √† esquerda quando um n√∫mero n√£o atinge certa quantidade de d√≠gitos. Assim, quando ordenamos um vetor de textos que come√ßa com n√∫meros, a ordena√ß√£o √© a mesma da vers√£o num√©rica do vetor.\nExemplo:\nnums \u0026lt;- 1:11\rsort(as.character(nums)) # ordenado pela string: 10 vem antes de 2\r## [1] \u0026quot;1\u0026quot; \u0026quot;10\u0026quot; \u0026quot;11\u0026quot; \u0026quot;2\u0026quot; \u0026quot;3\u0026quot; \u0026quot;4\u0026quot; \u0026quot;5\u0026quot; \u0026quot;6\u0026quot; \u0026quot;7\u0026quot; \u0026quot;8\u0026quot; \u0026quot;9\u0026quot;\rsort(sprintf(\u0026#39;%02d\u0026#39;, nums)) # ordenado pela string: 02 vem antes de 10\r## [1] \u0026quot;01\u0026quot; \u0026quot;02\u0026quot; \u0026quot;03\u0026quot; \u0026quot;04\u0026quot; \u0026quot;05\u0026quot; \u0026quot;06\u0026quot; \u0026quot;07\u0026quot; \u0026quot;08\u0026quot; \u0026quot;09\u0026quot; \u0026quot;10\u0026quot; \u0026quot;11\u0026quot;\r\rglue\rO glue √© um pacote recente. Sua primeira apari√ß√£o no GitHub foi em 23/12/2016! Isso significa que √© prov√°vel que algumas coisas mudem, mas isso n√£o nos impede de aproveitar o que a ferramenta tem de bom.\nA fun√ß√£o glue() √© uma generaliza√ß√£o do sprintf() que permite chamar objetos do R diretamente ao inv√©s de utilizar o %s. Os objetos podem estar no global environment ou descritos por meio de objetos nomeados nos argumentos do glue(). Basta inserir os objetos entre chaves {}:\nlibrary(glue)\rplaneta \u0026lt;- \u0026#39;mundo\u0026#39;\rglue(\u0026#39;Ol√° {planeta} pela {y}a vez\u0026#39;, y = 1)\r## Ol√° mundo pela 1a vez\rTemb√©m √© poss√≠vel adicionar express√µes dentro das chaves:\np \u0026lt;- 1.123123123\rglue(\u0026#39;{p * 100}% das pessoas adoram R.\u0026#39;)\r## 112.3123123% das pessoas adoram R.\rglue(\u0026#39;{scales::percent(p)} das pessoas adoram R.\u0026#39;)\r## 112% das pessoas adoram R.\rA fun√ß√£o glue_collapse() √© parecida com o paste() quando collapse = '', mas s√≥ aceita um objeto como entrada:\nx \u0026lt;- glue_collapse(1:10)\rx\r## 12345678910\rall.equal(x, paste(1:10, collapse = \u0026#39;\u0026#39;))\r## [1] \u0026quot;Attributes: \u0026lt; Modes: list, NULL \u0026gt;\u0026quot; ## [2] \u0026quot;Attributes: \u0026lt; Lengths: 1, 0 \u0026gt;\u0026quot; ## [3] \u0026quot;Attributes: \u0026lt; names for target but not for current \u0026gt;\u0026quot;\r## [4] \u0026quot;Attributes: \u0026lt; current is not list-like \u0026gt;\u0026quot; ## [5] \u0026quot;target is glue, current is character\u0026quot;\rSe quiser colar os objetos elemento a elemento e depois colapsar, fa√ßa isso explicitamente em duas opera√ß√µes:\nglue(\u0026#39;{letters}/{LETTERS}\u0026#39;) %\u0026gt;%\rglue_collapse(\u0026#39;, \u0026#39;)\r## a/A, b/B, c/C, d/D, e/E, f/F, g/G, h/H, i/I, j/J, k/K, l/L, m/M, n/N, o/O, p/P, q/Q, r/R, s/S, t/T, u/U, v/V, w/W, x/X, y/Y, z/Z\rO glue tamb√©m tem uma fun√ß√£o extra para trabalhar melhor com o %\u0026gt;%, o glue_data(). O primeiro argumento dessa fun√ß√£o √© uma lista ou data.frame, e seus nomes s√£o utilizados como vari√°veis para alimentar as chaves das strings. Use o . para fazer opera√ß√µes com toda a base de dados:\nmtcars %\u0026gt;%\rhead() %\u0026gt;%\rglue_data(\u0026#39;O carro {row.names(.)} rende {mpg} milhas por gal√£o.\u0026#39;)\r## O carro Mazda RX4 rende 21 milhas por gal√£o.\r## O carro Mazda RX4 Wag rende 21 milhas por gal√£o.\r## O carro Datsun 710 rende 22.8 milhas por gal√£o.\r## O carro Hornet 4 Drive rende 21.4 milhas por gal√£o.\r## O carro Hornet Sportabout rende 18.7 milhas por gal√£o.\r## O carro Valiant rende 18.1 milhas por gal√£o.\r\rResumo\r\rUse paste() para colar ou colapsar elementos usando um separador fixado.\rUse sprintf() quando quiser colocar objetos dentro de um texto complexo.\rEm todos os casos existe uma solu√ß√£o usando glue.\r\rAtualmente sempre que tenho um problema desse tipo uso o glue. At√© o momento, n√£o encontrei nenhum problema ou dificuldade. A vida do cientista de dados √© mais feliz no tidyverse!\n√â isso. Happy coding ;)\n\rExtra:\rO Guilherme Jardim Duarte fez uma √≥tima sugest√£o logo ap√≥s a publica√ß√£o deste artigo. No pacote stringi existe um operador %s+% que cola textos iterativamente, com uma sintaxe similar √† linguagem python, que permite a colagem de textos usando um simples +. Exemplo:\nlibrary(stringi)\r\u0026#39;a\u0026#39; %s+%\r\u0026#39;ba\u0026#39; %s+%\r\u0026#39;ca\u0026#39; %s+%\r\u0026#39;xi\u0026#39;\r## [1] \u0026quot;abacaxi\u0026quot;\rVoc√™ pode adicionar esse operador como um atalho no RStudio, an√°logo ao Ctrl+Shift+M que usamos para escrever o %\u0026gt;%. Para isso, veja esse tutorial sobre RStudio Addins.\n\r\rMais sobre isso no livro R inferno‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-04-08-glue/","tags":["strings","pacotes","glue"],"title":"Colando textos"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rNa jornada da ci√™ncia de dados, muitas vezes precisamos rodar um mesmo algoritmo em v√°rios objetos distintos. Quando o algoritmo √© pesado ou a lista de objetos √© longa, √© importante saber em que passo estamos e quanto vai demorar para terminar.\nUma forma de resolver esse problema √© usando o pacote progress. O objeto progress_bar desse pacote √© do tipo R6 e tem um m√©todo new() para criar objetos do tipo ‚Äúbarra‚Äù. Uma barra criada tamb√©m √© do tipo R6 e possui o m√©todo tick() para imprimir uma barra de progresso no console.\nNo exemplo abaixo, nosso interesse √© aplicar a fun√ß√£o funcao_demorada nos n√∫meros 1:5 (um de cada vez, sem usar vetoriza√ß√£o) e guard√°-los numa lista.\nfuncao_demorada \u0026lt;- function(x) {\rSys.sleep(0.5)\rx ^ 2\r}\rnums \u0026lt;- 1:5\rPodemos fazer isso usando o pacote progress:\nbarra \u0026lt;- progress::progress_bar$new(total = length(nums)) # cria a barra\rresultados \u0026lt;- list()\rfor (x in nums) {\rbarra$tick() # d√° um passo\rresultados[[x]] \u0026lt;- funcao_demorada(x)\r}\rTRUE [===========================\u0026gt;-------------------------------------------] 40%\rTRUE [==========================================\u0026gt;----------------------------] 60%\rTRUE [========================================================\u0026gt;--------------] 80%\rTRUE [=======================================================================] 100%\rComo resultados, temos:\nresultados\r## [[1]]\r## [1] 1\r## ## [[2]]\r## [1] 4\r## ## [[3]]\r## [1] 9\r## ## [[4]]\r## [1] 16\r## ## [[5]]\r## [1] 25\rNo entanto, sabemos que os la√ßos for e while do R s√£o problem√°ticos. A melhor e mais estilosa forma de fazer esse tipo de opera√ß√£o no R √© usando funcionais.\nFuncionais s√£o fun√ß√µes de fun√ß√µes. Usamos esses caras sempre que queremos aplicar uma fun√ß√£o a diversos objetos. Eles s√£o alternativas mais concisas, elegantes e muitas vezes mais eficientes do que os conhecidos for e while.\nExemplos de funcionais s√£o os objetos da fam√≠lia **ply (lapply, apply, sapply etc.) Os funcionais do R b√°sico foram generalizados no pacote plyr, que apresenta uma sintaxe organizada e intuitiva.\nUma vantagem do plyr √© a possibilidade de adicionar barras de progresso como um par√¢metro dos funcionais.\nresultados \u0026lt;- plyr::llply(nums, funcao_demorada, .progress = \u0026#39;text\u0026#39;)\r## | | | 0%\r| |============== | 20%\r| |============================ | 40%\r| |========================================== | 60%\r| |======================================================== | 80%\r| |======================================================================| 100%\rOs resultados s√£o id√™nticos e foram omitidos. Bem mais simples, n√£o?\nUsando purr::map no lugar de plyr::llply\rRecentemente, boa parte das fun√ß√µes do plyr foram substitu√≠das por alternativas nos pacotes dplyr (opera√ß√µes envolvendo data.frames) e purrr (opera√ß√µes envolvendo vetores e listas). Esses pacotes apresentam uma sintaxe mais pr√≥xima da filosofia tidy e portanto faz sentido estud√°-los!\nInfelizmente, as fun√ß√µes do purrr ainda1 n√£o t√™m um par√¢metro para barras de progresso. Enquanto isso, podemos utilizar o progress::progress_bar mesmo.\nbarra \u0026lt;- progress::progress_bar$new(total = length(nums))\rresultados \u0026lt;- purrr::map(nums, ~{\rbarra$tick()\rfuncao_demorada(.x)\r})\rTRUE [===========================\u0026gt;-------------------------------------------] 40%\rTRUE [==========================================\u0026gt;----------------------------] 60%\rTRUE [========================================================\u0026gt;--------------] 80%\rTRUE [=======================================================================] 100%\rO c√≥digo fica parecido com solu√ß√£o usando for(), mas pelo menos estamos usando os pacotes mais recentes ;)\n\rEfici√™ncia\rAs solu√ß√µes que mostrei acima apresentam diferen√ßas importantes de efici√™ncia. Abaixo, encapsulei os c√≥digos em fun√ß√µes e mudei levemente a opera√ß√£o que queremos fazer:\nnums \u0026lt;- 1:100\rfuncao_rapida \u0026lt;- function(x) {\rx ^ 2\r}\rfor(), com e sem progresso:\nfor_com \u0026lt;- function(nums) {\rbarra \u0026lt;- progress::progress_bar$new(total = length(nums))\rresultados \u0026lt;- list()\rfor(x in nums) {\rbarra$tick()\rresultados[[x]] \u0026lt;- funcao_rapida(x)\r}\rresultados\r}\rfor_sem \u0026lt;- function(nums) {\rresultados \u0026lt;- list()\rfor(x in nums) resultados[[x]] \u0026lt;- funcao_rapida(x)\rresultados\r}\rplyr::llply(), com e sem progresso:\nplyr_com \u0026lt;- function(nums) {\rplyr::llply(nums, funcao_rapida, .progress = \u0026#39;text\u0026#39;)\r}\rplyr_sem \u0026lt;- function(nums) {\rplyr::llply(nums, funcao_rapida)\r}\rpurrr::map(), com e sem progresso:\npurrr_com \u0026lt;- function(nums) {\rbarra \u0026lt;- progress::progress_bar$new(total = length(nums))\rpurrr::map(nums, ~{\rbarra$tick()\rfuncao_rapida(.x)\r})\r}\rpurrr_sem \u0026lt;- function(nums) {\rpurrr::map(nums, funcao_rapida)\r}\rPara testar a efici√™ncia dos algoritmos, utilizamos a fun√ß√£o microbenchmark::microbenchmark(). Essa fun√ß√£o calcula o tempo de execu√ß√£o do algoritmo cem vezes e obt√©m algumas estat√≠sticas b√°sicas dos tempos obtidos.\nbenchmark \u0026lt;- microbenchmark::microbenchmark(\rfor_com(nums), for_sem(nums),\rplyr_com(nums), plyr_sem(nums),\rpurrr_com(nums), purrr_sem(nums)\r)\rOs resultados da Tabela 1 s√£o surpreendentes. Primeiro, as fun√ß√µes que n√£o usam barras de progresso s√£o muito mais r√°pidas, chegando a quase 10 vezes em alguns casos. A fun√ß√£o do plyr √© mais lenta que o for() quando usamos barras de progresso, mas √© mais r√°pida quando n√£o usamos. O purrr √© o mais r√°pido nos dois casos.\n\rTabela 1: Resultados do benchmark. Os tempos est√£o em milisegundos.\r\rexpr\rmin\rmean\rmedian\rmax\r\r\r\rfor_com(nums)\r8.666\r10.367\r9.952\r17.155\r\rfor_sem(nums)\r0.161\r0.219\r0.196\r2.211\r\rplyr_com(nums)\r9.193\r10.754\r10.511\r18.386\r\rplyr_sem(nums)\r0.116\r0.155\r0.156\r0.271\r\rpurrr_com(nums)\r8.776\r10.376\r9.982\r14.424\r\rpurrr_sem(nums)\r0.092\r0.131\r0.124\r0.538\r\r\r\rMas n√£o leve esses resultados t√£o a s√©rio. Na pr√°tica, a parte mais demorada fica na fun√ß√£o aplicada e n√£o no funcional utilizado, implicando que essas diferen√ßas sejam ignor√°veis. S√≥ recomendo mesmo abandonar o for() para opera√ß√µes desse tipo, pois o tempo de execu√ß√£o n√£o cresce linearmente com o tamanho dos objetos, como √© poss√≠vel ver na Figura 1.\n\rFigura 1: Tempo do for em fun√ß√£o do n√∫mero de inputs\r\r\rResumo\r\rUse o objeto progress::progress_bar sempre que quiser fazer barras de progresso.\rUse o m√©todo $new(total = n) para criar uma barra.\rUse o m√©todo $tick() dentro do loop para mostrar que andou um passo do algoritmo.\rTome cuidado com a efici√™ncia do algoritmo quando usa barras de progresso.\r\r\rOutros links\r\rVeja ?dplyr::progress_estimated.\rPacote progress.\rPrograma√ß√£o funcional.\r\r\r\r√â prov√°vel que o purrr ganhe essa funcionalidade num futuro pr√≥ximo. Veja essa discuss√£o.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-04-08-progress/","tags":["coding","pacotes","progress"],"title":"As barras do progresso"},{"author":["William"],"categories":["an√°lises"],"contents":"\r\r\r\r\r\r\rSe voc√™ estiver no centro de S√£o Paulo, quanto ser√° que voc√™ precisa andar para achar uma hamburgueria? Ser√° que a sua casa fica a menos de 1 km de hospitais, delagacias ou corpo de bombeiros? Neste post, veremos como utilizar uma das APIs do Google Maps para obter informa√ß√µes de geolocaliza√ß√£o a partir de uma pesquisa simples. Em seguida, vamos gerar mapas com o pacote leaflet para visualizar os dados coletados e responder essas perguntas.\nPasso 1: configurar a API do Google Places\rA API que vamos utilizar para acessar os dados do Google Maps √© a Google Places. Para configur√°-la, voc√™ precisa fazer o seguinte:\ncriar um projeto no Google APIs;\radicionar a Google Places API Web Service √† sua biblioteca de APIs;\robter uma chave de API; e\renviar uma requisi√ß√£o.\r\rPara mais informa√ß√µes sobre os itens 1, 2 e 3, bastar acessar os links acima. Aqui, vamos focar em como fazer o item 4.\n\rPasso 2: baixar os dados da API\rA API do Google Places permite fazer alguns tipos de buscas, como estabelecimentos espec√≠ficos pr√≥ximos a um local ou dentro de uma regi√£o pr√©-delimitada. Nosso objetivo aqui √© requisitar os dados de todos os estabelecimentos, como hospitais, delegacias, supermercados, escolas etc, dentro de um raio de busca em torno de um ponto espec√≠fico. Neste contexto, a requisi√ß√£o deve ser feita a partir de um link da forma\n\rhttps://maps.googleapis.com/maps/api/place/radarsearch/output?parameters\n\rsubstituindo output pelo formato da sa√≠da, xml ou json, e parameters pelos par√¢metros de busca. Utilizaremos aqui o formato json, Javascript Object Notation. Para mais informa√ß√µes sobre JSON, consulte este link.\nUtilizaremos as seguintes bibliotecas nesta an√°lise:\nlibrary(tibble)\rlibrary(magrittr)\rlibrary(dplyr)\rlibrary(stringr)\rlibrary(purrr)\rlibrary(RCurl)\rlibrary(jsonlite)\rlibrary(leaflet)\rO que precisamos fazer √© criar a url de requisi√ß√£o, acess√°-la, guardar os dados no formato json em um objeto e convert√™-lo para um data frame. A fun√ß√£o get_googlemaps_data() abaixo faz exatamente isso. Mais especificamente, ela recebe os par√¢metros de busca, uma chave de API e retorna um data frame com os dados de geolocaliza√ß√£o (latitude e longitude) dos resultados encontrados.\n\rO argumento keyword= recebe o termo a ser pesquisado, isto √©, se estivermos pesquisando por escolas, esse argumento receber√° a string 'escola'.\rO argumento type= recebe um termo para filtrar os estabelecimentos pesquisados. Por exemplo: keyword = 'restaurante' e type = 'vegetariano'.\rOs argumentos central_lat= e central_log= representam, respectivamente, a latitude e a longitude do ponto central da busca. Os valores default s√£o os do centro da cidade de S√£o Paulo.\rO argumento radius= indica o raio m√°ximo de busca. O default √© 15 Km.\rO argumento key= deve receber a sua chave de API.\r\rget_googlemaps_data \u0026lt;- function(keyword, type = \u0026quot;\u0026quot;, central_lat = -23.55052,\rcentral_log = -46.63331, radius = 15000, key) {\rbasic_url = \u0026quot;https://maps.googleapis.com/maps/api/place/radarsearch/json?\u0026quot;\rif(type != \u0026quot;\u0026quot;) {\rtype %\u0026lt;\u0026gt;%\rstr_replace_all(\u0026quot; \u0026quot;, \u0026quot;+\u0026quot;) %\u0026gt;% # Os espa√ßos precisam ser\rstr_c(\u0026quot;\u0026amp;type=\u0026quot;, .) # substitu√≠dos por \u0026#39;+\u0026#39;.\r}\rcomplete_url \u0026lt;- str_c(basic_url, # Criando a url de requisi√ß√£o\r\u0026quot;location=\u0026quot;, # com os par√¢metros de busca.\rcentral_lat,\r\u0026quot;,\u0026quot;,\rcentral_log,\r\u0026quot;\u0026amp;radius=\u0026quot;,\rradius,\rtype,\r\u0026quot;\u0026amp;keyword=\u0026quot;,\rstr_replace_all(keyword, \u0026quot; \u0026quot;, \u0026quot;+\u0026quot;),\r\u0026quot;\u0026amp;key=\u0026quot;,\rkey)\rjson \u0026lt;- RCurl::getURL(complete_url) # Acessando a URL.\rlist_info \u0026lt;- jsonlite::fromJSON(json) # Transformando json em lista.\r# Guardando a latitude e longitude em um df, assim como o lugar pesquisado.\rdf \u0026lt;- tibble::tibble(lat = list_info$results$geometry$location$lat,\rlong = list_info$results$geometry$location$lng,\rplace = keyword)\rreturn(df)\r}\r\rCom a fun√ß√£o get_googlemaps_data() em m√£o, basta rodar o c√≥digo get_googlemaps_data(\"mercado\", key = sua_API_key) para obter a geolocaliza√ß√£o de at√© 200 mercados em um raio de at√© 15 Km do centro de S√£o Paulo. Sim, o limite √© de 200 resultados. N√£o encontrei maneiras de aumentar esse limite.\nTamb√©m podemos utilizar a fun√ß√£o purrr:map_df() para gerar um data frame com v√°rias buscas. A fun√ß√£o map mapeia uma determinada fun√ß√£o em cada elemento de um vetor/lista, retornando um data frame. Ainda n√£o estamos construindo os mapas.\nplaces \u0026lt;- c(\u0026quot;pronto socorro\u0026quot;, \u0026quot;delegacia\u0026quot;, \u0026quot;bombeiros\u0026quot;, \u0026quot;hamburguer\u0026quot;, \u0026quot;pizza\u0026quot;)\rdf_places \u0026lt;- places %\u0026gt;%\rpurrr::map_df(.f = get_googlemaps_data, key = key)\r√Äs vezes, a requisi√ß√£o pode retornar com algum erro. N√£o consegui descobrir o porqu√™ isso acontece. Nestes casos, a fun√ß√£o get_googlemaps_data() tamb√©m retornar√° um erro, provavelmente na constru√ß√£o do data frame. Se isso acontecer, basta rodar a fun√ß√£o novamente, gerando uma nova requisi√ß√£o.\n\rPasso 3: os mapas\rPara construir os mapas, vamos utilizar a fun√ß√£o leaflet::leaflet(). A ideia √©, para cada ponto da pesquisa, adicionar um c√≠rculo de raio igual a 1 Km. Dessa forma, se voc√™ estiver fora desses c√≠rculos, quer dizer que voc√™ estar√° a mais de um quil√¥metro de um dos estabelecimentos pesquisados. Veja os exemplos a seguir.\nHospitais\rEu pesquisei por ‚Äúpronto socorro‚Äù porque a pesquisa hospitais tamb√©m resulta em hospitais veterin√°rios. Um desafio para quem for reproduzir a an√°lise: coletar apenas a geolocaliza√ß√£o de hospitais p√∫blicos.\nlibrary(leaflet)\rdf_places %\u0026gt;%\rdplyr::filter(place == \u0026quot;pronto socorro\u0026quot;) %\u0026gt;%\rleaflet %\u0026gt;%\raddTiles() %\u0026gt;%\raddCircles(lng = ~long, lat = ~lat, weight = 5,\rradius = 1000, color = \u0026quot;blue\u0026quot;, fillOpacity = 0.5)\r\r{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"\u0026copy; OpenStreetMap contributors, CC-BY-SA\"}]},{\"method\":\"addCircles\",\"args\":[[-23.5119153,-23.5373825,-23.5905932,-23.5980238,-23.5661976,-23.5845127,-23.4900198,-23.5307666,-23.6059136,-23.5312467,-23.5326516,-23.5705023,-23.6335601,-23.534041,-23.5633472,-23.5651576,-23.5672702,-23.5633193,-23.471358,-23.4714753,-23.5344188,-23.6610511,-23.5387329,-23.6053209,-23.5047759,-23.597356,-23.5254203,-23.4786019,-23.5836116,-23.5441918,-23.5686565,-23.5955258,-23.6166254,-23.5750806,-23.5595911,-23.513787,-23.6688347,-23.569463,-23.5498011,-23.5305855,-23.5305078,-23.5280111,-23.6055052,-23.6409921,-23.5910656,-23.5318183,-23.6334139,-23.5350449,-23.569428,-23.6591257,-23.5821893,-23.5965097,-23.6012416,-23.5317336,-23.5821425,-23.5556018,-23.6553285,-23.6563346,-23.5351773,-23.532219,-23.5280111,-23.5726548,-23.5696204,-23.480409,-23.4897055,-23.5730884,-23.4812918,-23.6247641,-23.546276,-23.6271409,-23.5467703,-23.522846,-23.627863,-23.6001558,-23.5637551,-23.5256167,-23.5952007,-23.5649897,-23.5498492,-23.527939,-23.656156,-23.569428,-23.4857742,-23.596556,-23.6234922,-23.5577053,-23.5390111,-23.6035905,-23.4880345,-23.5693739,-23.6247256,-23.665295,-23.5763024,-23.5563961,-23.5857137,-23.5974124,-23.5575111,-23.532343,-23.4622515,-23.4956783,-23.6025886,-23.5697277,-23.6134365,-23.6751151,-23.613621,-23.5571698,-23.6533311,-23.5686923,-23.5832658,-23.485263,-23.5608918,-23.681394,-23.5368947,-23.6502386,-23.5848796,-23.6057328,-23.5778832,-23.5736788,-23.6361573,-23.6055779,-23.5388485,-23.4786665,-23.5331447,-23.5342429,-23.5256207,-23.4659604,-23.5632955,-23.5730539,-23.5317657,-23.5048116,-23.6139389,-23.5737579,-23.544043,-23.5374351,-23.5488919,-23.570874,-23.5655057,-23.574066,-23.5718713,-23.5848044,-23.5359999,-23.5908277,-23.5635485,-23.4873362,-23.4626237,-23.5227691,-23.5236666,-23.6500238,-23.5312246,-23.5843036,-23.6515538,-23.5814177,-23.6058157,-23.600342,-23.5928542,-23.5146009,-23.572769,-23.5348803,-23.524877],[-46.626602,-46.7222414,-46.673017,-46.6437783,-46.682266,-46.7389951,-46.6886567,-46.6856687,-46.6763323,-46.6527279,-46.6774696,-46.53894,-46.6076853,-46.6880346,-46.5898581,-46.642401,-46.7769605,-46.5899109,-46.5291812,-46.528803,-46.5664698,-46.563856,-46.7767891,-46.6756819,-46.6251452,-46.629591,-46.7110851,-46.5508029,-46.6518868,-46.585348,-46.5857234,-46.6517141,-46.7772604,-46.6690268,-46.6554808,-46.764427,-46.5292085,-46.58553,-46.6595009,-46.697351,-46.697102,-46.6713828,-46.6759325,-46.527937,-46.7036527,-46.621152,-46.6076329,-46.6544871,-46.6616889,-46.6983633,-46.6411569,-46.6536998,-46.6614068,-46.6211242,-46.614028,-46.6728642,-46.5741254,-46.5576687,-46.6601049,-46.7807695,-46.6713828,-46.7229714,-46.6872959,-46.592692,-46.7270244,-46.6960888,-46.7443021,-46.6836816,-46.764964,-46.6386548,-46.7623576,-46.681074,-46.698738,-46.6868637,-46.5904111,-46.5482745,-46.6443238,-46.740635,-46.659294,-46.671341,-46.527015,-46.6616889,-46.6167614,-46.5029179,-46.5653918,-46.6542899,-46.6836854,-46.6558622,-46.6272406,-46.6459197,-46.5640802,-46.527457,-46.6942676,-46.6668833,-46.7177055,-46.6437032,-46.6700211,-46.7769437,-46.5326045,-46.6253623,-46.6518983,-46.6455781,-46.6204509,-46.6856038,-46.6680398,-46.68009,-46.645613,-46.6218602,-46.6117961,-46.6951351,-46.650708,-46.6765187,-46.5894992,-46.7050412,-46.6633198,-46.7505598,-46.7080483,-46.6440605,-46.6947841,-46.675879,-46.6620469,-46.5515213,-46.5663969,-46.6880714,-46.711545,-46.5500737,-46.5899932,-46.6435409,-46.7816035,-46.6251289,-46.6500781,-46.64404,-46.5855476,-46.7769366,-46.558181,-46.6417978,-46.6797014,-46.6391822,-46.5901717,-46.6511464,-46.5752707,-46.6724233,-46.6341114,-46.622235,-46.5198252,-46.5426888,-46.702101,-46.7041659,-46.652742,-46.6115469,-46.7048926,-46.6402724,-46.7624952,-46.678413,-46.637764,-46.7785894,-46.6533613,-46.6747363,-46.693907],1000,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"blue\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"blue\",\"fillOpacity\":0.5},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null,null]}],\"limits\":{\"lat\":[-23.681394,-23.4622515],\"lng\":[-46.7816035,-46.5029179]}},\"evals\":[],\"jsHooks\":[]}\r\rDelegacias\rdf_places %\u0026gt;%\rdplyr::filter(place == \u0026quot;delegacia\u0026quot;) %\u0026gt;%\rleaflet %\u0026gt;%\raddTiles() %\u0026gt;%\raddCircles(lng = ~long, lat = ~lat, weight = 5,\rradius = 1000, color = \u0026quot;blue\u0026quot;, fillOpacity = 0.5)\r\r{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"\u0026copy; OpenStreetMap contributors, CC-BY-SA\"}]},{\"method\":\"addCircles\",\"args\":[[-23.5383123,-23.5297102,-23.5491121,-23.5661229,-23.5688572,-23.4833831,-23.5818477,-23.5298608,-23.5676202,-23.5736771,-23.6227807,-23.4973232,-23.5480212,-23.6791763,-23.5307283,-23.5232008,-23.4783837,-23.601847,-23.5539712,-23.536114,-23.6017882,-23.5098708,-23.4947088,-23.4828219,-23.540883,-23.4673945,-23.6708491,-23.6724756,-23.5987292,-23.5618211,-23.5005049,-23.5568327,-23.653363,-23.5384537,-23.5282851,-23.530853,-23.6468868,-23.6741719,-23.5176746,-23.672469,-23.621305,-23.4731505,-23.6544644,-23.5677311,-23.5384589,-23.6631936,-23.4536045,-23.5489679,-23.5587444,-23.5483289,-23.5459635,-23.5330143,-23.5582539,-23.6737026,-23.5618494,-23.5384554,-23.5231331,-23.579318,-23.6038083,-23.5004539,-23.593785,-23.5361383,-23.6084084,-23.6044058,-23.6565533,-23.5618494,-23.6152646,-23.5500639,-23.5539385,-23.517843,-23.5393787,-23.5023122,-23.6536219,-23.5370451,-23.4947663,-23.6851638,-23.6244069,-23.579318,-23.6717429,-23.5704692,-23.6082049,-23.5353879,-23.579318,-23.4986159,-23.5436404,-23.667303,-23.639554,-23.5393787,-23.5624913,-23.5032441,-23.6153852,-23.6015128,-23.4819928,-23.5459648,-23.5630819,-23.6082362,-23.5388766,-23.5880807,-23.4722036,-23.5289099,-23.6620073,-23.639544,-23.5791521,-23.563454,-23.5430169,-23.6526437,-23.5590782,-23.4556602,-23.6661731,-23.5361564,-23.5311036,-23.5397311,-23.6629003,-23.5310719,-23.536939,-23.5569805,-23.6074999,-23.6567851,-23.5898128,-23.5905868,-23.494313,-23.5587444,-23.4586306,-23.675735,-23.5224255,-23.671542,-23.4536083,-23.53119,-23.5703925,-23.5866997,-23.5054754,-23.6417051,-23.645051,-23.6560117,-23.496984,-23.6219196,-23.6238475,-23.4691728,-23.5282622,-23.5655047,-23.6391001,-23.5126143,-23.469647,-23.5308639,-23.4821316,-23.5361804,-23.5550709,-23.5633395,-23.5382476,-23.5020195,-23.607243,-23.4697691,-23.6741952,-23.4826847,-23.5548435,-23.5120658,-23.4632301,-23.61534,-23.5291141,-23.5234202,-23.6623062,-23.5480535,-23.5384403,-23.532582,-23.5470754,-23.4457197,-23.4635218,-23.5914264,-23.6592795,-23.5351522,-23.6527115,-23.6652897,-23.5377226,-23.6329062,-23.53297,-23.552832,-23.538416,-23.5480557,-23.6673949,-23.5280618,-23.524188,-23.4881236],[-46.6352041,-46.6123622,-46.6374832,-46.6693192,-46.5845768,-46.5899152,-46.6745046,-46.6124474,-46.6237268,-46.5576533,-46.6021564,-46.7457932,-46.6315625,-46.7126109,-46.6427928,-46.6443684,-46.6211789,-46.6377563,-46.4922562,-46.7751834,-46.6377661,-46.4978574,-46.6976676,-46.7280477,-46.6295377,-46.5225908,-46.5476651,-46.6057142,-46.5332901,-46.6912479,-46.64915,-46.6342131,-46.5509209,-46.6350792,-46.7685576,-46.7811049,-46.7074536,-46.5414885,-46.772271,-46.6057579,-46.5578478,-46.5443008,-46.5434002,-46.6717472,-46.6350712,-46.7562845,-46.5554563,-46.537173,-46.7467745,-46.5937954,-46.6350048,-46.6452216,-46.5701152,-46.6598129,-46.6913228,-46.6350996,-46.5187069,-46.5176508,-46.5949903,-46.6492117,-46.5671434,-46.5634063,-46.7360393,-46.6929346,-46.6138111,-46.6913228,-46.6749929,-46.5677175,-46.4922485,-46.5848652,-46.6396037,-46.6156983,-46.6332473,-46.5266046,-46.6977393,-46.6374671,-46.5275439,-46.5176508,-46.5129268,-46.5916434,-46.5710604,-46.5845374,-46.5176508,-46.7710681,-46.7772102,-46.6089909,-46.5626729,-46.6396037,-46.5452257,-46.6129232,-46.67501,-46.637479,-46.7252233,-46.6350021,-46.6544211,-46.5008084,-46.7310141,-46.7268396,-46.5356924,-46.5547585,-46.6869911,-46.6432063,-46.6508845,-46.6978678,-46.6439468,-46.574482,-46.4887345,-46.5131197,-46.586866,-46.5633416,-46.7750776,-46.6452333,-46.7561995,-46.7815275,-46.6653663,-46.6343713,-46.75687,-46.6690569,-46.5532082,-46.6087861,-46.6779309,-46.7467745,-46.5852411,-46.7122978,-46.7058875,-46.5132349,-46.555436,-46.7749852,-46.5915033,-46.5802153,-46.6281239,-46.5288368,-46.525143,-46.5453301,-46.74604,-46.5202035,-46.5369112,-46.6897364,-46.7686436,-46.6380865,-46.5596799,-46.7690733,-46.5378169,-46.7810029,-46.7253273,-46.5634639,-46.6617883,-46.6966132,-46.6341476,-46.6269636,-46.7378895,-46.5241902,-46.5413976,-46.5385258,-46.4922591,-46.6224467,-46.5029513,-46.5723998,-46.7730005,-46.7104606,-46.6869197,-46.6485013,-46.6350638,-46.660818,-46.6332689,-46.717044,-46.6788482,-46.6069425,-46.5263037,-46.57783,-46.5334081,-46.5242607,-46.5291609,-46.7704662,-46.5260099,-46.7738949,-46.6348528,-46.7615798,-46.608524,-46.7100248,-46.688206,-46.5492603],1000,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"blue\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"blue\",\"fillOpacity\":0.5},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null,null]}],\"limits\":{\"lat\":[-23.6851638,-23.4457197],\"lng\":[-46.7815275,-46.4887345]}},\"evals\":[],\"jsHooks\":[]}\r\rBombeiros\rdf_places %\u0026gt;%\rdplyr::filter(place == \u0026quot;delegacia\u0026quot;) %\u0026gt;%\rleaflet %\u0026gt;%\raddTiles() %\u0026gt;%\raddCircles(lng = ~long, lat = ~lat, weight = 5,\rradius = 1000, color = \u0026quot;blue\u0026quot;, fillOpacity = 0.5)\r\r{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"\u0026copy; OpenStreetMap contributors, CC-BY-SA\"}]},{\"method\":\"addCircles\",\"args\":[[-23.5383123,-23.5297102,-23.5491121,-23.5661229,-23.5688572,-23.4833831,-23.5818477,-23.5298608,-23.5676202,-23.5736771,-23.6227807,-23.4973232,-23.5480212,-23.6791763,-23.5307283,-23.5232008,-23.4783837,-23.601847,-23.5539712,-23.536114,-23.6017882,-23.5098708,-23.4947088,-23.4828219,-23.540883,-23.4673945,-23.6708491,-23.6724756,-23.5987292,-23.5618211,-23.5005049,-23.5568327,-23.653363,-23.5384537,-23.5282851,-23.530853,-23.6468868,-23.6741719,-23.5176746,-23.672469,-23.621305,-23.4731505,-23.6544644,-23.5677311,-23.5384589,-23.6631936,-23.4536045,-23.5489679,-23.5587444,-23.5483289,-23.5459635,-23.5330143,-23.5582539,-23.6737026,-23.5618494,-23.5384554,-23.5231331,-23.579318,-23.6038083,-23.5004539,-23.593785,-23.5361383,-23.6084084,-23.6044058,-23.6565533,-23.5618494,-23.6152646,-23.5500639,-23.5539385,-23.517843,-23.5393787,-23.5023122,-23.6536219,-23.5370451,-23.4947663,-23.6851638,-23.6244069,-23.579318,-23.6717429,-23.5704692,-23.6082049,-23.5353879,-23.579318,-23.4986159,-23.5436404,-23.667303,-23.639554,-23.5393787,-23.5624913,-23.5032441,-23.6153852,-23.6015128,-23.4819928,-23.5459648,-23.5630819,-23.6082362,-23.5388766,-23.5880807,-23.4722036,-23.5289099,-23.6620073,-23.639544,-23.5791521,-23.563454,-23.5430169,-23.6526437,-23.5590782,-23.4556602,-23.6661731,-23.5361564,-23.5311036,-23.5397311,-23.6629003,-23.5310719,-23.536939,-23.5569805,-23.6074999,-23.6567851,-23.5898128,-23.5905868,-23.494313,-23.5587444,-23.4586306,-23.675735,-23.5224255,-23.671542,-23.4536083,-23.53119,-23.5703925,-23.5866997,-23.5054754,-23.6417051,-23.645051,-23.6560117,-23.496984,-23.6219196,-23.6238475,-23.4691728,-23.5282622,-23.5655047,-23.6391001,-23.5126143,-23.469647,-23.5308639,-23.4821316,-23.5361804,-23.5550709,-23.5633395,-23.5382476,-23.5020195,-23.607243,-23.4697691,-23.6741952,-23.4826847,-23.5548435,-23.5120658,-23.4632301,-23.61534,-23.5291141,-23.5234202,-23.6623062,-23.5480535,-23.5384403,-23.532582,-23.5470754,-23.4457197,-23.4635218,-23.5914264,-23.6592795,-23.5351522,-23.6527115,-23.6652897,-23.5377226,-23.6329062,-23.53297,-23.552832,-23.538416,-23.5480557,-23.6673949,-23.5280618,-23.524188,-23.4881236],[-46.6352041,-46.6123622,-46.6374832,-46.6693192,-46.5845768,-46.5899152,-46.6745046,-46.6124474,-46.6237268,-46.5576533,-46.6021564,-46.7457932,-46.6315625,-46.7126109,-46.6427928,-46.6443684,-46.6211789,-46.6377563,-46.4922562,-46.7751834,-46.6377661,-46.4978574,-46.6976676,-46.7280477,-46.6295377,-46.5225908,-46.5476651,-46.6057142,-46.5332901,-46.6912479,-46.64915,-46.6342131,-46.5509209,-46.6350792,-46.7685576,-46.7811049,-46.7074536,-46.5414885,-46.772271,-46.6057579,-46.5578478,-46.5443008,-46.5434002,-46.6717472,-46.6350712,-46.7562845,-46.5554563,-46.537173,-46.7467745,-46.5937954,-46.6350048,-46.6452216,-46.5701152,-46.6598129,-46.6913228,-46.6350996,-46.5187069,-46.5176508,-46.5949903,-46.6492117,-46.5671434,-46.5634063,-46.7360393,-46.6929346,-46.6138111,-46.6913228,-46.6749929,-46.5677175,-46.4922485,-46.5848652,-46.6396037,-46.6156983,-46.6332473,-46.5266046,-46.6977393,-46.6374671,-46.5275439,-46.5176508,-46.5129268,-46.5916434,-46.5710604,-46.5845374,-46.5176508,-46.7710681,-46.7772102,-46.6089909,-46.5626729,-46.6396037,-46.5452257,-46.6129232,-46.67501,-46.637479,-46.7252233,-46.6350021,-46.6544211,-46.5008084,-46.7310141,-46.7268396,-46.5356924,-46.5547585,-46.6869911,-46.6432063,-46.6508845,-46.6978678,-46.6439468,-46.574482,-46.4887345,-46.5131197,-46.586866,-46.5633416,-46.7750776,-46.6452333,-46.7561995,-46.7815275,-46.6653663,-46.6343713,-46.75687,-46.6690569,-46.5532082,-46.6087861,-46.6779309,-46.7467745,-46.5852411,-46.7122978,-46.7058875,-46.5132349,-46.555436,-46.7749852,-46.5915033,-46.5802153,-46.6281239,-46.5288368,-46.525143,-46.5453301,-46.74604,-46.5202035,-46.5369112,-46.6897364,-46.7686436,-46.6380865,-46.5596799,-46.7690733,-46.5378169,-46.7810029,-46.7253273,-46.5634639,-46.6617883,-46.6966132,-46.6341476,-46.6269636,-46.7378895,-46.5241902,-46.5413976,-46.5385258,-46.4922591,-46.6224467,-46.5029513,-46.5723998,-46.7730005,-46.7104606,-46.6869197,-46.6485013,-46.6350638,-46.660818,-46.6332689,-46.717044,-46.6788482,-46.6069425,-46.5263037,-46.57783,-46.5334081,-46.5242607,-46.5291609,-46.7704662,-46.5260099,-46.7738949,-46.6348528,-46.7615798,-46.608524,-46.7100248,-46.688206,-46.5492603],1000,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"blue\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"blue\",\"fillOpacity\":0.5},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null,null]}],\"limits\":{\"lat\":[-23.6851638,-23.4457197],\"lng\":[-46.7815275,-46.4887345]}},\"evals\":[],\"jsHooks\":[]}\r\rHamburguerias\rRepare que o √∫nico local na regi√£o mais central de SP em que voc√™ pode ficar a mais de um quil√¥metro de uma hamburgueria √© no meio do parque Ibirapuera.\ndf_places %\u0026gt;%\rdplyr::filter(place == \u0026quot;hamburguer\u0026quot;) %\u0026gt;%\rleaflet %\u0026gt;%\raddTiles() %\u0026gt;%\raddCircles(lng = ~long, lat = ~lat, weight = 5,\rradius = 1000, color = \u0026quot;blue\u0026quot;, fillOpacity = 0.5)\r\r{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"\u0026copy; OpenStreetMap contributors, CC-BY-SA\"}]},{\"method\":\"addCircles\",\"args\":[[-23.591146,-23.5336461,-23.5838986,-23.5503624,-23.6592217,-23.542275,-23.5797476,-23.596576,-23.5338269,-23.4733347,-23.5266223,-23.5665607,-23.6085312,-23.5553724,-23.506423,-23.4543601,-23.504678,-23.573054,-23.4381869,-23.6018597,-23.578114,-23.485509,-23.5634841,-23.580141,-23.5010416,-23.5346422,-23.5041882,-23.5355418,-23.6089377,-23.5132051,-23.562808,-23.5852957,-23.5613203,-23.5711904,-23.616063,-23.6531883,-23.5090555,-23.5689164,-23.5793803,-23.6262204,-23.5627803,-23.5971131,-23.5678876,-23.628948,-23.5734327,-23.5648008,-23.6009047,-23.556679,-23.6463528,-23.5527839,-23.5465054,-23.5629637,-23.5850463,-23.5599597,-23.6012908,-23.5884194,-23.6240267,-23.566246,-23.5353525,-23.573761,-23.5514768,-23.5373816,-23.5653794,-23.588201,-23.5865903,-23.564753,-23.5147827,-23.5840682,-23.588146,-23.5658447,-23.490545,-23.5821723,-23.592777,-23.6104166,-23.6283446,-23.5389528,-23.5265647,-23.5909182,-23.5578,-23.5742941,-23.5838378,-23.6221529,-23.6448208,-23.595291,-23.6205597,-23.5854537,-23.5543718,-23.5416911,-23.5496606,-23.6532202,-23.5277805,-23.5951434,-23.559425,-23.5553229,-23.5640467,-23.5527584,-23.4836366,-23.5644229,-23.548505,-23.6317016,-23.5638728,-23.5390531,-23.603755,-23.5443723,-23.5828457,-23.5072434,-23.5569599,-23.5805003,-23.5610006,-23.5750971,-23.60095,-23.5693968,-23.616657,-23.58057,-23.5249596,-23.4888868,-23.5895836,-23.6477982,-23.5030827,-23.5700128,-23.5017743,-23.601558,-23.6027181,-23.6059682,-23.568254,-23.4576,-23.5629422,-23.582909,-23.5861822,-23.5934347,-23.5754347,-23.5562148,-23.5398958,-23.5453293,-23.4571858,-23.5831264,-23.5842987,-23.5939793,-23.663584,-23.585636,-23.4581943,-23.5837427,-23.561829,-23.572453,-23.6571708,-23.6107976,-23.653277,-23.5524716,-23.5955253,-23.628859,-23.5879004,-23.504576,-23.595446,-23.6605752,-23.5807706,-23.6136682,-23.535474,-23.5840187,-23.5735392,-23.6126085,-23.5348174,-23.6775988,-23.581018,-23.6324146,-23.5733291,-23.5667822,-23.5571388,-23.5938663,-23.5476359,-23.557399,-23.4595221,-23.5354543,-23.5581649,-23.591519,-23.6570493,-23.539445,-23.591926,-23.5552675,-23.5606171,-23.5604561,-23.5272591,-23.603121,-23.6838816,-23.4943751,-23.4888327,-23.5388857,-23.6083724,-23.4916797,-23.5545398,-23.6454166,-23.5753351,-23.5705675,-23.5739331,-23.5776088,-23.5850495],[-46.606932,-46.6789657,-46.6715329,-46.721243,-46.691653,-46.671616,-46.6401764,-46.645059,-46.6765012,-46.6181558,-46.6809673,-46.6847769,-46.6689898,-46.6672214,-46.6050108,-46.5086841,-46.766024,-46.6957717,-46.5103477,-46.6856274,-46.5864917,-46.6099852,-46.6526611,-46.594538,-46.6234912,-46.6803639,-46.6397583,-46.6682289,-46.6380647,-46.6634067,-46.664692,-46.6851425,-46.6940645,-46.6562935,-46.637284,-46.5741857,-46.6272089,-46.6489332,-46.6749766,-46.6716679,-46.5933429,-46.6679397,-46.6887612,-46.735678,-46.6559783,-46.6813804,-46.6591207,-46.6585153,-46.5411584,-46.6604487,-46.6488861,-46.6671203,-46.67572,-46.6966738,-46.6481923,-46.7178619,-46.6707122,-46.6891856,-46.674463,-46.643287,-46.6512416,-46.6717551,-46.6660143,-46.6070784,-46.6748572,-46.596838,-46.586678,-46.6798554,-46.6807579,-46.6828788,-46.650642,-46.6835917,-46.620418,-46.7270365,-46.6884155,-46.7059855,-46.7087878,-46.680252,-46.6482,-46.5862013,-46.6726088,-46.6716779,-46.7167793,-46.686661,-46.6722255,-46.6884378,-46.6574396,-46.6581628,-46.5732107,-46.715117,-46.6858916,-46.6864676,-46.69182,-46.6671431,-46.6791396,-46.5878087,-46.6142181,-46.6650737,-46.68556,-46.7356058,-46.6955912,-46.7065395,-46.637025,-46.662176,-46.6699937,-46.5891467,-46.6365449,-46.6748554,-46.6978423,-46.6231729,-46.66784,-46.7790474,-46.5617949,-46.639328,-46.5484904,-46.632508,-46.6771678,-46.5330954,-46.6331541,-46.5918849,-46.7387239,-46.645919,-46.6365449,-46.6716015,-46.663007,-46.5035,-46.6689186,-46.649674,-46.6801062,-46.6378852,-46.6214206,-46.6874742,-46.5722354,-46.5662897,-46.5375642,-46.6762251,-46.6812884,-46.6893669,-46.5278969,-46.6844028,-46.6163259,-46.5746757,-46.663569,-46.696094,-46.692626,-46.6857479,-46.715073,-46.5732339,-46.6703355,-46.7323372,-46.6340808,-46.6404152,-46.6665919,-46.5382408,-46.6386028,-46.661306,-46.774918,-46.5787994,-46.6317331,-46.6674626,-46.6967788,-46.6979911,-46.676953,-46.7067056,-46.6896656,-46.5041049,-46.6590561,-46.684693,-46.5405164,-46.6616889,-46.5255218,-46.6584795,-46.6795316,-46.690243,-46.6794921,-46.6815967,-46.689909,-46.6630835,-46.6776155,-46.6536749,-46.6747875,-46.667028,-46.5576865,-46.622905,-46.5485872,-46.7810428,-46.6707483,-46.5789318,-46.6886172,-46.6725334,-46.6232265,-46.6435321,-46.6052905,-46.6863864,-46.6849714],1000,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"blue\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"blue\",\"fillOpacity\":0.5},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null,null]}],\"limits\":{\"lat\":[-23.6838816,-23.4381869],\"lng\":[-46.7810428,-46.5035]}},\"evals\":[],\"jsHooks\":[]}\r\rPizzarias\rSe a busca devolvesse todos os resultados poss√≠veis, esse mapa teria um c√≠rculo azul com ~15 km de raio formado por milhares de c√≠rculos menores. =D\ndf_places %\u0026gt;%\rdplyr::filter(place == \u0026quot;pizza\u0026quot;) %\u0026gt;%\rleaflet %\u0026gt;%\raddTiles() %\u0026gt;%\raddCircles(lng = ~long, lat = ~lat, weight = 5,\rradius = 1000, color = \u0026quot;blue\u0026quot;, fillOpacity = 0.5)\r\r{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"\u0026copy; OpenStreetMap contributors, CC-BY-SA\"}]},{\"method\":\"addCircles\",\"args\":[[-23.6377832,-23.4462145,-23.5424359,-23.4774627,-23.5419111,-23.6024847,-23.541106,-23.6457094,-23.509009,-23.553901,-23.50269,-23.5329118,-23.5422104,-23.5661403,-23.5452462,-23.5577665,-23.6636748,-23.493779,-23.5705867,-23.6504283,-23.5802283,-23.5569862,-23.6518754,-23.430156,-23.6023253,-23.5556,-23.6132131,-23.5295159,-23.640748,-23.477944,-23.6220978,-23.646009,-23.5600239,-23.5594337,-23.602824,-23.5436359,-23.6852789,-23.5517875,-23.5513039,-23.625363,-23.5396657,-23.5358895,-23.5517621,-23.564383,-23.5506128,-23.5412163,-23.5582873,-23.5303699,-23.564862,-23.532627,-23.5895741,-23.5433224,-23.5949926,-23.602252,-23.5004078,-23.4821581,-23.4982069,-23.5071623,-23.5126657,-23.611988,-23.5372528,-23.5590171,-23.5220143,-23.5770825,-23.6637534,-23.6503046,-23.5190645,-23.4820189,-23.5194119,-23.5653705,-23.584995,-23.6172893,-23.6474922,-23.570713,-23.5295945,-23.5665179,-23.6149595,-23.569128,-23.5835924,-23.605047,-23.5478937,-23.583501,-23.5393727,-23.4732888,-23.549809,-23.4895174,-23.5631008,-23.4927203,-23.532557,-23.587089,-23.5419694,-23.6456114,-23.6209898,-23.6148053,-23.5539137,-23.5500438,-23.5640781,-23.5990557,-23.5821783,-23.6150855,-23.4411447,-23.5683413,-23.5727553,-23.523788,-23.5494877,-23.5123431,-23.5295488,-23.5065289,-23.54339,-23.532351,-23.5834382,-23.5567547,-23.4434337,-23.5572059,-23.6359365,-23.5311848,-23.5795604,-23.5719321,-23.6100783,-23.5974629,-23.6101259,-23.4717705,-23.487415,-23.5819812,-23.5553385,-23.466982,-23.5284249,-23.6332724,-23.547883,-23.599827,-23.4674635,-23.5919894,-23.560073,-23.562154,-23.6185319,-23.6157414,-23.5624923,-23.492689,-23.5444475,-23.5317319,-23.637594,-23.5927858,-23.6131211,-23.4502679,-23.6304068,-23.4431003,-23.5411737,-23.5452338,-23.5595533,-23.574389,-23.5397174,-23.5108,-23.654038,-23.6449382,-23.6230042,-23.5696743,-23.5264596,-23.6101022,-23.5266181,-23.604193,-23.5354641,-23.6452682,-23.547914,-23.5420478,-23.5650258,-23.645387,-23.618032,-23.6227371,-23.6043214,-23.533478,-23.5430459,-23.4996677,-23.607763,-23.6800724,-23.5299556,-23.525889,-23.572832,-23.5466296,-23.5405145,-23.6241098,-23.5338992,-23.4963454,-23.5866832,-23.5518073,-23.4958908,-23.6381805,-23.4663278,-23.5352615,-23.6037182,-23.5991756,-23.5346009,-23.6614632,-23.5608229,-23.5001646],[-46.6547524,-46.5332262,-46.657693,-46.620587,-46.5588801,-46.6198086,-46.569886,-46.6078521,-46.777435,-46.754586,-46.584696,-46.6912456,-46.7707031,-46.652538,-46.7628693,-46.6591531,-46.688653,-46.631612,-46.6434567,-46.5388143,-46.5943854,-46.6326943,-46.5349826,-46.656682,-46.6719859,-46.647515,-46.495481,-46.6857871,-46.6409195,-46.545149,-46.5743651,-46.545329,-46.6636453,-46.6728148,-46.6932222,-46.5619613,-46.562003,-46.544057,-46.5627324,-46.58666,-46.4884504,-46.4974936,-46.5959409,-46.547359,-46.5647461,-46.7437258,-46.6753184,-46.5162473,-46.594627,-46.6897196,-46.6317874,-46.6728329,-46.6313316,-46.661709,-46.6213143,-46.5832032,-46.76981,-46.6708127,-46.6618355,-46.588661,-46.52505,-46.5979523,-46.5220586,-46.5876893,-46.5279125,-46.5389086,-46.7807405,-46.6222273,-46.6763059,-46.6827195,-46.618676,-46.6738651,-46.5161353,-46.6260225,-46.6791571,-46.6542167,-46.7427533,-46.6889177,-46.6889935,-46.66462,-46.5664101,-46.685952,-46.5892121,-46.5448818,-46.6450709,-46.5945648,-46.5476234,-46.7153071,-46.659038,-46.633976,-46.5479707,-46.5073347,-46.67349,-46.7669403,-46.6891084,-46.554711,-46.6795783,-46.6373388,-46.6792503,-46.6675042,-46.5564483,-46.6578993,-46.69551,-46.693134,-46.6458761,-46.5147357,-46.5274241,-46.7184862,-46.7687562,-46.685107,-46.7505034,-46.7531604,-46.5441554,-46.7486309,-46.7121613,-46.6827964,-46.7386436,-46.6268869,-46.6882732,-46.7317588,-46.666563,-46.6373485,-46.6332363,-46.7327819,-46.5880192,-46.6034698,-46.5271221,-46.7049679,-46.657564,-46.6728546,-46.5160969,-46.643832,-46.698603,-46.646222,-46.571754,-46.6435343,-46.6676688,-46.629935,-46.6214891,-46.7177885,-46.5468276,-46.6449969,-46.5762207,-46.5443476,-46.7359753,-46.5493277,-46.5896285,-46.6518954,-46.6816634,-46.726939,-46.7796091,-46.508914,-46.534698,-46.7149926,-46.5726881,-46.5456595,-46.7669566,-46.5324295,-46.6966314,-46.669199,-46.7124692,-46.5933522,-46.753617,-46.7776072,-46.6809555,-46.5742119,-46.6789757,-46.639773,-46.7494812,-46.704333,-46.5526644,-46.6438895,-46.573151,-46.6550872,-46.7284971,-46.687889,-46.540983,-46.6387818,-46.6509312,-46.5578388,-46.6931313,-46.7255467,-46.5805153,-46.7500256,-46.6669341,-46.5434583,-46.5601988,-46.5096595,-46.6580583,-46.6116123,-46.64933,-46.6946439,-46.5846951,-46.5243514],1000,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"blue\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"blue\",\"fillOpacity\":0.5},null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null,null]}],\"limits\":{\"lat\":[-23.6852789,-23.430156],\"lng\":[-46.7807405,-46.4884504]}},\"evals\":[],\"jsHooks\":[]}\rSem d√∫vidas, a utiliza√ß√£o dos dados aqui foi bem superficial, apenas ilustrativa. O ideal seria juntar essas informa√ß√µes de geolocaliza√ß√£o com dados de criminalidade, sa√∫de p√∫blica, socioecon√¥micos, consumo etc. Dependendo da disponibilidade de dados, h√° espa√ßo para muitas an√°lises interessantes utilizando essas informa√ß√µes do Google Maps. Com certeza voltaremos neste assunto em posts futuros. =)\nComent√°rios? Sugest√µes? Cr√≠ticas? Voc√™ est√° a menos de um quil√¥metro dos coment√°rios! Deixe a sua mensagem!\n\r\r","permalink":"https://blog.curso-r.com/posts/2017-04-13-o-que-tem-a-um-km/","tags":["GoogleMaps","API","leaflet"],"title":"Voc√™ est√° a menos de 1 km de um Hamb√∫rguer?"},{"author":["Athos"],"categories":["top 10"],"contents":"\r\rEm fevereiro desse ano ministramos o Curso de R de Ver√£o 2017, parte do programa dos Cursos de Ver√£o do IME-USP.\rAbaixo segue um compilado das 10 melhores dicas dadas durante este curso.\n1. Conhe√ßa e domine a filosofia por tr√°s do Tidyverse\rO conceito ‚Äútidy‚Äù deu o oriente do curso de ver√£o e n√£o foi √† toa: o tidyverse, carinhosamente chamado de ‚Äúuniverso arrumadinho‚Äù, est√° intimamente associado ao dia-a-dia de um analista de dados e sua implementa√ß√£o em R √© tida como uma pequena revolu√ß√£o para os R-eiros.\nA postagem Manifesto Tidy resume bem os motivos pelos quais valem a pena aprender os princ√≠pios e os pacotes do tidyverse.\n\r2. R + Shiny √© uma grande alternativa √†s ferramentas de BI e Dashboards\rSe voc√™ ainda tem alguma d√∫vida sobre o poder do R em montar dashboards interativos, se d√™ a chance de visitar alguns exemplos:\n\rPolling Data\rVisCARF\rCollege Map\rCRAN Dash\r\rEsses exemplos mostram que √© poss√≠vel fazer desde simples gr√°ficos de barras at√© sofisticados mapas a l√° Google Maps. Esse potencial √© imenso e tudo isso est√° a disposi√ß√£o de um mero mortal (e n√£o mais apenas de um desenvolvedor de software especialista em web).\nE quando digo que o potencial √© imenso, pode acreditar. O shiny coloca a disposi√ß√£o ao mesmo tempo in√∫meros pacotes JavaScript de visualiza√ß√£o e o R inteiro, interagindo entre si e aceitando receber informa√ß√£o de usu√°rios em tempo real.\nPS: todos esses sites de exemplo foram feitos com R e apenas R, nenhum outro conhecimento foi pr√©-requisito.\nSe restou alguma d√∫vida se o R + Shiny √© uma grande alternativa √†s ferramentas de BI e Dashboards, por favor jogue nos coment√°rios para discutirmos!\n\r3. ggplot2 e tidyr tem tudo a ver\rA fun√ß√£o gather() do pacote tidyr √© frequentemente utilizada para deixar data.frames prontos para serem ‚Äúplotados‚Äù. Veja um exemplo:\nCorrela√ß√£o entre a vari√°vel mpg versus todas as outras do data.frame mtcars:\nlibrary(tidyr)\rlibrary(ggplot2)\rlibrary(dplyr)\rmtcars_para_grafico \u0026lt;- mtcars %\u0026gt;%\rgather(variavel, valor, -mpg)\rggplot(mtcars_para_grafico, aes(x = valor, y = mpg)) +\rgeom_point(aes(colour = variavel), show.legend = FALSE) +\rgeom_smooth(se = FALSE) +\rfacet_wrap(~variavel, scales = \u0026quot;free_x\u0026quot;)\rFrequentemente o que se quer √© construir um gr√°fico do mesmo tipo para diferentes colunas, por isso o gather() √© √∫til nesses casos. E o facet_wrap() do ggplot2 faz o servi√ßo de construir um gr√°fico para cada coluna.\n\r4. Web Scraping √© uma habilidade visada no mercado\rA internet √© uma fonta riqu√≠ssima de dados e s√£o as t√©cnicas de web scraping que permite ao analista explorar seu potencial por inteiro. Em resumo, Web scraping √© o ato de ‚Äúraspar‚Äù dados dispon√≠veis em sites da internet.\nOs dados s√£o o principal ingrediente para um bom modelo estat√≠stico e faz parte da responsabilidade do cientista de dados utilizar o m√°ximo de informa√ß√£o dispon√≠vel.\nCada vez mais as empresas est√£o reconhecendo o valor que os dados dispon√≠veis publicamente na internet t√™m. H√° empresas especializadas nisso e n√£o √© raro encontrar freelances envolvendo extra√ß√£o e estrutura√ß√£o de dados espalhados na rede.\nOs profissinais capazes de encarar esses desafios ainda s√£o esca√ßos, ent√£o fica a dica! Esse webinar dado pelo nosso professor Julio Trecenti √© um bom ponto de partida para aprender como fazer web scraping no R.\n\r5. Avalie muito bem o problema antes de decidir que se trata de um problema de BIG DATA\rBig Data √© um termo que ainda procura por uma defini√ß√£o oficial, mas j√° existe uma classe de obst√°culos que s√£o devidos a grandes volumes de dados. Ent√£o a pergunta primordial aqui √©: como saber se seu problema √© de Big Data?\n\r‚ÄúBig data is extremely overhyped and not terribly well defined. Many people think they have big data, when they actually don‚Äôt.‚Äù\r- Hadley Wickham\n\rComo Hadley Wickham aponta, muitas pessoas acham que possuem um problema de big data quando na verdade n√£o possuem. Ele resume o problema em tr√™s classes distintas:\nProblema de Big Data que na verdade √© um problema comum se for feita uma amostragem/sumariza√ß√£o apropriada.\r\rFerramentas apropriadas: hive, impala, terada, dplyr.\r90% dos problemas.\r\rProblema de Big Data que na verdade s√£o v√°rios problemas comuns. Exemplo: ajustar um modelo de regress√£o por indiv√≠duo, para milhares ou milh√µes de indiv√≠duos.\r\rParaleliza√ß√£o √© o que ser√° necess√°rio.\rFerramentas: foreach, doParallel, doMC, Spark, Hadoop.\r9% dos problemas.\r\rProblemas de Big Data que realmente dependem de todos os dados juntos no mesmo lugar.\r\rExemplo: sistemas de recomenda√ß√£o em que se faz necess√°rio a procura de rela√ß√µes bem raras e espec√≠ficas entre transa√ß√µes.\rFerramentas: geralmente sistemas dedicados e pr√≥prios para o problema.\r1% dos problemas.\r\r\rE quanto ao tamanho do dado propriamente dito, para n√≥s usu√°rios de R a regra de bolso √© simples:\n\rSe seus dados cabem na mem√≥ria, ent√£o √© ‚Äúsmall data‚Äù.\r\r\r6. Saber pedir ajuda √© o t√≥pico mais importante\rPor mais completo que seja um curso de R, nunca algu√©m chegar√° no ponto em que n√£o restar√° d√∫vidas sobre como fazer alguma coisa no R, at√© porque h√° novidades a cada minuto no mundo do R. Por isso aprender a pedir ajuda √© essencial. No curso foram passados os melhores jeitos de se obter ajuda:\n\rHelp / documenta√ß√£o do R (comandos help(funcao) ou ?funcao)\rGoogle\rStack Overflow\rColeginha\r\rUsem e abusem do fato de a comunidade R ser gigante e ativa.\n\r7. RMarkdown e Github v√£o bem no dia a dia do R-eiro\rA palavra de ordem aqui √© Organiza√ß√£o. RMarkdown ajuda a organizar melhor as ideias e conte√∫dos e o Github ajuda a organizar melhor os c√≥digos.\nRefer√™ncia para voc√™ aprender as ferramentas:\nRMarkdown, de autoria do nosso querid√≠ssimo RStudio Inc., transforma rascunho de c√≥digos em documentos apresent√°veis. Como j√° dito antes, todas as postagens deste blog s√£o feitas em RMarkdown.\nGithub oferece uma intelig√™ncia sobre o versionamento dos c√≥digos de um projeto. Isso permite que diversos colaboradores n√£o se percam nas milhares de contribui√ß√µes. N√£o existir√£o mais os arquivos_final_final_v5_com_novas_analises_definitivo3.docx e voc√™ ganhar√° no controle de quem, quando e o que foi alterado em cada uma das vers√µes.\nHoje em dia ele √© amplamente utilizado por empresas de tecnologia e est√° sendo cada vez mais comum em equipes de empresas mais tradicionais.\n\r8. Aprenda Regex\rRegular Expressions servem para descrever padr√µes de textos. Por exemplo, para pedir para o R encontrar ‚Äútodas as palavras que comecem com a letra A‚Äù em regex escrevemos str_detect(palavras, \"^A\"). O pequeno peda√ßo de s√≠mbolos \"^A\" √© a maneira de traduzir em regex o padr√£o ‚Äúpalavras que come√ßam em A‚Äù.\nPara quem quiser se aprofundar no assunto, consulte a documenta√ß√£o do regex no R: ?regex.\nOs pacotes stringi e stringr tiram proveito do regex e valem a pena serem explorados! Data mining passar√° a ser mam√£o com a√ß√∫car.\n\r9. D√™ prefer√™ncia aos funcionais em vez de for‚Äôs\rNa postagem Top 10 pacotes para Data Science foi destacado o pacote purrr e seu impacto ao fim do ‚Äúfor‚Äù nos c√≥digos de R.\n‚ÄúUsar funcionais‚Äù significa usar fun√ß√µes que aceitam fun√ß√µes como argumentos. Ambos os exemplos abaixo geram uma tabela para cada coluna do data.frame iris:\nvers√£o sem funcionais\ntabelas1 \u0026lt;- list()\rnomes_iris \u0026lt;- names(iris)\rfor(i in 1:length(iris)){\rtabelas1[[nomes_iris[i]]] \u0026lt;- table(iris[,i])\r}\rvers√£o com funcionais\ntabelas2 \u0026lt;- purrr::map(iris, table)\rDo exemplo acima notamos que:\n\rh√° um grande ganho de legibilidade do c√≥digo usando o funcional map() em vez de um for.\rn√£o foi preciso nenhum objeto auxiliar como tabelas1 \u0026lt;- list() e nomes_iris no segundo exemplo.\rn√£o h√° resqu√≠cios de √≠ndices como o i para percorrer vetores.\r\rQuanto mais aptid√£o em funcionais um usu√°rio tiver, mais √°gil e produtivo ele ser√°. Ent√£o aprendam funcionais!\n\r10. Coloque seus c√≥digos em fun√ß√µes\rColocar peda√ßos de c√≥digos, longos ou curtos, beneficia o desenvolvimento, a leitura e a manuten√ß√£o do c√≥digo. No R, fazer fun√ß√£o √© simples e sem burocracia, ent√£o n√£o h√° muito argumento para n√£o fazer!\rAlgumas dicas para identificar quando voc√™ precisa criar uma fun√ß√£o:\n\rExcesso de CTRL+C/CTRL+V da mesma coisa no c√≥digo, ‚Äús√≥ mudando umas coisinhas‚Äù. Essas ‚Äúcoisinhas‚Äù que mudam seriam os argumentos da sua fun√ß√£o.\rProjetos distintos reutilizando partes de c√≥digo de um projeto mais antigo.\rUm bloco de c√≥digo faz uma tarefa muito bem definida e que daria para colocar um nome para ela. Por exemplo, suponha que x \u0026lt;- c(1:10). Seria melhor de entender x %\u0026gt;% eh_par do que x %% 2 == 0.\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-04-08-top10-dicas-verao-2017/","tags":["Curso-R"],"title":"Top 10 dicas do Curso R de ver√£o 2017"},{"author":["Daniel"],"categories":["an√°lises"],"contents":"\rH√° bastante tempo tenho vontade de fazer an√°lises usando dados de multas de S√£o Paulo.\rO problema √©: estes dados est√£o dispon√≠veis? Na teoria, sim. Os dados de multas, como\rquantidade de multas por tipo de infra√ß√£o, dia e hor√°rio, e outros s√£o divulgados no\rportal da Mobilidade Segura da Prefeitura de S√£o Paulo. Na pr√°tica, √© um pouco\rdiferente. Apesar do site fornecer uma op√ß√£o de exporta√ß√£o, a tabela\rexportada n√£o √© completa e muitas informa√ß√µes ficam faltando. D√° bastante trabalho\rpara exportar todas as informa√ß√µes.\nPara n√£o ter o trabalho de exportar tabela por tabela, fiz uma requisi√ß√£o para a\rprefeitura, por meio da Lei de Acesso √† Informa√ß√£o, pedindo acesso direto ao banco de\rdados que fornece as informa√ß√µes para o Portal. A resposta foi a seguinte:\n\rPrezado Senhor Daniel, Agradecemos o contato e informamos que o seu pedido foi indeferido com fundamento no art. 16, inciso III, do Decreto n¬∫ 53.623/2012, pois a base de dados cont√©m informa√ß√µes pessoais que n√£o podem ser disponibilizadas a terceiros. Os demais dados encontram-se inseridos no Painel Mobilidade Segura para consulta pelos interessados com a possibilidade de exportar arquivos. Informamos ainda que na √©poca da sua solicita√ß√£o, os pain√©is se encontravam atualizados, visto que a atualiza√ß√£o mensal ocorre ap√≥s os 70 dias da data da infra√ß√£o\n\rA resposta ao meu ver √© totalmente contradit√≥ria: ao mesmo tempo que eu n√£o posso\rreceber os dados porque eles s√£o confidenciais, eu posso obt√™-los pelo site, que\r‚Äúoferece possibilidade de exporta√ß√£o de arquivos‚Äù. (???)\nAntes mesmo de pedir acesso ao banco de dados tinha pensado em desenvolver um\rwebscrapper para fazer o download autom√°tico das planilhas, mas a tecnologia com\ra qual o portal foi desenvolvido (QlikView) dificulta muito o desenvolviento.\nSobrou fazer o download manual mesmo. At√© agora fiz o download de todos as planilhas\rde 2014 a 2016 contendo infra√ß√µes capturadas tanto eletr√¥nica quanto manualmente\rde carros (ainda faltam √¥nibus, utilit√°rios, etc.) por hora do dia. Isso quer dizer\rque j√° temos planilhas suficientes para criar uma tabela:\n\rtipo de ve√≠culo (sempre seria carro)\rdata (2014 a 2016)\rhora do dia\reletronica/manual\rmotivo da multa\rlocalizacao da multa (quando for um radar)\rquantidade de multas\r\rDisponibilizei esses dados neste reposit√≥rio\rdo Github.\nAgora com as an√°lises a seguir, espero criar curiosidade e interesse para que mais\rpessoas possam ajudar no download completo dos dados. Na p√°gina inicial do\rreposit√≥rio, adicionei, um mini-tutorial de como voc√™ pode ajudar fazendo os\rdownloads.\nVamos √†s an√°lises.\nObter os dados\rdownload.file(\u0026quot;https://github.com/dfalbel/spmultas/raw/master/data/carros_eletronicas.rda\u0026quot;, \u0026quot;carros_eletronicas.rda\u0026quot;)\rload(\u0026quot;carros_eletronicas.rda\u0026quot;)\rA partir de agora, voc√™ possui carregado um data.frame chamado carros_eletronicas\rque possui as informa√ß√µes das multas para carros de forma eletr√¥nica.\nEm primeiro lugar, vamos analisar a quantidade de multas por dia em S√£o Paulo desde\r2014.\n\rVisualizar a s√©rie\rcarros_summary \u0026lt;- carros_eletronicas %\u0026gt;%\rgroup_by(data) %\u0026gt;%\rsummarise(qtd = sum(qtd))\rcarros_summary %\u0026gt;%\rggplot(aes(data, qtd)) +\rgeom_line()\rVemos nesse gr√°fico que o n√∫mero de multas (por radar) era sempre por volta de 10.000\rdurante 2014, em 2015 foi aumentando bastante durante o ano e em 2016 se estabilizou.\rVamos ver agora, por tipo de enquadramento, isto √©, por motivo da multa.\nExistem 11 tipos de enquadramentos eletr√¥nicos. Para a visualiza√ß√£o ficar mais f√°cil,\rvamos primeiro agrupar em grandes temas:\n\rAvan√ßar o sinal vermelho\rExecutar convers√£o proibida\rParar sobre faixa de pedestres\rRod√≠zio\rVelocidade\rTransitar em faixa de √¥nibus ou exclusiva p/ determinado ve√≠culo\r\rO agrupamento final ficou assim:\ndepara \u0026lt;- carros_eletronicas %\u0026gt;%\rgroup_by(enquadramento) %\u0026gt;%\rsummarise(qtd = sum(qtd)) %\u0026gt;%\rarrange(qtd) %\u0026gt;%\rselect(-qtd)\rdepara$agrup_enquadramento \u0026lt;- c(\r\u0026quot;Convers√£o proibida\u0026quot;, \u0026quot;Velocidade\u0026quot;, \u0026quot;Faixa de Pedestres\u0026quot;,\r\u0026quot;Faixa de √¥nibus\u0026quot;, \u0026quot;Sinal vermelho\u0026quot;, \u0026quot;Faixa de √¥nibus\u0026quot;,\r\u0026quot;Convers√£o proibida\u0026quot;, \u0026quot;Faixa de √¥nibus\u0026quot;, \u0026quot;Velocidade\u0026quot;,\r\u0026quot;Rod√≠zio\u0026quot;, \u0026quot;Velocidade\u0026quot;)\rdepara %\u0026gt;%\rknitr::kable()\rcarros_summary_enquad \u0026lt;- carros_eletronicas %\u0026gt;%\rleft_join(depara, by = \u0026quot;enquadramento\u0026quot;) %\u0026gt;%\rgroup_by(data, agrup_enquadramento) %\u0026gt;%\rsummarise(qtd = sum(qtd))\rcarros_summary_enquad %\u0026gt;%\rungroup() %\u0026gt;%\rggplot(aes(data, qtd, color = agrup_enquadramento)) +\rgeom_line()\rNo gr√°fico, vemos que em 2015, o tipo de multa que mais aumentou em quantidade foi\rvelocidade e rod√≠zio.\n\rCuriosidades\rAnteriormente vimos como se comportou o n√∫mero de multas de maneira geral na cidade.\rVamos agora matar algumas curiosidades.\nQuais s√£o os hor√°rios com mais multas em SP?\r\rcarros_summary_hora \u0026lt;- carros_eletronicas %\u0026gt;%\rgroup_by(hora) %\u0026gt;%\rsummarise(qtd = sum(qtd))\rcarros_summary_hora %\u0026gt;%\rggplot(aes(x = hora, y = qtd)) +\rgeom_bar(stat = \u0026quot;identity\u0026quot;)\rNotamos que o maior n√∫mero de multas ocorre justamente na hora do rush. Isto √©,\rentre 7 e 10 da manh√£ e 17h e 19h. Isso at√© faz sentido, mas nessas horas o tr√¢nsito\rda cidade est√° todo parado. Ser√° que a distribui√ß√£o fica diferente por tipo de multa?\rPrincipalmente as de velocidade.\ncarros_depara_enquad \u0026lt;- carros_eletronicas %\u0026gt;%\rleft_join(depara, by = \u0026quot;enquadramento\u0026quot;) %\u0026gt;%\rgroup_by(hora, agrup_enquadramento) %\u0026gt;%\rsummarise(qtd = sum(qtd))\rcarros_depara_enquad %\u0026gt;%\rggplot(aes(x = hora, y = qtd, fill = agrup_enquadramento)) +\rgeom_bar(stat = \u0026quot;identity\u0026quot;)\rVeja que interessante! O grande respons√°vel pelo pico da hora do rush √© o rod√≠zio.\r(Essa √© justamente a hora em que ele est√° valendo.) As multas de velocidade diminuem\rum pouco durante o tr√¢nsito e acontecem mais durante o dia e n√£o durante a noite\rcomo poder√≠amos imaginar. Vemos tamb√©m que as multas de farol vermelho acontecem mais\rdurante a madrugada.\nQual √© o dia da semana com mais multas?\r\rcarros_depara_enquad_wday \u0026lt;- carros_eletronicas %\u0026gt;%\rleft_join(depara, by = \u0026quot;enquadramento\u0026quot;) %\u0026gt;%\rgroup_by(dia_da_semana = wday(data), agrup_enquadramento) %\u0026gt;%\rsummarise(qtd = sum(qtd))\rcarros_depara_enquad_wday %\u0026gt;%\rggplot(aes(x = dia_da_semana, y = qtd, fill = agrup_enquadramento)) +\rgeom_bar(stat = \u0026quot;identity\u0026quot;)\rO dia da semana com mais multas √© quinta feira. Nos finais de semana, aumenta muito\ro n√∫mero de multas por excesso de velocidade (claro, as ruas est√£o mais vazias).\nQuais s√£o os radares que mais multam em SP? E porque?\r\rtop10_locais \u0026lt;- carros_eletronicas %\u0026gt;%\rgroup_by(local) %\u0026gt;%\rsummarise(n = sum(qtd)) %\u0026gt;%\rarrange(desc(n)) %\u0026gt;%\rslice(1:10)\rknitr::kable(top10_locais)\rAgora vamos ver os motivos, em cada um desses lugares.\ntop10_motivos \u0026lt;- top10_locais %\u0026gt;%\rleft_join(carros_eletronicas, by = \u0026quot;local\u0026quot;) %\u0026gt;%\rleft_join(depara, by = \u0026quot;enquadramento\u0026quot;) %\u0026gt;%\rmutate(local = stringr::str_wrap(local, width = 20) %\u0026gt;%\rforcats::fct_reorder(-n)) %\u0026gt;%\rgroup_by(local, agrup_enquadramento) %\u0026gt;%\rsummarise(qtd = sum(qtd))\rtop10_motivos %\u0026gt;%\rggplot(aes(x = local, y = qtd, fill = agrup_enquadramento)) +\rgeom_bar(stat = \u0026quot;identity\u0026quot;)\rPor incr√≠vel que pare√ßa, nos dois radares com mais multas, o motivo da multa √© convers√£o proibida.\rA foto de onde fica esse radar saiu em uma not√≠cia sobre o mesmo tema na Folha de\rS√£o Paulo.\n\r","permalink":"https://blog.curso-r.com/posts/2017-04-01-multas-em-sp/","tags":["sptrans"],"title":"Multas em S√£o Paulo"},{"author":["Julio"],"categories":["conceitos"],"contents":"\rNo mundo do web scraping, muitas vezes precisamos acessar sites HTTPS, a vers√£o Segura do HTTP (Hyper Text Transfer Protocol). Esse protocolo √© utilizado para encriptar as mensagens trocadas por usu√°rio e servidor.\nO pacote httr utiliza um padr√£o SSL (Secure Sockets Layer) para lidar com HTTPS. O SSL nada mais √© que uma forma de informar ao servidor que voc√™ √© voc√™, garantindo que suas mensagens s√≥ possam ser interpretadas por esse servidor, e vice-versa. O padr√£o do httr funciona bem para a maioria dos sites, permitindo o acesso sem sofrimento.\nNo entanto, alguns sites d√£o o seguinte erro:\nhttr::GET(\u0026quot;https://esaj.tjsp.jus.br\u0026quot;)\r## Response [https://esaj.tjsp.jus.br/esaj/portal.do?servico=740000]\r## Date: 2022-07-13 18:39\r## Status: 200\r## Content-Type: text/html;charset=ISO-8859-1\r## Size: 71.4 kB\r## ## ## ## ## ## ## ## ## \u0026lt;!DOCTYPE html PUBLIC \u0026quot;-//W3C//DTD XHTML 1.0 Transitional//EN\u0026quot; \u0026quot;http://www.w3...\r## ## ...\rA solu√ß√£o para esse problema √© bem simples. Basta mandar o httr ignorar o protocolo SSL usando a fun√ß√£o httr::config(). Ignorar o SSL costuma ser uma m√° ideia, pois faz com que as mensagens entre usu√°rio e servidor voltem a ser em texto puro, como se fosse HTTP. Mas no web scraping isso n√£o √© exatamente um problema.\nPara solucionar o problema acima, rode:\nhttr::GET(\u0026quot;https://esaj.tjsp.jus.br\u0026quot;, httr::config(ssl_verifypeer = FALSE))\r## Response [https://esaj.tjsp.jus.br/esaj/portal.do?servico=740000]\r## Date: 2022-07-13 18:39\r## Status: 200\r## Content-Type: text/html;charset=ISO-8859-1\r## Size: 71.4 kB\r## ## ## ## ## ## ## ## ## \u0026lt;!DOCTYPE html PUBLIC \u0026quot;-//W3C//DTD XHTML 1.0 Transitional//EN\u0026quot; \u0026quot;http://www.w3...\r## ## ...\rE‚Ä¶ Feliz web scraping!\nOBS: Certa vez um amigo teve problema com SSL mesmo tentando a solu√ß√£o acima numa m√°quina com Ubuntu Resolvemos o problema reinstalando a biblioteca libcurl4-openssl-dev via apt-get e o pacote curl do R. Assim:\nNo terminal:\nsudo apt-get update\rsudo apt-get install libcurl4-openssl-dev\rNo R:\ninstall.packages(\u0026#39;curl\u0026#39;)\r","permalink":"https://blog.curso-r.com/posts/2017-03-31-ssl/","tags":["Web scraping","SSL"],"title":"Requisi√ß√µes seguras"},{"author":["Athos"],"categories":["an√°lises"],"contents":"\rNo dia em que fui ao Lollapalooza eu descobri o Rspotify, um wraper da API do Spotify e da√≠ me veio a ideia de juntar infos dos dois assuntos.\nA brincadeira aqui vai envolver\n\rWeb Scraping - para baixar e estruturar as tabelas de programa√ß√£o do Lolapalooza SP 2017\rAPI do Spotify - por meio do pacote Rspotify\rtodos os pacotes do tidyverse\r\rLollapalooza deste ano em S√£o Paulo contou com 47 bandas distribu√≠das em quatro palcos. A gra√ßa √© associar a programa√ß√£o do Lolla com as informa√ß√µes de popularidade das bandas fornecidas pelo Spotify. Abaixo eu vou descrever como peguei os dados, listar as tr√™s hip√≥teses que criei e gerar alguns gr√°ficos pra discut√≠-las.\nBase de dados\rPr√©-requisitos\rPacotes\n# instala o Rspotify\rif(!require(\u0026quot;Rspotify\u0026quot;))\rdevtools::install_github(\u0026quot;tiagomendesdantas/Rspotify\u0026quot;)\rlibrary(Rspotify)\rlibrary(magrittr)\rlibrary(forcats)\rlibrary(stringi)\rlibrary(lubridate)\rlibrary(httr)\rlibrary(rvest)\rlibrary(tidyverse)\rO Rspotify √© um pacote novo e que ainda n√£o est√° no CRAN, mas j√° est√° funcional.\nConta no Spotify\nPara utilizar a API do Spotify √© necess√°rio ter um cadastro no site deles, como se pode imaginar.\nApp no Spotify\nPara voc√™ receber um c√≥digo de acesso para usar a API deles √© preciso criar um App dentro da sua conta do Spotify, esse √© o pr√©-requisito mais burocr√°tico de todos. Eu aprendi a fazer isso seguindo os passos do README do pr√≥prio pacote Rspotify no Github (veja aqui).\nNo fim, voc√™ ter√° um app_id, um client_id e um client_secret em m√£os.\n\rExtraindo programa√ß√£o do Lollapalooza SP 2017\rO objetivo aqui √© termos uma vers√£o em data.frame das tabelas contidas no site lollapaloozabr.com/lineup-horarios/. L√° tem a agenda completa dos dois dias do evento.\nVamos ao c√≥digo! Dica: a melhor maneira de aprender o que cada passo do c√≥digo faz √© ir rodando linha a linha e observando o resultado.\n# programacao do site do lollapalooza 2017 ----------------------\rlolla2017_programacao \u0026lt;- \u0026quot;https://www.lollapaloozabr.com/lineup-horarios/\u0026quot; %\u0026gt;%\rGET() %\u0026gt;%\rread_html() %\u0026gt;%\rhtml_table() %\u0026gt;%\rset_names(c(\u0026quot;sabado\u0026quot;, \u0026quot;domingo\u0026quot;)) %\u0026gt;%\rat_depth(2, ~ .x %\u0026gt;%\rstri_replace_all_regex(\u0026quot; {2,}\u0026quot;, \u0026quot;\u0026quot;) %\u0026gt;%\rstri_replace_all_regex(\u0026quot;[\\\\n]{1}\u0026quot;, \u0026quot;,\u0026quot;) %\u0026gt;%\rstri_replace_all_regex(\u0026quot;[,]{2,}\u0026quot;, \u0026quot;\\\\\\n\u0026quot;) %\u0026gt;%\rread.csv(text = ., header = FALSE,\rcol.names = c(\u0026quot;artist\u0026quot;, \u0026quot;hora\u0026quot;))) %\u0026gt;%\rmap(~ .x[-1] %\u0026gt;%\rdata_frame(palco = names(.), programacao_palco = .) %\u0026gt;%\runnest(programacao_palco)) %\u0026gt;%\rdata_frame(dia = names(.), programacao = .) %\u0026gt;%\runnest(programacao) %\u0026gt;%\rseparate(hora, c(\u0026quot;hora_ini\u0026quot;, \u0026quot;hora_fim\u0026quot;), sep = \u0026quot;-\u0026quot;) %\u0026gt;%\rmutate(artist = artist %\u0026gt;% tolower,\rhora_ini = paste(if_else(dia %in% \u0026quot;sabado\u0026quot;, \u0026quot;2017-03-25\u0026quot;, \u0026quot;2017-03-26\u0026quot;), hora_ini) %\u0026gt;% ymd_hm(),\rhora_ini = if_else(hour(hora_ini) \u0026lt; 12, hora_ini + hours(12), hora_ini),\rhora_fim = paste(if_else(dia %in% \u0026quot;sabado\u0026quot;, \u0026quot;2017-03-25\u0026quot;, \u0026quot;2017-03-26\u0026quot;), hora_fim) %\u0026gt;% ymd_hm(),\rhora_fim = if_else(hour(hora_fim) \u0026lt; 12, hora_fim + hours(12), hora_fim),\rdia = fct_relevel(dia, c(\u0026quot;sabado\u0026quot;, \u0026quot;domingo\u0026quot;)))\rResultado\n\r\r\r\rdia\rpalco\rartist\rhora_ini\rhora_fim\r\r\r\rsabado\rPalco Skol\rcage the elephant\r2017-03-25 16:25:00\r2017-03-25 17:25:00\r\rsabado\rPalco Skol\rmetallica\r2017-03-25 21:00:00\r2017-03-25 23:00:00\r\rsabado\rPalco Skol\rdoctor pheabes\r2017-03-25 12:05:00\r2017-03-25 13:05:00\r\rsabado\rPalco Skol\rrancid\r2017-03-25 18:35:00\r2017-03-25 19:35:00\r\rsabado\rPalco Skol\rsuricato\r2017-03-25 14:15:00\r2017-03-25 15:15:00\r\rsabado\rPalco Onix\rthe 1975\r2017-03-25 17:30:00\r2017-03-25 18:30:00\r\rsabado\rPalco Onix\rthe outs\r2017-03-25 13:10:00\r2017-03-25 14:10:00\r\rsabado\rPalco Onix\rthe xx\r2017-03-25 19:40:00\r2017-03-25 20:55:00\r\r\r\r√â interessante reparar que para gerar essa simples tabelinha utilizamos os pacotes httr, rvest, purrr, dplyr, tidyr, lubridate, stringi e forcats. S√≥ faltou o ggplot2 para zerar o tidyverse.\nOBS: 89 fm n√£o √© uma banda, era s√≥ um espa√ßo reservado para fins de publicidade da r√°dio.\n\rExtraindo a popularidade das bandas do Lollapalooza no Spotify\rAgora vamos usar o pacote Rspotify para extrair as popularidades das bandas que est√£o listadas no data.frame lolla2017_programacao. Para tanto, usei uma playlist oficial no Spotify feita pela pr√≥pria equipe do Lollapalooza. Essa playlist √© identificada pelo id 1mHoPn6JpbtWtoBuvSXrVm l√° no banco de dados do Spotify.\nmeu_token \u0026lt;- spotifyOAuth(app_id, client_id, client_secret) # coloque aqui suas infos fornecidas pelo Spotify.\rlolla2017_playlist \u0026lt;- getPlaylistSongs(\u0026quot;lollabr\u0026quot;, \u0026quot;1mHoPn6JpbtWtoBuvSXrVm\u0026quot;, token = meu_token) %\u0026gt;%\rmutate(artistInfo = map(artistId, getArtistinfo),\rartist = artist %\u0026gt;% tolower) %\u0026gt;%\rrename(track_popularity = popularity,\rtrack_id = id) %\u0026gt;%\runnest(artistInfo) %\u0026gt;%\rselect(artist, id, name, popularity, followers)\rAlgumas bandas ficaram de fora da playlist e por isso fiz uma pesquisa por nome do artista na pr√≥pria API do Spotify para recuperar o respectivo id. A fun√ß√£o que faz isso √© a searchArtist().\n# recuperando infos dos artistas esquecidos pela playlist ----------------------\rpossibly_searchArtist \u0026lt;- possibly(searchArtist, NA_character_)\rartistas_fora_da_playlist \u0026lt;- lolla2017_programacao %\u0026gt;%\rfilter(!artist %in% lolla2017_playlist$artist) %$%\rartist %\u0026gt;%\rdata_frame(artist = .) %\u0026gt;%\rmutate(search_artist = map(artist, ~ .x %\u0026gt;% possibly_searchArtist),\rartist_info = map2(search_artist, artist, ~ {\rif(.x %\u0026gt;% is.na) {data.frame(search_artist = NA)} else {\r.x %\u0026gt;%\rmutate(name = name %\u0026gt;% tolower) %\u0026gt;%\rfilter(name %in% .y) %\u0026gt;%\rhead(1)\r}})) %\u0026gt;%\rselect(-search_artist) %\u0026gt;%\runnest(artist_info) %\u0026gt;%\rselect(artist, id, name, popularity, followers)\rResultado\n\r\r\rartist\rid\rname\rpopularity\rfollowers\r\r\r\rricci\r1EUMh6DZo2CfpolG75YQBL\rricci\r49\r6116\r\rjimmy eat world\r3Ayl7mCk0nScecqOzvNp6s\rjimmy eat world\r66\r361785\r\r89 fm\rNA\rNA\rNA\rNA\r\rmartin garrix\r60d24wfXkVzDSfLS6hyCjZ\rmartin garrix\r85\r2244761\r\rillusionize\r3RloA7E4XMItSP4FjMBv3L\rillusionize\r46\r30054\r\r\r\r\rJuntando tudo\rAgora vamos juntar a programa√ß√£o do Lolla com as infos do Spotify. A chave √© artist.\nlolla2017 \u0026lt;- left_join(lolla2017_programacao,\rlolla2017_playlist %\u0026gt;% bind_rows(artistas_fora_da_playlist),\rby = \u0026quot;artist\u0026quot;) %\u0026gt;%\rselect(-id, -name) %\u0026gt;%\rdplyr::filter(followers %\u0026gt;% is.na %\u0026gt;% not)\rBase final\n\r\r\rdia\rpalco\rartist\rhora_ini\rhora_fim\rpopularity\rfollowers\r\r\r\rsabado\rPalco Skol\rcage the elephant\r2017-03-25 16:25:00\r2017-03-25 17:25:00\r72\r745453\r\rsabado\rPalco Skol\rmetallica\r2017-03-25 21:00:00\r2017-03-25 23:00:00\r80\r3047126\r\rsabado\rPalco Skol\rdoctor pheabes\r2017-03-25 12:05:00\r2017-03-25 13:05:00\r20\r313\r\rsabado\rPalco Skol\rrancid\r2017-03-25 18:35:00\r2017-03-25 19:35:00\r60\r220182\r\rsabado\rPalco Skol\rsuricato\r2017-03-25 14:15:00\r2017-03-25 15:15:00\r41\r52326\r\rsabado\rPalco Onix\rthe 1975\r2017-03-25 17:30:00\r2017-03-25 18:30:00\r77\r1600845\r\rsabado\rPalco Onix\rthe outs\r2017-03-25 13:10:00\r2017-03-25 14:10:00\r28\r3788\r\rsabado\rPalco Onix\rthe xx\r2017-03-25 19:40:00\r2017-03-25 20:55:00\r76\r2383923\r\r\r\r\r\rResultados\rHip√≥tese I\r\rHip√≥tese I: a organiza√ß√£o usou a estrat√©gia de distribuir a popularidade das bandas uniformemente no dia.\n\rUm dos v√°rios desafios log√≠sticos que o evento tem √© a aloca√ß√£o das bandas na grade hor√°ria nos quatro diferentes palcos.\nEu fui no evento no s√°bado e ouvi falar que a banda Cage The Elephant tinha sido uma das primeiras bandas a se apresentar. Sabia da popularidade da banda (segundo o Spotify, est√° mais popular do que The Strokes) e na hora estranhei a decis√£o do evento de coloc√°-los para tocar t√£o cedo.\nlolla2017_grafico \u0026lt;- lolla2017 %\u0026gt;%\rmutate(hora = map2(hora_ini, hora_fim, ~ seq(.x, .y, 30*60) %\u0026gt;% floor_date(\u0026quot;30 minutes\u0026quot;))) %\u0026gt;%\runnest(hora) %\u0026gt;%\rgroup_by(dia, hora, palco) %\u0026gt;%\rsummarise(artist = first(artist),\rn = n(),\rmean_popularity = mean(popularity))\r## `summarise()` has grouped output by \u0026#39;dia\u0026#39;, \u0026#39;hora\u0026#39;. You can override using the\r## `.groups` argument.\rlolla2017_grafico %\u0026gt;%\rggplot(aes(x = ymd_hm(format(hora, \u0026quot;2017-03-26 %H%M\u0026quot;)), y = mean_popularity, colour = palco)) +\rgeom_line() +\rgeom_point() +\rgeom_point(data = lolla2017_grafico %\u0026gt;% filter(artist %in% \u0026quot;cage the elephant\u0026quot;), colour = \u0026quot;red\u0026quot;, size = 2) +\rgeom_text(data = lolla2017_grafico %\u0026gt;% filter(artist %in% \u0026quot;cage the elephant\u0026quot;) %\u0026gt;% head(1), aes(label = artist), colour = \u0026quot;red\u0026quot;, hjust = 0, vjust = -1) +\rfacet_wrap(~dia) +\rlabs(x = \u0026quot;Hora do dia\u0026quot;, y = \u0026quot;Popularidade m√©dia\u0026quot;) +\rtheme(text = element_text(size = 16))\rO gr√°fico acima vai de acordo com o senso comum de que os populares ficam para o final, n√£o ajudando a confirmar a hip√≥tese de que o Cage The Elefant estava mal posicionado.\n\rHip√≥tese II\r\rHip√≥tese II: em termos de popularidade das bandas, o dia de domingo estava melhor do que o dia de s√°bado.\n\rEm conversas com amigos e conhecidos reparei que a maioria ou iria no domingo ou preferiria ir no domingo caso tivesse oportunidade. Isso me fez levantar a d√∫vida se realmente havia maior concentra√ß√£o de bandas boas no domingo.\nggplot(lolla2017 %\u0026gt;%\rmutate(artist = artist %\u0026gt;% fct_reorder(popularity, .desc = TRUE))) +\rgeom_bar(aes(x = artist, y = popularity, fill = dia), stat = \u0026quot;identity\u0026quot;, position = \u0026quot;dodge\u0026quot;) +\rtheme(text = element_text(size = 16),\raxis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.4))\rggplot(lolla2017) +\rgeom_density(aes(fill = dia, x = popularity, colour = dia), fill = NA) +\rtheme(text = element_text(size = 16),\raxis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.4))\rConclus√£o: nada indica que houve desbalanceamento. Acho que meu c√≠rculo de amigos tem algum vi√©s estranho.\n\rHip√≥tese III\r\rHip√≥tese III: a popularidade das bandas nos diferentes palcos estava equilibrada.\n\rQuando me questionei da hip√≥tese I tamb√©m pensei na dificuldade de posicionar as bandas nos diferentes palcos. J√° que teriam milhares de pessoas disputando espa√ßo, seria do interesse da organiza√ß√£o deix√°-los o mais espalhado poss√≠vel por v√°rios motivos: melhor fluxo das filas, maior conforto, menos risco de acidentes, entre outros, e um bom jeito de fazer isso seria deixando os palcos igualmente atrativos para n√£o haver uma grande aglomera√ß√£o em um √∫nico ponto.\nggplot(lolla2017 %\u0026gt;%\rmutate(palco = palco %\u0026gt;% as.factor %\u0026gt;% fct_reorder(popularity, mean))) +\rgeom_boxplot(aes(fill = palco, y = popularity, x = 1)) +\rtheme(text = element_text(size = 16),\raxis.text.x = element_blank()) +\rlabs(x = \u0026quot;\u0026quot;)\rO palco Skol teve menor varia√ß√£o de popularidade, costumou contar sempre com artistas de m√©dia a alta popularidade, mas os palcos AXE e Onix foram visitados por artista de peso. O palco Perry‚Äôs foi o mais visitado por artistas de menor express√£o.\n\r\rConsidera√ß√µes finais\rO tema tratado aqui n√£o foi √∫til, concordo, mas passamos por quase todas as etapas existentes em um processo t√≠pico de an√°lise de dados. Fizemos web scraping, usamos APIs, arrumamos os dados, estruturamos as informa√ß√µes, criamos vari√°veis e geramos gr√°ficos. S√≥ ficou de fora a parte de modelagem. E n√£o √† toa todos os pacotes do tidyverse foram √∫teis nesse trabalho.\nA li√ß√£o pra casa √© encontrar uns dados interessantes na internet e aplicar as etapas que aprendemos aqui!\n\r","permalink":"https://blog.curso-r.com/posts/2017-03-27-lollapalooza-sp-2017-segundo-spotify/","tags":["spotify","lolapalooza","API"],"title":"Lollapalooza segundo o Spotify"},{"author":["William"],"categories":["tutoriais"],"contents":"\rO pacote knitr √© um mecanismo r√°pido, elegante e flex√≠vel para gerar relat√≥rios din√¢micos no R. Ele trabalha lado a lado com o rmarkdown para transformar arquivos .Rmd em diversos formatos, como html, pdf e at√© mesmo word. Misturando chunks de c√≥digo em R com texto puro, LaTeX e html, a tarefa de criar outputs para an√°lises estat√≠sticas no R ficou muito mais simples.\nQuando estamos trabalhando com arquivos Rmarkdown no Rstudio, o diret√≥rio de trabalho √© a pr√≥pria pasta onde o Rmd est√° salvo. Assim, se o nosso relat√≥rio tem algum input (banco de dados, arquivos com c√≥digo em R ou imagens, por exemplo), esses arquivos precisam estar nessa pasta. Isso pode ser uma chatea√ß√£o se voc√™ est√° dentro de um projeto e organizou os arquivos de forma diferente: banco de dados em uma pasta, .R em outra, imagens em outra, outputs em outra‚Ä¶\nA primeira ideia que vem √† cabe√ßa √© usar a fun√ß√£o setwd() dentro de algum chunk para mudar o diret√≥rio de trabalho dentro do arquivo Rmd. No entanto, se fizermos isso, o diret√≥rio de trabalho ser√° mudado para aquele chunk, mas voltar√° a ser a pasta do arquivo .Rmd ap√≥s a sua execu√ß√£o. Veja o warning abaixo.\nsetwd(\u0026#39;../\u0026#39;)\r# Warning message: you changed the working directory\r# to C:/novo_diretorio (probably via setwd()).\r# It will be restored to C:/diretorio_do_Rdm.\r# See the Note section in ?knitr::knit.\rLendo a se√ß√£o ‚ÄúNote‚Äù do ?knitr:knit, verificamos que mudar o diret√≥rio de trabalho via setwd() pode levar a terr√≠veis consequ√™ncias. Basicamente, figuras e arquivos de cache podem ser salvos no lugar errado, e o seu relat√≥rio n√£o ser√° gerado corretamente. Ainda lendo a se√ß√£o ‚ÄúNote‚Äù, encontramos a maneira correta de mudar o diret√≥rio de trabalho: setar a op√ß√£o opts_knit$set(root.dir = ...).\nopts_knit$set(root.dir = \u0026#39;../\u0026#39;)\rVale ainda ressaltar que a mudan√ßa do diret√≥rio s√≥ vai ser definida para os chunks seguintes, isto √©, se voc√™ fizer a mudan√ßa opts_knit$set(root.dir = '../') e, no mesmo chunk, tentar ler um arquivo no diret√≥rio pai (source(input.R), por exemplo), o arquivo n√£o vai ser encontrado.\n","permalink":"https://blog.curso-r.com/posts/2017-03-25-knitr-mudando-diretorio-de-trabalho/","tags":["R Markdown","knitr"],"title":"Knitr: mudando o diret√≥rio de trabalho"},{"author":["William"],"categories":["an√°lises"],"contents":"\rH√° alguns anos eu acompanho o canal Porta dos fundos no YouTube, assistindo os v√≠deos quase sempre no dia de lan√ßamento. Mesmo dividido entre esquetes boas e ruins, me considero um f√£ da trupe de humoristas (e do Totoro tamb√©m), principalmente pelo humor sarc√°stico e pela satiriza√ß√£o de diversos tabus da nossa sociedade.\nNos √∫ltimos meses, no entanto, meu entusiasmo com o canal vem diminuindo. A necessidade de postar tr√™s v√≠deos por semana para se manter relevante no sistema de recomenda√ß√µes do YouTube, o que mant√©m o canal rent√°vel, me faz perdoar um ou outro conte√∫do sem gra√ßa ou rasteiro, mas sinto que o que era exce√ß√£o come√ßou a virar regra.\nN√£o sei se eu que fiquei chato ou se outras pessoas compartilham a minha opini√£o. Ent√£o resolvi scrapear informa√ß√µes do canal e montar algumas visualiza√ß√µes para tirar essa d√∫vida.\nSegue um passo a passo de como fiz isso utilizando o R.\nPasso 1: instalar e configurar o pacote tuber\rO pacote tuber cont√©m fun√ß√µes que permitem acessar a API do YouTube utilizando o R. Assim, podemos ter acesso a diversas estat√≠sticas como n√∫mero de likes, n√∫mero de views, coment√°rios de v√≠deos, entre outras.\nPara instalar o pacote, rode o c√≥digo install.packages(\"tuber\") ou devtools::install_github(\"soodoku/tuber\", build_vignettes = TRUE) para baixar a vers√£o de desenvolvimento mais recente.\nPara utilizar o tuber √© preciso um id e um secret do Console de Desenvolvimento da Google. Ap√≥s criar uma conta, basta habilitar todas as APIs do YouTube e a Freebase API.\nFeito isso, rode o c√≥digo abaixo com o id e secret obtidos pela plataforma para configurar o acesso do tuber √† API.\nlibrary(tuber)\ryt_oauth(app_id = \u0026quot;seu_app_id\u0026quot;,\rapp_secret = \u0026quot;seu_app_secret\u0026quot;)\rSe tudo foi configurado corretamente, ele abrir√° uma aba no seu navegador confirmando a autentica√ß√£o, e voc√™ poder√° voltar ao R para come√ßar a scrapear.\n\rPasso 2: buscar o id dos v√≠deos do canal\rPara organizar as informa√ß√µes dos v√≠deos em um banco de dados e gerar as visualiza√ß√µes, vamos utilizar as seguintes bibliotecas.\nlibrary(dplyr) # Manipula√ß√£o de dados\rlibrary(tidyr) # Manipula√ß√£o de dados\rlibrary(tibble) # Cria√ß√£o de dataframes\rlibrary(lubridate) # Manipula√ß√£o de datas\rlibrary(purrr) # Funcionais\rlibrary(ggplot2) # Gr√°ficos\rPrecisamos do id de cada v√≠deo do Porta dos Fundos para baixar as suas estat√≠sticas. A fun√ß√£o tuber::yt_search() pesquisa por v√≠deos e suas informa√ß√µes. Rodando yt_search(term = \"Porta dos fundos\"), obtemos informa√ß√µes de alguns v√≠deos do canal, inclusive que o seu channel id √© ‚ÄúUCEWHPFNilsT0IfQfutVzsag‚Äù. O channel id √© essencial para obtermos todos os v√≠deos do Porta.\nPor default, a fun√ß√£o yt_search() retorna no m√°ximo 50 resultados. Contudo, se setarmos os par√¢metros type = \"video\" e channal_id = \"id_de_algum_canal\", o n√∫mero m√°ximo passa a ser 500 resultados.\nPara facilitar o trabalho, eu criei a fun√ß√£o get_videos_porta(). Ela recebe uma data de in√≠cio e de t√©rmino (em um dataframe com apenas uma linha) e devolve todos os v√≠deos do canal Porta dos Fundos nesse per√≠odo.\nget_videos_porta \u0026lt;- function(dates) {\ryt_search(term = \u0026quot;\u0026quot;,\rtype = \u0026quot;video\u0026quot;,\rchannel_id = \u0026quot;UCEWHPFNilsT0IfQfutVzsag\u0026quot;,\rpublished_after = dates$start,\rpublished_before = dates$end)\r}\rCada linha do dataframe de datas a seguir representa per√≠odos de um ano, de 2012 a 2017. Isso implica que, em cada busca, vou receber os v√≠deos do Porta dos Fundos para cada um desses anos. O mutate formata as datas no padr√£o exigido pela fun√ß√£o yt_search(). Veja help(yt_search) para mais informa√ß√µes.\ndates \u0026lt;- tibble(start = seq(ymd(\u0026quot;2012-01-01\u0026quot;), ymd(\u0026quot;2017-01-01\u0026quot;), by = \u0026quot;years\u0026quot;),\rend = seq(ymd(\u0026quot;2012-12-31\u0026quot;), ymd(\u0026quot;2017-12-31\u0026quot;), by = \u0026quot;years\u0026quot;)) %\u0026gt;%\rmutate(start = paste(start, \u0026quot;T0:00:00Z\u0026quot;, sep = \u0026quot;\u0026quot;),\rend = paste(end, \u0026quot;T0:00:00Z\u0026quot;, sep = \u0026quot;\u0026quot;))\r\rPor fim, atribu√≠mos ao objeto videos as informa√ß√µes de todos os videos do canal de 2012 a 2017.\n\rvideos \u0026lt;- by_row(.d = dates, ..f = get_videos_porta, .to = \u0026quot;videos_info\u0026quot;)\r\r\rPasso 3: pegar as estat√≠sticas de cada v√≠deo\rPara facilitar essa etapa, eu criei a fun√ß√£o get_videos_stats(), que recebe um dataframe de uma linha contendo uma coluna $video_id e, usando a fun√ß√£o tuber::get_stats(), faz o scrape das estat√≠sticas do v√≠deo.\nget_videos_stats \u0026lt;- function(df_row) {\rget_stats(video_id = df_row$video_id)\r}\rCada elemento da coluna $video_info cont√©m um dataframe com as informa√ß√µes dos v√≠deos de um determinado ano. Com a fun√ß√£o dplyr::bind_rows(), juntamos esses dataframes em um s√≥. Ent√£o selecionamos as colunas de interesse: title, publishedAt e video_id. Por fim, utilizamos os id‚Äôs para baixar as estat√≠sticas de cada v√≠deo usando a fun√ß√£o get_videos_stats(). As estat√≠sticas s√£o salvas na coluna $videos_stats do objeto dados.\ndados \u0026lt;- bind_rows(videos$videos_info) %\u0026gt;%\rselect(title, publishedAt, video_id) %\u0026gt;%\rby_row(..f = get_videos_stats, .to = \u0026quot;videos_stats\u0026quot;)\r\rPasso 4: as visualiza√ß√µes\rA primeira visualiza√ß√£o que resolvi fazer foi um gr√°fico do n√∫mero de visualiza√ß√µes pela data de publica√ß√£o. Uma an√°lise descuidada desse gr√°fico pode indicar uma clara redu√ß√£o dos n√∫meros de views ao longo do tempo. No entanto, √© preciso levar em conta que v√≠deos mais antigos tendem a ter mais views por simplesmente estarem dispon√≠veis h√° mais tempo. Apesar disso, dois fatores me fazem acreditar que a magnitude do n√∫mero de views de um v√≠deo √© alcan√ßada nos primeiros dias ap√≥s o lan√ßamento. O primeiro se deve ao sistema de recomenda√ß√µes do YouTube. Na p√°gina inicial, nem sempre os v√≠deos recomendados s√£o dos canais que voc√™ se inscreveu. Na p√°gina de canais inscritos, se voc√™ tiver muitas inscri√ß√µes, √© f√°cil perder um v√≠deo ou outro de um dos canais que acompanha. O segundo se deve √† enorme quantidade de conte√∫do dispon√≠vel hoje em dia, muito¬≤ maior do que h√° quatro, cinco anos. Eu, por exemplo, sou inscrito em mais de vinte canais e n√£o consigo acompanhar nem cinco deles. Para quem n√£o pode ficar o dia todo vendo v√≠deos, realmente h√° muita competi√ß√£o por espa√ßo no YouTube.\nE apresento ainda um terceiro fator, contrariando a expectativa de existirem apenas dois. Vivemos na era do hype. O que √© velho, o que √© not√≠cia da semana passada, j√° n√£o interessa mais.\ndados %\u0026gt;%\rmutate(views = map(videos_stats, .f = \u0026#39;viewCount\u0026#39;)) %\u0026gt;%\runnest(views) %\u0026gt;%\rmutate(views = as.numeric(views),\rpublishedAt = as_date(publishedAt)) %\u0026gt;%\rggplot(aes(x = publishedAt, y = views)) +\rgeom_line(aes(y = 1000000, colour = \u0026quot;1 Milh√£o\u0026quot;)) +\rgeom_line(aes(y = 10000000, colour = \u0026#39;10 Milh√µes\u0026#39;)) +\rgeom_line(aes(y = 20000000, colour = \u0026#39;20 Milh√µes\u0026#39;)) +\rgeom_line() +\rlabs(x = \u0026quot;Data de publica√ß√£o\u0026quot;, y = \u0026quot;Visualiza√ß√µes\u0026quot;) +\rtheme_bw()\rTamb√©m fiz um gr√°fico da propor√ß√£o likes/dislikes pela data de publica√ß√£o do v√≠deo. Parece haver uma leve redu√ß√£o dessa propor√ß√£o no √∫ltimo ano, mas √© arriscado tirar uma conclus√£o. Refazendo essa an√°lise no fim de 2017, talvez fique mais claro se o p√∫blico do canal concorda comigo sobre a qualidade do conte√∫do nos √∫ltimos tempos.\ndados %\u0026gt;%\rmutate(likes = map(videos_stats, .f = \u0026#39;likeCount\u0026#39;),\rdislikes = map(videos_stats, .f = \u0026#39;dislikeCount\u0026#39;)) %\u0026gt;%\runnest(likes, dislikes) %\u0026gt;%\rmutate(likes = as.numeric(likes),\rdislikes = as.numeric(dislikes),\rpublishedAt = as_date(publishedAt),\rprop = likes/dislikes) %\u0026gt;%\rggplot(aes(x = publishedAt)) +\rgeom_line(aes(y = prop)) +\rlabs(x = \u0026quot;Data de publica√ß√£o\u0026quot;, y = \u0026quot;Likes/Dislikes\u0026quot;) +\rtheme_bw()\rO Porta dos Fundos √© sem d√∫vida um gigante no YouTube, mas os ind√≠cios dessa sucinta an√°lise colaboram com a minha opini√£o de que o canal j√° viveu dias (bem) melhores. Apesar de essa decad√™ncia poder ser s√≥ uma fase ruim, nunca √© cedo para se reinventar, ter novas ideias, definir as regras do jogo, assim como eles fizeram no in√≠cio.\nE se faltar ideias, v√≠deos com o Totoro s√£o sempre uma boa alternativa.\n\r","permalink":"https://blog.curso-r.com/posts/2017-03-20-porta-dos-fundos-decadencia/","tags":["Porta dos Fundos","API","YouTube"],"title":"O Porta dos Fundos est√° em decad√™ncia?"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rProgramadores eficientes n√£o precisam escrever algoritmos que rodam r√°pido. Recomendo fortemente a leitura do livro Efficient R, que discute efici√™ncia com o R de forma exaustiva. Tamb√©m gosto muito da primeira parte dessa palestra do Hadley, onde ele defende que o cientista de dados deve usar seu tempo pensando no problema e n√£o na forma que vai escrever seu c√≥digo.\nCom isso em mente, vamos investigar o tema paraleliza√ß√£o. Quando rodamos coisas em paralelo, mandamos os n√∫cleos de processamento da m√°quina calcularem coisas diferentes ao mesmo tempo. A vantagem disso √© que o tempo de execu√ß√£o dos algoritmos √© dividido pelo n√∫mero de n√∫cleos dispon√≠veis, sem exigir grandes mudan√ßas no c√≥digo utilizado.\nVamos mostrar como paralelizar um c√≥digo usando a fun√ß√£o llply() do pacote plyr. Essa fun√ß√£o funciona de forma id√™ntica ao lapply(), ou seja, recebe uma lista ou vetor como input, aplica uma fun√ß√£o em cada elemento, e retorna os resultados numa lista com o mesmo comprimento.\nA fun√ß√£o dormir() manda o R esperar seg segundos antes de concluir, retornando seg.\ndormir \u0026lt;- function(seg = 1) {\rSys.sleep(seg)\rreturn(seg)\r}\r√â intuitivo afirmar que o tempo de execu√ß√£o de dormir() √© compat√≠vel com seg.\nsystem.time({\rdormir()\r})\r## user system elapsed ## 0.000 0.000 1.005\rNosso interesse √© aplicar dormir() em cada elemento do vetor c(1, 2). Esse algoritmo demora 1 + 2 = 3 segundos.\nsegundos \u0026lt;- c(1, 2)\rsystem.time({\rplyr::llply(segundos, dormir)\r})\r## user system elapsed ## 0.054 0.005 3.071\rAgora vamos executar o mesmo c√≥digo usando paraleliza√ß√£o. Antes, precisamos\ncriar e registrar as c√≥pias de R que rodam em paralelo; e\radicionar o par√¢metro .parallel = TRUE no llply()\r\rO primeiro passo √© resolvido com os pacotes parallel e doParallel. Veja como fica o c√≥digo:\ncl \u0026lt;- parallel::makePSOCKcluster(2) # cria as c√≥pias do R que rodam em paralelo\rdoParallel::registerDoParallel(cl) # registra as c√≥pias do R para serem usadas no plyr\rsystem.time({\rplyr::llply(segundos, dormir, .parallel = TRUE)\r})\r## user system elapsed ## 0.012 0.000 2.067\rO tempo total de execu√ß√£o foi de ~2.2 segundos, um pouco mais do que dormir(2). Os dois d√©cimos de segundo adicionais s√£o necess√°rios para preparar o terreno da paraleliza√ß√£o. Inclusive, se voc√™ rodar o c√≥digo em paralelo novamente, o tempo adicional cai para quase nada:\nsystem.time({\rplyr::llply(segundos, dormir, .parallel = TRUE)\r})\r## user system elapsed ## 0.005 0.001 2.011\rSe quiser parar de rodar coisas em paralelo, basta rodar stopCluster():\nparallel::stopCluster(cl) # para de rodar coisas em paralelo\rE √© isso, caros errantes. Rappy coding :)\n","permalink":"https://blog.curso-r.com/posts/2017-03-14-parallel/","tags":["paraleliza√ß√£o"],"title":"Paraleliza√ß√£o no R"},{"author":["Daniel"],"categories":["divulga√ß√£o"],"contents":"\rNo in√≠cio de Janeiro desse ano ocorreu a primeira rstudio::conf,\ruma confer√™ncia sobre R promovida pela Rstudio. A confer√™ncia parece ter sido\rbem animada! Teve at√© um passeio para o parque do Harry Potter na Florida,\re surgiram memes como a imagem abaixo.\nEm termos de conte√∫do, parece que foi\rsensacional. Para quem n√£o teve oportunidade de ir, os videos da confer√™ncia\rforam divulgados aqui como bem\rlembrado pelo blog An√°lise Real.\nEu ainda n√£o tive tempo de passar por todas as palestras e comecei pelo fim. Vi o v√≠deo\rda √∫ltima sess√£o da confer√™ncia que era nada mais nada menos do que uma sess√£o de\rperguntas com J.J. Allaire, Hadley Wickham e Joe Cheng. Para quem n√£o conhece, o primeiro\r√© fundador do RStudio, outro √© o criador do tidyverse, ggplot2, etc e o √∫ltimo\r√© o criador do Shiny.\nA discuss√£o foi muito interessante, tratando de importantes temas sobre o desenvolvimento\rdo R. Vou resumir as minhas impress√µes nesse post, mas ressalvo que vale muito a\rpena ver o v√≠deo.\nA sess√£o come√ßa com 2 perguntas do moderador Joseph Rickert. A primeira falando\rsobre a confer√™ncia em que J.J., Joe e Hadley, √© claro, est√£o muito satisfeitos.\rGosto bastante da resposta do Hadley para essa pergunta:\n\rNossa m√©trica de sucesso √© o seu sucesso e √© muito bom ver voc√™s usando as ferramentas\rque desenvolvemos para resolver problemas importantes. Isso √© fant√°stico.\n\rA segunda pergunta √© filos√≥fica, mas o objetivo √© saber dos participantes o que\ros motiva nos trabalhos open-source. J.J. Allaire argumenta que desenvolver software\ropen-source √© muito gratificante porque estes s√£o dur√°veis, n√£o est√£o ligados ao\rsucesso ou fracasso de nenhuma companhia. Ele acha que se voc√™ quer encontrar significado\rno seu trabalho e ver que seu software teve impacto na comunidade n√£o tem nada melhor\rdo que desenvolver open-source.\nA partir da√≠ as perguntas s√£o abertas ao p√∫blico (11 min do v√≠deo). A primeira pergunta √©\rbem interessante: Quais s√£o os limites do R? A resposta do J.J. Allaire √© muito\rboa e est√° razoavelmente bem explicada nessa entrevista\rque ele deu para o blog do RStudio em Outubro do ano passado. Basicamente, ele diz que\rse o R for encarado como uma linguagem de programa√ß√£o ele possui limites bem claros,\rporque o R n√£o foi desenvolvido para ser uma linguagem de programa√ß√£o e sim para ser\ruma interface de usu√°rio. O R, quando ainda era S, foi desenvolvido para ser uma\rinterface para c√≥digos em Fortran. Como interface de usu√°rio, segundo Allaire, o R pode\rser interligado sempre √† melhor ferramenta de computa√ß√£o que existir. Portanto,\rse pensarmos no R como interface de usu√°rio, n√£o h√° limites. Ainda nesta pergunta,\rJoe Cheng fez uma compara√ß√£o interessante entre R, Python e Go.\nUma outra pergunta interessante √© sobre como convencer quem usa Excel a come√ßar\ra usar o R. As respostas s√£o muito legais! O Hadley pensa que a primeira parte √©\rmostrar o como com o R voc√™ pode ter facilidade para fazer diversas coisas, apresentar\ras comodidades que ele tr√°s. O JJ Allaire, ressalta que a curva de aprendizado do R\r√© muito mais lenta, por isso, educar e ajduar a tornar o processo de aprendizagem mais\rsimples √© crucial para que a ado√ß√£o do R aumente quando comparado ao Excel.\nEnfim, a palestra passa por muitos outros assuntos interessantes como Deep Learning no R,\ro futuro do R quanto a tipagem (relacionando com TypeScript, etc.), ferramentas de teste\rpara Shiny, inova√ß√£o e empoderamento no R, R Users Group, paraleliza√ß√£o, CRAN e Github e\rplanos do RStudio para os pr√≥ximos anos.\nEnfim, espero que este post tenha dado vontade de assistir o v√≠deo. Convido-os a\rcomentar as partes que voc√™s acharam mais interessantes!\n","permalink":"https://blog.curso-r.com/posts/2017-02-18-all-things-r-and-rstudio/","tags":["rstudio"],"title":"rstudio::conf: Sess√£o Final"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\r\rHoje estava fazendo uma an√°lise explorat√≥ria e precisava estudar os quartis de uma vari√°vel cont√≠nua. A solu√ß√£o usando o tidyverse √© t√£o elegante que valeu um post no blog.\nUsaremos os pacotes tibble, dplyr, tidyr e purrr:\nlibrary(tibble)\rlibrary(dplyr)\rlibrary(tidyr)\rlibrary(purrr)\rNesse exemplo, usamos a famosa base mtcars\ntab \u0026lt;- mtcars %\u0026gt;%\rgroup_by(am, vs) %\u0026gt;%\rnest() %\u0026gt;%\rmutate(quartis = map(data, ~enframe(quantile(.x$mpg, 1:3 / 4)))) %\u0026gt;%\runnest_legacy(quartis) %\u0026gt;%\rspread(name, value)\rtab\r## # A tibble: 4 √ó 5\r## # Groups: am, vs [4]\r## vs am `25%` `50%` `75%`\r## \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt;\r## 1 0 0 14.0 15.2 16.6\r## 2 0 1 16.8 20.4 21 ## 3 1 0 18.6 21.4 22.2\r## 4 1 1 25.0 30.4 31.4\r\rA fun√ß√£o dplyr::group_by() faz um grupo para cada combina√ß√£o de am e vs.\rA fun√ß√£o tidyr::nest() guarda os dados de cada grupo numa list-column chamada data.\rA fun√ß√£o purrr::map() aplica elegantemente a fun√ß√£o quantile() para cada grupo de datas, sendo ajudada pela fun√ß√£o tibble::enframe(), que coloca o resultado de quantile() em uma tibble.\rA fun√ß√£o tidyr::unnest_legacy() coloca os resultados de volta em colunas-vetores.\rTerminamos com tidyr::spread() para espalhar os quartis nas colunas.\r\rO resultado pode ser jogado diretamente numa tabela:\nknitr::kable(tab) %\u0026gt;%\rkableExtra::kable_styling()\r\r\rvs\r\ram\r\r25%\r\r50%\r\r75%\r\r\r\r\r\r0\r\r0\r\r14.050\r\r15.20\r\r16.625\r\r\r\r0\r\r1\r\r16.775\r\r20.35\r\r21.000\r\r\r\r1\r\r0\r\r18.650\r\r21.40\r\r22.150\r\r\r\r1\r\r1\r\r25.050\r\r30.40\r\r31.400\r\r\r\r\r√â poss√≠vel mudar esse c√≥digo para ter outras medidas-resumo, por exemplo. Para isso, podemos usar a fun√ß√£o summary(), por exemplo, ou criar nossa pr√≥pria fun√ß√£o.\nmtcars %\u0026gt;%\rgroup_by(am, vs) %\u0026gt;%\rnest() %\u0026gt;%\rmutate(\rs = map(data, ~enframe(summary(.x$mpg))),\rs = map(s, ~ .x %\u0026gt;% mutate(value = as.numeric(value)))\r) %\u0026gt;%\rselect(vs, am, s) %\u0026gt;%\runnest_legacy(s) %\u0026gt;%\rspread(name, value) %\u0026gt;%\rknitr::kable() %\u0026gt;%\rkableExtra::kable_styling()\r\r\rvs\r\ram\r\r1st Qu.\r\r3rd Qu.\r\rMax.\r\rMean\r\rMedian\r\rMin.\r\r\r\r\r\r0\r\r0\r\r14.050\r\r16.625\r\r19.2\r\r15.05000\r\r15.20\r\r10.4\r\r\r\r0\r\r1\r\r16.775\r\r21.000\r\r26.0\r\r19.75000\r\r20.35\r\r15.0\r\r\r\r1\r\r0\r\r18.650\r\r22.150\r\r24.4\r\r20.74286\r\r21.40\r\r17.8\r\r\r\r1\r\r1\r\r25.050\r\r31.400\r\r33.9\r\r28.37143\r\r30.40\r\r21.4\r\r\r\r\rComo voc√™ resolveria essa task? Escreva nos coment√°rios!\n","permalink":"https://blog.curso-r.com/posts/2017-02-20-quartis/","tags":["tidyverse","dplyr","purrr"],"title":"Medidas-resumo no tidyverse"},{"author":["Fernando"],"categories":["Tutoriais"],"contents":"\r\rVerificar as suposi√ß√µes dos modelos √© muito importante quando fazemos infer√™ncia estat√≠stica. Em particular, a suposi√ß√£o de homocedasticidade1 dos modelos de regress√£o linear √© especialmente importante, pois modifica o c√°lculo de erros padr√£o, intervalos de confian√ßa e valores-p.\nNeste post, vou mostrar tr√™s pacotes do R que ajustam modelos da forma\n\\[ Y_i = \\beta_0 + \\sum_{k=1}^p\\beta_kx_{ik} + \\epsilon_i, \\ i = 1,\\ldots,n\\]\n\\[ \\epsilon_{i} \\sim \\textrm{N}(0,\\sigma_i), \\ i = 1,\\ldots,n \\ \\textrm{independentes, com }\\sigma_i^2 = \\alpha x_i^2. \\]\nAl√©m de mostrar como se faz, tamb√©m vou ilustrar o desempenho dos pacotes em um exemplo simulado. O modelo que gerar√° os dados do exemplo ter√° a seguinte forma funcional\n\\[ Y_i = \\beta x_i + \\epsilon_i, \\ i = 1,...n \\]\r\\[ \\epsilon_i \\sim N(0, \\sigma_i)\\text{ independentes, com }\\sigma_i = \\alpha\\sqrt{|x_i|},\\]\ne os par√¢metros do modelo ser√£o os valores \\(\\beta = 1\\) e \\(\\alpha = 4\\). A heterocedasticidade faz com que os pontos desenhem um cone ao redor da reta de regress√£o.\nlibrary(ggplot2)\rN \u0026lt;- 1000\rset.seed(11071995)\rX \u0026lt;- sample((N/100):(N*3), N)\rY \u0026lt;- rnorm(N,X,4*sqrt(X))\rqplot(X,Y) + theme_bw(15) + geom_point(color = \u0026#39;darkorange\u0026#39;)\rX2 \u0026lt;- sqrt(X)\rdataset \u0026lt;- data.frame(Y,X,X2)\rUsando o pacote gamlss\rQuando se ajusta um GAMLSS, voc√™ pode modelar os par√¢metros de loca√ß√£o, escala e curtose ao mesmo tempo em que escolhe a distribui√ß√£o dos dados dentre uma grande gama de op√ß√µes. Escolhendo a distribui√ß√£o normal e modelando apenas os par√¢metros de loca√ß√£o e escala, o GAMLSS ajusta modelos lineares normais com heterocedasticidade.\nNo c√≥digo abaixo, o par√¢metro formula = Y ~ X-1 indica que a fun√ß√£o de regress√£o ser√° constitu√≠da por um preditor linear em X sem intercepto. J√° o par√¢metro sigma.formula = ~X2-1 indica que o desvio padr√£o ser√° modelado por um preditor linear em X2 (ou raiz de X), tamb√©m sem intercepto.\nlibrary(gamlss)\rfit_gamlss \u0026lt;- gamlss::gamlss(formula = Y ~ X-1,\rsigma.formula = ~X2-1,\rdata = dataset,\rfamily = NO())\rGAMLSS-RS iteration 1: Global Deviance = 19436.47 GAMLSS-RS iteration 2: Global Deviance = 19412.18 GAMLSS-RS iteration 3: Global Deviance = 19412.18 \rConforme descrito no sum√°rio abaixo, a estimativa de alfa est√° muito abaixo do valor simulado.\nsummary(fit_gamlss)\r******************************************************************\rFamily: c(\u0026quot;NO\u0026quot;, \u0026quot;Normal\u0026quot;) Call: gamlss::gamlss(formula = Y ~ X - 1, sigma.formula = ~X2 - 1, family = NO(), data = dataset) Fitting method: RS() ------------------------------------------------------------------\rMu link function: identity\rMu Coefficients:\rEstimate Std. Error t value Pr(\u0026gt;|t|) X 1.029331 0.006297 163.5 \u0026lt;2e-16 ***\r---\rSignif. codes: 0 \u0026#39;***\u0026#39; 0.001 \u0026#39;**\u0026#39; 0.01 \u0026#39;*\u0026#39; 0.05 \u0026#39;.\u0026#39; 0.1 \u0026#39; \u0026#39; 1\r------------------------------------------------------------------\rSigma link function: log\rSigma Coefficients:\rEstimate Std. Error t value Pr(\u0026gt;|t|) X2 0.190873 0.001025 186.3 \u0026lt;2e-16 ***\r---\rSignif. codes: 0 \u0026#39;***\u0026#39; 0.001 \u0026#39;**\u0026#39; 0.01 \u0026#39;*\u0026#39; 0.05 \u0026#39;.\u0026#39; 0.1 \u0026#39; \u0026#39; 1\r------------------------------------------------------------------\rNo. of observations in the fit: 1000 Degrees of Freedom for the fit: 2\rResidual Deg. of Freedom: 998 at cycle: 3 Global Deviance: 19412.18 AIC: 19416.18 SBC: 19426 ******************************************************************\r\rUsando o pacote dglm\rQuando se ajusta um Modelo Linear Generalizado Duplo (MLGD em portugu√™s e DGLM em ingl√™s), voc√™ tem uma flexibilidade parecida com a de um GAMLSS. Entretanto, voc√™ n√£o pode definir um modelo para a curtose e a classe de distribui√ß√µes dispon√≠vel √© bem menor.\nO c√≥digo abaixo, similar ao utilizado para ajustar o GAMLSS, ajusta um DGLM aos dados simulados.\nlibrary(dglm)\rfit \u0026lt;- dglm(Y~X-1, dformula = ~X2-1,data = dataset, family = gaussian, method = \u0026#39;reml\u0026#39;)\rWarning: glm.fit: algorithm did not converge\rNovamente, verifica-se que o alfa estimado est√° muito distante do verdadeiro alfa.\nsummary(fit)\r\rCall: dglm(formula = Y ~ X - 1, dformula = ~X2 - 1, family = gaussian, data = dataset, method = \u0026quot;reml\u0026quot;)\rMean Coefficients:\rEstimate Std. Error t value Pr(\u0026gt;|t|)\rX 1.029142 0.0117601 87.51128 0\r(Dispersion Parameters for gaussian family estimated as below )\rScaled Null Deviance: 17738.57 on 1000 degrees of freedom\rScaled Residual Deviance: 3550.323 on 999 degrees of freedom\rDispersion Coefficients:\rEstimate Std. Error z value Pr(\u0026gt;|z|)\rX2 0.3808943 0.001147175 332.0279 0\r(Dispersion parameter for Gamma family taken to be 2 )\rScaled Null Deviance: 1571.507 on 1000 degrees of freedom\rScaled Residual Deviance: 7918.216 on 999 degrees of freedom\rMinus Twice the Log-Likelihood: 19412.35 Number of Alternating Iterations: 22 \r\rUsando o pacote rstan\rStan √© uma linguagem de programa√ß√£o voltada para descrever e manipular objetos probabil√≠sticos, como por exemplo vari√°veis aleat√≥rias, processos estoc√°sticos, distribui√ß√µes de probabilidades etc. Essa linguagem foi projetada para tornar intuitivo e simples o ajuste de modelos estat√≠sticos. Em particular, a forma de descrever modelos bayesianos √© bem c√¥moda.\nO stan possui v√°rias interfaces para R. A mais b√°sica √© o rstan, que ser√° utilizada aqui. A principal fun√ß√£o desse pacote √© a fun√ß√£o rstan, que possui dois par√¢metros b√°sicos:\n\rum par√¢metro model_code =, que recebe um c√≥digo que descreve o modelo na linguagem stan.\rum par√¢metro data =, que recebe uma lista contendo os inputs do modelo, tais como dados coletados, par√¢metros de distribui√ß√µes a priori, etc.\r\rEmbora esse seja o m√≠nimo que a fun√ß√£o precisa, tamb√©m podemos passar outras componentes. O par√¢metro verbose = FALSE faz com que a fun√ß√£o n√£o imprima nada enquanto roda e o par√¢metro control = list(...) passa uma lista de op√ß√µes de controle para o algoritmo de ajuste.\nO retorno da fun√ß√£o stan() √© um objeto do tipo stanfit, que pode ser sumarizado da mesma forma que outros modelos em R, utilizando a fun√ß√£o summary() e a fun√ß√£o plot().\nO c√≥digo abaixo ilustra a aplica√ß√£o da fun√ß√£o stan() ao nosso exemplo.\nlibrary(rstan)\rscode \u0026lt;- \u0026quot;data {\rint\u0026lt;lower=0\u0026gt; N;\rvector[N] y;\rvector[N] x;\r}\rparameters {\rreal beta;\rreal\u0026lt;lower=0\u0026gt; alpha;\r}\rmodel {\rbeta ~ normal(0,10);\ralpha ~ gamma(1,1);\ry ~ normal(beta * x, alpha * sqrt(x));\r}\u0026quot;\rdados \u0026lt;- list(N = nrow(dataset), y = dataset$Y, x = dataset$X)\rfit_stan \u0026lt;- rstan::stan(model_code = scode, verbose = FALSE, data = dados,\rcontrol = list(adapt_delta = 0.99))\rA figura abaixo descreve os intervalos de credibilidade obtidos para cada par√¢metro do modelo. O ponto central de cada intervalo representa as estimativas pontuais dos par√¢metros. Como se nota, as estimativas do modelo utilizando stan est√£o bem pr√≥ximas dos valores verdadeiros.\nplot(fit_stan)\r\r\rUma regress√£o linear √© homoced√°stica quando a variabilidade dos erros n√£o depende das covari√°veis do modelo.‚Ü©Ô∏é\n\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-02-21-regressao-heterocedastica/","tags":["modelagem","regress√£o","bayes"],"title":"Modelando a vari√¢ncia da normal"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rO leaflet √© uma biblioteca javascript para cria√ß√£o de mapas interativos. O pacote leaflet do R √© um htmlwidget que permite gerar esses mapas de forma direta no R, para usar em documentos RMarkdown e Shiny.\nUma das ferramentas que mais gosto do leaflet √© a fun√ß√£o markerClusterOptions(), que permite agrupar pontos no mapa em conjuntos de v√°rios pontos.\nComo exemplo, utilizaremos uma base de dados que cont√©m a localiza√ß√£o e informa√ß√µes das varas da Justi√ßa Estadual no Brasil. A tabela abaixo mostra as cinco primeiras linhas dessa base. A coluna lab j√° foi trabalhada para ser adicionada nos marcadores do mapa como popup.\n\r\rmuni_id\rmuni_nm\rlon\rlat\r\r\r\r1100015\rAlta Floresta D‚Äôoeste\r-62.27467\r-12.47017\r\r1100023\rAriquemes\r-62.95718\r-9.95190\r\r1100031\rCabixi\r-60.63986\r-13.47489\r\r1100049\rCacoal\r-61.32475\r-11.30123\r\r1100056\rCerejeiras\r-61.26095\r-13.20351\r\r\r\rPara utilizar o pacote leaflet, basta instalar o pacote via install.packages(). Acesse o mapa din√¢mico neste link. Experimente passear pelo mapa. Procure tamb√©m algum lugar que tenha v√°rias varas juntas, para ver o que o markerCluster faz nesse caso.\nlibrary(leaflet)\rabjData::muni %\u0026gt;% leaflet() %\u0026gt;% addTiles() %\u0026gt;% addMarkers(\rlng = ~lon, lat = ~lat, popup = ~muni_nm,\rclusterOptions = markerClusterOptions()\r)\r\rA fun√ß√£o leaflet() carrega o motor do leaflet, ainda em branco.\rA fun√ß√£o addTiles() adiciona as camadas de mapas de acordo com o zoom. √â poss√≠vel escolher temas para essas camadas.\rA fun√ß√£o addMarkers() mapeia as varas da base de dados de acordo com as respectivas latitude e longitude.\r\rNote que √© necess√°rio adicionar um ~ antes das vari√°veis para mape√°-las da base de dados.\rA op√ß√£o popup permite adicionar um bal√£o com informa√ß√µes ao clicar num marcador.\rA op√ß√£o clusterOptions faz a m√°gica que agrupa os pontos. A regi√£o azul observada ao colocar o mouse sobre um cluster √© a casca convexa dos marcadores agrupados.\r\r\r","permalink":"https://blog.curso-r.com/posts/2017-02-21-markercluster/","tags":["mapas","leaflet"],"title":"leaflet com markerCluster"},{"author":["Athos"],"categories":["top 10"],"contents":"\rO R mudou muito nos √∫ltimos 5 anos gra√ßas a cria√ß√µes de novos pacotes focados nas quest√µes mais pr√°ticas do dia a dia de um cientista de dados. Abaixo coloquei meu top 10 de pacotes que revolucionaram o jeito de programar em R e fizeram meu trabalho mais √°gil e prazeroso:\n10. purrr (manipula√ß√£o de vetores e listas)\rNosso d√©cimo lugar colocou o for em perigo de extin√ß√£o. Com ele, aplicar fun√ß√µes em vetores, listas ou combina√ß√µes dos dois √© uma tarefa de poucas linhas e sem a necessidade de √≠ndices i, j, k‚Äôs confusos. E ainda, com o advento das tibbles, seus data.frames ganharam potencial de guardar muito mais do que meros n√∫meros e strings e o purrr √© seu mais forte aliado na hora de criar as chamadas list-columns.\n\r9. caret (modelagem estat√≠stica)\rSe voc√™ procura modelagem estat√≠stica (ferramenta b√°sica do cientista de dados), d√™ chance ao caret. Esse pacote compilou os mais consagrados algoritmos de modelos preditivos (vulgo machine learning) j√° feitos no R e ainda implementou ferramentas t√≠picas de um processo de constru√ß√£o de modelos, por exemplo, cross-validation, ajuste de hiperpar√¢metros, bases treino/teste, pr√©-processamentos e at√© paraleliza√ß√£o. Al√©m das diferentes t√©cnicas de ajuste de modelos, os seus respectivos diagn√≥sticos e visualiza√ß√µes tamb√©m foram convenientemente compiladas, tudo num mesmo lugar, fazendo a procura de pe√ßas no gigantesco balde do R ser menos custosa.\n\r8. knitr/rmarkdown (relat√≥rios)\rA dupla knitr e rmarkdown fizeram do R de patinho feio para o rei dos holofotes. Depois deles, relat√≥rios no R s√£o f√°ceis, bonitos e flex√≠veis. Escrever em RMarkdown √© como escrever um rascunho, que depois √© transformado em um arquivo decente em qualquer formato: pdf, word e html s√£o os mais comuns. A ideologia por tr√°s do RMarkdown √© trazer o foco para a an√°lise e deixar as perfumarias para segundo plano o m√°ximo poss√≠vel.\nOBS: todos os posts desse blog s√£o feitos em RMarkdown!\n\r7. stringr (manipula√ß√£o de strings)\rStringr te d√° tudo para extrair, criar e transformar strings. As fun√ß√µes aceitam regex extremamente vers√°ril e eficiente. Minera√ß√£o de texto vira brincadeira.\n\r6. lubridate (manipula√ß√£o de datas)\rSe tem uma coisa que d√° para dar dor de cabe√ßa infinita s√£o datas. Por isso inventaram o lubridate. Tudo o que voc√™ gostaria de fazer com datas e horas esse pacote fornece, desde soma e subtra√ß√£o at√© compara√ß√µes l√≥gicas e arredondamentos. √â a ferramenta ideal para lidar com tempo.\n\r5. shiny (cria√ß√£o de aplicativos web)\rShiny d√° o poder de fazer aplica√ß√µes na web a um analista de dados sem nenhum conhecimento pr√©vio de html, css e javascript. Acredite se quiser, agora, fazer sites interativos e orientados por dados n√£o √© mais exclusividade dos desenvolvedores web. Com uma curva de aprendizagem ligeiramente alongada, pode-se criar de dashboards est√°ticos a mapas personalizados a l√° google maps! √â uma √≥tima maneira de apresentar resultados e serve muito bem como produto final de ferramentas de gest√£o.\n\r4. tidyr (transforma√ß√£o de data.frames)\rAs principais fun√ß√µes s√£o gather() e spread(). Elas pivotam/despivotam data.frames, ou derretem/condensam data.frames. Ela merece nosso quarto lugar porque possui uma grande sinergia com os terceiro e segundo lugares. N√£o raramente precisamos rearranjar conjunto de colunas em um par de colunas chave/valor ou vice-versa. Pivotar/despivotar √© particularmente muito chato de fazer em SQL e o tidyr faz isso parecer trivial. Ele tamb√©m possui outras fun√ß√µes √∫teis que recomendo dar uma olhada (ex: unite(), separete()).\n\r3. dplyr (manipula√ß√£o de data.frames)\rNossa medalha de bronze vai para dplyr porque ele trouxe os verbos de manipula√ß√£o de base de dados para o n√≠vel mais simples e intuitivo. S√£o eles:\n\rfilter() filtra linhas\rarrange() ordena linhas\rselect() seleciona colunas\rdistinct() retira linhas duplicadas\rmutate() constr√≥i novas colunas\rgroup_by() + summarise() sumariza valores por um ou mais fatores\r\rE o pacote vai muito al√©m desses verbos. Vale a pena explorar suas fun√ß√µes se voc√™ precisa deixar sua base pronta para analisar.\nOBS: foi feito para funcionar com o ‚Äúpipe‚Äù (%\u0026gt;%).\n\r2. ggplot2 (visualiza√ß√£o)\rA medalha de prata eu acho que √© o pacote mais famoso do R.\nO R √© conhecido pela sua rica capacidade gr√°fica, mas foi o ggplot2 que trouxe a alegria de viver para os usu√°rios minimamente preocupados com a boa apar√™ncia de suas visualiza√ß√µes. O ggplot2 permite usar a ‚Äúgram√°tica de gr√°ficos‚Äù (grammar of graphics) para construir gr√°ficos em camadas e customiz√°veis. H√° uma pequena curva de aprendizado, mas o tempo investido se paga no primeiro gr√°fico gerado. Gr√°ficos que seriam veradeiras obras da engenharia se feitas no R-base n√£o passariam de 5 linhas de ggplot2 e ainda ficariam mais bonitos!\nIndispens√°vel na caixa de ferramentas de qualquer cientista de dados.\n\r1. magrittr (pipe!)\rA medalha de ouro nos fornece o tal do pipe (%\u0026gt;%). Em vez de h(g(f(x))), escreva x %\u0026gt;% f %\u0026gt;% g %\u0026gt;% h. Pronto! √â tudo o que o pipe faz. Voc√™ pode se perguntar por que raios isso merece o nosso primeiro lugar, mas acredite: o pipe √© revolucion√°rio. Ele mudou o jeito de se programar em R. Com ele o ganho em legibilidade dos c√≥digos e agilidade na programa√ß√£o √© inimagin√°vel. E ainda abriu portas para desenvolvimento de pacotes que sem ele n√£o seriam vi√°veis, incluindo o dplyr e tidyr.\nE por isso que ele merece estar no primeiro lugar na nossa lista e no logo da nossa p√°gina.\n\rMen√ß√µes honrosas\rOutros pacotes tamb√©m merecem destaque! As med√°lhas de honra ao m√©rito v√£o para:\n\rforcats (utilidades para fatores)\rRcpp (R para C++)\rFactoMiner (an√°lise multivariada)\rRODBC (conex√£o com banco de dados)\rhttr/xml2/rvest (ferramentas para web)\rflexdashboard (rmarkdown para formato de dashboard)\rjanitor (limpeza de dados para modelagem)\rplyr (manipula√ß√£o de vetores, listas e data.frames)\rroxygen2 (cria√ß√£o de pacotes de R)\rdevtools (ferramentas diversas)\rhtmlwidgets (integra√ß√£o entre R e bibliotecas JavaScript)\rleaflet (mapas interativos)\r\rE voc√™, concorda? Coloque nos coment√°rios os pacotes que moram em seu cora√ß√£o! =)\n\r","permalink":"https://blog.curso-r.com/posts/2017-02-21-top10-pacotes-para-data-science/","tags":["pacotes"],"title":"Top 10 pacotes para data science"},{"author":["William"],"categories":["conceitos"],"contents":"\rOs gr√°ficos s√£o t√©cnicas de visualiza√ß√£o de dados amplamente utilizadas em todas as √°reas da pesquisa. A sua popularidade se deve √† maneira como elucidam informa√ß√µes que estavam escondidas nas colunas do banco de dados, sendo que muitos deles podem ser compreendidos at√© mesmo por leigos no assunto que est√° sendo discutido.\nMas ser√° que podemos definir formalmente o que √© um gr√°fico estat√≠stico?\nGra√ßas ao estat√≠stico norte-americano Leland Wilkinson, a resposta √© sim.\nEm 2005, Leland publicou o livro The Grammar of Graphics, uma fonte de princ√≠pios fundamentais para a constru√ß√£o de gr√°ficos estat√≠sticos. No livro, ele defende que um gr√°fico √© o mapeamento dos dados a partir de atributos est√©ticos (posi√ß√£o, cor, forma, tamanho) de objetos geom√©tricos (pontos, linhas, barras, caixas). Simples assim.\nAl√©m de responder a pergunta levantada nesse post, os conceitos de Leland tiveram outra grande import√¢ncia para a visualiza√ß√£o de dados. Alguns anos mais tarde, o seu trabalho inspirou Hadley Wickham a criar o pacote ggplot2, que enterrou com muitas p√°s de terra as fun√ß√µes gr√°ficas do R base.\nEm A Layered Grammar of Graphics, Hadley sugeriu que os principais aspectos de um gr√°fico (dados, sistema de coordenadas, r√≥tulos e anota√ß√µes) podiam ser divididos em camadas, constru√≠das uma a uma na elabora√ß√£o do gr√°fico. Essa √© a ess√™ncia do ggplot2.\nNo gr√°fico abaixo, temos informa√ß√£o de 32 carros com respeito a 4 vari√°veis: milhas por gal√£o, tonelagem, transmiss√£o e n√∫mero de cilindros. O objeto geom√©trico escolhido para representar os dados foi o ponto. As posi√ß√µes dos pontos no eixo xy mapeia a associa√ß√£o entre a tonelagem e a quantidade de milhas por gal√£o. A cor dos pontos mapeia o n√∫mero de cilindros de cada carro, enquanto a forma dos pontos mapeia o tipo de transmiss√£o. Observando o c√≥digo, fica claro como cada linha/camada representa um aspecto diferente do gr√°fico.\nOs conceitos criados por Leland e Hadley defendem que essa estrutura pode ser utilizada para construir e entender qualquer tipo de gr√°fico, dando a eles, dessa maneira, a sua defini√ß√£o formal.\nggplot(mtcars) +\rgeom_point(aes(x = disp, y = mpg, shape = as.factor(am), color = cyl)) +\rlabs(x = \u0026quot;Tonelagem\u0026quot;, y = \u0026quot;Milhas por gal√£o\u0026quot;,\rshape = \u0026quot;Transmiss√£o\u0026quot;, color = \u0026quot;Cilindros\u0026quot;) +\rscale_shape_discrete(labels = c(\u0026quot;Autom√°tica\u0026quot;,\u0026quot;Manual\u0026quot;)) +\rtheme_bw() +\rtheme(legend.position = \u0026quot;bottom\u0026quot;)\rPor fim, √© preciso frisar que, apesar de a gram√°tica prover uma forte funda√ß√£o para a constru√ß√£o de gr√°ficos, ela n√£o indica qual gr√°fico deve ser usado ou como ele deve parecer. Essas escolhas, fundamentadas na pergunta a ser respondida, nem sempre s√£o triviais, e negligenci√°-las pode gerar gr√°ficos mal constru√≠dos e conclus√µes equivocadas. Cabe a n√≥s, estat√≠sticos, desenvolver, aprimorar e divulgar as t√©cnicas de visualiza√ß√£o adequadas para cada tipo de vari√°vel, assim como apontar ou denunciar os usos incorretos e mal-intencionados. Mas, em um mundo cuja veracidade das not√≠cias √© cada vez menos importante, √© papel de todos ter senso cr√≠tico para entender e julgar as informa√ß√µes trazidas por um gr√°fico.\n","permalink":"https://blog.curso-r.com/posts/2017-02-20-o-que-e-um-grafico-estatistico/","tags":["gr√°ficos","ggplot2"],"title":"O que √© um gr√°fico estat√≠stico?"},{"author":["Julio"],"categories":["Tutoriais"],"contents":"\rO pacote ggalt √© uma extens√£o ao ggplot2 que permite fazer algumas coisas muito √∫teis. Uma delas √© a possibilidade de fazer faixas de confian√ßa para gr√°ficos do tipo escada. Isso permite adicionar intervalos de confian√ßa para modelos Kaplan-Meier, muito utilizados em An√°lise de Sobreviv√™ncia.\n√â poss√≠vel instalar o pacote ggalt usando a fun√ß√£o install.packages():\ninstall.packages(\u0026#39;ggalt\u0026#39;)\rPara exemplificar a utiliza√ß√£o do ggalt, vamos utilizar os pacotes abaixo.\nlibrary(dplyr)\rlibrary(ggplot2)\rlibrary(ggalt)\rlibrary(broom)\rlibrary(survival)\rNesse exemplo, utilizaremos a base de dados lung que vem com o pacote survival. Primeiramente, ajustamos um modelo Kaplan-Meier simples, usando a fun√ß√£o survfit(). Esse modelo tenta explicar a sobreviv√™ncia de pacientes com c√¢ncer de pulm√£o para cada sexo.\n# modelo kaplan-meier simples\rkm \u0026lt;- survfit(Surv(time, status) ~ sex, data = lung)\rA fun√ß√£o tidy() do pacote broom transforma o resultado do modelo numa tabela, j√° preparada para gerar gr√°ficos.\nd_km \u0026lt;- tidy(km)\rknitr::kable(head(d_km))\r\r\r\rtime\rn.risk\rn.event\rn.censor\restimate\rstd.error\rconf.high\rconf.low\rstrata\r\r\r\r11\r138\r3\r0\r0.9782609\r0.0126898\r1.0000000\r0.9542301\rsex=1\r\r12\r135\r1\r0\r0.9710145\r0.0147075\r0.9994124\r0.9434235\rsex=1\r\r13\r134\r2\r0\r0.9565217\r0.0181489\r0.9911586\r0.9230952\rsex=1\r\r15\r132\r1\r0\r0.9492754\r0.0196777\r0.9866017\r0.9133612\rsex=1\r\r26\r131\r1\r0\r0.9420290\r0.0211171\r0.9818365\r0.9038355\rsex=1\r\r30\r130\r1\r0\r0.9347826\r0.0224847\r0.9768989\r0.8944820\rsex=1\r\r\r\rO gr√°fico da Figura 1 usa a fun√ß√£o geom_ribbon() para gerar os intervalos de confian√ßa. Essa fun√ß√£o liga os pontos da faixa diretamente, o que √© inadequado do ponto de vista estat√≠stico.\nggplot(d_km, aes(x = time, y = estimate, colour = strata)) +\rgeom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = strata),\ralpha = .1, size = .1) +\rgeom_step() +\rtheme_bw(16)\r\rFigura 1: Intervalos de confian√ßa usando apenas ggplot2 e geom_ribbon().\r\rNa Figura 2, adicionamos o par√¢metro stat = \"stepribbon\", que faz com que o ggplot utilize a fun√ß√£o stat_stepribbon() do ggalt para o c√°lculo da faixa. Isso faz com que os intervalos tenham comportamento de escada, como quer√≠amos.\nggplot(d_km, aes(x = time, y = estimate, colour = strata)) +\rgeom_ribbon(aes(ymin = conf.low, ymax = conf.high, fill = strata),\rstat = \u0026#39;stepribbon\u0026#39;, alpha = .1, size = .1) +\rgeom_step() +\rtheme_bw(16)\r\rFigura 2: Intervalos de confian√ßa usando stat = 'stepribbon'.\r\r","permalink":"https://blog.curso-r.com/posts/2017-02-18-ggalt/","tags":["gr√°ficos","pacotes","survival"],"title":"Pacote ggalt"},{"author":["Athos","Daniel","Fernando","Julio","William"],"categories":["divulga√ß√£o"],"contents":"\rEsse √© o blog do Curso-R. N√≥s somos o Athos, Daniel, Fernando, Julio e William e\rseremos os autores dos posts desse blog. Aqui, vamos divulgar pequenas an√°lises,\rnovidades sobre o R e pequenas descobertas sobre estat√≠stica e Data Science.\rSinta-se a vontade para comentar no espa√ßo abaixo. Adoramos coment√°rios! Tamb√©m\rfique a vontade para compartilhar os nossos posts.\nO Curso-R surgiu em 2015 no programa de ver√£o do Instituto de\rMatem√°tica e Estat√≠stica da Universidade de S√£o Paulo (IME-USP). o curso foi chamado de\r‚ÄúPrograma√ß√£o em R: do casual ao avan√ßado‚Äù. Desde o come√ßo, n√≥s abra√ßamos a filosofia\rOpen Source - todo material que desenvolvemos fica dispon√≠vel em nossa conta do\rGithub de forma aberta para quem quiser usar.\rEm 2016 e 2017, ministramos novamente o curso no programa de ver√£o e, depois de mais de 100 alunos formados, decidimos aumentar a gama de cursos e a frequ√™ncia de ocorr√™ncia para que possamos atingir muito mais pessoas com essas tecnologias, pelas quais n√≥s somos apaixonados.\nEsperamos que aprendam bastante e, principalmente, divirtam-se bastante lendo este blog!\n","permalink":"https://blog.curso-r.com/posts/2017-02-15-blog-curso-r/","tags":["curso-r"],"title":"O blog da Curso-R"},{"author":["Daniel"],"categories":["conceitos"],"contents":"\rO manifesto das ferramentas tidy\rdo Hadley Wickham √© um dos documentos mais importantes sobre R dos √∫ltimos tempos.\rEsse documento formaliza uma s√©rie de princ√≠pios que norteiam o desenvolvimento do\rtidyverse.\nO tidyverse, tamb√©m chamado por muitos de hadleyverse,\r√© um conjunto de pacotes que, por compartilharem esses princ√≠pios do manifesto tidy,\rpodem ser utilizados naturalmente em conjunto. Pode-se dizer que existe o R antes do\rtidyverse e o R depois do tidyverse. A linguagem mudou muito, a comunidade abra√ßou\rfortemente o uso desses princ√≠pios e tem muita gente criando pacotes para conversar\runs com os outros dessa forma. No entanto, usar a filosofia tidy n√£o √© a √∫nica forma\rde fazer pacotes do R, existem muitos pacotes excelentes que n√£o utilizam essa filosofia.\rComo o pr√≥prio texto diz ‚ÄúO contr√°rio de tidyverse n√£o √© o messyverse, e sim muitos outros universos de pacotes interconectados.‚Äù.\nOs princ√≠pios fundamentais do tidyverse s√£o:\nReutilizar estruturas de dados existentes.\rOrganizar fun√ß√µes simples usando o pipe.\rAderir √† programa√ß√£o funcional.\rProjetado para ser usado por seres humanos.\r\rNo texto do manifesto tidy\rcada um dos lemas √© descrito de forma detalhada. Aqui, selecionei os aspectos que\rachei mais importante de cada um deles.\nReutilizar estruturas de dados existentes\r\rQuando poss√≠vel, √© melhor utilizar estruturas de dados comuns do que criar uma\restrutura espec√≠fica para o seu pacote.\rGeralmente, √© melhor reutilizar uma estrutura existente mesmo que ela n√£o se\rencaixe perfeitamente.\r\r\rOrganizar fun√ß√µes simples usando o pipe\r\rFa√ßa com que suas fun√ß√µes sejam o mais simples poss√≠veis. Uma fun√ß√£o deve poder\rser descrita com apenas uma senten√ßa.\rA sua fun√ß√£o deve fazer uma transforma√ß√£o no estilo copy-on-modify ou ter um\refeito colateral. Nunca os dois.\rO nome das fun√ß√µes devem ser verbos. Exceto quando as fun√ß√µes do pacote usam sempre\ro mesmo verbo. Ex: adicionar ou modificar.\r\r\rAderir √† programa√ß√£o funcional\r\rO R √© uma linguagem de programa√ß√£o funcional, n√£o lute contra\risso.\r\r\rProjetado para ser usado por seres humanos\r\rDesenvolva o seu pacote para ser usado por humanos. Foque em ter uma API clara\rpara que voc√™ escreva o c√≥digo de maneira intuitiva e r√°pida. Efici√™ncia dos\ralgoritmos √© uma preocupa√ß√£o secund√°ria, pois gastamos mais tempo escrevendo o c√≥digo\rdo que executando.\r\rEsses princ√≠pios s√£o bem gerais, mas ajudam bastante a tomar decis√µes quando\restamos escrevendo o nosso c√≥digo. Para finalizar, clique aqui\re veja uma busca no Github por ‚Äútidy‚Äù em reposit√≥rios de R. S√£o mais de 2000 resultados\rquase todos seguindo essa filosofia e estendendo o universo arrumado.\n\r","permalink":"https://blog.curso-r.com/posts/2017-02-16-manifesto-tidy/","tags":["tidyverse"],"title":"Manifesto tidy"}]