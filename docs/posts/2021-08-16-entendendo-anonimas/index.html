<!DOCTYPE html>
<html lang="pt-br"><head>
  <meta charset="utf-8">

  
  <title>Entendendo Funções Anônimas de Uma Vez por Todas</title>
  <meta name="title" content="Entendendo Funções Anônimas de Uma Vez por Todas">
  <meta name="description" content="Funções anônimas, funções lambda, notação de fórmula: muitos nomes para uma coisa que pouca gente entende">

  
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://blog.curso-r.com/posts/2021-08-16-entendendo-anonimas/">
  <meta property="og:title" content="Entendendo Funções Anônimas de Uma Vez por Todas">
  <meta property="og:description" content="Funções anônimas, funções lambda, notação de fórmula: muitos nomes para uma coisa que pouca gente entende">
  <meta property="og:image" content="https://blog.curso-r.com/images/posts/banner/lambda.webp?nf_resize=fit&w=300">

  
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://blog.curso-r.com/posts/2021-08-16-entendendo-anonimas/">
  <meta property="twitter:title" content="Entendendo Funções Anônimas de Uma Vez por Todas">
  <meta property="twitter:description" content="Funções anônimas, funções lambda, notação de fórmula: muitos nomes para uma coisa que pouca gente entende">
  <meta property="twitter:image" content="https://blog.curso-r.com/images/posts/banner/lambda.webp">

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="generator" content="Hugo 0.98.0" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://blog.curso-r.com/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://blog.curso-r.com/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://blog.curso-r.com/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://blog.curso-r.com/css/custom.css ">
  
  <link rel="stylesheet" href="https://blog.curso-r.com/css/github.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://blog.curso-r.com/css/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://blog.curso-r.com/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://blog.curso-r.com/images/favicon.png " type="image/x-icon">
</head>
<body>
<!-- preloader start -->
<div class="preloader">
  <div class="loader">
    <span class="dot"></span>
    <div class="dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</div>
<!-- preloader end -->
<header class="navigation">
  <nav class="navbar navbar-expand-lg navbar-light">
    <a class="navbar-brand" href="https://blog.curso-r.com/"><img class="img-fluid" src="https://blog.curso-r.com/images/logo.webp" alt="Blog | Curso-R" width = "200px", height="100px"></a>
    <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navogation"
      aria-controls="navogation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navogation">
      <ul class="navbar-nav ml-auto">
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://blog.curso-r.com/">Blog</a>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://blog.curso-r.com/categories/desafio">Desafios</a>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://www.curso-r.com/cursos">Cursos</a>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://discourse.curso-r.com/">Fórum</a>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://www.curso-r.com">Curso-R</a>
        </li>
        
        
      </ul>
      
      <!-- search -->
      <form class="form-inline position-relative ml-lg-4 form-searh" action="/search">
        <input class="form-control px-0" type="search" placeholder="" id="search-query" name="s">
        <button class="search-icon" type="submit"><i class="ti-search text-dark"></i></button>
      </form>
      
    </div>
  </nav>
</header>



<section class="section bg-posts" style = "background-image: url('https://blog.curso-r.com/images/posts/banner/lambda.webp')">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h1 class = "titulo-post">Entendendo Funções Anônimas de Uma Vez por Todas</h1>
      </div>
    </div>
  </div>
</section>



<section>
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <ul class="list-inline d-flex justify-content-between py-3">
          <li class="list-inline-item">
            <i class="ti-user mr-2"></i>
            Escrito por
            
            
              <a href = "https://blog.curso-r.com/search/?s=Caio">Caio</a>
            
            em
            <a href="/categories/tutoriais">Tutoriais</a>
          </li>
          <li class="list-inline-item">
            <i class="ti-calendar mr-2"></i>
            16 de
            agosto de
            2021
          </li>
        </ul>
        <ul class="list-inline tag-list">
          
            <li class="list-inline-item m-1"><a href="/tags/tidyverse">tidyverse</a></li>
            <li class="list-inline-item m-1"><a href="/tags/purrr">purrr</a></li>
        </ul>
        <article class="content">
          
            
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>Uma das funcionalidades mais interessantes do R é a possibilidade de estender a
linguagem para domínios específicos. A
<a href="https://blog.curso-r.com/posts/2021-07-27-rlang-para-filhotes/"><em>non-standard evaluation</em></a>
garante que até modificações à estrutura fundamental do R podem ser realizadas
sem problema. Hoje vamos falar de um assunto que muita gente quer aprender,
mas que pouca gente entende de verdade: funções anônimas.</p>
<p>Se você não souber o que é uma função anônima, pode ser que você conheça esse
conceito por outro nome. Também chamada de “função lambda”, “notação de fórmula”
ou “notação de til”, ela aparece principalmente em programas que usam o {purrr}
apesar de não serem exclusividade desse pacote. Resumindo, se você já viu algo
do tipo <code>~.x</code> e não entendeu do que se tratava, este post é para você.</p>
<div id="introdução" class="section level2">
<h2>Introdução</h2>
<p>Funções anônimas são, essencialmente, um jeito de simplificar a criação de
funções pequenas. Em poucas palavras, o nosso objetivo é não ter que declarar
uma função nova inteira com <code>function() { ... }</code> para poder usá-la dentro de
um programa.</p>
<p>O exemplo que será utilizado na explicação a seguir será a função <code>conta_na()</code>
que (não surpreendentemente) conta o número de <code>NA</code>s em um vetor. Vamos usá-la
dentro de um <code>map()</code> para que ela seja aplicada a todas as colunas de um data
frame. Sendo assim, partiremos da forma mais verborrágica possível desse código
e tentaremos chegar, intuitivamente, nas funções anônimas.</p>
<p>Uma ressalva importante é que a notação explicada aqui <strong>só funciona dentro do
{tidyverse}</strong>! No final do texto será apresentada uma alternativa que funciona
fora desse contexto, mas, por enquanto, a notação abaixo só pode aparecer nos
argumentos <code>.f</code>, <code>.fn</code> e <code>.fns</code> utilizados dentro do {tidyverse}.</p>
</div>
<div id="conceito" class="section level2">
<h2>Conceito</h2>
<p>Vamos imaginar uma função <code>conta_na()</code> que conta o número de <code>NA</code>s em uma coluna
de um data frame. Para aplicá-la a todas as colunas do data frame, podemos, por
exemplo, utilizar a função <code>map()</code> do pacote {purrr} como no exemplo abaixo:</p>
<pre class="r"><code>conta_na &lt;- function(vetor) {
  sum(is.na(vetor))
}

map_dbl(starwars, conta_na)</code></pre>
<pre><code>#&gt;       name     height       mass hair_color skin_color  eye_color birth_year 
#&gt;          0          6         28          5          0          0         44 
#&gt;        sex     gender  homeworld    species      films   vehicles  starships 
#&gt;          4          4         10          4          0          0          0</code></pre>
<p>No R, quando temos uma função simples de uma linha, é perfeitamente possível
não colocar o seu corpo em uma linha separada. Veja como o código já fica um
pouco mais compacto (saída omitida daqui em diante):</p>
<pre class="r"><code>conta_na &lt;- function(vetor) { sum(is.na(vetor)) }

map_dbl(starwars, conta_na)</code></pre>
<p>Agora, se temos uma função que cabe inteira em uma linha, o R nos permite também
omitir as chaves: por exemplo, m if-else pode ser escrito
<code>if (cond) resp1 else resp2</code> se as respostas não tiverem mais de uma linha. No
nosso caso, vamos reduzir ainda mais a <code>conta_na()</code>:</p>
<pre class="r"><code>conta_na &lt;- function(vetor) sum(is.na(vetor))

map_dbl(starwars, conta_na)</code></pre>
<p>O próximo passo seria encurtar o nome do argumento da função, utilizando algo
mais genérico. Poucas pessoas sabem, mas o R permite nomes começando com <code>.</code>!
Por motivos que ficarão claros a seguir, vamos escolher <code>.x</code> para ser o nome do
nosso argumento:</p>
<pre class="r"><code>conta_na &lt;- function(.x) sum(is.na(.x))

map_dbl(starwars, conta_na)</code></pre>
<p>Agora vem a grande sacada. Tudo que fizemos até agora funciona no R como um
todo, mas, se atendermos algumas condições extras, podemos reduzir ainda mais
essa função.</p>
<p>Vamos lá: se a função i) tiver apenas uma linha, ii) tiver apenas 1 argumento,
iii) tiver <code>.x</code> como seu único argumento <code>.x</code> e iv) estiver sendo utilizada como
argumento de uma função do {tidyverse}, então podemos omitir o <code>function(.x)</code>
(já que isso é informação redundante dadas as condições) e trocá-lo por um
singelo <code>~</code>:</p>
<pre class="r"><code>conta_na &lt;- ~ sum(is.na(.x))

map_dbl(starwars, conta_na)</code></pre>
<p>O último passo é o motivo de chamarmos essa notação de “função anônima”. Dado
que nossa função já é tão pequena e utilizamos ela em apenas um lugar, por que
precisamos dar um nome para ela? É mais fácil declará-la diretamente dentro do
<code>map()</code> sem um nome, ou seja, “anonimamente”:</p>
<pre class="r"><code>map_dbl(starwars, ~ sum(is.na(.x)))</code></pre>
<pre><code>#&gt;       name     height       mass hair_color skin_color  eye_color birth_year 
#&gt;          0          6         28          5          0          0         44 
#&gt;        sex     gender  homeworld    species      films   vehicles  starships 
#&gt;          4          4         10          4          0          0          0</code></pre>
<p>Pronto, agora você sabe o que significa uma função do tipo <code>~.x</code>. Para treinar,
tente fazer o processo reverso como no caso abaixo:</p>
<pre class="r"><code># Fração de valores distintos dentre todos
map_dbl(starwars, ~ length(unique(.x)) / length(.x))

# Desanonimizar
frac_distintos &lt;- ~ length(unique(.x)) / length(.x)
map_dbl(starwars, frac_distintos)

# Remover a notação de til (não é mais necessário mexer no map())
frac_distintos &lt;- function(.x) length(unique(.x)) / length(.x)

# Utilizar um nome melhor para o argumento
frac_distintos &lt;- function(vec) length(unique(vec)) / length(vec)

# Recolocar as chaves
frac_distintos &lt;- function(vec) { length(unique(vec)) / length(vec) }

# Identar o corpo da função
frac_distintos &lt;- function(vec) {
  length(unique(vec)) / length(vec)
}</code></pre>
<p>Agora fica bem mais fácil de entender o que faz o <code>map()</code> lá do começo.</p>
</div>
<div id="futuro" class="section level2">
<h2>Futuro</h2>
<p>A pergunta óbvia agora é: existe um jeito de fazer algo assim fora do
{tidyverse}? A resposta é sim e não.</p>
<p>Desde o
<a href="https://blog.curso-r.com/posts/2021-05-06-o-novo-pipe-esta-chegando/">R 4.1</a>,
o R introduziu a sua própria notação anônima. Ela funciona de maneira muito
similar ao <code>~</code>, com a diferença de que você precisa dizer o nome do seu
argumento. Abaixo deixo vocês com o processo de simplificação da função
<code>conta_na()</code> para a sua versão anônima que pode ser utilizada em qualquer
lugar e não só no {tidyverse}:</p>
<pre class="r"><code># Conta o número de NAs em um vetor
conta_na &lt;- function(vetor) {
  sum(is.na(vetor))
}

# Usar uma linha só
conta_na &lt;- function(vetor) { sum(is.na(vetor)) }

# Sem necessidade de usar chaves
conta_na &lt;- function(vetor) sum(is.na(vetor))

# Se a função tem uma linha, podemos usar a nova notação
conta_na &lt;- \(vetor) sum(is.na(vetor))

# O nome do argumento pode ser qualquer coisa, não importa
conta_na &lt;- \(v) sum(is.na(v))

# Anonimizar
map_dbl(starwars, \(v) sum(is.na(v)))</code></pre>
<pre><code>#&gt;       name     height       mass hair_color skin_color  eye_color birth_year 
#&gt;          0          6         28          5          0          0         44 
#&gt;        sex     gender  homeworld    species      films   vehicles  starships 
#&gt;          4          4         10          4          0          0          0</code></pre>
<p>Quase tão bom quanto a notação de til!</p>
</div>

          
        </article>
        
  <div class="disqus-comments">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "curso-r-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>


      </div>
      <div class="col-lg-1">
</div>
<div class="col-lg-3">
  
  <div class="widget">
    <h4 class="mb-4">POSTS MAIS RECENTES</h4>
    
    <div class="media mb-4">
      <div class="post-thumb-sm mr-3">
        <a href="https://blog.curso-r.com/posts/2022-10-13-pacote-miojo-2022/"><img class="mr-3 post-thumb-sm" src="https://blog.curso-r.com/images/posts/banner/package.webp"></a>
      </div>
      <div class="media-body">
        <h5><a class="text-dark" href="https://blog.curso-r.com/posts/2022-10-13-pacote-miojo-2022/">Pacotes miojo - como fazer um pacote no R em 3 minutos [atualizado]</a></h5>
        <p>Por Julio em <a href="/categories/tutoriais">Tutoriais</a></p>
      </div>
    </div>
    
    <div class="media mb-4">
      <div class="post-thumb-sm mr-3">
        <a href="https://blog.curso-r.com/posts/2022-09-13-senha-no-script/"><img class="mr-3 post-thumb-sm" src="https://blog.curso-r.com/images/posts/conteudo/2022-09-13-senha-no-script/logo-featured.jpg"></a>
      </div>
      <div class="media-body">
        <h5><a class="text-dark" href="https://blog.curso-r.com/posts/2022-09-13-senha-no-script/">Como usar senhas sem escreve-las nos scripts</a></h5>
        <p>Por Beatriz Milz em <a href="/categories/tutorial">Tutorial</a></p>
      </div>
    </div>
    
    <div class="media mb-4">
      <div class="post-thumb-sm mr-3">
        <a href="https://blog.curso-r.com/posts/2022-08-12-rstudio-conf-impressoes/"><img class="mr-3 post-thumb-sm" src="https://blog.curso-r.com/images/posts/banner/lunch-with-hadley.jpg"></a>
      </div>
      <div class="media-body">
        <h5><a class="text-dark" href="https://blog.curso-r.com/posts/2022-08-12-rstudio-conf-impressoes/">Impressões pessoais da rstudio::conf(2022)</a></h5>
        <p>Por Julio, Flavia E. Rius e Beatriz em <a href="/categories/divulga%c3%a7%c3%a3o">Divulgação</a></p>
      </div>
    </div>
    
  </div>
  <div class="widget">
    <h4 class="mb-4">LEIA MAIS SOBRE</h4>
    <ul class="list-inline tag-list">
      <li class="list-inline-item m-1"><a href="/categories/an%c3%a1lises">Análises</a></li>
      <li class="list-inline-item m-1"><a href="/categories/boas-pr%c3%a1ticas">Boas práticas</a></li>
      <li class="list-inline-item m-1"><a href="/categories/conceitos">Conceitos</a></li>
      <li class="list-inline-item m-1"><a href="/categories/debugging">Debugging</a></li>
      <li class="list-inline-item m-1"><a href="/categories/desafio">Desafio</a></li>
      <li class="list-inline-item m-1"><a href="/categories/discuss%c3%b5es">Discussões</a></li>
      <li class="list-inline-item m-1"><a href="/categories/divulga%c3%a7%c3%a3o">Divulgação</a></li>
      <li class="list-inline-item m-1"><a href="/categories/erros">Erros</a></li>
      <li class="list-inline-item m-1"><a href="/categories/pacotes">Pacotes</a></li>
      <li class="list-inline-item m-1"><a href="/categories/r">R</a></li>
      <li class="list-inline-item m-1"><a href="/categories/top-10">Top 10</a></li>
      <li class="list-inline-item m-1"><a href="/categories/tutoriais">Tutoriais</a></li>
      <li class="list-inline-item m-1"><a href="/categories/tutorial">Tutorial</a></li>
    </ul>
  </div>
</div>

    </div>
  </div>
</section>




<footer class="bg-footer" style = "background-image: url('https://blog.curso-r.com/images/footerImage.webp')">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
          <a href="https://www.curso-r.com"><img src="https://blog.curso-r.com/images/footerLogo.webp" alt="Blog | Curso-R" class="img-fluid"></a>
        </div>
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
          
          <h6>Dúvidas de R?</h6>
          <ul class="list-unstyled">
            <li class="font-secondary text-dark"><a href="https://discourse.curso-r.com/">Acesse nosso fórum</a></li>
          </ul>
          
        </div>
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
          
          <h6>Fale com a gente</h6>
          <ul class="list-unstyled">
            
            
            <li class="font-secondary text-dark"><a href="mailto:contato@curso-r.com">contato@curso-r.com</a></li>
            
          </ul>
          
        </div>
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
          <h6>Siga a Curso-R</h6>
          <ul class="list-inline d-inline-block">
            
            <li class="list-inline-item"><a href="https://github.com/curso-r" class="text-dark" target = "_blank"><i class="ti-github"></i></a></li>
            
            <li class="list-inline-item"><a href="https://twitter.com/curso_r" class="text-dark" target = "_blank"><i class="ti-twitter-alt"></i></a></li>
            
            <li class="list-inline-item"><a href="https://www.instagram.com/cursoo_r/" class="text-dark" target = "_blank"><i class="ti-instagram"></i></a></li>
            
            <li class="list-inline-item"><a href="https://br.linkedin.com/company/curso-r" class="text-dark" target = "_blank"><i class="ti-linkedin"></i></a></li>
            
            <li class="list-inline-item"><a href="https://www.facebook.com/cursodeR/" class="text-dark" target = "_blank"><i class="ti-facebook"></i></a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
    <div class="text-center pb-3 copyright">
        <h6 class="mb-0">Copyright © 2021 Curso-R</h6>
        <p class="mb-0" style = "font-size: 0.8em;"> Site feito em <a href = "https://gohugo.io/" target = "_blank">Hugo</a>, com o pacote <a href = "https://bookdown.org/yihui/blogdown/" target = "_blank">Blogdown</a>. Tema por <a href = "https://themefisher.com/" target = "_blank">Themefisher</a>.</p>
    </div>
</footer>



<script>
  var indexURL = "https://blog.curso-r.com/index.json"
</script>


<!-- JS Plugins -->

<script src="https://blog.curso-r.com/plugins/jQuery/jquery.min.js"></script>

<script src="https://blog.curso-r.com/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://blog.curso-r.com/plugins/slick/slick.min.js"></script>

<script src="https://blog.curso-r.com/plugins/headroom/headroom.js"></script>

<script src="https://blog.curso-r.com/plugins/instafeed/instafeed.min.js"></script>

<script src="https://blog.curso-r.com/plugins/masonry/masonry.js"></script>

<script src="https://blog.curso-r.com/plugins/reading-time/readingTime.min.js"></script>

<script src="https://blog.curso-r.com/plugins/smooth-scroll/smooth-scroll.js"></script>

<script src="https://blog.curso-r.com/plugins/search/fuse.min.js"></script>

<script src="https://blog.curso-r.com/plugins/search/mark.js"></script>

<script src="https://blog.curso-r.com/plugins/search/search.js"></script>

<script src="https://blog.curso-r.com/js/highlight.pack.js"></script>


<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- Main Script -->

<script src="https://blog.curso-r.com/js/script.min.js"></script>

<!-- google analitycs -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-87272102-2', 'auto');
  ga('send', 'pageview');
</script>





</body>
</html>