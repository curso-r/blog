<!DOCTYPE html>
<html lang="pt-br"><head>
  <meta charset="utf-8">

  
  <title>Advent of R: Dia 22</title>
  <meta name="title" content="Advent of R: Dia 22">
  <meta name="description" content="Resolvendo o Advent of Code 2021 com R: Dia 22.">

  
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://blog.curso-r.com/posts/2021-12-22-advent-of-r-22/">
  <meta property="og:title" content="Advent of R: Dia 22">
  <meta property="og:description" content="Resolvendo o Advent of Code 2021 com R: Dia 22.">
  <meta property="og:image" content="https://blog.curso-r.com/images/posts/banner/advent-of-r-22.webp?nf_resize=fit&w=300">

  
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://blog.curso-r.com/posts/2021-12-22-advent-of-r-22/">
  <meta property="twitter:title" content="Advent of R: Dia 22">
  <meta property="twitter:description" content="Resolvendo o Advent of Code 2021 com R: Dia 22.">
  <meta property="twitter:image" content="https://blog.curso-r.com/images/posts/banner/advent-of-r-22.webp">

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="generator" content="Hugo 0.85.0" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://blog.curso-r.com/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://blog.curso-r.com/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://blog.curso-r.com/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://blog.curso-r.com/css/custom.css ">
  
  <link rel="stylesheet" href="https://blog.curso-r.com/css/github.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://blog.curso-r.com/css/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://blog.curso-r.com/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://blog.curso-r.com/images/favicon.png " type="image/x-icon">
</head>
<body>
<!-- preloader start -->
<div class="preloader">
  <div class="loader">
    <span class="dot"></span>
    <div class="dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</div>
<!-- preloader end -->
<header class="navigation">
  <nav class="navbar navbar-expand-lg navbar-light">
    <a class="navbar-brand" href="https://blog.curso-r.com/"><img class="img-fluid" src="https://blog.curso-r.com/images/logo.webp" alt="Blog | Curso-R" width = "200px", height="100px"></a>
    <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navogation"
      aria-controls="navogation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navogation">
      <ul class="navbar-nav ml-auto">
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://blog.curso-r.com/">Blog</a>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://blog.curso-r.com/categories/desafio">Desafios</a>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://www.curso-r.com/cursos">Cursos</a>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://discourse.curso-r.com/">Fórum</a>
        </li>
        
        
        
        <li class="nav-item">
          <a class="nav-link text-uppercase text-dark" href="https://www.curso-r.com">Curso-R</a>
        </li>
        
        
      </ul>
      
      <!-- search -->
      <form class="form-inline position-relative ml-lg-4 form-searh" action="/search">
        <input class="form-control px-0" type="search" placeholder="" id="search-query" name="s">
        <button class="search-icon" type="submit"><i class="ti-search text-dark"></i></button>
      </form>
      
    </div>
  </nav>
</header>



<section class="section bg-posts" style = "background-image: url('https://blog.curso-r.com/images/posts/banner/advent-of-r-22.webp')">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h1 class = "titulo-post">Advent of R: Dia 22</h1>
      </div>
    </div>
  </div>
</section>



<section>
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <ul class="list-inline d-flex justify-content-between py-3">
          <li class="list-inline-item">
            <i class="ti-user mr-2"></i>
            Escrito por
            
            
              <a href = "https://blog.curso-r.com/search/?s=Caio">Caio</a>
            
            em
            <a href="/categories/tutoriais">Tutoriais</a>
          </li>
          <li class="list-inline-item">
            <i class="ti-calendar mr-2"></i>
            22 de
            dezembro de
            2021
          </li>
        </ul>
        <ul class="list-inline tag-list">
          
            <li class="list-inline-item m-1"><a href="/tags/advent-of-r">advent-of-r</a></li>
            <li class="list-inline-item m-1"><a href="/tags/tidyverse">tidyverse</a></li>
        </ul>
        <article class="content">
          
            
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>O <a href="https://adventofcode.com">Advent of Code</a> é um
<a href="https://pt.wikipedia.org/wiki/Calend%C3%A1rio_do_Advento">Calendário do Advento</a>
desenvolvido por <a href="https://github.com/topaz">Eric Wastl</a> composto por 25
pequenos exercícios de programação que vão sendo disponibilizados, um a um,
entre 1º de dezembro e o Natal de cada ano.</p>
<p>Meu objetivo com o <strong>Advent of R</strong> é resolver todos os problemas do
<a href="https://adventofcode.com/2021">Advent of Code 2021</a> em R e documentar o
processo através desta
<a href="https://blog.curso-r.com/tags/advent-of-r/">série de posts</a>. Todo dia entre
01/12/2021 e 25/12/2021 eu vou tentar resolver o novo problema, documentar a
minha solução aqui no blog e subir os meus scripts completos para um
<a href="https://github.com/curso-r/advent-of-r">repositório público</a> no GitHub.</p>
<p>A minha esperança é que, com essa série, mais pessoas pratiquem seus
conhecimentos de R resolvendo exercícios divertidos e desafiadores! Ao final
da jornada vamos todos ter afiado nossas habilidades de R e, quem sabe,
divulgado essa linguagem incrível para mais pessoas. Boas festas e bom código!</p>
<div id="reinicialização-do-reator-a" class="section level2">
<h2>Reinicialização do Reator (A)</h2>
<p>O <a href="https://adventofcode.com/2021/day/22">dia 22</a> do AoC foi mais um cujo
enunciado não apresentou dificuldades. Não que a resolução tenha sido fácil, mas
pelo menos o problema foi fácil de entender.</p>
<p>Essencialmente tínhamos que reiniciar o reator do submarino seguindo uma série
de instruções (a entrada do problema). O reator era composto por uma grade
gigantesca feita de cubos 1x1x1 que começavam todos desligados; cada instrução
nos dava uma região do reator que precisava ser desligada ou ligada:</p>
<pre class="r"><code># on x=10..12,y=10..12,z=10..12
# on x=11..13,y=11..13,z=11..13
# off x=9..11,y=9..11,z=9..11
# on x=10..10,y=10..10,z=10..10</code></pre>
<p>O primeiro comando da lista acima, por exemplo, ligava todos os cubos dentro da
matrix <code>reator[10:12, 10:12, 10:12]</code>. Nosso objetivo no primeiro item era contar
todos os cubos que estariam acessos no final do processo de reinicialização, mas
levando em conta <em>apenas</em> os cubos dentro da região denotada por
<code>x=-50..50,y=-50..50,z=-50..50</code>.</p>
<p>O código era bastante simples de escrever usando a função <code>array()</code> do R,
prestando atenção apenas ao fato de que as coordenadas da array deveríam ir de
1 a 101 e não de -50 a 50.</p>
<pre class="r"><code># Ler todos os passos como uma tabela
steps &lt;- &quot;data-raw/22a_reactor_reboot.txt&quot; |&gt;
  readr::read_lines() |&gt;
  stringr::str_split(&quot;[ ,]|(\\.\\.)&quot;) |&gt;
  purrr::transpose() |&gt;
  purrr::set_names(&quot;state&quot;, &quot;x1&quot;, &quot;x2&quot;, &quot;y1&quot;, &quot;y2&quot;, &quot;z1&quot;, &quot;z2&quot;) |&gt;
  purrr::map(purrr::flatten_chr) |&gt;
  tibble::as_tibble() |&gt;
  dplyr::mutate(
    dplyr::across(dplyr::ends_with(&quot;1&quot;), stringr::str_remove, &quot;[a-z]=&quot;),
    dplyr::across(c(-state), as.integer),
    x = purrr::map2(x1, x2, `:`),
    y = purrr::map2(y1, y2, `:`),
    z = purrr::map2(z1, z2, `:`)
  ) |&gt;
  dplyr::select(state, x, y, z)

# Criar reator como uma array 3D
reactor &lt;- array(rep(&quot;off&quot;, 303), dim = c(101, 101, 101))

# Iterar nos passos
for (i in seq_len(nrow(steps))) {

  # Coordenadas do cubóide
  x &lt;- steps$x[[i]] + 51
  y &lt;- steps$y[[i]] + 51
  z &lt;- steps$z[[i]] + 51

  # Eliminar o que estiver fora do cubo -50:50
  x &lt;- x[x &gt;= 1 &amp; x &lt;= 101]
  y &lt;- y[y &gt;= 1 &amp; y &lt;= 101]
  z &lt;- z[z &gt;= 1 &amp; z &lt;= 101]

  # Atribuir estado
  reactor[x, y, z] &lt;- steps$state[i]
}

# Contar cubos ligados
sum(reactor == &quot;on&quot;)
#&gt; [1] 647076</code></pre>
</div>
<div id="reinicialização-do-reator-b" class="section level2">
<h2>Reinicialização do Reator (B)</h2>
<p>Sem muita surpresa, o item 2 pedia para contarmos o número de cubos ligados ao
final do processo de reinicialização em <em>todo</em> o reator. Olhando o código acima,
parece que só seria necessário mudar as dimensões da array e tirar os filtros
dentro do loop, certo? Infelizmente não, pois com esse algoritmo ineficiente
precisaríamos contar aproximadamente 2 quadrilhões de cubos…</p>
<p>A solução foi, então, calcular apenas os limites das regiões e lidar com as suas
intersecções. Ou seja, se dois cubóides tiverem que ser ligados, então podemos
tomar nota das suas coordenadas e adicionar um novo cubóide de “subtração” na
nossa lista que servirá para remover uma cópia da intersecção que foi ligada
“duas vezes”. Resumidamente, estaremos contando apenas os volumes de cada
cubóide ligado e subtraíndo o volume de cada intersecção para não contar nada
duas vezes.</p>
<pre class="r"><code># Ler todos os passos como uma tabela
steps &lt;- &quot;data-raw/22b_reactor_reboot.txt&quot; |&gt;
  readr::read_lines() |&gt;
  stringr::str_split(&quot;[ ,]|(\\.\\.)&quot;) |&gt;
  purrr::transpose() |&gt;
  purrr::set_names(&quot;state&quot;, &quot;x1&quot;, &quot;x2&quot;, &quot;y1&quot;, &quot;y2&quot;, &quot;z1&quot;, &quot;z2&quot;) |&gt;
  purrr::map(purrr::flatten_chr) |&gt;
  tibble::as_tibble() |&gt;
  dplyr::mutate(
    dplyr::across(dplyr::ends_with(&quot;1&quot;), stringr::str_remove, &quot;[a-z]=&quot;),
    dplyr::across(c(-state), as.integer),
    state = ifelse(state == &quot;on&quot;, 1L, -1L),
  )

# Iterar nos passos Iterate over steps
cuboids &lt;- dplyr::slice_head(steps, n = 1)
for (i in 2:nrow(steps)) {

  # Iterar nos cubóides que já vimos
  for (j in seq_len(nrow(cuboids))) {

    # Calcular intersecção
    x1_inter &lt;- max(steps$x1[i], cuboids$x1[j])
    x2_inter &lt;- min(steps$x2[i], cuboids$x2[j])
    y1_inter &lt;- max(steps$y1[i], cuboids$y1[j])
    y2_inter &lt;- min(steps$y2[i], cuboids$y2[j])
    z1_inter &lt;- max(steps$z1[i], cuboids$z1[j])
    z2_inter &lt;- min(steps$z2[i], cuboids$z2[j])

    # Adicionar intersecção à lista (com sinal virado)
    if (x1_inter &lt;= x2_inter &amp;&amp; y1_inter &lt;= y2_inter &amp;&amp; z1_inter &lt;= z2_inter) {
      cuboids &lt;- tibble::add_row(cuboids,
        state = cuboids$state[j] * -1L,
        x1 = x1_inter, x2 = x2_inter,
        y1 = y1_inter, y2 = y2_inter,
        z1 = z1_inter, z2 = z2_inter,
      )
    }
  }

  # Adicionar cubóide à lista se ele estiver ligado
  if (steps$state[i] == 1) {
    cuboids &lt;- tibble::add_row(cuboids,
      state = steps$state[i],
      x1 = steps$x1[i], x2 = steps$x2[i],
      y1 = steps$y1[i], y2 = steps$y2[i],
      z1 = steps$z1[i], z2 = steps$z2[i],
    )
  }
}

# Contar cubos ligados
on &lt;- 0
for (i in seq_len(nrow(cuboids))) {

  # Calcular volume
  x &lt;- cuboids$x2[i] - cuboids$x1[i] + 1
  y &lt;- cuboids$y2[i] - cuboids$y1[i] + 1
  z &lt;- cuboids$z2[i] - cuboids$z1[i] + 1

  # Adicionar/remover à/da conta
  on &lt;- on + (x * y * z * cuboids$state[i])
}

# Imprimir
format(on, scientific = FALSE)
#&gt; [1] 1233304599156793</code></pre>
</div>

          
        </article>
        
  <div class="disqus-comments">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "curso-r-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>


      </div>
      <div class="col-lg-1">
</div>
<div class="col-lg-3">
  
  <div class="widget">
    <h4 class="mb-4">POSTS MAIS RECENTES</h4>
    
    <div class="media mb-4">
      <div class="post-thumb-sm mr-3">
        <a href="https://blog.curso-r.com/posts/2022-07-29-rstudio-conf-2022-dia2/"><img class="mr-3 post-thumb-sm" src="https://blog.curso-r.com/images/posts/banner/rstudio-conf-2022.png"></a>
      </div>
      <div class="media-body">
        <h5><a class="text-dark" href="https://blog.curso-r.com/posts/2022-07-29-rstudio-conf-2022-dia2/">rstudio::conf 2022, segundo dia de palestras</a></h5>
        <p>Por Julio em <a href="/categories/divulga%c3%a7%c3%a3o">Divulgação</a></p>
      </div>
    </div>
    
    <div class="media mb-4">
      <div class="post-thumb-sm mr-3">
        <a href="https://blog.curso-r.com/posts/2022-07-27-rstudio-conf-2022/"><img class="mr-3 post-thumb-sm" src="https://blog.curso-r.com/images/posts/banner/rstudio-conf-2022.png"></a>
      </div>
      <div class="media-body">
        <h5><a class="text-dark" href="https://blog.curso-r.com/posts/2022-07-27-rstudio-conf-2022/">rstudio::conf 2022, primeiro dia de palestras</a></h5>
        <p>Por Julio em <a href="/categories/divulga%c3%a7%c3%a3o">Divulgação</a></p>
      </div>
    </div>
    
    <div class="media mb-4">
      <div class="post-thumb-sm mr-3">
        <a href="https://blog.curso-r.com/posts/2022-07-15-vscode-server/"><img class="mr-3 post-thumb-sm" src="https://blog.curso-r.com/images/posts/banner/vscode-server.webp"></a>
      </div>
      <div class="media-body">
        <h5><a class="text-dark" href="https://blog.curso-r.com/posts/2022-07-15-vscode-server/">Acesso Remoto ao VS Code</a></h5>
        <p>Por Caio em <a href="/categories/tutoriais">Tutoriais</a></p>
      </div>
    </div>
    
  </div>
  <div class="widget">
    <h4 class="mb-4">LEIA MAIS SOBRE</h4>
    <ul class="list-inline tag-list">
      <li class="list-inline-item m-1"><a href="/categories/an%c3%a1lises">Análises</a></li>
      <li class="list-inline-item m-1"><a href="/categories/boas-pr%c3%a1ticas">Boas práticas</a></li>
      <li class="list-inline-item m-1"><a href="/categories/conceitos">Conceitos</a></li>
      <li class="list-inline-item m-1"><a href="/categories/debugging">Debugging</a></li>
      <li class="list-inline-item m-1"><a href="/categories/desafio">Desafio</a></li>
      <li class="list-inline-item m-1"><a href="/categories/discuss%c3%b5es">Discussões</a></li>
      <li class="list-inline-item m-1"><a href="/categories/divulga%c3%a7%c3%a3o">Divulgação</a></li>
      <li class="list-inline-item m-1"><a href="/categories/erros">Erros</a></li>
      <li class="list-inline-item m-1"><a href="/categories/pacotes">Pacotes</a></li>
      <li class="list-inline-item m-1"><a href="/categories/r">R</a></li>
      <li class="list-inline-item m-1"><a href="/categories/top-10">Top 10</a></li>
      <li class="list-inline-item m-1"><a href="/categories/tutoriais">Tutoriais</a></li>
      <li class="list-inline-item m-1"><a href="/categories/tutorial">Tutorial</a></li>
    </ul>
  </div>
</div>

    </div>
  </div>
</section>




<footer class="bg-footer" style = "background-image: url('https://blog.curso-r.com/images/footerImage.webp')">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
          <a href="https://www.curso-r.com"><img src="https://blog.curso-r.com/images/footerLogo.webp" alt="Blog | Curso-R" class="img-fluid"></a>
        </div>
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
          
          <h6>Dúvidas de R?</h6>
          <ul class="list-unstyled">
            <li class="font-secondary text-dark"><a href="https://discourse.curso-r.com/">Acesse nosso fórum</a></li>
          </ul>
          
        </div>
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
          
          <h6>Fale com a gente</h6>
          <ul class="list-unstyled">
            
            
            <li class="font-secondary text-dark"><a href="mailto:contato@curso-r.com">contato@curso-r.com</a></li>
            
          </ul>
          
        </div>
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
          <h6>Siga a Curso-R</h6>
          <ul class="list-inline d-inline-block">
            
            <li class="list-inline-item"><a href="https://github.com/curso-r" class="text-dark" target = "_blank"><i class="ti-github"></i></a></li>
            
            <li class="list-inline-item"><a href="https://twitter.com/curso_r" class="text-dark" target = "_blank"><i class="ti-twitter-alt"></i></a></li>
            
            <li class="list-inline-item"><a href="https://www.instagram.com/cursoo_r/" class="text-dark" target = "_blank"><i class="ti-instagram"></i></a></li>
            
            <li class="list-inline-item"><a href="https://br.linkedin.com/company/curso-r" class="text-dark" target = "_blank"><i class="ti-linkedin"></i></a></li>
            
            <li class="list-inline-item"><a href="https://www.facebook.com/cursodeR/" class="text-dark" target = "_blank"><i class="ti-facebook"></i></a></li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
    <div class="text-center pb-3 copyright">
        <h6 class="mb-0">Copyright © 2021 Curso-R</h6>
        <p class="mb-0" style = "font-size: 0.8em;"> Site feito em <a href = "https://gohugo.io/" target = "_blank">Hugo</a>, com o pacote <a href = "https://bookdown.org/yihui/blogdown/" target = "_blank">Blogdown</a>. Tema por <a href = "https://themefisher.com/" target = "_blank">Themefisher</a>.</p>
    </div>
</footer>



<script>
  var indexURL = "https://blog.curso-r.com/index.json"
</script>


<!-- JS Plugins -->

<script src="https://blog.curso-r.com/plugins/jQuery/jquery.min.js"></script>

<script src="https://blog.curso-r.com/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://blog.curso-r.com/plugins/slick/slick.min.js"></script>

<script src="https://blog.curso-r.com/plugins/headroom/headroom.js"></script>

<script src="https://blog.curso-r.com/plugins/instafeed/instafeed.min.js"></script>

<script src="https://blog.curso-r.com/plugins/masonry/masonry.js"></script>

<script src="https://blog.curso-r.com/plugins/reading-time/readingTime.min.js"></script>

<script src="https://blog.curso-r.com/plugins/smooth-scroll/smooth-scroll.js"></script>

<script src="https://blog.curso-r.com/plugins/search/fuse.min.js"></script>

<script src="https://blog.curso-r.com/plugins/search/mark.js"></script>

<script src="https://blog.curso-r.com/plugins/search/search.js"></script>

<script src="https://blog.curso-r.com/js/highlight.pack.js"></script>


<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- Main Script -->

<script src="https://blog.curso-r.com/js/script.min.js"></script>

<!-- google analitycs -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-87272102-2', 'auto');
  ga('send', 'pageview');
</script>





</body>
</html>