---
title: "Rolando Dados com {droll}"
date: "2021-08-12"
tags: ["dnd", "probabilidade", "dados"]
categories: ["pacotes"]
image: "images/posts/banner/droll.jpg"
author: ["Caio"]
summary: "Um pacote em R analisar rolagens de dados e calcular suas probabilidades"
draft: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "#>")
library(droll)
```

**droll** [ËˆdrÅl] _(adj.)_. **1**. (Ing.) Divertido, especialmente de forma
incomum.

droll Ã© um pacote R para parsear a notaÃ§Ã£o usada para descrever dados, analisar
rolagens, calcular probabilidades de sucesso e gerar grÃ¡ficos das distribuiÃ§Ãµes
dos resultados. Ele pode ajudar DMs detalhistas a preparar encontros (in)justos
com antecedÃªncia ou decidir a DC apropriada para um teste na hora. Jogadores
tambÃ©m podem usar o droll para determinar a melhor estratÃ©gia quando em uma
situaÃ§Ã£o difÃ­cil.

Ele foi feito para ser uma alternativa muito leve (sÃ³ uma dependÃªncia
obrigatÃ³ria), muito rÃ¡pida (menos de 0,4s para calcular a distribuiÃ§Ã£o completa
de 40d6) e muito precisa (representaÃ§Ã£o interna simbÃ³lica cortesia do Ryacas)
para o [anydice](https://anydice.com/) no R.

## InstalaÃ§Ã£o

Instale a versÃ£o estÃ¡vel do CRAN com:

``` r
install.packages("droll")
```

Ou instale a versÃ£o em desenvolvimento do
[GitHub](https://github.com/curso-r/droll) com:

``` r
# install.packages("remotes")
remotes::install_github("curso-r/droll")
```

## Uso

O que vocÃª procura no droll? VocÃª Ã© um usuÃ¡rio nÃ­vel 1, um programador
experiente nÃ­vel 10, ou um estatÃ­stico divino nÃ­vel 20? Escolha sua classe:

### ğŸ–ï¸ UsuÃ¡rio

O uso mais bÃ¡sico do droll envolve simplesmente rolar dados. VocÃª pode criar
qualquer dado que quiser com a funÃ§Ã£o `d()` e escrever qualquer expressÃ£o que
envolva aquele dado. Note que, se vocÃª quiser rolar NdX, vocÃª deveria escrever
`N * dX`.

```{r}
# Criar alguns dados
d20 <- d(20)
d6  <- d(6)
d4  <- d(4)

# Rolar um teste enquanto abenÃ§oado
(d20 + 8) + d4

# Rolar o dano!!
8 * d6

# Rolar um teste de resistÃªncia de destreza com desvantagem
if (min(d20, d20) + 4 < 18) {
  print("Dano completo!")
} else {
  print("Metade do dano.")
}
```

Simples e fÃ¡cil, certo? Se vocÃª Ã© um DM, vocÃª tambÃ©m pode querer usar duas
funÃ§Ãµes: `check_prob()` e `check_dc()`. Elas permitem que vocÃª,
respectivamente, calcule a probabilidade de passar (ou falhar) em um teste e
encontrar a DC necessÃ¡ria para que um teste tenha uma certa probabilidade de
sucesso (ou erro). VocÃª nÃ£o precisa nem criar os dados que vocÃª vai usar dentro
delas!

```{r}
# Qual Ã© a probabilidade que esse jogador passe em um teste de DC 15?
check_prob(d20 + 8, 15)

# Qual deveria ser a DC para que esse jogador tenha 50% de chance de sucesso?
check_dc(d20 + 8, 0.5)

# Qual Ã© a probabilidade desse jogador falhar em um teste de DC 10?
check_prob(d20 + 8, 10, success = FALSE)

# Qual deveria ser a DC para que esse jogador tenha 90% de chance de falha?
check_dc(d20 + 8, 0.9, success = FALSE)
```

NÃ£o hÃ¡ funÃ§Ãµes do tipo `attack_*()` porque as mecÃ¢nicas de ataques e testes sÃ£o
as mesmas, ou seja, sucesso equivale a rolar um valor maior ou igual a um certo
patamar. Essas funÃ§Ãµes podem, portanto, ser usadas para ataques tambÃ©m!

### ğŸ—¡ï¸ Programador

Se vocÃª jÃ¡ estÃ¡ acostumado com a notaÃ§Ã£o d/p/q/r do R, pode ser que vocÃª queira
mais detalhes sobre a distribuiÃ§Ã£o de uma rolagem. Ã‰ para isso que as funÃ§Ãµes
`droll()`, `proll()`, `qroll()`, e `rroll()` existem! Elas sÃ£o, respectivamente,
a densidade, a funÃ§Ã£o de distribuiÃ§Ã£o, a funÃ§Ã£o de quantil, e a geraÃ§Ã£o
aleatÃ³ria da distribuiÃ§Ã£o definida por uma expressÃ£o de rolagem.

```{r}
# P[d20 + 8 = 12]
droll(12, d20 + 8)

# P[d20 + 8 <= 12]
proll(12, d20 + 8)

# inf{x: P[d20 + 8 <= x] >= 0.5}
qroll(0.5, d20 + 8)

# Amostrar 3 vezes de d20 + 8 
rroll(3, d20 + 8)
```

Quando vocÃª aprender a usar essas quatro funÃ§Ãµes, vocÃª pode olhar as suas
variaÃ§Ãµes `plot_*()` delas. Elas geram grÃ¡ficos (usando o ggplot2 se ele estiver
disponÃ­vel) correspondendo Ã s distribuiÃ§Ãµes completas de d/p/q e um histograma
simples no caso da `plot_rroll()`.

```{r}
# Densidade de 8d6
droll_plot(8 * d6)

# FunÃ§Ã£o de distribuiÃ§Ã£o de 8d6
proll_plot(8 * d6)

# FunÃ§Ã£o de quantil de 8d6
qroll_plot(8 * d6)

# Histograma de 1000 rolagens de 8d6
rroll_plot(1000, 8 * d6)
```

Toda funÃ§Ã£o p/q tambÃ©m tem um conveniente argumento `lower.tail` que pode ser
igual a `FALSE` para que os cÃ¡lculos sejam feitos a partir da cauda superior
da distribuiÃ§Ã£o.

### ğŸª„ EstatÃ­stico

JÃ¡ que vocÃª Ã© um veterano do R, vocÃª precisa ser capaz de dobrar o droll Ã  sua
vontade. Se vocÃª gostaria de ver o tecido da realidade do droll, vocÃª pode usar
a funÃ§Ã£o `r()` para obter uma distribuiÃ§Ã£o de rolagem completa. Se vocÃª quiser
precisÃ£o mÃ¡xima, vocÃª tambÃ©m pode impedir o droll de converter a sua
representaÃ§Ã£o interna (operada pelo Ryacas) para _doubles_ com `precise = TRUE`.

```{r}
# Obter a distribuiÃ§Ã£o completa de 8d6
r(8 * d6)

# Poder ilimitado
r(8 * d6, precise = TRUE)
```

A tabela retornada por `r()` pode ser usada no lugar do argumento `roll` de
todas as funÃ§Ãµes discutidas acima. Isso pula os cÃ¡lculos internos, um atalho
valioso se vocÃª quiser rodar mÃºltiplos diagnÃ³sticos para a mesma expressÃ£o de
rolagem.

Como um estatÃ­stico nÃ­vel 20, vocÃª tambÃ©m nÃ£o estÃ¡ limitado pelos dados internos
do droll. VocÃª pode criar dados personalizados usando a mesma funÃ§Ã£o `d()`
descrita anteriormente.

```{r}
# Criar um dado "fudge"
dF <- d(-1:1)
rroll(5, dF)

# Criar um 2d20kh, um "dado de vantagem"
df <- r(max(d20, d20))
kh <- d(rep(df$outcome, df$n))
rroll(5, kh)
```
